
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 19 | 错误处理（下）：如何设计错误包？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>19 | 错误处理（下）：如何设计错误包？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">19 | 错误处理（下）：如何设计错误包？</h1><div><span>孔令飞</span> <span> 2021-07-08</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/19/d4/19c767ae0e4abce5bf5dcf8d454b38d4.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：16.00M</span><span> 时长：17:31</span></div></div><audio title="19 | 错误处理（下）：如何设计错误包？" src="https://res001.geekbang.org/media/audio/70/4a/70850e28a648c42649bafc9f304ee34a/ld/ld.m3u8" __idm_id__="311316"></audio></div><div><div><div><div data-slate-editor="true" data-key="15777" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="15778"><span data-slate-object="text" data-key="15779"><span data-slate-leaf="true" data-offset-key="15779:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15780"><span data-slate-object="text" data-key="15781"><span data-slate-leaf="true" data-offset-key="15781:0" data-first-offset="true"><span data-slate-string="true">在 Go 项目开发中，错误是我们必须要处理的一个事项。除了我们上一讲学习过的错误码，处理错误也离不开错误包。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15782"><span data-slate-object="text" data-key="15783"><span data-slate-leaf="true" data-offset-key="15783:0" data-first-offset="true"><span data-slate-string="true">业界有很多优秀的、开源的错误包可供选择，例如 Go 标准库自带的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15784"><span data-slate-object="text" data-key="15785"><span data-slate-leaf="true" data-offset-key="15785:0" data-first-offset="true"><span data-slate-string="true"> errors</span></span></span></span><span data-slate-object="text" data-key="15786"><span data-slate-leaf="true" data-offset-key="15786:0" data-first-offset="true"><span data-slate-string="true"> 包、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15787"><span data-slate-object="text" data-key="15788"><span data-slate-leaf="true" data-offset-key="15788:0" data-first-offset="true"><span data-slate-string="true">github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="15789"><span data-slate-leaf="true" data-offset-key="15789:0" data-first-offset="true"><span data-slate-string="true"> 包。但是这些包目前还不支持业务错误码，很难满足生产级应用的需求。所以，在实际开发中，我们有必要开发出适合自己错误码设计的错误包。当然，我们也没必要自己从 0 开发，可以基于一些优秀的包来进行二次封装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15790"><span data-slate-object="text" data-key="15791"><span data-slate-leaf="true" data-offset-key="15791:0" data-first-offset="true"><span data-slate-string="true">这一讲里，我们就来一起看看，如何设计一个错误包来适配上一讲我们设计的错误码，以及一个错误码的具体实现。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="15792" id="sr-toc-1"><span data-slate-object="text" data-key="15793"><span data-slate-leaf="true" data-offset-key="15793:0" data-first-offset="true"><span data-slate-string="true">错误包需要具有哪些功能？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="15794"><span data-slate-object="text" data-key="15795"><span data-slate-leaf="true" data-offset-key="15795:0" data-first-offset="true"><span data-slate-string="true">要想设计一个优秀的错误包，我们首先得知道一个优秀的错误包需要具备哪些功能。在我看来，至少需要有下面这六个功能：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15796"><span data-slate-object="text" data-key="15797"><span data-slate-leaf="true" data-offset-key="15797:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">首先，应该能支持错误堆栈。</span></span></span></span><span data-slate-object="text" data-key="15798"><span data-slate-leaf="true" data-offset-key="15798:0" data-first-offset="true"><span data-slate-string="true">我们来看下面一段代码，假设保存在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="15799"><span data-slate-object="text" data-key="15800"><span data-slate-leaf="true" data-offset-key="15800:0" data-first-offset="true"><span data-slate-string="true">bad.go</span></span></span></a><span data-slate-object="text" data-key="15801"><span data-slate-leaf="true" data-offset-key="15801:0" data-first-offset="true"><span data-slate-string="true"> 文件中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15802"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15803"><span data-slate-object="text" data-key="15804"><span data-slate-leaf="true" data-offset-key="15804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="15805"><span data-slate-leaf="true" data-offset-key="15805:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15806"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15807"><span data-slate-object="text" data-key="15808"><span data-slate-leaf="true" data-offset-key="15808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="15809"><span data-slate-leaf="true" data-offset-key="15809:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15810"><span data-slate-object="text" data-key="15811"><span data-slate-leaf="true" data-offset-key="15811:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15812"><span data-slate-leaf="true" data-offset-key="15812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15813"><span data-slate-object="text" data-key="15814"><span data-slate-leaf="true" data-offset-key="15814:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15815"><span data-slate-leaf="true" data-offset-key="15815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15816"><span data-slate-object="text" data-key="15817"><span data-slate-leaf="true" data-offset-key="15817:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15818"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15819"><span data-slate-object="text" data-key="15820"><span data-slate-leaf="true" data-offset-key="15820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15821"><span data-slate-leaf="true" data-offset-key="15821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15822"><span data-slate-leaf="true" data-offset-key="15822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="15823"><span data-slate-leaf="true" data-offset-key="15823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15824"><span data-slate-leaf="true" data-offset-key="15824:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15825"><span data-slate-object="text" data-key="15826"><span data-slate-leaf="true" data-offset-key="15826:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15827"><span data-slate-leaf="true" data-offset-key="15827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15828"><span data-slate-leaf="true" data-offset-key="15828:0" data-first-offset="true"><span data-slate-string="true"> err := funcA(); err != </span></span></span><span data-slate-object="text" data-key="15829"><span data-slate-leaf="true" data-offset-key="15829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15830"><span data-slate-leaf="true" data-offset-key="15830:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15831"><span data-slate-object="text" data-key="15832"><span data-slate-leaf="true" data-offset-key="15832:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15833"><span data-slate-leaf="true" data-offset-key="15833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"call func got failed: %v"</span></span></span></span><span data-slate-object="text" data-key="15834"><span data-slate-leaf="true" data-offset-key="15834:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15835"><span data-slate-object="text" data-key="15836"><span data-slate-leaf="true" data-offset-key="15836:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15837"><span data-slate-leaf="true" data-offset-key="15837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15838"><span data-slate-object="text" data-key="15839"><span data-slate-leaf="true" data-offset-key="15839:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15840"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15841"><span data-slate-object="text" data-key="15842"><span data-slate-leaf="true" data-offset-key="15842:0" data-first-offset="true"><span data-slate-string="true">  log.Println(</span></span></span><span data-slate-object="text" data-key="15843"><span data-slate-leaf="true" data-offset-key="15843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"call func success"</span></span></span></span><span data-slate-object="text" data-key="15844"><span data-slate-leaf="true" data-offset-key="15844:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15845"><span data-slate-object="text" data-key="15846"><span data-slate-leaf="true" data-offset-key="15846:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15847"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15848"><span data-slate-object="text" data-key="15849"><span data-slate-leaf="true" data-offset-key="15849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15850"><span data-slate-leaf="true" data-offset-key="15850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15851"><span data-slate-leaf="true" data-offset-key="15851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">funcA</span></span></span></span></span><span data-slate-object="text" data-key="15852"><span data-slate-leaf="true" data-offset-key="15852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15853"><span data-slate-leaf="true" data-offset-key="15853:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15854"><span data-slate-leaf="true" data-offset-key="15854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15855"><span data-slate-leaf="true" data-offset-key="15855:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15856"><span data-slate-object="text" data-key="15857"><span data-slate-leaf="true" data-offset-key="15857:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15858"><span data-slate-leaf="true" data-offset-key="15858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15859"><span data-slate-leaf="true" data-offset-key="15859:0" data-first-offset="true"><span data-slate-string="true"> err := funcB(); err != </span></span></span><span data-slate-object="text" data-key="15860"><span data-slate-leaf="true" data-offset-key="15860:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15861"><span data-slate-leaf="true" data-offset-key="15861:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15862"><span data-slate-object="text" data-key="15863"><span data-slate-leaf="true" data-offset-key="15863:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15864"><span data-slate-leaf="true" data-offset-key="15864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15865"><span data-slate-leaf="true" data-offset-key="15865:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15866"><span data-slate-object="text" data-key="15867"><span data-slate-leaf="true" data-offset-key="15867:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15868"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15869"><span data-slate-object="text" data-key="15870"><span data-slate-leaf="true" data-offset-key="15870:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15871"><span data-slate-leaf="true" data-offset-key="15871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15872"><span data-slate-leaf="true" data-offset-key="15872:0" data-first-offset="true"><span data-slate-string="true"> fmt.Errorf(</span></span></span><span data-slate-object="text" data-key="15873"><span data-slate-leaf="true" data-offset-key="15873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"func called error"</span></span></span></span><span data-slate-object="text" data-key="15874"><span data-slate-leaf="true" data-offset-key="15874:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15875"><span data-slate-object="text" data-key="15876"><span data-slate-leaf="true" data-offset-key="15876:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15877"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15878"><span data-slate-object="text" data-key="15879"><span data-slate-leaf="true" data-offset-key="15879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15880"><span data-slate-leaf="true" data-offset-key="15880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15881"><span data-slate-leaf="true" data-offset-key="15881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">funcB</span></span></span></span></span><span data-slate-object="text" data-key="15882"><span data-slate-leaf="true" data-offset-key="15882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15883"><span data-slate-leaf="true" data-offset-key="15883:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15884"><span data-slate-leaf="true" data-offset-key="15884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15885"><span data-slate-leaf="true" data-offset-key="15885:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15886"><span data-slate-object="text" data-key="15887"><span data-slate-leaf="true" data-offset-key="15887:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15888"><span data-slate-leaf="true" data-offset-key="15888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15889"><span data-slate-leaf="true" data-offset-key="15889:0" data-first-offset="true"><span data-slate-string="true"> fmt.Errorf(</span></span></span><span data-slate-object="text" data-key="15890"><span data-slate-leaf="true" data-offset-key="15890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"func called error"</span></span></span></span><span data-slate-object="text" data-key="15891"><span data-slate-leaf="true" data-offset-key="15891:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15892"><span data-slate-object="text" data-key="15893"><span data-slate-leaf="true" data-offset-key="15893:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15894"><span data-slate-object="text" data-key="15895"><span data-slate-leaf="true" data-offset-key="15895:0" data-first-offset="true"><span data-slate-string="true">执行上面的代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15896"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15897"><span data-slate-object="text" data-key="15898"><span data-slate-leaf="true" data-offset-key="15898:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="15899"><span data-slate-leaf="true" data-offset-key="15899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="15900"><span data-slate-leaf="true" data-offset-key="15900:0" data-first-offset="true"><span data-slate-string="true"> run bad.</span></span></span><span data-slate-object="text" data-key="15901"><span data-slate-leaf="true" data-offset-key="15901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15902"><span data-slate-object="text" data-key="15903"><span data-slate-leaf="true" data-offset-key="15903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2021</span></span></span></span><span data-slate-object="text" data-key="15904"><span data-slate-leaf="true" data-offset-key="15904:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span><span data-slate-object="text" data-key="15905"><span data-slate-leaf="true" data-offset-key="15905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">07</span></span></span></span><span data-slate-object="text" data-key="15906"><span data-slate-leaf="true" data-offset-key="15906:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span><span data-slate-object="text" data-key="15907"><span data-slate-leaf="true" data-offset-key="15907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">02</span></span></span></span><span data-slate-object="text" data-key="15908"><span data-slate-leaf="true" data-offset-key="15908:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15909"><span data-slate-leaf="true" data-offset-key="15909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">08</span></span></span></span><span data-slate-object="text" data-key="15910"><span data-slate-leaf="true" data-offset-key="15910:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="15911"><span data-slate-leaf="true" data-offset-key="15911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">06</span></span></span></span><span data-slate-object="text" data-key="15912"><span data-slate-leaf="true" data-offset-key="15912:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="15913"><span data-slate-leaf="true" data-offset-key="15913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">55</span></span></span></span><span data-slate-object="text" data-key="15914"><span data-slate-leaf="true" data-offset-key="15914:0" data-first-offset="true"><span data-slate-string="true"> call </span></span></span><span data-slate-object="text" data-key="15915"><span data-slate-leaf="true" data-offset-key="15915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15916"><span data-slate-leaf="true" data-offset-key="15916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15917"><span data-slate-leaf="true" data-offset-key="15917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">got</span></span></span></span></span><span data-slate-object="text" data-key="15918"><span data-slate-leaf="true" data-offset-key="15918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15919"><span data-slate-leaf="true" data-offset-key="15919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">failed</span></span></span></span></span><span data-slate-object="text" data-key="15920"><span data-slate-leaf="true" data-offset-key="15920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">: </span></span></span></span><span data-slate-object="text" data-key="15921"><span data-slate-leaf="true" data-offset-key="15921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15922"><span data-slate-leaf="true" data-offset-key="15922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15923"><span data-slate-leaf="true" data-offset-key="15923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">called</span></span></span></span></span><span data-slate-object="text" data-key="15924"><span data-slate-leaf="true" data-offset-key="15924:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15925"><span data-slate-leaf="true" data-offset-key="15925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15926"><span data-slate-object="text" data-key="15927"><span data-slate-leaf="true" data-offset-key="15927:0" data-first-offset="true"><span data-slate-string="true">exit status </span></span></span><span data-slate-object="text" data-key="15928"><span data-slate-leaf="true" data-offset-key="15928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15929"><span data-slate-object="text" data-key="15930"><span data-slate-leaf="true" data-offset-key="15930:0" data-first-offset="true"><span data-slate-string="true">这时我们想定位问题，但不知道具体是哪行代码报的错误，只能靠猜，还不一定能猜到。为了解决这个问题，我们可以加一些 Debug 信息，来协助我们定位问题。这样做在测试环境是没问题的，但是在线上环境，一方面修改、发布都比较麻烦，另一方面问题可能比较难重现。这时候我们会想，要是能打印错误的堆栈就好了。例如：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="15931"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15932"><span data-slate-object="text" data-key="15933"><span data-slate-leaf="true" data-offset-key="15933:0" data-first-offset="true"><span data-slate-string="true">2021/07/02 14:17:03 call func got failed: func called error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15934"><span data-slate-object="text" data-key="15935"><span data-slate-leaf="true" data-offset-key="15935:0" data-first-offset="true"><span data-slate-string="true">main.funcB</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15936"><span data-slate-object="text" data-key="15937"><span data-slate-leaf="true" data-offset-key="15937:0" data-first-offset="true"><span data-slate-string="true">  /home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/good.go:27</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15938"><span data-slate-object="text" data-key="15939"><span data-slate-leaf="true" data-offset-key="15939:0" data-first-offset="true"><span data-slate-string="true">main.funcA</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15940"><span data-slate-object="text" data-key="15941"><span data-slate-leaf="true" data-offset-key="15941:0" data-first-offset="true"><span data-slate-string="true">  /home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/good.go:19</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15942"><span data-slate-object="text" data-key="15943"><span data-slate-leaf="true" data-offset-key="15943:0" data-first-offset="true"><span data-slate-string="true">main.main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15944"><span data-slate-object="text" data-key="15945"><span data-slate-leaf="true" data-offset-key="15945:0" data-first-offset="true"><span data-slate-string="true">  /home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/good.go:10</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15946"><span data-slate-object="text" data-key="15947"><span data-slate-leaf="true" data-offset-key="15947:0" data-first-offset="true"><span data-slate-string="true">runtime.main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15948"><span data-slate-object="text" data-key="15949"><span data-slate-leaf="true" data-offset-key="15949:0" data-first-offset="true"><span data-slate-string="true">  /home/colin/go/go1.16.2/src/runtime/proc.go:225</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15950"><span data-slate-object="text" data-key="15951"><span data-slate-leaf="true" data-offset-key="15951:0" data-first-offset="true"><span data-slate-string="true">runtime.goexit</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15952"><span data-slate-object="text" data-key="15953"><span data-slate-leaf="true" data-offset-key="15953:0" data-first-offset="true"><span data-slate-string="true">  /home/colin/go/go1.16.2/src/runtime/asm_amd64.s:1371</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15954"><span data-slate-object="text" data-key="15955"><span data-slate-leaf="true" data-offset-key="15955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exit</span></span></span></span><span data-slate-object="text" data-key="15956"><span data-slate-leaf="true" data-offset-key="15956:0" data-first-offset="true"><span data-slate-string="true"> status 1</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15957"><span data-slate-object="text" data-key="15958"><span data-slate-leaf="true" data-offset-key="15958:0" data-first-offset="true"><span data-slate-string="true">通过上面的错误输出，我们可以很容易地知道是哪行代码报的错，从而极大提高问题定位的效率，降低定位的难度。所以，在我看来，一个优秀的 errors 包，首先需要支持错误堆栈。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15959"><span data-slate-object="text" data-key="15960"><span data-slate-leaf="true" data-offset-key="15960:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">其次，能够支持不同的打印格式。</span></span></span></span><span data-slate-object="text" data-key="15961"><span data-slate-leaf="true" data-offset-key="15961:0" data-first-offset="true"><span data-slate-string="true">例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15962"><span data-slate-object="text" data-key="15963"><span data-slate-leaf="true" data-offset-key="15963:0" data-first-offset="true"><span data-slate-string="true"> %+v</span></span></span></span><span data-slate-object="text" data-key="15964"><span data-slate-leaf="true" data-offset-key="15964:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15965"><span data-slate-object="text" data-key="15966"><span data-slate-leaf="true" data-offset-key="15966:0" data-first-offset="true"><span data-slate-string="true">%v</span></span></span></span><span data-slate-object="text" data-key="15967"><span data-slate-leaf="true" data-offset-key="15967:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15968"><span data-slate-object="text" data-key="15969"><span data-slate-leaf="true" data-offset-key="15969:0" data-first-offset="true"><span data-slate-string="true">%s</span></span></span></span><span data-slate-object="text" data-key="15970"><span data-slate-leaf="true" data-offset-key="15970:0" data-first-offset="true"><span data-slate-string="true"> 等格式，可以根据需要打印不同丰富度的错误信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15971"><span data-slate-object="text" data-key="15972"><span data-slate-leaf="true" data-offset-key="15972:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">再次，能支持 Wrap/Unwrap 功能，也就是在已有的错误上，追加一些新的信息。</span></span></span></span><span data-slate-object="text" data-key="15973"><span data-slate-leaf="true" data-offset-key="15973:0" data-first-offset="true"><span data-slate-string="true">例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15974"><span data-slate-object="text" data-key="15975"><span data-slate-leaf="true" data-offset-key="15975:0" data-first-offset="true"><span data-slate-string="true"> errors.Wrap(err, "open file failed")</span></span></span></span><span data-slate-object="text" data-key="15976"><span data-slate-leaf="true" data-offset-key="15976:0" data-first-offset="true"><span data-slate-string="true"> 。Wrap 通常用在调用函数中，调用函数可以基于被调函数报错时的错误 Wrap 一些自己的信息，丰富报错信息，方便后期的错误定位，例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15977"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15978"><span data-slate-object="text" data-key="15979"><span data-slate-leaf="true" data-offset-key="15979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15980"><span data-slate-leaf="true" data-offset-key="15980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15981"><span data-slate-leaf="true" data-offset-key="15981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">funcA</span></span></span></span></span><span data-slate-object="text" data-key="15982"><span data-slate-leaf="true" data-offset-key="15982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15983"><span data-slate-leaf="true" data-offset-key="15983:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15984"><span data-slate-leaf="true" data-offset-key="15984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15985"><span data-slate-leaf="true" data-offset-key="15985:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15986"><span data-slate-object="text" data-key="15987"><span data-slate-leaf="true" data-offset-key="15987:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15988"><span data-slate-leaf="true" data-offset-key="15988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15989"><span data-slate-leaf="true" data-offset-key="15989:0" data-first-offset="true"><span data-slate-string="true"> err := funcB(); err != </span></span></span><span data-slate-object="text" data-key="15990"><span data-slate-leaf="true" data-offset-key="15990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15991"><span data-slate-leaf="true" data-offset-key="15991:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15992"><span data-slate-object="text" data-key="15993"><span data-slate-leaf="true" data-offset-key="15993:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15994"><span data-slate-leaf="true" data-offset-key="15994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15995"><span data-slate-leaf="true" data-offset-key="15995:0" data-first-offset="true"><span data-slate-string="true"> errors.Wrap(err, </span></span></span><span data-slate-object="text" data-key="15996"><span data-slate-leaf="true" data-offset-key="15996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"call funcB failed"</span></span></span></span><span data-slate-object="text" data-key="15997"><span data-slate-leaf="true" data-offset-key="15997:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15998"><span data-slate-object="text" data-key="15999"><span data-slate-leaf="true" data-offset-key="15999:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16000"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16001"><span data-slate-object="text" data-key="16002"><span data-slate-leaf="true" data-offset-key="16002:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16003"><span data-slate-leaf="true" data-offset-key="16003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16004"><span data-slate-leaf="true" data-offset-key="16004:0" data-first-offset="true"><span data-slate-string="true"> errors.New(</span></span></span><span data-slate-object="text" data-key="16005"><span data-slate-leaf="true" data-offset-key="16005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"func called error"</span></span></span></span><span data-slate-object="text" data-key="16006"><span data-slate-leaf="true" data-offset-key="16006:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16007"><span data-slate-object="text" data-key="16008"><span data-slate-leaf="true" data-offset-key="16008:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16009"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16010"><span data-slate-object="text" data-key="16011"><span data-slate-leaf="true" data-offset-key="16011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16012"><span data-slate-leaf="true" data-offset-key="16012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16013"><span data-slate-leaf="true" data-offset-key="16013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">funcB</span></span></span></span></span><span data-slate-object="text" data-key="16014"><span data-slate-leaf="true" data-offset-key="16014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16015"><span data-slate-leaf="true" data-offset-key="16015:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16016"><span data-slate-leaf="true" data-offset-key="16016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16017"><span data-slate-leaf="true" data-offset-key="16017:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16018"><span data-slate-object="text" data-key="16019"><span data-slate-leaf="true" data-offset-key="16019:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16020"><span data-slate-leaf="true" data-offset-key="16020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16021"><span data-slate-leaf="true" data-offset-key="16021:0" data-first-offset="true"><span data-slate-string="true"> errors.New(</span></span></span><span data-slate-object="text" data-key="16022"><span data-slate-leaf="true" data-offset-key="16022:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"func called error"</span></span></span></span><span data-slate-object="text" data-key="16023"><span data-slate-leaf="true" data-offset-key="16023:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16024"><span data-slate-object="text" data-key="16025"><span data-slate-leaf="true" data-offset-key="16025:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16026"><span data-slate-object="text" data-key="16027"><span data-slate-leaf="true" data-offset-key="16027:0" data-first-offset="true"><span data-slate-string="true">这里要注意，不同的错误类型，Wrap 函数的逻辑也可以不同。另外，在调用 Wrap 时，也会生成一个错误堆栈节点。我们既然能够嵌套 error，那有时候还可能需要获取被嵌套的 error，这时就需要错误包提供</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16028"><span data-slate-object="text" data-key="16029"><span data-slate-leaf="true" data-offset-key="16029:0" data-first-offset="true"><span data-slate-string="true"> Unwrap</span></span></span></span><span data-slate-object="text" data-key="16030"><span data-slate-leaf="true" data-offset-key="16030:0" data-first-offset="true"><span data-slate-string="true"> 函数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16031"><span data-slate-object="text" data-key="16032"><span data-slate-leaf="true" data-offset-key="16032:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">还有，错误包应该有</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16033"><span data-slate-object="text" data-key="16034"><span data-slate-leaf="true" data-offset-key="16034:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> Is</span></span></span></span></span><span data-slate-object="text" data-key="16035"><span data-slate-leaf="true" data-offset-key="16035:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 方法</span></span></span></span><span data-slate-object="text" data-key="16036"><span data-slate-leaf="true" data-offset-key="16036:0" data-first-offset="true"><span data-slate-string="true">。在实际开发中，我们经常需要判断某个 error 是否是指定的 error。在 Go 1.13 之前，也就是没有 wrapping error 的时候，我们要判断 error 是不是同一个，可以使用如下方法：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="16037"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16038"><span data-slate-object="text" data-key="16039"><span data-slate-leaf="true" data-offset-key="16039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16040"><span data-slate-leaf="true" data-offset-key="16040:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16041"><span data-slate-leaf="true" data-offset-key="16041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">err</span></span></span></span><span data-slate-object="text" data-key="16042"><span data-slate-leaf="true" data-offset-key="16042:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16043"><span data-slate-leaf="true" data-offset-key="16043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="16044"><span data-slate-leaf="true" data-offset-key="16044:0" data-first-offset="true"><span data-slate-string="true">= os.ErrNotExist {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16045"><span data-slate-object="text" data-key="16046"><span data-slate-leaf="true" data-offset-key="16046:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16047"><span data-slate-leaf="true" data-offset-key="16047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// normal code</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16048"><span data-slate-object="text" data-key="16049"><span data-slate-leaf="true" data-offset-key="16049:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16050"><span data-slate-object="text" data-key="16051"><span data-slate-leaf="true" data-offset-key="16051:0" data-first-offset="true"><span data-slate-string="true">但是现在，因为有了 wrapping error，这样判断就会有问题。因为你根本不知道返回的 err 是不是一个嵌套的 error，嵌套了几层。这种情况下，我们的错误包就需要提供</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16052"><span data-slate-object="text" data-key="16053"><span data-slate-leaf="true" data-offset-key="16053:0" data-first-offset="true"><span data-slate-string="true"> Is</span></span></span></span><span data-slate-object="text" data-key="16054"><span data-slate-leaf="true" data-offset-key="16054:0" data-first-offset="true"><span data-slate-string="true"> 函数：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16055"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16056"><span data-slate-object="text" data-key="16057"><span data-slate-leaf="true" data-offset-key="16057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16058"><span data-slate-leaf="true" data-offset-key="16058:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16059"><span data-slate-leaf="true" data-offset-key="16059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Is</span></span></span></span></span><span data-slate-object="text" data-key="16060"><span data-slate-leaf="true" data-offset-key="16060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(err, target </span></span></span></span></span><span data-slate-object="text" data-key="16061"><span data-slate-leaf="true" data-offset-key="16061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></span></span><span data-slate-object="text" data-key="16062"><span data-slate-leaf="true" data-offset-key="16062:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="16063"><span data-slate-leaf="true" data-offset-key="16063:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16064"><span data-slate-leaf="true" data-offset-key="16064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16065"><span data-slate-object="text" data-key="16066"><span data-slate-leaf="true" data-offset-key="16066:0" data-first-offset="true"><span data-slate-string="true">当 err 和 target 是同一个，或者 err 是一个 wrapping error 的时候，如果 target 也包含在这个嵌套 error 链中，返回 true，否则返回 fasle。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16067"><span data-slate-object="text" data-key="16068"><span data-slate-leaf="true" data-offset-key="16068:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">另外，错误包应该支持</span></span></span></span><span data-slate-object="text" data-key="16069"><span data-slate-leaf="true" data-offset-key="16069:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16070"><span data-slate-object="text" data-key="16071"><span data-slate-leaf="true" data-offset-key="16071:0" data-first-offset="true"><span data-slate-string="true"> As</span></span></span></span><span data-slate-object="text" data-key="16072"><span data-slate-leaf="true" data-offset-key="16072:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16073"><span data-slate-leaf="true" data-offset-key="16073:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 函数。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16074"><span data-slate-object="text" data-key="16075"><span data-slate-leaf="true" data-offset-key="16075:0" data-first-offset="true"><span data-slate-string="true">在 Go 1.13 之前，没有 wrapping error 的时候，我们要把 error 转为另外一个 error，一般都是使用 type assertion 或者 type switch，也就是类型断言。例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16076"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16077"><span data-slate-object="text" data-key="16078"><span data-slate-leaf="true" data-offset-key="16078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16079"><span data-slate-leaf="true" data-offset-key="16079:0" data-first-offset="true"><span data-slate-string="true"> perr, ok := err.(*os.PathError); ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16080"><span data-slate-object="text" data-key="16081"><span data-slate-leaf="true" data-offset-key="16081:0" data-first-offset="true"><span data-slate-string="true">  fmt.Println(perr.Path)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16082"><span data-slate-object="text" data-key="16083"><span data-slate-leaf="true" data-offset-key="16083:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16084"><span data-slate-object="text" data-key="16085"><span data-slate-leaf="true" data-offset-key="16085:0" data-first-offset="true"><span data-slate-string="true">但是现在，返回的 err 可能是嵌套的 error，甚至好几层嵌套，这种方式就不能用了。所以，我们可以通过实现 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16086"><span data-slate-object="text" data-key="16087"><span data-slate-leaf="true" data-offset-key="16087:0" data-first-offset="true"><span data-slate-string="true">As</span></span></span></span><span data-slate-object="text" data-key="16088"><span data-slate-leaf="true" data-offset-key="16088:0" data-first-offset="true"><span data-slate-string="true"> 函数来完成这种功能。现在我们把上面的例子，用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16089"><span data-slate-object="text" data-key="16090"><span data-slate-leaf="true" data-offset-key="16090:0" data-first-offset="true"><span data-slate-string="true">As</span></span></span></span><span data-slate-object="text" data-key="16091"><span data-slate-leaf="true" data-offset-key="16091:0" data-first-offset="true"><span data-slate-string="true"> 函数实现一下：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="16092"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16093"><span data-slate-object="text" data-key="16094"><span data-slate-leaf="true" data-offset-key="16094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="16095"><span data-slate-leaf="true" data-offset-key="16095:0" data-first-offset="true"><span data-slate-string="true"> perr *os.</span></span></span><span data-slate-object="text" data-key="16096"><span data-slate-leaf="true" data-offset-key="16096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PathError</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16097"><span data-slate-object="text" data-key="16098"><span data-slate-leaf="true" data-offset-key="16098:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16099"><span data-slate-leaf="true" data-offset-key="16099:0" data-first-offset="true"><span data-slate-string="true"> errors.</span></span></span><span data-slate-object="text" data-key="16100"><span data-slate-leaf="true" data-offset-key="16100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">As</span></span></span></span><span data-slate-object="text" data-key="16101"><span data-slate-leaf="true" data-offset-key="16101:0" data-first-offset="true"><span data-slate-string="true">(err, &amp;perr) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16102"><span data-slate-object="text" data-key="16103"><span data-slate-leaf="true" data-offset-key="16103:0" data-first-offset="true"><span data-slate-string="true">  fmt.</span></span></span><span data-slate-object="text" data-key="16104"><span data-slate-leaf="true" data-offset-key="16104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Println</span></span></span></span><span data-slate-object="text" data-key="16105"><span data-slate-leaf="true" data-offset-key="16105:0" data-first-offset="true"><span data-slate-string="true">(perr.</span></span></span><span data-slate-object="text" data-key="16106"><span data-slate-leaf="true" data-offset-key="16106:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Path</span></span></span></span><span data-slate-object="text" data-key="16107"><span data-slate-leaf="true" data-offset-key="16107:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16108"><span data-slate-object="text" data-key="16109"><span data-slate-leaf="true" data-offset-key="16109:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16110"><span data-slate-object="text" data-key="16111"><span data-slate-leaf="true" data-offset-key="16111:0" data-first-offset="true"><span data-slate-string="true">这样就可以完全实现类型断言的功能，而且还更强大，因为它可以处理 wrapping error。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16112"><span data-slate-object="text" data-key="16113"><span data-slate-leaf="true" data-offset-key="16113:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">最后，能够支持两种错误创建方式：非格式化创建和格式化创建。</span></span></span></span><span data-slate-object="text" data-key="16114"><span data-slate-leaf="true" data-offset-key="16114:0" data-first-offset="true"><span data-slate-string="true">例如：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="16115"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16116"><span data-slate-object="text" data-key="16117"><span data-slate-leaf="true" data-offset-key="16117:0" data-first-offset="true"><span data-slate-string="true">errors.</span></span></span><span data-slate-object="text" data-key="16118"><span data-slate-leaf="true" data-offset-key="16118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">New</span></span></span></span><span data-slate-object="text" data-key="16119"><span data-slate-leaf="true" data-offset-key="16119:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="16120"><span data-slate-leaf="true" data-offset-key="16120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"file not found"</span></span></span></span><span data-slate-object="text" data-key="16121"><span data-slate-leaf="true" data-offset-key="16121:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16122"><span data-slate-object="text" data-key="16123"><span data-slate-leaf="true" data-offset-key="16123:0" data-first-offset="true"><span data-slate-string="true">errors.</span></span></span><span data-slate-object="text" data-key="16124"><span data-slate-leaf="true" data-offset-key="16124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Errorf</span></span></span></span><span data-slate-object="text" data-key="16125"><span data-slate-leaf="true" data-offset-key="16125:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="16126"><span data-slate-leaf="true" data-offset-key="16126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"file %s not found"</span></span></span></span><span data-slate-object="text" data-key="16127"><span data-slate-leaf="true" data-offset-key="16127:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="16128"><span data-slate-leaf="true" data-offset-key="16128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iam-apiserver"</span></span></span></span><span data-slate-object="text" data-key="16129"><span data-slate-leaf="true" data-offset-key="16129:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16130"><span data-slate-object="text" data-key="16131"><span data-slate-leaf="true" data-offset-key="16131:0" data-first-offset="true"><span data-slate-string="true">上面，我们介绍了一个优秀的错误包应该具备的功能。一个好消息是，Github 上有不少实现了这些功能的错误包，其中</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16132"><span data-slate-object="text" data-key="16133"><span data-slate-leaf="true" data-offset-key="16133:0" data-first-offset="true"><span data-slate-string="true"> github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="16134"><span data-slate-leaf="true" data-offset-key="16134:0" data-first-offset="true"><span data-slate-string="true"> 包最受欢迎。所以，我基于</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16135"><span data-slate-object="text" data-key="16136"><span data-slate-leaf="true" data-offset-key="16136:0" data-first-offset="true"><span data-slate-string="true"> github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="16137"><span data-slate-leaf="true" data-offset-key="16137:0" data-first-offset="true"><span data-slate-string="true"> 包进行了二次封装，用来支持上一讲所介绍的错误码。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="16138" id="sr-toc-2"><span data-slate-object="text" data-key="16139"><span data-slate-leaf="true" data-offset-key="16139:0" data-first-offset="true"><span data-slate-string="true">错误包实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="16140"><span data-slate-object="text" data-key="16141"><span data-slate-leaf="true" data-offset-key="16141:0" data-first-offset="true"><span data-slate-string="true">明确优秀的错误包应该具备的功能后，我们来看下错误包的实现。实现的源码存放在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16142"><span data-slate-object="text" data-key="16143"><span data-slate-leaf="true" data-offset-key="16143:0" data-first-offset="true"><span data-slate-string="true">github.com/marmotedu/errors</span></span></span></a><span data-slate-object="text" data-key="16144"><span data-slate-leaf="true" data-offset-key="16144:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16145"><span data-slate-object="text" data-key="16146"><span data-slate-leaf="true" data-offset-key="16146:0" data-first-offset="true"><span data-slate-string="true">我通过在文件 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16147"><span data-slate-object="text" data-key="16148"><span data-slate-leaf="true" data-offset-key="16148:0" data-first-offset="true"><span data-slate-string="true">github.com/pkg/errors/errors.go</span></span></span></a><span data-slate-object="text" data-key="16149"><span data-slate-leaf="true" data-offset-key="16149:0" data-first-offset="true"><span data-slate-string="true"> 中增加新的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16150"><span data-slate-object="text" data-key="16151"><span data-slate-leaf="true" data-offset-key="16151:0" data-first-offset="true"><span data-slate-string="true"> withCode</span></span></span></span><span data-slate-object="text" data-key="16152"><span data-slate-leaf="true" data-offset-key="16152:0" data-first-offset="true"><span data-slate-string="true"> 结构体，来引入一种新的错误类型，该错误类型可以记录错误码、stack、cause 和具体的错误信息。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16153"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16154"><span data-slate-object="text" data-key="16155"><span data-slate-leaf="true" data-offset-key="16155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="16156"><span data-slate-leaf="true" data-offset-key="16156:0" data-first-offset="true"><span data-slate-string="true"> withCode </span></span></span><span data-slate-object="text" data-key="16157"><span data-slate-leaf="true" data-offset-key="16157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="16158"><span data-slate-leaf="true" data-offset-key="16158:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16159"><span data-slate-object="text" data-key="16160"><span data-slate-leaf="true" data-offset-key="16160:0" data-first-offset="true"><span data-slate-string="true">    err   </span></span></span><span data-slate-object="text" data-key="16161"><span data-slate-leaf="true" data-offset-key="16161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16162"><span data-slate-leaf="true" data-offset-key="16162:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16163"><span data-slate-leaf="true" data-offset-key="16163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//error 错误</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16164"><span data-slate-object="text" data-key="16165"><span data-slate-leaf="true" data-offset-key="16165:0" data-first-offset="true"><span data-slate-string="true">    code  </span></span></span><span data-slate-object="text" data-key="16166"><span data-slate-leaf="true" data-offset-key="16166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="16167"><span data-slate-leaf="true" data-offset-key="16167:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16168"><span data-slate-leaf="true" data-offset-key="16168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 业务错误码</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16169"><span data-slate-object="text" data-key="16170"><span data-slate-leaf="true" data-offset-key="16170:0" data-first-offset="true"><span data-slate-string="true">    cause </span></span></span><span data-slate-object="text" data-key="16171"><span data-slate-leaf="true" data-offset-key="16171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16172"><span data-slate-leaf="true" data-offset-key="16172:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16173"><span data-slate-leaf="true" data-offset-key="16173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// cause error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16174"><span data-slate-object="text" data-key="16175"><span data-slate-leaf="true" data-offset-key="16175:0" data-first-offset="true"><span data-slate-string="true">    *stack </span></span></span><span data-slate-object="text" data-key="16176"><span data-slate-leaf="true" data-offset-key="16176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 错误堆栈</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16177"><span data-slate-object="text" data-key="16178"><span data-slate-leaf="true" data-offset-key="16178:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16179"><span data-slate-object="text" data-key="16180"><span data-slate-leaf="true" data-offset-key="16180:0" data-first-offset="true"><span data-slate-string="true">下面，我们通过一个示例，来了解下</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16181"><span data-slate-object="text" data-key="16182"><span data-slate-leaf="true" data-offset-key="16182:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16183"><span data-slate-leaf="true" data-offset-key="16183:0" data-first-offset="true"><span data-slate-string="true"> 所提供的功能。假设下述代码保存在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16184"><span data-slate-object="text" data-key="16185"><span data-slate-leaf="true" data-offset-key="16185:0" data-first-offset="true"><span data-slate-string="true"> errors.go</span></span></span></span><span data-slate-object="text" data-key="16186"><span data-slate-leaf="true" data-offset-key="16186:0" data-first-offset="true"><span data-slate-string="true"> 文件中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16187"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16188"><span data-slate-object="text" data-key="16189"><span data-slate-leaf="true" data-offset-key="16189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="16190"><span data-slate-leaf="true" data-offset-key="16190:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16191"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16192"><span data-slate-object="text" data-key="16193"><span data-slate-leaf="true" data-offset-key="16193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="16194"><span data-slate-leaf="true" data-offset-key="16194:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16195"><span data-slate-object="text" data-key="16196"><span data-slate-leaf="true" data-offset-key="16196:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16197"><span data-slate-leaf="true" data-offset-key="16197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16198"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16199"><span data-slate-object="text" data-key="16200"><span data-slate-leaf="true" data-offset-key="16200:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16201"><span data-slate-leaf="true" data-offset-key="16201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/errors"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16202"><span data-slate-object="text" data-key="16203"><span data-slate-leaf="true" data-offset-key="16203:0" data-first-offset="true"><span data-slate-string="true">  code </span></span></span><span data-slate-object="text" data-key="16204"><span data-slate-leaf="true" data-offset-key="16204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/sample-code"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16205"><span data-slate-object="text" data-key="16206"><span data-slate-leaf="true" data-offset-key="16206:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16207"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16208"><span data-slate-object="text" data-key="16209"><span data-slate-leaf="true" data-offset-key="16209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16210"><span data-slate-leaf="true" data-offset-key="16210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16211"><span data-slate-leaf="true" data-offset-key="16211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="16212"><span data-slate-leaf="true" data-offset-key="16212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16213"><span data-slate-leaf="true" data-offset-key="16213:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16214"><span data-slate-object="text" data-key="16215"><span data-slate-leaf="true" data-offset-key="16215:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16216"><span data-slate-leaf="true" data-offset-key="16216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16217"><span data-slate-leaf="true" data-offset-key="16217:0" data-first-offset="true"><span data-slate-string="true"> err := bindUser(); err != </span></span></span><span data-slate-object="text" data-key="16218"><span data-slate-leaf="true" data-offset-key="16218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16219"><span data-slate-leaf="true" data-offset-key="16219:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16220"><span data-slate-object="text" data-key="16221"><span data-slate-leaf="true" data-offset-key="16221:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16222"><span data-slate-leaf="true" data-offset-key="16222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %s: Returns the user-safe error string mapped to the error code or the error message if none is specified.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16223"><span data-slate-object="text" data-key="16224"><span data-slate-leaf="true" data-offset-key="16224:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16225"><span data-slate-leaf="true" data-offset-key="16225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %s &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16226"><span data-slate-leaf="true" data-offset-key="16226:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16227"><span data-slate-object="text" data-key="16228"><span data-slate-leaf="true" data-offset-key="16228:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16229"><span data-slate-leaf="true" data-offset-key="16229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%s\n\n"</span></span></span></span><span data-slate-object="text" data-key="16230"><span data-slate-leaf="true" data-offset-key="16230:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16231"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16232"><span data-slate-object="text" data-key="16233"><span data-slate-leaf="true" data-offset-key="16233:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16234"><span data-slate-leaf="true" data-offset-key="16234:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %v: Alias for %s.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16235"><span data-slate-object="text" data-key="16236"><span data-slate-leaf="true" data-offset-key="16236:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16237"><span data-slate-leaf="true" data-offset-key="16237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %v &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16238"><span data-slate-leaf="true" data-offset-key="16238:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16239"><span data-slate-object="text" data-key="16240"><span data-slate-leaf="true" data-offset-key="16240:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16241"><span data-slate-leaf="true" data-offset-key="16241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%v\n\n"</span></span></span></span><span data-slate-object="text" data-key="16242"><span data-slate-leaf="true" data-offset-key="16242:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16243"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16244"><span data-slate-object="text" data-key="16245"><span data-slate-leaf="true" data-offset-key="16245:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16246"><span data-slate-leaf="true" data-offset-key="16246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %-v: Output caller details, useful for troubleshooting.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16247"><span data-slate-object="text" data-key="16248"><span data-slate-leaf="true" data-offset-key="16248:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16249"><span data-slate-leaf="true" data-offset-key="16249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %-v &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16250"><span data-slate-leaf="true" data-offset-key="16250:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16251"><span data-slate-object="text" data-key="16252"><span data-slate-leaf="true" data-offset-key="16252:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16253"><span data-slate-leaf="true" data-offset-key="16253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%-v\n\n"</span></span></span></span><span data-slate-object="text" data-key="16254"><span data-slate-leaf="true" data-offset-key="16254:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16255"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16256"><span data-slate-object="text" data-key="16257"><span data-slate-leaf="true" data-offset-key="16257:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16258"><span data-slate-leaf="true" data-offset-key="16258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %+v: Output full error stack details, useful for debugging.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16259"><span data-slate-object="text" data-key="16260"><span data-slate-leaf="true" data-offset-key="16260:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16261"><span data-slate-leaf="true" data-offset-key="16261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %+v &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16262"><span data-slate-leaf="true" data-offset-key="16262:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16263"><span data-slate-object="text" data-key="16264"><span data-slate-leaf="true" data-offset-key="16264:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16265"><span data-slate-leaf="true" data-offset-key="16265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%+v\n\n"</span></span></span></span><span data-slate-object="text" data-key="16266"><span data-slate-leaf="true" data-offset-key="16266:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16267"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16268"><span data-slate-object="text" data-key="16269"><span data-slate-leaf="true" data-offset-key="16269:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16270"><span data-slate-leaf="true" data-offset-key="16270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %#-v: Output caller details, useful for troubleshooting with JSON formatted output.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16271"><span data-slate-object="text" data-key="16272"><span data-slate-leaf="true" data-offset-key="16272:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16273"><span data-slate-leaf="true" data-offset-key="16273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %#-v &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16274"><span data-slate-leaf="true" data-offset-key="16274:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16275"><span data-slate-object="text" data-key="16276"><span data-slate-leaf="true" data-offset-key="16276:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16277"><span data-slate-leaf="true" data-offset-key="16277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%#-v\n\n"</span></span></span></span><span data-slate-object="text" data-key="16278"><span data-slate-leaf="true" data-offset-key="16278:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16279"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16280"><span data-slate-object="text" data-key="16281"><span data-slate-leaf="true" data-offset-key="16281:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16282"><span data-slate-leaf="true" data-offset-key="16282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// %#+v: Output full error stack details, useful for debugging with JSON formatted output.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16283"><span data-slate-object="text" data-key="16284"><span data-slate-leaf="true" data-offset-key="16284:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(</span></span></span><span data-slate-object="text" data-key="16285"><span data-slate-leaf="true" data-offset-key="16285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"====================&gt; %#+v &lt;===================="</span></span></span></span><span data-slate-object="text" data-key="16286"><span data-slate-leaf="true" data-offset-key="16286:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16287"><span data-slate-object="text" data-key="16288"><span data-slate-leaf="true" data-offset-key="16288:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16289"><span data-slate-leaf="true" data-offset-key="16289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%#+v\n\n"</span></span></span></span><span data-slate-object="text" data-key="16290"><span data-slate-leaf="true" data-offset-key="16290:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16291"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16292"><span data-slate-object="text" data-key="16293"><span data-slate-leaf="true" data-offset-key="16293:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16294"><span data-slate-leaf="true" data-offset-key="16294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// do some business process based on the error type</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16295"><span data-slate-object="text" data-key="16296"><span data-slate-leaf="true" data-offset-key="16296:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16297"><span data-slate-leaf="true" data-offset-key="16297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16298"><span data-slate-leaf="true" data-offset-key="16298:0" data-first-offset="true"><span data-slate-string="true"> errors.IsCode(err, code.ErrEncodingFailed) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16299"><span data-slate-object="text" data-key="16300"><span data-slate-leaf="true" data-offset-key="16300:0" data-first-offset="true"><span data-slate-string="true">      fmt.Println(</span></span></span><span data-slate-object="text" data-key="16301"><span data-slate-leaf="true" data-offset-key="16301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"this is a ErrEncodingFailed error"</span></span></span></span><span data-slate-object="text" data-key="16302"><span data-slate-leaf="true" data-offset-key="16302:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16303"><span data-slate-object="text" data-key="16304"><span data-slate-leaf="true" data-offset-key="16304:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16305"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16306"><span data-slate-object="text" data-key="16307"><span data-slate-leaf="true" data-offset-key="16307:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16308"><span data-slate-leaf="true" data-offset-key="16308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16309"><span data-slate-leaf="true" data-offset-key="16309:0" data-first-offset="true"><span data-slate-string="true"> errors.IsCode(err, code.ErrDatabase) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16310"><span data-slate-object="text" data-key="16311"><span data-slate-leaf="true" data-offset-key="16311:0" data-first-offset="true"><span data-slate-string="true">      fmt.Println(</span></span></span><span data-slate-object="text" data-key="16312"><span data-slate-leaf="true" data-offset-key="16312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"this is a ErrDatabase error"</span></span></span></span><span data-slate-object="text" data-key="16313"><span data-slate-leaf="true" data-offset-key="16313:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16314"><span data-slate-object="text" data-key="16315"><span data-slate-leaf="true" data-offset-key="16315:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16316"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16317"><span data-slate-object="text" data-key="16318"><span data-slate-leaf="true" data-offset-key="16318:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16319"><span data-slate-leaf="true" data-offset-key="16319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// we can also find the cause error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16320"><span data-slate-object="text" data-key="16321"><span data-slate-leaf="true" data-offset-key="16321:0" data-first-offset="true"><span data-slate-string="true">    fmt.Println(errors.Cause(err))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16322"><span data-slate-object="text" data-key="16323"><span data-slate-leaf="true" data-offset-key="16323:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16324"><span data-slate-object="text" data-key="16325"><span data-slate-leaf="true" data-offset-key="16325:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16326"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16327"><span data-slate-object="text" data-key="16328"><span data-slate-leaf="true" data-offset-key="16328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16329"><span data-slate-leaf="true" data-offset-key="16329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16330"><span data-slate-leaf="true" data-offset-key="16330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bindUser</span></span></span></span></span><span data-slate-object="text" data-key="16331"><span data-slate-leaf="true" data-offset-key="16331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16332"><span data-slate-leaf="true" data-offset-key="16332:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16333"><span data-slate-leaf="true" data-offset-key="16333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16334"><span data-slate-leaf="true" data-offset-key="16334:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16335"><span data-slate-object="text" data-key="16336"><span data-slate-leaf="true" data-offset-key="16336:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16337"><span data-slate-leaf="true" data-offset-key="16337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16338"><span data-slate-leaf="true" data-offset-key="16338:0" data-first-offset="true"><span data-slate-string="true"> err := getUser(); err != </span></span></span><span data-slate-object="text" data-key="16339"><span data-slate-leaf="true" data-offset-key="16339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16340"><span data-slate-leaf="true" data-offset-key="16340:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16341"><span data-slate-object="text" data-key="16342"><span data-slate-leaf="true" data-offset-key="16342:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16343"><span data-slate-leaf="true" data-offset-key="16343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Step3: Wrap the error with a new error message and a new error code if needed.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16344"><span data-slate-object="text" data-key="16345"><span data-slate-leaf="true" data-offset-key="16345:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16346"><span data-slate-leaf="true" data-offset-key="16346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16347"><span data-slate-leaf="true" data-offset-key="16347:0" data-first-offset="true"><span data-slate-string="true"> errors.WrapC(err, code.ErrEncodingFailed, </span></span></span><span data-slate-object="text" data-key="16348"><span data-slate-leaf="true" data-offset-key="16348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"encoding user'Lingfei Kong'failed."</span></span></span></span><span data-slate-object="text" data-key="16349"><span data-slate-leaf="true" data-offset-key="16349:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16350"><span data-slate-object="text" data-key="16351"><span data-slate-leaf="true" data-offset-key="16351:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16352"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16353"><span data-slate-object="text" data-key="16354"><span data-slate-leaf="true" data-offset-key="16354:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16355"><span data-slate-leaf="true" data-offset-key="16355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16356"><span data-slate-leaf="true" data-offset-key="16356:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16357"><span data-slate-leaf="true" data-offset-key="16357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16358"><span data-slate-object="text" data-key="16359"><span data-slate-leaf="true" data-offset-key="16359:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16360"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16361"><span data-slate-object="text" data-key="16362"><span data-slate-leaf="true" data-offset-key="16362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16363"><span data-slate-leaf="true" data-offset-key="16363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16364"><span data-slate-leaf="true" data-offset-key="16364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getUser</span></span></span></span></span><span data-slate-object="text" data-key="16365"><span data-slate-leaf="true" data-offset-key="16365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16366"><span data-slate-leaf="true" data-offset-key="16366:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16367"><span data-slate-leaf="true" data-offset-key="16367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16368"><span data-slate-leaf="true" data-offset-key="16368:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16369"><span data-slate-object="text" data-key="16370"><span data-slate-leaf="true" data-offset-key="16370:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16371"><span data-slate-leaf="true" data-offset-key="16371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16372"><span data-slate-leaf="true" data-offset-key="16372:0" data-first-offset="true"><span data-slate-string="true"> err := queryDatabase(); err != </span></span></span><span data-slate-object="text" data-key="16373"><span data-slate-leaf="true" data-offset-key="16373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16374"><span data-slate-leaf="true" data-offset-key="16374:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16375"><span data-slate-object="text" data-key="16376"><span data-slate-leaf="true" data-offset-key="16376:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16377"><span data-slate-leaf="true" data-offset-key="16377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Step2: Wrap the error with a new error message.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16378"><span data-slate-object="text" data-key="16379"><span data-slate-leaf="true" data-offset-key="16379:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16380"><span data-slate-leaf="true" data-offset-key="16380:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16381"><span data-slate-leaf="true" data-offset-key="16381:0" data-first-offset="true"><span data-slate-string="true"> errors.Wrap(err, </span></span></span><span data-slate-object="text" data-key="16382"><span data-slate-leaf="true" data-offset-key="16382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"get user failed."</span></span></span></span><span data-slate-object="text" data-key="16383"><span data-slate-leaf="true" data-offset-key="16383:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16384"><span data-slate-object="text" data-key="16385"><span data-slate-leaf="true" data-offset-key="16385:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16386"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16387"><span data-slate-object="text" data-key="16388"><span data-slate-leaf="true" data-offset-key="16388:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16389"><span data-slate-leaf="true" data-offset-key="16389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16390"><span data-slate-leaf="true" data-offset-key="16390:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16391"><span data-slate-leaf="true" data-offset-key="16391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16392"><span data-slate-object="text" data-key="16393"><span data-slate-leaf="true" data-offset-key="16393:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16394"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16395"><span data-slate-object="text" data-key="16396"><span data-slate-leaf="true" data-offset-key="16396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16397"><span data-slate-leaf="true" data-offset-key="16397:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16398"><span data-slate-leaf="true" data-offset-key="16398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">queryDatabase</span></span></span></span></span><span data-slate-object="text" data-key="16399"><span data-slate-leaf="true" data-offset-key="16399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16400"><span data-slate-leaf="true" data-offset-key="16400:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16401"><span data-slate-leaf="true" data-offset-key="16401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16402"><span data-slate-leaf="true" data-offset-key="16402:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16403"><span data-slate-object="text" data-key="16404"><span data-slate-leaf="true" data-offset-key="16404:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16405"><span data-slate-leaf="true" data-offset-key="16405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Step1. Create error with specified error code.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16406"><span data-slate-object="text" data-key="16407"><span data-slate-leaf="true" data-offset-key="16407:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16408"><span data-slate-leaf="true" data-offset-key="16408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16409"><span data-slate-leaf="true" data-offset-key="16409:0" data-first-offset="true"><span data-slate-string="true"> errors.WithCode(code.ErrDatabase, </span></span></span><span data-slate-object="text" data-key="16410"><span data-slate-leaf="true" data-offset-key="16410:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user'Lingfei Kong'not found."</span></span></span></span><span data-slate-object="text" data-key="16411"><span data-slate-leaf="true" data-offset-key="16411:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16412"><span data-slate-object="text" data-key="16413"><span data-slate-leaf="true" data-offset-key="16413:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16414"><span data-slate-object="text" data-key="16415"><span data-slate-leaf="true" data-offset-key="16415:0" data-first-offset="true"><span data-slate-string="true">上述代码中，通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16416"><span data-slate-object="text" data-key="16417"><span data-slate-leaf="true" data-offset-key="16417:0" data-first-offset="true"><span data-slate-string="true">WithCode</span></span></span></a><span data-slate-object="text" data-key="16418"><span data-slate-leaf="true" data-offset-key="16418:0" data-first-offset="true"><span data-slate-string="true"> 函数来创建新的 withCode 类型的错误；通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16419"><span data-slate-object="text" data-key="16420"><span data-slate-leaf="true" data-offset-key="16420:0" data-first-offset="true"><span data-slate-string="true">WrapC</span></span></span></a><span data-slate-object="text" data-key="16421"><span data-slate-leaf="true" data-offset-key="16421:0" data-first-offset="true"><span data-slate-string="true"> 来将一个 error 封装成一个 withCode 类型的错误；通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16422"><span data-slate-object="text" data-key="16423"><span data-slate-leaf="true" data-offset-key="16423:0" data-first-offset="true"><span data-slate-string="true">IsCode</span></span></span></a><span data-slate-object="text" data-key="16424"><span data-slate-leaf="true" data-offset-key="16424:0" data-first-offset="true"><span data-slate-string="true"> 来判断一个 error 链中是否包含指定的 code。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16425"><span data-slate-object="text" data-key="16426"><span data-slate-leaf="true" data-offset-key="16426:0" data-first-offset="true"><span data-slate-string="true">withCode 错误实现了一个</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16427"><span data-slate-object="text" data-key="16428"><span data-slate-leaf="true" data-offset-key="16428:0" data-first-offset="true"><span data-slate-string="true"> func (w *withCode) Format(state fmt.State, verb rune)</span></span></span></span><span data-slate-object="text" data-key="16429"><span data-slate-leaf="true" data-offset-key="16429:0" data-first-offset="true"><span data-slate-string="true"> 方法，该方法用来打印不同格式的错误信息，见下表：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="16430"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/18/5c/18a93313e017d4f3b21370099d011c5c.png?wh=1755x1198"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16431"><span data-slate-object="text" data-key="16432"><span data-slate-leaf="true" data-offset-key="16432:0" data-first-offset="true"><span data-slate-string="true">例如，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16433"><span data-slate-object="text" data-key="16434"><span data-slate-leaf="true" data-offset-key="16434:0" data-first-offset="true"><span data-slate-string="true">%+v</span></span></span></span><span data-slate-object="text" data-key="16435"><span data-slate-leaf="true" data-offset-key="16435:0" data-first-offset="true"><span data-slate-string="true"> 会打印以下错误信息：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16436"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16437"><span data-slate-object="text" data-key="16438"><span data-slate-leaf="true" data-offset-key="16438:0" data-first-offset="true"><span data-slate-string="true">get user failed. - #</span></span></span><span data-slate-object="text" data-key="16439"><span data-slate-leaf="true" data-offset-key="16439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16440"><span data-slate-leaf="true" data-offset-key="16440:0" data-first-offset="true"><span data-slate-string="true"> [/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/errortrack_errors.</span></span></span><span data-slate-object="text" data-key="16441"><span data-slate-leaf="true" data-offset-key="16441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16442"><span data-slate-leaf="true" data-offset-key="16442:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16443"><span data-slate-leaf="true" data-offset-key="16443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">19</span></span></span></span><span data-slate-object="text" data-key="16444"><span data-slate-leaf="true" data-offset-key="16444:0" data-first-offset="true"><span data-slate-string="true"> (main.getUser)] (</span></span></span><span data-slate-object="text" data-key="16445"><span data-slate-leaf="true" data-offset-key="16445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100101</span></span></span></span><span data-slate-object="text" data-key="16446"><span data-slate-leaf="true" data-offset-key="16446:0" data-first-offset="true"><span data-slate-string="true">) Database </span></span></span><span data-slate-object="text" data-key="16447"><span data-slate-leaf="true" data-offset-key="16447:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16448"><span data-slate-leaf="true" data-offset-key="16448:0" data-first-offset="true"><span data-slate-string="true">; user </span></span></span><span data-slate-object="text" data-key="16449"><span data-slate-leaf="true" data-offset-key="16449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Lingfei Kong'</span></span></span></span><span data-slate-object="text" data-key="16450"><span data-slate-leaf="true" data-offset-key="16450:0" data-first-offset="true"><span data-slate-string="true"> not found. - #</span></span></span><span data-slate-object="text" data-key="16451"><span data-slate-leaf="true" data-offset-key="16451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16452"><span data-slate-leaf="true" data-offset-key="16452:0" data-first-offset="true"><span data-slate-string="true"> [/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/errortrack_errors.</span></span></span><span data-slate-object="text" data-key="16453"><span data-slate-leaf="true" data-offset-key="16453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16454"><span data-slate-leaf="true" data-offset-key="16454:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16455"><span data-slate-leaf="true" data-offset-key="16455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">26</span></span></span></span><span data-slate-object="text" data-key="16456"><span data-slate-leaf="true" data-offset-key="16456:0" data-first-offset="true"><span data-slate-string="true"> (main.queryDatabase)] (</span></span></span><span data-slate-object="text" data-key="16457"><span data-slate-leaf="true" data-offset-key="16457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100101</span></span></span></span><span data-slate-object="text" data-key="16458"><span data-slate-leaf="true" data-offset-key="16458:0" data-first-offset="true"><span data-slate-string="true">) Database </span></span></span><span data-slate-object="text" data-key="16459"><span data-slate-leaf="true" data-offset-key="16459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16460"><span data-slate-object="text" data-key="16461"><span data-slate-leaf="true" data-offset-key="16461:0" data-first-offset="true"><span data-slate-string="true">那么你可能会问，这些错误信息中的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16462"><span data-slate-object="text" data-key="16463"><span data-slate-leaf="true" data-offset-key="16463:0" data-first-offset="true"><span data-slate-string="true"> 100101</span></span></span></span><span data-slate-object="text" data-key="16464"><span data-slate-leaf="true" data-offset-key="16464:0" data-first-offset="true"><span data-slate-string="true"> 错误码，还有</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16465"><span data-slate-object="text" data-key="16466"><span data-slate-leaf="true" data-offset-key="16466:0" data-first-offset="true"><span data-slate-string="true"> Database error</span></span></span></span><span data-slate-object="text" data-key="16467"><span data-slate-leaf="true" data-offset-key="16467:0" data-first-offset="true"><span data-slate-string="true"> 这种对外展示的报错信息等等，是从哪里获取的？这里我简单解释一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16468"><span data-slate-object="text" data-key="16469"><span data-slate-leaf="true" data-offset-key="16469:0" data-first-offset="true"><span data-slate-string="true">首先， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16470"><span data-slate-object="text" data-key="16471"><span data-slate-leaf="true" data-offset-key="16471:0" data-first-offset="true"><span data-slate-string="true">withCode</span></span></span></span><span data-slate-object="text" data-key="16472"><span data-slate-leaf="true" data-offset-key="16472:0" data-first-offset="true"><span data-slate-string="true"> 中包含了 int 类型的错误码，例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16473"><span data-slate-object="text" data-key="16474"><span data-slate-leaf="true" data-offset-key="16474:0" data-first-offset="true"><span data-slate-string="true"> 100101</span></span></span></span><span data-slate-object="text" data-key="16475"><span data-slate-leaf="true" data-offset-key="16475:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16476"><span data-slate-object="text" data-key="16477"><span data-slate-leaf="true" data-offset-key="16477:0" data-first-offset="true"><span data-slate-string="true">其次，当使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16478"><span data-slate-object="text" data-key="16479"><span data-slate-leaf="true" data-offset-key="16479:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16480"><span data-slate-leaf="true" data-offset-key="16480:0" data-first-offset="true"><span data-slate-string="true"> 包的时候，需要调用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16481"><span data-slate-object="text" data-key="16482"><span data-slate-leaf="true" data-offset-key="16482:0" data-first-offset="true"><span data-slate-string="true"> Register</span></span></span></span><span data-slate-object="text" data-key="16483"><span data-slate-leaf="true" data-offset-key="16483:0" data-first-offset="true"><span data-slate-string="true"> 或者</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16484"><span data-slate-object="text" data-key="16485"><span data-slate-leaf="true" data-offset-key="16485:0" data-first-offset="true"><span data-slate-string="true"> MustRegister</span></span></span></span><span data-slate-object="text" data-key="16486"><span data-slate-leaf="true" data-offset-key="16486:0" data-first-offset="true"><span data-slate-string="true">，将一个 Coder 注册到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16487"><span data-slate-object="text" data-key="16488"><span data-slate-leaf="true" data-offset-key="16488:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16489"><span data-slate-leaf="true" data-offset-key="16489:0" data-first-offset="true"><span data-slate-string="true"> 开辟的内存中，数据结构为：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16490"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16491"><span data-slate-object="text" data-key="16492"><span data-slate-leaf="true" data-offset-key="16492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="16493"><span data-slate-leaf="true" data-offset-key="16493:0" data-first-offset="true"><span data-slate-string="true"> codes = </span></span></span><span data-slate-object="text" data-key="16494"><span data-slate-leaf="true" data-offset-key="16494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="16495"><span data-slate-leaf="true" data-offset-key="16495:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="16496"><span data-slate-leaf="true" data-offset-key="16496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="16497"><span data-slate-leaf="true" data-offset-key="16497:0" data-first-offset="true"><span data-slate-string="true">]Coder{}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16498"><span data-slate-object="text" data-key="16499"><span data-slate-leaf="true" data-offset-key="16499:0" data-first-offset="true"><span data-slate-string="true">Coder 是一个接口，定义为：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16500"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16501"><span data-slate-object="text" data-key="16502"><span data-slate-leaf="true" data-offset-key="16502:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="16503"><span data-slate-leaf="true" data-offset-key="16503:0" data-first-offset="true"><span data-slate-string="true"> Coder </span></span></span><span data-slate-object="text" data-key="16504"><span data-slate-leaf="true" data-offset-key="16504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="16505"><span data-slate-leaf="true" data-offset-key="16505:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16506"><span data-slate-object="text" data-key="16507"><span data-slate-leaf="true" data-offset-key="16507:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16508"><span data-slate-leaf="true" data-offset-key="16508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HTTP status that should be used for the associated error code.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16509"><span data-slate-object="text" data-key="16510"><span data-slate-leaf="true" data-offset-key="16510:0" data-first-offset="true"><span data-slate-string="true">    HTTPStatus() </span></span></span><span data-slate-object="text" data-key="16511"><span data-slate-leaf="true" data-offset-key="16511:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16512"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16513"><span data-slate-object="text" data-key="16514"><span data-slate-leaf="true" data-offset-key="16514:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16515"><span data-slate-leaf="true" data-offset-key="16515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// External (user) facing error text.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16516"><span data-slate-object="text" data-key="16517"><span data-slate-leaf="true" data-offset-key="16517:0" data-first-offset="true"><span data-slate-string="true">    String() </span></span></span><span data-slate-object="text" data-key="16518"><span data-slate-leaf="true" data-offset-key="16518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16519"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16520"><span data-slate-object="text" data-key="16521"><span data-slate-leaf="true" data-offset-key="16521:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16522"><span data-slate-leaf="true" data-offset-key="16522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Reference returns the detail documents for user.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16523"><span data-slate-object="text" data-key="16524"><span data-slate-leaf="true" data-offset-key="16524:0" data-first-offset="true"><span data-slate-string="true">    Reference() </span></span></span><span data-slate-object="text" data-key="16525"><span data-slate-leaf="true" data-offset-key="16525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16526"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16527"><span data-slate-object="text" data-key="16528"><span data-slate-leaf="true" data-offset-key="16528:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16529"><span data-slate-leaf="true" data-offset-key="16529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Code returns the code of the coder</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16530"><span data-slate-object="text" data-key="16531"><span data-slate-leaf="true" data-offset-key="16531:0" data-first-offset="true"><span data-slate-string="true">    Code() </span></span></span><span data-slate-object="text" data-key="16532"><span data-slate-leaf="true" data-offset-key="16532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16533"><span data-slate-object="text" data-key="16534"><span data-slate-leaf="true" data-offset-key="16534:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16535"><span data-slate-object="text" data-key="16536"><span data-slate-leaf="true" data-offset-key="16536:0" data-first-offset="true"><span data-slate-string="true">这样 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16537"><span data-slate-object="text" data-key="16538"><span data-slate-leaf="true" data-offset-key="16538:0" data-first-offset="true"><span data-slate-string="true">withCode</span></span></span></span><span data-slate-object="text" data-key="16539"><span data-slate-leaf="true" data-offset-key="16539:0" data-first-offset="true"><span data-slate-string="true"> 的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16540"><span data-slate-object="text" data-key="16541"><span data-slate-leaf="true" data-offset-key="16541:0" data-first-offset="true"><span data-slate-string="true"> Format</span></span></span></span><span data-slate-object="text" data-key="16542"><span data-slate-leaf="true" data-offset-key="16542:0" data-first-offset="true"><span data-slate-string="true"> 方法，就能够通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16543"><span data-slate-object="text" data-key="16544"><span data-slate-leaf="true" data-offset-key="16544:0" data-first-offset="true"><span data-slate-string="true">withCode</span></span></span></span><span data-slate-object="text" data-key="16545"><span data-slate-leaf="true" data-offset-key="16545:0" data-first-offset="true"><span data-slate-string="true"> 中的 code 字段获取到对应的 Coder，并通过 Coder 提供的 HTTPStatus、String、Reference、Code 函数，来获取 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16546"><span data-slate-object="text" data-key="16547"><span data-slate-leaf="true" data-offset-key="16547:0" data-first-offset="true"><span data-slate-string="true">withCode</span></span></span></span><span data-slate-object="text" data-key="16548"><span data-slate-leaf="true" data-offset-key="16548:0" data-first-offset="true"><span data-slate-string="true"> 中 code 的详细信息，最后格式化打印。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16549"><span data-slate-object="text" data-key="16550"><span data-slate-leaf="true" data-offset-key="16550:0" data-first-offset="true"><span data-slate-string="true">这里要注意，我们实现了两个注册函数：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16551"><span data-slate-object="text" data-key="16552"><span data-slate-leaf="true" data-offset-key="16552:0" data-first-offset="true"><span data-slate-string="true">Register</span></span></span></span><span data-slate-object="text" data-key="16553"><span data-slate-leaf="true" data-offset-key="16553:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16554"><span data-slate-object="text" data-key="16555"><span data-slate-leaf="true" data-offset-key="16555:0" data-first-offset="true"><span data-slate-string="true"> MustRegister</span></span></span></span><span data-slate-object="text" data-key="16556"><span data-slate-leaf="true" data-offset-key="16556:0" data-first-offset="true"><span data-slate-string="true">，二者唯一区别是：当重复定义同一个错误 Code 时，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16557"><span data-slate-object="text" data-key="16558"><span data-slate-leaf="true" data-offset-key="16558:0" data-first-offset="true"><span data-slate-string="true">MustRegister</span></span></span></span><span data-slate-object="text" data-key="16559"><span data-slate-leaf="true" data-offset-key="16559:0" data-first-offset="true"><span data-slate-string="true"> 会 panic，这样可以防止后面注册的错误覆盖掉之前注册的错误。在实际开发中，建议使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16560"><span data-slate-object="text" data-key="16561"><span data-slate-leaf="true" data-offset-key="16561:0" data-first-offset="true"><span data-slate-string="true"> MustRegister</span></span></span></span><span data-slate-object="text" data-key="16562"><span data-slate-leaf="true" data-offset-key="16562:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16563"><span data-slate-type="code" data-slate-object="inline" data-key="16564"><span data-slate-object="text" data-key="16565"><span data-slate-leaf="true" data-offset-key="16565:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">XXX()</span></span></span></span></span><span data-slate-object="text" data-key="16566"><span data-slate-leaf="true" data-offset-key="16566:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 和</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16567"><span data-slate-object="text" data-key="16568"><span data-slate-leaf="true" data-offset-key="16568:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> MustXXX()</span></span></span></span></span><span data-slate-object="text" data-key="16569"><span data-slate-leaf="true" data-offset-key="16569:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 的函数命名方式，是一种 Go 代码设计技巧，在 Go 代码中经常使用，例如 Go 标准库中</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16570"><span data-slate-object="text" data-key="16571"><span data-slate-leaf="true" data-offset-key="16571:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> regexp</span></span></span></span></span><span data-slate-object="text" data-key="16572"><span data-slate-leaf="true" data-offset-key="16572:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 包提供的</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16573"><span data-slate-object="text" data-key="16574"><span data-slate-leaf="true" data-offset-key="16574:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> Compile</span></span></span></span></span><span data-slate-object="text" data-key="16575"><span data-slate-leaf="true" data-offset-key="16575:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 和</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16576"><span data-slate-object="text" data-key="16577"><span data-slate-leaf="true" data-offset-key="16577:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> MustCompile</span></span></span></span></span><span data-slate-object="text" data-key="16578"><span data-slate-leaf="true" data-offset-key="16578:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 函数。和</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16579"><span data-slate-object="text" data-key="16580"><span data-slate-leaf="true" data-offset-key="16580:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> XXX</span></span></span></span></span><span data-slate-object="text" data-key="16581"><span data-slate-leaf="true" data-offset-key="16581:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 相比，</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16582"><span data-slate-object="text" data-key="16583"><span data-slate-leaf="true" data-offset-key="16583:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">MustXXX</span></span></span></span></span><span data-slate-object="text" data-key="16584"><span data-slate-leaf="true" data-offset-key="16584:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 会在某种情况不满足时 panic。因此使用</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16585"><span data-slate-object="text" data-key="16586"><span data-slate-leaf="true" data-offset-key="16586:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> MustXXX</span></span></span></span></span><span data-slate-object="text" data-key="16587"><span data-slate-leaf="true" data-offset-key="16587:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5a09d5c6" data-attr-id="36824" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 的开发者看到函数名就会有一个心理预期：使用不当，会造成程序 panic。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16588"><span data-slate-object="text" data-key="16589"><span data-slate-leaf="true" data-offset-key="16589:0" data-first-offset="true"><span data-slate-string="true">最后，我还有一个建议：在实际的生产环境中，我们可以使用 JSON 格式打印日志，JSON 格式的日志可以非常方便的供日志系统解析。我们可以根据需要，选择</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16590"><span data-slate-object="text" data-key="16591"><span data-slate-leaf="true" data-offset-key="16591:0" data-first-offset="true"><span data-slate-string="true"> %#-v</span></span></span></span><span data-slate-object="text" data-key="16592"><span data-slate-leaf="true" data-offset-key="16592:0" data-first-offset="true"><span data-slate-string="true"> 或</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16593"><span data-slate-object="text" data-key="16594"><span data-slate-leaf="true" data-offset-key="16594:0" data-first-offset="true"><span data-slate-string="true"> %#+v</span></span></span></span><span data-slate-object="text" data-key="16595"><span data-slate-leaf="true" data-offset-key="16595:0" data-first-offset="true"><span data-slate-string="true"> 两种格式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16596"><span data-slate-object="text" data-key="16597"><span data-slate-leaf="true" data-offset-key="16597:0" data-first-offset="true"><span data-slate-string="true">错误包在代码中，经常被调用，所以我们要保证错误包一定要是高性能的，否则很可能会影响接口的性能。这里，我们再来看下</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16598"><span data-slate-object="text" data-key="16599"><span data-slate-leaf="true" data-offset-key="16599:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16600"><span data-slate-leaf="true" data-offset-key="16600:0" data-first-offset="true"><span data-slate-string="true"> 包的性能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16601"><span data-slate-object="text" data-key="16602"><span data-slate-leaf="true" data-offset-key="16602:0" data-first-offset="true"><span data-slate-string="true">在这里，我们把这个错误包跟 go 标准库的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16603"><span data-slate-object="text" data-key="16604"><span data-slate-leaf="true" data-offset-key="16604:0" data-first-offset="true"><span data-slate-string="true">errors</span></span></span></span><span data-slate-object="text" data-key="16605"><span data-slate-leaf="true" data-offset-key="16605:0" data-first-offset="true"><span data-slate-string="true"> 包，以及 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16606"><span data-slate-object="text" data-key="16607"><span data-slate-leaf="true" data-offset-key="16607:0" data-first-offset="true"><span data-slate-string="true">github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="16608"><span data-slate-leaf="true" data-offset-key="16608:0" data-first-offset="true"><span data-slate-string="true"> 包进行对比，来看看它们的性能：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="16609"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16610"><span data-slate-object="text" data-key="16611"><span data-slate-leaf="true" data-offset-key="16611:0" data-first-offset="true"><span data-slate-string="true">$  go </span></span></span><span data-slate-object="text" data-key="16612"><span data-slate-leaf="true" data-offset-key="16612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">test</span></span></span></span><span data-slate-object="text" data-key="16613"><span data-slate-leaf="true" data-offset-key="16613:0" data-first-offset="true"><span data-slate-string="true"> -test.bench=BenchmarkErrors -benchtime=</span></span></span><span data-slate-object="text" data-key="16614"><span data-slate-leaf="true" data-offset-key="16614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"3s"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16615"><span data-slate-object="text" data-key="16616"><span data-slate-leaf="true" data-offset-key="16616:0" data-first-offset="true"><span data-slate-string="true">goos: linux</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16617"><span data-slate-object="text" data-key="16618"><span data-slate-leaf="true" data-offset-key="16618:0" data-first-offset="true"><span data-slate-string="true">goarch: amd64</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16619"><span data-slate-object="text" data-key="16620"><span data-slate-leaf="true" data-offset-key="16620:0" data-first-offset="true"><span data-slate-string="true">pkg: github.com/marmotedu/errors</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16621"><span data-slate-object="text" data-key="16622"><span data-slate-leaf="true" data-offset-key="16622:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/errors-stack-10-8           57658672          61.8 ns/op        16 B/op         1 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16623"><span data-slate-object="text" data-key="16624"><span data-slate-leaf="true" data-offset-key="16624:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/pkg/errors-stack-10-8        2265558        1547 ns/op       320 B/op         3 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16625"><span data-slate-object="text" data-key="16626"><span data-slate-leaf="true" data-offset-key="16626:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/marmot/errors-stack-10-8     1903532        1772 ns/op       360 B/op         5 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16627"><span data-slate-object="text" data-key="16628"><span data-slate-leaf="true" data-offset-key="16628:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/errors-stack-100-8           4883659         734 ns/op        16 B/op         1 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16629"><span data-slate-object="text" data-key="16630"><span data-slate-leaf="true" data-offset-key="16630:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/pkg/errors-stack-100-8       1202797        2881 ns/op       320 B/op         3 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16631"><span data-slate-object="text" data-key="16632"><span data-slate-leaf="true" data-offset-key="16632:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/marmot/errors-stack-100-8    1000000        3116 ns/op       360 B/op         5 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16633"><span data-slate-object="text" data-key="16634"><span data-slate-leaf="true" data-offset-key="16634:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/errors-stack-1000-8           505636        7159 ns/op        16 B/op         1 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16635"><span data-slate-object="text" data-key="16636"><span data-slate-leaf="true" data-offset-key="16636:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/pkg/errors-stack-1000-8       327681       10646 ns/op       320 B/op         3 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16637"><span data-slate-object="text" data-key="16638"><span data-slate-leaf="true" data-offset-key="16638:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors/marmot/errors-stack-1000-8             304160       11896 ns/op       360 B/op         5 allocs/op</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16639"><span data-slate-object="text" data-key="16640"><span data-slate-leaf="true" data-offset-key="16640:0" data-first-offset="true"><span data-slate-string="true">PASS</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16641"><span data-slate-object="text" data-key="16642"><span data-slate-leaf="true" data-offset-key="16642:0" data-first-offset="true"><span data-slate-string="true">ok    github.com/marmotedu/errors  39.200s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16643"><span data-slate-object="text" data-key="16644"><span data-slate-leaf="true" data-offset-key="16644:0" data-first-offset="true"><span data-slate-string="true">可以看到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16645"><span data-slate-object="text" data-key="16646"><span data-slate-leaf="true" data-offset-key="16646:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16647"><span data-slate-leaf="true" data-offset-key="16647:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16648"><span data-slate-object="text" data-key="16649"><span data-slate-leaf="true" data-offset-key="16649:0" data-first-offset="true"><span data-slate-string="true"> github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="16650"><span data-slate-leaf="true" data-offset-key="16650:0" data-first-offset="true"><span data-slate-string="true"> 包的性能基本持平。在对比性能时，重点关注 </span></span></span><span data-slate-object="text" data-key="16651"><span data-slate-leaf="true" data-offset-key="16651:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">ns/op</span></span></span></span><span data-slate-object="text" data-key="16652"><span data-slate-leaf="true" data-offset-key="16652:0" data-first-offset="true"><span data-slate-string="true">，也即每次 error 操作耗费的纳秒数。另外，我们还需要测试不同 error 嵌套深度下的 error 操作性能，嵌套越深，性能越差。例如：在嵌套深度为 10 的时候， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16653"><span data-slate-object="text" data-key="16654"><span data-slate-leaf="true" data-offset-key="16654:0" data-first-offset="true"><span data-slate-string="true">github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="16655"><span data-slate-leaf="true" data-offset-key="16655:0" data-first-offset="true"><span data-slate-string="true"> 包 ns/op 值为 1547， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16656"><span data-slate-object="text" data-key="16657"><span data-slate-leaf="true" data-offset-key="16657:0" data-first-offset="true"><span data-slate-string="true">github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16658"><span data-slate-leaf="true" data-offset-key="16658:0" data-first-offset="true"><span data-slate-string="true"> 包 ns/op 值为 1772。可以看到，二者性能基本保持一致。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16659"><span data-slate-object="text" data-key="16660"><span data-slate-leaf="true" data-offset-key="16660:0" data-first-offset="true"><span data-slate-string="true">具体性能数据对比见下表：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="16661"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a6/5e/a6a794d7523bc1edfa459d3a49f9685e.png?wh=1737x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16662"><span data-slate-object="text" data-key="16663"><span data-slate-leaf="true" data-offset-key="16663:0" data-first-offset="true"><span data-slate-string="true">我们是通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16664"><span data-slate-object="text" data-key="16665"><span data-slate-leaf="true" data-offset-key="16665:0" data-first-offset="true"><span data-slate-string="true">BenchmarkErrors</span></span></span></a><span data-slate-object="text" data-key="16666"><span data-slate-leaf="true" data-offset-key="16666:0" data-first-offset="true"><span data-slate-string="true"> 测试函数来测试 error 包性能的，你感兴趣可以打开链接看看。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="16667" id="sr-toc-3"><span data-slate-object="text" data-key="16668"><span data-slate-leaf="true" data-offset-key="16668:0" data-first-offset="true"><span data-slate-string="true">如何记录错误？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="16669"><span data-slate-object="text" data-key="16670"><span data-slate-leaf="true" data-offset-key="16670:0" data-first-offset="true"><span data-slate-string="true">上面，我们一起看了怎么设计一个优秀的错误包，那如何用我们设计的错误包来记录错误呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16671"><span data-slate-object="text" data-key="16672"><span data-slate-leaf="true" data-offset-key="16672:0" data-first-offset="true"><span data-slate-string="true">根据我的开发经验，我推荐两种记录错误的方式，可以帮你快速定位问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16673"><span data-slate-object="text" data-key="16674"><span data-slate-leaf="true" data-offset-key="16674:0" data-first-offset="true"><span data-slate-string="true">方式一：通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16675"><span data-slate-object="text" data-key="16676"><span data-slate-leaf="true" data-offset-key="16676:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16677"><span data-slate-leaf="true" data-offset-key="16677:0" data-first-offset="true"><span data-slate-string="true"> 包提供的错误堆栈能力，来跟踪错误。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16678"><span data-slate-object="text" data-key="16679"><span data-slate-leaf="true" data-offset-key="16679:0" data-first-offset="true"><span data-slate-string="true">具体你可以看看下面的代码示例。以下代码保存在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16680"><span data-slate-object="text" data-key="16681"><span data-slate-leaf="true" data-offset-key="16681:0" data-first-offset="true"><span data-slate-string="true">errortrack_errors.go</span></span></span></a><span data-slate-object="text" data-key="16682"><span data-slate-leaf="true" data-offset-key="16682:0" data-first-offset="true"><span data-slate-string="true"> 中。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16683"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16684"><span data-slate-object="text" data-key="16685"><span data-slate-leaf="true" data-offset-key="16685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="16686"><span data-slate-leaf="true" data-offset-key="16686:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16687"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16688"><span data-slate-object="text" data-key="16689"><span data-slate-leaf="true" data-offset-key="16689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="16690"><span data-slate-leaf="true" data-offset-key="16690:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16691"><span data-slate-object="text" data-key="16692"><span data-slate-leaf="true" data-offset-key="16692:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16693"><span data-slate-leaf="true" data-offset-key="16693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16694"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16695"><span data-slate-object="text" data-key="16696"><span data-slate-leaf="true" data-offset-key="16696:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16697"><span data-slate-leaf="true" data-offset-key="16697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/errors"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16698"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16699"><span data-slate-object="text" data-key="16700"><span data-slate-leaf="true" data-offset-key="16700:0" data-first-offset="true"><span data-slate-string="true">  code </span></span></span><span data-slate-object="text" data-key="16701"><span data-slate-leaf="true" data-offset-key="16701:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/sample-code"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16702"><span data-slate-object="text" data-key="16703"><span data-slate-leaf="true" data-offset-key="16703:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16704"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16705"><span data-slate-object="text" data-key="16706"><span data-slate-leaf="true" data-offset-key="16706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16707"><span data-slate-leaf="true" data-offset-key="16707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16708"><span data-slate-leaf="true" data-offset-key="16708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="16709"><span data-slate-leaf="true" data-offset-key="16709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16710"><span data-slate-leaf="true" data-offset-key="16710:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16711"><span data-slate-object="text" data-key="16712"><span data-slate-leaf="true" data-offset-key="16712:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16713"><span data-slate-leaf="true" data-offset-key="16713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16714"><span data-slate-leaf="true" data-offset-key="16714:0" data-first-offset="true"><span data-slate-string="true"> err := getUser(); err != </span></span></span><span data-slate-object="text" data-key="16715"><span data-slate-leaf="true" data-offset-key="16715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16716"><span data-slate-leaf="true" data-offset-key="16716:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16717"><span data-slate-object="text" data-key="16718"><span data-slate-leaf="true" data-offset-key="16718:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16719"><span data-slate-leaf="true" data-offset-key="16719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%+v\n"</span></span></span></span><span data-slate-object="text" data-key="16720"><span data-slate-leaf="true" data-offset-key="16720:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16721"><span data-slate-object="text" data-key="16722"><span data-slate-leaf="true" data-offset-key="16722:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16723"><span data-slate-object="text" data-key="16724"><span data-slate-leaf="true" data-offset-key="16724:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16725"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16726"><span data-slate-object="text" data-key="16727"><span data-slate-leaf="true" data-offset-key="16727:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16728"><span data-slate-leaf="true" data-offset-key="16728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16729"><span data-slate-leaf="true" data-offset-key="16729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getUser</span></span></span></span></span><span data-slate-object="text" data-key="16730"><span data-slate-leaf="true" data-offset-key="16730:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16731"><span data-slate-leaf="true" data-offset-key="16731:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16732"><span data-slate-leaf="true" data-offset-key="16732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16733"><span data-slate-leaf="true" data-offset-key="16733:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16734"><span data-slate-object="text" data-key="16735"><span data-slate-leaf="true" data-offset-key="16735:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16736"><span data-slate-leaf="true" data-offset-key="16736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16737"><span data-slate-leaf="true" data-offset-key="16737:0" data-first-offset="true"><span data-slate-string="true"> err := queryDatabase(); err != </span></span></span><span data-slate-object="text" data-key="16738"><span data-slate-leaf="true" data-offset-key="16738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16739"><span data-slate-leaf="true" data-offset-key="16739:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16740"><span data-slate-object="text" data-key="16741"><span data-slate-leaf="true" data-offset-key="16741:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16742"><span data-slate-leaf="true" data-offset-key="16742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16743"><span data-slate-leaf="true" data-offset-key="16743:0" data-first-offset="true"><span data-slate-string="true"> errors.Wrap(err, </span></span></span><span data-slate-object="text" data-key="16744"><span data-slate-leaf="true" data-offset-key="16744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"get user failed."</span></span></span></span><span data-slate-object="text" data-key="16745"><span data-slate-leaf="true" data-offset-key="16745:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16746"><span data-slate-object="text" data-key="16747"><span data-slate-leaf="true" data-offset-key="16747:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16748"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16749"><span data-slate-object="text" data-key="16750"><span data-slate-leaf="true" data-offset-key="16750:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16751"><span data-slate-leaf="true" data-offset-key="16751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16752"><span data-slate-leaf="true" data-offset-key="16752:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16753"><span data-slate-leaf="true" data-offset-key="16753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16754"><span data-slate-object="text" data-key="16755"><span data-slate-leaf="true" data-offset-key="16755:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16756"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16757"><span data-slate-object="text" data-key="16758"><span data-slate-leaf="true" data-offset-key="16758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16759"><span data-slate-leaf="true" data-offset-key="16759:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16760"><span data-slate-leaf="true" data-offset-key="16760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">queryDatabase</span></span></span></span></span><span data-slate-object="text" data-key="16761"><span data-slate-leaf="true" data-offset-key="16761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16762"><span data-slate-leaf="true" data-offset-key="16762:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16763"><span data-slate-leaf="true" data-offset-key="16763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16764"><span data-slate-leaf="true" data-offset-key="16764:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16765"><span data-slate-object="text" data-key="16766"><span data-slate-leaf="true" data-offset-key="16766:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16767"><span data-slate-leaf="true" data-offset-key="16767:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16768"><span data-slate-leaf="true" data-offset-key="16768:0" data-first-offset="true"><span data-slate-string="true"> errors.WithCode(code.ErrDatabase, </span></span></span><span data-slate-object="text" data-key="16769"><span data-slate-leaf="true" data-offset-key="16769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user'Lingfei Kong'not found."</span></span></span></span><span data-slate-object="text" data-key="16770"><span data-slate-leaf="true" data-offset-key="16770:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16771"><span data-slate-object="text" data-key="16772"><span data-slate-leaf="true" data-offset-key="16772:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16773"><span data-slate-object="text" data-key="16774"><span data-slate-leaf="true" data-offset-key="16774:0" data-first-offset="true"><span data-slate-string="true">执行上述的代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16775"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16776"><span data-slate-object="text" data-key="16777"><span data-slate-leaf="true" data-offset-key="16777:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="16778"><span data-slate-leaf="true" data-offset-key="16778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16779"><span data-slate-leaf="true" data-offset-key="16779:0" data-first-offset="true"><span data-slate-string="true"> run errortrack_errors.</span></span></span><span data-slate-object="text" data-key="16780"><span data-slate-leaf="true" data-offset-key="16780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16781"><span data-slate-object="text" data-key="16782"><span data-slate-leaf="true" data-offset-key="16782:0" data-first-offset="true"><span data-slate-string="true">get user failed. - #</span></span></span><span data-slate-object="text" data-key="16783"><span data-slate-leaf="true" data-offset-key="16783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16784"><span data-slate-leaf="true" data-offset-key="16784:0" data-first-offset="true"><span data-slate-string="true"> [/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/errortrack_errors.</span></span></span><span data-slate-object="text" data-key="16785"><span data-slate-leaf="true" data-offset-key="16785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16786"><span data-slate-leaf="true" data-offset-key="16786:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16787"><span data-slate-leaf="true" data-offset-key="16787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">19</span></span></span></span><span data-slate-object="text" data-key="16788"><span data-slate-leaf="true" data-offset-key="16788:0" data-first-offset="true"><span data-slate-string="true"> (main.getUser)] (</span></span></span><span data-slate-object="text" data-key="16789"><span data-slate-leaf="true" data-offset-key="16789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100101</span></span></span></span><span data-slate-object="text" data-key="16790"><span data-slate-leaf="true" data-offset-key="16790:0" data-first-offset="true"><span data-slate-string="true">) Database </span></span></span><span data-slate-object="text" data-key="16791"><span data-slate-leaf="true" data-offset-key="16791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16792"><span data-slate-leaf="true" data-offset-key="16792:0" data-first-offset="true"><span data-slate-string="true">; user </span></span></span><span data-slate-object="text" data-key="16793"><span data-slate-leaf="true" data-offset-key="16793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Lingfei Kong'</span></span></span></span><span data-slate-object="text" data-key="16794"><span data-slate-leaf="true" data-offset-key="16794:0" data-first-offset="true"><span data-slate-string="true"> not found. - #</span></span></span><span data-slate-object="text" data-key="16795"><span data-slate-leaf="true" data-offset-key="16795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16796"><span data-slate-leaf="true" data-offset-key="16796:0" data-first-offset="true"><span data-slate-string="true"> [/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/errors/errortrack_errors.</span></span></span><span data-slate-object="text" data-key="16797"><span data-slate-leaf="true" data-offset-key="16797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16798"><span data-slate-leaf="true" data-offset-key="16798:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16799"><span data-slate-leaf="true" data-offset-key="16799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">26</span></span></span></span><span data-slate-object="text" data-key="16800"><span data-slate-leaf="true" data-offset-key="16800:0" data-first-offset="true"><span data-slate-string="true"> (main.queryDatabase)] (</span></span></span><span data-slate-object="text" data-key="16801"><span data-slate-leaf="true" data-offset-key="16801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100101</span></span></span></span><span data-slate-object="text" data-key="16802"><span data-slate-leaf="true" data-offset-key="16802:0" data-first-offset="true"><span data-slate-string="true">) Database </span></span></span><span data-slate-object="text" data-key="16803"><span data-slate-leaf="true" data-offset-key="16803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16804"><span data-slate-object="text" data-key="16805"><span data-slate-leaf="true" data-offset-key="16805:0" data-first-offset="true"><span data-slate-string="true">可以看到，打印的日志中打印出了详细的错误堆栈，包括错误发生的函数、文件名、行号和错误信息，通过这些错误堆栈，我们可以很方便地定位问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16806"><span data-slate-object="text" data-key="16807"><span data-slate-leaf="true" data-offset-key="16807:0" data-first-offset="true"><span data-slate-string="true">你使用这种方法时，我推荐的用法是，在错误最开始处使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16808"><span data-slate-object="text" data-key="16809"><span data-slate-leaf="true" data-offset-key="16809:0" data-first-offset="true"><span data-slate-string="true">errors.WithCode()</span></span></span></span><span data-slate-object="text" data-key="16810"><span data-slate-leaf="true" data-offset-key="16810:0" data-first-offset="true"><span data-slate-string="true"> 创建一个 withCode 类型的错误。上层在处理底层返回的错误时，可以根据需要，使用 Wrap 函数基于该错误封装新的错误信息。如果要包装的 error 不是用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16811"><span data-slate-object="text" data-key="16812"><span data-slate-leaf="true" data-offset-key="16812:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="16813"><span data-slate-leaf="true" data-offset-key="16813:0" data-first-offset="true"><span data-slate-string="true"> 包创建的，建议用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="16814"><span data-slate-object="text" data-key="16815"><span data-slate-leaf="true" data-offset-key="16815:0" data-first-offset="true"><span data-slate-string="true">errors.WithCode()</span></span></span></span><span data-slate-object="text" data-key="16816"><span data-slate-leaf="true" data-offset-key="16816:0" data-first-offset="true"><span data-slate-string="true"> 新建一个 error。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16817"><span data-slate-object="text" data-key="16818"><span data-slate-leaf="true" data-offset-key="16818:0" data-first-offset="true"><span data-slate-string="true">方式二：在错误产生的最原始位置调用日志包记录函数，打印错误信息，其他位置直接返回（当然，也可以选择性的追加一些错误信息，方便故障定位）。示例代码（保存在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="16819"><span data-slate-object="text" data-key="16820"><span data-slate-leaf="true" data-offset-key="16820:0" data-first-offset="true"><span data-slate-string="true">errortrack_log.go</span></span></span></a><span data-slate-object="text" data-key="16821"><span data-slate-leaf="true" data-offset-key="16821:0" data-first-offset="true"><span data-slate-string="true">）如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16822"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16823"><span data-slate-object="text" data-key="16824"><span data-slate-leaf="true" data-offset-key="16824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="16825"><span data-slate-leaf="true" data-offset-key="16825:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16826"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16827"><span data-slate-object="text" data-key="16828"><span data-slate-leaf="true" data-offset-key="16828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="16829"><span data-slate-leaf="true" data-offset-key="16829:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16830"><span data-slate-object="text" data-key="16831"><span data-slate-leaf="true" data-offset-key="16831:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16832"><span data-slate-leaf="true" data-offset-key="16832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16833"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16834"><span data-slate-object="text" data-key="16835"><span data-slate-leaf="true" data-offset-key="16835:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16836"><span data-slate-leaf="true" data-offset-key="16836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/errors"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16837"><span data-slate-object="text" data-key="16838"><span data-slate-leaf="true" data-offset-key="16838:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16839"><span data-slate-leaf="true" data-offset-key="16839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16840"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16841"><span data-slate-object="text" data-key="16842"><span data-slate-leaf="true" data-offset-key="16842:0" data-first-offset="true"><span data-slate-string="true">  code </span></span></span><span data-slate-object="text" data-key="16843"><span data-slate-leaf="true" data-offset-key="16843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/marmotedu/sample-code"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16844"><span data-slate-object="text" data-key="16845"><span data-slate-leaf="true" data-offset-key="16845:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16846"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16847"><span data-slate-object="text" data-key="16848"><span data-slate-leaf="true" data-offset-key="16848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16849"><span data-slate-leaf="true" data-offset-key="16849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16850"><span data-slate-leaf="true" data-offset-key="16850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="16851"><span data-slate-leaf="true" data-offset-key="16851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16852"><span data-slate-leaf="true" data-offset-key="16852:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16853"><span data-slate-object="text" data-key="16854"><span data-slate-leaf="true" data-offset-key="16854:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16855"><span data-slate-leaf="true" data-offset-key="16855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16856"><span data-slate-leaf="true" data-offset-key="16856:0" data-first-offset="true"><span data-slate-string="true"> err := getUser(); err != </span></span></span><span data-slate-object="text" data-key="16857"><span data-slate-leaf="true" data-offset-key="16857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16858"><span data-slate-leaf="true" data-offset-key="16858:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16859"><span data-slate-object="text" data-key="16860"><span data-slate-leaf="true" data-offset-key="16860:0" data-first-offset="true"><span data-slate-string="true">    fmt.Printf(</span></span></span><span data-slate-object="text" data-key="16861"><span data-slate-leaf="true" data-offset-key="16861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%v\n"</span></span></span></span><span data-slate-object="text" data-key="16862"><span data-slate-leaf="true" data-offset-key="16862:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16863"><span data-slate-object="text" data-key="16864"><span data-slate-leaf="true" data-offset-key="16864:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16865"><span data-slate-object="text" data-key="16866"><span data-slate-leaf="true" data-offset-key="16866:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16867"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16868"><span data-slate-object="text" data-key="16869"><span data-slate-leaf="true" data-offset-key="16869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16870"><span data-slate-leaf="true" data-offset-key="16870:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16871"><span data-slate-leaf="true" data-offset-key="16871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getUser</span></span></span></span></span><span data-slate-object="text" data-key="16872"><span data-slate-leaf="true" data-offset-key="16872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16873"><span data-slate-leaf="true" data-offset-key="16873:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16874"><span data-slate-leaf="true" data-offset-key="16874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16875"><span data-slate-leaf="true" data-offset-key="16875:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16876"><span data-slate-object="text" data-key="16877"><span data-slate-leaf="true" data-offset-key="16877:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16878"><span data-slate-leaf="true" data-offset-key="16878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16879"><span data-slate-leaf="true" data-offset-key="16879:0" data-first-offset="true"><span data-slate-string="true"> err := queryDatabase(); err != </span></span></span><span data-slate-object="text" data-key="16880"><span data-slate-leaf="true" data-offset-key="16880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16881"><span data-slate-leaf="true" data-offset-key="16881:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16882"><span data-slate-object="text" data-key="16883"><span data-slate-leaf="true" data-offset-key="16883:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16884"><span data-slate-leaf="true" data-offset-key="16884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16885"><span data-slate-leaf="true" data-offset-key="16885:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16886"><span data-slate-object="text" data-key="16887"><span data-slate-leaf="true" data-offset-key="16887:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16888"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16889"><span data-slate-object="text" data-key="16890"><span data-slate-leaf="true" data-offset-key="16890:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16891"><span data-slate-leaf="true" data-offset-key="16891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16892"><span data-slate-leaf="true" data-offset-key="16892:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16893"><span data-slate-leaf="true" data-offset-key="16893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16894"><span data-slate-object="text" data-key="16895"><span data-slate-leaf="true" data-offset-key="16895:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16896"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16897"><span data-slate-object="text" data-key="16898"><span data-slate-leaf="true" data-offset-key="16898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="16899"><span data-slate-leaf="true" data-offset-key="16899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16900"><span data-slate-leaf="true" data-offset-key="16900:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">queryDatabase</span></span></span></span></span><span data-slate-object="text" data-key="16901"><span data-slate-leaf="true" data-offset-key="16901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="16902"><span data-slate-leaf="true" data-offset-key="16902:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16903"><span data-slate-leaf="true" data-offset-key="16903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="16904"><span data-slate-leaf="true" data-offset-key="16904:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16905"><span data-slate-object="text" data-key="16906"><span data-slate-leaf="true" data-offset-key="16906:0" data-first-offset="true"><span data-slate-string="true">  opts := &amp;log.Options{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16907"><span data-slate-object="text" data-key="16908"><span data-slate-leaf="true" data-offset-key="16908:0" data-first-offset="true"><span data-slate-string="true">    Level:            </span></span></span><span data-slate-object="text" data-key="16909"><span data-slate-leaf="true" data-offset-key="16909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"info"</span></span></span></span><span data-slate-object="text" data-key="16910"><span data-slate-leaf="true" data-offset-key="16910:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16911"><span data-slate-object="text" data-key="16912"><span data-slate-leaf="true" data-offset-key="16912:0" data-first-offset="true"><span data-slate-string="true">    Format:           </span></span></span><span data-slate-object="text" data-key="16913"><span data-slate-leaf="true" data-offset-key="16913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"console"</span></span></span></span><span data-slate-object="text" data-key="16914"><span data-slate-leaf="true" data-offset-key="16914:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16915"><span data-slate-object="text" data-key="16916"><span data-slate-leaf="true" data-offset-key="16916:0" data-first-offset="true"><span data-slate-string="true">    EnableColor:      </span></span></span><span data-slate-object="text" data-key="16917"><span data-slate-leaf="true" data-offset-key="16917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="16918"><span data-slate-leaf="true" data-offset-key="16918:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16919"><span data-slate-object="text" data-key="16920"><span data-slate-leaf="true" data-offset-key="16920:0" data-first-offset="true"><span data-slate-string="true">    EnableCaller:     </span></span></span><span data-slate-object="text" data-key="16921"><span data-slate-leaf="true" data-offset-key="16921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="16922"><span data-slate-leaf="true" data-offset-key="16922:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16923"><span data-slate-object="text" data-key="16924"><span data-slate-leaf="true" data-offset-key="16924:0" data-first-offset="true"><span data-slate-string="true">    OutputPaths:      []</span></span></span><span data-slate-object="text" data-key="16925"><span data-slate-leaf="true" data-offset-key="16925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="16926"><span data-slate-leaf="true" data-offset-key="16926:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="16927"><span data-slate-leaf="true" data-offset-key="16927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"test.log"</span></span></span></span><span data-slate-object="text" data-key="16928"><span data-slate-leaf="true" data-offset-key="16928:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="16929"><span data-slate-leaf="true" data-offset-key="16929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"stdout"</span></span></span></span><span data-slate-object="text" data-key="16930"><span data-slate-leaf="true" data-offset-key="16930:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16931"><span data-slate-object="text" data-key="16932"><span data-slate-leaf="true" data-offset-key="16932:0" data-first-offset="true"><span data-slate-string="true">    ErrorOutputPaths: []</span></span></span><span data-slate-object="text" data-key="16933"><span data-slate-leaf="true" data-offset-key="16933:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="16934"><span data-slate-leaf="true" data-offset-key="16934:0" data-first-offset="true"><span data-slate-string="true">{},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16935"><span data-slate-object="text" data-key="16936"><span data-slate-leaf="true" data-offset-key="16936:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16937"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16938"><span data-slate-object="text" data-key="16939"><span data-slate-leaf="true" data-offset-key="16939:0" data-first-offset="true"><span data-slate-string="true">  log.Init(opts)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16940"><span data-slate-object="text" data-key="16941"><span data-slate-leaf="true" data-offset-key="16941:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16942"><span data-slate-leaf="true" data-offset-key="16942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="16943"><span data-slate-leaf="true" data-offset-key="16943:0" data-first-offset="true"><span data-slate-string="true"> log.Flush()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16944"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16945"><span data-slate-object="text" data-key="16946"><span data-slate-leaf="true" data-offset-key="16946:0" data-first-offset="true"><span data-slate-string="true">  err := errors.WithCode(code.ErrDatabase, </span></span></span><span data-slate-object="text" data-key="16947"><span data-slate-leaf="true" data-offset-key="16947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user'Lingfei Kong'not found."</span></span></span></span><span data-slate-object="text" data-key="16948"><span data-slate-leaf="true" data-offset-key="16948:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16949"><span data-slate-object="text" data-key="16950"><span data-slate-leaf="true" data-offset-key="16950:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16951"><span data-slate-leaf="true" data-offset-key="16951:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16952"><span data-slate-leaf="true" data-offset-key="16952:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="16953"><span data-slate-leaf="true" data-offset-key="16953:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="16954"><span data-slate-leaf="true" data-offset-key="16954:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16955"><span data-slate-object="text" data-key="16956"><span data-slate-leaf="true" data-offset-key="16956:0" data-first-offset="true"><span data-slate-string="true">    log.Errorf(</span></span></span><span data-slate-object="text" data-key="16957"><span data-slate-leaf="true" data-offset-key="16957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%v"</span></span></span></span><span data-slate-object="text" data-key="16958"><span data-slate-leaf="true" data-offset-key="16958:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16959"><span data-slate-object="text" data-key="16960"><span data-slate-leaf="true" data-offset-key="16960:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16961"><span data-slate-object="text" data-key="16962"><span data-slate-leaf="true" data-offset-key="16962:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="16963"><span data-slate-leaf="true" data-offset-key="16963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16964"><span data-slate-leaf="true" data-offset-key="16964:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16965"><span data-slate-object="text" data-key="16966"><span data-slate-leaf="true" data-offset-key="16966:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16967"><span data-slate-object="text" data-key="16968"><span data-slate-leaf="true" data-offset-key="16968:0" data-first-offset="true"><span data-slate-string="true">执行以上代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="16969"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16970"><span data-slate-object="text" data-key="16971"><span data-slate-leaf="true" data-offset-key="16971:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="16972"><span data-slate-leaf="true" data-offset-key="16972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16973"><span data-slate-leaf="true" data-offset-key="16973:0" data-first-offset="true"><span data-slate-string="true"> run errortrack_log.</span></span></span><span data-slate-object="text" data-key="16974"><span data-slate-leaf="true" data-offset-key="16974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16975"><span data-slate-object="text" data-key="16976"><span data-slate-leaf="true" data-offset-key="16976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2021</span></span></span></span><span data-slate-object="text" data-key="16977"><span data-slate-leaf="true" data-offset-key="16977:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-07</span></span></span></span><span data-slate-object="text" data-key="16978"><span data-slate-leaf="true" data-offset-key="16978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-03</span></span></span></span><span data-slate-object="text" data-key="16979"><span data-slate-leaf="true" data-offset-key="16979:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16980"><span data-slate-leaf="true" data-offset-key="16980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">14</span></span></span></span><span data-slate-object="text" data-key="16981"><span data-slate-leaf="true" data-offset-key="16981:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16982"><span data-slate-leaf="true" data-offset-key="16982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">37</span></span></span></span><span data-slate-object="text" data-key="16983"><span data-slate-leaf="true" data-offset-key="16983:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16984"><span data-slate-leaf="true" data-offset-key="16984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">31.597</span></span></span></span><span data-slate-object="text" data-key="16985"><span data-slate-leaf="true" data-offset-key="16985:0" data-first-offset="true"><span data-slate-string="true">  ERROR  errors/errortrack_log.</span></span></span><span data-slate-object="text" data-key="16986"><span data-slate-leaf="true" data-offset-key="16986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="16987"><span data-slate-leaf="true" data-offset-key="16987:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="16988"><span data-slate-leaf="true" data-offset-key="16988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">41</span></span></span></span><span data-slate-object="text" data-key="16989"><span data-slate-leaf="true" data-offset-key="16989:0" data-first-offset="true"><span data-slate-string="true">  Database </span></span></span><span data-slate-object="text" data-key="16990"><span data-slate-leaf="true" data-offset-key="16990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16991"><span data-slate-object="text" data-key="16992"><span data-slate-leaf="true" data-offset-key="16992:0" data-first-offset="true"><span data-slate-string="true">Database </span></span></span><span data-slate-object="text" data-key="16993"><span data-slate-leaf="true" data-offset-key="16993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16994"><span data-slate-object="text" data-key="16995"><span data-slate-leaf="true" data-offset-key="16995:0" data-first-offset="true"><span data-slate-string="true">当错误发生时，调用 log 包打印错误。通过 log 包的 caller 功能，可以定位到 log 语句的位置，也就是定位到错误发生的位置。你使用这种方式来打印日志时，我有两个建议。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="16996"><div data-slate-type="list-line" data-slate-object="block" data-key="16997"><span data-slate-object="text" data-key="16998"><span data-slate-leaf="true" data-offset-key="16998:0" data-first-offset="true"><span data-slate-string="true">只在错误产生的最初位置打印日志，其他地方直接返回错误，一般不需要再对错误进行封装。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="16999"><span data-slate-object="text" data-key="17000"><span data-slate-leaf="true" data-offset-key="17000:0" data-first-offset="true"><span data-slate-string="true">当代码调用第三方包的函数时，第三方包函数出错时打印错误信息。比如：</span></span></span></div></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17001"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17002"><span data-slate-object="text" data-key="17003"><span data-slate-leaf="true" data-offset-key="17003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="17004"><span data-slate-leaf="true" data-offset-key="17004:0" data-first-offset="true"><span data-slate-string="true"> err := os.Chdir(</span></span></span><span data-slate-object="text" data-key="17005"><span data-slate-leaf="true" data-offset-key="17005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/root"</span></span></span></span><span data-slate-object="text" data-key="17006"><span data-slate-leaf="true" data-offset-key="17006:0" data-first-offset="true"><span data-slate-string="true">); err != </span></span></span><span data-slate-object="text" data-key="17007"><span data-slate-leaf="true" data-offset-key="17007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="17008"><span data-slate-leaf="true" data-offset-key="17008:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17009"><span data-slate-object="text" data-key="17010"><span data-slate-leaf="true" data-offset-key="17010:0" data-first-offset="true"><span data-slate-string="true">    log.Errorf(</span></span></span><span data-slate-object="text" data-key="17011"><span data-slate-leaf="true" data-offset-key="17011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"change dir failed: %v"</span></span></span></span><span data-slate-object="text" data-key="17012"><span data-slate-leaf="true" data-offset-key="17012:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17013"><span data-slate-object="text" data-key="17014"><span data-slate-leaf="true" data-offset-key="17014:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17015" id="sr-toc-4"><span data-slate-object="text" data-key="17016"><span data-slate-leaf="true" data-offset-key="17016:0" data-first-offset="true"><span data-slate-string="true">一个错误码的具体实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17017"><span data-slate-object="text" data-key="17018"><span data-slate-leaf="true" data-offset-key="17018:0" data-first-offset="true"><span data-slate-string="true">接下来，我们看一个依据上一讲介绍的错误码规范的具体错误码实现</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17019"><span data-slate-object="text" data-key="17020"><span data-slate-leaf="true" data-offset-key="17020:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/sample-code</span></span></span></span><span data-slate-object="text" data-key="17021"><span data-slate-leaf="true" data-offset-key="17021:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17022"><span data-slate-type="code" data-slate-object="inline" data-key="17023"><span data-slate-object="text" data-key="17024"><span data-slate-leaf="true" data-offset-key="17024:0" data-first-offset="true"><span data-slate-string="true">sample-code</span></span></span></span><span data-slate-object="text" data-key="17025"><span data-slate-leaf="true" data-offset-key="17025:0" data-first-offset="true"><span data-slate-string="true"> 实现了两类错误码，分别是通用错误码（</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17026"><span data-slate-object="text" data-key="17027"><span data-slate-leaf="true" data-offset-key="17027:0" data-first-offset="true"><span data-slate-string="true">sample-code/base.go</span></span></span></a><span data-slate-object="text" data-key="17028"><span data-slate-leaf="true" data-offset-key="17028:0" data-first-offset="true"><span data-slate-string="true">）和业务模块相关的错误码（</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17029"><span data-slate-object="text" data-key="17030"><span data-slate-leaf="true" data-offset-key="17030:0" data-first-offset="true"><span data-slate-string="true">sample-code/apiserver.go</span></span></span></a><span data-slate-object="text" data-key="17031"><span data-slate-leaf="true" data-offset-key="17031:0" data-first-offset="true"><span data-slate-string="true">）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17032"><span data-slate-object="text" data-key="17033"><span data-slate-leaf="true" data-offset-key="17033:0" data-first-offset="true"><span data-slate-string="true">首先，我们来看通用错误码的定义：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17034"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17035"><span data-slate-object="text" data-key="17036"><span data-slate-leaf="true" data-offset-key="17036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 通用：基本错误</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17037"><span data-slate-object="text" data-key="17038"><span data-slate-leaf="true" data-offset-key="17038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Code must start with 1xxxxx</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17039"><span data-slate-object="text" data-key="17040"><span data-slate-leaf="true" data-offset-key="17040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="17041"><span data-slate-leaf="true" data-offset-key="17041:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17042"><span data-slate-object="text" data-key="17043"><span data-slate-leaf="true" data-offset-key="17043:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17044"><span data-slate-leaf="true" data-offset-key="17044:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrSuccess - 200: OK.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17045"><span data-slate-object="text" data-key="17046"><span data-slate-leaf="true" data-offset-key="17046:0" data-first-offset="true"><span data-slate-string="true">    ErrSuccess </span></span></span><span data-slate-object="text" data-key="17047"><span data-slate-leaf="true" data-offset-key="17047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="17048"><span data-slate-leaf="true" data-offset-key="17048:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="17049"><span data-slate-leaf="true" data-offset-key="17049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iota</span></span></span></span><span data-slate-object="text" data-key="17050"><span data-slate-leaf="true" data-offset-key="17050:0" data-first-offset="true"><span data-slate-string="true"> + </span></span></span><span data-slate-object="text" data-key="17051"><span data-slate-leaf="true" data-offset-key="17051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100001</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17052"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17053"><span data-slate-object="text" data-key="17054"><span data-slate-leaf="true" data-offset-key="17054:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17055"><span data-slate-leaf="true" data-offset-key="17055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrUnknown - 500: Internal server error.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17056"><span data-slate-object="text" data-key="17057"><span data-slate-leaf="true" data-offset-key="17057:0" data-first-offset="true"><span data-slate-string="true">    ErrUnknown</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17058"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17059"><span data-slate-object="text" data-key="17060"><span data-slate-leaf="true" data-offset-key="17060:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17061"><span data-slate-leaf="true" data-offset-key="17061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrBind - 400: Error occurred while binding the request body to the struct.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17062"><span data-slate-object="text" data-key="17063"><span data-slate-leaf="true" data-offset-key="17063:0" data-first-offset="true"><span data-slate-string="true">    ErrBind</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17064"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17065"><span data-slate-object="text" data-key="17066"><span data-slate-leaf="true" data-offset-key="17066:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17067"><span data-slate-leaf="true" data-offset-key="17067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrValidation - 400: Validation failed.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17068"><span data-slate-object="text" data-key="17069"><span data-slate-leaf="true" data-offset-key="17069:0" data-first-offset="true"><span data-slate-string="true">    ErrValidation</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17070"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17071"><span data-slate-object="text" data-key="17072"><span data-slate-leaf="true" data-offset-key="17072:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17073"><span data-slate-leaf="true" data-offset-key="17073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrTokenInvalid - 401: Token invalid.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17074"><span data-slate-object="text" data-key="17075"><span data-slate-leaf="true" data-offset-key="17075:0" data-first-offset="true"><span data-slate-string="true">    ErrTokenInvalid</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17076"><span data-slate-object="text" data-key="17077"><span data-slate-leaf="true" data-offset-key="17077:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17078"><span data-slate-object="text" data-key="17079"><span data-slate-leaf="true" data-offset-key="17079:0" data-first-offset="true"><span data-slate-string="true">在代码中，我们通常使用整型常量（ErrSuccess）来代替整型错误码（100001），因为使用 ErrSuccess 时，一看就知道它代表的错误类型，可以方便开发者使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17080"><span data-slate-object="text" data-key="17081"><span data-slate-leaf="true" data-offset-key="17081:0" data-first-offset="true"><span data-slate-string="true">错误码用来指代一个错误类型，该错误类型需要包含一些有用的信息，例如对应的 HTTP Status Code、对外展示的 Message，以及跟该错误匹配的帮助文档。所以，我们还需要实现一个 Coder 来承载这些信息。这里，我们定义了一个实现了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17082"><span data-slate-object="text" data-key="17083"><span data-slate-leaf="true" data-offset-key="17083:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors.Coder</span></span></span></span><span data-slate-object="text" data-key="17084"><span data-slate-leaf="true" data-offset-key="17084:0" data-first-offset="true"><span data-slate-string="true"> 接口的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17085"><span data-slate-object="text" data-key="17086"><span data-slate-leaf="true" data-offset-key="17086:0" data-first-offset="true"><span data-slate-string="true"> ErrCode</span></span></span></span><span data-slate-object="text" data-key="17087"><span data-slate-leaf="true" data-offset-key="17087:0" data-first-offset="true"><span data-slate-string="true"> 结构体：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17088"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17089"><span data-slate-object="text" data-key="17090"><span data-slate-leaf="true" data-offset-key="17090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrCode implements `github.com/marmotedu/errors`.Coder interface.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17091"><span data-slate-object="text" data-key="17092"><span data-slate-leaf="true" data-offset-key="17092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="17093"><span data-slate-leaf="true" data-offset-key="17093:0" data-first-offset="true"><span data-slate-string="true"> ErrCode </span></span></span><span data-slate-object="text" data-key="17094"><span data-slate-leaf="true" data-offset-key="17094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17095"><span data-slate-leaf="true" data-offset-key="17095:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17096"><span data-slate-object="text" data-key="17097"><span data-slate-leaf="true" data-offset-key="17097:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17098"><span data-slate-leaf="true" data-offset-key="17098:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// C refers to the code of the ErrCode.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17099"><span data-slate-object="text" data-key="17100"><span data-slate-leaf="true" data-offset-key="17100:0" data-first-offset="true"><span data-slate-string="true">    C </span></span></span><span data-slate-object="text" data-key="17101"><span data-slate-leaf="true" data-offset-key="17101:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17102"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17103"><span data-slate-object="text" data-key="17104"><span data-slate-leaf="true" data-offset-key="17104:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17105"><span data-slate-leaf="true" data-offset-key="17105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HTTP status that should be used for the associated error code.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17106"><span data-slate-object="text" data-key="17107"><span data-slate-leaf="true" data-offset-key="17107:0" data-first-offset="true"><span data-slate-string="true">    HTTP </span></span></span><span data-slate-object="text" data-key="17108"><span data-slate-leaf="true" data-offset-key="17108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17109"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17110"><span data-slate-object="text" data-key="17111"><span data-slate-leaf="true" data-offset-key="17111:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17112"><span data-slate-leaf="true" data-offset-key="17112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// External (user) facing error text.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17113"><span data-slate-object="text" data-key="17114"><span data-slate-leaf="true" data-offset-key="17114:0" data-first-offset="true"><span data-slate-string="true">    Ext </span></span></span><span data-slate-object="text" data-key="17115"><span data-slate-leaf="true" data-offset-key="17115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17116"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17117"><span data-slate-object="text" data-key="17118"><span data-slate-leaf="true" data-offset-key="17118:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17119"><span data-slate-leaf="true" data-offset-key="17119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Ref specify the reference document.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17120"><span data-slate-object="text" data-key="17121"><span data-slate-leaf="true" data-offset-key="17121:0" data-first-offset="true"><span data-slate-string="true">    Ref </span></span></span><span data-slate-object="text" data-key="17122"><span data-slate-leaf="true" data-offset-key="17122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17123"><span data-slate-object="text" data-key="17124"><span data-slate-leaf="true" data-offset-key="17124:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17125"><span data-slate-object="text" data-key="17126"><span data-slate-leaf="true" data-offset-key="17126:0" data-first-offset="true"><span data-slate-string="true">可以看到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17127"><span data-slate-object="text" data-key="17128"><span data-slate-leaf="true" data-offset-key="17128:0" data-first-offset="true"><span data-slate-string="true"> ErrCode</span></span></span></span><span data-slate-object="text" data-key="17129"><span data-slate-leaf="true" data-offset-key="17129:0" data-first-offset="true"><span data-slate-string="true"> 结构体包含了以下信息：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="17130"><div data-slate-type="list-line" data-slate-object="block" data-key="17131"><span data-slate-object="text" data-key="17132"><span data-slate-leaf="true" data-offset-key="17132:0" data-first-offset="true"><span data-slate-string="true">int 类型的业务码。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="17133"><span data-slate-object="text" data-key="17134"><span data-slate-leaf="true" data-offset-key="17134:0" data-first-offset="true"><span data-slate-string="true">对应的 HTTP Status Code。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="17135"><span data-slate-object="text" data-key="17136"><span data-slate-leaf="true" data-offset-key="17136:0" data-first-offset="true"><span data-slate-string="true">暴露给外部用户的消息。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="17137"><span data-slate-object="text" data-key="17138"><span data-slate-leaf="true" data-offset-key="17138:0" data-first-offset="true"><span data-slate-string="true">错误的参考文档。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17139"><span data-slate-object="text" data-key="17140"><span data-slate-leaf="true" data-offset-key="17140:0" data-first-offset="true"><span data-slate-string="true">下面是一个具体的 Coder 示例：</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="17141"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17142"><span data-slate-object="text" data-key="17143"><span data-slate-leaf="true" data-offset-key="17143:0" data-first-offset="true"><span data-slate-string="true">coder := &amp;ErrCode{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17144"><span data-slate-object="text" data-key="17145"><span data-slate-leaf="true" data-offset-key="17145:0" data-first-offset="true"><span data-slate-string="true">    C:    </span></span></span><span data-slate-object="text" data-key="17146"><span data-slate-leaf="true" data-offset-key="17146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100001</span></span></span></span><span data-slate-object="text" data-key="17147"><span data-slate-leaf="true" data-offset-key="17147:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17148"><span data-slate-object="text" data-key="17149"><span data-slate-leaf="true" data-offset-key="17149:0" data-first-offset="true"><span data-slate-string="true">    HTTP: </span></span></span><span data-slate-object="text" data-key="17150"><span data-slate-leaf="true" data-offset-key="17150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span><span data-slate-object="text" data-key="17151"><span data-slate-leaf="true" data-offset-key="17151:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17152"><span data-slate-object="text" data-key="17153"><span data-slate-leaf="true" data-offset-key="17153:0" data-first-offset="true"><span data-slate-string="true">    Ext:  </span></span></span><span data-slate-object="text" data-key="17154"><span data-slate-leaf="true" data-offset-key="17154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"OK"</span></span></span></span><span data-slate-object="text" data-key="17155"><span data-slate-leaf="true" data-offset-key="17155:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17156"><span data-slate-object="text" data-key="17157"><span data-slate-leaf="true" data-offset-key="17157:0" data-first-offset="true"><span data-slate-string="true">    Ref:  </span></span></span><span data-slate-object="text" data-key="17158"><span data-slate-leaf="true" data-offset-key="17158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://github.com/marmotedu/sample-code/blob/master/README.md"</span></span></span></span><span data-slate-object="text" data-key="17159"><span data-slate-leaf="true" data-offset-key="17159:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17160"><span data-slate-object="text" data-key="17161"><span data-slate-leaf="true" data-offset-key="17161:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17162"><span data-slate-object="text" data-key="17163"><span data-slate-leaf="true" data-offset-key="17163:0" data-first-offset="true"><span data-slate-string="true">接下来，我们就可以调用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17164"><span data-slate-object="text" data-key="17165"><span data-slate-leaf="true" data-offset-key="17165:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="17166"><span data-slate-leaf="true" data-offset-key="17166:0" data-first-offset="true"><span data-slate-string="true"> 包提供的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17167"><span data-slate-object="text" data-key="17168"><span data-slate-leaf="true" data-offset-key="17168:0" data-first-offset="true"><span data-slate-string="true"> Register</span></span></span></span><span data-slate-object="text" data-key="17169"><span data-slate-leaf="true" data-offset-key="17169:0" data-first-offset="true"><span data-slate-string="true"> 或者</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17170"><span data-slate-object="text" data-key="17171"><span data-slate-leaf="true" data-offset-key="17171:0" data-first-offset="true"><span data-slate-string="true"> MustRegister</span></span></span></span><span data-slate-object="text" data-key="17172"><span data-slate-leaf="true" data-offset-key="17172:0" data-first-offset="true"><span data-slate-string="true"> 函数，将 Coder 注册到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17173"><span data-slate-object="text" data-key="17174"><span data-slate-leaf="true" data-offset-key="17174:0" data-first-offset="true"><span data-slate-string="true"> github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="17175"><span data-slate-leaf="true" data-offset-key="17175:0" data-first-offset="true"><span data-slate-string="true"> 包维护的内存中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17176"><span data-slate-object="text" data-key="17177"><span data-slate-leaf="true" data-offset-key="17177:0" data-first-offset="true"><span data-slate-string="true">一个项目有很多个错误码，如果每个错误码都手动调用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17178"><span data-slate-object="text" data-key="17179"><span data-slate-leaf="true" data-offset-key="17179:0" data-first-offset="true"><span data-slate-string="true"> MustRegister</span></span></span></span><span data-slate-object="text" data-key="17180"><span data-slate-leaf="true" data-offset-key="17180:0" data-first-offset="true"><span data-slate-string="true"> 函数会很麻烦，这里我们通过代码自动生成的方法，来生成 register 函数调用：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="17181"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17182"><span data-slate-object="text" data-key="17183"><span data-slate-leaf="true" data-offset-key="17183:0" data-first-offset="true"><span data-slate-string="true">//go:generate codegen -</span></span></span><span data-slate-object="text" data-key="17184"><span data-slate-leaf="true" data-offset-key="17184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="17185"><span data-slate-leaf="true" data-offset-key="17185:0" data-first-offset="true"><span data-slate-string="true">=int</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17186"><span data-slate-object="text" data-key="17187"><span data-slate-leaf="true" data-offset-key="17187:0" data-first-offset="true"><span data-slate-string="true">//go:generate codegen -</span></span></span><span data-slate-object="text" data-key="17188"><span data-slate-leaf="true" data-offset-key="17188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="17189"><span data-slate-leaf="true" data-offset-key="17189:0" data-first-offset="true"><span data-slate-string="true">=int -doc -output ./error_code_generated.md</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17190"><span data-slate-type="code" data-slate-object="inline" data-key="17191"><span data-slate-object="text" data-key="17192"><span data-slate-leaf="true" data-offset-key="17192:0" data-first-offset="true"><span data-slate-string="true">//go:generate codegen -type=int</span></span></span></span><span data-slate-object="text" data-key="17193"><span data-slate-leaf="true" data-offset-key="17193:0" data-first-offset="true"><span data-slate-string="true"> 会调用 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17194"><span data-slate-object="text" data-key="17195"><span data-slate-leaf="true" data-offset-key="17195:0" data-first-offset="true"><span data-slate-string="true">codegen</span></span></span></a><span data-slate-object="text" data-key="17196"><span data-slate-leaf="true" data-offset-key="17196:0" data-first-offset="true"><span data-slate-string="true"> 工具，生成 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17197"><span data-slate-object="text" data-key="17198"><span data-slate-leaf="true" data-offset-key="17198:0" data-first-offset="true"><span data-slate-string="true">sample_code_generated.go</span></span></span></a><span data-slate-object="text" data-key="17199"><span data-slate-leaf="true" data-offset-key="17199:0" data-first-offset="true"><span data-slate-string="true"> 源码文件：</span></span></span></div><div data-code-language="objectivec" data-slate-type="pre" data-slate-object="block" data-key="17200"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17201"><span data-slate-object="text" data-key="17202"><span data-slate-leaf="true" data-offset-key="17202:0" data-first-offset="true"><span data-slate-string="true">func init() {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17203"><span data-slate-object="text" data-key="17204"><span data-slate-leaf="true" data-offset-key="17204:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="17205"><span data-slate-leaf="true" data-offset-key="17205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">register</span></span></span></span><span data-slate-object="text" data-key="17206"><span data-slate-leaf="true" data-offset-key="17206:0" data-first-offset="true"><span data-slate-string="true">(ErrSuccess, </span></span></span><span data-slate-object="text" data-key="17207"><span data-slate-leaf="true" data-offset-key="17207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span><span data-slate-object="text" data-key="17208"><span data-slate-leaf="true" data-offset-key="17208:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="17209"><span data-slate-leaf="true" data-offset-key="17209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"OK"</span></span></span></span><span data-slate-object="text" data-key="17210"><span data-slate-leaf="true" data-offset-key="17210:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17211"><span data-slate-object="text" data-key="17212"><span data-slate-leaf="true" data-offset-key="17212:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="17213"><span data-slate-leaf="true" data-offset-key="17213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">register</span></span></span></span><span data-slate-object="text" data-key="17214"><span data-slate-leaf="true" data-offset-key="17214:0" data-first-offset="true"><span data-slate-string="true">(ErrUnknown, </span></span></span><span data-slate-object="text" data-key="17215"><span data-slate-leaf="true" data-offset-key="17215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">500</span></span></span></span><span data-slate-object="text" data-key="17216"><span data-slate-leaf="true" data-offset-key="17216:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="17217"><span data-slate-leaf="true" data-offset-key="17217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Internal server error"</span></span></span></span><span data-slate-object="text" data-key="17218"><span data-slate-leaf="true" data-offset-key="17218:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17219"><span data-slate-object="text" data-key="17220"><span data-slate-leaf="true" data-offset-key="17220:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="17221"><span data-slate-leaf="true" data-offset-key="17221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">register</span></span></span></span><span data-slate-object="text" data-key="17222"><span data-slate-leaf="true" data-offset-key="17222:0" data-first-offset="true"><span data-slate-string="true">(ErrBind, </span></span></span><span data-slate-object="text" data-key="17223"><span data-slate-leaf="true" data-offset-key="17223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">400</span></span></span></span><span data-slate-object="text" data-key="17224"><span data-slate-leaf="true" data-offset-key="17224:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="17225"><span data-slate-leaf="true" data-offset-key="17225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Error occurred while binding the request body to the struct"</span></span></span></span><span data-slate-object="text" data-key="17226"><span data-slate-leaf="true" data-offset-key="17226:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17227"><span data-slate-object="text" data-key="17228"><span data-slate-leaf="true" data-offset-key="17228:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="17229"><span data-slate-leaf="true" data-offset-key="17229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">register</span></span></span></span><span data-slate-object="text" data-key="17230"><span data-slate-leaf="true" data-offset-key="17230:0" data-first-offset="true"><span data-slate-string="true">(ErrValidation, </span></span></span><span data-slate-object="text" data-key="17231"><span data-slate-leaf="true" data-offset-key="17231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">400</span></span></span></span><span data-slate-object="text" data-key="17232"><span data-slate-leaf="true" data-offset-key="17232:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="17233"><span data-slate-leaf="true" data-offset-key="17233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Validation failed"</span></span></span></span><span data-slate-object="text" data-key="17234"><span data-slate-leaf="true" data-offset-key="17234:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17235"><span data-slate-object="text" data-key="17236"><span data-slate-leaf="true" data-offset-key="17236:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17237"><span data-slate-leaf="true" data-offset-key="17237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// other register function call</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17238"><span data-slate-object="text" data-key="17239"><span data-slate-leaf="true" data-offset-key="17239:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17240"><span data-slate-object="text" data-key="17241"><span data-slate-leaf="true" data-offset-key="17241:0" data-first-offset="true"><span data-slate-string="true">这些 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17242"><span data-slate-object="text" data-key="17243"><span data-slate-leaf="true" data-offset-key="17243:0" data-first-offset="true"><span data-slate-string="true">register</span></span></span></a><span data-slate-object="text" data-key="17244"><span data-slate-leaf="true" data-offset-key="17244:0" data-first-offset="true"><span data-slate-string="true"> 调用放在 init 函数中，在加载程序的时候被初始化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17245"><span data-slate-object="text" data-key="17246"><span data-slate-leaf="true" data-offset-key="17246:0" data-first-offset="true"><span data-slate-string="true">这里要注意，在注册的时候，我们会检查 HTTP Status Code，只允许定义 200、400、401、403、404、500 这 6 个 HTTP 错误码。这里通过程序保证了错误码是符合 HTTP Status Code 使用要求的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17247"><span data-slate-type="code" data-slate-object="inline" data-key="17248"><span data-slate-object="text" data-key="17249"><span data-slate-leaf="true" data-offset-key="17249:0" data-first-offset="true"><span data-slate-string="true">//go:generate codegen -type=int -doc -output ./error_code_generated.md</span></span></span></span><span data-slate-object="text" data-key="17250"><span data-slate-leaf="true" data-offset-key="17250:0" data-first-offset="true"><span data-slate-string="true"> 会生成错误码描述文档 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17251"><span data-slate-object="text" data-key="17252"><span data-slate-leaf="true" data-offset-key="17252:0" data-first-offset="true"><span data-slate-string="true">error_code_generated.md</span></span></span></a><span data-slate-object="text" data-key="17253"><span data-slate-leaf="true" data-offset-key="17253:0" data-first-offset="true"><span data-slate-string="true">。当我们提供 API 文档时，也需要记着提供一份错误码描述文档，这样客户端才可以根据错误码，知道请求是否成功，以及具体发生哪类错误，好针对性地做一些逻辑处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17254"><span data-slate-type="code" data-slate-object="inline" data-key="17255"><span data-slate-object="text" data-key="17256"><span data-slate-leaf="true" data-offset-key="17256:0" data-first-offset="true"><span data-slate-string="true">codegen</span></span></span></span><span data-slate-object="text" data-key="17257"><span data-slate-leaf="true" data-offset-key="17257:0" data-first-offset="true"><span data-slate-string="true"> 工具会根据错误码注释生成</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17258"><span data-slate-object="text" data-key="17259"><span data-slate-leaf="true" data-offset-key="17259:0" data-first-offset="true"><span data-slate-string="true"> sample_code_generated.go</span></span></span></span><span data-slate-object="text" data-key="17260"><span data-slate-leaf="true" data-offset-key="17260:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17261"><span data-slate-object="text" data-key="17262"><span data-slate-leaf="true" data-offset-key="17262:0" data-first-offset="true"><span data-slate-string="true"> error_code_generated.md</span></span></span></span><span data-slate-object="text" data-key="17263"><span data-slate-leaf="true" data-offset-key="17263:0" data-first-offset="true"><span data-slate-string="true"> 文件：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17264"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17265"><span data-slate-object="text" data-key="17266"><span data-slate-leaf="true" data-offset-key="17266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrSuccess - 200: OK.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17267"><span data-slate-object="text" data-key="17268"><span data-slate-leaf="true" data-offset-key="17268:0" data-first-offset="true"><span data-slate-string="true"> ErrSuccess </span></span></span><span data-slate-object="text" data-key="17269"><span data-slate-leaf="true" data-offset-key="17269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="17270"><span data-slate-leaf="true" data-offset-key="17270:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="17271"><span data-slate-leaf="true" data-offset-key="17271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iota</span></span></span></span><span data-slate-object="text" data-key="17272"><span data-slate-leaf="true" data-offset-key="17272:0" data-first-offset="true"><span data-slate-string="true"> + </span></span></span><span data-slate-object="text" data-key="17273"><span data-slate-leaf="true" data-offset-key="17273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100001</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17274"><span data-slate-object="text" data-key="17275"><span data-slate-leaf="true" data-offset-key="17275:0" data-first-offset="true"><span data-slate-string="true">codegen 工具之所以能够生成</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17276"><span data-slate-object="text" data-key="17277"><span data-slate-leaf="true" data-offset-key="17277:0" data-first-offset="true"><span data-slate-string="true"> sample_code_generated.go</span></span></span></span><span data-slate-object="text" data-key="17278"><span data-slate-leaf="true" data-offset-key="17278:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17279"><span data-slate-object="text" data-key="17280"><span data-slate-leaf="true" data-offset-key="17280:0" data-first-offset="true"><span data-slate-string="true"> error_code_generated.md</span></span></span></span><span data-slate-object="text" data-key="17281"><span data-slate-leaf="true" data-offset-key="17281:0" data-first-offset="true"><span data-slate-string="true">，是因为我们的错误码注释是有规定格式的：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17282"><span data-slate-object="text" data-key="17283"><span data-slate-leaf="true" data-offset-key="17283:0" data-first-offset="true"><span data-slate-string="true">// &lt;错误码整型常量&gt; - &lt; 对应的 HTTP Status Code&gt;: &lt;External Message&gt;.</span></span></span></span><span data-slate-object="text" data-key="17284"><span data-slate-leaf="true" data-offset-key="17284:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17285"><span data-slate-object="text" data-key="17286"><span data-slate-leaf="true" data-offset-key="17286:0" data-first-offset="true"><span data-slate-string="true">codegen 工具可以在 IAM 项目根目录下，执行以下命令来安装：</span></span></span></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="17287"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17288"><span data-slate-object="text" data-key="17289"><span data-slate-leaf="true" data-offset-key="17289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$ </span></span></span></span><span data-slate-object="text" data-key="17290"><span data-slate-leaf="true" data-offset-key="17290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make tools.install.codegen</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17291"><span data-slate-object="text" data-key="17292"><span data-slate-leaf="true" data-offset-key="17292:0" data-first-offset="true"><span data-slate-string="true">安装完 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17293"><span data-slate-object="text" data-key="17294"><span data-slate-leaf="true" data-offset-key="17294:0" data-first-offset="true"><span data-slate-string="true">codegen</span></span></span></span><span data-slate-object="text" data-key="17295"><span data-slate-leaf="true" data-offset-key="17295:0" data-first-offset="true"><span data-slate-string="true"> 工具后，可以在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17296"><span data-slate-object="text" data-key="17297"><span data-slate-leaf="true" data-offset-key="17297:0" data-first-offset="true"><span data-slate-string="true">github.com/marmotedu/sample-code</span></span></span></span><span data-slate-object="text" data-key="17298"><span data-slate-leaf="true" data-offset-key="17298:0" data-first-offset="true"><span data-slate-string="true"> 包根目录下执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17299"><span data-slate-object="text" data-key="17300"><span data-slate-leaf="true" data-offset-key="17300:0" data-first-offset="true"><span data-slate-string="true">go generate</span></span></span></span><span data-slate-object="text" data-key="17301"><span data-slate-leaf="true" data-offset-key="17301:0" data-first-offset="true"><span data-slate-string="true"> 命令，来生成</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17302"><span data-slate-object="text" data-key="17303"><span data-slate-leaf="true" data-offset-key="17303:0" data-first-offset="true"><span data-slate-string="true"> sample_code_generated.go</span></span></span></span><span data-slate-object="text" data-key="17304"><span data-slate-leaf="true" data-offset-key="17304:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17305"><span data-slate-object="text" data-key="17306"><span data-slate-leaf="true" data-offset-key="17306:0" data-first-offset="true"><span data-slate-string="true"> error_code_generated.md</span></span></span></span><span data-slate-object="text" data-key="17307"><span data-slate-leaf="true" data-offset-key="17307:0" data-first-offset="true"><span data-slate-string="true">。这里有个技巧需要你注意：生成的文件建议统一用  </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17308"><span data-slate-object="text" data-key="17309"><span data-slate-leaf="true" data-offset-key="17309:0" data-first-offset="true"><span data-slate-string="true">xxxx_generated.xx</span></span></span></span><span data-slate-object="text" data-key="17310"><span data-slate-leaf="true" data-offset-key="17310:0" data-first-offset="true"><span data-slate-string="true"> 来命名，这样通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17311"><span data-slate-object="text" data-key="17312"><span data-slate-leaf="true" data-offset-key="17312:0" data-first-offset="true"><span data-slate-string="true">generated</span></span></span></span><span data-slate-object="text" data-key="17313"><span data-slate-leaf="true" data-offset-key="17313:0" data-first-offset="true"><span data-slate-string="true"> ，我们就知道这个文件是代码自动生成的，有助于我们理解和使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17314"><span data-slate-object="text" data-key="17315"><span data-slate-leaf="true" data-offset-key="17315:0" data-first-offset="true"><span data-slate-string="true">在实际的开发中，我们可以将错误码独立成一个包，放在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17316"><span data-slate-object="text" data-key="17317"><span data-slate-leaf="true" data-offset-key="17317:0" data-first-offset="true"><span data-slate-string="true">internal/pkg/code/</span></span></span></span><span data-slate-object="text" data-key="17318"><span data-slate-leaf="true" data-offset-key="17318:0" data-first-offset="true"><span data-slate-string="true"> 目录下，这样可以方便整个应用调用。例如 IAM 的错误码就放在 IAM 项目根目录下的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17319"><span data-slate-object="text" data-key="17320"><span data-slate-leaf="true" data-offset-key="17320:0" data-first-offset="true"><span data-slate-string="true">internal/pkg/code/</span></span></span></a><span data-slate-object="text" data-key="17321"><span data-slate-leaf="true" data-offset-key="17321:0" data-first-offset="true"><span data-slate-string="true"> 目录下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17322"><span data-slate-object="text" data-key="17323"><span data-slate-leaf="true" data-offset-key="17323:0" data-first-offset="true"><span data-slate-string="true">我们的错误码是分服务和模块的，所以这里建议你把相同的服务放在同一个 Go 源文件中，例如 IAM 的错误码存放文件：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17324"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17325"><span data-slate-object="text" data-key="17326"><span data-slate-leaf="true" data-offset-key="17326:0" data-first-offset="true"><span data-slate-string="true">$ ls base.</span></span></span><span data-slate-object="text" data-key="17327"><span data-slate-leaf="true" data-offset-key="17327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="17328"><span data-slate-leaf="true" data-offset-key="17328:0" data-first-offset="true"><span data-slate-string="true"> apiserver.</span></span></span><span data-slate-object="text" data-key="17329"><span data-slate-leaf="true" data-offset-key="17329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="17330"><span data-slate-leaf="true" data-offset-key="17330:0" data-first-offset="true"><span data-slate-string="true"> authzserver.</span></span></span><span data-slate-object="text" data-key="17331"><span data-slate-leaf="true" data-offset-key="17331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="17332"><span data-slate-leaf="true" data-offset-key="17332:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17333"><span data-slate-object="text" data-key="17334"><span data-slate-leaf="true" data-offset-key="17334:0" data-first-offset="true"><span data-slate-string="true">apiserver.</span></span></span><span data-slate-object="text" data-key="17335"><span data-slate-leaf="true" data-offset-key="17335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="17336"><span data-slate-leaf="true" data-offset-key="17336:0" data-first-offset="true"><span data-slate-string="true">  authzserver.</span></span></span><span data-slate-object="text" data-key="17337"><span data-slate-leaf="true" data-offset-key="17337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="17338"><span data-slate-leaf="true" data-offset-key="17338:0" data-first-offset="true"><span data-slate-string="true">  base.</span></span></span><span data-slate-object="text" data-key="17339"><span data-slate-leaf="true" data-offset-key="17339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17340"><span data-slate-object="text" data-key="17341"><span data-slate-leaf="true" data-offset-key="17341:0" data-first-offset="true"><span data-slate-string="true">一个应用中会有多个服务，例如 IAM 应用中，就包含了 iam-apiserver、iam-authz-server、iam-pump 三个服务。这些服务有一些通用的错误码，为了便于维护，可以将这些通用的错误码统一放在 base.go 源码文件中。其他的错误码，我们可以按服务分别放在不同的文件中：iam-apiserver 服务的错误码统一放在 apiserver.go 文件中；iam-authz-server 的错误码统一存放在 authzserver.go 文件中。其他服务以此类推。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17342"><span data-slate-object="text" data-key="17343"><span data-slate-leaf="true" data-offset-key="17343:0" data-first-offset="true"><span data-slate-string="true">另外，同一个服务中不同模块的错误码，可以按以下格式来组织：相同模块的错误码放在同一个 const 代码块中，不同模块的错误码放在不同的 const 代码块中。每个 const 代码块的开头注释就是该模块的错误码定义。例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17344"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17345"><span data-slate-object="text" data-key="17346"><span data-slate-leaf="true" data-offset-key="17346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// iam-apiserver: user errors.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17347"><span data-slate-object="text" data-key="17348"><span data-slate-leaf="true" data-offset-key="17348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="17349"><span data-slate-leaf="true" data-offset-key="17349:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17350"><span data-slate-object="text" data-key="17351"><span data-slate-leaf="true" data-offset-key="17351:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17352"><span data-slate-leaf="true" data-offset-key="17352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrUserNotFound - 404: User not found.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17353"><span data-slate-object="text" data-key="17354"><span data-slate-leaf="true" data-offset-key="17354:0" data-first-offset="true"><span data-slate-string="true">    ErrUserNotFound </span></span></span><span data-slate-object="text" data-key="17355"><span data-slate-leaf="true" data-offset-key="17355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="17356"><span data-slate-leaf="true" data-offset-key="17356:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="17357"><span data-slate-leaf="true" data-offset-key="17357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iota</span></span></span></span><span data-slate-object="text" data-key="17358"><span data-slate-leaf="true" data-offset-key="17358:0" data-first-offset="true"><span data-slate-string="true"> + </span></span></span><span data-slate-object="text" data-key="17359"><span data-slate-leaf="true" data-offset-key="17359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">110001</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17360"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17361"><span data-slate-object="text" data-key="17362"><span data-slate-leaf="true" data-offset-key="17362:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17363"><span data-slate-leaf="true" data-offset-key="17363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrUserAlreadyExist - 400: User already exist.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17364"><span data-slate-object="text" data-key="17365"><span data-slate-leaf="true" data-offset-key="17365:0" data-first-offset="true"><span data-slate-string="true">    ErrUserAlreadyExist</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17366"><span data-slate-object="text" data-key="17367"><span data-slate-leaf="true" data-offset-key="17367:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17368"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17369"><span data-slate-object="text" data-key="17370"><span data-slate-leaf="true" data-offset-key="17370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// iam-apiserver: secret errors.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17371"><span data-slate-object="text" data-key="17372"><span data-slate-leaf="true" data-offset-key="17372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="17373"><span data-slate-leaf="true" data-offset-key="17373:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17374"><span data-slate-object="text" data-key="17375"><span data-slate-leaf="true" data-offset-key="17375:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17376"><span data-slate-leaf="true" data-offset-key="17376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrEncrypt - 400: Secret reach the max count.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17377"><span data-slate-object="text" data-key="17378"><span data-slate-leaf="true" data-offset-key="17378:0" data-first-offset="true"><span data-slate-string="true">    ErrReachMaxCount </span></span></span><span data-slate-object="text" data-key="17379"><span data-slate-leaf="true" data-offset-key="17379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="17380"><span data-slate-leaf="true" data-offset-key="17380:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="17381"><span data-slate-leaf="true" data-offset-key="17381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iota</span></span></span></span><span data-slate-object="text" data-key="17382"><span data-slate-leaf="true" data-offset-key="17382:0" data-first-offset="true"><span data-slate-string="true"> + </span></span></span><span data-slate-object="text" data-key="17383"><span data-slate-leaf="true" data-offset-key="17383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">110101</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17384"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17385"><span data-slate-object="text" data-key="17386"><span data-slate-leaf="true" data-offset-key="17386:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17387"><span data-slate-leaf="true" data-offset-key="17387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//  ErrSecretNotFound - 404: Secret not found.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17388"><span data-slate-object="text" data-key="17389"><span data-slate-leaf="true" data-offset-key="17389:0" data-first-offset="true"><span data-slate-string="true">    ErrSecretNotFound</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17390"><span data-slate-object="text" data-key="17391"><span data-slate-leaf="true" data-offset-key="17391:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17392"><span data-slate-object="text" data-key="17393"><span data-slate-leaf="true" data-offset-key="17393:0" data-first-offset="true"><span data-slate-string="true">最后，我们还需要将错误码定义记录在项目的文件中，供开发者查阅、遵守和使用，例如 IAM 项目的错误码定义记录文档为 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17394"><span data-slate-object="text" data-key="17395"><span data-slate-leaf="true" data-offset-key="17395:0" data-first-offset="true"><span data-slate-string="true">code_specification.md</span></span></span></a><span data-slate-object="text" data-key="17396"><span data-slate-leaf="true" data-offset-key="17396:0" data-first-offset="true"><span data-slate-string="true">。这个文档中记录了错误码说明、错误描述规范和错误记录规范等。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17397" id="sr-toc-5"><span data-slate-object="text" data-key="17398"><span data-slate-leaf="true" data-offset-key="17398:0" data-first-offset="true"><span data-slate-string="true">错误码实际使用方法示例</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17399"><span data-slate-object="text" data-key="17400"><span data-slate-leaf="true" data-offset-key="17400:0" data-first-offset="true"><span data-slate-string="true">上面，我讲解了错误包和错误码的实现方式，那你一定想知道在实际开发中我们是如何使用的。这里，我就举一个在 gin web 框架中使用该错误码的例子：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="17401"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17402"><span data-slate-object="text" data-key="17403"><span data-slate-leaf="true" data-offset-key="17403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Response defines project response format which in marmotedu organization.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17404"><span data-slate-object="text" data-key="17405"><span data-slate-leaf="true" data-offset-key="17405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="17406"><span data-slate-leaf="true" data-offset-key="17406:0" data-first-offset="true"><span data-slate-string="true"> Response </span></span></span><span data-slate-object="text" data-key="17407"><span data-slate-leaf="true" data-offset-key="17407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17408"><span data-slate-leaf="true" data-offset-key="17408:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17409"><span data-slate-object="text" data-key="17410"><span data-slate-leaf="true" data-offset-key="17410:0" data-first-offset="true"><span data-slate-string="true">    Code      errors.Code </span></span></span><span data-slate-object="text" data-key="17411"><span data-slate-leaf="true" data-offset-key="17411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"code,omitempty"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17412"><span data-slate-object="text" data-key="17413"><span data-slate-leaf="true" data-offset-key="17413:0" data-first-offset="true"><span data-slate-string="true">    Message   </span></span></span><span data-slate-object="text" data-key="17414"><span data-slate-leaf="true" data-offset-key="17414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="17415"><span data-slate-leaf="true" data-offset-key="17415:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="17416"><span data-slate-leaf="true" data-offset-key="17416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"message,omitempty"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17417"><span data-slate-object="text" data-key="17418"><span data-slate-leaf="true" data-offset-key="17418:0" data-first-offset="true"><span data-slate-string="true">    Reference </span></span></span><span data-slate-object="text" data-key="17419"><span data-slate-leaf="true" data-offset-key="17419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="17420"><span data-slate-leaf="true" data-offset-key="17420:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="17421"><span data-slate-leaf="true" data-offset-key="17421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"reference,omitempty"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17422"><span data-slate-object="text" data-key="17423"><span data-slate-leaf="true" data-offset-key="17423:0" data-first-offset="true"><span data-slate-string="true">    Data      </span></span></span><span data-slate-object="text" data-key="17424"><span data-slate-leaf="true" data-offset-key="17424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="17425"><span data-slate-leaf="true" data-offset-key="17425:0" data-first-offset="true"><span data-slate-string="true">{} </span></span></span><span data-slate-object="text" data-key="17426"><span data-slate-leaf="true" data-offset-key="17426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"data,omitempty"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17427"><span data-slate-object="text" data-key="17428"><span data-slate-leaf="true" data-offset-key="17428:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17429"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17430"><span data-slate-object="text" data-key="17431"><span data-slate-leaf="true" data-offset-key="17431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// WriteResponse used to write an error and JSON data into response.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17432"><span data-slate-object="text" data-key="17433"><span data-slate-leaf="true" data-offset-key="17433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="17434"><span data-slate-leaf="true" data-offset-key="17434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="17435"><span data-slate-leaf="true" data-offset-key="17435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">WriteResponse</span></span></span></span></span><span data-slate-object="text" data-key="17436"><span data-slate-leaf="true" data-offset-key="17436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *gin.Context, err </span></span></span></span></span><span data-slate-object="text" data-key="17437"><span data-slate-leaf="true" data-offset-key="17437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></span></span><span data-slate-object="text" data-key="17438"><span data-slate-leaf="true" data-offset-key="17438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, data </span></span></span></span></span><span data-slate-object="text" data-key="17439"><span data-slate-leaf="true" data-offset-key="17439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="17440"><span data-slate-leaf="true" data-offset-key="17440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="17441"><span data-slate-leaf="true" data-offset-key="17441:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17442"><span data-slate-object="text" data-key="17443"><span data-slate-leaf="true" data-offset-key="17443:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17444"><span data-slate-leaf="true" data-offset-key="17444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="17445"><span data-slate-leaf="true" data-offset-key="17445:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="17446"><span data-slate-leaf="true" data-offset-key="17446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="17447"><span data-slate-leaf="true" data-offset-key="17447:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17448"><span data-slate-object="text" data-key="17449"><span data-slate-leaf="true" data-offset-key="17449:0" data-first-offset="true"><span data-slate-string="true">        coder := errors.ParseCoder(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17450"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17451"><span data-slate-object="text" data-key="17452"><span data-slate-leaf="true" data-offset-key="17452:0" data-first-offset="true"><span data-slate-string="true">        c.JSON(coder.HTTPStatus(), Response{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17453"><span data-slate-object="text" data-key="17454"><span data-slate-leaf="true" data-offset-key="17454:0" data-first-offset="true"><span data-slate-string="true">            Code:      coder.Code(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17455"><span data-slate-object="text" data-key="17456"><span data-slate-leaf="true" data-offset-key="17456:0" data-first-offset="true"><span data-slate-string="true">            Message:   coder.String(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17457"><span data-slate-object="text" data-key="17458"><span data-slate-leaf="true" data-offset-key="17458:0" data-first-offset="true"><span data-slate-string="true">            Reference: coder.Reference(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17459"><span data-slate-object="text" data-key="17460"><span data-slate-leaf="true" data-offset-key="17460:0" data-first-offset="true"><span data-slate-string="true">            Data:      data,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17461"><span data-slate-object="text" data-key="17462"><span data-slate-leaf="true" data-offset-key="17462:0" data-first-offset="true"><span data-slate-string="true">        })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17463"><span data-slate-object="text" data-key="17464"><span data-slate-leaf="true" data-offset-key="17464:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17465"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17466"><span data-slate-object="text" data-key="17467"><span data-slate-leaf="true" data-offset-key="17467:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusOK, Response{Data: data})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17468"><span data-slate-object="text" data-key="17469"><span data-slate-leaf="true" data-offset-key="17469:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17470"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17471"><span data-slate-object="text" data-key="17472"><span data-slate-leaf="true" data-offset-key="17472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="17473"><span data-slate-leaf="true" data-offset-key="17473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="17474"><span data-slate-leaf="true" data-offset-key="17474:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GetUser</span></span></span></span></span><span data-slate-object="text" data-key="17475"><span data-slate-leaf="true" data-offset-key="17475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *gin.Context)</span></span></span></span></span><span data-slate-object="text" data-key="17476"><span data-slate-leaf="true" data-offset-key="17476:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17477"><span data-slate-object="text" data-key="17478"><span data-slate-leaf="true" data-offset-key="17478:0" data-first-offset="true"><span data-slate-string="true">    log.Info(</span></span></span><span data-slate-object="text" data-key="17479"><span data-slate-leaf="true" data-offset-key="17479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"get user function called."</span></span></span></span><span data-slate-object="text" data-key="17480"><span data-slate-leaf="true" data-offset-key="17480:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="17481"><span data-slate-leaf="true" data-offset-key="17481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"X-Request-Id"</span></span></span></span><span data-slate-object="text" data-key="17482"><span data-slate-leaf="true" data-offset-key="17482:0" data-first-offset="true"><span data-slate-string="true">, requestid.Get(c))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17483"><span data-slate-object="text" data-key="17484"><span data-slate-leaf="true" data-offset-key="17484:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17485"><span data-slate-leaf="true" data-offset-key="17485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get the user by the `username` from the database.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17486"><span data-slate-object="text" data-key="17487"><span data-slate-leaf="true" data-offset-key="17487:0" data-first-offset="true"><span data-slate-string="true">    user, err := store.Client().Users().Get(c.Param(</span></span></span><span data-slate-object="text" data-key="17488"><span data-slate-leaf="true" data-offset-key="17488:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="17489"><span data-slate-leaf="true" data-offset-key="17489:0" data-first-offset="true"><span data-slate-string="true">), metav1.GetOptions{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17490"><span data-slate-object="text" data-key="17491"><span data-slate-leaf="true" data-offset-key="17491:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17492"><span data-slate-leaf="true" data-offset-key="17492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="17493"><span data-slate-leaf="true" data-offset-key="17493:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="17494"><span data-slate-leaf="true" data-offset-key="17494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="17495"><span data-slate-leaf="true" data-offset-key="17495:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17496"><span data-slate-object="text" data-key="17497"><span data-slate-leaf="true" data-offset-key="17497:0" data-first-offset="true"><span data-slate-string="true">        core.WriteResponse(c, errors.WithCode(code.ErrUserNotFound, err.Error()), </span></span></span><span data-slate-object="text" data-key="17498"><span data-slate-leaf="true" data-offset-key="17498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="17499"><span data-slate-leaf="true" data-offset-key="17499:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17500"><span data-slate-object="text" data-key="17501"><span data-slate-leaf="true" data-offset-key="17501:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="17502"><span data-slate-leaf="true" data-offset-key="17502:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17503"><span data-slate-object="text" data-key="17504"><span data-slate-leaf="true" data-offset-key="17504:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17505"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17506"><span data-slate-object="text" data-key="17507"><span data-slate-leaf="true" data-offset-key="17507:0" data-first-offset="true"><span data-slate-string="true">    core.WriteResponse(c, </span></span></span><span data-slate-object="text" data-key="17508"><span data-slate-leaf="true" data-offset-key="17508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="17509"><span data-slate-leaf="true" data-offset-key="17509:0" data-first-offset="true"><span data-slate-string="true">, user)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17510"><span data-slate-object="text" data-key="17511"><span data-slate-leaf="true" data-offset-key="17511:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17512"><span data-slate-object="text" data-key="17513"><span data-slate-leaf="true" data-offset-key="17513:0" data-first-offset="true"><span data-slate-string="true">上述代码中，通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17514"><span data-slate-object="text" data-key="17515"><span data-slate-leaf="true" data-offset-key="17515:0" data-first-offset="true"><span data-slate-string="true"> WriteResponse</span></span></span></span><span data-slate-object="text" data-key="17516"><span data-slate-leaf="true" data-offset-key="17516:0" data-first-offset="true"><span data-slate-string="true"> 统一处理错误。在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17517"><span data-slate-object="text" data-key="17518"><span data-slate-leaf="true" data-offset-key="17518:0" data-first-offset="true"><span data-slate-string="true">WriteResponse</span></span></span></span><span data-slate-object="text" data-key="17519"><span data-slate-leaf="true" data-offset-key="17519:0" data-first-offset="true"><span data-slate-string="true"> 函数中，如果</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17520"><span data-slate-object="text" data-key="17521"><span data-slate-leaf="true" data-offset-key="17521:0" data-first-offset="true"><span data-slate-string="true"> err != nil</span></span></span></span><span data-slate-object="text" data-key="17522"><span data-slate-leaf="true" data-offset-key="17522:0" data-first-offset="true"><span data-slate-string="true">，则从 error 中解析出 Coder，并调用 Coder 提供的方法，获取错误相关的 Http Status Code、int 类型的业务码、暴露给用户的信息、错误的参考文档链接，并返回 JSON 格式的信息。如果 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17523"><span data-slate-object="text" data-key="17524"><span data-slate-leaf="true" data-offset-key="17524:0" data-first-offset="true"><span data-slate-string="true">err == nil</span></span></span></span><span data-slate-object="text" data-key="17525"><span data-slate-leaf="true" data-offset-key="17525:0" data-first-offset="true"><span data-slate-string="true"> 则返回 200 和数据。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17526" id="sr-toc-6"><span data-slate-object="text" data-key="17527"><span data-slate-leaf="true" data-offset-key="17527:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17528"><span data-slate-object="text" data-key="17529"><span data-slate-leaf="true" data-offset-key="17529:0" data-first-offset="true"><span data-slate-string="true">记录错误是应用程序必须要做的一件事情，在实际开发中，我们通常会封装自己的错误包。一个优秀的错误包，应该能够支持错误堆栈、不同的打印格式、Wrap/Unwrap/Is/As 等函数，并能够支持格式化创建 error。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17530"><span data-slate-object="text" data-key="17531"><span data-slate-leaf="true" data-offset-key="17531:0" data-first-offset="true"><span data-slate-string="true">根据这些错误包设计要点，我基于 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17532"><span data-slate-object="text" data-key="17533"><span data-slate-leaf="true" data-offset-key="17533:0" data-first-offset="true"><span data-slate-string="true">github.com/pkg/errors</span></span></span></span><span data-slate-object="text" data-key="17534"><span data-slate-leaf="true" data-offset-key="17534:0" data-first-offset="true"><span data-slate-string="true"> 包设计了 IAM 项目的错误包 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="17535"><span data-slate-object="text" data-key="17536"><span data-slate-leaf="true" data-offset-key="17536:0" data-first-offset="true"><span data-slate-string="true">github.com/marmotedu/errors</span></span></span></span><span data-slate-object="text" data-key="17537"><span data-slate-leaf="true" data-offset-key="17537:0" data-first-offset="true"><span data-slate-string="true"> ，该包符合我们上一讲设计的错误码规范。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17538"><span data-slate-object="text" data-key="17539"><span data-slate-leaf="true" data-offset-key="17539:0" data-first-offset="true"><span data-slate-string="true">另外，本讲也给出了一个具体的错误码实现 sample-code ， sample-code 支持业务 Code 码、HTTP Status Code、错误参考文档、可以对内对外展示不同的错误信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17540"><span data-slate-object="text" data-key="17541"><span data-slate-leaf="true" data-offset-key="17541:0" data-first-offset="true"><span data-slate-string="true">最后，因为错误码注释是有固定格式的，所以我们可以通过 codegen 工具解析错误码的注释，生成 register 函数调用和错误码文档。这种做法也体现了我一直强调的 low code 思想，可以提高开发效率，减少人为失误。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17542" id="sr-toc-7"><span data-slate-object="text" data-key="17543"><span data-slate-leaf="true" data-offset-key="17543:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="17544"><div data-slate-type="list-line" data-slate-object="block" data-key="17545"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="17546"><span data-slate-leaf="true" data-offset-key="17546:0" data-first-offset="true"><span data-slate-string="true">在这门课里，我们定义了 base、iam-apiserver 服务的错误码，请试着定义 iam-authz-server 服务的错误码，并生成错误码文档。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="17547"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="17548"><span data-slate-leaf="true" data-offset-key="17548:0" data-first-offset="true"><span data-slate-string="true">思考下，这门课的错误包和错误码设计能否满足你当前的项目需求，如果觉得不能满足，可以在留言区分享你的看法。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17549"><span data-slate-object="text" data-key="17550"><span data-slate-leaf="true" data-offset-key="17550:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>16</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-8">精选留言 (26)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>以推荐老师的项目给组里其它小伙伴，一起学习沉淀打磨为自己的实用标准，多谢老师</div><div><p>作者回复：感谢 pedro 支持</p></div><div><div>2021-07-08</div><div><div><i></i></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
1. 为什么业务要开发自己的错误包？因为开源的 error 包中，没有业务错误码，不方便使用。
2. 如何区分内部错误和外部错误？
    1. 将错误分为两部分，是一个非常好的设计，通过 error code 联系在一起
    2. 将 error code, response code, external error message 注册到一张大表上
    3. github.com/marmotedu/errors 包提供的 WitheCode 和 Wrap 方法，构建错误链（嵌套关系）
    4. 通过 format 的各种形式，控制 error 的输出信息
3. 如何自动生成全局的错误码文档，方便排查问题和联调？ 使用 codegen 工具。
4. 如何打印错误？只在错误最原始位置打印错误。</div><div><p>作者回复：总结的很全，很到位！</p></div><div><div>2021-11-27</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/a7/b2/274a4192.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 漂泊的小飘</span></div></div><div>感觉需要看着源码再学一遍。。。</div><div><p>作者回复：老哥，加油！</p></div><div><div>2021-07-28</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/85/17/91ad99c3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 树建</span></div></div><div>文中提到 withCode 实现了 format 方法，但是看了 errors.go 中只查看 withMessage 实现了 format</div><div><div>2022-05-05</div><div><div><i></i><span>1</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/de/97/cda3f551.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 倪昊</span></div></div><div>错误码实际使用方法实例里的 WriteResponse，如果 err != nil，if 分支执行完，还是会继续执行下面的 c.JSON，这样不就返回两个 Response 结构了吗？</div><div><p>作者回复：是个 bug，感谢老哥反馈，已经修复</p></div><div><div>2021-09-08</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/83/17/df99b53d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 随风而过</span></div></div><div>错误码的设计很合理，和其他语言的错误设计大相径庭，很规范，老师这套错误可以引入到企业开发项目当中</div><div><div>2021-09-01</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Sch0ng</span></div></div><div>把错误处理落地成简单实用的错误处理包，有助于错误码的长期治理。</div><div><p>作者回复：对的</p></div><div><div>2021-08-10</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/27/2d/120c21ef.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 大刘</span></div></div><div>错误码实际使用方法示例中
1.type Response struct {Code errors.Code `json:"code,omitempty"`Message string`json:"message,omitempty"` Reference string `json:"reference,omitempty"`Data interface {}`json:"data,omitempty"`}

Code errors.Code 是不是应该改为 Code int
2.if err != nil { core.WriteResponse (c, code.ErrUserNotFound.Error (), nil) return }
code.ErrUserNotFound.Error ()  这个 Error 方法是从哪里来的？ ErrUserNotFound 按照上面所说应该只是一个 int 值吧？</div><div><p>作者回复: 1. 没问题的
2. 已经更新啦，感谢反馈！</p></div><div><div>2021-08-02</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132"></div></div><div><div><div><span>ppd0705</span></div></div><div>请问一下老师，当一个接口有多个用户输入参数，其中某个参数错误，如果需要告诉用户具体哪个参数有问题，这样 CODE.Ext 是动态的，该怎么处理好呢？ 


</div><div><p>作者回复：要魔改 error 包了，支持自定义 ext 信息。老哥，感兴趣可以魔改下。</p></div><div><div>2021-07-30</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/06/13/e4f9f79b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 你赖东东不错嘛</span></div></div><div>记录错误方式二：在 err 发生处打印了 log，却依旧把 err 上抛，而最外层又对 err 进行了一次处理，这样可能导致日志里写了两份重复的 err 信息。望解惑！</div><div><p>作者回复：这个地方可以根据需要选择是否在上层直接返回 err，还是再添加一些信息。

一般情况下直接返回 err 即可。但可能也有些业务逻辑需要在上层追加一些额外的信息，来帮助排障。</p></div><div><div>2021-07-16</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/bf/86/c0cb35f0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>8.13.3.27.30</span></div></div><div>非常实用的东西、老师讲的东西在实际应用中、真真切切的用到了、可惜当时老师没有出这个教程、现在只能下次重构的时候再使用了</div><div><div>2021-07-12</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Daiver</span></div></div><div>还是不清楚，codegen 是怎么生成注册代码的</div><div><p>作者回复: codegen 是我写的一个解析程序。主要是通过解析 ast 语法树，来获取其中的注释，然后根据注释自动生成文档和 Go 源文件，具体实现方式你就可以参考 codegen 源代码</p></div><div><div>2021-07-12</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/2e/01/14a478bb.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>happychap</span></div></div><div>老师，您好，学习了您的专栏受益良多，谢谢您的付出！有个问题还不太明白，烦请解答一下，就是：接口请问返回给 error 处理 ref 链接内容来源是怎么形成的或该如何维护管理它们呢？</div><div><p>作者回复：内容来源，是产研总结的 Q&amp;A。链接中的文档可以放在 docs/guide/zh-CN/faq/ 目录下。</p></div><div><div>2021-07-08</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/8a/ac/82699bc8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 大片</span></div></div><div>withCode 没有实现 Format () 方法呀？</div><div><div>2022-07-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/5JKZO1Ziax3Ky03noshpVNyEvZw0pUwjLcHrHRo1XNPKXdmCE88homb6ltA15CdVRnjzjgGs3Ex42CaDbeYzNuQ/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Geek_25f93f</span></div></div><div>要写这么一个 codegen 工具应该要废很多时间</div><div><div>2022-07-09</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2b/ed/da/78a0e68f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>.</span></div></div><div>看完了 git 中 withCode 错误的实现逻辑对于 WitCode 需要分开 cause 和 err 两个 errors，很是迷惑。起初看完代码在猜想 cause 这个应该是为了递归打印，实现上个章节的” 科学设计错误包 “内容 “ 错误码 100101， 10: 服务。01: 某个服务下的某个模块。01: 模块下的错误码序号，每个模块可以注册 100 个错误。” 的功能，但是看了函数 IsCode 的逻辑，彻底懵逼了，code 只对比了第一层的 code 就 return，显然不是为了实现上一章节的内容，所以多个 cause  errors 感觉是一个特别累赘的设计。

另外 WithCode 和 WithStack 的入参都是 error 接口。 如果一个 error 起初是 go 原生库的 error， 先 withCode 再 WithMessgge, 在执行 err. Error () 会丢失打印不出完整的错误栈。这块是原本 iam 的就是业务设计就是如此吗？WithMessgge 会直接决定了 err. Error () 值，不管前面被 With 了多少次？</div><div><div>2022-06-11</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/4Lprf2mIWpJOPibgibbFCicMtp5bpIibyLFOnyOhnBGbusrLZC0frG0FGWqdcdCkcKunKxqiaOHvXbCFE7zKJ8TmvIA/132"></div></div><div><div><div><span>Geek_c2089d</span></div></div><div>func New (message string) error {
	return &amp;fundamental {
		msg:   message,
		stack: callers (),
	}
}
老师，想问一下 errors/code.go 的包里面的 callers () 函数，哪里来的</div><div><p>作者回复：相同目录下，stack.go 文件中</p></div><div><div>2022-04-19</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/ZdeWzNbp2uzsrib04NWIteb3hAX6vojc7X1uuW52jZupC4WvXV63lwASxEl41EHtIjFKzdyQHFRiauH0wcBzH4Zg/132"></div></div><div><div><div><span>Geek_4c858e</span></div></div><div>错误包试了几次，我想用在 gin 项目上，还没明白。希望再给个例子。谢谢</div><div><div>2022-03-31</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1f/f3/ed/46299341.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>打工人 yyds</span></div></div><div>老师，我看您的源码，apiservere 的 gin-jwt 认证那块的返回 (Unauthorized) 并没有使用统一错误格式。请问这块一般不设置吗？</div><div><p>作者回复：这里不好设置统一格式。
</p></div><div><div>2022-03-23</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>types</span></div></div><div>github.com/marmotedu/errors 是基于 https://github.com/pkg/errors 进行的修改
1. 感觉代码风格跟 pkg/errors 不是很一致
2. error 包需要支持 code，这个很好，但是不清楚为什么还要保留原理的 withMessage, withStack, 然后花大量代码来处理， 只保留 withCode 相关的是否会更好，更加简洁？？ </div><div><p>作者回复：跟 github.com/pkg/errors 包兼容</p></div><div><div>2022-02-16</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1p"><outline class="toc-level-h1" data-reactid=".1p.0" style="width: 175px;"><active data-reactid=".1p.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1p.0.1"><span data-reactid=".1p.0.1.0">19 | 错误处理（下）：如何设计错误包？</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.1" style="width: 165px;"><active data-reactid=".1p.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1p.1.1"><span data-reactid=".1p.1.1.0">错误包需要具有哪些功能？</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.2" style="width: 165px;"><active data-reactid=".1p.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1p.2.1"><span data-reactid=".1p.2.1.0">错误包实现</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.3" style="width: 165px;"><active data-reactid=".1p.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1p.3.1"><span data-reactid=".1p.3.1.0">如何记录错误？</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.4" style="width: 165px;"><active data-reactid=".1p.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1p.4.1"><span data-reactid=".1p.4.1.0">一个错误码的具体实现</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.5" style="width: 165px;"><active data-reactid=".1p.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1p.5.1"><span data-reactid=".1p.5.1.0">错误码实际使用方法示例</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.6" style="width: 165px;"><active data-reactid=".1p.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1p.6.1"><span data-reactid=".1p.6.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.7" style="width: 165px;"><active data-reactid=".1p.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1p.7.1"><span data-reactid=".1p.7.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".1p.8" style="width: 165px;"><active data-reactid=".1p.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1p.8.1"><span data-reactid=".1p.8.1.0">精选留言 (26)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/393022" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>