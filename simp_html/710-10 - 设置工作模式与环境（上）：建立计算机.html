
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 10 | 设置工作模式与环境（上）：建立计算机</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>10 | 设置工作模式与环境（上）：建立计算机</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0"> 10 | 设置工作模式与环境（上）：建立计算机</h1><div><span>LMOS</span> <span>2021-05-31</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/16/a3/16e96827769e8e27c8446b62c2680da3.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：陈晨</span><span>大小：10.73M</span><span> 时长：11:45</span></div></div><audio title="10 | 设置工作模式与环境（上）：建立计算机" src="https://res001.geekbang.org/media/audio/68/00/685086c494b46aab6046b0430e5e3200/ld/ld.m3u8" __idm_id__="942095"></audio></div><div><div><div><div data-slate-editor="true" data-key="6721" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="6722"><span data-slate-object="text" data-key="6723"><span data-slate-leaf="true" data-offset-key="6723:0" data-first-offset="true"><span data-slate-string="true">你好，我是 LMOS。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6724"><span data-slate-object="text" data-key="6725"><span data-slate-leaf="true" data-offset-key="6725:0" data-first-offset="true"><span data-slate-string="true">经过前面那么多课程的准备，现在我们距离把我们自己操作系统跑起来，已经是一步之遥了。现在，你是不是很兴奋，很激动？有这些情绪说明你是喜欢这门课程的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6726"><span data-slate-object="text" data-key="6727"><span data-slate-leaf="true" data-offset-key="6727:0" data-first-offset="true"><span data-slate-string="true">接下来的三节课，我们会一起完成一个壮举，从 GRUB 老大哥手中接过权柄，让计算机回归到我们的革命路线上来，为我们之后的开发自己的操作系统做好准备。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6728"><span data-slate-object="text" data-key="6729"><span data-slate-leaf="true" data-offset-key="6729:0" data-first-offset="true"><span data-slate-string="true">具体我是这样来安排的，今天这节课，我们先来搭好操作系统的测试环境。第二节课，我们一起实现一个初始化环境的组件 —— 二级引导器，让它真正继承 GRUB 权力。第三节课，我们正式攻下初始化的第一个山头，对硬件抽象层进行初始化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6730"><span data-slate-object="text" data-key="6731"><span data-slate-leaf="true" data-offset-key="6731:0" data-first-offset="true"><span data-slate-string="true">好，让我们正式开始今天的学习。首先我们来解决内核文件封装的问题，然后动手一步步建好虚拟机和生产虚拟硬盘。课程配套代码你可以在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6732"><span data-slate-object="text" data-key="6733"><span data-slate-leaf="true" data-offset-key="6733:0" data-first-offset="true"><span data-slate-string="true">这里</span></span></span></a><span data-slate-object="text" data-key="6734"><span data-slate-leaf="true" data-offset-key="6734:0" data-first-offset="true"><span data-slate-string="true">下载。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6735" id="sr-toc-1"><span data-slate-object="text" data-key="6736"><span data-slate-leaf="true" data-offset-key="6736:0" data-first-offset="true"><span data-slate-string="true">从内核映像格式说起</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6737"><span data-slate-object="text" data-key="6738"><span data-slate-leaf="true" data-offset-key="6738:0" data-first-offset="true"><span data-slate-string="true">我们都知道，一个内核工程肯定有多个文件组成，为了不让 GRUB 老哥加载多个文件，因疲劳过度而产生问题，我们决定让 GRUB 只加载一个文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6739"><span data-slate-object="text" data-key="6740"><span data-slate-leaf="true" data-offset-key="6740:0" data-first-offset="true"><span data-slate-string="true">但是要把多个文件变成一个文件就需要封装，即把多个文件组装在一起形成一个文件。这个文件我们称为</span></span></span><span data-slate-object="text" data-key="6741"><span data-slate-leaf="true" data-offset-key="6741:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">内核映像文件</span></span></span></span><span data-slate-object="text" data-key="6742"><span data-slate-leaf="true" data-offset-key="6742:0" data-first-offset="true"><span data-slate-string="true">，其中包含二级引导器的模块，内核模块，图片和字库文件。为了这映像文件能被 GRUB 加载，并让它自身能够解析其中的内容，我们就要定义好具体的格式。如下图所示。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6743"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e4/14/e4000be6a176d1fd09b99bf6df02f914.jpg?wh=2045*2460"></div><div>内核映像文件格式</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6744"><span data-slate-object="text" data-key="6745"><span data-slate-leaf="true" data-offset-key="6745:0" data-first-offset="true"><span data-slate-string="true">上图中的 GRUB 头有 4KB 大小，GRUB 正是通过这一小段代码，来识别映像文件的。另外，根据映像文件头描述符和文件头描述符里的信息，这一小段代码还可以解析映像文件中的其它文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6746"><span data-slate-object="text" data-key="6747"><span data-slate-leaf="true" data-offset-key="6747:0" data-first-offset="true"><span data-slate-string="true">映像文件头描述符和文件描述符是两个 C 语言结构体，如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="6748"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6749"><span data-slate-object="text" data-key="6750"><span data-slate-leaf="true" data-offset-key="6750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件头描述符</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6751"><span data-slate-object="text" data-key="6752"><span data-slate-leaf="true" data-offset-key="6752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="6753"><span data-slate-leaf="true" data-offset-key="6753:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6754"><span data-slate-leaf="true" data-offset-key="6754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="6755"><span data-slate-leaf="true" data-offset-key="6755:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6756"><span data-slate-leaf="true" data-offset-key="6756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_mlosrddsc</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6757"><span data-slate-object="text" data-key="6758"><span data-slate-leaf="true" data-offset-key="6758:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6759"><span data-slate-object="text" data-key="6760"><span data-slate-leaf="true" data-offset-key="6760:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6761"><span data-slate-leaf="true" data-offset-key="6761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6762"><span data-slate-leaf="true" data-offset-key="6762:0" data-first-offset="true"><span data-slate-string="true"> mdc_mgic; </span></span></span><span data-slate-object="text" data-key="6763"><span data-slate-leaf="true" data-offset-key="6763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件标识</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6764"><span data-slate-object="text" data-key="6765"><span data-slate-leaf="true" data-offset-key="6765:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6766"><span data-slate-leaf="true" data-offset-key="6766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6767"><span data-slate-leaf="true" data-offset-key="6767:0" data-first-offset="true"><span data-slate-string="true"> mdc_sfsum;</span></span></span><span data-slate-object="text" data-key="6768"><span data-slate-leaf="true" data-offset-key="6768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 未使用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6769"><span data-slate-object="text" data-key="6770"><span data-slate-leaf="true" data-offset-key="6770:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6771"><span data-slate-leaf="true" data-offset-key="6771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6772"><span data-slate-leaf="true" data-offset-key="6772:0" data-first-offset="true"><span data-slate-string="true"> mdc_sfsoff;</span></span></span><span data-slate-object="text" data-key="6773"><span data-slate-leaf="true" data-offset-key="6773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 未使用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6774"><span data-slate-object="text" data-key="6775"><span data-slate-leaf="true" data-offset-key="6775:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6776"><span data-slate-leaf="true" data-offset-key="6776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6777"><span data-slate-leaf="true" data-offset-key="6777:0" data-first-offset="true"><span data-slate-string="true"> mdc_sfeoff;</span></span></span><span data-slate-object="text" data-key="6778"><span data-slate-leaf="true" data-offset-key="6778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 未使用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6779"><span data-slate-object="text" data-key="6780"><span data-slate-leaf="true" data-offset-key="6780:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6781"><span data-slate-leaf="true" data-offset-key="6781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6782"><span data-slate-leaf="true" data-offset-key="6782:0" data-first-offset="true"><span data-slate-string="true"> mdc_sfrlsz;</span></span></span><span data-slate-object="text" data-key="6783"><span data-slate-leaf="true" data-offset-key="6783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 未使用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6784"><span data-slate-object="text" data-key="6785"><span data-slate-leaf="true" data-offset-key="6785:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6786"><span data-slate-leaf="true" data-offset-key="6786:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6787"><span data-slate-leaf="true" data-offset-key="6787:0" data-first-offset="true"><span data-slate-string="true"> mdc_ldrbk_s;</span></span></span><span data-slate-object="text" data-key="6788"><span data-slate-leaf="true" data-offset-key="6788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中二级引导器的开始偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6789"><span data-slate-object="text" data-key="6790"><span data-slate-leaf="true" data-offset-key="6790:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6791"><span data-slate-leaf="true" data-offset-key="6791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6792"><span data-slate-leaf="true" data-offset-key="6792:0" data-first-offset="true"><span data-slate-string="true"> mdc_ldrbk_e;</span></span></span><span data-slate-object="text" data-key="6793"><span data-slate-leaf="true" data-offset-key="6793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中二级引导器的结束偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6794"><span data-slate-object="text" data-key="6795"><span data-slate-leaf="true" data-offset-key="6795:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6796"><span data-slate-leaf="true" data-offset-key="6796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6797"><span data-slate-leaf="true" data-offset-key="6797:0" data-first-offset="true"><span data-slate-string="true"> mdc_ldrbk_rsz;</span></span></span><span data-slate-object="text" data-key="6798"><span data-slate-leaf="true" data-offset-key="6798:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中二级引导器的实际大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6799"><span data-slate-object="text" data-key="6800"><span data-slate-leaf="true" data-offset-key="6800:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6801"><span data-slate-leaf="true" data-offset-key="6801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6802"><span data-slate-leaf="true" data-offset-key="6802:0" data-first-offset="true"><span data-slate-string="true"> mdc_ldrbk_sum;</span></span></span><span data-slate-object="text" data-key="6803"><span data-slate-leaf="true" data-offset-key="6803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中二级引导器的校验和</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6804"><span data-slate-object="text" data-key="6805"><span data-slate-leaf="true" data-offset-key="6805:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6806"><span data-slate-leaf="true" data-offset-key="6806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6807"><span data-slate-leaf="true" data-offset-key="6807:0" data-first-offset="true"><span data-slate-string="true"> mdc_fhdbk_s;</span></span></span><span data-slate-object="text" data-key="6808"><span data-slate-leaf="true" data-offset-key="6808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头描述的开始偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6809"><span data-slate-object="text" data-key="6810"><span data-slate-leaf="true" data-offset-key="6810:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6811"><span data-slate-leaf="true" data-offset-key="6811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6812"><span data-slate-leaf="true" data-offset-key="6812:0" data-first-offset="true"><span data-slate-string="true"> mdc_fhdbk_e;</span></span></span><span data-slate-object="text" data-key="6813"><span data-slate-leaf="true" data-offset-key="6813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头描述的结束偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6814"><span data-slate-object="text" data-key="6815"><span data-slate-leaf="true" data-offset-key="6815:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6816"><span data-slate-leaf="true" data-offset-key="6816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6817"><span data-slate-leaf="true" data-offset-key="6817:0" data-first-offset="true"><span data-slate-string="true"> mdc_fhdbk_rsz;</span></span></span><span data-slate-object="text" data-key="6818"><span data-slate-leaf="true" data-offset-key="6818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头描述的实际大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6819"><span data-slate-object="text" data-key="6820"><span data-slate-leaf="true" data-offset-key="6820:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6821"><span data-slate-leaf="true" data-offset-key="6821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6822"><span data-slate-leaf="true" data-offset-key="6822:0" data-first-offset="true"><span data-slate-string="true"> mdc_fhdbk_sum;</span></span></span><span data-slate-object="text" data-key="6823"><span data-slate-leaf="true" data-offset-key="6823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头描述的校验和</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6824"><span data-slate-object="text" data-key="6825"><span data-slate-leaf="true" data-offset-key="6825:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6826"><span data-slate-leaf="true" data-offset-key="6826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6827"><span data-slate-leaf="true" data-offset-key="6827:0" data-first-offset="true"><span data-slate-string="true"> mdc_filbk_s;</span></span></span><span data-slate-object="text" data-key="6828"><span data-slate-leaf="true" data-offset-key="6828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件数据的开始偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6829"><span data-slate-object="text" data-key="6830"><span data-slate-leaf="true" data-offset-key="6830:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6831"><span data-slate-leaf="true" data-offset-key="6831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6832"><span data-slate-leaf="true" data-offset-key="6832:0" data-first-offset="true"><span data-slate-string="true"> mdc_filbk_e;</span></span></span><span data-slate-object="text" data-key="6833"><span data-slate-leaf="true" data-offset-key="6833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件数据的结束偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6834"><span data-slate-object="text" data-key="6835"><span data-slate-leaf="true" data-offset-key="6835:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6836"><span data-slate-leaf="true" data-offset-key="6836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6837"><span data-slate-leaf="true" data-offset-key="6837:0" data-first-offset="true"><span data-slate-string="true"> mdc_filbk_rsz;</span></span></span><span data-slate-object="text" data-key="6838"><span data-slate-leaf="true" data-offset-key="6838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件数据的实际大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6839"><span data-slate-object="text" data-key="6840"><span data-slate-leaf="true" data-offset-key="6840:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6841"><span data-slate-leaf="true" data-offset-key="6841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6842"><span data-slate-leaf="true" data-offset-key="6842:0" data-first-offset="true"><span data-slate-string="true"> mdc_filbk_sum;</span></span></span><span data-slate-object="text" data-key="6843"><span data-slate-leaf="true" data-offset-key="6843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件数据的校验和</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6844"><span data-slate-object="text" data-key="6845"><span data-slate-leaf="true" data-offset-key="6845:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6846"><span data-slate-leaf="true" data-offset-key="6846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6847"><span data-slate-leaf="true" data-offset-key="6847:0" data-first-offset="true"><span data-slate-string="true"> mdc_ldrcodenr;</span></span></span><span data-slate-object="text" data-key="6848"><span data-slate-leaf="true" data-offset-key="6848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中二级引导器的文件头描述符的索引号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6849"><span data-slate-object="text" data-key="6850"><span data-slate-leaf="true" data-offset-key="6850:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6851"><span data-slate-leaf="true" data-offset-key="6851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6852"><span data-slate-leaf="true" data-offset-key="6852:0" data-first-offset="true"><span data-slate-string="true"> mdc_fhdnr;</span></span></span><span data-slate-object="text" data-key="6853"><span data-slate-leaf="true" data-offset-key="6853:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头描述符有多少个</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6854"><span data-slate-object="text" data-key="6855"><span data-slate-leaf="true" data-offset-key="6855:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6856"><span data-slate-leaf="true" data-offset-key="6856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6857"><span data-slate-leaf="true" data-offset-key="6857:0" data-first-offset="true"><span data-slate-string="true"> mdc_filnr;</span></span></span><span data-slate-object="text" data-key="6858"><span data-slate-leaf="true" data-offset-key="6858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件中文件头有多少个</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6859"><span data-slate-object="text" data-key="6860"><span data-slate-leaf="true" data-offset-key="6860:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6861"><span data-slate-leaf="true" data-offset-key="6861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6862"><span data-slate-leaf="true" data-offset-key="6862:0" data-first-offset="true"><span data-slate-string="true"> mdc_endgic;</span></span></span><span data-slate-object="text" data-key="6863"><span data-slate-leaf="true" data-offset-key="6863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件结束标识</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6864"><span data-slate-object="text" data-key="6865"><span data-slate-leaf="true" data-offset-key="6865:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6866"><span data-slate-leaf="true" data-offset-key="6866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6867"><span data-slate-leaf="true" data-offset-key="6867:0" data-first-offset="true"><span data-slate-string="true"> mdc_rv;</span></span></span><span data-slate-object="text" data-key="6868"><span data-slate-leaf="true" data-offset-key="6868:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 映像文件版本</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6869"><span data-slate-object="text" data-key="6870"><span data-slate-leaf="true" data-offset-key="6870:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="6871"><span data-slate-leaf="true" data-offset-key="6871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mlosrddsc_t</span></span></span></span><span data-slate-object="text" data-key="6872"><span data-slate-leaf="true" data-offset-key="6872:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6873"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6874"><span data-slate-object="text" data-key="6875"><span data-slate-leaf="true" data-offset-key="6875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="6876"><span data-slate-leaf="true" data-offset-key="6876:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="6877"><span data-slate-leaf="true" data-offset-key="6877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> FHDSC_NMAX 192 </span></span></span></span><span data-slate-object="text" data-key="6878"><span data-slate-leaf="true" data-offset-key="6878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件名长度</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6879"><span data-slate-object="text" data-key="6880"><span data-slate-leaf="true" data-offset-key="6880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件头描述符</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6881"><span data-slate-object="text" data-key="6882"><span data-slate-leaf="true" data-offset-key="6882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="6883"><span data-slate-leaf="true" data-offset-key="6883:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6884"><span data-slate-leaf="true" data-offset-key="6884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="6885"><span data-slate-leaf="true" data-offset-key="6885:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6886"><span data-slate-leaf="true" data-offset-key="6886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_fhdsc</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6887"><span data-slate-object="text" data-key="6888"><span data-slate-leaf="true" data-offset-key="6888:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6889"><span data-slate-object="text" data-key="6890"><span data-slate-leaf="true" data-offset-key="6890:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6891"><span data-slate-leaf="true" data-offset-key="6891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6892"><span data-slate-leaf="true" data-offset-key="6892:0" data-first-offset="true"><span data-slate-string="true"> fhd_type;</span></span></span><span data-slate-object="text" data-key="6893"><span data-slate-leaf="true" data-offset-key="6893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6894"><span data-slate-object="text" data-key="6895"><span data-slate-leaf="true" data-offset-key="6895:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6896"><span data-slate-leaf="true" data-offset-key="6896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6897"><span data-slate-leaf="true" data-offset-key="6897:0" data-first-offset="true"><span data-slate-string="true"> fhd_subtype;</span></span></span><span data-slate-object="text" data-key="6898"><span data-slate-leaf="true" data-offset-key="6898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件子类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6899"><span data-slate-object="text" data-key="6900"><span data-slate-leaf="true" data-offset-key="6900:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6901"><span data-slate-leaf="true" data-offset-key="6901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6902"><span data-slate-leaf="true" data-offset-key="6902:0" data-first-offset="true"><span data-slate-string="true"> fhd_stuts;</span></span></span><span data-slate-object="text" data-key="6903"><span data-slate-leaf="true" data-offset-key="6903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6904"><span data-slate-object="text" data-key="6905"><span data-slate-leaf="true" data-offset-key="6905:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6906"><span data-slate-leaf="true" data-offset-key="6906:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6907"><span data-slate-leaf="true" data-offset-key="6907:0" data-first-offset="true"><span data-slate-string="true"> fhd_id;</span></span></span><span data-slate-object="text" data-key="6908"><span data-slate-leaf="true" data-offset-key="6908:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件 id</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6909"><span data-slate-object="text" data-key="6910"><span data-slate-leaf="true" data-offset-key="6910:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6911"><span data-slate-leaf="true" data-offset-key="6911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6912"><span data-slate-leaf="true" data-offset-key="6912:0" data-first-offset="true"><span data-slate-string="true"> fhd_intsfsoff;</span></span></span><span data-slate-object="text" data-key="6913"><span data-slate-leaf="true" data-offset-key="6913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件在映像文件位置开始偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6914"><span data-slate-object="text" data-key="6915"><span data-slate-leaf="true" data-offset-key="6915:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6916"><span data-slate-leaf="true" data-offset-key="6916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6917"><span data-slate-leaf="true" data-offset-key="6917:0" data-first-offset="true"><span data-slate-string="true"> fhd_intsfend;</span></span></span><span data-slate-object="text" data-key="6918"><span data-slate-leaf="true" data-offset-key="6918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件在映像文件的结束偏移</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6919"><span data-slate-object="text" data-key="6920"><span data-slate-leaf="true" data-offset-key="6920:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6921"><span data-slate-leaf="true" data-offset-key="6921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6922"><span data-slate-leaf="true" data-offset-key="6922:0" data-first-offset="true"><span data-slate-string="true"> fhd_frealsz;</span></span></span><span data-slate-object="text" data-key="6923"><span data-slate-leaf="true" data-offset-key="6923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件实际大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6924"><span data-slate-object="text" data-key="6925"><span data-slate-leaf="true" data-offset-key="6925:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6926"><span data-slate-leaf="true" data-offset-key="6926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="6927"><span data-slate-leaf="true" data-offset-key="6927:0" data-first-offset="true"><span data-slate-string="true"> fhd_fsum;</span></span></span><span data-slate-object="text" data-key="6928"><span data-slate-leaf="true" data-offset-key="6928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件校验和</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6929"><span data-slate-object="text" data-key="6930"><span data-slate-leaf="true" data-offset-key="6930:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6931"><span data-slate-leaf="true" data-offset-key="6931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">char</span></span></span></span><span data-slate-object="text" data-key="6932"><span data-slate-leaf="true" data-offset-key="6932:0" data-first-offset="true"><span data-slate-string="true">   fhd_name[FHDSC_NMAX];</span></span></span><span data-slate-object="text" data-key="6933"><span data-slate-leaf="true" data-offset-key="6933:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件名</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6934"><span data-slate-object="text" data-key="6935"><span data-slate-leaf="true" data-offset-key="6935:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="6936"><span data-slate-leaf="true" data-offset-key="6936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fhdsc_t</span></span></span></span><span data-slate-object="text" data-key="6937"><span data-slate-leaf="true" data-offset-key="6937:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6938"><span data-slate-object="text" data-key="6939"><span data-slate-leaf="true" data-offset-key="6939:0" data-first-offset="true"><span data-slate-string="true">有了映像文件格式，我们还要有个打包映像的工具，我给你提供了一个 Linux 命令行下的工具（在 Gitee 代码仓库中，通过</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6940"><span data-slate-object="text" data-key="6941"><span data-slate-leaf="true" data-offset-key="6941:0" data-first-offset="true"><span data-slate-string="true">这个链接</span></span></span></a><span data-slate-object="text" data-key="6942"><span data-slate-leaf="true" data-offset-key="6942:0" data-first-offset="true"><span data-slate-string="true">获取），你只要明白使用方法就可以，如下所示。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="6943"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6944"><span data-slate-object="text" data-key="6945"><span data-slate-leaf="true" data-offset-key="6945:0" data-first-offset="true"><span data-slate-string="true">lmoskrlimg -m k -lhf GRUB 头文件 -o 映像文件 -f 输入的文件列表</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6946"><span data-slate-object="text" data-key="6947"><span data-slate-leaf="true" data-offset-key="6947:0" data-first-offset="true"><span data-slate-string="true">-m 表示模式 只能是 k 内核模式</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6948"><span data-slate-object="text" data-key="6949"><span data-slate-leaf="true" data-offset-key="6949:0" data-first-offset="true"><span data-slate-string="true">-lhf 表示后面跟上 GRUB 头文件</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6950"><span data-slate-object="text" data-key="6951"><span data-slate-leaf="true" data-offset-key="6951:0" data-first-offset="true"><span data-slate-string="true">-o 表示输出的映像文件名 </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6952"><span data-slate-object="text" data-key="6953"><span data-slate-leaf="true" data-offset-key="6953:0" data-first-offset="true"><span data-slate-string="true">-f 表示输入文件列表</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6954"><span data-slate-object="text" data-key="6955"><span data-slate-leaf="true" data-offset-key="6955:0" data-first-offset="true"><span data-slate-string="true">例如：lmoskrlimg -m k -lhf grubhead.</span></span></span><span data-slate-object="text" data-key="6956"><span data-slate-leaf="true" data-offset-key="6956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bin</span></span></span></span><span data-slate-object="text" data-key="6957"><span data-slate-leaf="true" data-offset-key="6957:0" data-first-offset="true"><span data-slate-string="true"> -o kernel.img -f file1.</span></span></span><span data-slate-object="text" data-key="6958"><span data-slate-leaf="true" data-offset-key="6958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bin</span></span></span></span><span data-slate-object="text" data-key="6959"><span data-slate-leaf="true" data-offset-key="6959:0" data-first-offset="true"><span data-slate-string="true"> file2.</span></span></span><span data-slate-object="text" data-key="6960"><span data-slate-leaf="true" data-offset-key="6960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bin</span></span></span></span><span data-slate-object="text" data-key="6961"><span data-slate-leaf="true" data-offset-key="6961:0" data-first-offset="true"><span data-slate-string="true"> file3.</span></span></span><span data-slate-object="text" data-key="6962"><span data-slate-leaf="true" data-offset-key="6962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bin</span></span></span></span><span data-slate-object="text" data-key="6963"><span data-slate-leaf="true" data-offset-key="6963:0" data-first-offset="true"><span data-slate-string="true"> file4.</span></span></span><span data-slate-object="text" data-key="6964"><span data-slate-leaf="true" data-offset-key="6964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bin</span></span></span></span><span data-slate-object="text" data-key="6965"><span data-slate-leaf="true" data-offset-key="6965:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6966" id="sr-toc-2"><span data-slate-object="text" data-key="6967"><span data-slate-leaf="true" data-offset-key="6967:0" data-first-offset="true"><span data-slate-string="true">准备虚拟机</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6968"><span data-slate-object="text" data-key="6969"><span data-slate-leaf="true" data-offset-key="6969:0" data-first-offset="true"><span data-slate-string="true">打包好了映像文件，我们还有很重要的一步配置 —— 准备虚拟机。这里你不妨先想一想，开发应用跟开发操作系统有什么不同呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6970"><span data-slate-object="text" data-key="6971"><span data-slate-leaf="true" data-offset-key="6971:0" data-first-offset="true"><span data-slate-string="true">在你开发应用程序时，可以在 IDE 中随时编译运行应用程序，然后观察结果状态是否正确，中间可能还要百度一下查找相关资料，不要笑，这是大多数人的开发日常。但是你开发操作系统时，不可能写 5 行代码之后就安装在计算机上，重启计算机去观察运行结果，这非常繁琐，也很浪费时间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6972"><span data-slate-object="text" data-key="6973"><span data-slate-leaf="true" data-offset-key="6973:0" data-first-offset="true"><span data-slate-string="true">好在我们有虚拟机这个好帮手。虚拟机用软件的方式实现了真实计算机的全部功能特性，它在我们所使用的 Linux 下，其实就是个应用程序。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6974"><span data-slate-object="text" data-key="6975"><span data-slate-leaf="true" data-offset-key="6975:0" data-first-offset="true"><span data-slate-string="true">使用虚拟机软件我们就可以在现有的 Linux 系统之上开发、编译、运行我们的操作系统了，省时且方便。节约的时间我们可以喝茶、听听音乐、享受美好生活。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6976" id="sr-toc-3"><span data-slate-object="text" data-key="6977"><span data-slate-leaf="true" data-offset-key="6977:0" data-first-offset="true"><span data-slate-string="true">安装虚拟机</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6978"><span data-slate-object="text" data-key="6979"><span data-slate-leaf="true" data-offset-key="6979:0" data-first-offset="true"><span data-slate-string="true">这里我们一致约定</span></span></span><span data-slate-object="text" data-key="6980"><span data-slate-leaf="true" data-offset-key="6980:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">使用甲骨文公司的</span></span></span></span><span data-slate-object="text" data-key="6981"><span data-slate-leaf="true" data-offset-key="6981:0" data-first-offset="true"><span data-slate-string="true"> VirtualBox</span></span></span><span data-slate-object="text" data-key="6982"><span data-slate-leaf="true" data-offset-key="6982:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 虚拟机</span></span></span></span><span data-slate-object="text" data-key="6983"><span data-slate-leaf="true" data-offset-key="6983:0" data-first-offset="true"><span data-slate-string="true">。经过测试，我发现 VirtualBox 虚拟机有很多优点，它的功能相对完善、性能强、BUG 少，而且比较稳定。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6984"><span data-slate-object="text" data-key="6985"><span data-slate-leaf="true" data-offset-key="6985:0" data-first-offset="true"><span data-slate-string="true">在现代 Linux 系统上安装 VirtualBox 虚拟机是非常简单的，你只要在 Linux 发行版中找到其应用商店，在其中搜索 VirtualBox 就行了。我们作为专业人士一条命令可以解决的事情，为什么要用鼠标点来点去呢，多浪费时间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6986"><span data-slate-object="text" data-key="6987"><span data-slate-leaf="true" data-offset-key="6987:0" data-first-offset="true"><span data-slate-string="true">所以，你只要在终端中输入如下命令就行了，我假定你安装了 Ubuntu 系的 Linux 发行版，这里 Ubuntu 的版本不做规定。</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="6988"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6989"><span data-slate-object="text" data-key="6990"><span data-slate-leaf="true" data-offset-key="6990:0" data-first-offset="true"><span data-slate-string="true">sudo apt</span></span></span><span data-slate-object="text" data-key="6991"><span data-slate-leaf="true" data-offset-key="6991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="6992"><span data-slate-leaf="true" data-offset-key="6992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="6993"><span data-slate-leaf="true" data-offset-key="6993:0" data-first-offset="true"><span data-slate-string="true"> install virtualbox</span></span></span><span data-slate-object="text" data-key="6994"><span data-slate-leaf="true" data-offset-key="6994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-6.1</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6995"><span data-slate-object="text" data-key="6996"><span data-slate-leaf="true" data-offset-key="6996:0" data-first-offset="true"><span data-slate-string="true">运行 Virtualbox 后，如果出现如下界面，就说明安装 VirtualBox 成功了。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6997"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/8f/a9/8f8f2c86722cf19e8301c6c72426f9a9.jpg?wh=980*600"></div><div>安装 VirtualBox</div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6998" id="sr-toc-4"><span data-slate-object="text" data-key="6999"><span data-slate-leaf="true" data-offset-key="6999:0" data-first-offset="true"><span data-slate-string="true">建立虚拟电脑</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7000"><span data-slate-object="text" data-key="7001"><span data-slate-leaf="true" data-offset-key="7001:0" data-first-offset="true"><span data-slate-string="true">前面我们只是安好了虚拟机管理软件，我们还要新建虚拟机才可以。点击上图中的新建，然后选择专家模式，就可以进入专家模式配置我们的电脑了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7002"><span data-slate-object="text" data-key="7003"><span data-slate-leaf="true" data-offset-key="7003:0" data-first-offset="true"><span data-slate-string="true">尽管它是虚拟的，我们还是可以选择 CPU 类型、内存大小、硬盘大小、网络等配置，为了一致性，请你按照如下截图来配置。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7004"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f1/e3/f1ed52ae172ea8bc1710a3ef9296bbe3.jpg?wh=902*634"></div><div>新建虚拟机</div></div><div data-slate-type="image" data-slate-object="block" data-key="7005"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b0/b1/b05365a0a6fb4477042a43326e43f5b1.jpg?wh=1000*820"></div><div>新建虚拟机</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7006"><span data-slate-object="text" data-key="7007"><span data-slate-leaf="true" data-offset-key="7007:0" data-first-offset="true"><span data-slate-string="true">可以看到，我们选择了 64 位的架构，1024MB 内存，但是不要添加硬盘，后面自有妙用。显卡是 VBoxVGA，还有硬件加速，这会让虚拟机调用我们机器上真实的 CPU 来运行我们的操作系统。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7008" id="sr-toc-5"><span data-slate-object="text" data-key="7009"><span data-slate-leaf="true" data-offset-key="7009:0" data-first-offset="true"><span data-slate-string="true">手工生产硬盘</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7010"><span data-slate-object="text" data-key="7011"><span data-slate-leaf="true" data-offset-key="7011:0" data-first-offset="true"><span data-slate-string="true">上面的虚拟机中还没有硬盘，没有硬盘虚拟机就没地方加载数据，我们当然不是要买一块硬盘挂上去，而是要去手工生产一块硬盘。你马上就会发现，从零开始生产一块虚拟硬盘，这比从零开始写一个操作系统简单得多。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7012"><span data-slate-object="text" data-key="7013"><span data-slate-leaf="true" data-offset-key="7013:0" data-first-offset="true"><span data-slate-string="true">至于为什么手工生产硬盘，我先卖个关子，你看完这部分内容就能找到答案。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7014"><span data-slate-object="text" data-key="7015"><span data-slate-leaf="true" data-offset-key="7015:0" data-first-offset="true"><span data-slate-string="true">其实大多数虚拟机都是用文件来模拟硬盘的，即主机系统（HOST OS 即你使用的物理机系统 ）下特定格式的文件，虚拟机中操作系统的数据只是写入了这个文件中。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7016" id="sr-toc-6"><span data-slate-object="text" data-key="7017"><span data-slate-leaf="true" data-offset-key="7017:0" data-first-offset="true"><span data-slate-string="true">生产虚拟硬盘</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7018"><span data-slate-object="text" data-key="7019"><span data-slate-leaf="true" data-offset-key="7019:0" data-first-offset="true"><span data-slate-string="true">其实虚拟机只是用特定格式的文件来模拟硬盘，所以生产虚拟硬盘就变成了生成对应格式的文件，这就容易多了。我们要建立 100MB 的硬盘，这意味着要生成 100MB 的大文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7020"><span data-slate-object="text" data-key="7021"><span data-slate-leaf="true" data-offset-key="7021:0" data-first-offset="true"><span data-slate-string="true">下面我们用 Linux 下的 </span></span></span><span data-slate-object="text" data-key="7022"><span data-slate-leaf="true" data-offset-key="7022:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">dd 命令</span></span></span></span><span data-slate-object="text" data-key="7023"><span data-slate-leaf="true" data-offset-key="7023:0" data-first-offset="true"><span data-slate-string="true">（用指定大小的块拷贝一个文件，并在拷贝的同时进行指定的转换）生成 100MB 的纯二进制的文件（就是 1～100M 字节的文件里面填充为 0 ），如下所示。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7024"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7025"><span data-slate-object="text" data-key="7026"><span data-slate-leaf="true" data-offset-key="7026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">dd</span></span></span></span><span data-slate-object="text" data-key="7027"><span data-slate-leaf="true" data-offset-key="7027:0" data-first-offset="true"><span data-slate-string="true"> bs=512 </span></span></span><span data-slate-object="text" data-key="7028"><span data-slate-leaf="true" data-offset-key="7028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7029"><span data-slate-leaf="true" data-offset-key="7029:0" data-first-offset="true"><span data-slate-string="true">=/dev/zero of=hd.img count=204800</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7030"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7031"><span data-slate-object="text" data-key="7032"><span data-slate-leaf="true" data-offset-key="7032:0" data-first-offset="true"><span data-slate-string="true">;bs: 表示块大小，这里是 512 字节</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7033"><span data-slate-object="text" data-key="7034"><span data-slate-leaf="true" data-offset-key="7034:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="7035"><span data-slate-leaf="true" data-offset-key="7035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7036"><span data-slate-leaf="true" data-offset-key="7036:0" data-first-offset="true"><span data-slate-string="true">：表示输入文件，/dev/zero 就是 Linux 下专门返回 0 数据的设备文件，读取它就返回 0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7037"><span data-slate-object="text" data-key="7038"><span data-slate-leaf="true" data-offset-key="7038:0" data-first-offset="true"><span data-slate-string="true">;of：表示输出文件，即我们的硬盘文件。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7039"><span data-slate-object="text" data-key="7040"><span data-slate-leaf="true" data-offset-key="7040:0" data-first-offset="true"><span data-slate-string="true">;count：表示输出多少块</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7041"><span data-slate-object="text" data-key="7042"><span data-slate-leaf="true" data-offset-key="7042:0" data-first-offset="true"><span data-slate-string="true">执行以上命令就可以生成 100MB 的文件。文件数据为全 0。由于我们不用转换数据，就是需要全 0 的文件，所以 dd 命令只需要这几个参数就行。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7043" id="sr-toc-7"><span data-slate-object="text" data-key="7044"><span data-slate-leaf="true" data-offset-key="7044:0" data-first-offset="true"><span data-slate-string="true">格式化虚拟硬盘</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7045"><span data-slate-object="text" data-key="7046"><span data-slate-leaf="true" data-offset-key="7046:0" data-first-offset="true"><span data-slate-string="true">虚拟硬盘也需要格式化才能使用，所谓格式化就是在硬盘上建立文件系统。只有建立了文件系统，现有的成熟操作系统才能在其中存放数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7047"><span data-slate-object="text" data-key="7048"><span data-slate-leaf="true" data-offset-key="7048:0" data-first-offset="true"><span data-slate-string="true">可是，问题来了。虚拟硬盘毕竟是个文件，如何让 Linux 在一个文件上建立文件系统呢？这个问题我们要分成三步来解决。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7049"><span data-slate-object="text" data-key="7050"><span data-slate-leaf="true" data-offset-key="7050:0" data-first-offset="true"><span data-slate-string="true">第一步，把虚拟硬盘文件变成 Linux 下的回环设备，让 Linux 以为这是个设备。其实在 Linux 下文件可以是设备，设备可以是文件。下面我们用 losetup 命令，将 hd.img 变成 Linux 的回环设备，代码如下。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7051"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7052"><span data-slate-object="text" data-key="7053"><span data-slate-leaf="true" data-offset-key="7053:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_32d8fe40" data-attr-id="29306" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">sudo losetup /dev/loop0 hd.img</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7054"><span data-slate-object="text" data-key="7055"><span data-slate-leaf="true" data-offset-key="7055:0" data-first-offset="true"><span data-slate-string="true">第二步，将 losetup 命令用于设置回环设备。回环设备可以把文件虚拟成 Linux 块设备，用来模拟整个文件系统，让用户可以将其看作硬盘、光驱或软驱等设备，并且可用 mount 命令挂载当作目录来使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7056"><span data-slate-object="text" data-key="7057"><span data-slate-leaf="true" data-offset-key="7057:0" data-first-offset="true"><span data-slate-string="true">我们可以用 Linux 下的 mkfs.ext4 命令格式化这个 /dev/loop0 回环块设备，在里面建立 EXT4 文件系统。</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="7058"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7059"><span data-slate-object="text" data-key="7060"><span data-slate-leaf="true" data-offset-key="7060:0" data-first-offset="true"><span data-slate-string="true">sudo mkfs</span></span></span><span data-slate-object="text" data-key="7061"><span data-slate-leaf="true" data-offset-key="7061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.ext4</span></span></span></span><span data-slate-object="text" data-key="7062"><span data-slate-leaf="true" data-offset-key="7062:0" data-first-offset="true"><span data-slate-string="true"> -</span></span></span><span data-slate-object="text" data-key="7063"><span data-slate-leaf="true" data-offset-key="7063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">q</span></span></span></span><span data-slate-object="text" data-key="7064"><span data-slate-leaf="true" data-offset-key="7064:0" data-first-offset="true"><span data-slate-string="true"> /dev/loop0  </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7065"><span data-slate-object="text" data-key="7066"><span data-slate-leaf="true" data-offset-key="7066:0" data-first-offset="true"><span data-slate-string="true">第三步，我们用 Linux 下的 mount 命令，将 hd.img 文件当作块设备，把它挂载到事先建立的 hdisk 目录下，并在其中建立一个 boot，这也是后面安装 GRUB 需要的。如果能建立成功，就说明前面的工作都正确完成了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7067"><span data-slate-object="text" data-key="7068"><span data-slate-leaf="true" data-offset-key="7068:0" data-first-offset="true"><span data-slate-string="true">说到这里，也许你已经想到了我们要手工生成硬盘的原因。</span></span></span><span data-slate-object="text" data-key="7069"><span data-slate-leaf="true" data-offset-key="7069:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_933b7c6b" data-attr-id="29307" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这是因为 mount 命令只能识别在纯二进制文件上建立的文件系统，如果使用虚拟机自己生成的硬盘文件，mount 就无法识别我们的文件系统了。</span></span></span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7070"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7071"><span data-slate-object="text" data-key="7072"><span data-slate-leaf="true" data-offset-key="7072:0" data-first-offset="true"><span data-slate-string="true">sudo mount -o loop ./hd.img ./hdisk/ ; 挂载硬盘文件</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7073"><span data-slate-object="text" data-key="7074"><span data-slate-leaf="true" data-offset-key="7074:0" data-first-offset="true"><span data-slate-string="true">sudo </span></span></span><span data-slate-object="text" data-key="7075"><span data-slate-leaf="true" data-offset-key="7075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="7076"><span data-slate-leaf="true" data-offset-key="7076:0" data-first-offset="true"><span data-slate-string="true"> ./hdisk/boot/ ; 建立 boot 目录</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7077"><span data-slate-object="text" data-key="7078"><span data-slate-leaf="true" data-offset-key="7078:0" data-first-offset="true"><span data-slate-string="true">进行到这里，我们会发现 hdisk 目录下多了一个 boot 目录，这说明我们挂载成功了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7079" id="sr-toc-8"><span data-slate-object="text" data-key="7080"><span data-slate-leaf="true" data-offset-key="7080:0" data-first-offset="true"><span data-slate-string="true">安装 GRUB</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7081"><span data-slate-object="text" data-key="7082"><span data-slate-leaf="true" data-offset-key="7082:0" data-first-offset="true"><span data-slate-string="true">正常安装系统的情况下，Linux 会把 GRUB 安装在我们的物理硬盘上，可是我们现在要把 GRUB 安装在我们的虚拟硬盘上，而且我们的操作系统还没有安装程序。所以，我们得利用一下手上 Linux（HOST OS），通过 GRUB 的安装程序，把 GRUB 安装到指定的设备上（虚拟硬盘）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7083"><span data-slate-object="text" data-key="7084"><span data-slate-leaf="true" data-offset-key="7084:0" data-first-offset="true"><span data-slate-string="true">想要安装 GRUB 也不难，具体分为两步，如下所示。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7085"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7086"><span data-slate-object="text" data-key="7087"><span data-slate-leaf="true" data-offset-key="7087:0" data-first-offset="true"><span data-slate-string="true">第一步挂载虚拟硬盘文件为 loop0 回环设备</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7088"><span data-slate-object="text" data-key="7089"><span data-slate-leaf="true" data-offset-key="7089:0" data-first-offset="true"><span data-slate-string="true">sudo losetup /dev/loop0 hd.img</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7090"><span data-slate-object="text" data-key="7091"><span data-slate-leaf="true" data-offset-key="7091:0" data-first-offset="true"><span data-slate-string="true">sudo mount -o loop ./hd.img ./hdisk/ ; 挂载硬盘文件</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7092"><span data-slate-object="text" data-key="7093"><span data-slate-leaf="true" data-offset-key="7093:0" data-first-offset="true"><span data-slate-string="true">第二步安装 GRUB</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7094"><span data-slate-object="text" data-key="7095"><span data-slate-leaf="true" data-offset-key="7095:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_9d2bd5d7" data-attr-id="33131" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">sudo grub-install --boot-directory=./hdisk/boot/ --force --allow-floppy /dev/loop0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7096"><span data-slate-object="text" data-key="7097"><span data-slate-leaf="true" data-offset-key="7097:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_72b66d51" data-attr-id="33255" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">；--boot-directory 指向先前我们在虚拟硬盘中建立的 boot 目录。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7098"><span data-slate-object="text" data-key="7099"><span data-slate-leaf="true" data-offset-key="7099:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_73ef9728" data-attr-id="41253" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">；--force --allow-floppy ：指向我们的虚拟硬盘设备文件 /dev/loop0</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7100"><span data-slate-object="text" data-key="7101"><span data-slate-leaf="true" data-offset-key="7101:0" data-first-offset="true"><span data-slate-string="true">可以看到，现在 /hdisk/boot/ 目录下多了一个 grub 目录，表示我们的 GRUB 安装成功。请注意，这里还要在 /hdisk/boot/grub/ 目录下建立一个 </span></span></span><span data-slate-object="text" data-key="7102"><span data-slate-leaf="true" data-offset-key="7102:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">grub.cfg 文本文件</span></span></span></span><span data-slate-object="text" data-key="7103"><span data-slate-leaf="true" data-offset-key="7103:0" data-first-offset="true"><span data-slate-string="true">，GRUB 正是通过这个文件内容，查找到我们的操作系统映像文件的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7104"><span data-slate-object="text" data-key="7105"><span data-slate-leaf="true" data-offset-key="7105:0" data-first-offset="true"><span data-slate-string="true">我们需要在这个文件里写入如下内容。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7106"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7107"><span data-slate-object="text" data-key="7108"><span data-slate-leaf="true" data-offset-key="7108:0" data-first-offset="true"><span data-slate-string="true">menuentry </span></span></span><span data-slate-object="text" data-key="7109"><span data-slate-leaf="true" data-offset-key="7109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'HelloOS'</span></span></span></span><span data-slate-object="text" data-key="7110"><span data-slate-leaf="true" data-offset-key="7110:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7111"><span data-slate-object="text" data-key="7112"><span data-slate-leaf="true" data-offset-key="7112:0" data-first-offset="true"><span data-slate-string="true">insmod part_msdos</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7113"><span data-slate-object="text" data-key="7114"><span data-slate-leaf="true" data-offset-key="7114:0" data-first-offset="true"><span data-slate-string="true">insmod ext2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7115"><span data-slate-object="text" data-key="7116"><span data-slate-leaf="true" data-offset-key="7116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="7117"><span data-slate-leaf="true" data-offset-key="7117:0" data-first-offset="true"><span data-slate-string="true"> root=</span></span></span><span data-slate-object="text" data-key="7118"><span data-slate-leaf="true" data-offset-key="7118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'hd0,msdos1'</span></span></span></span><span data-slate-object="text" data-key="7119"><span data-slate-leaf="true" data-offset-key="7119:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7120"><span data-slate-leaf="true" data-offset-key="7120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#我们的硬盘只有一个分区所以是'hd0,msdos1'</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7121"><span data-slate-object="text" data-key="7122"><span data-slate-leaf="true" data-offset-key="7122:0" data-first-offset="true"><span data-slate-string="true">multiboot2 /boot/HelloOS.eki </span></span></span><span data-slate-object="text" data-key="7123"><span data-slate-leaf="true" data-offset-key="7123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#加载 boot 目录下的 HelloOS.eki 文件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7124"><span data-slate-object="text" data-key="7125"><span data-slate-leaf="true" data-offset-key="7125:0" data-first-offset="true"><span data-slate-string="true">boot </span></span></span><span data-slate-object="text" data-key="7126"><span data-slate-leaf="true" data-offset-key="7126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#引导启动</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7127"><span data-slate-object="text" data-key="7128"><span data-slate-leaf="true" data-offset-key="7128:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7129"><span data-slate-object="text" data-key="7130"><span data-slate-leaf="true" data-offset-key="7130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="7131"><span data-slate-leaf="true" data-offset-key="7131:0" data-first-offset="true"><span data-slate-string="true"> timeout_style=menu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7132"><span data-slate-object="text" data-key="7133"><span data-slate-leaf="true" data-offset-key="7133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7134"><span data-slate-leaf="true" data-offset-key="7134:0" data-first-offset="true"><span data-slate-string="true"> [ </span></span></span><span data-slate-object="text" data-key="7135"><span data-slate-leaf="true" data-offset-key="7135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="7136"><span data-slate-leaf="true" data-offset-key="7136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${timeout}</span></span></span></span></span><span data-slate-object="text" data-key="7137"><span data-slate-leaf="true" data-offset-key="7137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="7138"><span data-slate-leaf="true" data-offset-key="7138:0" data-first-offset="true"><span data-slate-string="true"> = 0 ]; </span></span></span><span data-slate-object="text" data-key="7139"><span data-slate-leaf="true" data-offset-key="7139:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">then</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7140"><span data-slate-object="text" data-key="7141"><span data-slate-leaf="true" data-offset-key="7141:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7142"><span data-slate-leaf="true" data-offset-key="7142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="7143"><span data-slate-leaf="true" data-offset-key="7143:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7144"><span data-slate-leaf="true" data-offset-key="7144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">timeout</span></span></span></span><span data-slate-object="text" data-key="7145"><span data-slate-leaf="true" data-offset-key="7145:0" data-first-offset="true"><span data-slate-string="true">=10 </span></span></span><span data-slate-object="text" data-key="7146"><span data-slate-leaf="true" data-offset-key="7146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#等待 10 秒钟自动启动</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7147"><span data-slate-object="text" data-key="7148"><span data-slate-leaf="true" data-offset-key="7148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fi</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7149" id="sr-toc-9"><span data-slate-object="text" data-key="7150"><span data-slate-leaf="true" data-offset-key="7150:0" data-first-offset="true"><span data-slate-string="true">转换虚拟硬盘格式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7151"><span data-slate-object="text" data-key="7152"><span data-slate-leaf="true" data-offset-key="7152:0" data-first-offset="true"><span data-slate-string="true">你可能会好奇，我们前面好不容易生产了 mount 命令能识别的虚拟硬盘，这里为什么又要转换虚拟硬盘的格式呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7153"><span data-slate-object="text" data-key="7154"><span data-slate-leaf="true" data-offset-key="7154:0" data-first-offset="true"><span data-slate-string="true">这是因为这个纯二进制格式只能被我们使用的 Linux 系统识别，但不能被虚拟机本身识别，但是我们最终目的却是让这个虚拟机加载这个虚拟硬盘，从而启动其中的由我们开发的操作系统。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7155"><span data-slate-object="text" data-key="7156"><span data-slate-leaf="true" data-offset-key="7156:0" data-first-offset="true"><span data-slate-string="true">好在虚拟机提供了专用的转换格式的工具，我们只要输入一行命令即可。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7157"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7158"><span data-slate-object="text" data-key="7159"><span data-slate-leaf="true" data-offset-key="7159:0" data-first-offset="true"><span data-slate-string="true">VBoxManage convertfromraw ./hd.img --</span></span></span><span data-slate-object="text" data-key="7160"><span data-slate-leaf="true" data-offset-key="7160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="7161"><span data-slate-leaf="true" data-offset-key="7161:0" data-first-offset="true"><span data-slate-string="true"> VDI ./hd.vdi</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7162"><span data-slate-object="text" data-key="7163"><span data-slate-leaf="true" data-offset-key="7163:0" data-first-offset="true"><span data-slate-string="true">;convertfromraw 指向原始格式文件</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7164"><span data-slate-object="text" data-key="7165"><span data-slate-leaf="true" data-offset-key="7165:0" data-first-offset="true"><span data-slate-string="true">；--</span></span></span><span data-slate-object="text" data-key="7166"><span data-slate-leaf="true" data-offset-key="7166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="7167"><span data-slate-leaf="true" data-offset-key="7167:0" data-first-offset="true"><span data-slate-string="true"> VDI  表示转换成虚拟需要的 VDI 格式</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7168" id="sr-toc-10"><span data-slate-object="text" data-key="7169"><span data-slate-leaf="true" data-offset-key="7169:0" data-first-offset="true"><span data-slate-string="true">安装虚拟硬盘</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7170"><span data-slate-object="text" data-key="7171"><span data-slate-leaf="true" data-offset-key="7171:0" data-first-offset="true"><span data-slate-string="true">好了，到这里我们已经生成了 VDI 格式的虚拟硬盘，这正是我们虚拟机所需要的。然而虚拟硬盘必须要安装虚拟机才可以运行，也就是这个 hd.vdi 文件要和虚拟机软件联系起来。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7172"><span data-slate-object="text" data-key="7173"><span data-slate-leaf="true" data-offset-key="7173:0" data-first-offset="true"><span data-slate-string="true">因为我们之前在建立虚拟机时并没有配置硬盘相关的信息，所以这里需要我们进行手工配置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7174"><span data-slate-object="text" data-key="7175"><span data-slate-leaf="true" data-offset-key="7175:0" data-first-offset="true"><span data-slate-string="true">配置虚拟硬盘分两步：第一步，配置硬盘控制器，我们使用 SATA 的硬盘，其控制器是 intelAHCI；第二步，挂载虚拟硬盘文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7176"><span data-slate-object="text" data-key="7177"><span data-slate-leaf="true" data-offset-key="7177:0" data-first-offset="true"><span data-slate-string="true">具体操作如下所示。</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="7178"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7179"><span data-slate-object="text" data-key="7180"><span data-slate-leaf="true" data-offset-key="7180:0" data-first-offset="true"><span data-slate-string="true">#第一步 SATA 的硬盘其控制器是 intelAHCI</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7181"><span data-slate-object="text" data-key="7182"><span data-slate-leaf="true" data-offset-key="7182:0" data-first-offset="true"><span data-slate-string="true">VBoxManage storagectl HelloOS </span></span></span><span data-slate-object="text" data-key="7183"><span data-slate-leaf="true" data-offset-key="7183:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--name</span></span></span></span><span data-slate-object="text" data-key="7184"><span data-slate-leaf="true" data-offset-key="7184:0" data-first-offset="true"><span data-slate-string="true"> "SATA" </span></span></span><span data-slate-object="text" data-key="7185"><span data-slate-leaf="true" data-offset-key="7185:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--add</span></span></span></span><span data-slate-object="text" data-key="7186"><span data-slate-leaf="true" data-offset-key="7186:0" data-first-offset="true"><span data-slate-string="true"> sata </span></span></span><span data-slate-object="text" data-key="7187"><span data-slate-leaf="true" data-offset-key="7187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--controller</span></span></span></span><span data-slate-object="text" data-key="7188"><span data-slate-leaf="true" data-offset-key="7188:0" data-first-offset="true"><span data-slate-string="true"> IntelAhci </span></span></span><span data-slate-object="text" data-key="7189"><span data-slate-leaf="true" data-offset-key="7189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--portcount</span></span></span></span><span data-slate-object="text" data-key="7190"><span data-slate-leaf="true" data-offset-key="7190:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7191"><span data-slate-leaf="true" data-offset-key="7191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7192"><span data-slate-object="text" data-key="7193"><span data-slate-leaf="true" data-offset-key="7193:0" data-first-offset="true"><span data-slate-string="true">#第二步</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7194"><span data-slate-object="text" data-key="7195"><span data-slate-leaf="true" data-offset-key="7195:0" data-first-offset="true"><span data-slate-string="true">VBoxManage closemedium disk ./hd</span></span></span><span data-slate-object="text" data-key="7196"><span data-slate-leaf="true" data-offset-key="7196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.vdi</span></span></span></span><span data-slate-object="text" data-key="7197"><span data-slate-leaf="true" data-offset-key="7197:0" data-first-offset="true"><span data-slate-string="true"> #删除虚拟硬盘 UUID 并重新分配</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7198"><span data-slate-object="text" data-key="7199"><span data-slate-leaf="true" data-offset-key="7199:0" data-first-offset="true"><span data-slate-string="true">#将虚拟硬盘挂到虚拟机的硬盘控制器</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7200"><span data-slate-object="text" data-key="7201"><span data-slate-leaf="true" data-offset-key="7201:0" data-first-offset="true"><span data-slate-string="true">VBoxManage storageattach HelloOS </span></span></span><span data-slate-object="text" data-key="7202"><span data-slate-leaf="true" data-offset-key="7202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--storagectl</span></span></span></span><span data-slate-object="text" data-key="7203"><span data-slate-leaf="true" data-offset-key="7203:0" data-first-offset="true"><span data-slate-string="true"> "SATA" </span></span></span><span data-slate-object="text" data-key="7204"><span data-slate-leaf="true" data-offset-key="7204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--port</span></span></span></span><span data-slate-object="text" data-key="7205"><span data-slate-leaf="true" data-offset-key="7205:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7206"><span data-slate-leaf="true" data-offset-key="7206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7207"><span data-slate-leaf="true" data-offset-key="7207:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7208"><span data-slate-leaf="true" data-offset-key="7208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--device</span></span></span></span><span data-slate-object="text" data-key="7209"><span data-slate-leaf="true" data-offset-key="7209:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7210"><span data-slate-leaf="true" data-offset-key="7210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7211"><span data-slate-leaf="true" data-offset-key="7211:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7212"><span data-slate-leaf="true" data-offset-key="7212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--type</span></span></span></span><span data-slate-object="text" data-key="7213"><span data-slate-leaf="true" data-offset-key="7213:0" data-first-offset="true"><span data-slate-string="true"> hdd </span></span></span><span data-slate-object="text" data-key="7214"><span data-slate-leaf="true" data-offset-key="7214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--medium</span></span></span></span><span data-slate-object="text" data-key="7215"><span data-slate-leaf="true" data-offset-key="7215:0" data-first-offset="true"><span data-slate-string="true"> ./hd</span></span></span><span data-slate-object="text" data-key="7216"><span data-slate-leaf="true" data-offset-key="7216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.vdi</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7217"><span data-slate-object="text" data-key="7218"><span data-slate-leaf="true" data-offset-key="7218:0" data-first-offset="true"><span data-slate-string="true">因为 VirtualBox 虚拟机用 UUID 管理硬盘，所以每次挂载硬盘时，都需要删除虚拟硬盘的 UUID 并重新分配。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7219" id="sr-toc-11"><span data-slate-object="text" data-key="7220"><span data-slate-leaf="true" data-offset-key="7220:0" data-first-offset="true"><span data-slate-string="true">最成功的失败</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7221"><span data-slate-object="text" data-key="7222"><span data-slate-leaf="true" data-offset-key="7222:0" data-first-offset="true"><span data-slate-string="true">现在硬盘也安装好了，下面终于可以启动我们的虚拟电脑了，我们依然通过命令启动，在 Linux 终端中输入如下命令就可以了。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7223"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7224"><span data-slate-object="text" data-key="7225"><span data-slate-leaf="true" data-offset-key="7225:0" data-first-offset="true"><span data-slate-string="true">VBoxManage startvm HelloOS </span></span></span><span data-slate-object="text" data-key="7226"><span data-slate-leaf="true" data-offset-key="7226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#启动虚拟机</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7227"><span data-slate-object="text" data-key="7228"><span data-slate-leaf="true" data-offset-key="7228:0" data-first-offset="true"><span data-slate-string="true">输入以上命令就会出现以下界面，出现 GRUB 引导菜单。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7229"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f7/8d/f7a091c67a53582255117f3790904a8d.jpg?wh=740*553"></div><div>虚拟机启动</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7230"><span data-slate-object="text" data-key="7231"><span data-slate-leaf="true" data-offset-key="7231:0" data-first-offset="true"><span data-slate-string="true">直接按下回车键，就能选择我们的 HelloOS，GRUB 就会加载我们的 HelloOS，但是会出现如下错误。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7232"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/80/ee/809e93a2e3bdce9f5d3e0ac7d699feee.jpg?wh=740*553"></div><div>虚拟机 GRUB 未找到文件</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7233"><span data-slate-object="text" data-key="7234"><span data-slate-leaf="true" data-offset-key="7234:0" data-first-offset="true"><span data-slate-string="true">上面的错误显示，GRUB 没有找到 HelloOS.eki 文件，这是因为我们从来没有向虚拟硬盘中放入 HelloOS.eki 文件，所以才会失败。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7235"><span data-slate-object="text" data-key="7236"><span data-slate-leaf="true" data-offset-key="7236:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">但这是我们最成功的失败，因为我们配置好了虚拟机，手动建造了硬盘，并在其上安装了 GRUB，到这里我们运行测试环境已经准备好了。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7237"><span data-slate-object="text" data-key="7238"><span data-slate-leaf="true" data-offset-key="7238:0" data-first-offset="true"><span data-slate-string="true">其实你不必太过担心，等我们完成了二级引导器的时候，这个问题会迎刃而解。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7239" id="sr-toc-12"><span data-slate-object="text" data-key="7240"><span data-slate-leaf="true" data-offset-key="7240:0" data-first-offset="true"><span data-slate-string="true">重点回顾</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7241"><span data-slate-object="text" data-key="7242"><span data-slate-leaf="true" data-offset-key="7242:0" data-first-offset="true"><span data-slate-string="true">希望今天这节课给你带来成就感，虽然我们才走出了万里长征的第一步。为了这一步我们准备了很多。但是我们始终没忘记这一课程的目的，即我们要从 GRUB 老大哥手里接过权柄，控制计算机王国，为此，我们完成了后面这三个工作。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7243"><div data-slate-type="list-line" data-slate-object="block" data-key="7244"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7245"><span data-slate-leaf="true" data-offset-key="7245:0" data-first-offset="true"><span data-slate-string="true">我们了解了内核映像格式，以便我们对编译产生的内核程序文件进行封装打包。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="7246"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7247"><span data-slate-leaf="true" data-offset-key="7247:0" data-first-offset="true"><span data-slate-string="true">为了方便测试我们的操作系统，我们了解并安装了虚拟机。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="7248"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="7249"><span data-slate-leaf="true" data-offset-key="7249:0" data-first-offset="true"><span data-slate-string="true">手动建立了虚拟硬盘，对其格式化，在其中手动安装了 GRUB 引导器，并且启动了虚拟电脑。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7250"><span data-slate-object="text" data-key="7251"><span data-slate-leaf="true" data-offset-key="7251:0" data-first-offset="true"><span data-slate-string="true">虽然我们启动虚拟电脑失败了，但是对我们而言却是巨大的成功，因为它标志着我们测试运行内核的环境已经成功建立，下一课我们将继续实现二级引导器。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7252" id="sr-toc-13"><span data-slate-object="text" data-key="7253"><span data-slate-leaf="true" data-offset-key="7253:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7254"><span data-slate-object="text" data-key="7255"><span data-slate-leaf="true" data-offset-key="7255:0" data-first-offset="true"><span data-slate-string="true">请问，我们为什么要把虚拟硬盘格式化成 ext4 文件系统格式呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7256"><span data-slate-object="text" data-key="7257"><span data-slate-leaf="true" data-offset-key="7257:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区跟我交流探讨，如果你身边有对写操作系统感兴趣的朋友，也欢迎把这节课分享给他，一起学习。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7258"><span data-slate-object="text" data-key="7259"><span data-slate-leaf="true" data-offset-key="7259:0" data-first-offset="true"><span data-slate-string="true">好，我是 LMOS，我们下节课见！</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>33</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-14">精选留言 (104)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/52/8e/07db8450.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>第九天魔王</span></div><span>置顶</span></div><div>已完成实验，有几个心得分享一下。
1，如果主机就是 Linux 比如 Ubuntu，则完全按照东哥的教程做即可，即 Linux 主机安装虚拟机启动 HelloOS。
2，如果主机是 Windows，启动虚拟机运行 Ubuntu，很多童鞋担心虚拟机 Ubuntu 里再运行虚拟机启动 HelloOS，这样就会套娃。其实可以避免套娃的。在你的虚拟机，也就是 Ubuntu 环境下，完成 hd.img 的创建，文件系统的格式化，grub 的安装后，生成最终的 hd.img 文件。然后把 hd.img 文件通过命令变成 vdi 文件即可。然后在你的 WIN 主机环境下，新建一个虚拟机，加载 vdi 即可。也就是说此时 HelloOS 和 Ubuntu 都是你 WIN 环境下并列的两个虚拟机，这样就可以避免套娃了。
3，如果虚拟机使用的不是 VirtualBox， 面是 vmware，在生成 hd.img 后，可以使用 starwindconverter 工具（网上下载，WIN 下运行），这个工具可以把 img 转换为各种格式，比如 vmware 的 vmdk 文件。然后 vmware 创建一个新的虚拟机，硬盘选择这个 vmdk 文件，就可以加载 HelloOS 了。
4，如果 HelloOS 加载成功，但是提示'hd0,msdos1' 错误，则重新制作镜像，并且修改 grub.cfg 里的这行为'hd0,msdos1' 为'hd0' 即可。</div><div><p>编辑回复: 6666。十分感谢你的分享，已置顶供后面同学参考。</p></div><div><div>2021-05-31</div><div><div><i></i><span>14</span></div><div><i></i><span>114</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>neohope</span></div><span>置顶</span></div><div>【更新】对于使用 Windows、MacOS 的同学，或不熟悉命令行的同学可以这样操作【不需要套娃，也不用做硬盘格式转换】：
1、先安装一个 Linux 虚拟机 A，比如 Ubuntu18 或 Ubuntu20
2、关闭虚拟机，在这个虚拟机上，用向导添加一个新硬盘 hd.vdi
3、启动虚拟机 A
4、创建新硬盘挂载目录
cd ~
mkdir hdisk
5、挂载新硬盘，创建 ext4 文件系统【当前应该只有两块硬盘，所以操作 sdb，根据你实际情况调整】
sudo mkfs.ext4 /dev/sdb
sudo mount /dev/sdb hdisk
6、创建 boot 目录
sudo mkdir hdisk/boot
7、安装 grub 到新硬盘
sudo grub-install --boot-directory=./hdisk/boot/--force --allow-floppy /dev/sdb
8、拷贝 HelloOS.eki 到 hdisk/boot 目录
9、创建 grub.cfg，用你喜欢的编辑器就好【其中 root 可以只写'hd0'】
sudo vi hdisk/boot/grub/grub.cfg
10、关闭虚拟机 A
11、创建虚拟机 B，选择类型 “其他 Linux”，硬盘不要新建，直接选择 hd.vdi
12、开启虚拟机 B，就可以看到 Grub 界面了

以后要发布内容，就关闭虚拟机 B，开启虚拟机 A 进行操作；
要看效果，就关闭虚拟机 A，开启虚拟机 B；
硬盘以后也不需要重复创建，只要保证 A、B 不同时开启就好了；</div><div><p>作者回复：谢谢你的分享，让更多的同学明白了 如何 建立 环境</p></div><div><div>2021-06-01</div><div><div><i></i><span>18</span></div><div><i></i><span>55</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1c/f7/36/ccf3b5d1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Vic</span></div><span>置顶</span></div><div>终于试成功了，真开心，断断续续搞了快一个星期。
因为我的主机是 mac, 谢谢第九天魔王大、neohoped 大和老王大的分享，免去套娃，少走很多弯路。

0. 在主机 Mac 上安装 Virtual Box 6.1，开了 2 个虚拟机：
虚拟机 1: HelloOS
虚拟机 2: Linux Ubuntu 20.04 (server)

1. 依照老师课程介绍安装虚拟机 1: HelloOS
2. 新增虚拟机 2: Linux Ubuntu 20.04
但建议网络可用 bridge 桥接模式不用缺省的 NAT，方便从虛擬機 2 傳檔案到 mac 主機。

       例如我的虚拟机 2 的网络设定： 

连接方式：桥接网卡

界面名称： en0: Wi-Fi (AirPort)

3. 启动虛擬機 2
在家目錄执行以下命令建立虚拟磁碟
dd bs=512 if=/dev/zero of=hd.img count=204800

4. sudo losetup /dev/loop0 hd.img

会遇到 losetup: hd.img: failing to set up loop device: Device or resource busy
可執行以下命令查看：
sudo losetup

列出 /dev/loop0 到 /dev/loop5 都被使用了，挑一个没人用的例如： /dev/loop6

sudo losetup /dev/loop6 hd.img

5. 进行格式化：请依照实际使用的 loop 设备号码更改，我这里用的是 /dev/loop6

sudo mkfs.ext4 -q /dev/loop6

6. 建立 hdisk 目录 mkdir hdisk

    挂载硬盘文件

     sudo mount -o loop ./hd.img ./hdisk/

     建立 boot 目录 sudo mkdir  ./hdisk/boot/

7.   安装 grub 请依照实际使用的 loop 设备号码更改，我这里用的是 /dev/loop6

      sudo grub-install --boot-directory=./hdisk/boot/--force --allow-floppy /dev/loop6

8.  创建 grub.cfg

      安装好 grub，应该可看到 ./hdisk/boot/ 下多了一个 grub 目录，

      cd 进去 ./hdisk/boot/grub/

      里面没有 grub.cfg，要自行创建，文件内容请参考老师课程

9. 回到 mac 上
将虚拟机 2 上刚做好的 hd.img 透过 scp 传回我的 mac，例如：

scp [vic@192.168.50.27](mailto:vic@192.168.50.27):hd.img  .  (hd.img 是放在虚拟机 2 的家目录，最后有个小点，表示将档案拷到现在这个目录)

10. 转换虚拟机 1 要用的硬盘格式为 VDI
在 mac 上执行

VBoxManage convertfromraw ./hd.img --format VDI ./hd.vdi

此时应可看到除了原来的 hd.img，多了一个 hd.vdi 的档案 (约 13MB)

11. 在 mac 的 / Users/vic/VirtualBox VMs 目录执行以下命令：

VBoxManage storagectl HelloOS --name "SATA" --add sata --controller IntelAhci --portcount 1
VBoxManage closemedium disk ./hd.vdi
VBoxManage storageattach HelloOS --storagectl "SATA" --port 1 --device 0 --type hdd --medium ./hd.vdi

12. 在 mac 上执行

VBoxManage startvm HelloOS

13. 如果看到虚拟机 1 的 GRUB 菜单画面出现

*HelloOS

按下回车键看到

error: file '/boot/HelloOS.eki' not found.

error: you need to load the kernel first.

就大功告成

谢谢老师的精彩课程
</div><div><p>作者回复：你好，你的经验可以多多分享</p></div><div><div>2021-06-05</div><div><div><i></i><span>14</span></div><div><i></i><span>47</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1f/9e/ba/4b60c587.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Jayying</span></div><span>置顶</span></div><div>终于显示出来了。
记录一下我遇到的几个问题：
1. grub-install 时遇到 EFI 的问题， 添加 参数 --target i386-pc
2. 挂载 /dev/loop0 时可能遇到 device busy， 换一个就行了，比如 loop8
3. 进入了 grub，但是没有看到 HelloOS；这个是我自己头铁，把老师第二行命令删掉了，因为每次执行这条命令都会报错， 按老师的命令写就可以了：
VBoxManage closemedium disk ./hd.vdi #删除虚拟硬盘 UUID 并重新分配
4. 看到 HelloOS，但是进入显示找不到 hd0,msdos1 什么的。在我第三步坑那里，我 ls 看到的是 hd0，所以把 hd0,msdos1 改成 hd0 就可以了
</div><div><p>作者回复：老铁 666 啊</p></div><div><div>2021-07-31</div><div><div><i></i><span>5</span></div><div><i></i><span>12</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1c/f7/36/ccf3b5d1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Vic</span></div><span>置顶</span></div><div>超过 2000 字，补发
后记：

卡了很久，可以看到 GRUB，但看不到 * HelloOS

2 个疑点：

(1) 在虚拟机 2 里 /dev/loop0 被占用，改用 /dev/loop6，是不是还有哪里要改，没改对

(2) 在 grub-install 时遇到 ext2 不 support embedding 的警告

grub-install: warning: File system `ext2'doesn't support embedding.
grub-install: warning: Embedding is not possible.  GRUB can only be installed in this setup by using blocklists.  However, blocklists are UNRELIABLE and their use is discouraged..
Installation finished. No error reported.

但在物理机 18.04 也遇到，但不影响，只是个警告 (warning)，不碍事。

才发现自己 grub.cfg 放错位置，放在 hdisk/boot/，而不是放在 hdisk/boot/grub 里

谢谢老师的精彩教程</div><div><p>作者回复：你好，这个警告可以忽略</p></div><div><div>2021-06-05</div><div><div><i></i><span>4</span></div><div><i></i><span>10</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 青玉白露</span></div><span>置顶</span></div><div>参考 neohope 的方法，其实在 Mac 和 Windows 环境下利用 VirtualBox 可以很方便的进行测试，
只需要建立两个虚拟机，一个 ubuntu 一个是我们的 COSMOS，自己在 Mac 上进行了测试，具体的细节可以参考博客：
https://blog.csdn.net/ll15982534415/article/details/118771286</div><div><p>作者回复：哈哈 阔以</p></div><div><div>2021-07-15</div><div><div><i></i></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>springXu</span></div><span>置顶</span></div><div>这节课是环境搭建的操作步骤，还没开始真正的动手写代码的要求。
这些操作首先生成内核文件 kernel.img 文件，这个文件应该是启动的文件。猜测把这个改成 HelloOS.eki 文件放到 grub 配置的目录下，不会出现 not found 的提示。至于显示什么操作就知道了。
二级引导器应该是 initldrimh.bin 文件的内容。 这部分内容估计是下节课要讲节的内容吧。 三个文件，一个汇编文件用于生成 grub 格式的头文件，两个. c 的文件。 周三继续听下文播讲。
为什么用 ext4 是为了 grub 读取的支持？又或者 cosmos 系统支持 ext4 的文件系统？</div><div><p>作者回复：用文件系统 是为了 linux 可以像其中写入文件（我们的内核）</p></div><div><div>2021-05-31</div><div><div><i></i><span>3</span></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/d0/fb/a02881f7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fx</span></div><span>置顶</span></div><div>## Ubuntu18.04 最全排坑指南 

1. virtualbox 安装问题无法定位资源包，直接'sudo apt-get install virtualbox', 不要指定版本，安装后版本为 5.2.42，目前不影响实验
2. loop 资源占用问题，参考前面的评论
3. grub 安装时 efi 方式启动出现问题，指定 '--target i386-pc' 出现找不到该文件，若能在系统文件中找到该文件则指定路径查找即可
```
cd /tmp   # 进入 efi 所在的文件夹，名字可能会不一样，按照报错查找不到的路径为准
sudo apt-get download grub-pc-bin
dpkg-deb -R grub-pc-bin_2.02~beta2-36ubuntu3.16_amd64.deb grub/
sudo mv grub/usr/lib/grub/i386-pc//usr/lib/grub/
```
4. 在执行步骤时我一开始是直接忽略了 3，继续往下也不会出现报错，但最后启动虚拟机时出现'FATAL:No bootable medium ....'，查看评论需要重新创建虚拟硬盘，于是直接在文件系统删除新建立的能看到的文件，并重启计算机，就能从头开始，否则会出现某些文件已存在的报错但不知道如何删除。最终解决了坑三成功完成实验。</div><div><p>作者回复: 666666</p></div><div><div>2021-08-26</div><div><div><i></i></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Shinymimiq</span></div><span>置顶</span></div><div>我来优化一下 Mac 小伙伴的开发流程，直接能用 Mac 编译，并修改我们 Cosmos 的硬盘镜像文件了，基本可以不需要启动 Ubuntu 虚拟机了。

首先得按评论区里 Veek 或者 Neohoped 大佬的教程得到一个 hd.vdi 之类的镜像文件

然后使用 Virtual Box 提供的 VBoxManage clonehd 命令，把它转成 raw image

    VBoxManage clonehd ~/VirtualBox\ VMs/MyUbuntu/hd.vdi image.img --format raw

这时候在 Virtual Box 的 Virtual Media Manager 里是会多一个 image.img 的硬盘
然后我们只要把 Cosmos 虚拟机的启动硬盘改成这个 image.img 就行了

我们修改完 OS 代码之后，可以把 image.img 加载到 MacOS 系统中
最简单的方式是这样

    open image.img

这时候系统的 /Volumes 目录下会多出一个 Untitled 1 文件夹（如果你没有其他 Untitled 镜像加载的话）
之后就可以把相关文件比如 Cosmos.eki 拷贝到 /Volumes/Untitled\ 1/boot 下

完成修改之后，接着使用

    umount /Volumes/Untitled\ 1
	
来取消镜像文件的加载

这时候再启动我们的 Cosmos 虚拟机就是直接跑更新后的文件了。

至于编译源代码的话，我们可以使用 Docker 来帮助我们生成一个基于 Linux x64 的工具链，这样就能直接编译，并且能直接使用课程中提供的 lmoskrlimg，（原来因为文件格式的问题在 Mac 下无法直接使用这个工具）

首先安装好 Docker Desktop
随便新建一个目录
mkdir cosmos_build_env
在里面创建一个 Dockerfile, 我在这里直接把内容 echo 到新文件里面

echo "FROM dockcross/linux-x64

ENV DEFAULT_DOCKCROSS_IMAGE cosmos_build
RUN apt-get install -y nasm" &gt; cosmos_build_env/Dockerfile


接下来创建 Docker image

    docker build cosmos_build_env -t cosmos_build

创建完之后使用

    docker run cosmos_build &gt; cosmos_build
    chmod +x cosmos_build

然后得到的这个 cosmos_build 就可以用来编译我们的 cosmos
例如

    ./cosmos_build make release</div><div><p>作者回复：你好，这个厉害了</p></div><div><div>2021-06-11</div><div><div><i></i><span>3</span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/22/46/6b/e766c18d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 老王</span></div><span>置顶</span></div><div>在整个操作中
安装 GRUB 这一步：
sudo grub-install --boot-directory=./hdisk/boot/--force --allow-floppy /dev/loop0
在 ubutnu16.04 下会报告一下问题
Installing for i386-pc platform.
grub-install: warning: File system `ext2'doesn't support embedding.
grub-install：错误： 无法嵌入，但在跨盘安装时是必须的.
我尝试修复也不成功，后面换 ubutnu18.04，一次成功
但是如果创建回环设备这一步
sudo losetup /dev/loop0 hd.img
出现 "losetup: hd.img：设置回环设备失败：设备或资源忙"
那么就使用 ls /dev/loop*  查看下
brw-rw---- 1 root disk  7,   0 6 月   1 12:13 /dev/loop0
brw-rw---- 1 root disk  7,   1 6 月   1 12:13 /dev/loop1
brw-rw---- 1 root disk  7,   2 6 月   1 12:13 /dev/loop2
brw-rw---- 1 root disk  7,   3 6 月   1 12:13 /dev/loop3
brw-rw---- 1 root disk  7,   4 6 月   1 12:13 /dev/loop4
brw-rw---- 1 root disk  7,   5 6 月   1 12:13 /dev/loop5
brw-rw---- 1 root disk  7,   6 6 月   1 12:13 /dev/loop6
brw-rw---- 1 root disk  7,   7 6 月   1 12:13 /dev/loop7
brw-rw---- 1 root disk  7,   8 6 月   1 12:13 /dev/loop8
crw-rw---- 1 root disk 10, 237 6 月   1 12:13 /dev/loop-control
那么说明 /dev/loop9 是空的，可以使用
sudo losetup /dev/loop9 hd.img 可以创建成功
其他操作为了防止不套娃可以参 "第几天魔王" 的操作</div><div><p>作者回复：是的 </p></div><div><div>2021-06-01</div><div><div><i></i><span>7</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIEKvBbXQu8uZK33anyFiaVISLFv289ymic0InS3oLia0oicTMlyJ3H4H0mCvMhTM4xGIqfBRpnuiaa7Iw/132"></div></div><div><div><div><span>Chaos</span></div><span>置顶</span></div><div>没想到这一个步骤花费了好几天，现在成功在 mac m1 的 CPU 环境下通过 QEMU 跑起来了 hello world。相关细节可以查看我的仓库 https://github.com/Rlyown/ToyOS。
这里简要说明一下：成功的关键是借助了 Docker 和 QEMU。Docker 可以通过创建 x86 的 Linux 容器来完成 ext4 磁盘的分区、格式化以及安装 grub。而 QEMU 则是用来启动内核的虚拟机。

以下步骤均在 x86 的容器中完成：
1. 通过命令创建磁盘镜像，本人选择之创建 32M 的镜像
  dd if=/dev/zero of=$DISK bs=512 count=$((32 * 1024 * 1024 / 512))
2. 对磁盘进行分区，这里只做了一个分区。分区的目的是避免后续执行 grub-install 安装时报错。
  parted -s $DISK mklabel msdos
  parted -s $DISK mkpart primary 2048s 100%
  parted -s $DISK set 1 boot on
3. 查找一个空闲的回环设备映射到镜像文件，假设是 /dev/loop0
  losetup --find --show --partscan ${DISK}
4. 如果像我一样是 arm 架构借助了 x86 容器，那么这个步骤很关键。因为容器出于某种原因，映射了带分区的镜像文件后，找不到类似 /dev/loop0p1 的分区设备。这一步就是手动创建这个分区设备。
	PARTITIONS=$(lsblk --raw --output "MAJ:MIN" --noheadings ${LOOPDEV} | tail -n +2)
	COUNTER=1
	for i in $PARTITIONS; do
		MAJ=$(echo $i | cut -d: -f1)
		MIN=$(echo $i | cut -d: -f2)
		if [ ! -e "${LOOPDEV} p${COUNTER}" ]; then mknod ${LOOPDEV} p${COUNTER} b $MAJ $MIN; fi
		COUNTER=$((COUNTER + 1))
	done
5. 格式化分区。
  mkfs.ext4 -q /dev/loop0p1
6. 后面就可以挂载这个分区，然后安装 grub。这里注意挂载时使用的设备是分区 /dev/loop0p1，而进行 grub-install 时使用的设备是镜像 /dev/loop0。
  mkdir ISO
  mount /dev/loop0p1 ISO
  mkdir -p ISO/boot/grub
  grub-install --boot-directory=ISO/boot --force --allow-floppy --target=i386-pc /dev/loop0
  cp grub.cfg ISO/boot/grub
7. 取消挂载和映射，并删除手动创建的分区设备。
  umount ISO
  lostup -d /dev/loop0
  rm -f /dev/loop0p1
8. 通过 qemu 模拟 x86 虚拟机
  qemu-system-i386 -m 1024 -drive format=raw,file=disk.img</div><div><p>作者回复：太强了</p></div><div><div>2022-04-15</div><div><div><i></i><span>2</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 黎标松</span></div><span>置顶</span></div><div>第一次留言：
我的宿主机是 windows 10 系统，用系统自带的 Hyper-V 虚拟机跑 ubuntu，为了和老师一致，我又下了 vitural Box，按照老师的步骤键虚拟机，这样避免套娃（我试过在虚拟机中跑虚拟机，真的很慢）；生成虚拟硬盘的过程和老师一样；第一个坑是第一步，设置回环设备：sudo losetup /dev/loop0 hd.img 这里可以用命令 ls /dev/loop* 查看，看看哪个没有被占用（loop0-11 一个一个试也行），以实际为准；第二个将 hd.img 文件生成 DVI 文件后，（不用在虚拟机中配置虚拟硬盘）把 ubuntu 虚拟机中的 DVI 文件共享到 windows 系统里面（可以参考这篇文章：https://blog.csdn.net/qq_27607539/article/details/75007717），在 windows 系统下拿到我们生成的 hd.dvi 文件后，使用 vitualBox 虚拟机加载我们的虚拟硬盘（参考这篇文章：https://blog.csdn.net/love__coder/article/details/8270856），这样就可以启动我们的 helloOS 系统了；第三个坑就是提示'hd0,msdos1' 错误，需要重新制作镜像，并且修改 grub.cfg 里的这行为'hd0,msdos1' 为'hd0'（参考评论第一条第九天魔王大佬）；这些坑都排完后应该就可以达到老师的效果了</div><div><p>编辑回复：感谢老铁的留言，不但可以整理自己的想法，还能帮到其他同学，赞。后面继续加油呀！</p></div><div><div>2021-07-22</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/46/bb/0dedb943.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>hdhwjjs</span></div><span>置顶</span></div><div>看到这一课的内容有需要上机实操的就非常喜欢，终于啃了那么多天的理论课，迎来了实操课。
我的实操环境是：WIN10 + VBox+ Ubuntu 20.04
一开始我搞错了，跟着课程内容，去 ubuntu 里安装 vBox，这等于是把自己引入了套娃的险境。
如果你也是和我同样的运行环境，那可以参考下文绕过这个坑。
    正确的操作应该是在我们的 VBox 里建立这个与我们的 Ubuntu 并列的 HelloOS 虚拟系统，具体如何建立，跟着课程里的内容来完成即可。
    这里我要分享一下我踩这些坑的捷径，
听完课先扒拉课后大神们的留言，老师已把精华踩坑攻略帮我们置顶了，基本上前三篇留言里能找到大部分你即将遇到的坑。

然后，我遇到第二个坑，是 loop0
这个我也是去课后留言区扒拉，带着问题，明确目标去找，很快就查到，可以用
sudo losetup 这条指令找出你系统里哪些 loop 已被占用，然后你使用没有被占用的 loop 即可
范围是 0 到 11 。

第三个坑，是我生成了 hd.vdi 文件后，继续跟着课程操作，系统老不让我过，我去查大神留言，发现我这是陷在跟套娃死磕的骚操作，
像我这里的运行环境下，正确的操作应该是：
生成完 hd.vdi 文件，就把它保存到 windows 里，然后打开 vbox，在我们一开始建立的 HelloOS 虚拟系统里，加载这个 hd.vdi 虚拟硬盘，然后就在 VBox 里启动这个 HelloOS 操作系统。

启动之后，又遇到了一个坑，提示 hd0，msdos1 错误，
发现错误后，再次扒拉课后大神的留言，找到解决方法：
修改 grub.cfg 文件，把里面的 hd0,msdos1 改为 hd0 即可，按照攻略，改完后，生成的 hd.vfi 放进 HelloOS 系统，启动果然就完成了今天这课的操作要求。（记得报错后，最好能重启一下虚拟机里的操作系统，否则可能遇到你已经更新了正确的 hd.vdi，但系统提示你挂载的 hd.vdi 硬盘有问题不让你通过！）

课后老师留的思考题，为什么我们要把虚拟盘格式化成 ext4 格式，
我的印象中，文件格式系统在 dos 时代是 FAT 文件格式，后来有了 FAT32，再后来硬盘越来越大，包括不同的操作系统，从 windows、linux 到 MacOS，各个系统有各自的文件格式系统。
我的理解是，磁盘格式是为了即将安装的操作系统准备的，也就是我们即将做的这个操作系统是采用 ext4 文件格式，不能用其他的比如 FAT32 或 exFAT 等。</div><div><p>作者回复：因为在 linux 上向虚拟硬盘上写入文件 所以 要用 ext4</p></div><div><div>2021-11-08</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/cd/67/8e8e65ce.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>安之若素</span></div><span>置顶</span></div><div>使用服务器的小伙伴，可以参考如下链接，使用 vnc 方式，访问图形化 ubuntu 界面
https://www.voidking.com/dev-linux-virtualbox/
https://support.huaweicloud.com/bestpractice-ecs/zh-cn_topic_0168615364.html
https://askubuntu.com/questions/800302/vncserver-grey-screen-ubuntu-16-04-lts</div><div><p>作者回复：可以 可以 </p></div><div><div>2021-11-04</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/eb/28/6786205e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>山不厌高，海不厌深</span></div><span>置顶</span></div><div># arch linux 安装 virtualbox

我使用的是 manjaro 系统，本来 linux 玩的就不是很熟，直接上 arch 我人都麻了，不过最后还是跑成功了，这里贴一下我遇到的坑。

1、arch 需要先更新一下系统（很重要）

```
yay -Syy
```

2、然后直接安装 virtualbox

```
yay -S virtualbox
```

3、然后很关键（我这里只装完这些，是用不了的，需要先安装一下与内核有关的东西）：

查看一下你的内核版本 `uname -r`，比如我是 `5.10.70-1-MANJARO`，还需要装一下内核与 virtualbox 有关的一些包（注意安装的版本要和你的内核相同）

这里我就装了 `linux510-virtualbox-host-modules` 与 `linux510-virtualbox-host-modules`（在 manjaro 自带的软件商店内）

安装完成根据提示 `reboot`

4、然后根据 archwiki，我们还需要加载 virtualBox 内核模块

如果你上一步没有安装相关内核包的话，这里会报错说 xxx module 找不到之类的错误，我也是在这里卡了好久

```
sudo modprobe vboxdrv
```

5、完成
然后就是跟着老师的步骤走了，arch 成功跑起来 HelloOS！</div><div><p>作者回复: 66666 啊</p></div><div><div>2021-10-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/17/f5/93682e42.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Pure</span></div><span>置顶</span></div><div>我在设置回关设备这儿稍微卡了一下，跟大家说一下，就是我输完 sudo losetup /dev/loop0 hd.img 以后系统提示我说：使用设备失败，没有那个设备。把我搞蒙了，我去网上搜了一下，其实我们要先用命令找一个没有被用过的回环设备名也就是这里的 loop0，我们可以用命令 sudo losetup /dev/loopn 来试哪个回环设备是没有被用过（这里的 n 其实就是你需要试的数字，0 不行就 1，1 不行就 2，一直试，我的是 12）直到你试到人家说：使用设备失败，没有那个设备，这时候你的 loopn 就是你需要的回环设备名，然后再 sudo losetup /dev/loopn hd.img 就可以啦</div><div><p>作者回复：对的 ，也可以使用 sudo losetup -l 查看 一下 所有的 loop 设备的状态 </p></div><div><div>2021-07-21</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>一大早起来第一件事就是看专栏！
今天专栏实操性是很强的，容易上手，产生成就感。
我昨天就 clone 代码跑起来了，对于 virtualbox 大家如果觉得命令行难用，可以直接打开界面点击按钮新建虚拟机，对于追求 geek 的人，命令行还是得来一次。
思考题：
通过 dd 产生的文件为什么要格式化为文件系统呢，文中已经提到了，我们需要向虚拟硬盘中挂载 boot 目录和 grub，而这种 mount 操作是建立在文件系统的基础上的，而块设备是不支持的。</div><div><p>作者回复：铁子 回答的相当正确</p></div><div><div>2021-05-31</div><div><div><i></i><span>2</span></div><div><i></i><span>13</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/43/cf/118c4ef5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>lunar</span></div></div><div>很开心，我已经成功的跟不上了</div><div><p>编辑回复：慢慢来，别灰心。</p></div><div><div>2021-06-02</div><div><div><i></i></div><div><i></i><span>11</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fan</span></div></div><div>losetup -f 会返回第一个未使用的环回设备，比如我这里返回的就是 /dev/loop0
losetup -a 会返回当前已经使用的所有环回设备；</div><div><p>作者回复: 6666，谢谢分享</p></div><div><div>2021-06-07</div><div><div><i></i></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/24/b8/ff/d327274b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>wtafting</span></div></div><div>记录一下自己的实现过程：https://blog.nowcoder.net/n/34c8fe00da124439a940dff41864fecf</div><div><p>作者回复: 66666</p></div><div><div>2021-08-14</div><div><div><i></i><span>3</span></div><div><i></i><span>3</span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".y"><outline class="toc-level-h1" data-reactid=".y.0" style="width: 175px;"><active data-reactid=".y.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".y.0.1"><span data-reactid=".y.0.1.0"> 10 | 设置工作模式与环境（上）：建立计算机</span></a></outline><outline class="toc-level-h2" data-reactid=".y.1" style="width: 165px;"><active data-reactid=".y.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".y.1.1"><span data-reactid=".y.1.1.0">从内核映像格式说起</span></a></outline><outline class="toc-level-h2" data-reactid=".y.2" style="width: 165px;"><active data-reactid=".y.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".y.2.1"><span data-reactid=".y.2.1.0">准备虚拟机</span></a></outline><outline class="toc-level-h3" data-reactid=".y.3" style="width: 155px;"><active data-reactid=".y.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".y.3.1"><span data-reactid=".y.3.1.0">安装虚拟机</span></a></outline><outline class="toc-level-h3" data-reactid=".y.4" style="width: 155px;"><active data-reactid=".y.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".y.4.1"><span data-reactid=".y.4.1.0">建立虚拟电脑</span></a></outline><outline class="toc-level-h2" data-reactid=".y.5" style="width: 165px;"><active data-reactid=".y.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".y.5.1"><span data-reactid=".y.5.1.0">手工生产硬盘</span></a></outline><outline class="toc-level-h3" data-reactid=".y.6" style="width: 155px;"><active data-reactid=".y.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".y.6.1"><span data-reactid=".y.6.1.0">生产虚拟硬盘</span></a></outline><outline class="toc-level-h3" data-reactid=".y.7" style="width: 155px;"><active data-reactid=".y.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".y.7.1"><span data-reactid=".y.7.1.0">格式化虚拟硬盘</span></a></outline><outline class="toc-level-h3" data-reactid=".y.8" style="width: 155px;"><active data-reactid=".y.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".y.8.1"><span data-reactid=".y.8.1.0">安装 GRUB</span></a></outline><outline class="toc-level-h3" data-reactid=".y.9" style="width: 155px;"><active data-reactid=".y.9.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".y.9.1"><span data-reactid=".y.9.1.0">转换虚拟硬盘格式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.a" style="width: 155px;"><active data-reactid=".y.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".y.a.1"><span data-reactid=".y.a.1.0">安装虚拟硬盘</span></a></outline><outline class="toc-level-h3" data-reactid=".y.b" style="width: 155px;"><active data-reactid=".y.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".y.b.1"><span data-reactid=".y.b.1.0">最成功的失败</span></a></outline><outline class="toc-level-h2" data-reactid=".y.c" style="width: 165px;"><active data-reactid=".y.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".y.c.1"><span data-reactid=".y.c.1.0">重点回顾</span></a></outline><outline class="toc-level-h2" data-reactid=".y.d" style="width: 165px;"><active data-reactid=".y.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".y.d.1"><span data-reactid=".y.d.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".y.e" style="width: 165px;"><active data-reactid=".y.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".y.e.1"><span data-reactid=".y.e.1.0">精选留言 (104)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/379291" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>