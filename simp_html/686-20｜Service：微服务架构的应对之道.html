
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 20｜Service：微服务架构的应对之道</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>20｜Service：微服务架构的应对之道</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0"> 20｜Service：微服务架构的应对之道</h1><div><span>Chrono</span> <span>2022-08-05</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a5/c7/a509429b3bcee327ec73c09db6f6d3c7.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：Chrono</span><span> 大小：15.01M</span><span> 时长：16:26</span></div></div><audio title="20｜Service：微服务架构的应对之道" src="https://res001.geekbang.org/media/audio/17/b2/178f82fca6e1778f90d8e31a25e9c2b2/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="9134" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="9135"><span data-slate-object="text" data-key="9136"><span data-slate-leaf="true" data-offset-key="9136:0" data-first-offset="true"><span data-slate-string="true">你好，我是 Chrono。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9137"><span data-slate-object="text" data-key="9138"><span data-slate-leaf="true" data-offset-key="9138:0" data-first-offset="true"><span data-slate-string="true">在前面的课里我们学习了 Deployment 和 DaemonSet 这两个 API 对象，它们都是在线业务，只是以不同的策略部署应用，Deployment 创建任意多个实例，Daemon 为每个节点创建一个实例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9139"><span data-slate-object="text" data-key="9140"><span data-slate-leaf="true" data-offset-key="9140:0" data-first-offset="true"><span data-slate-string="true">这两个 API 对象可以部署多种形式的应用，而在云原生时代，微服务无疑是应用的主流形态。为了更好地支持微服务以及服务网格这样的应用架构，Kubernetes 又专门定义了一个新的对象：Service，它是集群内部的负载均衡机制，用来解决服务发现的关键问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9141"><span data-slate-object="text" data-key="9142"><span data-slate-leaf="true" data-offset-key="9142:0" data-first-offset="true"><span data-slate-string="true">今天我们就来看看什么是 Service、如何使用 YAML 来定义 Service，以及如何在 Kubernetes 里用好 Service。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9143" id="sr-toc-1"><span data-slate-object="text" data-key="9144"><span data-slate-leaf="true" data-offset-key="9144:0" data-first-offset="true"><span data-slate-string="true">为什么要有 Service</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9145"><span data-slate-object="text" data-key="9146"><span data-slate-leaf="true" data-offset-key="9146:0" data-first-offset="true"><span data-slate-string="true">有了 Deployment 和 DaemonSet，我们在集群里发布应用程序的工作轻松了很多。借助 Kubernetes 强大的自动化运维能力，我们可以把应用的更新上线频率由以前的月、周级别提升到天、小时级别，让服务质量更上一层楼。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9147"><span data-slate-object="text" data-key="9148"><span data-slate-leaf="true" data-offset-key="9148:0" data-first-offset="true"><span data-slate-string="true">不过，在应用程序快速版本迭代的同时，另一个问题也逐渐显现出来了，就是 “</span></span></span><span data-slate-object="text" data-key="9149"><span data-slate-leaf="true" data-offset-key="9149:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">服务发现</span></span></span></span><span data-slate-object="text" data-key="9150"><span data-slate-leaf="true" data-offset-key="9150:0" data-first-offset="true"><span data-slate-string="true">”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9151"><span data-slate-object="text" data-key="9152"><span data-slate-leaf="true" data-offset-key="9152:0" data-first-offset="true"><span data-slate-string="true">在 Kubernetes 集群里 Pod 的生命周期是比较 “短暂” 的，虽然 Deployment 和 DaemonSet 可以维持 Pod 总体数量的稳定，但在运行过程中，难免会有 Pod 销毁又重建，这就会导致 Pod 集合处于动态的变化之中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9153"><span data-slate-object="text" data-key="9154"><span data-slate-leaf="true" data-offset-key="9154:0" data-first-offset="true"><span data-slate-string="true">这种 “动态稳定” 对于现在流行的微服务架构来说是非常致命的，试想一下，后台 Pod 的 IP 地址老是变来变去，客户端该怎么访问呢？如果不处理好这个问题，Deployment 和 DaemonSet 把 Pod 管理得再完善也是没有价值的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9155"><span data-slate-object="text" data-key="9156"><span data-slate-leaf="true" data-offset-key="9156:0" data-first-offset="true"><span data-slate-string="true">其实，这个问题也并不是什么难事，业内早就有解决方案来针对这样 “不稳定” 的后端服务，那就是 “</span></span></span><span data-slate-object="text" data-key="9157"><span data-slate-leaf="true" data-offset-key="9157:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">负载均衡</span></span></span></span><span data-slate-object="text" data-key="9158"><span data-slate-leaf="true" data-offset-key="9158:0" data-first-offset="true"><span data-slate-string="true">”，典型的应用有 LVS、Nginx 等等。它们在前端与后端之间加入了一个 “中间层”，屏蔽后端的变化，为前端提供一个稳定的服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9159"><span data-slate-object="text" data-key="9160"><span data-slate-leaf="true" data-offset-key="9160:0" data-first-offset="true"><span data-slate-string="true">但 LVS、Nginx 毕竟不是云原生技术，所以 Kubernetes 就按照这个思路，定义了新的 API 对象：</span></span></span><span data-slate-object="text" data-key="9161"><span data-slate-leaf="true" data-offset-key="9161:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Service</span></span></span></span><span data-slate-object="text" data-key="9162"><span data-slate-leaf="true" data-offset-key="9162:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9163"><span data-slate-object="text" data-key="9164"><span data-slate-leaf="true" data-offset-key="9164:0" data-first-offset="true"><span data-slate-string="true">所以估计你也能想到，Service 的工作原理和 LVS、Nginx 差不多，Kubernetes 会给它分配一个静态 IP 地址，然后它再去自动管理、维护后面动态变化的 Pod 集合，当客户端访问 Service，它就根据某种策略，把流量转发给后面的某个 Pod。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9165"><span data-slate-object="text" data-key="9166"><span data-slate-leaf="true" data-offset-key="9166:0" data-first-offset="true"><span data-slate-string="true">下面的这张图来自 Kubernetes </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9167"><span data-slate-object="text" data-key="9168"><span data-slate-leaf="true" data-offset-key="9168:0" data-first-offset="true"><span data-slate-string="true">官网文档</span></span></span></a><span data-slate-object="text" data-key="9169"><span data-slate-leaf="true" data-offset-key="9169:0" data-first-offset="true"><span data-slate-string="true">，比较清楚地展示了 Service 的工作原理：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9170"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/03/74/0347a0b3bae55fb9ef6c07469e964b74.png?wh=1622x1214"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9171"><span data-slate-object="text" data-key="9172"><span data-slate-leaf="true" data-offset-key="9172:0" data-first-offset="true"><span data-slate-string="true">你可以看到，这里 Service 使用了 iptables 技术，每个节点上的 kube-proxy 组件自动维护 iptables 规则，客户不再关心 Pod 的具体地址，只要访问 Service 的固定 IP 地址，Service 就会根据 iptables 规则转发请求给它管理的多个 Pod，是典型的负载均衡架构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9173"><span data-slate-object="text" data-key="9174"><span data-slate-leaf="true" data-offset-key="9174:0" data-first-offset="true"><span data-slate-string="true">不过 Service 并不是只能使用 iptables 来实现负载均衡，它还有另外两种实现技术：性能更差的 userspace 和性能更好的 ipvs，但这些都属于底层细节，我们不需要刻意关注。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9175" id="sr-toc-2"><span data-slate-object="text" data-key="9176"><span data-slate-leaf="true" data-offset-key="9176:0" data-first-offset="true"><span data-slate-string="true">如何使用 YAML 描述 Service</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9177"><span data-slate-object="text" data-key="9178"><span data-slate-leaf="true" data-offset-key="9178:0" data-first-offset="true"><span data-slate-string="true">知道了 Service 的基本工作原理，我们来看看怎么为 Service 编写 YAML 描述文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9179"><span data-slate-object="text" data-key="9180"><span data-slate-leaf="true" data-offset-key="9180:0" data-first-offset="true"><span data-slate-string="true">照例我们还是可以用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9181"><span data-slate-object="text" data-key="9182"><span data-slate-leaf="true" data-offset-key="9182:0" data-first-offset="true"><span data-slate-string="true">kubectl api-resources</span></span></span></span><span data-slate-object="text" data-key="9183"><span data-slate-leaf="true" data-offset-key="9183:0" data-first-offset="true"><span data-slate-string="true"> 查看它的基本信息，可以知道它的简称是</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9184"><span data-slate-object="text" data-key="9185"><span data-slate-leaf="true" data-offset-key="9185:0" data-first-offset="true"><span data-slate-string="true"> svc</span></span></span></span><span data-slate-object="text" data-key="9186"><span data-slate-leaf="true" data-offset-key="9186:0" data-first-offset="true"><span data-slate-string="true">，apiVersion 是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9187"><span data-slate-object="text" data-key="9188"><span data-slate-leaf="true" data-offset-key="9188:0" data-first-offset="true"><span data-slate-string="true">v1</span></span></span></span><span data-slate-object="text" data-key="9189"><span data-slate-leaf="true" data-offset-key="9189:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span><span data-slate-object="text" data-key="9190"><span data-slate-leaf="true" data-offset-key="9190:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">注意，这说明它与 Pod 一样，属于 Kubernetes 的核心对象，不关联业务应用，与 Job、Deployment 是不同的。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9191"><span data-slate-object="text" data-key="9192"><span data-slate-leaf="true" data-offset-key="9192:0" data-first-offset="true"><span data-slate-string="true">现在，相信你很容易写出 Service 的 YAML 文件头了吧：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="9193"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9194"><span data-slate-object="text" data-key="9195"><span data-slate-leaf="true" data-offset-key="9195:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9196"><span data-slate-object="text" data-key="9197"><span data-slate-leaf="true" data-offset-key="9197:0" data-first-offset="true"><span data-slate-string="true">kind: Service</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9198"><span data-slate-object="text" data-key="9199"><span data-slate-leaf="true" data-offset-key="9199:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9200"><span data-slate-object="text" data-key="9201"><span data-slate-leaf="true" data-offset-key="9201:0" data-first-offset="true"><span data-slate-string="true">  name: xxx-svc</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9202"><span data-slate-object="text" data-key="9203"><span data-slate-leaf="true" data-offset-key="9203:0" data-first-offset="true"><span data-slate-string="true">同样的，能否让 Kubernetes 为我们自动创建 Service 的 YAML 样板呢？还是使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9204"><span data-slate-object="text" data-key="9205"><span data-slate-leaf="true" data-offset-key="9205:0" data-first-offset="true"><span data-slate-string="true">kubectl create</span></span></span></span><span data-slate-object="text" data-key="9206"><span data-slate-leaf="true" data-offset-key="9206:0" data-first-offset="true"><span data-slate-string="true"> 吗？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9207"><span data-slate-object="text" data-key="9208"><span data-slate-leaf="true" data-offset-key="9208:0" data-first-offset="true"><span data-slate-string="true">这里 Kubernetes 又表现出了行为上的不一致。</span></span></span><span data-slate-object="text" data-key="9209"><span data-slate-leaf="true" data-offset-key="9209:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">虽然它可以自动创建 YAML 样板，但不是用命令</span></span></span></span><span data-slate-object="text" data-key="9210"><span data-slate-leaf="true" data-offset-key="9210:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9211"><span data-slate-object="text" data-key="9212"><span data-slate-leaf="true" data-offset-key="9212:0" data-first-offset="true"><span data-slate-string="true"> kubectl create</span></span></span></span><span data-slate-object="text" data-key="9213"><span data-slate-leaf="true" data-offset-key="9213:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">，而是另外一个命令</span></span></span></span><span data-slate-object="text" data-key="9214"><span data-slate-leaf="true" data-offset-key="9214:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9215"><span data-slate-object="text" data-key="9216"><span data-slate-leaf="true" data-offset-key="9216:0" data-first-offset="true"><span data-slate-string="true"> kubectl expose</span></span></span></span><span data-slate-object="text" data-key="9217"><span data-slate-leaf="true" data-offset-key="9217:0" data-first-offset="true"><span data-slate-string="true">，也许 Kubernetes 认为 “expose” 能够更好地表达 Service “暴露” 服务地址的意思吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9218"><span data-slate-object="text" data-key="9219"><span data-slate-leaf="true" data-offset-key="9219:0" data-first-offset="true"><span data-slate-string="true">因为在 Kubernetes 里提供服务的是 Pod，而 Pod 又可以用 Deployment/DaemonSet 对象来部署，所以 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9220"><span data-slate-object="text" data-key="9221"><span data-slate-leaf="true" data-offset-key="9221:0" data-first-offset="true"><span data-slate-string="true">kubectl expose</span></span></span></span><span data-slate-object="text" data-key="9222"><span data-slate-leaf="true" data-offset-key="9222:0" data-first-offset="true"><span data-slate-string="true">  支持从多种对象创建服务，Pod、Deployment、DaemonSet 都可以。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9223"><span data-slate-object="text" data-key="9224"><span data-slate-leaf="true" data-offset-key="9224:0" data-first-offset="true"><span data-slate-string="true">使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9225"><span data-slate-object="text" data-key="9226"><span data-slate-leaf="true" data-offset-key="9226:0" data-first-offset="true"><span data-slate-string="true">kubectl expose</span></span></span></span><span data-slate-object="text" data-key="9227"><span data-slate-leaf="true" data-offset-key="9227:0" data-first-offset="true"><span data-slate-string="true"> 指令时还需要用参数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9228"><span data-slate-object="text" data-key="9229"><span data-slate-leaf="true" data-offset-key="9229:0" data-first-offset="true"><span data-slate-string="true">--port</span></span></span></span><span data-slate-object="text" data-key="9230"><span data-slate-leaf="true" data-offset-key="9230:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9231"><span data-slate-object="text" data-key="9232"><span data-slate-leaf="true" data-offset-key="9232:0" data-first-offset="true"><span data-slate-string="true">--target-port</span></span></span></span><span data-slate-object="text" data-key="9233"><span data-slate-leaf="true" data-offset-key="9233:0" data-first-offset="true"><span data-slate-string="true"> 分别指定映射端口和容器端口，而 Service 自己的 IP 地址和后端 Pod 的 IP 地址可以自动生成，用法上和 Docker 的命令行参数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9234"><span data-slate-object="text" data-key="9235"><span data-slate-leaf="true" data-offset-key="9235:0" data-first-offset="true"><span data-slate-string="true">-p</span></span></span></span><span data-slate-object="text" data-key="9236"><span data-slate-leaf="true" data-offset-key="9236:0" data-first-offset="true"><span data-slate-string="true"> 很类似，只是略微麻烦一点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9237"><span data-slate-object="text" data-key="9238"><span data-slate-leaf="true" data-offset-key="9238:0" data-first-offset="true"><span data-slate-string="true">比如，如果我们要为</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9239"><span data-slate-object="text" data-key="9240"><span data-slate-leaf="true" data-offset-key="9240:0" data-first-offset="true"><span data-slate-string="true">第 18 讲</span></span></span></a><span data-slate-object="text" data-key="9241"><span data-slate-leaf="true" data-offset-key="9241:0" data-first-offset="true"><span data-slate-string="true">里的 ngx-dep 对象生成 Service，命令就要这么写：</span></span></span></div><div data-code-language="objectivec" data-slate-type="pre" data-slate-object="block" data-key="9242"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9243"><span data-slate-object="text" data-key="9244"><span data-slate-leaf="true" data-offset-key="9244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">export</span></span></span></span><span data-slate-object="text" data-key="9245"><span data-slate-leaf="true" data-offset-key="9245:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9246"><span data-slate-leaf="true" data-offset-key="9246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">out</span></span></span></span><span data-slate-object="text" data-key="9247"><span data-slate-leaf="true" data-offset-key="9247:0" data-first-offset="true"><span data-slate-string="true">=</span></span></span><span data-slate-object="text" data-key="9248"><span data-slate-leaf="true" data-offset-key="9248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"--dry-run=client -o yaml"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9249"><span data-slate-object="text" data-key="9250"><span data-slate-leaf="true" data-offset-key="9250:0" data-first-offset="true"><span data-slate-string="true">kubectl expose deploy ngx-dep --port=</span></span></span><span data-slate-object="text" data-key="9251"><span data-slate-leaf="true" data-offset-key="9251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">80</span></span></span></span><span data-slate-object="text" data-key="9252"><span data-slate-leaf="true" data-offset-key="9252:0" data-first-offset="true"><span data-slate-string="true"> --target-port=</span></span></span><span data-slate-object="text" data-key="9253"><span data-slate-leaf="true" data-offset-key="9253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">80</span></span></span></span><span data-slate-object="text" data-key="9254"><span data-slate-leaf="true" data-offset-key="9254:0" data-first-offset="true"><span data-slate-string="true"> $</span></span></span><span data-slate-object="text" data-key="9255"><span data-slate-leaf="true" data-offset-key="9255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">out</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9256"><span data-slate-object="text" data-key="9257"><span data-slate-leaf="true" data-offset-key="9257:0" data-first-offset="true"><span data-slate-string="true">生成的 Service YAML 大概是这样的：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="9258"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9259"><span data-slate-object="text" data-key="9260"><span data-slate-leaf="true" data-offset-key="9260:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9261"><span data-slate-object="text" data-key="9262"><span data-slate-leaf="true" data-offset-key="9262:0" data-first-offset="true"><span data-slate-string="true">kind: Service</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9263"><span data-slate-object="text" data-key="9264"><span data-slate-leaf="true" data-offset-key="9264:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9265"><span data-slate-object="text" data-key="9266"><span data-slate-leaf="true" data-offset-key="9266:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-svc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9267"><span data-slate-object="text" data-key="9268"><span data-slate-leaf="true" data-offset-key="9268:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9269"><span data-slate-object="text" data-key="9270"><span data-slate-leaf="true" data-offset-key="9270:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9271"><span data-slate-object="text" data-key="9272"><span data-slate-leaf="true" data-offset-key="9272:0" data-first-offset="true"><span data-slate-string="true">  selector:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9273"><span data-slate-object="text" data-key="9274"><span data-slate-leaf="true" data-offset-key="9274:0" data-first-offset="true"><span data-slate-string="true">    app: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9275"><span data-slate-object="text" data-key="9276"><span data-slate-leaf="true" data-offset-key="9276:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9277"><span data-slate-object="text" data-key="9278"><span data-slate-leaf="true" data-offset-key="9278:0" data-first-offset="true"><span data-slate-string="true">  ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9279"><span data-slate-object="text" data-key="9280"><span data-slate-leaf="true" data-offset-key="9280:0" data-first-offset="true"><span data-slate-string="true">  - port: 80</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9281"><span data-slate-object="text" data-key="9282"><span data-slate-leaf="true" data-offset-key="9282:0" data-first-offset="true"><span data-slate-string="true">    targetPort: 80</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9283"><span data-slate-object="text" data-key="9284"><span data-slate-leaf="true" data-offset-key="9284:0" data-first-offset="true"><span data-slate-string="true">    protocol: TCP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9285"><span data-slate-object="text" data-key="9286"><span data-slate-leaf="true" data-offset-key="9286:0" data-first-offset="true"><span data-slate-string="true">你会发现，Service 的定义非常简单，在 “spec” 里只有两个关键字段，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9287"><span data-slate-object="text" data-key="9288"><span data-slate-leaf="true" data-offset-key="9288:0" data-first-offset="true"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="9289"><span data-slate-leaf="true" data-offset-key="9289:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9290"><span data-slate-object="text" data-key="9291"><span data-slate-leaf="true" data-offset-key="9291:0" data-first-offset="true"><span data-slate-string="true">ports</span></span></span></span><span data-slate-object="text" data-key="9292"><span data-slate-leaf="true" data-offset-key="9292:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9293"><span data-slate-type="code" data-slate-object="inline" data-key="9294"><span data-slate-object="text" data-key="9295"><span data-slate-leaf="true" data-offset-key="9295:0" data-first-offset="true"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="9296"><span data-slate-leaf="true" data-offset-key="9296:0" data-first-offset="true"><span data-slate-string="true"> 和 Deployment/DaemonSet 里的作用是一样的，用来过滤出要代理的那些 Pod。因为我们指定要代理 Deployment，所以 Kubernetes 就为我们自动填上了 ngx-dep 的标签，会选择这个 Deployment 对象部署的所有 Pod。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9297"><span data-slate-object="text" data-key="9298"><span data-slate-leaf="true" data-offset-key="9298:0" data-first-offset="true"><span data-slate-string="true">从这里你也可以看到，Kubernetes 的这个标签机制虽然很简单，却非常强大有效，很轻松就关联上了 Deployment 的 Pod。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9299"><span data-slate-type="code" data-slate-object="inline" data-key="9300"><span data-slate-object="text" data-key="9301"><span data-slate-leaf="true" data-offset-key="9301:0" data-first-offset="true"><span data-slate-string="true">ports</span></span></span></span><span data-slate-object="text" data-key="9302"><span data-slate-leaf="true" data-offset-key="9302:0" data-first-offset="true"><span data-slate-string="true"> 就很好理解了，里面的三个字段分别表示外部端口、内部端口和使用的协议，在这里就是内外部都使用 80 端口，协议是 TCP。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9303"><span data-slate-object="text" data-key="9304"><span data-slate-leaf="true" data-offset-key="9304:0" data-first-offset="true"><span data-slate-string="true">当然，你在这里也可以把 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9305"><span data-slate-object="text" data-key="9306"><span data-slate-leaf="true" data-offset-key="9306:0" data-first-offset="true"><span data-slate-string="true">ports</span></span></span></span><span data-slate-object="text" data-key="9307"><span data-slate-leaf="true" data-offset-key="9307:0" data-first-offset="true"><span data-slate-string="true"> 改成 “8080” 等其他的端口，这样外部服务看到的就是 Service 给出的端口，而不会知道 Pod 的真正服务端口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9308"><span data-slate-object="text" data-key="9309"><span data-slate-leaf="true" data-offset-key="9309:0" data-first-offset="true"><span data-slate-string="true">为了让你看清楚 Service 与它引用的 Pod 的关系，我把这两个 YAML 对象画在了下面的这张图里，需要重点关注的是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9310"><span data-slate-object="text" data-key="9311"><span data-slate-leaf="true" data-offset-key="9311:0" data-first-offset="true"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="9312"><span data-slate-leaf="true" data-offset-key="9312:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9313"><span data-slate-object="text" data-key="9314"><span data-slate-leaf="true" data-offset-key="9314:0" data-first-offset="true"><span data-slate-string="true">targetPort</span></span></span></span><span data-slate-object="text" data-key="9315"><span data-slate-leaf="true" data-offset-key="9315:0" data-first-offset="true"><span data-slate-string="true"> 与 Pod 的关联：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9316"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/0f/64/0f74ae3a71a6a661376698e481903d64.jpg?wh=1920x1322"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9317" id="sr-toc-3"><span data-slate-object="text" data-key="9318"><span data-slate-leaf="true" data-offset-key="9318:0" data-first-offset="true"><span data-slate-string="true">如何在 Kubernetes 里使用 Service</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9319"><span data-slate-object="text" data-key="9320"><span data-slate-leaf="true" data-offset-key="9320:0" data-first-offset="true"><span data-slate-string="true">在使用 YAML 创建 Service 对象之前，让我们先对第 18 讲里的 Deployment 做一点改造，方便观察 Service 的效果。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9321"><span data-slate-object="text" data-key="9322"><span data-slate-leaf="true" data-offset-key="9322:0" data-first-offset="true"><span data-slate-string="true">首先，我们创建一个 ConfigMap，定义一个 Nginx 的配置片段，它会输出服务器的地址、主机名、请求的 URI 等基本信息：</span></span></span></div><div data-code-language="dart" data-slate-type="pre" data-slate-object="block" data-key="9323"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9324"><span data-slate-object="text" data-key="9325"><span data-slate-leaf="true" data-offset-key="9325:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9326"><span data-slate-object="text" data-key="9327"><span data-slate-leaf="true" data-offset-key="9327:0" data-first-offset="true"><span data-slate-string="true">kind: ConfigMap</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9328"><span data-slate-object="text" data-key="9329"><span data-slate-leaf="true" data-offset-key="9329:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9330"><span data-slate-object="text" data-key="9331"><span data-slate-leaf="true" data-offset-key="9331:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-conf</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9332"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9333"><span data-slate-object="text" data-key="9334"><span data-slate-leaf="true" data-offset-key="9334:0" data-first-offset="true"><span data-slate-string="true">data:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9335"><span data-slate-object="text" data-key="9336"><span data-slate-leaf="true" data-offset-key="9336:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9337"><span data-slate-leaf="true" data-offset-key="9337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">default</span></span></span></span><span data-slate-object="text" data-key="9338"><span data-slate-leaf="true" data-offset-key="9338:0" data-first-offset="true"><span data-slate-string="true">.conf: |</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9339"><span data-slate-object="text" data-key="9340"><span data-slate-leaf="true" data-offset-key="9340:0" data-first-offset="true"><span data-slate-string="true">    server {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9341"><span data-slate-object="text" data-key="9342"><span data-slate-leaf="true" data-offset-key="9342:0" data-first-offset="true"><span data-slate-string="true">      listen </span></span></span><span data-slate-object="text" data-key="9343"><span data-slate-leaf="true" data-offset-key="9343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">80</span></span></span></span><span data-slate-object="text" data-key="9344"><span data-slate-leaf="true" data-offset-key="9344:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9345"><span data-slate-object="text" data-key="9346"><span data-slate-leaf="true" data-offset-key="9346:0" data-first-offset="true"><span data-slate-string="true">      location / {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9347"><span data-slate-object="text" data-key="9348"><span data-slate-leaf="true" data-offset-key="9348:0" data-first-offset="true"><span data-slate-string="true">        default_type text/plain;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9349"><span data-slate-object="text" data-key="9350"><span data-slate-leaf="true" data-offset-key="9350:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9351"><span data-slate-leaf="true" data-offset-key="9351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9352"><span data-slate-leaf="true" data-offset-key="9352:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9353"><span data-slate-leaf="true" data-offset-key="9353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9354"><span data-slate-object="text" data-key="9355"><span data-slate-leaf="true" data-offset-key="9355:0" data-first-offset="true"><span data-slate-string="true">          </span></span></span><span data-slate-object="text" data-key="9356"><span data-slate-leaf="true" data-offset-key="9356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'srv : </span></span></span></span><span data-slate-object="text" data-key="9357"><span data-slate-leaf="true" data-offset-key="9357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$server_addr</span></span></span></span></span><span data-slate-object="text" data-key="9358"><span data-slate-leaf="true" data-offset-key="9358:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">:</span></span></span></span><span data-slate-object="text" data-key="9359"><span data-slate-leaf="true" data-offset-key="9359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$server_port</span></span></span></span></span><span data-slate-object="text" data-key="9360"><span data-slate-leaf="true" data-offset-key="9360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\nhost: </span></span></span></span><span data-slate-object="text" data-key="9361"><span data-slate-leaf="true" data-offset-key="9361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$hostname</span></span></span></span></span><span data-slate-object="text" data-key="9362"><span data-slate-leaf="true" data-offset-key="9362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\nuri : </span></span></span></span><span data-slate-object="text" data-key="9363"><span data-slate-leaf="true" data-offset-key="9363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$request_method</span></span></span></span></span><span data-slate-object="text" data-key="9364"><span data-slate-leaf="true" data-offset-key="9364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="9365"><span data-slate-leaf="true" data-offset-key="9365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$host</span></span></span></span></span><span data-slate-object="text" data-key="9366"><span data-slate-leaf="true" data-offset-key="9366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="9367"><span data-slate-leaf="true" data-offset-key="9367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$request_uri</span></span></span></span></span><span data-slate-object="text" data-key="9368"><span data-slate-leaf="true" data-offset-key="9368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\ndate: </span></span></span></span><span data-slate-object="text" data-key="9369"><span data-slate-leaf="true" data-offset-key="9369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$time_iso8601</span></span></span></span></span><span data-slate-object="text" data-key="9370"><span data-slate-leaf="true" data-offset-key="9370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\n'</span></span></span></span><span data-slate-object="text" data-key="9371"><span data-slate-leaf="true" data-offset-key="9371:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9372"><span data-slate-object="text" data-key="9373"><span data-slate-leaf="true" data-offset-key="9373:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9374"><span data-slate-object="text" data-key="9375"><span data-slate-leaf="true" data-offset-key="9375:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9376"><span data-slate-object="text" data-key="9377"><span data-slate-leaf="true" data-offset-key="9377:0" data-first-offset="true"><span data-slate-string="true">然后我们在 Deployment 的 “</span></span></span><span data-slate-object="text" data-key="9378"><span data-slate-leaf="true" data-offset-key="9378:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">template.volumes</span></span></span></span><span data-slate-object="text" data-key="9379"><span data-slate-leaf="true" data-offset-key="9379:0" data-first-offset="true"><span data-slate-string="true">” 里定义存储卷，再用 “</span></span></span><span data-slate-object="text" data-key="9380"><span data-slate-leaf="true" data-offset-key="9380:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">volumeMounts</span></span></span></span><span data-slate-object="text" data-key="9381"><span data-slate-leaf="true" data-offset-key="9381:0" data-first-offset="true"><span data-slate-string="true">” 把配置文件加载进 Nginx 容器里：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="9382"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9383"><span data-slate-object="text" data-key="9384"><span data-slate-leaf="true" data-offset-key="9384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">apiVersion</span></span></span></span><span data-slate-object="text" data-key="9385"><span data-slate-leaf="true" data-offset-key="9385:0" data-first-offset="true"><span data-slate-string="true">: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9386"><span data-slate-object="text" data-key="9387"><span data-slate-leaf="true" data-offset-key="9387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kind</span></span></span></span><span data-slate-object="text" data-key="9388"><span data-slate-leaf="true" data-offset-key="9388:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9389"><span data-slate-leaf="true" data-offset-key="9389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Deployment</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9390"><span data-slate-object="text" data-key="9391"><span data-slate-leaf="true" data-offset-key="9391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">metadata</span></span></span></span><span data-slate-object="text" data-key="9392"><span data-slate-leaf="true" data-offset-key="9392:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9393"><span data-slate-object="text" data-key="9394"><span data-slate-leaf="true" data-offset-key="9394:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9395"><span data-slate-leaf="true" data-offset-key="9395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">name</span></span></span></span><span data-slate-object="text" data-key="9396"><span data-slate-leaf="true" data-offset-key="9396:0" data-first-offset="true"><span data-slate-string="true">: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9397"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9398"><span data-slate-object="text" data-key="9399"><span data-slate-leaf="true" data-offset-key="9399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spec</span></span></span></span><span data-slate-object="text" data-key="9400"><span data-slate-leaf="true" data-offset-key="9400:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9401"><span data-slate-object="text" data-key="9402"><span data-slate-leaf="true" data-offset-key="9402:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9403"><span data-slate-leaf="true" data-offset-key="9403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">replicas</span></span></span></span><span data-slate-object="text" data-key="9404"><span data-slate-leaf="true" data-offset-key="9404:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9405"><span data-slate-leaf="true" data-offset-key="9405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9406"><span data-slate-object="text" data-key="9407"><span data-slate-leaf="true" data-offset-key="9407:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9408"><span data-slate-leaf="true" data-offset-key="9408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="9409"><span data-slate-leaf="true" data-offset-key="9409:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9410"><span data-slate-object="text" data-key="9411"><span data-slate-leaf="true" data-offset-key="9411:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9412"><span data-slate-leaf="true" data-offset-key="9412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">matchLabels</span></span></span></span><span data-slate-object="text" data-key="9413"><span data-slate-leaf="true" data-offset-key="9413:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9414"><span data-slate-object="text" data-key="9415"><span data-slate-leaf="true" data-offset-key="9415:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9416"><span data-slate-leaf="true" data-offset-key="9416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">app</span></span></span></span><span data-slate-object="text" data-key="9417"><span data-slate-leaf="true" data-offset-key="9417:0" data-first-offset="true"><span data-slate-string="true">: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9418"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9419"><span data-slate-object="text" data-key="9420"><span data-slate-leaf="true" data-offset-key="9420:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9421"><span data-slate-leaf="true" data-offset-key="9421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="9422"><span data-slate-leaf="true" data-offset-key="9422:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9423"><span data-slate-object="text" data-key="9424"><span data-slate-leaf="true" data-offset-key="9424:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9425"><span data-slate-leaf="true" data-offset-key="9425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">metadata</span></span></span></span><span data-slate-object="text" data-key="9426"><span data-slate-leaf="true" data-offset-key="9426:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9427"><span data-slate-object="text" data-key="9428"><span data-slate-leaf="true" data-offset-key="9428:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9429"><span data-slate-leaf="true" data-offset-key="9429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">labels</span></span></span></span><span data-slate-object="text" data-key="9430"><span data-slate-leaf="true" data-offset-key="9430:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9431"><span data-slate-object="text" data-key="9432"><span data-slate-leaf="true" data-offset-key="9432:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9433"><span data-slate-leaf="true" data-offset-key="9433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">app</span></span></span></span><span data-slate-object="text" data-key="9434"><span data-slate-leaf="true" data-offset-key="9434:0" data-first-offset="true"><span data-slate-string="true">: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9435"><span data-slate-object="text" data-key="9436"><span data-slate-leaf="true" data-offset-key="9436:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9437"><span data-slate-leaf="true" data-offset-key="9437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spec</span></span></span></span><span data-slate-object="text" data-key="9438"><span data-slate-leaf="true" data-offset-key="9438:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9439"><span data-slate-object="text" data-key="9440"><span data-slate-leaf="true" data-offset-key="9440:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9441"><span data-slate-leaf="true" data-offset-key="9441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">volumes</span></span></span></span><span data-slate-object="text" data-key="9442"><span data-slate-leaf="true" data-offset-key="9442:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9443"><span data-slate-object="text" data-key="9444"><span data-slate-leaf="true" data-offset-key="9444:0" data-first-offset="true"><span data-slate-string="true">      - </span></span></span><span data-slate-object="text" data-key="9445"><span data-slate-leaf="true" data-offset-key="9445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">name</span></span></span></span><span data-slate-object="text" data-key="9446"><span data-slate-leaf="true" data-offset-key="9446:0" data-first-offset="true"><span data-slate-string="true">: ngx-conf-vol</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9447"><span data-slate-object="text" data-key="9448"><span data-slate-leaf="true" data-offset-key="9448:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9449"><span data-slate-leaf="true" data-offset-key="9449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">configMap</span></span></span></span><span data-slate-object="text" data-key="9450"><span data-slate-leaf="true" data-offset-key="9450:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9451"><span data-slate-object="text" data-key="9452"><span data-slate-leaf="true" data-offset-key="9452:0" data-first-offset="true"><span data-slate-string="true">          </span></span></span><span data-slate-object="text" data-key="9453"><span data-slate-leaf="true" data-offset-key="9453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">name</span></span></span></span><span data-slate-object="text" data-key="9454"><span data-slate-leaf="true" data-offset-key="9454:0" data-first-offset="true"><span data-slate-string="true">: ngx-conf</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9455"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9456"><span data-slate-object="text" data-key="9457"><span data-slate-leaf="true" data-offset-key="9457:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9458"><span data-slate-leaf="true" data-offset-key="9458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">containers</span></span></span></span><span data-slate-object="text" data-key="9459"><span data-slate-leaf="true" data-offset-key="9459:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9460"><span data-slate-object="text" data-key="9461"><span data-slate-leaf="true" data-offset-key="9461:0" data-first-offset="true"><span data-slate-string="true">      - </span></span></span><span data-slate-object="text" data-key="9462"><span data-slate-leaf="true" data-offset-key="9462:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">image</span></span></span></span><span data-slate-object="text" data-key="9463"><span data-slate-leaf="true" data-offset-key="9463:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9464"><span data-slate-leaf="true" data-offset-key="9464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nginx</span></span></span></span><span data-slate-object="text" data-key="9465"><span data-slate-leaf="true" data-offset-key="9465:0" data-first-offset="true"><span data-slate-string="true">:alpine</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9466"><span data-slate-object="text" data-key="9467"><span data-slate-leaf="true" data-offset-key="9467:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9468"><span data-slate-leaf="true" data-offset-key="9468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">name</span></span></span></span><span data-slate-object="text" data-key="9469"><span data-slate-leaf="true" data-offset-key="9469:0" data-first-offset="true"><span data-slate-string="true">: nginx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9470"><span data-slate-object="text" data-key="9471"><span data-slate-leaf="true" data-offset-key="9471:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9472"><span data-slate-leaf="true" data-offset-key="9472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ports</span></span></span></span><span data-slate-object="text" data-key="9473"><span data-slate-leaf="true" data-offset-key="9473:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9474"><span data-slate-object="text" data-key="9475"><span data-slate-leaf="true" data-offset-key="9475:0" data-first-offset="true"><span data-slate-string="true">        - </span></span></span><span data-slate-object="text" data-key="9476"><span data-slate-leaf="true" data-offset-key="9476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">containerPort</span></span></span></span><span data-slate-object="text" data-key="9477"><span data-slate-leaf="true" data-offset-key="9477:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9478"><span data-slate-leaf="true" data-offset-key="9478:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">80</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9479"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9480"><span data-slate-object="text" data-key="9481"><span data-slate-leaf="true" data-offset-key="9481:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9482"><span data-slate-leaf="true" data-offset-key="9482:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">volumeMounts</span></span></span></span><span data-slate-object="text" data-key="9483"><span data-slate-leaf="true" data-offset-key="9483:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9484"><span data-slate-object="text" data-key="9485"><span data-slate-leaf="true" data-offset-key="9485:0" data-first-offset="true"><span data-slate-string="true">        - </span></span></span><span data-slate-object="text" data-key="9486"><span data-slate-leaf="true" data-offset-key="9486:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mountPath</span></span></span></span><span data-slate-object="text" data-key="9487"><span data-slate-leaf="true" data-offset-key="9487:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9488"><span data-slate-leaf="true" data-offset-key="9488:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/etc/</span></span></span></span><span data-slate-object="text" data-key="9489"><span data-slate-leaf="true" data-offset-key="9489:0" data-first-offset="true"><span data-slate-string="true">nginx/conf.</span></span></span><span data-slate-object="text" data-key="9490"><span data-slate-leaf="true" data-offset-key="9490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">d</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9491"><span data-slate-object="text" data-key="9492"><span data-slate-leaf="true" data-offset-key="9492:0" data-first-offset="true"><span data-slate-string="true">          </span></span></span><span data-slate-object="text" data-key="9493"><span data-slate-leaf="true" data-offset-key="9493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">name</span></span></span></span><span data-slate-object="text" data-key="9494"><span data-slate-leaf="true" data-offset-key="9494:0" data-first-offset="true"><span data-slate-string="true">: ngx-conf-vol</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9495"><span data-slate-object="text" data-key="9496"><span data-slate-leaf="true" data-offset-key="9496:0" data-first-offset="true"><span data-slate-string="true">这两处修改用到了</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9497"><span data-slate-object="text" data-key="9498"><span data-slate-leaf="true" data-offset-key="9498:0" data-first-offset="true"><span data-slate-string="true">第 14 讲</span></span></span></a><span data-slate-object="text" data-key="9499"><span data-slate-leaf="true" data-offset-key="9499:0" data-first-offset="true"><span data-slate-string="true">里的知识，如果你还没有熟练掌握，可以回去复习一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9500"><span data-slate-object="text" data-key="9501"><span data-slate-leaf="true" data-offset-key="9501:0" data-first-offset="true"><span data-slate-string="true">部署这个 Deployment 之后，我们就可以创建 Service 对象了，用的还是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9502"><span data-slate-object="text" data-key="9503"><span data-slate-leaf="true" data-offset-key="9503:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="9504"><span data-slate-leaf="true" data-offset-key="9504:0" data-first-offset="true"><span data-slate-string="true">：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="9505"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9506"><span data-slate-object="text" data-key="9507"><span data-slate-leaf="true" data-offset-key="9507:0" data-first-offset="true"><span data-slate-string="true">kubectl apply -f svc.yml</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9508"><span data-slate-object="text" data-key="9509"><span data-slate-leaf="true" data-offset-key="9509:0" data-first-offset="true"><span data-slate-string="true">创建之后，用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9510"><span data-slate-object="text" data-key="9511"><span data-slate-leaf="true" data-offset-key="9511:0" data-first-offset="true"><span data-slate-string="true">kubectl get</span></span></span></span><span data-slate-object="text" data-key="9512"><span data-slate-leaf="true" data-offset-key="9512:0" data-first-offset="true"><span data-slate-string="true"> 就可以看到它的状态：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9513"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/c3/e1/c3502c6c00d870eyy506351e2ba828e1.png?wh=1844x362"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9514"><span data-slate-object="text" data-key="9515"><span data-slate-leaf="true" data-offset-key="9515:0" data-first-offset="true"><span data-slate-string="true">你可以看到，Kubernetes 为 Service 对象自动分配了一个 IP 地址 “10.96.240.115”，这个地址段是独立于 Pod 地址段的（比如第 17 讲里的 10.10.xx.xx）。而且 Service 对象的 IP 地址还有一个特点，它是一个 “</span></span></span><span data-slate-object="text" data-key="9516"><span data-slate-leaf="true" data-offset-key="9516:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">虚地址</span></span></span></span><span data-slate-object="text" data-key="9517"><span data-slate-leaf="true" data-offset-key="9517:0" data-first-offset="true"><span data-slate-string="true">”，不存在实体，只能用来转发流量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9518"><span data-slate-object="text" data-key="9519"><span data-slate-leaf="true" data-offset-key="9519:0" data-first-offset="true"><span data-slate-string="true">想要看 Service 代理了哪些后端的 Pod，你可以用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9520"><span data-slate-object="text" data-key="9521"><span data-slate-leaf="true" data-offset-key="9521:0" data-first-offset="true"><span data-slate-string="true">kubectl describe</span></span></span></span><span data-slate-object="text" data-key="9522"><span data-slate-leaf="true" data-offset-key="9522:0" data-first-offset="true"><span data-slate-string="true"> 命令：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="9523"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9524"><span data-slate-object="text" data-key="9525"><span data-slate-leaf="true" data-offset-key="9525:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="9526"><span data-slate-leaf="true" data-offset-key="9526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">describe</span></span></span></span><span data-slate-object="text" data-key="9527"><span data-slate-leaf="true" data-offset-key="9527:0" data-first-offset="true"><span data-slate-string="true"> svc ngx</span></span></span><span data-slate-object="text" data-key="9528"><span data-slate-leaf="true" data-offset-key="9528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="9529"><span data-slate-leaf="true" data-offset-key="9529:0" data-first-offset="true"><span data-slate-string="true">svc</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9530"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/80/16/80b6e738bc13e1f1d56fa99080f65716.png?wh=1244x846"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9531"><span data-slate-object="text" data-key="9532"><span data-slate-leaf="true" data-offset-key="9532:0" data-first-offset="true"><span data-slate-string="true">截图里显示 Service 对象管理了两个 endpoint，分别是 “10.10.0.232:80” 和 “10.10.1.86:80”，初步判断与 Service、Deployment 的定义相符，那么这两个 IP 地址是不是 Nginx Pod 的实际地址呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9533"><span data-slate-object="text" data-key="9534"><span data-slate-leaf="true" data-offset-key="9534:0" data-first-offset="true"><span data-slate-string="true">我们还是用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9535"><span data-slate-object="text" data-key="9536"><span data-slate-leaf="true" data-offset-key="9536:0" data-first-offset="true"><span data-slate-string="true">kubectl get pod</span></span></span></span><span data-slate-object="text" data-key="9537"><span data-slate-leaf="true" data-offset-key="9537:0" data-first-offset="true"><span data-slate-string="true"> 来看一下，加上参数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9538"><span data-slate-object="text" data-key="9539"><span data-slate-leaf="true" data-offset-key="9539:0" data-first-offset="true"><span data-slate-string="true">-o wide</span></span></span></span><span data-slate-object="text" data-key="9540"><span data-slate-leaf="true" data-offset-key="9540:0" data-first-offset="true"><span data-slate-string="true">：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="9541"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9542"><span data-slate-object="text" data-key="9543"><span data-slate-leaf="true" data-offset-key="9543:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="9544"><span data-slate-leaf="true" data-offset-key="9544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="9545"><span data-slate-leaf="true" data-offset-key="9545:0" data-first-offset="true"><span data-slate-string="true"> pod </span></span></span><span data-slate-object="text" data-key="9546"><span data-slate-leaf="true" data-offset-key="9546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="9547"><span data-slate-leaf="true" data-offset-key="9547:0" data-first-offset="true"><span data-slate-string="true">o wide</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9548"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/35/34/355129b4eb2290b3df50f7c184c06634.png?wh=1920x241"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9549"><span data-slate-object="text" data-key="9550"><span data-slate-leaf="true" data-offset-key="9550:0" data-first-offset="true"><span data-slate-string="true">把 Pod 的地址与 Service 的信息做个对比，我们就能够验证 Service 确实用一个静态 IP 地址代理了两个 Pod 的动态 IP 地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9551"><span data-slate-object="text" data-key="9552"><span data-slate-leaf="true" data-offset-key="9552:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">那怎么测试 Service 的负载均衡效果呢？</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9553"><span data-slate-object="text" data-key="9554"><span data-slate-leaf="true" data-offset-key="9554:0" data-first-offset="true"><span data-slate-string="true">因为 Service、 Pod 的 IP 地址都是 Kubernetes 集群的内部网段，所以我们需要用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9555"><span data-slate-object="text" data-key="9556"><span data-slate-leaf="true" data-offset-key="9556:0" data-first-offset="true"><span data-slate-string="true">kubectl exec</span></span></span></span><span data-slate-object="text" data-key="9557"><span data-slate-leaf="true" data-offset-key="9557:0" data-first-offset="true"><span data-slate-string="true"> 进入到 Pod 内部（或者 ssh 登录集群节点），再用 curl 等工具来访问 Service：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="9558"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9559"><span data-slate-object="text" data-key="9560"><span data-slate-leaf="true" data-offset-key="9560:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="9561"><span data-slate-leaf="true" data-offset-key="9561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="9562"><span data-slate-leaf="true" data-offset-key="9562:0" data-first-offset="true"><span data-slate-string="true"> -it ngx-dep-6796688696-r2j6t -- sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9563"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/72/28/72eab1f20e7d91ddfe07b5e521712b28.png?wh=1638x838"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9564"><span data-slate-object="text" data-key="9565"><span data-slate-leaf="true" data-offset-key="9565:0" data-first-offset="true"><span data-slate-string="true">在 Pod 里，用 curl 访问 Service 的 IP 地址，就会看到它把数据转发给后端的 Pod，输出信息会显示具体是哪个 Pod 响应了请求，就表明 Service 确实完成了对 Pod 的负载均衡任务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9566"><span data-slate-object="text" data-key="9567"><span data-slate-leaf="true" data-offset-key="9567:0" data-first-offset="true"><span data-slate-string="true">我们再试着删除一个 Pod，看看 Service 是否会更新后端 Pod 的信息，实现自动化的服务发现：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="9568"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9569"><span data-slate-object="text" data-key="9570"><span data-slate-leaf="true" data-offset-key="9570:0" data-first-offset="true"><span data-slate-string="true">kubectl delete pod ngx-dep-6796688696-r2j6t</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9571"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/68/65/688362b0d462ba94fed6f9c2fcbed565.png?wh=1920x1200"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9572"><span data-slate-object="text" data-key="9573"><span data-slate-leaf="true" data-offset-key="9573:0" data-first-offset="true"><span data-slate-string="true">由于 Pod 被 Deployment 对象管理，删除后会自动重建，而 Service 又会通过 controller-manager 实时监控 Pod 的变化情况，所以就会立即更新它代理的 IP 地址。通过截图你就可以看到有一个 IP 地址 “10.10.1.86” 消失了，换成了新的 “10.10.1.87”，它就是新创建的 Pod。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9574"><span data-slate-object="text" data-key="9575"><span data-slate-leaf="true" data-offset-key="9575:0" data-first-offset="true"><span data-slate-string="true">你也可以再尝试一下使用 “ping” 来测试 Service 的 IP 地址：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9576"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/71/1d/7182131d675c5d03ab9c91be4869a51d.png?wh=1638x428"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9577"><span data-slate-object="text" data-key="9578"><span data-slate-leaf="true" data-offset-key="9578:0" data-first-offset="true"><span data-slate-string="true">会发现根本 ping 不通，因为 Service 的 IP 地址是 “虚” 的，只用于转发流量，所以 ping 无法得到回应数据包，也就失败了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9579" id="sr-toc-4"><span data-slate-object="text" data-key="9580"><span data-slate-leaf="true" data-offset-key="9580:0" data-first-offset="true"><span data-slate-string="true">如何以域名的方式使用 Service</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9581"><span data-slate-object="text" data-key="9582"><span data-slate-leaf="true" data-offset-key="9582:0" data-first-offset="true"><span data-slate-string="true">到这里 Service 的基本用法就讲得差不多了，不过它还有一些高级特性值得了解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9583"><span data-slate-object="text" data-key="9584"><span data-slate-leaf="true" data-offset-key="9584:0" data-first-offset="true"><span data-slate-string="true">我们先来看看 DNS 域名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9585"><span data-slate-object="text" data-key="9586"><span data-slate-leaf="true" data-offset-key="9586:0" data-first-offset="true"><span data-slate-string="true">Service 对象的 IP 地址是静态的，保持稳定，这在微服务里确实很重要，不过数字形式的 IP 地址用起来还是不太方便。这个时候 Kubernetes 的 DNS 插件就派上了用处，它可以为 Service 创建易写易记的域名，让 Service 更容易使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9587"><span data-slate-object="text" data-key="9588"><span data-slate-leaf="true" data-offset-key="9588:0" data-first-offset="true"><span data-slate-string="true">使用 DNS 域名之前，我们要先了解一个新的概念：</span></span></span><span data-slate-object="text" data-key="9589"><span data-slate-leaf="true" data-offset-key="9589:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">名字空间</span></span></span></span><span data-slate-object="text" data-key="9590"><span data-slate-leaf="true" data-offset-key="9590:0" data-first-offset="true"><span data-slate-string="true">（namespace）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9591"><span data-slate-object="text" data-key="9592"><span data-slate-leaf="true" data-offset-key="9592:0" data-first-offset="true"><span data-slate-string="true">注意它与我们在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9593"><span data-slate-object="text" data-key="9594"><span data-slate-leaf="true" data-offset-key="9594:0" data-first-offset="true"><span data-slate-string="true">第 2 讲</span></span></span></a><span data-slate-object="text" data-key="9595"><span data-slate-leaf="true" data-offset-key="9595:0" data-first-offset="true"><span data-slate-string="true">里说的用于资源隔离的 Linux namespace 技术完全不同，千万不要弄混了。Kubernetes 只是借用了这个术语，但目标是类似的，用来在集群里实现对 API 对象的隔离和分组。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9596"><span data-slate-object="text" data-key="9597"><span data-slate-leaf="true" data-offset-key="9597:0" data-first-offset="true"><span data-slate-string="true">namespace 的简写是 “</span></span></span><span data-slate-object="text" data-key="9598"><span data-slate-leaf="true" data-offset-key="9598:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">ns</span></span></span></span><span data-slate-object="text" data-key="9599"><span data-slate-leaf="true" data-offset-key="9599:0" data-first-offset="true"><span data-slate-string="true">”，你可以使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9600"><span data-slate-object="text" data-key="9601"><span data-slate-leaf="true" data-offset-key="9601:0" data-first-offset="true"><span data-slate-string="true">kubectl get ns</span></span></span></span><span data-slate-object="text" data-key="9602"><span data-slate-leaf="true" data-offset-key="9602:0" data-first-offset="true"><span data-slate-string="true"> 来查看当前集群里都有哪些名字空间，也就是说 API 对象有哪些分组：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="9603"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9604"><span data-slate-object="text" data-key="9605"><span data-slate-leaf="true" data-offset-key="9605:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="9606"><span data-slate-leaf="true" data-offset-key="9606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="9607"><span data-slate-leaf="true" data-offset-key="9607:0" data-first-offset="true"><span data-slate-string="true"> ns</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9608"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/16/09/169398a24700368f1550950f0e34b409.png?wh=854x368"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9609"><span data-slate-object="text" data-key="9610"><span data-slate-leaf="true" data-offset-key="9610:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 有一个默认的名字空间，叫 “</span></span></span><span data-slate-object="text" data-key="9611"><span data-slate-leaf="true" data-offset-key="9611:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">default</span></span></span></span><span data-slate-object="text" data-key="9612"><span data-slate-leaf="true" data-offset-key="9612:0" data-first-offset="true"><span data-slate-string="true">”，如果不显式指定，API 对象都会在这个 “default” 名字空间里。而其他的名字空间都有各自的用途，比如 “kube-system” 就包含了 apiserver、etcd 等核心组件的 Pod。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9613"><span data-slate-object="text" data-key="9614"><span data-slate-leaf="true" data-offset-key="9614:0" data-first-offset="true"><span data-slate-string="true">因为 DNS 是一种层次结构，为了避免太多的域名导致冲突，Kubernetes 就把名字空间作为域名的一部分，减少了重名的可能性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9615"><span data-slate-object="text" data-key="9616"><span data-slate-leaf="true" data-offset-key="9616:0" data-first-offset="true"><span data-slate-string="true">Service 对象的域名完全形式是 “</span></span></span><span data-slate-object="text" data-key="9617"><span data-slate-leaf="true" data-offset-key="9617:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对象。名字空间. svc.cluster.local</span></span></span></span><span data-slate-object="text" data-key="9618"><span data-slate-leaf="true" data-offset-key="9618:0" data-first-offset="true"><span data-slate-string="true">”，但很多时候也可以省略后面的部分，直接写 “</span></span></span><span data-slate-object="text" data-key="9619"><span data-slate-leaf="true" data-offset-key="9619:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对象。名字空间</span></span></span></span><span data-slate-object="text" data-key="9620"><span data-slate-leaf="true" data-offset-key="9620:0" data-first-offset="true"><span data-slate-string="true">” 甚至 “</span></span></span><span data-slate-object="text" data-key="9621"><span data-slate-leaf="true" data-offset-key="9621:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对象名</span></span></span></span><span data-slate-object="text" data-key="9622"><span data-slate-leaf="true" data-offset-key="9622:0" data-first-offset="true"><span data-slate-string="true">” 就足够了，默认会使用对象所在的名字空间（比如这里就是 default）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9623"><span data-slate-object="text" data-key="9624"><span data-slate-leaf="true" data-offset-key="9624:0" data-first-offset="true"><span data-slate-string="true">现在我们来试验一下 DNS 域名的用法，还是先 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9625"><span data-slate-object="text" data-key="9626"><span data-slate-leaf="true" data-offset-key="9626:0" data-first-offset="true"><span data-slate-string="true">kubectl exec</span></span></span></span><span data-slate-object="text" data-key="9627"><span data-slate-leaf="true" data-offset-key="9627:0" data-first-offset="true"><span data-slate-string="true">  进入 Pod，然后用 curl 访问 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9628"><span data-slate-object="text" data-key="9629"><span data-slate-leaf="true" data-offset-key="9629:0" data-first-offset="true"><span data-slate-string="true">ngx-svc</span></span></span></span><span data-slate-object="text" data-key="9630"><span data-slate-leaf="true" data-offset-key="9630:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9631"><span data-slate-object="text" data-key="9632"><span data-slate-leaf="true" data-offset-key="9632:0" data-first-offset="true"><span data-slate-string="true">ngx-svc.default</span></span></span></span><span data-slate-object="text" data-key="9633"><span data-slate-leaf="true" data-offset-key="9633:0" data-first-offset="true"><span data-slate-string="true"> 等域名：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9634"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9b/8b/9b8f58e19f7551f9e3a152d79d9d1e8b.png?wh=1638x1204"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9635"><span data-slate-object="text" data-key="9636"><span data-slate-leaf="true" data-offset-key="9636:0" data-first-offset="true"><span data-slate-string="true">可以看到，现在我们就不再关心 Service 对象的 IP 地址，只需要知道它的名字，就可以用 DNS 的方式去访问后端服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9637"><span data-slate-object="text" data-key="9638"><span data-slate-leaf="true" data-offset-key="9638:0" data-first-offset="true"><span data-slate-string="true">比起 Docker，这无疑是一个巨大的进步，而且对比其他微服务框架（如 Dubbo、Spring Cloud），由于服务发现机制被集成在了基础设施里，也会让应用的开发更加便捷。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9639"><span data-slate-object="text" data-key="9640"><span data-slate-leaf="true" data-offset-key="9640:0" data-first-offset="true"><span data-slate-string="true">（顺便说一下，Kubernetes 也为每个 Pod 分配了域名，形式是 “</span></span></span><span data-slate-object="text" data-key="9641"><span data-slate-leaf="true" data-offset-key="9641:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">IP 地址。名字空间. pod.cluster.local</span></span></span></span><span data-slate-object="text" data-key="9642"><span data-slate-leaf="true" data-offset-key="9642:0" data-first-offset="true"><span data-slate-string="true">”，但需要把 IP 地址里的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9643"><span data-slate-object="text" data-key="9644"><span data-slate-leaf="true" data-offset-key="9644:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span></span><span data-slate-object="text" data-key="9645"><span data-slate-leaf="true" data-offset-key="9645:0" data-first-offset="true"><span data-slate-string="true"> 改成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9646"><span data-slate-object="text" data-key="9647"><span data-slate-leaf="true" data-offset-key="9647:0" data-first-offset="true"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="9648"><span data-slate-leaf="true" data-offset-key="9648:0" data-first-offset="true"><span data-slate-string="true"> 。比如地址 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9649"><span data-slate-object="text" data-key="9650"><span data-slate-leaf="true" data-offset-key="9650:0" data-first-offset="true"><span data-slate-string="true">10.10.1.87</span></span></span></span><span data-slate-object="text" data-key="9651"><span data-slate-leaf="true" data-offset-key="9651:0" data-first-offset="true"><span data-slate-string="true">，它对应的域名就是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9652"><span data-slate-object="text" data-key="9653"><span data-slate-leaf="true" data-offset-key="9653:0" data-first-offset="true"><span data-slate-string="true">10-10-1-87.default.pod</span></span></span></span><span data-slate-object="text" data-key="9654"><span data-slate-leaf="true" data-offset-key="9654:0" data-first-offset="true"><span data-slate-string="true">。）</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9655" id="sr-toc-5"><span data-slate-object="text" data-key="9656"><span data-slate-leaf="true" data-offset-key="9656:0" data-first-offset="true"><span data-slate-string="true">如何让 Service 对外暴露服务</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9657"><span data-slate-object="text" data-key="9658"><span data-slate-leaf="true" data-offset-key="9658:0" data-first-offset="true"><span data-slate-string="true">由于 Service 是一种负载均衡技术，所以它不仅能够管理 Kubernetes 集群内部的服务，还能够担当向集群外部暴露服务的重任。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9659"><span data-slate-object="text" data-key="9660"><span data-slate-leaf="true" data-offset-key="9660:0" data-first-offset="true"><span data-slate-string="true">Service 对象有一个关键字段 “</span></span></span><span data-slate-object="text" data-key="9661"><span data-slate-leaf="true" data-offset-key="9661:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9662"><span data-slate-leaf="true" data-offset-key="9662:0" data-first-offset="true"><span data-slate-string="true">”，表示 Service 是哪种类型的负载均衡。前面我们看到的用法都是对集群内部 Pod 的负载均衡，所以这个字段的值就是默认的 “</span></span></span><span data-slate-object="text" data-key="9663"><span data-slate-leaf="true" data-offset-key="9663:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">ClusterIP</span></span></span></span><span data-slate-object="text" data-key="9664"><span data-slate-leaf="true" data-offset-key="9664:0" data-first-offset="true"><span data-slate-string="true">”，Service 的静态 IP 地址只能在集群内访问。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9665"><span data-slate-object="text" data-key="9666"><span data-slate-leaf="true" data-offset-key="9666:0" data-first-offset="true"><span data-slate-string="true">除了 “ClusterIP”，Service 还支持其他三种类型，分别是 “</span></span></span><span data-slate-object="text" data-key="9667"><span data-slate-leaf="true" data-offset-key="9667:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">ExternalName</span></span></span></span><span data-slate-object="text" data-key="9668"><span data-slate-leaf="true" data-offset-key="9668:0" data-first-offset="true"><span data-slate-string="true">”“</span></span></span><span data-slate-object="text" data-key="9669"><span data-slate-leaf="true" data-offset-key="9669:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">LoadBalancer</span></span></span></span><span data-slate-object="text" data-key="9670"><span data-slate-leaf="true" data-offset-key="9670:0" data-first-offset="true"><span data-slate-string="true">”“</span></span></span><span data-slate-object="text" data-key="9671"><span data-slate-leaf="true" data-offset-key="9671:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">NodePort</span></span></span></span><span data-slate-object="text" data-key="9672"><span data-slate-leaf="true" data-offset-key="9672:0" data-first-offset="true"><span data-slate-string="true">”。不过前两种类型一般由云服务商提供，我们的实验环境用不到，所以接下来就重点看 “NodePort” 这个类型。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9673"><span data-slate-object="text" data-key="9674"><span data-slate-leaf="true" data-offset-key="9674:0" data-first-offset="true"><span data-slate-string="true">如果我们在使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9675"><span data-slate-object="text" data-key="9676"><span data-slate-leaf="true" data-offset-key="9676:0" data-first-offset="true"><span data-slate-string="true">kubectl expose</span></span></span></span><span data-slate-object="text" data-key="9677"><span data-slate-leaf="true" data-offset-key="9677:0" data-first-offset="true"><span data-slate-string="true"> 的时候加上参数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9678"><span data-slate-object="text" data-key="9679"><span data-slate-leaf="true" data-offset-key="9679:0" data-first-offset="true"><span data-slate-string="true">--type=NodePort</span></span></span></span><span data-slate-object="text" data-key="9680"><span data-slate-leaf="true" data-offset-key="9680:0" data-first-offset="true"><span data-slate-string="true">，或者在 YAML 里添加字段 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="9681"><span data-slate-object="text" data-key="9682"><span data-slate-leaf="true" data-offset-key="9682:0" data-first-offset="true"><span data-slate-string="true">type:NodePort</span></span></span></span><span data-slate-object="text" data-key="9683"><span data-slate-leaf="true" data-offset-key="9683:0" data-first-offset="true"><span data-slate-string="true">，那么 Service 除了会对后端的 Pod 做负载均衡之外，还会在集群里的每个节点上创建一个独立的端口，用这个端口对外提供服务，这也正是 “NodePort” 这个名字的由来。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9684"><span data-slate-object="text" data-key="9685"><span data-slate-leaf="true" data-offset-key="9685:0" data-first-offset="true"><span data-slate-string="true">让我们修改一下 Service 的 YAML 文件，加上字段 “type”：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9686"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9687"><span data-slate-object="text" data-key="9688"><span data-slate-leaf="true" data-offset-key="9688:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9689"><span data-slate-object="text" data-key="9690"><span data-slate-leaf="true" data-offset-key="9690:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9691"><span data-slate-object="text" data-key="9692"><span data-slate-leaf="true" data-offset-key="9692:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9693"><span data-slate-object="text" data-key="9694"><span data-slate-leaf="true" data-offset-key="9694:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9695"><span data-slate-object="text" data-key="9696"><span data-slate-leaf="true" data-offset-key="9696:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="9697"><span data-slate-leaf="true" data-offset-key="9697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9698"><span data-slate-leaf="true" data-offset-key="9698:0" data-first-offset="true"><span data-slate-string="true">: NodePort</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9699"><span data-slate-object="text" data-key="9700"><span data-slate-leaf="true" data-offset-key="9700:0" data-first-offset="true"><span data-slate-string="true">然后创建对象，再查看它的状态：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="9701"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9702"><span data-slate-object="text" data-key="9703"><span data-slate-leaf="true" data-offset-key="9703:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="9704"><span data-slate-leaf="true" data-offset-key="9704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="9705"><span data-slate-leaf="true" data-offset-key="9705:0" data-first-offset="true"><span data-slate-string="true"> svc</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="9706"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/64/f9/643cf4690a42f723732f9f150021fff9.png?wh=1756x248"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9707"><span data-slate-object="text" data-key="9708"><span data-slate-leaf="true" data-offset-key="9708:0" data-first-offset="true"><span data-slate-string="true">就会看到 “TYPE” 变成了 “NodePort”，而在 “PORT” 列里的端口信息也不一样，除了集群内部使用的 “80” 端口，还多出了一个 “30651” 端口，这就是 Kubernetes 在节点上为 Service 创建的专用映射端口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9709"><span data-slate-object="text" data-key="9710"><span data-slate-leaf="true" data-offset-key="9710:0" data-first-offset="true"><span data-slate-string="true">因为这个端口号属于节点，外部能够直接访问，所以现在我们就可以不用登录集群节点或者进入 Pod 内部，直接在集群外使用任意一个节点的 IP 地址，就能够访问 Service 和它代理的后端服务了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9711"><span data-slate-object="text" data-key="9712"><span data-slate-leaf="true" data-offset-key="9712:0" data-first-offset="true"><span data-slate-string="true">比如我现在所在的服务器是 “192.168.10.208”，在这台主机上用 curl 访问 Kubernetes 集群的两个节点 “192.168.10.210”“192.168.10.220”，就可以得到 Nginx Pod 的响应数据：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9713"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/eb/75/eb917ecdf52cc3f266e6555bd7a1b075.png?wh=1076x666"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9714"><span data-slate-object="text" data-key="9715"><span data-slate-leaf="true" data-offset-key="9715:0" data-first-offset="true"><span data-slate-string="true">我把 NodePort 与 Service、Deployment 的对应关系画成了图，你看了应该就能更好地明白它的工作原理：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9716"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/fy/4a/fyyebea67e4471aa53cb3a0e8ebe624a.jpg?wh=1920x940"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9717"><span data-slate-object="text" data-key="9718"><span data-slate-leaf="true" data-offset-key="9718:0" data-first-offset="true"><span data-slate-string="true">学到这里，你是不是觉得 NodePort 类型的 Service 很方便呢。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9719"><span data-slate-object="text" data-key="9720"><span data-slate-leaf="true" data-offset-key="9720:0" data-first-offset="true"><span data-slate-string="true">不过它也有一些缺点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9721"><span data-slate-object="text" data-key="9722"><span data-slate-leaf="true" data-offset-key="9722:0" data-first-offset="true"><span data-slate-string="true">第一个缺点是它的端口数量很有限。Kubernetes 为了避免端口冲突，默认只在 “30000~32767” 这个范围内随机分配，只有 2000 多个，而且都不是标准端口号，这对于具有大量业务应用的系统来说根本不够用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9723"><span data-slate-object="text" data-key="9724"><span data-slate-leaf="true" data-offset-key="9724:0" data-first-offset="true"><span data-slate-string="true">第二个缺点是它会在每个节点上都开端口，然后使用 kube-proxy 路由到真正的后端 Service，这对于有很多计算节点的大集群来说就带来了一些网络通信成本，不是特别经济。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9725"><span data-slate-object="text" data-key="9726"><span data-slate-leaf="true" data-offset-key="9726:0" data-first-offset="true"><span data-slate-string="true">第三个缺点，它要求向外界暴露节点的 IP 地址，这在很多时候是不可行的，为了安全还需要在集群外再搭一个反向代理，增加了方案的复杂度。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9727"><span data-slate-object="text" data-key="9728"><span data-slate-leaf="true" data-offset-key="9728:0" data-first-offset="true"><span data-slate-string="true">虽然有这些缺点，但 NodePort 仍然是 Kubernetes 对外提供服务的一种简单易行的方式，在其他更好的方式出现之前，我们也只能使用它。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9729" id="sr-toc-6"><span data-slate-object="text" data-key="9730"><span data-slate-leaf="true" data-offset-key="9730:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9731"><span data-slate-object="text" data-key="9732"><span data-slate-leaf="true" data-offset-key="9732:0" data-first-offset="true"><span data-slate-string="true">好了，今天我们学习了 Service 对象，它实现了负载均衡和服务发现技术，是 Kubernetes 应对微服务、服务网格等现代流行应用架构的解决方案。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9733"><span data-slate-object="text" data-key="9734"><span data-slate-leaf="true" data-offset-key="9734:0" data-first-offset="true"><span data-slate-string="true">我再小结一下今天的要点：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9735"><div data-slate-type="list-line" data-slate-object="block" data-key="9736"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="9737"><span data-slate-leaf="true" data-offset-key="9737:0" data-first-offset="true"><span data-slate-string="true">Pod 的生命周期很短暂，会不停地创建销毁，所以就需要用 Service 来实现负载均衡，它由 Kubernetes 分配固定的 IP 地址，能够屏蔽后端的 Pod 变化。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="9738"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="9739"><span data-slate-leaf="true" data-offset-key="9739:0" data-first-offset="true"><span data-slate-string="true">Service 对象使用与 Deployment、DaemonSet 相同的 “selector” 字段，选择要代理的后端 Pod，是松耦合关系。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="9740"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="9741"><span data-slate-leaf="true" data-offset-key="9741:0" data-first-offset="true"><span data-slate-string="true">基于 DNS 插件，我们能够以域名的方式访问 Service，比静态 IP 地址更方便。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="9742"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="9743"><span data-slate-leaf="true" data-offset-key="9743:0" data-first-offset="true"><span data-slate-string="true">名字空间是 Kubernetes 用来隔离对象的一种方式，实现了逻辑上的对象分组，Service 的域名里就包含了名字空间限定。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="9744"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="9745"><span data-slate-leaf="true" data-offset-key="9745:0" data-first-offset="true"><span data-slate-string="true">Service 的默认类型是 “ClusterIP”，只能在集群内部访问，如果改成 “NodePort”，就会在节点上开启一个随机端口号，让外界也能够访问内部的服务。</span></span></span></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9746" id="sr-toc-7"><span data-slate-object="text" data-key="9747"><span data-slate-leaf="true" data-offset-key="9747:0" data-first-offset="true"><span data-slate-string="true">课下作业</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9748"><span data-slate-object="text" data-key="9749"><span data-slate-leaf="true" data-offset-key="9749:0" data-first-offset="true"><span data-slate-string="true">最后是课下作业时间，给你留两个思考题：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9750"><div data-slate-type="list-line" data-slate-object="block" data-key="9751"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="9752"><span data-slate-leaf="true" data-offset-key="9752:0" data-first-offset="true"><span data-slate-string="true">为什么 Service 的 IP 地址是静态且虚拟的？出于什么目的，有什么好处？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="9753"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="9754"><span data-slate-leaf="true" data-offset-key="9754:0" data-first-offset="true"><span data-slate-string="true">你了解负载均衡技术吗？它都有哪些算法，Service 会用哪种呢？</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9755"><span data-slate-object="text" data-key="9756"><span data-slate-leaf="true" data-offset-key="9756:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区分享你的思考，以输出带动自己输入。到今天，你已经完成 2/3 的专栏学习了，回看一起学过的内容，不知你收获如何呢。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9757"><span data-slate-object="text" data-key="9758"><span data-slate-leaf="true" data-offset-key="9758:0" data-first-offset="true"><span data-slate-string="true">如果觉得有帮助，不妨分享给自己身边的朋友一起学习，我们下节课再见。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9759"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/73/68/7370727f61e82f96acf0316456329968.jpg?wh=1920x2465"></div></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/c1/9415076c60e63fc6303d9a3bc900b5c1.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-8">精选留言 (23)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>西门吹牛</span></div></div><div>Service 的 IP 是 vip，其实就是保证外部请求的 ip 不变，不会因为节点变动，而 ip 跟着动，和 lvs + nginx 部署高可用集群一样，主要保证高可用。方便。
负载均衡算法，Service 会用哪种呢？
轮询，加权轮询，随机，针对有状态的一致性 hash，还有针对最少活跃调用数的。
最好的负载均衡是自适应负载均衡，可以动态的监控收集服务的状态，各种指标进行加权计算，从中选出个最合适的。
感觉，service 应该是自适应，都有能力自动编排了，对于一些服务状态的数据指标，收集应该问题不大
</div><div><p>作者回复：说的很好。

Service 的负载均衡能力比较弱，只支持最简单的 round-robin。</p></div><div><div>2022-08-05</div><div><div><i></i></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 郑海成</span></div></div><div>Q1: svc 是基于内核的 netfilter 技术实现的，在用户态通过 iptable 和 ipvs 应用 hook 链和表，所以它的 IP 注定是虚拟的，至于静态考虑则是为暴露的服务提供相对稳定性能的 dns 解析

Q2: 负载均衡技术分为 DNS、四层和七层，dns 也是一种简单的负载均衡只是算法很简单随机；四层负载均衡主要有 nat、IP 隧道等，主要是做一些 IP 和端口的变换，算法也不多比如 rr，七层负载均衡则是基于 http header 来做负载算法很多，可以做一些流量控制；其次还有在客户端做负载均衡比如 nacos、istio 等</div><div><p>作者回复: great</p></div><div><div>2022-08-08</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>dao</span></div></div><div>前几节课多节点集群看起来一切正常，但本节的 dns 测试一直无法通过。周末搞了两天，最终发现是 virtualbox 两张网卡的坑。首先是集群节点的 kubelet 配置需要分别指定 `KUBELET_EXTRA_ARGS="--node-ip=192.168.56.x"`；然后时安装 flannel 需要指定 `--iface=enp0s3`，这张网卡应该时前面的 node-ip 对应的网卡。</div><div><p>作者回复: great，两张网卡确实会遇到一些问题，感谢经验分享。</p></div><div><div>2022-08-14</div><div><div><i></i><span>3</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132"></div></div><div><div><div><span>ppd0705</span></div></div><div>不知道有没有同样遇到 dns 无法解析域名的同学，重启 coredns 试试：
kubectl -n kube-system rollout restart deployment coredns</div><div><p>作者回复：有的时候这些 pod 会有问题，用 describe 或者 logs 看看，有问题就重启。</p></div><div><div>2022-08-06</div><div><div><i></i><span>4</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>YueShi</span></div></div><div>各位大佬们，如果有用虚拟机的，使用挂起再恢复的，建议每次遇到问题先重启虚拟机，踩了很多次这种挂起再恢复导致的网络问题的坑了</div><div><p>作者回复：是的，Kubernetes 感觉比较娇贵，不那么皮实，重启可以解决很多问题。</p></div><div><div>2022-08-05</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/23/81/3865297c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 龙之大者</span></div></div><div>进入 pod 后，如果 curl ngx-svc 出现 Could not resolve hostnames 报错，可以重启 coredns deployment

kubectl -n kube-system rollout restart deployment coredns

https://stackoverflow.com/questions/45805483/kubernetes-pods-cant-resolve-hostnames</div><div><p>作者回复：是的，Kubernetes 里的组件也不会总是运行正常的，发现有问题就可以简单地重启解决。</p></div><div><div>2022-08-24</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>$ 侯</span></div></div><div>老师您好：
请问个问题，配置 NodePort 后用 curl 测试一直卡在那里没反应，但是用浏览器是可以访问的，这有可能是什么原因导致的？</div><div><p>作者回复：这个按理来说不应该，怀疑可能是 curl 和浏览器所在的网络不同，先在 Kubernetes 集群节点里验证 NodePort 正常，再从网络方面排查吧。</p></div><div><div>2022-09-02</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>$ 侯</span></div></div><div>虚拟机 curl ngx-svc 产生 Could not resolve 问题解决办法：
1. kube-flannel.yml 文件中加入  --iface=enp0s3，位置如下
  containers:
  - name: kube-flannel
    image: xxx
    command:
    - /opt/bin/flanneld
    args:
    - --ip-masq
    - --kube-subnet-mgr
    - --iface=enp0s3 # 这里新增这条
2. 修改 kubelet 配置
sudo mkdir /etc/sysconfig
sudo vim /etc/sysconfig/kubelet
加入：
KUBELET_EXTRA_ARGS="--node-ip=192.168.56.208"
保存
重启 kubelet：
systemctl restart kubelet</div><div><p>作者回复：这个一般都是 kubeadm 的时候集群没有配置好，最好 reset 后重新搭建，或者在 minikube 里做实验也可以。</p></div><div><div>2022-09-02</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/e3/9e/b26da70d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>closer</span></div></div><div>'srv : $server_addr:$server_port\nhost: $hostname\nuri : $request_method $host $request_uri\ndate: $time_iso8601\n'; 文档中这个什么意思</div><div><p>作者回复：可以参考 nginx 官网的文档，是一些请求相关的变量。</p></div><div><div>2022-08-22</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/14/e7/c534fab3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>wcy</span></div></div><div>负载均衡 算法 5 种：轮询、随机、最小连接、地址 hash、加权
轮询：将所有请求依次分配到每台服务器上
随机：将请求随机分配到各个服务器
最小连接：将请求分配到连接最少的服务器上
hash：将地址 hash，同一来源地址的请求分配到同一服务器上
加权：在前面 4 种方法基础上，按权重分配请求到服务器
</div><div><p>作者回复: good</p></div><div><div>2022-08-21</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/23/52/66/1aee6ab4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>includestdio.h</span></div></div><div>2. 
svc 分三种模式中，iptables 模式 属于 “假轮询” 算法，逐条匹配 iptables 规则，匹配成功后则将对应流量转发到相应的 Pod（下面是我自己实验 1 个 svc 代理 3 个 pod 的场景，流量被转发到 KUBE-SVC-IQGXNJVVP26VHMIN 链后，会先去第一条规则（两条规则中的 ip 对应两个 pod ip），0.33333333349 的概率会选中，如果未选中，再去下一跳规则，0.50000000000 概率选中，如果两条都没匹配中才会到最后一个 pod，大致匹配下来类似 rr 调度，但本质还是 random，只不过是通过权重优先级做了一定的干预策略）
-A KUBE-SVC-IQGXNJVVP26VHMIN -m comment --comment "default/nginx-service:name-of-service-port -&gt; 192.168.204.29:80" -m statistic --mode random --probability 0.33333333349 -j KUBE-SEP-4
ZYO247C43CHTOHR
-A KUBE-SVC-IQGXNJVVP26VHMIN -m comment --comment "default/nginx-service:name-of-service-port -&gt; 192.168.204.30:80" -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-P
LDOSKLBV55BNP3N

ipvs 模式则可以通过配置文件配置更多调度算法：rr、lc、dh、sh、sed、nq
https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#proxy-mode-ipvs</div><div><p>作者回复: great</p></div><div><div>2022-08-19</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/2c/7e/f1efd18b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>摊牌</span></div></div><div>service 声明为 nodePort 类型时，可以指定端口吗，老师？</div><div><p>作者回复：可以的，用字段 “nodePort”，可以用 kubectl explain 看文档。</p></div><div><div>2022-08-18</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>朱雯</span></div></div><div>nginx 负载均衡是可以设置策略的，权重之类的，svc 和 nodeport 是怎么设置这方面的信息呢</div><div><p>作者回复：因为 Kubernetes 是基础设施，高级的负载均衡策略属于应用层次，Kubernetes 来做这个就属于越位了。</p></div><div><div>2022-08-18</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>朱雯</span></div></div><div>/etc/resolv.conf 配置里面有这么一行
search default.svc.cluster.local svc.cluster.local cluster.local
所以 dns，可以是 ngx-dep，也可以是 ngx-dep.default, 但不能是 ngx-dep.default.sbc.cluster。。</div><div><p>作者回复：是的，Service 的域名不是能够随便简写的。</p></div><div><div>2022-08-18</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>一步</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>Service 和 Deployment 管理的都是 pod, 各干自己的事情相互之间不影响。 

k8s 这种 对象的设计感觉非常好</div><div><p>作者回复: good。</p></div><div><div>2022-08-14</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Geek_9d0de4</span></div></div><div>W0813 11:20:12.996260       1 reflector.go:324] k8s.io/apiserver/pkg/server/dynamiccertificates/configmap_cafile_content.go:205: failed to list *v1.ConfigMap: Get "https://192.168.56.80:6443/api/v1/namespaces/kube-system/configmaps?fieldSelector=metadata.name%3Dextension-apiserver-authentication&amp;limit=500&amp;resourceVersion=0": dial tcp 192.168.56.80:6443: connect: connection refused
E0813 11:20:12.996379       1 reflector.go:138] k8s.io/apiserver/pkg/server/dynamiccertificates/configmap_cafile_content.go:205: Failed to watch *v1.ConfigMap: failed to list *v1.ConfigMap: Get "https://192.168.56.80:6443/api/v1/namespaces/kube-system/configmaps?fieldSelector=metadata.name%3Dextension-apiserver-authentication&amp;limit=500&amp;resourceVersion=0": dial tcp 192.168.56.80:6443: connect: connection refused

</div><div><div>2022-08-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Geek_9d0de4</span></div></div><div>ping 不通
/ # curl 10.110.240.118
srv : 10.10.1.5:80

host: ngx-dep-6796688696-6j78t
uri : GET 10.110.240.118 /
date: 2022-08-13T11:05:57+00:00
/ # curl 10.110.240.118
curl: (7) Failed to connect to 10.110.240.118 port 80 after 0 ms: Host is unreachable
/ # curl 10.110.240.118
curl: (7) Failed to connect to 10.110.240.118 port 80 after 0 ms: Host is unreachable
/ # 

vagrant@master:~$ kubectl get node -o wide
NAME      STATUS   ROLES                  AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE           KERNEL-VERSION      CONTAINER-RUNTIME
master    Ready    control-plane,master   55m   v1.23.3   192.168.56.80   &lt;none&gt;        Ubuntu 22.04 LTS   5.15.0-25-generic   docker://20.10.12
worker1   Ready    &lt;none&gt;                 50m   v1.23.3   192.168.56.81   &lt;none&gt;        Ubuntu 22.04 LTS   5.15.0-25-generic   docker://20.10.12
worker2   Ready    &lt;none&gt;                 46m   v1.23.3   192.168.56.82   &lt;none&gt;        Ubuntu 22.04 LTS   5.15.0-25-generic   docker://20.10.12
vagrant@master:~$ 
</div><div><p>作者回复：看看是不是网络插件没有正常工作，另外就是一定要在集群里使用 IP 地址，外部是不能用的。</p></div><div><div>2022-08-13</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Matthew</span></div></div><div>1、使用 NodePort 后，使用 curl 命令，可以访问 worker 结点的 IP，但是无法访问 master 结点的 IP，不知道原因。
2、进入某个 pod 后，使用 “curl 域名” 的方式无法得到有效相应，不知道原因。</div><div><p>作者回复: 
1. 看看是不是 master 有污点，不能运行业务。

2. 看看 coredns 是否正常，用 kubectl logs 看它 pod 的日志。</p></div><div><div>2022-08-12</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>peter</span></div></div><div>再次提交问题：
Q1：图中哪个是 service？
“clusterIP” 吗？还是 “kube-proxy”？

Q2：在单节点上创建 service，不能负载均衡。
用 curl 之前，按照文中步骤操作，一切都顺利。有两个 POD，用 curl 后，只有一个 POD 返回，不能负载均衡。为什么？</div><div><p>作者回复: 
1. 这个是 Service 的工作原理，Service 本身只是规则，由 kube-proxy 实现。

2.Service 的工作与节点无关，可以再试试看看，把对象都删除重新创建。</p></div><div><div>2022-08-08</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2c/82/ec/99b480e8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>hiDaLao</span></div></div><div>测试域名方式访问时，pod 里面 curl ngx-svc、ngx-svc.default、ngx-svc.default.svc 都可以成功，但 ngx-svc.default.svc.cluster 以及 ngx-svc.default.svc.cluster.local，提示'curl: (6) Could not resolve host: ngx-svc.default.svc.cluster'，是哪里配置错了吗</div><div><p>作者回复: ngx-svc.default.svc.cluster 这个不行，必须是 ngx-svc.default.svc.cluster.local。</p></div><div><div>2022-08-07</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1v"><outline class="toc-level-h1" data-reactid=".1v.0" style="width: 175px;"><active data-reactid=".1v.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1v.0.1"><span data-reactid=".1v.0.1.0"> 20｜Service：微服务架构的应对之道</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.1" style="width: 165px;"><active data-reactid=".1v.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1v.1.1"><span data-reactid=".1v.1.1.0">为什么要有 Service</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.2" style="width: 165px;"><active data-reactid=".1v.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1v.2.1"><span data-reactid=".1v.2.1.0">如何使用 YAML 描述 Service</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.3" style="width: 165px;"><active data-reactid=".1v.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1v.3.1"><span data-reactid=".1v.3.1.0">如何在 Kubernetes 里使用 Service</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.4" style="width: 165px;"><active data-reactid=".1v.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1v.4.1"><span data-reactid=".1v.4.1.0">如何以域名的方式使用 Service</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.5" style="width: 165px;"><active data-reactid=".1v.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1v.5.1"><span data-reactid=".1v.5.1.0">如何让 Service 对外暴露服务</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.6" style="width: 165px;"><active data-reactid=".1v.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1v.6.1"><span data-reactid=".1v.6.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.7" style="width: 165px;"><active data-reactid=".1v.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1v.7.1"><span data-reactid=".1v.7.1.0">课下作业</span></a></outline><outline class="toc-level-h2" data-reactid=".1v.8" style="width: 165px;"><active data-reactid=".1v.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1v.8.1"><span data-reactid=".1v.8.1.0">精选留言 (23)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/536829" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>