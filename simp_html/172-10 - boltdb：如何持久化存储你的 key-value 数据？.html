
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 10 | boltdb：如何持久化存储你的 key-value 数据？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>10 | boltdb：如何持久化存储你的 key-value 数据？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">我希望你能够用最低的学习成本，掌握 etcd 核心原理和最佳实践，让 etcd 为你所用。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">10 | boltdb：如何持久化存储你的 key-value 数据？</h1><div><span>唐聪</span> <span> 2021-02-10</span></div><div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f0/9c/f0a7ae46679ec4df5yy2690de472c29c.jpg" style="width: auto;"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：王超凡</span><span>大小：16.40M</span><span> 时长：17:57</span></div></div><audio title="10 | boltdb：如何持久化存储你的key-value数据？" src="https://res001.geekbang.org/media/audio/99/45/9944d13c96935f676febe39aef0b9045/ld/ld.m3u8" __idm_id__="925707"></audio></div><div><div><div><div data-slate-editor="true" data-key="3154" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="3155"><span data-slate-object="text" data-key="3156"><span data-slate-leaf="true" data-offset-key="3156:0" data-first-offset="true"><span data-slate-string="true">你好，我是唐聪。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3157"><span data-slate-object="text" data-key="3158"><span data-slate-leaf="true" data-offset-key="3158:0" data-first-offset="true"><span data-slate-string="true">在前面的课程里，我和你多次提到过 etcd 数据存储在 boltdb。那么 boltdb 是如何组织你的 key-value 数据的呢？当你读写一个 key 时，boltdb 是如何工作的？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3159"><span data-slate-object="text" data-key="3160"><span data-slate-leaf="true" data-offset-key="3160:0" data-first-offset="true"><span data-slate-string="true">今天我将通过一个写请求在 boltdb 中执行的简要流程，分析其背后的 boltdb 的磁盘文件布局，帮助你了解 page、node、bucket 等核心数据结构的原理与作用，搞懂 boltdb 基于 B+ tree、各类 page 实现查找、更新、事务提交的原理，让你明白 etcd 为什么适合读多写少的场景。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3161" id="sr-toc-1"><span data-slate-object="text" data-key="3162"><span data-slate-leaf="true" data-offset-key="3162:0" data-first-offset="true"><span data-slate-string="true">boltdb 磁盘布局</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3163"><span data-slate-object="text" data-key="3164"><span data-slate-leaf="true" data-offset-key="3164:0" data-first-offset="true"><span data-slate-string="true">在介绍一个 put 写请求在 boltdb 中执行原理前，我先给你从整体上介绍下平时你所看到的 etcd db 文件的磁盘布局，让你了解下 db 文件的物理存储结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3165"><span data-slate-object="text" data-key="3166"><span data-slate-leaf="true" data-offset-key="3166:0" data-first-offset="true"><span data-slate-string="true">boltdb 文件指的是你 etcd 数据目录下的 member/snap/db 的文件， etcd 的 key-value、lease、meta、member、cluster、auth 等所有数据存储在其中。</span></span><span data-slate-leaf="true" data-offset-key="3166:1"><span data-slate-object="annotation" data-annotation-key="gkann_d6a5fba4" data-attr-id="23769" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">etcd 启动的时候，会通过 mmap 机制将 db 文件映射到内存，后续可从内存中快速读取文件中的数据。</span></span></span><span data-slate-leaf="true" data-offset-key="3166:2"><span data-slate-string="true">写请求通过 fwrite 和 fdatasync 来写入、持久化数据到磁盘。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3167"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a6/41/a6086a069a2cf52b38d60716780f2e41.png?wh=1920*1131"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3168"><span data-slate-object="text" data-key="3169"><span data-slate-leaf="true" data-offset-key="3169:0" data-first-offset="true"><span data-slate-string="true">上图是我给你画的 db 文件磁盘布局，从图中的左边部分你可以看到，文件的内容由若干个 page 组成，一般情况下 page size 为 4KB。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3170"><span data-slate-object="text" data-key="3171"><span data-slate-leaf="true" data-offset-key="3171:0" data-first-offset="true"><span data-slate-string="true">page 按照功能可分为元数据页 (meta page)、B+ tree 索引节点页 (branch page)、B+ tree 叶子节点页 (leaf page)、空闲页管理页 (freelist page)、空闲页 (free page)。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3172"><span data-slate-object="text" data-key="3173"><span data-slate-leaf="true" data-offset-key="3173:0" data-first-offset="true"><span data-slate-string="true">文件最开头的两个 page 是固定的 db 元数据 meta page，空闲页管理页记录了 db 中哪些页是空闲、可使用的。索引节点页保存了 B+ tree 的内部节点，如图中的右边部分所示，它们记录了 key 值，叶子节点页记录了 B+ tree 中的 key-value 和 bucket 数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3174"><span data-slate-object="text" data-key="3175"><span data-slate-leaf="true" data-offset-key="3175:0" data-first-offset="true"><span data-slate-string="true">boltdb 逻辑上通过 B+ tree 来管理 branch/leaf page， 实现快速查找、写入 key-value 数据。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3176" id="sr-toc-2"><span data-slate-object="text" data-key="3177"><span data-slate-leaf="true" data-offset-key="3177:0" data-first-offset="true"><span data-slate-string="true">boltdb API</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3178"><span data-slate-object="text" data-key="3179"><span data-slate-leaf="true" data-offset-key="3179:0" data-first-offset="true"><span data-slate-string="true">了解完 boltdb 的磁盘布局后，那么如果要在 etcd 中执行一个 put 请求，boltdb 中是如何执行的呢？ boltdb 作为一个库，提供了什么 API 给 client 访问写入数据？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3180"><span data-slate-object="text" data-key="3181"><span data-slate-leaf="true" data-offset-key="3181:0" data-first-offset="true"><span data-slate-string="true">boltdb 提供了非常简单的 API 给上层业务使用，当我们执行一个 put hello 为 world 命令时，boltdb 实际写入的 key 是版本号，value 为 mvccpb.KeyValue 结构体。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3182"><span data-slate-object="text" data-key="3183"><span data-slate-leaf="true" data-offset-key="3183:0" data-first-offset="true"><span data-slate-string="true">这里我们简化下，假设往 key bucket 写入一个 key 为 r94，value 为 world 的字符串，其核心代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="3184"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3185"><span data-slate-object="text" data-key="3186"><span data-slate-leaf="true" data-offset-key="3186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 打开 boltdb 文件，获取 db 对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3187"><span data-slate-object="text" data-key="3188"><span data-slate-leaf="true" data-offset-key="3188:0" data-first-offset="true"><span data-slate-string="true">db,err := bolt.Open(</span></span></span><span data-slate-object="text" data-key="3189"><span data-slate-leaf="true" data-offset-key="3189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"db"</span></span></span></span><span data-slate-object="text" data-key="3190"><span data-slate-leaf="true" data-offset-key="3190:0" data-first-offset="true"><span data-slate-string="true">， </span></span></span><span data-slate-object="text" data-key="3191"><span data-slate-leaf="true" data-offset-key="3191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0600</span></span></span></span><span data-slate-object="text" data-key="3192"><span data-slate-leaf="true" data-offset-key="3192:0" data-first-offset="true"><span data-slate-string="true">， </span></span></span><span data-slate-object="text" data-key="3193"><span data-slate-leaf="true" data-offset-key="3193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3194"><span data-slate-leaf="true" data-offset-key="3194:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3195"><span data-slate-object="text" data-key="3196"><span data-slate-leaf="true" data-offset-key="3196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3197"><span data-slate-leaf="true" data-offset-key="3197:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="3198"><span data-slate-leaf="true" data-offset-key="3198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3199"><span data-slate-leaf="true" data-offset-key="3199:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3200"><span data-slate-object="text" data-key="3201"><span data-slate-leaf="true" data-offset-key="3201:0" data-first-offset="true"><span data-slate-string="true">   log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3202"><span data-slate-object="text" data-key="3203"><span data-slate-leaf="true" data-offset-key="3203:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3204"><span data-slate-object="text" data-key="3205"><span data-slate-leaf="true" data-offset-key="3205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="3206"><span data-slate-leaf="true" data-offset-key="3206:0" data-first-offset="true"><span data-slate-string="true"> db.Close()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3207"><span data-slate-object="text" data-key="3208"><span data-slate-leaf="true" data-offset-key="3208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 参数 true 表示创建一个写事务，false 读事务</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3209"><span data-slate-object="text" data-key="3210"><span data-slate-leaf="true" data-offset-key="3210:0" data-first-offset="true"><span data-slate-string="true">tx,err := db.Begin(</span></span></span><span data-slate-object="text" data-key="3211"><span data-slate-leaf="true" data-offset-key="3211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="3212"><span data-slate-leaf="true" data-offset-key="3212:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3213"><span data-slate-object="text" data-key="3214"><span data-slate-leaf="true" data-offset-key="3214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3215"><span data-slate-leaf="true" data-offset-key="3215:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="3216"><span data-slate-leaf="true" data-offset-key="3216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3217"><span data-slate-leaf="true" data-offset-key="3217:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3218"><span data-slate-object="text" data-key="3219"><span data-slate-leaf="true" data-offset-key="3219:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3220"><span data-slate-leaf="true" data-offset-key="3220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3221"><span data-slate-leaf="true" data-offset-key="3221:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3222"><span data-slate-object="text" data-key="3223"><span data-slate-leaf="true" data-offset-key="3223:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3224"><span data-slate-object="text" data-key="3225"><span data-slate-leaf="true" data-offset-key="3225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="3226"><span data-slate-leaf="true" data-offset-key="3226:0" data-first-offset="true"><span data-slate-string="true"> tx.Rollback()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3227"><span data-slate-object="text" data-key="3228"><span data-slate-leaf="true" data-offset-key="3228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用事务对象创建 key bucket</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3229"><span data-slate-object="text" data-key="3230"><span data-slate-leaf="true" data-offset-key="3230:0" data-first-offset="true"><span data-slate-string="true">b,err := tx.CreatebucketIfNotExists([]</span></span></span><span data-slate-object="text" data-key="3231"><span data-slate-leaf="true" data-offset-key="3231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="3232"><span data-slate-leaf="true" data-offset-key="3232:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3233"><span data-slate-leaf="true" data-offset-key="3233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"key"</span></span></span></span><span data-slate-object="text" data-key="3234"><span data-slate-leaf="true" data-offset-key="3234:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3235"><span data-slate-object="text" data-key="3236"><span data-slate-leaf="true" data-offset-key="3236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3237"><span data-slate-leaf="true" data-offset-key="3237:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="3238"><span data-slate-leaf="true" data-offset-key="3238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3239"><span data-slate-leaf="true" data-offset-key="3239:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3240"><span data-slate-object="text" data-key="3241"><span data-slate-leaf="true" data-offset-key="3241:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3242"><span data-slate-leaf="true" data-offset-key="3242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3243"><span data-slate-leaf="true" data-offset-key="3243:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3244"><span data-slate-object="text" data-key="3245"><span data-slate-leaf="true" data-offset-key="3245:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3246"><span data-slate-object="text" data-key="3247"><span data-slate-leaf="true" data-offset-key="3247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用 bucket 对象更新一个 key</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3248"><span data-slate-object="text" data-key="3249"><span data-slate-leaf="true" data-offset-key="3249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3250"><span data-slate-leaf="true" data-offset-key="3250:0" data-first-offset="true"><span data-slate-string="true"> err := b.Put([]</span></span></span><span data-slate-object="text" data-key="3251"><span data-slate-leaf="true" data-offset-key="3251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="3252"><span data-slate-leaf="true" data-offset-key="3252:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3253"><span data-slate-leaf="true" data-offset-key="3253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"r94"</span></span></span></span><span data-slate-object="text" data-key="3254"><span data-slate-leaf="true" data-offset-key="3254:0" data-first-offset="true"><span data-slate-string="true">),[]</span></span></span><span data-slate-object="text" data-key="3255"><span data-slate-leaf="true" data-offset-key="3255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="3256"><span data-slate-leaf="true" data-offset-key="3256:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3257"><span data-slate-leaf="true" data-offset-key="3257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"world"</span></span></span></span><span data-slate-object="text" data-key="3258"><span data-slate-leaf="true" data-offset-key="3258:0" data-first-offset="true"><span data-slate-string="true">)); err != </span></span></span><span data-slate-object="text" data-key="3259"><span data-slate-leaf="true" data-offset-key="3259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3260"><span data-slate-leaf="true" data-offset-key="3260:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3261"><span data-slate-object="text" data-key="3262"><span data-slate-leaf="true" data-offset-key="3262:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3263"><span data-slate-leaf="true" data-offset-key="3263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3264"><span data-slate-leaf="true" data-offset-key="3264:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3265"><span data-slate-object="text" data-key="3266"><span data-slate-leaf="true" data-offset-key="3266:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3267"><span data-slate-object="text" data-key="3268"><span data-slate-leaf="true" data-offset-key="3268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 提交事务</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3269"><span data-slate-object="text" data-key="3270"><span data-slate-leaf="true" data-offset-key="3270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3271"><span data-slate-leaf="true" data-offset-key="3271:0" data-first-offset="true"><span data-slate-string="true"> err := tx.Commit(); err != </span></span></span><span data-slate-object="text" data-key="3272"><span data-slate-leaf="true" data-offset-key="3272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3273"><span data-slate-leaf="true" data-offset-key="3273:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3274"><span data-slate-object="text" data-key="3275"><span data-slate-leaf="true" data-offset-key="3275:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3276"><span data-slate-leaf="true" data-offset-key="3276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3277"><span data-slate-leaf="true" data-offset-key="3277:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3278"><span data-slate-object="text" data-key="3279"><span data-slate-leaf="true" data-offset-key="3279:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3280"><span data-slate-object="text" data-key="3281"><span data-slate-leaf="true" data-offset-key="3281:0" data-first-offset="true"><span data-slate-string="true">如上所示，通过 boltdb 的 Open API，我们获取到 boltdb 的核心对象 db 实例后，然后通过 db 的 Begin API 开启写事务，获得写事务对象 tx。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3282"><span data-slate-object="text" data-key="3283"><span data-slate-leaf="true" data-offset-key="3283:0" data-first-offset="true"><span data-slate-string="true">通过写事务对象 tx， 你可以创建 bucket。这里我们创建了一个名为 key 的 bucket（如果不存在），并使用 bucket API 往其中更新了一个 key 为 r94，value 为 world 的数据。最后我们使用写事务的 Commit 接口提交整个事务，完成 bucket 创建和 key-value 数据写入。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3284"><span data-slate-object="text" data-key="3285"><span data-slate-leaf="true" data-offset-key="3285:0" data-first-offset="true"><span data-slate-string="true">看起来是不是非常简单，神秘的 boltdb，并未有我们想象的那么难。然而其 API 简单的背后却是 boltdb 的一系列巧妙的设计和实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3286"><span data-slate-object="text" data-key="3287"><span data-slate-leaf="true" data-offset-key="3287:0" data-first-offset="true"><span data-slate-string="true">一个 key-value 数据如何知道该存储在 db 在哪个 page？如何快速找到你的 key-value 数据？事务提交的原理又是怎样的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3288"><span data-slate-object="text" data-key="3289"><span data-slate-leaf="true" data-offset-key="3289:0" data-first-offset="true"><span data-slate-string="true">接下来我就和你浅析 boltdb 背后的奥秘。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3290" id="sr-toc-3"><span data-slate-object="text" data-key="3291"><span data-slate-leaf="true" data-offset-key="3291:0" data-first-offset="true"><span data-slate-string="true">核心数据结构介绍</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3292"><span data-slate-object="text" data-key="3293"><span data-slate-leaf="true" data-offset-key="3293:0" data-first-offset="true"><span data-slate-string="true">上面我们介绍 boltdb 的磁盘布局时提到，boltdb 整个文件由一个个 page 组成。最开头的两个 page 描述 db 元数据信息，而它正是在 client 调用 boltdb Open API 时被填充的。那么描述磁盘页面的 page 数据结构是怎样的呢？元数据页又含有哪些核心数据结构？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3294"><span data-slate-object="text" data-key="3295"><span data-slate-leaf="true" data-offset-key="3295:0" data-first-offset="true"><span data-slate-string="true">boltdb 本身自带了一个工具 bbolt，它可以按页打印出 db 文件的十六进制的内容，下面我们就使用此工具来揭开 db 文件的神秘面纱。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3296"><span data-slate-object="text" data-key="3297"><span data-slate-leaf="true" data-offset-key="3297:0" data-first-offset="true"><span data-slate-string="true">下图左边的十六进制是执行如下 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="3298"><span data-slate-object="text" data-key="3299"><span data-slate-leaf="true" data-offset-key="3299:0" data-first-offset="true"><span data-slate-string="true">bbolt dump</span></span></span></a><span data-slate-object="text" data-key="3300"><span data-slate-leaf="true" data-offset-key="3300:0" data-first-offset="true"><span data-slate-string="true"> 命令，所打印的 boltdb 第 0 页的数据，图的右边是对应的 page 磁盘页结构和 meta page 的数据结构。</span></span></span></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="3301"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3302"><span data-slate-object="text" data-key="3303"><span data-slate-leaf="true" data-offset-key="3303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$ </span></span></span></span><span data-slate-object="text" data-key="3304"><span data-slate-leaf="true" data-offset-key="3304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">./bbolt dump ./infra1.etcd/member/snap/db 0</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="3305"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/16/94a4b5yydab7yy9a3f340632274f9616.png?wh=1920*1242"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3306"><span data-slate-object="text" data-key="3307"><span data-slate-leaf="true" data-offset-key="3307:0" data-first-offset="true"><span data-slate-string="true">一看上图中的十六进制数据，你可能很懵，没关系，在你了解 page 磁盘页结构、meta page 数据结构后，你就能读懂其含义了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3308" id="sr-toc-4"><span data-slate-object="text" data-key="3309"><span data-slate-leaf="true" data-offset-key="3309:0" data-first-offset="true"><span data-slate-string="true">page 磁盘页结构</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3310"><span data-slate-object="text" data-key="3311"><span data-slate-leaf="true" data-offset-key="3311:0" data-first-offset="true"><span data-slate-string="true">我们先了解下 page 磁盘页结构，如上图所示，它由页 ID (id)、页类型 (flags)、数量 (count)、溢出页数量 (overflow)、页面数据起始位置 (ptr) 字段组成。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3312"><span data-slate-object="text" data-key="3313"><span data-slate-leaf="true" data-offset-key="3313:0" data-first-offset="true"><span data-slate-string="true">页类型目前有如下四种：0x01 表示 branch page，0x02 表示 leaf page，0x04 表示 meta page，0x10 表示 freelist page。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3314"><span data-slate-object="text" data-key="3315"><span data-slate-leaf="true" data-offset-key="3315:0" data-first-offset="true"><span data-slate-string="true">数量字段仅在页类型为 leaf 和 branch 时生效，溢出页数量是指当前页面数据存放不下，需要向后再申请 overflow 个连续页面使用，页面数据起始位置指向 page 的载体数据，比如 meta page、branch/leaf 等 page 的内容。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3316" id="sr-toc-5"><span data-slate-object="text" data-key="3317"><span data-slate-leaf="true" data-offset-key="3317:0" data-first-offset="true"><span data-slate-string="true">meta page 数据结构</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3318"><span data-slate-object="text" data-key="3319"><span data-slate-leaf="true" data-offset-key="3319:0" data-first-offset="true"><span data-slate-string="true">第 0、1 页我们知道它是固定存储 db 元数据的页 (meta page)，那么 meta page 它为了管理整个 boltdb 含有哪些信息呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3320"><span data-slate-object="text" data-key="3321"><span data-slate-leaf="true" data-offset-key="3321:0" data-first-offset="true"><span data-slate-string="true">如上图中的 meta page 数据结构所示，你可以看到它由 boltdb 的文件标识 (magic)、版本号 (version)、页大小 (pagesize)、boltdb 的根 bucket 信息 (root bucket)、freelist 页面 ID (freelist)、总的页面数量 (pgid)、上一次写事务 ID (txid)、校验码 (checksum) 组成。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3322" id="sr-toc-6"><span data-slate-object="text" data-key="3323"><span data-slate-leaf="true" data-offset-key="3323:0" data-first-offset="true"><span data-slate-string="true">meta page 十六进制分析</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3324"><span data-slate-object="text" data-key="3325"><span data-slate-leaf="true" data-offset-key="3325:0" data-first-offset="true"><span data-slate-string="true">了解完 page 磁盘页结构和 meta page 数据结构后，我再结合图左边的十六进数据和你简要分析下其含义。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3326"><span data-slate-object="text" data-key="3327"><span data-slate-leaf="true" data-offset-key="3327:0" data-first-offset="true"><span data-slate-string="true">上图中十六进制输出的是 db 文件的 page 0 页结构，左边第一列表示此行十六进制内容对应的文件起始地址，每行 16 个字节。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3328"><span data-slate-object="text" data-key="3329"><span data-slate-leaf="true" data-offset-key="3329:0" data-first-offset="true"><span data-slate-string="true">结合 page 磁盘页和 meta page 数据结构我们可知，第一行前 8 个字节描述 pgid (忽略第一列) 是 0。接下来 2 个字节描述的页类型， 其值为 0x04 表示 meta page， 说明此页的数据存储的是 meta page 内容，因此 ptr 开始的数据存储的是 meta page 内容。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3330"><span data-slate-object="text" data-key="3331"><span data-slate-leaf="true" data-offset-key="3331:0" data-first-offset="true"><span data-slate-string="true">正如你下图中所看到的，第二行首先含有一个 4 字节的 magic number (0xED0CDAED)，通过它来识别当前文件是否 boltdb，接下来是两个字节描述 boltdb 的版本号 0x2， 然后是四个字节的 page size 大小，0x1000 表示 4096 个字节，四个字节的 flags 为 0。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3332"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/09/c0/09d8a9174b4539718878fcfb9da84cc0.png?wh=411*161"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3333"><span data-slate-object="text" data-key="3334"><span data-slate-leaf="true" data-offset-key="3334:0" data-first-offset="true"><span data-slate-string="true">第三行对应的就是 meta page 的 root bucket 结构（16 个字节），它描述了 boltdb 的 root bucket 信息，比如一个 db 中有哪些 bucket， bucket 里面的数据存储在哪里。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3335"><span data-slate-object="text" data-key="3336"><span data-slate-leaf="true" data-offset-key="3336:0" data-first-offset="true"><span data-slate-string="true">第四行中前面的 8 个字节，0x3 表示 freelist 页面 ID，此页面记录了 db 当前哪些页面是空闲的。后面 8 个字节，0x6 表示当前 db 总的页面数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3337"><span data-slate-object="text" data-key="3338"><span data-slate-leaf="true" data-offset-key="3338:0" data-first-offset="true"><span data-slate-string="true">第五行前面的 8 个字节，0x1a 表示上一次的写事务 ID，后面的 8 个字节表示校验码，用于检测文件是否损坏。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3339"><span data-slate-object="text" data-key="3340"><span data-slate-leaf="true" data-offset-key="3340:0" data-first-offset="true"><span data-slate-string="true">了解完 db 元数据页面原理后，那么 boltdb 是如何根据元数据页面信息快速找到你的 bucket 和 key-value 数据呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3341"><span data-slate-object="text" data-key="3342"><span data-slate-leaf="true" data-offset-key="3342:0" data-first-offset="true"><span data-slate-string="true">这就涉及到了元数据页面中的 root bucket，它是个至关重要的数据结构。下面我们看看它是如何管理一系列 bucket、帮助我们查找、写入 key-value 数据到 boltdb 中。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3343" id="sr-toc-7"><span data-slate-object="text" data-key="3344"><span data-slate-leaf="true" data-offset-key="3344:0" data-first-offset="true"><span data-slate-string="true">bucket 数据结构</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3345"><span data-slate-object="text" data-key="3346"><span data-slate-leaf="true" data-offset-key="3346:0" data-first-offset="true"><span data-slate-string="true">如下命令所示，你可以使用 bbolt buckets 命令，输出一个 db 文件的 bucket 列表。执行完此命令后，我们可以看到之前介绍过的 auth/lease/meta 等熟悉的 bucket，它们都是 etcd 默认创建的。那么 boltdb 是如何存储、管理 bucket 的呢？</span></span></span></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="3347"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3348"><span data-slate-object="text" data-key="3349"><span data-slate-leaf="true" data-offset-key="3349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$ </span></span></span></span><span data-slate-object="text" data-key="3350"><span data-slate-leaf="true" data-offset-key="3350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">./bbolt buckets  ./infra1.etcd/member/snap/db</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3351"><span data-slate-object="text" data-key="3352"><span data-slate-leaf="true" data-offset-key="3352:0" data-first-offset="true"><span data-slate-string="true">alarm</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3353"><span data-slate-object="text" data-key="3354"><span data-slate-leaf="true" data-offset-key="3354:0" data-first-offset="true"><span data-slate-string="true">auth</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3355"><span data-slate-object="text" data-key="3356"><span data-slate-leaf="true" data-offset-key="3356:0" data-first-offset="true"><span data-slate-string="true">authRoles</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3357"><span data-slate-object="text" data-key="3358"><span data-slate-leaf="true" data-offset-key="3358:0" data-first-offset="true"><span data-slate-string="true">authUsers</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3359"><span data-slate-object="text" data-key="3360"><span data-slate-leaf="true" data-offset-key="3360:0" data-first-offset="true"><span data-slate-string="true">cluster</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3361"><span data-slate-object="text" data-key="3362"><span data-slate-leaf="true" data-offset-key="3362:0" data-first-offset="true"><span data-slate-string="true">key</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3363"><span data-slate-object="text" data-key="3364"><span data-slate-leaf="true" data-offset-key="3364:0" data-first-offset="true"><span data-slate-string="true">lease</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3365"><span data-slate-object="text" data-key="3366"><span data-slate-leaf="true" data-offset-key="3366:0" data-first-offset="true"><span data-slate-string="true">members</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3367"><span data-slate-object="text" data-key="3368"><span data-slate-leaf="true" data-offset-key="3368:0" data-first-offset="true"><span data-slate-string="true">members_removed</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3369"><span data-slate-object="text" data-key="3370"><span data-slate-leaf="true" data-offset-key="3370:0" data-first-offset="true"><span data-slate-string="true">meta</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3371"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3372"><span data-slate-object="text" data-key="3373"><span data-slate-leaf="true" data-offset-key="3373:0" data-first-offset="true"><span data-slate-string="true">在上面我们提到过 meta page 中的，有一个名为 root、类型 bucket 的重要数据结构，如下所示，bucket 由 root 和 sequence 两个字段组成，root 表示该 bucket 根节点的 page id。注意 meta page 中的 bucket.root 字段，存储的是 db 的 root bucket 页面信息，你所看到的 key/lease/auth 等 bucket 都是 root bucket 的子 bucket。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="3374"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3375"><span data-slate-object="text" data-key="3376"><span data-slate-leaf="true" data-offset-key="3376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="3377"><span data-slate-leaf="true" data-offset-key="3377:0" data-first-offset="true"><span data-slate-string="true"> bucket </span></span></span><span data-slate-object="text" data-key="3378"><span data-slate-leaf="true" data-offset-key="3378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="3379"><span data-slate-leaf="true" data-offset-key="3379:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3380"><span data-slate-object="text" data-key="3381"><span data-slate-leaf="true" data-offset-key="3381:0" data-first-offset="true"><span data-slate-string="true">   root     pgid   </span></span></span><span data-slate-object="text" data-key="3382"><span data-slate-leaf="true" data-offset-key="3382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// page id of the bucket's root-level page</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3383"><span data-slate-object="text" data-key="3384"><span data-slate-leaf="true" data-offset-key="3384:0" data-first-offset="true"><span data-slate-string="true">   sequence </span></span></span><span data-slate-object="text" data-key="3385"><span data-slate-leaf="true" data-offset-key="3385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint64</span></span></span></span><span data-slate-object="text" data-key="3386"><span data-slate-leaf="true" data-offset-key="3386:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3387"><span data-slate-leaf="true" data-offset-key="3387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// monotonically incrementing, used by NextSequence()</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3388"><span data-slate-object="text" data-key="3389"><span data-slate-leaf="true" data-offset-key="3389:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="3390"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/14/9b/14f9c6f5061f44ea3c1d8de4f47a5b9b.png?wh=1920*719"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3391"><span data-slate-object="text" data-key="3392"><span data-slate-leaf="true" data-offset-key="3392:0" data-first-offset="true"><span data-slate-string="true">上面 meta page 十六进制图中，第三行的 16 个字节就是描述的 root bucket 信息。root bucket 指向的 page id 为 4，page id 为 4 的页面是什么类型呢？ 我们可以通过如下 bbolt pages 命令看看各个 page 类型和元素数量，从下图结果可知，4 号页面为 leaf page。</span></span></span></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="3393"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3394"><span data-slate-object="text" data-key="3395"><span data-slate-leaf="true" data-offset-key="3395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$ </span></span></span></span><span data-slate-object="text" data-key="3396"><span data-slate-leaf="true" data-offset-key="3396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">./bbolt pages  ./infra1.etcd/member/snap/db</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3397"><span data-slate-object="text" data-key="3398"><span data-slate-leaf="true" data-offset-key="3398:0" data-first-offset="true"><span data-slate-string="true">ID       TYPE       ITEMS  OVRFLW</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3399"><span data-slate-object="text" data-key="3400"><span data-slate-leaf="true" data-offset-key="3400:0" data-first-offset="true"><span data-slate-string="true">======== ========== ====== ======</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3401"><span data-slate-object="text" data-key="3402"><span data-slate-leaf="true" data-offset-key="3402:0" data-first-offset="true"><span data-slate-string="true">0        meta       0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3403"><span data-slate-object="text" data-key="3404"><span data-slate-leaf="true" data-offset-key="3404:0" data-first-offset="true"><span data-slate-string="true">1        meta       0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3405"><span data-slate-object="text" data-key="3406"><span data-slate-leaf="true" data-offset-key="3406:0" data-first-offset="true"><span data-slate-string="true">2        free</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3407"><span data-slate-object="text" data-key="3408"><span data-slate-leaf="true" data-offset-key="3408:0" data-first-offset="true"><span data-slate-string="true">3        freelist   2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3409"><span data-slate-object="text" data-key="3410"><span data-slate-leaf="true" data-offset-key="3410:0" data-first-offset="true"><span data-slate-string="true">4        leaf       10</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3411"><span data-slate-object="text" data-key="3412"><span data-slate-leaf="true" data-offset-key="3412:0" data-first-offset="true"><span data-slate-string="true">5        free</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3413"><span data-slate-object="text" data-key="3414"><span data-slate-leaf="true" data-offset-key="3414:0" data-first-offset="true"><span data-slate-string="true">通过上面的分析可知，当 bucket 比较少时，我们子 bucket 数据可直接从 meta page 里指向的 leaf page 中找到。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3415" id="sr-toc-8"><span data-slate-object="text" data-key="3416"><span data-slate-leaf="true" data-offset-key="3416:0" data-first-offset="true"><span data-slate-string="true">leaf page</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3417"><span data-slate-object="text" data-key="3418"><span data-slate-leaf="true" data-offset-key="3418:0" data-first-offset="true"><span data-slate-string="true">meta page 的 root bucket 直接指向的是 page id 为 4 的 leaf page， page flag 为 0x02， leaf page 它的磁盘布局如下图所示，前半部分是 leafPageElement 数组，后半部分是 key-value 数组。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3419"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/0e/e8/0e70f52dc9752e2yy19f74a044530ee8.png?wh=1920*1013"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3420"><span data-slate-object="text" data-key="3421"><span data-slate-leaf="true" data-offset-key="3421:0" data-first-offset="true"><span data-slate-string="true">leafPageElement 包含 leaf page 的类型 flags， 通过它可以区分存储的是 bucket 名称还是 key-value 数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3422"><span data-slate-object="text" data-key="3423"><span data-slate-leaf="true" data-offset-key="3423:0" data-first-offset="true"><span data-slate-string="true">当 flag 为 bucketLeafFlag (0x01) 时，表示存储的是 bucket 数据，否则存储的是 key-value 数据，leafPageElement 它还含有 key-value 的读取偏移量，key-value 大小，根据偏移量和 key-value 大小，我们就可以方便地从 leaf page 中解析出所有 key-value 对。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3424"><span data-slate-object="text" data-key="3425"><span data-slate-leaf="true" data-offset-key="3425:0" data-first-offset="true"><span data-slate-string="true">当存储的是 bucket 数据的时候，key 是 bucket 名称，value 则是 bucket 结构信息。bucket 结构信息含有 root page 信息，通过 root page（基于 B+ tree 查找算法），你可以快速找到你存储在这个 bucket 下面的 key-value 数据所在页面。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3426"><span data-slate-object="text" data-key="3427"><span data-slate-leaf="true" data-offset-key="3427:0" data-first-offset="true"><span data-slate-string="true">从上面分析你可以看到，每个子 bucket 至少需要一个 page 来存储其下面的 key-value 数据，如果子 bucket 数据量很少，就会造成磁盘空间的浪费。实际上 boltdb 实现了 inline bucket，在满足一些条件限制的情况下，可以将小的子 bucket 内嵌在它的父亲叶子节点上，友好的支持了大量小 bucket。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3428"><span data-slate-object="text" data-key="3429"><span data-slate-leaf="true" data-offset-key="3429:0" data-first-offset="true"><span data-slate-string="true">为了方便大家快速理解核心原理，本节我们讨论的 bucket 是假设都是非 inline bucket。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3430"><span data-slate-object="text" data-key="3431"><span data-slate-leaf="true" data-offset-key="3431:0" data-first-offset="true"><span data-slate-string="true">那么 boltdb 是如何管理大量 bucket、key-value 的呢？</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3432" id="sr-toc-9"><span data-slate-object="text" data-key="3433"><span data-slate-leaf="true" data-offset-key="3433:0" data-first-offset="true"><span data-slate-string="true">branch page</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3434"><span data-slate-object="text" data-key="3435"><span data-slate-leaf="true" data-offset-key="3435:0" data-first-offset="true"><span data-slate-string="true">boltdb 使用了 B+ tree 来高效管理所有子 bucket 和 key-value 数据，因此它可以支持大量的 bucket 和 key-value，只不过 B+ tree 的根节点不再直接指向 leaf page，而是 branch page 索引节点页。branch page flags 为 0x01。它的磁盘布局如下图所示，前半部分是 branchPageElement 数组，后半部分是 key 数组。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3436"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/61/9d/61af0c7e7e5beb05be6130bda29da49d.png?wh=1920*951"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3437"><span data-slate-object="text" data-key="3438"><span data-slate-leaf="true" data-offset-key="3438:0" data-first-offset="true"><span data-slate-string="true">branchPageElement 包含 key 的读取偏移量、key 大小、子节点的 page id。根据偏移量和 key 大小，我们就可以方便地从 branch page 中解析出所有 key，然后二分搜索匹配 key，获取其子节点 page id，递归搜索，直至从 bucketLeafFlag 类型的 leaf page 中找到目的 bucket name。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3439"><span data-slate-object="text" data-key="3440"><span data-slate-leaf="true" data-offset-key="3440:0" data-first-offset="true"><span data-slate-string="true">注意，boltdb 在内存中使用了一个名为 node 的数据结构，来保存 page 反序列化的结果。下面我给出了一个 boltdb 读取 page 到 node 的代码片段，你可以直观感受下。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="3441"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3442"><span data-slate-object="text" data-key="3443"><span data-slate-leaf="true" data-offset-key="3443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="3444"><span data-slate-leaf="true" data-offset-key="3444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3445"><span data-slate-leaf="true" data-offset-key="3445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(n *node)</span></span></span></span></span><span data-slate-object="text" data-key="3446"><span data-slate-leaf="true" data-offset-key="3446:0" data-first-offset="true"><span data-slate-string="true"> read(p *page) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3447"><span data-slate-object="text" data-key="3448"><span data-slate-leaf="true" data-offset-key="3448:0" data-first-offset="true"><span data-slate-string="true">   n.pgid = p.id</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3449"><span data-slate-object="text" data-key="3450"><span data-slate-leaf="true" data-offset-key="3450:0" data-first-offset="true"><span data-slate-string="true">   n.isLeaf = ((p.flags &amp; leafPageFlag) != </span></span></span><span data-slate-object="text" data-key="3451"><span data-slate-leaf="true" data-offset-key="3451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3452"><span data-slate-leaf="true" data-offset-key="3452:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3453"><span data-slate-object="text" data-key="3454"><span data-slate-leaf="true" data-offset-key="3454:0" data-first-offset="true"><span data-slate-string="true">   n.inodes = </span></span></span><span data-slate-object="text" data-key="3455"><span data-slate-leaf="true" data-offset-key="3455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="3456"><span data-slate-leaf="true" data-offset-key="3456:0" data-first-offset="true"><span data-slate-string="true">(inodes, </span></span></span><span data-slate-object="text" data-key="3457"><span data-slate-leaf="true" data-offset-key="3457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="3458"><span data-slate-leaf="true" data-offset-key="3458:0" data-first-offset="true"><span data-slate-string="true">(p.count))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3459"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3460"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3461"><span data-slate-object="text" data-key="3462"><span data-slate-leaf="true" data-offset-key="3462:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3463"><span data-slate-leaf="true" data-offset-key="3463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="3464"><span data-slate-leaf="true" data-offset-key="3464:0" data-first-offset="true"><span data-slate-string="true"> i := </span></span></span><span data-slate-object="text" data-key="3465"><span data-slate-leaf="true" data-offset-key="3465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3466"><span data-slate-leaf="true" data-offset-key="3466:0" data-first-offset="true"><span data-slate-string="true">; i &lt; </span></span></span><span data-slate-object="text" data-key="3467"><span data-slate-leaf="true" data-offset-key="3467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="3468"><span data-slate-leaf="true" data-offset-key="3468:0" data-first-offset="true"><span data-slate-string="true">(p.count); i++ {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3469"><span data-slate-object="text" data-key="3470"><span data-slate-leaf="true" data-offset-key="3470:0" data-first-offset="true"><span data-slate-string="true">      inode := &amp;n.inodes[i]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3471"><span data-slate-object="text" data-key="3472"><span data-slate-leaf="true" data-offset-key="3472:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3473"><span data-slate-leaf="true" data-offset-key="3473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3474"><span data-slate-leaf="true" data-offset-key="3474:0" data-first-offset="true"><span data-slate-string="true"> n.isLeaf {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3475"><span data-slate-object="text" data-key="3476"><span data-slate-leaf="true" data-offset-key="3476:0" data-first-offset="true"><span data-slate-string="true">         elem := p.leafPageElement(</span></span></span><span data-slate-object="text" data-key="3477"><span data-slate-leaf="true" data-offset-key="3477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint16</span></span></span></span><span data-slate-object="text" data-key="3478"><span data-slate-leaf="true" data-offset-key="3478:0" data-first-offset="true"><span data-slate-string="true">(i))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3479"><span data-slate-object="text" data-key="3480"><span data-slate-leaf="true" data-offset-key="3480:0" data-first-offset="true"><span data-slate-string="true">         inode.flags = elem.flags</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3481"><span data-slate-object="text" data-key="3482"><span data-slate-leaf="true" data-offset-key="3482:0" data-first-offset="true"><span data-slate-string="true">         inode.key = elem.key()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3483"><span data-slate-object="text" data-key="3484"><span data-slate-leaf="true" data-offset-key="3484:0" data-first-offset="true"><span data-slate-string="true">         inode.value = elem.value()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3485"><span data-slate-object="text" data-key="3486"><span data-slate-leaf="true" data-offset-key="3486:0" data-first-offset="true"><span data-slate-string="true">      } </span></span></span><span data-slate-object="text" data-key="3487"><span data-slate-leaf="true" data-offset-key="3487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="3488"><span data-slate-leaf="true" data-offset-key="3488:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3489"><span data-slate-object="text" data-key="3490"><span data-slate-leaf="true" data-offset-key="3490:0" data-first-offset="true"><span data-slate-string="true">         elem := p.branchPageElement(</span></span></span><span data-slate-object="text" data-key="3491"><span data-slate-leaf="true" data-offset-key="3491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint16</span></span></span></span><span data-slate-object="text" data-key="3492"><span data-slate-leaf="true" data-offset-key="3492:0" data-first-offset="true"><span data-slate-string="true">(i))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3493"><span data-slate-object="text" data-key="3494"><span data-slate-leaf="true" data-offset-key="3494:0" data-first-offset="true"><span data-slate-string="true">         inode.pgid = elem.pgid</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3495"><span data-slate-object="text" data-key="3496"><span data-slate-leaf="true" data-offset-key="3496:0" data-first-offset="true"><span data-slate-string="true">         inode.key = elem.key()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3497"><span data-slate-object="text" data-key="3498"><span data-slate-leaf="true" data-offset-key="3498:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3499"><span data-slate-object="text" data-key="3500"><span data-slate-leaf="true" data-offset-key="3500:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3501"><span data-slate-object="text" data-key="3502"><span data-slate-leaf="true" data-offset-key="3502:0" data-first-offset="true"><span data-slate-string="true">从上面分析过程中你会发现，boltdb 存储 bucket 和 key-value 原理是类似的，将 page 划分成 branch page、leaf page，通过 B+ tree 来管理实现。boltdb 为了区分 leaf page 存储的数据类型是 bucket 还是 key-value，增加了标识字段（leafPageElement.flags），因此 key-value 的数据存储过程我就不再重复分析了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3503" id="sr-toc-10"><span data-slate-object="text" data-key="3504"><span data-slate-leaf="true" data-offset-key="3504:0" data-first-offset="true"><span data-slate-string="true">freelist</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3505"><span data-slate-object="text" data-key="3506"><span data-slate-leaf="true" data-offset-key="3506:0" data-first-offset="true"><span data-slate-string="true">介绍完 bucket、key-value 存储原理后，我们再看 meta page 中的另外一个核心字段 freelist，它的作用是什么呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3507"><span data-slate-object="text" data-key="3508"><span data-slate-leaf="true" data-offset-key="3508:0" data-first-offset="true"><span data-slate-string="true">我们知道 boltdb 将 db 划分成若干个 page，那么它是如何知道哪些 page 在使用中，哪些 page 未使用呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3509"><span data-slate-object="text" data-key="3510"><span data-slate-leaf="true" data-offset-key="3510:0" data-first-offset="true"><span data-slate-string="true">答案是 boltdb 通过 meta page 中的 freelist 来管理页面的分配，freelist page 中记录了哪些页是空闲的。当你在 boltdb 中删除大量数据的时候，其对应的 page 就会被释放，页 ID 存储到 freelist 所指向的空闲页中。当你写入数据的时候，就可直接从空闲页中申请页面使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3511"><span data-slate-object="text" data-key="3512"><span data-slate-leaf="true" data-offset-key="3512:0" data-first-offset="true"><span data-slate-string="true">下面 meta page 十六进制图中，第四行的前 8 个字节就是描述的 freelist 信息，page id 为 3。我们可以通过 bbolt page 命令查看 3 号 page 内容，如下所示，它记录了 2 和 5 为空闲页，与我们上面通过 bbolt pages 命令所看到的信息一致。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3513"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/4a/9a/4a4d05678cfb785618537d2f930e859a.png?wh=1910*708"></div></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="3514"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3515"><span data-slate-object="text" data-key="3516"><span data-slate-leaf="true" data-offset-key="3516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$ </span></span></span></span><span data-slate-object="text" data-key="3517"><span data-slate-leaf="true" data-offset-key="3517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">./bbolt page  ./infra1.etcd/member/snap/db 3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3518"><span data-slate-object="text" data-key="3519"><span data-slate-leaf="true" data-offset-key="3519:0" data-first-offset="true"><span data-slate-string="true">page ID:    3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3520"><span data-slate-object="text" data-key="3521"><span data-slate-leaf="true" data-offset-key="3521:0" data-first-offset="true"><span data-slate-string="true">page Type:  freelist</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3522"><span data-slate-object="text" data-key="3523"><span data-slate-leaf="true" data-offset-key="3523:0" data-first-offset="true"><span data-slate-string="true">Total Size: 4096 bytes</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3524"><span data-slate-object="text" data-key="3525"><span data-slate-leaf="true" data-offset-key="3525:0" data-first-offset="true"><span data-slate-string="true">Item Count: 2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3526"><span data-slate-object="text" data-key="3527"><span data-slate-leaf="true" data-offset-key="3527:0" data-first-offset="true"><span data-slate-string="true">Overflow: 0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3528"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3529"><span data-slate-object="text" data-key="3530"><span data-slate-leaf="true" data-offset-key="3530:0" data-first-offset="true"><span data-slate-string="true">2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3531"><span data-slate-object="text" data-key="3532"><span data-slate-leaf="true" data-offset-key="3532:0" data-first-offset="true"><span data-slate-string="true">5</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3533"><span data-slate-object="text" data-key="3534"><span data-slate-leaf="true" data-offset-key="3534:0" data-first-offset="true"><span data-slate-string="true">下图是 freelist page 存储结构，pageflags 为 0x10，表示 freelist 类型的页，ptr 指向空闲页 id 数组。注意在 boltdb 中支持通过多种数据结构（数组和 hashmap）来管理 free page，这里我介绍的是数组。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3535"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/57/bb/57c6dd899c4cb56198a6092855161ebb.png?wh=1920*1070"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3536" id="sr-toc-11"><span data-slate-object="text" data-key="3537"><span data-slate-leaf="true" data-offset-key="3537:0" data-first-offset="true"><span data-slate-string="true">Open 原理</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3538"><span data-slate-object="text" data-key="3539"><span data-slate-leaf="true" data-offset-key="3539:0" data-first-offset="true"><span data-slate-string="true">了解完核心数据结构后，我们就很容易搞懂 boltdb Open API 的原理了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3540"><span data-slate-object="text" data-key="3541"><span data-slate-leaf="true" data-offset-key="3541:0" data-first-offset="true"><span data-slate-string="true">首先它会打开 db 文件并对其增加文件锁，目的是防止其他进程也以读写模式打开它后，操作 meta 和 free page，导致 db 文件损坏。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3542"><span data-slate-object="text" data-key="3543"><span data-slate-leaf="true" data-offset-key="3543:0" data-first-offset="true"><span data-slate-string="true">其次 boltdb 通过 mmap 机制将 db 文件映射到内存中，并读取两个 meta page 到 db 对象实例中，然后校验 meta page 的 magic、version、checksum 是否有效，若两个 meta page 都无效，那么 db 文件就出现了严重损坏，导致异常退出。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3544" id="sr-toc-12"><span data-slate-object="text" data-key="3545"><span data-slate-leaf="true" data-offset-key="3545:0" data-first-offset="true"><span data-slate-string="true">Put 原理</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3546"><span data-slate-object="text" data-key="3547"><span data-slate-leaf="true" data-offset-key="3547:0" data-first-offset="true"><span data-slate-string="true">那么成功获取 db 对象实例后，通过 bucket API 创建一个 bucket、发起一个 Put 请求更新数据时，boltdb 是如何工作的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3548"><span data-slate-object="text" data-key="3549"><span data-slate-leaf="true" data-offset-key="3549:0" data-first-offset="true"><span data-slate-string="true">根据我们上面介绍的 bucket 的核心原理，它首先是根据 meta page 中记录 root bucket 的 root page，按照 B+ tree 的查找算法，从 root page 递归搜索到对应的叶子节点 page 面，返回 key 名称、leaf 类型。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3550"><span data-slate-object="text" data-key="3551"><span data-slate-leaf="true" data-offset-key="3551:0" data-first-offset="true"><span data-slate-string="true">如果 leaf 类型为 bucketLeafFlag，且 key 相等，那么说明已经创建过，不允许 bucket 重复创建，结束请求。否则往 B+ tree 中添加一个 flag 为 bucketLeafFlag 的 key，key 名称为 bucket name，value 为 bucket 的结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3552"><span data-slate-object="text" data-key="3553"><span data-slate-leaf="true" data-offset-key="3553:0" data-first-offset="true"><span data-slate-string="true">创建完 bucket 后，你就可以通过 bucket 的 Put API 发起一个 Put 请求更新数据。它的核心原理跟 bucket 类似，根据子 bucket 的 root page，从 root page 递归搜索此 key 到 leaf page，如果没有找到，则在返回的位置处插入新 key 和 value。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3554"><span data-slate-object="text" data-key="3555"><span data-slate-leaf="true" data-offset-key="3555:0" data-first-offset="true"><span data-slate-string="true">为了方便你理解 B+ tree 查找、插入一个 key 原理，我给你构造了的一个 max degree 为 5 的 B+ tree，下图是 key r94 的查找流程图。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3556"><span data-slate-object="text" data-key="3557"><span data-slate-leaf="true" data-offset-key="3557:0" data-first-offset="true"><span data-slate-string="true">那么如何确定这个 key 的插入位置呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3558"><span data-slate-object="text" data-key="3559"><span data-slate-leaf="true" data-offset-key="3559:0" data-first-offset="true"><span data-slate-string="true">首先从 boltdb 的 key bucket 的 root page 里，二分查找大于等于 r94 的 key 所在 page，最终找到 key r9 指向的 page（流程 1）。r9 指向的 page 是个 leaf page，B+ tree 需要确保叶子节点 key 的有序性，因此同样二分查找其插入位置，将 key r94 插入到相关位置（流程二）。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3560"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e6/6e/e6d2c12de362b55c7c36c45e5b65706e.png?wh=1920*711"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3561"><span data-slate-object="text" data-key="3562"><span data-slate-leaf="true" data-offset-key="3562:0" data-first-offset="true"><span data-slate-string="true">在核心数据结构介绍中，我和你提到 boltdb 在内存中通过 node 数据结构来存储 page 磁盘页内容，它记录了 key-value 数据、page id、parent 及 children 的 node、B+ tree 是否需要进行重平衡和分裂操作等信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3563"><span data-slate-object="text" data-key="3564"><span data-slate-leaf="true" data-offset-key="3564:0" data-first-offset="true"><span data-slate-string="true">因此，当我们执行完一个 put 请求时，它只是将值更新到 boltdb 的内存 node 数据结构里，并未持久化到磁盘中。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3565" id="sr-toc-13"><span data-slate-object="text" data-key="3566"><span data-slate-leaf="true" data-offset-key="3566:0" data-first-offset="true"><span data-slate-string="true">事务提交原理</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3567"><span data-slate-object="text" data-key="3568"><span data-slate-leaf="true" data-offset-key="3568:0" data-first-offset="true"><span data-slate-string="true">那么 boltdb 何时将数据持久化到 db 文件中呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3569"><span data-slate-object="text" data-key="3570"><span data-slate-leaf="true" data-offset-key="3570:0" data-first-offset="true"><span data-slate-string="true">当你的代码执行 tx.Commit API 时，它才会将我们上面保存到 node 内存数据结构中的数据，持久化到 boltdb 中。下图我给出了一个事务提交的流程图，接下来我就分别和你简要分析下各个核心步骤。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3571"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e9/6f/e93935835e792363ae2edc5290f2266f.png?wh=1536*1532"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3572"><span data-slate-object="text" data-key="3573"><span data-slate-leaf="true" data-offset-key="3573:0" data-first-offset="true"><span data-slate-string="true">首先从上面 put 案例中我们可以看到，插入了一个新的元素在 B+ tree 的叶子节点，它可能已不满足 B+ tree 的特性，因此事务提交时，第一步首先要调整 B+ tree，进行重平衡、分裂操作，使其满足 B+ tree 树的特性。上面案例里插入一个 key r94 后，经过重平衡、分裂操作后的 B+ tree 如下图所示。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3574"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/d3/8c/d31f483a10abeff34a8fef37941ef28c.png?wh=1920*838"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3575"><span data-slate-object="text" data-key="3576"><span data-slate-leaf="true" data-offset-key="3576:0" data-first-offset="true"><span data-slate-string="true">在重平衡、分裂过程中可能会申请、释放 free page，freelist 所管理的 free page 也发生了变化。因此事务提交的第二步，就是持久化 freelist。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3577"><span data-slate-object="text" data-key="3578"><span data-slate-leaf="true" data-offset-key="3578:0" data-first-offset="true"><span data-slate-string="true">注意，在 etcd v3.4.9 中，为了优化写性能等，freelist 持久化功能是关闭的。etcd 启动获取 boltdb db 对象的时候，boltdb 会遍历所有 page，构建空闲页列表。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3579"><span data-slate-object="text" data-key="3580"><span data-slate-leaf="true" data-offset-key="3580:0" data-first-offset="true"><span data-slate-string="true">事务提交的第三步就是将 client 更新操作产生的 dirty page 通过 fdatasync 系统调用，持久化存储到磁盘中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3581"><span data-slate-object="text" data-key="3582"><span data-slate-leaf="true" data-offset-key="3582:0" data-first-offset="true"><span data-slate-string="true">最后，在执行写事务过程中，meta page 的 txid、freelist 等字段会发生变化，因此事务的最后一步就是持久化 meta page。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3583"><span data-slate-object="text" data-key="3584"><span data-slate-leaf="true" data-offset-key="3584:0" data-first-offset="true"><span data-slate-string="true">通过以上四大步骤，我们就完成了事务提交的工作，成功将数据持久化到了磁盘文件中，安全地完成了一个 put 操作。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3585" id="sr-toc-14"><span data-slate-object="text" data-key="3586"><span data-slate-leaf="true" data-offset-key="3586:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3587"><span data-slate-object="text" data-key="3588"><span data-slate-leaf="true" data-offset-key="3588:0" data-first-offset="true"><span data-slate-string="true">最后我们来小结下今天的内容。首先我通过一幅 boltdb 磁盘布局图和 bbolt 工具，为你解密了 db 文件的本质。db 文件由 meta page、freelist page、branch page、leaf page、free page 组成。随后我结合 bbolt 工具，和你深入介绍了 meta page、branch page、leaf page、freelist page 的数据结构，帮助你了解 key、value 数据是如何存储到文件中的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3589"><span data-slate-object="text" data-key="3590"><span data-slate-leaf="true" data-offset-key="3590:0" data-first-offset="true"><span data-slate-string="true">然后我通过分析一个 put 请求在 boltdb 中如何执行的。我从 Open API 获取 db 对象说起，介绍了其通过 mmap 将 db 文件映射到内存，构建 meta page，校验 meta page 的有效性，再到创建 bucket，通过 bucket API 往 boltdb 添加 key-value 数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3591"><span data-slate-object="text" data-key="3592"><span data-slate-leaf="true" data-offset-key="3592:0" data-first-offset="true"><span data-slate-string="true">添加 bucket 和 key-value 操作本质，是从 B+ tree 管理的 page 中找到插入的页和位置，并将数据更新到 page 的内存 node 数据结构中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3593"><span data-slate-object="text" data-key="3594"><span data-slate-leaf="true" data-offset-key="3594:0" data-first-offset="true"><span data-slate-string="true">真正持久化数据到磁盘是通过事务提交执行的。它首先需要通过一系列重平衡、分裂操作，确保 boltdb 维护的 B+ tree 满足相关特性，其次需要持久化 freelist page，并将用户更新操作产生的 dirty page 数据持久化到磁盘中，最后则是持久化 meta page。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3595" id="sr-toc-15"><span data-slate-object="text" data-key="3596"><span data-slate-leaf="true" data-offset-key="3596:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3597"><span data-slate-object="text" data-key="3598"><span data-slate-leaf="true" data-offset-key="3598:0" data-first-offset="true"><span data-slate-string="true">事务提交过程中若持久化 key-value 数据到磁盘成功了，此时突然掉电，元数据还未持久化到磁盘，那么 db 文件会损坏吗？数据会丢失吗？ 为什么 boltdb 有两个 meta page 呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3599"><span data-slate-object="text" data-key="3600"><span data-slate-leaf="true" data-offset-key="3600:0" data-first-offset="true"><span data-slate-string="true">感谢你的阅读，如果你认为这节课的内容有收获，也欢迎把它分享给你的朋友，谢谢。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png" style="width: auto;"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-16">精选留言 (18)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>唐聪</span></div></div><div>文中提到的 bbolt 是 etcd 社区基于 boltdb fork 的一个版本，etcd 社区负责维护此版本，原因是 boltdb 作者认为 boltdb 已经足够成熟稳定，经过了大规模生产环境检验，新特性和优化点合入会对 boltdb 稳定性造成一定的影响，个人没更多时间再投入到 boltdb 上，因此 boltdb 项目变成 archived 状态</div><div><div>2021-02-10</div><div><div><i></i><span></span></div><div><i></i><span>15</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/47/88/0968576d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>issac</span></div></div><div>唐聪老师，能把每节课的思考题解答一下吗？觉得都是重点有意思的地方，非常感谢老师的辛苦付出！</div><div><p>作者回复：嗯，一定会的，春节快乐，近期大量时间投入在新稿，思考题后面我会一个个抽空更新，先看看大家自己思考情况，你也可以把你的想法观点在留言里面回复下。</p></div><div><div>2021-02-10</div><div><div><i></i><span>2</span></div><div><i></i><span>10</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIVvyFCLRcfoWfiaJt99K0wiabvicWtQaJdSseVA6QqWyxcvN5nd2TgZqiaUACc94bBvPHZTibnfnZfdtQ/132"></div></div><div><div><div><span>Geek_7d539e</span></div></div><div>事务提交原理 这小节，没有讲清楚单个的客户端事务请求跟批量事务的关系。麻烦老师再放大讲讲下？多谢。老师看着很年轻，造诣确不一般，了不起。</div><div><p>作者回复：感谢支持，受限篇幅的确有一些内容没覆盖到或更深入介绍，后面加餐的时候我看看能否覆盖到。</p></div><div><div>2021-07-25</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/d0/b4/a6c27fd0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>John</span></div></div><div>如果写 leafpage 部分成功部分失败，这种情况怎么处理？</div><div><div>2022-08-16</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/LMxoNLiaufeVaoVdTFFrBfwIVXOx9hJ70Luk9yKshFwjLlSIibjdbtOpj956mjM8RfoEMd7XgNTFfKJBxtDL3iaeQ/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>登顶计划</span></div></div><div>老师。下载这个 bbolt 源码，使用不了，请问可以帮忙指点下不。</div><div><div>2022-08-07</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/LMxoNLiaufeVaoVdTFFrBfwIVXOx9hJ70Luk9yKshFwjLlSIibjdbtOpj956mjM8RfoEMd7XgNTFfKJBxtDL3iaeQ/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>登顶计划</span></div></div><div>老师您好，请问 bbolt 工具在哪里下载呢？</div><div><div>2022-08-07</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/20/db/50/c2d07bb1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>L。</span></div></div><div>老师 一组相同的 key 对应一个 bucket 吗 还是不同的 key 对应不同的 bucket</div><div><div>2022-05-08</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/20/db/50/c2d07bb1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>L。</span></div></div><div>老师 请问下 key 和 bucket 有没有什么关系 是不是 key 必须放在 bucket 里</div><div><div>2022-05-08</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/46/0f/f6cfc659.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>mckee</span></div></div><div>思考题：
1.db 文件会损坏吗？数据会丢失吗？ 
应该不会，只是 meta page 没更新？
2. 为什么 boltdb 有两个 meta page
备份容灾，如果其中一个 meta invalid，就使用另外一个 meta</div><div><div>2022-05-05</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132"></div></div><div><div><div><span>types</span></div></div><div>作者你好，meta page 中保存的写事务 ID，跟 consistent index， 以及 raft 中的 applied index 之间是什么关系，是否可以解释下</div><div><div>2021-10-08</div><div><div><i></i><span>1</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132"></div></div><div><div><div><span>types</span></div></div><div>前面涉及到的 consistent index，以及写事务批量提交，在这篇文章中没有关联起来。
</div><div><div>2021-10-08</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/5b/0d/597cfa28.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>田奇</span></div></div><div>```
type raftLog struct {
	//storage contains all stable entries since the last snapshot.
	storage Storage

	//unstable contains all unstable entries and snapshot.
	//they will be saved into storage.
	unstable unstable

	//committed is the highest log position that is known to be in
	//stable storage on a quorum of nodes.
	committed uint64
	//applied is the highest log position that the application has
	//been instructed to apply to its state machine.
	// Invariant: applied &lt;= committed
	applied uint64

	logger Logger

	//maxNextEntsSize is the maximum number aggregate byte size of the messages
	//returned from calls to nextEnts.
	maxNextEntsSize uint64
}

```
老师，请问这里的 Storage 接口具体实现在哪里啊，我只看到一个 MemoryStorage 实现了这个接口，但是你说 v3 用 boltdb 替换了这个实现，但是我并没有在源码中搜索到这个 boltdb 实现这个接口的地方，很奇怪，具体是哪个包里啊</div><div><div>2021-03-26</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/76/7d/04c95885.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Index</span></div></div><div>请问老师一个问题，在事务提交的时候，有三个持久化的操作，比如只持久化成功一个，后面两个由于崩溃失败了，这样会有数据不一致的问题吗？也就是说所有的持久化能否保证原子性？</div><div><div>2021-03-09</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132"></div></div><div><div><div><span>types</span></div></div><div>是 key-value 数据与 consistent index 在同一个 boltdb 事务中更新

请问 consistent index 在哪边更新的？</div><div><p>作者回复：就是你发起一个写请求，MVCC 写事物通过 boltdb API 执行，put 写入 hello 的时候，它也会通过如下的 boltdb API, 更新 consistent index, 只是 bucket 名字不一样，最终这两个数据写入，都是在同一个大的 boltdb 事务中提交的。
如果还有疑问，可以参考下这块代码
https://github.com/etcd-io/etcd/blob/v3.4.9/mvcc/kvstore.go#L546:L556

	//put the index into the underlying backend
	//tx has been locked in TxnBegin, so there is no need to lock it again
	tx.UnsafePut (metaBucketName, consistentIndexKeyName, bs)
	atomic.StoreUint64 (&amp;s.consistentIndex, ci)</p></div><div><div>2021-03-03</div><div><div><i></i><span>3</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>写点啥呢</span></div></div><div>请问唐老师，能否介绍下 etcd 层的事务和 boltdb 事务之间的对应关系，是否一个 etcd 的事务过程中在 boltdb 会产生多个还是一个事务？

如果一个 etcd 事务对应的是多个 boltdb 事务，这样能提升上层事务的并发度，通过 etcd 的 buffer 读和 mvcc 锁来保证事务隔离性，是这样的话，当上层 etcd 事务回滚的话 boltdb 层该如何做呢？是否是提交新的 boltdb 事务来回滚 bolt 数据页呢？

如果 etcd 和 boldb 事务是一对一关系的话，可能会涉及到一个 etcd 事务写入的 bolt 数据页在事务提交前如何被其它事务访问的问题，请问老师这时候对这种被 etcd 事务写入数据的内存脏页，它的数据如果需要被其它事务读和写的时候是怎样的机制？

另外 09 章提到了利用一个 mvcc 锁来在 etcd 层实现可串行事务隔离级别，能否有篇章介绍下 mvcc 锁的具体使用，比如除了可串行之外还有哪些地方用到了，使用的时候锁的粒度如何？

最后想问下 etcd 的隔离级别，是在哪里配置的，比如 mysql 可以通过 set 来配置全局 / 会话隔离界别那样

问题有点多，麻烦老师指点下。

谢谢</div><div><div>2021-03-03</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>一步</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>每个 page  大小不是 4096 个字节吗？为什么 bbolt dump ./db 0 打印出来的字节那么少的</div><div><div>2021-02-27</div><div><div><i></i><span>1</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/4f/12/e1564440.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>浮生六记</span></div></div><div>"其次 etcd 通过合并多个写事务请求，通常情况下，是异步机制定时（默认每隔 100ms）将批量事务一次性提交（pending 事务过多才会触发同步提交）， 从而大大提高吞吐量，对应上面简易写事务图的流程三。"

你好，你在 03 章节有过这段介绍。我有个疑问，异步提交的事务，突然 crash 的话，如果保证安全写入磁盘呢？是 boltdb 有什么机制保证吗？我在本章节也没有看到相关内容，就此请教一下。</div><div><div>2021-02-20</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>写点啥呢</span></div></div><div>请问下唐老师，文章中 “boltdb API” 一节的示例代码里，"defer tx.Rollback ()" 将事务回滚放到 defer 链里，如果事务正常提交了，这时候 defer 链再调用 Rollback 会是什么效果？是不是 Rollback 报错而我们直接忽略掉？</div><div><p>作者回复：事务正常提交后，tx.db 等相关字段会设置为空，执行 tx.RollBack 后发现 tx.db 为空，就直接返回了哈，相当于空操作</p></div><div><div>2021-02-10</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".v"><outline class="toc-level-h1" data-reactid=".v.0" style="width: 175px;"><active data-reactid=".v.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".v.0.1"><span data-reactid=".v.0.1.0">10 | boltdb：如何持久化存储你的 key-value 数据？</span></a></outline><outline class="toc-level-h2" data-reactid=".v.1" style="width: 165px;"><active data-reactid=".v.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".v.1.1"><span data-reactid=".v.1.1.0">boltdb 磁盘布局</span></a></outline><outline class="toc-level-h2" data-reactid=".v.2" style="width: 165px;"><active data-reactid=".v.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".v.2.1"><span data-reactid=".v.2.1.0">boltdb API</span></a></outline><outline class="toc-level-h2" data-reactid=".v.3" style="width: 165px;"><active data-reactid=".v.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".v.3.1"><span data-reactid=".v.3.1.0">核心数据结构介绍</span></a></outline><outline class="toc-level-h3" data-reactid=".v.4" style="width: 155px;"><active data-reactid=".v.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".v.4.1"><span data-reactid=".v.4.1.0">page 磁盘页结构</span></a></outline><outline class="toc-level-h3" data-reactid=".v.5" style="width: 155px;"><active data-reactid=".v.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".v.5.1"><span data-reactid=".v.5.1.0">meta page 数据结构</span></a></outline><outline class="toc-level-h3" data-reactid=".v.6" style="width: 155px;"><active data-reactid=".v.6.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".v.6.1"><span data-reactid=".v.6.1.0">meta page 十六进制分析</span></a></outline><outline class="toc-level-h3" data-reactid=".v.7" style="width: 155px;"><active data-reactid=".v.7.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".v.7.1"><span data-reactid=".v.7.1.0">bucket 数据结构</span></a></outline><outline class="toc-level-h3" data-reactid=".v.8" style="width: 155px;"><active data-reactid=".v.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".v.8.1"><span data-reactid=".v.8.1.0">leaf page</span></a></outline><outline class="toc-level-h3" data-reactid=".v.9" style="width: 155px;"><active data-reactid=".v.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".v.9.1"><span data-reactid=".v.9.1.0">branch page</span></a></outline><outline class="toc-level-h3" data-reactid=".v.a" style="width: 155px;"><active data-reactid=".v.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".v.a.1"><span data-reactid=".v.a.1.0">freelist</span></a></outline><outline class="toc-level-h2" data-reactid=".v.b" style="width: 165px;"><active data-reactid=".v.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".v.b.1"><span data-reactid=".v.b.1.0">Open 原理</span></a></outline><outline class="toc-level-h2" data-reactid=".v.c" style="width: 165px;"><active data-reactid=".v.c.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".v.c.1"><span data-reactid=".v.c.1.0">Put 原理</span></a></outline><outline class="toc-level-h2" data-reactid=".v.d" style="width: 165px;"><active data-reactid=".v.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".v.d.1"><span data-reactid=".v.d.1.0">事务提交原理</span></a></outline><outline class="toc-level-h2" data-reactid=".v.e" style="width: 165px;"><active data-reactid=".v.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".v.e.1"><span data-reactid=".v.e.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".v.f" style="width: 165px;"><active data-reactid=".v.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".v.f.1"><span data-reactid=".v.f.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".v.g" style="width: 165px;"><active data-reactid=".v.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".v.g.1"><span data-reactid=".v.g.1.0">精选留言 (18)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/342527" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>