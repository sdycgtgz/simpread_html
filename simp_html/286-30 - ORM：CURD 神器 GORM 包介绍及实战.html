
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 30 | ORM：CURD 神器 GORM 包介绍及实战</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>30 | ORM：CURD 神器 GORM 包介绍及实战</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">这一讲我们来了解目前业界有哪些优秀的开源日志包，以及手把手教你从 0 编写一个日志包</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 30 | ORM：CURD 神器 GORM 包介绍及实战</h1><div><span>孔令飞</span> <span> 2021-08-03</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/51/02/5185cff54c89c25f08b30363c3903602.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：16.31M</span><span> 时长：17:51</span></div></div><audio title="30 | ORM：CURD 神器 GORM 包介绍及实战" src="https://res001.geekbang.org/media/audio/45/6b/4516bc60yya708d0b2155cb61f12be6b/ld/ld.m3u8" __idm_id__="319498"></audio></div><div><div><div><div data-slate-editor="true" data-key="13774" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="13775"><span data-slate-object="text" data-key="13776"><span data-slate-leaf="true" data-offset-key="13776:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13777"><span data-slate-object="text" data-key="13778"><span data-slate-leaf="true" data-offset-key="13778:0" data-first-offset="true"><span data-slate-string="true">在用 Go 开发项目时，我们免不了要和数据库打交道。每种语言都有优秀的 ORM 可供选择，在 Go 中也不例外，比如 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13779"><span data-slate-object="text" data-key="13780"><span data-slate-leaf="true" data-offset-key="13780:0" data-first-offset="true"><span data-slate-string="true">gorm</span></span></span></a><span data-slate-object="text" data-key="13781"><span data-slate-leaf="true" data-offset-key="13781:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13782"><span data-slate-object="text" data-key="13783"><span data-slate-leaf="true" data-offset-key="13783:0" data-first-offset="true"><span data-slate-string="true">xorm</span></span></span></a><span data-slate-object="text" data-key="13784"><span data-slate-leaf="true" data-offset-key="13784:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13785"><span data-slate-object="text" data-key="13786"><span data-slate-leaf="true" data-offset-key="13786:0" data-first-offset="true"><span data-slate-string="true">gorose</span></span></span></a><span data-slate-object="text" data-key="13787"><span data-slate-leaf="true" data-offset-key="13787:0" data-first-offset="true"><span data-slate-string="true"> 等。目前，GitHub 上 star 数最多的是 GORM，它也是当前 Go 项目中使用最多的 ORM。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13788"><span data-slate-object="text" data-key="13789"><span data-slate-leaf="true" data-offset-key="13789:0" data-first-offset="true"><span data-slate-string="true">IAM 项目也使用了 GORM。这一讲，我就来详细讲解下 GORM 的基础知识，并介绍 iam-apiserver 是如何使用 GORM，对数据进行 CURD 操作的。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13790" id="sr-toc-1"><span data-slate-object="text" data-key="13791"><span data-slate-leaf="true" data-offset-key="13791:0" data-first-offset="true"><span data-slate-string="true">GORM 基础知识介绍</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13792"><span data-slate-object="text" data-key="13793"><span data-slate-leaf="true" data-offset-key="13793:0" data-first-offset="true"><span data-slate-string="true">GORM 是 Go 语言的 ORM 包，功能强大，调用方便。像腾讯、华为、阿里这样的大厂，都在使用 GORM 来构建企业级的应用。GORM 有很多特性，开发中常用的核心特性如下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13794"><div data-slate-type="list-line" data-slate-object="block" data-key="13795"><span data-slate-object="text" data-key="13796"><span data-slate-leaf="true" data-offset-key="13796:0" data-first-offset="true"><span data-slate-string="true">功能全。使用 ORM 操作数据库的接口，GORM 都有，可以满足我们开发中对数据库调用的各类需求。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13797"><span data-slate-object="text" data-key="13798"><span data-slate-leaf="true" data-offset-key="13798:0" data-first-offset="true"><span data-slate-string="true">支持钩子方法。这些钩子方法可以应用在 Create、Save、Update、Delete、Find 方法中。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13799"><span data-slate-object="text" data-key="13800"><span data-slate-leaf="true" data-offset-key="13800:0" data-first-offset="true"><span data-slate-string="true">开发者友好，调用方便。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13801"><span data-slate-object="text" data-key="13802"><span data-slate-leaf="true" data-offset-key="13802:0" data-first-offset="true"><span data-slate-string="true">支持 Auto Migration。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13803"><span data-slate-object="text" data-key="13804"><span data-slate-leaf="true" data-offset-key="13804:0" data-first-offset="true"><span data-slate-string="true">支持关联查询。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13805"><span data-slate-object="text" data-key="13806"><span data-slate-leaf="true" data-offset-key="13806:0" data-first-offset="true"><span data-slate-string="true">支持多种关系数据库，例如 MySQL、Postgres、SQLite、SQLServer 等。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13807"><span data-slate-object="text" data-key="13808"><span data-slate-leaf="true" data-offset-key="13808:0" data-first-offset="true"><span data-slate-string="true">GORM 有两个版本，</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13809"><span data-slate-object="text" data-key="13810"><span data-slate-leaf="true" data-offset-key="13810:0" data-first-offset="true"><span data-slate-string="true">V1</span></span></span></a><span data-slate-object="text" data-key="13811"><span data-slate-leaf="true" data-offset-key="13811:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13812"><span data-slate-object="text" data-key="13813"><span data-slate-leaf="true" data-offset-key="13813:0" data-first-offset="true"><span data-slate-string="true">V2</span></span></span></a><span data-slate-object="text" data-key="13814"><span data-slate-leaf="true" data-offset-key="13814:0" data-first-offset="true"><span data-slate-string="true">。遵循用新不用旧的原则，IAM 项目使用了最新的 V2 版本。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13815" id="sr-toc-2"><span data-slate-object="text" data-key="13816"><span data-slate-leaf="true" data-offset-key="13816:0" data-first-offset="true"><span data-slate-string="true">通过示例学习 GORM</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13817"><span data-slate-object="text" data-key="13818"><span data-slate-leaf="true" data-offset-key="13818:0" data-first-offset="true"><span data-slate-string="true">接下来，我们先快速看一个使用 GORM 的示例，通过该示例来学习 GORM。示例代码存放在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13819"><span data-slate-object="text" data-key="13820"><span data-slate-leaf="true" data-offset-key="13820:0" data-first-offset="true"><span data-slate-string="true">marmotedu/gopractise-demo/gorm/main.go</span></span></span></a><span data-slate-object="text" data-key="13821"><span data-slate-leaf="true" data-offset-key="13821:0" data-first-offset="true"><span data-slate-string="true"> 文件中。因为代码比较长，你可以使用以下命令克隆到本地查看：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="13822"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13823"><span data-slate-object="text" data-key="13824"><span data-slate-leaf="true" data-offset-key="13824:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="13825"><span data-slate-leaf="true" data-offset-key="13825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="13826"><span data-slate-leaf="true" data-offset-key="13826:0" data-first-offset="true"><span data-slate-string="true"> -p </span></span></span><span data-slate-object="text" data-key="13827"><span data-slate-leaf="true" data-offset-key="13827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$GOPATH</span></span></span></span><span data-slate-object="text" data-key="13828"><span data-slate-leaf="true" data-offset-key="13828:0" data-first-offset="true"><span data-slate-string="true">/src/github.com/marmotedu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13829"><span data-slate-object="text" data-key="13830"><span data-slate-leaf="true" data-offset-key="13830:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="13831"><span data-slate-leaf="true" data-offset-key="13831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cd</span></span></span></span><span data-slate-object="text" data-key="13832"><span data-slate-leaf="true" data-offset-key="13832:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13833"><span data-slate-leaf="true" data-offset-key="13833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$GOPATH</span></span></span></span><span data-slate-object="text" data-key="13834"><span data-slate-leaf="true" data-offset-key="13834:0" data-first-offset="true"><span data-slate-string="true">/src/github.com/marmotedu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13835"><span data-slate-object="text" data-key="13836"><span data-slate-leaf="true" data-offset-key="13836:0" data-first-offset="true"><span data-slate-string="true">$ git </span></span></span><span data-slate-object="text" data-key="13837"><span data-slate-leaf="true" data-offset-key="13837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">clone</span></span></span></span><span data-slate-object="text" data-key="13838"><span data-slate-leaf="true" data-offset-key="13838:0" data-first-offset="true"><span data-slate-string="true"> https://github.com/marmotedu/gopractise-demo</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13839"><span data-slate-object="text" data-key="13840"><span data-slate-leaf="true" data-offset-key="13840:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="13841"><span data-slate-leaf="true" data-offset-key="13841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cd</span></span></span></span><span data-slate-object="text" data-key="13842"><span data-slate-leaf="true" data-offset-key="13842:0" data-first-offset="true"><span data-slate-string="true"> gopractise-demo/gorm/</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13843"><span data-slate-object="text" data-key="13844"><span data-slate-leaf="true" data-offset-key="13844:0" data-first-offset="true"><span data-slate-string="true">假设我们有一个 MySQL 数据库，连接地址和端口为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13845"><span data-slate-object="text" data-key="13846"><span data-slate-leaf="true" data-offset-key="13846:0" data-first-offset="true"><span data-slate-string="true">127.0.0.1:3306</span></span></span></span><span data-slate-object="text" data-key="13847"><span data-slate-leaf="true" data-offset-key="13847:0" data-first-offset="true"><span data-slate-string="true"> ，用户名为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13848"><span data-slate-object="text" data-key="13849"><span data-slate-leaf="true" data-offset-key="13849:0" data-first-offset="true"><span data-slate-string="true">iam</span></span></span></span><span data-slate-object="text" data-key="13850"><span data-slate-leaf="true" data-offset-key="13850:0" data-first-offset="true"><span data-slate-string="true"> ，密码为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13851"><span data-slate-object="text" data-key="13852"><span data-slate-leaf="true" data-offset-key="13852:0" data-first-offset="true"><span data-slate-string="true">iam1234</span></span></span></span><span data-slate-object="text" data-key="13853"><span data-slate-leaf="true" data-offset-key="13853:0" data-first-offset="true"><span data-slate-string="true"> 。创建完 main.go 文件后，执行以下命令来运行：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="13854"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13855"><span data-slate-object="text" data-key="13856"><span data-slate-leaf="true" data-offset-key="13856:0" data-first-offset="true"><span data-slate-string="true">$ go run main.go -H 127.0.0.1:3306 -u iam -p iam1234 -d </span></span></span><span data-slate-object="text" data-key="13857"><span data-slate-leaf="true" data-offset-key="13857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">test</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13858"><span data-slate-object="text" data-key="13859"><span data-slate-leaf="true" data-offset-key="13859:0" data-first-offset="true"><span data-slate-string="true">2020/10/17 15:15:50 totalcount: 1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13860"><span data-slate-object="text" data-key="13861"><span data-slate-leaf="true" data-offset-key="13861:0" data-first-offset="true"><span data-slate-string="true">2020/10/17 15:15:50   code: D42, price: 100</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13862"><span data-slate-object="text" data-key="13863"><span data-slate-leaf="true" data-offset-key="13863:0" data-first-offset="true"><span data-slate-string="true">2020/10/17 15:15:51 totalcount: 1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13864"><span data-slate-object="text" data-key="13865"><span data-slate-leaf="true" data-offset-key="13865:0" data-first-offset="true"><span data-slate-string="true">2020/10/17 15:15:51   code: D42, price: 200</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13866"><span data-slate-object="text" data-key="13867"><span data-slate-leaf="true" data-offset-key="13867:0" data-first-offset="true"><span data-slate-string="true">2020/10/17 15:15:51 totalcount: 0</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13868"><span data-slate-object="text" data-key="13869"><span data-slate-leaf="true" data-offset-key="13869:0" data-first-offset="true"><span data-slate-string="true">在企业级 Go 项目开发中，使用 GORM 库主要用来完成以下数据库操作：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13870"><div data-slate-type="list-line" data-slate-object="block" data-key="13871"><span data-slate-object="text" data-key="13872"><span data-slate-leaf="true" data-offset-key="13872:0" data-first-offset="true"><span data-slate-string="true">连接和关闭数据库。连接数据库时，可能需要设置一些参数，比如最大连接数、最大空闲连接数、最大连接时长等。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13873"><span data-slate-object="text" data-key="13874"><span data-slate-leaf="true" data-offset-key="13874:0" data-first-offset="true"><span data-slate-string="true">插入表记录。可以插入一条记录，也可以批量插入记录。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13875"><span data-slate-object="text" data-key="13876"><span data-slate-leaf="true" data-offset-key="13876:0" data-first-offset="true"><span data-slate-string="true">更新表记录。可以更新某一个字段，也可以更新多个字段。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13877"><span data-slate-object="text" data-key="13878"><span data-slate-leaf="true" data-offset-key="13878:0" data-first-offset="true"><span data-slate-string="true">查看表记录。可以查看某一条记录，也可以查看符合条件的记录列表。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13879"><span data-slate-object="text" data-key="13880"><span data-slate-leaf="true" data-offset-key="13880:0" data-first-offset="true"><span data-slate-string="true">删除表记录。可以删除某一个记录，也可以批量删除。删除还支持永久删除和软删除。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13881"><span data-slate-object="text" data-key="13882"><span data-slate-leaf="true" data-offset-key="13882:0" data-first-offset="true"><span data-slate-string="true">在一些小型项目中，还会用到 GORM 的表结构自动迁移功能。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13883"><span data-slate-object="text" data-key="13884"><span data-slate-leaf="true" data-offset-key="13884:0" data-first-offset="true"><span data-slate-string="true">GORM 功能强大，上面的示例代码展示的是比较通用的一种操作方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13885"><span data-slate-object="text" data-key="13886"><span data-slate-leaf="true" data-offset-key="13886:0" data-first-offset="true"><span data-slate-string="true">上述代码中，首先定义了一个 GORM 模型（Models），Models 是标准的 Go struct，用来代表数据库中的一个表结构。我们可以给 Models 添加 TableName 方法，来告诉 GORM 该 Models 映射到数据库中的哪张表。Models 定义如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13887"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13888"><span data-slate-object="text" data-key="13889"><span data-slate-leaf="true" data-offset-key="13889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="13890"><span data-slate-leaf="true" data-offset-key="13890:0" data-first-offset="true"><span data-slate-string="true"> Product </span></span></span><span data-slate-object="text" data-key="13891"><span data-slate-leaf="true" data-offset-key="13891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="13892"><span data-slate-leaf="true" data-offset-key="13892:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13893"><span data-slate-object="text" data-key="13894"><span data-slate-leaf="true" data-offset-key="13894:0" data-first-offset="true"><span data-slate-string="true">    gorm.Model</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13895"><span data-slate-object="text" data-key="13896"><span data-slate-leaf="true" data-offset-key="13896:0" data-first-offset="true"><span data-slate-string="true">    Code  </span></span></span><span data-slate-object="text" data-key="13897"><span data-slate-leaf="true" data-offset-key="13897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="13898"><span data-slate-leaf="true" data-offset-key="13898:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13899"><span data-slate-leaf="true" data-offset-key="13899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:code"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13900"><span data-slate-object="text" data-key="13901"><span data-slate-leaf="true" data-offset-key="13901:0" data-first-offset="true"><span data-slate-string="true">    Price </span></span></span><span data-slate-object="text" data-key="13902"><span data-slate-leaf="true" data-offset-key="13902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span><span data-slate-object="text" data-key="13903"><span data-slate-leaf="true" data-offset-key="13903:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="13904"><span data-slate-leaf="true" data-offset-key="13904:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:price"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13905"><span data-slate-object="text" data-key="13906"><span data-slate-leaf="true" data-offset-key="13906:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13907"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13908"><span data-slate-object="text" data-key="13909"><span data-slate-leaf="true" data-offset-key="13909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// TableName maps to mysql table name.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13910"><span data-slate-object="text" data-key="13911"><span data-slate-leaf="true" data-offset-key="13911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="13912"><span data-slate-leaf="true" data-offset-key="13912:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13913"><span data-slate-leaf="true" data-offset-key="13913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(p *Product)</span></span></span></span></span><span data-slate-object="text" data-key="13914"><span data-slate-leaf="true" data-offset-key="13914:0" data-first-offset="true"><span data-slate-string="true"> TableName() </span></span></span><span data-slate-object="text" data-key="13915"><span data-slate-leaf="true" data-offset-key="13915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="13916"><span data-slate-leaf="true" data-offset-key="13916:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13917"><span data-slate-object="text" data-key="13918"><span data-slate-leaf="true" data-offset-key="13918:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13919"><span data-slate-leaf="true" data-offset-key="13919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13920"><span data-slate-leaf="true" data-offset-key="13920:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13921"><span data-slate-leaf="true" data-offset-key="13921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"product"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13922"><span data-slate-object="text" data-key="13923"><span data-slate-leaf="true" data-offset-key="13923:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13924"><span data-slate-object="text" data-key="13925"><span data-slate-leaf="true" data-offset-key="13925:0" data-first-offset="true"><span data-slate-string="true">如果没有指定表名，则 GORM 使用结构体名的蛇形复数作为表名。例如：结构体名为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13926"><span data-slate-object="text" data-key="13927"><span data-slate-leaf="true" data-offset-key="13927:0" data-first-offset="true"><span data-slate-string="true">DockerInstance</span></span></span></span><span data-slate-object="text" data-key="13928"><span data-slate-leaf="true" data-offset-key="13928:0" data-first-offset="true"><span data-slate-string="true"> ，</span></span><span data-slate-leaf="true" data-offset-key="13928:1"><span data-slate-object="annotation" data-annotation-key="gkann_2e68d4ed" data-attr-id="36204" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">则表名为 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13929"><span data-slate-object="text" data-key="13930"><span data-slate-leaf="true" data-offset-key="13930:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_2e68d4ed" data-attr-id="36204" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">dockerInstances</span></span></span></span></span><span data-slate-object="text" data-key="13931"><span data-slate-leaf="true" data-offset-key="13931:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_2e68d4ed" data-attr-id="36204" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13932"><span data-slate-object="text" data-key="13933"><span data-slate-leaf="true" data-offset-key="13933:0" data-first-offset="true"><span data-slate-string="true">在之后的代码中，使用 Pflag 来解析命令行的参数，通过命令行参数指定数据库的地址、用户名、密码和数据库名。之后，使用这些参数生成建立 MySQL 连接需要的配置文件，并调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13934"><span data-slate-object="text" data-key="13935"><span data-slate-leaf="true" data-offset-key="13935:0" data-first-offset="true"><span data-slate-string="true">gorm.Open</span></span></span></span><span data-slate-object="text" data-key="13936"><span data-slate-leaf="true" data-offset-key="13936:0" data-first-offset="true"><span data-slate-string="true"> 建立数据库连接：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13937"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13938"><span data-slate-object="text" data-key="13939"><span data-slate-leaf="true" data-offset-key="13939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="13940"><span data-slate-leaf="true" data-offset-key="13940:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13941"><span data-slate-object="text" data-key="13942"><span data-slate-leaf="true" data-offset-key="13942:0" data-first-offset="true"><span data-slate-string="true">    host     = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="13943"><span data-slate-leaf="true" data-offset-key="13943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"host"</span></span></span></span><span data-slate-object="text" data-key="13944"><span data-slate-leaf="true" data-offset-key="13944:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13945"><span data-slate-leaf="true" data-offset-key="13945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"H"</span></span></span></span><span data-slate-object="text" data-key="13946"><span data-slate-leaf="true" data-offset-key="13946:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13947"><span data-slate-leaf="true" data-offset-key="13947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"127.0.0.1:3306"</span></span></span></span><span data-slate-object="text" data-key="13948"><span data-slate-leaf="true" data-offset-key="13948:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13949"><span data-slate-leaf="true" data-offset-key="13949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"MySQL service host address"</span></span></span></span><span data-slate-object="text" data-key="13950"><span data-slate-leaf="true" data-offset-key="13950:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13951"><span data-slate-object="text" data-key="13952"><span data-slate-leaf="true" data-offset-key="13952:0" data-first-offset="true"><span data-slate-string="true">    username = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="13953"><span data-slate-leaf="true" data-offset-key="13953:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="13954"><span data-slate-leaf="true" data-offset-key="13954:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13955"><span data-slate-leaf="true" data-offset-key="13955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"u"</span></span></span></span><span data-slate-object="text" data-key="13956"><span data-slate-leaf="true" data-offset-key="13956:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13957"><span data-slate-leaf="true" data-offset-key="13957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"root"</span></span></span></span><span data-slate-object="text" data-key="13958"><span data-slate-leaf="true" data-offset-key="13958:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13959"><span data-slate-leaf="true" data-offset-key="13959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Username for access to mysql service"</span></span></span></span><span data-slate-object="text" data-key="13960"><span data-slate-leaf="true" data-offset-key="13960:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13961"><span data-slate-object="text" data-key="13962"><span data-slate-leaf="true" data-offset-key="13962:0" data-first-offset="true"><span data-slate-string="true">    password = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="13963"><span data-slate-leaf="true" data-offset-key="13963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"password"</span></span></span></span><span data-slate-object="text" data-key="13964"><span data-slate-leaf="true" data-offset-key="13964:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13965"><span data-slate-leaf="true" data-offset-key="13965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"p"</span></span></span></span><span data-slate-object="text" data-key="13966"><span data-slate-leaf="true" data-offset-key="13966:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13967"><span data-slate-leaf="true" data-offset-key="13967:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"root"</span></span></span></span><span data-slate-object="text" data-key="13968"><span data-slate-leaf="true" data-offset-key="13968:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13969"><span data-slate-leaf="true" data-offset-key="13969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Password for access to mysql, should be used pair with password"</span></span></span></span><span data-slate-object="text" data-key="13970"><span data-slate-leaf="true" data-offset-key="13970:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13971"><span data-slate-object="text" data-key="13972"><span data-slate-leaf="true" data-offset-key="13972:0" data-first-offset="true"><span data-slate-string="true">    database = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="13973"><span data-slate-leaf="true" data-offset-key="13973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"database"</span></span></span></span><span data-slate-object="text" data-key="13974"><span data-slate-leaf="true" data-offset-key="13974:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13975"><span data-slate-leaf="true" data-offset-key="13975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"d"</span></span></span></span><span data-slate-object="text" data-key="13976"><span data-slate-leaf="true" data-offset-key="13976:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13977"><span data-slate-leaf="true" data-offset-key="13977:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"test"</span></span></span></span><span data-slate-object="text" data-key="13978"><span data-slate-leaf="true" data-offset-key="13978:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13979"><span data-slate-leaf="true" data-offset-key="13979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Database name to use"</span></span></span></span><span data-slate-object="text" data-key="13980"><span data-slate-leaf="true" data-offset-key="13980:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13981"><span data-slate-object="text" data-key="13982"><span data-slate-leaf="true" data-offset-key="13982:0" data-first-offset="true"><span data-slate-string="true">    help     = pflag.BoolP(</span></span></span><span data-slate-object="text" data-key="13983"><span data-slate-leaf="true" data-offset-key="13983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"help"</span></span></span></span><span data-slate-object="text" data-key="13984"><span data-slate-leaf="true" data-offset-key="13984:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13985"><span data-slate-leaf="true" data-offset-key="13985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"h"</span></span></span></span><span data-slate-object="text" data-key="13986"><span data-slate-leaf="true" data-offset-key="13986:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13987"><span data-slate-leaf="true" data-offset-key="13987:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="13988"><span data-slate-leaf="true" data-offset-key="13988:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13989"><span data-slate-leaf="true" data-offset-key="13989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Print this help message"</span></span></span></span><span data-slate-object="text" data-key="13990"><span data-slate-leaf="true" data-offset-key="13990:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13991"><span data-slate-object="text" data-key="13992"><span data-slate-leaf="true" data-offset-key="13992:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13993"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13994"><span data-slate-object="text" data-key="13995"><span data-slate-leaf="true" data-offset-key="13995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="13996"><span data-slate-leaf="true" data-offset-key="13996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13997"><span data-slate-leaf="true" data-offset-key="13997:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="13998"><span data-slate-leaf="true" data-offset-key="13998:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="13999"><span data-slate-leaf="true" data-offset-key="13999:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14000"><span data-slate-object="text" data-key="14001"><span data-slate-leaf="true" data-offset-key="14001:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14002"><span data-slate-leaf="true" data-offset-key="14002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Parse command line flags</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14003"><span data-slate-object="text" data-key="14004"><span data-slate-leaf="true" data-offset-key="14004:0" data-first-offset="true"><span data-slate-string="true">    pflag.CommandLine.SortFlags = </span></span></span><span data-slate-object="text" data-key="14005"><span data-slate-leaf="true" data-offset-key="14005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14006"><span data-slate-object="text" data-key="14007"><span data-slate-leaf="true" data-offset-key="14007:0" data-first-offset="true"><span data-slate-string="true">    pflag.Usage = </span></span></span><span data-slate-object="text" data-key="14008"><span data-slate-leaf="true" data-offset-key="14008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14009"><span data-slate-leaf="true" data-offset-key="14009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="14010"><span data-slate-leaf="true" data-offset-key="14010:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14011"><span data-slate-object="text" data-key="14012"><span data-slate-leaf="true" data-offset-key="14012:0" data-first-offset="true"><span data-slate-string="true">        pflag.PrintDefaults()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14013"><span data-slate-object="text" data-key="14014"><span data-slate-leaf="true" data-offset-key="14014:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14015"><span data-slate-object="text" data-key="14016"><span data-slate-leaf="true" data-offset-key="14016:0" data-first-offset="true"><span data-slate-string="true">    pflag.Parse()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14017"><span data-slate-object="text" data-key="14018"><span data-slate-leaf="true" data-offset-key="14018:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14019"><span data-slate-leaf="true" data-offset-key="14019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14020"><span data-slate-leaf="true" data-offset-key="14020:0" data-first-offset="true"><span data-slate-string="true"> *help {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14021"><span data-slate-object="text" data-key="14022"><span data-slate-leaf="true" data-offset-key="14022:0" data-first-offset="true"><span data-slate-string="true">        pflag.Usage()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14023"><span data-slate-object="text" data-key="14024"><span data-slate-leaf="true" data-offset-key="14024:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14025"><span data-slate-leaf="true" data-offset-key="14025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14026"><span data-slate-object="text" data-key="14027"><span data-slate-leaf="true" data-offset-key="14027:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14028"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14029"><span data-slate-object="text" data-key="14030"><span data-slate-leaf="true" data-offset-key="14030:0" data-first-offset="true"><span data-slate-string="true">    dsn := fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="14031"><span data-slate-leaf="true" data-offset-key="14031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`%s:%s@tcp(%s)/%s?charset=utf8&amp;parseTime=%t&amp;loc=%s`</span></span></span></span><span data-slate-object="text" data-key="14032"><span data-slate-leaf="true" data-offset-key="14032:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14033"><span data-slate-object="text" data-key="14034"><span data-slate-leaf="true" data-offset-key="14034:0" data-first-offset="true"><span data-slate-string="true">        *username,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14035"><span data-slate-object="text" data-key="14036"><span data-slate-leaf="true" data-offset-key="14036:0" data-first-offset="true"><span data-slate-string="true">        *password,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14037"><span data-slate-object="text" data-key="14038"><span data-slate-leaf="true" data-offset-key="14038:0" data-first-offset="true"><span data-slate-string="true">        *host,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14039"><span data-slate-object="text" data-key="14040"><span data-slate-leaf="true" data-offset-key="14040:0" data-first-offset="true"><span data-slate-string="true">        *database,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14041"><span data-slate-object="text" data-key="14042"><span data-slate-leaf="true" data-offset-key="14042:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14043"><span data-slate-leaf="true" data-offset-key="14043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="14044"><span data-slate-leaf="true" data-offset-key="14044:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14045"><span data-slate-object="text" data-key="14046"><span data-slate-leaf="true" data-offset-key="14046:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14047"><span data-slate-leaf="true" data-offset-key="14047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Local"</span></span></span></span><span data-slate-object="text" data-key="14048"><span data-slate-leaf="true" data-offset-key="14048:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14049"><span data-slate-object="text" data-key="14050"><span data-slate-leaf="true" data-offset-key="14050:0" data-first-offset="true"><span data-slate-string="true">    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14051"><span data-slate-object="text" data-key="14052"><span data-slate-leaf="true" data-offset-key="14052:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14053"><span data-slate-leaf="true" data-offset-key="14053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14054"><span data-slate-leaf="true" data-offset-key="14054:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="14055"><span data-slate-leaf="true" data-offset-key="14055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14056"><span data-slate-leaf="true" data-offset-key="14056:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14057"><span data-slate-object="text" data-key="14058"><span data-slate-leaf="true" data-offset-key="14058:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14059"><span data-slate-leaf="true" data-offset-key="14059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">panic</span></span></span></span><span data-slate-object="text" data-key="14060"><span data-slate-leaf="true" data-offset-key="14060:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="14061"><span data-slate-leaf="true" data-offset-key="14061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"failed to connect database"</span></span></span></span><span data-slate-object="text" data-key="14062"><span data-slate-leaf="true" data-offset-key="14062:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14063"><span data-slate-object="text" data-key="14064"><span data-slate-leaf="true" data-offset-key="14064:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14065"><span data-slate-object="text" data-key="14066"><span data-slate-leaf="true" data-offset-key="14066:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14067"><span data-slate-object="text" data-key="14068"><span data-slate-leaf="true" data-offset-key="14068:0" data-first-offset="true"><span data-slate-string="true">创建完数据库连接之后，会返回数据库实例 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14069"><span data-slate-object="text" data-key="14070"><span data-slate-leaf="true" data-offset-key="14070:0" data-first-offset="true"><span data-slate-string="true">db</span></span></span></span><span data-slate-object="text" data-key="14071"><span data-slate-leaf="true" data-offset-key="14071:0" data-first-offset="true"><span data-slate-string="true"> ，之后就可以调用 db 实例中的方法，完成数据库的 CURD 操作。具体操作如下，一共可以分为六个操作：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14072"><span data-slate-object="text" data-key="14073"><span data-slate-leaf="true" data-offset-key="14073:0" data-first-offset="true"><span data-slate-string="true">第一个操作，自动迁移表结构。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14074"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14075"><span data-slate-object="text" data-key="14076"><span data-slate-leaf="true" data-offset-key="14076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1. Auto migration for given models</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14077"><span data-slate-object="text" data-key="14078"><span data-slate-leaf="true" data-offset-key="14078:0" data-first-offset="true"><span data-slate-string="true">db.AutoMigrate(&amp;Product{})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14079"><span data-slate-object="text" data-key="14080"><span data-slate-leaf="true" data-offset-key="14080:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">我不建议你在正式的代码中自动迁移表结构。</span></span></span></span><span data-slate-object="text" data-key="14081"><span data-slate-leaf="true" data-offset-key="14081:0" data-first-offset="true"><span data-slate-string="true">因为变更现网数据库是一个高危操作，现网数据库字段的添加、类型变更等，都需要经过严格的评估才能实施。这里将变更隐藏在代码中，在组件发布时很难被研发人员感知到，如果组件启动，就可能会自动修改现网表结构，也可能会因此引起重大的现网事故。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14082"><span data-slate-object="text" data-key="14083"><span data-slate-leaf="true" data-offset-key="14083:0" data-first-offset="true"><span data-slate-string="true">GORM 的 AutoMigrate 方法，只对新增的字段或索引进行变更，理论上是没有风险的。在实际的 Go 项目开发中，也有很多人使用 AutoMigrate 方法自动同步表结构。但我更倾向于规范化、可感知的操作方式，所以我在实际开发中，都是手动变更表结构的。当然，具体使用哪种方法，你可以根据需要自行选择。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14084"><span data-slate-object="text" data-key="14085"><span data-slate-leaf="true" data-offset-key="14085:0" data-first-offset="true"><span data-slate-string="true">第二个操作，插入表记录。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14086"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14087"><span data-slate-object="text" data-key="14088"><span data-slate-leaf="true" data-offset-key="14088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 2. Insert the value into database</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14089"><span data-slate-object="text" data-key="14090"><span data-slate-leaf="true" data-offset-key="14090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14091"><span data-slate-leaf="true" data-offset-key="14091:0" data-first-offset="true"><span data-slate-string="true"> err := db.Create(&amp;Product{Code: </span></span></span><span data-slate-object="text" data-key="14092"><span data-slate-leaf="true" data-offset-key="14092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="14093"><span data-slate-leaf="true" data-offset-key="14093:0" data-first-offset="true"><span data-slate-string="true">, Price: </span></span></span><span data-slate-object="text" data-key="14094"><span data-slate-leaf="true" data-offset-key="14094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="14095"><span data-slate-leaf="true" data-offset-key="14095:0" data-first-offset="true"><span data-slate-string="true">}).Error; err != </span></span></span><span data-slate-object="text" data-key="14096"><span data-slate-leaf="true" data-offset-key="14096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14097"><span data-slate-leaf="true" data-offset-key="14097:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14098"><span data-slate-object="text" data-key="14099"><span data-slate-leaf="true" data-offset-key="14099:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="14100"><span data-slate-leaf="true" data-offset-key="14100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Create error: %v"</span></span></span></span><span data-slate-object="text" data-key="14101"><span data-slate-leaf="true" data-offset-key="14101:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14102"><span data-slate-object="text" data-key="14103"><span data-slate-leaf="true" data-offset-key="14103:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14104"><span data-slate-object="text" data-key="14105"><span data-slate-leaf="true" data-offset-key="14105:0" data-first-offset="true"><span data-slate-string="true">PrintProducts(db)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14106"><span data-slate-object="text" data-key="14107"><span data-slate-leaf="true" data-offset-key="14107:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14108"><span data-slate-object="text" data-key="14109"><span data-slate-leaf="true" data-offset-key="14109:0" data-first-offset="true"><span data-slate-string="true">db.Create</span></span></span></span><span data-slate-object="text" data-key="14110"><span data-slate-leaf="true" data-offset-key="14110:0" data-first-offset="true"><span data-slate-string="true"> 方法创建了一条记录。插入记录后，通过调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14111"><span data-slate-object="text" data-key="14112"><span data-slate-leaf="true" data-offset-key="14112:0" data-first-offset="true"><span data-slate-string="true">PrintProducts</span></span></span></span><span data-slate-object="text" data-key="14113"><span data-slate-leaf="true" data-offset-key="14113:0" data-first-offset="true"><span data-slate-string="true"> 方法打印当前表中的所有数据记录，来测试是否成功插入。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14114"><span data-slate-object="text" data-key="14115"><span data-slate-leaf="true" data-offset-key="14115:0" data-first-offset="true"><span data-slate-string="true">第三个操作，获取符合条件的记录。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14116"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14117"><span data-slate-object="text" data-key="14118"><span data-slate-leaf="true" data-offset-key="14118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 3. Find first record that match given conditions</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14119"><span data-slate-object="text" data-key="14120"><span data-slate-leaf="true" data-offset-key="14120:0" data-first-offset="true"><span data-slate-string="true">product := &amp;Product{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14121"><span data-slate-object="text" data-key="14122"><span data-slate-leaf="true" data-offset-key="14122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14123"><span data-slate-leaf="true" data-offset-key="14123:0" data-first-offset="true"><span data-slate-string="true"> err := db.Where(</span></span></span><span data-slate-object="text" data-key="14124"><span data-slate-leaf="true" data-offset-key="14124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code= ?"</span></span></span></span><span data-slate-object="text" data-key="14125"><span data-slate-leaf="true" data-offset-key="14125:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14126"><span data-slate-leaf="true" data-offset-key="14126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="14127"><span data-slate-leaf="true" data-offset-key="14127:0" data-first-offset="true"><span data-slate-string="true">).First(&amp;product).Error; err != </span></span></span><span data-slate-object="text" data-key="14128"><span data-slate-leaf="true" data-offset-key="14128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14129"><span data-slate-leaf="true" data-offset-key="14129:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14130"><span data-slate-object="text" data-key="14131"><span data-slate-leaf="true" data-offset-key="14131:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="14132"><span data-slate-leaf="true" data-offset-key="14132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Get product error: %v"</span></span></span></span><span data-slate-object="text" data-key="14133"><span data-slate-leaf="true" data-offset-key="14133:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14134"><span data-slate-object="text" data-key="14135"><span data-slate-leaf="true" data-offset-key="14135:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14136"><span data-slate-object="text" data-key="14137"><span data-slate-leaf="true" data-offset-key="14137:0" data-first-offset="true"><span data-slate-string="true">First 方法只会返回符合条件的记录列表中的第一条，你可以使用 First 方法来获取某个资源的详细信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14138"><span data-slate-object="text" data-key="14139"><span data-slate-leaf="true" data-offset-key="14139:0" data-first-offset="true"><span data-slate-string="true">第四个操作，更新表记录。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14140"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14141"><span data-slate-object="text" data-key="14142"><span data-slate-leaf="true" data-offset-key="14142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 4. Update value in database, if the value doesn't have primary key, will insert it</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14143"><span data-slate-object="text" data-key="14144"><span data-slate-leaf="true" data-offset-key="14144:0" data-first-offset="true"><span data-slate-string="true">product.Price = </span></span></span><span data-slate-object="text" data-key="14145"><span data-slate-leaf="true" data-offset-key="14145:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14146"><span data-slate-object="text" data-key="14147"><span data-slate-leaf="true" data-offset-key="14147:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14148"><span data-slate-leaf="true" data-offset-key="14148:0" data-first-offset="true"><span data-slate-string="true"> err := db.Save(product).Error; err != </span></span></span><span data-slate-object="text" data-key="14149"><span data-slate-leaf="true" data-offset-key="14149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14150"><span data-slate-leaf="true" data-offset-key="14150:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14151"><span data-slate-object="text" data-key="14152"><span data-slate-leaf="true" data-offset-key="14152:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="14153"><span data-slate-leaf="true" data-offset-key="14153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Update product error: %v"</span></span></span></span><span data-slate-object="text" data-key="14154"><span data-slate-leaf="true" data-offset-key="14154:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14155"><span data-slate-object="text" data-key="14156"><span data-slate-leaf="true" data-offset-key="14156:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14157"><span data-slate-object="text" data-key="14158"><span data-slate-leaf="true" data-offset-key="14158:0" data-first-offset="true"><span data-slate-string="true">PrintProducts(db)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14159"><span data-slate-object="text" data-key="14160"><span data-slate-leaf="true" data-offset-key="14160:0" data-first-offset="true"><span data-slate-string="true">通过 Save 方法，可以把 product 变量中所有跟数据库不一致的字段更新到数据库中。具体操作是：先获取某个资源的详细信息，再通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14161"><span data-slate-object="text" data-key="14162"><span data-slate-leaf="true" data-offset-key="14162:0" data-first-offset="true"><span data-slate-string="true">product.Price = 200</span></span></span></span><span data-slate-object="text" data-key="14163"><span data-slate-leaf="true" data-offset-key="14163:0" data-first-offset="true"><span data-slate-string="true"> 这类赋值语句，对其中的一些字段重新赋值。最后，调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14164"><span data-slate-object="text" data-key="14165"><span data-slate-leaf="true" data-offset-key="14165:0" data-first-offset="true"><span data-slate-string="true">Save</span></span></span></span><span data-slate-object="text" data-key="14166"><span data-slate-leaf="true" data-offset-key="14166:0" data-first-offset="true"><span data-slate-string="true"> 方法更新这些字段。你可以将这些操作看作一种更新数据库的更新模式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14167"><span data-slate-object="text" data-key="14168"><span data-slate-leaf="true" data-offset-key="14168:0" data-first-offset="true"><span data-slate-string="true">第五个操作，删除表记录。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14169"><span data-slate-object="text" data-key="14170"><span data-slate-leaf="true" data-offset-key="14170:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14171"><span data-slate-object="text" data-key="14172"><span data-slate-leaf="true" data-offset-key="14172:0" data-first-offset="true"><span data-slate-string="true">Delete</span></span></span></span><span data-slate-object="text" data-key="14173"><span data-slate-leaf="true" data-offset-key="14173:0" data-first-offset="true"><span data-slate-string="true"> 方法删除表记录，代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14174"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14175"><span data-slate-object="text" data-key="14176"><span data-slate-leaf="true" data-offset-key="14176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 5. Delete value match given conditions</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14177"><span data-slate-object="text" data-key="14178"><span data-slate-leaf="true" data-offset-key="14178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14179"><span data-slate-leaf="true" data-offset-key="14179:0" data-first-offset="true"><span data-slate-string="true"> err := db.Where(</span></span></span><span data-slate-object="text" data-key="14180"><span data-slate-leaf="true" data-offset-key="14180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code = ?"</span></span></span></span><span data-slate-object="text" data-key="14181"><span data-slate-leaf="true" data-offset-key="14181:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14182"><span data-slate-leaf="true" data-offset-key="14182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="14183"><span data-slate-leaf="true" data-offset-key="14183:0" data-first-offset="true"><span data-slate-string="true">).Delete(&amp;Product{}).Error; err != </span></span></span><span data-slate-object="text" data-key="14184"><span data-slate-leaf="true" data-offset-key="14184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14185"><span data-slate-leaf="true" data-offset-key="14185:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14186"><span data-slate-object="text" data-key="14187"><span data-slate-leaf="true" data-offset-key="14187:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="14188"><span data-slate-leaf="true" data-offset-key="14188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Delete product error: %v"</span></span></span></span><span data-slate-object="text" data-key="14189"><span data-slate-leaf="true" data-offset-key="14189:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14190"><span data-slate-object="text" data-key="14191"><span data-slate-leaf="true" data-offset-key="14191:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14192"><span data-slate-object="text" data-key="14193"><span data-slate-leaf="true" data-offset-key="14193:0" data-first-offset="true"><span data-slate-string="true">PrintProducts(db)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14194"><span data-slate-object="text" data-key="14195"><span data-slate-leaf="true" data-offset-key="14195:0" data-first-offset="true"><span data-slate-string="true">这里需要注意，因为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14196"><span data-slate-object="text" data-key="14197"><span data-slate-leaf="true" data-offset-key="14197:0" data-first-offset="true"><span data-slate-string="true">Product</span></span></span></span><span data-slate-object="text" data-key="14198"><span data-slate-leaf="true" data-offset-key="14198:0" data-first-offset="true"><span data-slate-string="true"> 中有 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14199"><span data-slate-object="text" data-key="14200"><span data-slate-leaf="true" data-offset-key="14200:0" data-first-offset="true"><span data-slate-string="true">gorm.DeletedAt</span></span></span></span><span data-slate-object="text" data-key="14201"><span data-slate-leaf="true" data-offset-key="14201:0" data-first-offset="true"><span data-slate-string="true"> 字段，所以，上述删除操作不会真正把记录从数据库表中删除掉，而是通过设置数据库 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14202"><span data-slate-object="text" data-key="14203"><span data-slate-leaf="true" data-offset-key="14203:0" data-first-offset="true"><span data-slate-string="true">product</span></span></span></span><span data-slate-object="text" data-key="14204"><span data-slate-leaf="true" data-offset-key="14204:0" data-first-offset="true"><span data-slate-string="true"> 表 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14205"><span data-slate-object="text" data-key="14206"><span data-slate-leaf="true" data-offset-key="14206:0" data-first-offset="true"><span data-slate-string="true">deletedAt</span></span></span></span><span data-slate-object="text" data-key="14207"><span data-slate-leaf="true" data-offset-key="14207:0" data-first-offset="true"><span data-slate-string="true"> 字段为当前时间的方法来删除。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14208"><span data-slate-object="text" data-key="14209"><span data-slate-leaf="true" data-offset-key="14209:0" data-first-offset="true"><span data-slate-string="true">第六个操作，获取表记录列表。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14210"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14211"><span data-slate-object="text" data-key="14212"><span data-slate-leaf="true" data-offset-key="14212:0" data-first-offset="true"><span data-slate-string="true">products := </span></span></span><span data-slate-object="text" data-key="14213"><span data-slate-leaf="true" data-offset-key="14213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="14214"><span data-slate-leaf="true" data-offset-key="14214:0" data-first-offset="true"><span data-slate-string="true">([]*Product, </span></span></span><span data-slate-object="text" data-key="14215"><span data-slate-leaf="true" data-offset-key="14215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14216"><span data-slate-leaf="true" data-offset-key="14216:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14217"><span data-slate-object="text" data-key="14218"><span data-slate-leaf="true" data-offset-key="14218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="14219"><span data-slate-leaf="true" data-offset-key="14219:0" data-first-offset="true"><span data-slate-string="true"> count </span></span></span><span data-slate-object="text" data-key="14220"><span data-slate-leaf="true" data-offset-key="14220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14221"><span data-slate-object="text" data-key="14222"><span data-slate-leaf="true" data-offset-key="14222:0" data-first-offset="true"><span data-slate-string="true">d := db.Where(</span></span></span><span data-slate-object="text" data-key="14223"><span data-slate-leaf="true" data-offset-key="14223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code like ?"</span></span></span></span><span data-slate-object="text" data-key="14224"><span data-slate-leaf="true" data-offset-key="14224:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14225"><span data-slate-leaf="true" data-offset-key="14225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%D%"</span></span></span></span><span data-slate-object="text" data-key="14226"><span data-slate-leaf="true" data-offset-key="14226:0" data-first-offset="true"><span data-slate-string="true">).Offset(</span></span></span><span data-slate-object="text" data-key="14227"><span data-slate-leaf="true" data-offset-key="14227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14228"><span data-slate-leaf="true" data-offset-key="14228:0" data-first-offset="true"><span data-slate-string="true">).Limit(</span></span></span><span data-slate-object="text" data-key="14229"><span data-slate-leaf="true" data-offset-key="14229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="14230"><span data-slate-leaf="true" data-offset-key="14230:0" data-first-offset="true"><span data-slate-string="true">).Order(</span></span></span><span data-slate-object="text" data-key="14231"><span data-slate-leaf="true" data-offset-key="14231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"id desc"</span></span></span></span><span data-slate-object="text" data-key="14232"><span data-slate-leaf="true" data-offset-key="14232:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;products).Offset(</span></span></span><span data-slate-object="text" data-key="14233"><span data-slate-leaf="true" data-offset-key="14233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="14234"><span data-slate-leaf="true" data-offset-key="14234:0" data-first-offset="true"><span data-slate-string="true">).Limit(</span></span></span><span data-slate-object="text" data-key="14235"><span data-slate-leaf="true" data-offset-key="14235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="14236"><span data-slate-leaf="true" data-offset-key="14236:0" data-first-offset="true"><span data-slate-string="true">).Count(&amp;count)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14237"><span data-slate-object="text" data-key="14238"><span data-slate-leaf="true" data-offset-key="14238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14239"><span data-slate-leaf="true" data-offset-key="14239:0" data-first-offset="true"><span data-slate-string="true"> d.Error != </span></span></span><span data-slate-object="text" data-key="14240"><span data-slate-leaf="true" data-offset-key="14240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14241"><span data-slate-leaf="true" data-offset-key="14241:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14242"><span data-slate-object="text" data-key="14243"><span data-slate-leaf="true" data-offset-key="14243:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="14244"><span data-slate-leaf="true" data-offset-key="14244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"List products error: %v"</span></span></span></span><span data-slate-object="text" data-key="14245"><span data-slate-leaf="true" data-offset-key="14245:0" data-first-offset="true"><span data-slate-string="true">, d.Error)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14246"><span data-slate-object="text" data-key="14247"><span data-slate-leaf="true" data-offset-key="14247:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14248"><span data-slate-object="text" data-key="14249"><span data-slate-leaf="true" data-offset-key="14249:0" data-first-offset="true"><span data-slate-string="true">在 PrintProducts 函数中，会打印当前的所有记录，你可以根据输出，判断数据库操作是否成功。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14250" id="sr-toc-3"><span data-slate-object="text" data-key="14251"><span data-slate-leaf="true" data-offset-key="14251:0" data-first-offset="true"><span data-slate-string="true">GORM 常用操作讲解</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14252"><span data-slate-object="text" data-key="14253"><span data-slate-leaf="true" data-offset-key="14253:0" data-first-offset="true"><span data-slate-string="true">看完上面的示例，我想你已经初步掌握了 GORM 的使用方法。接下来，我再来给你详细介绍下 GORM 所支持的数据库操作。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14254" id="sr-toc-4"><span data-slate-object="text" data-key="14255"><span data-slate-leaf="true" data-offset-key="14255:0" data-first-offset="true"><span data-slate-string="true">模型定义</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14256"><span data-slate-object="text" data-key="14257"><span data-slate-leaf="true" data-offset-key="14257:0" data-first-offset="true"><span data-slate-string="true">GORM 使用模型（Models）来映射一个数据库表。默认情况下，使用 ID 作为主键，使用结构体名的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14258"><span data-slate-object="text" data-key="14259"><span data-slate-leaf="true" data-offset-key="14259:0" data-first-offset="true"><span data-slate-string="true">snake_cases</span></span></span></span><span data-slate-object="text" data-key="14260"><span data-slate-leaf="true" data-offset-key="14260:0" data-first-offset="true"><span data-slate-string="true"> 作为表名，使用字段名的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14261"><span data-slate-object="text" data-key="14262"><span data-slate-leaf="true" data-offset-key="14262:0" data-first-offset="true"><span data-slate-string="true">snake_case</span></span></span></span><span data-slate-object="text" data-key="14263"><span data-slate-leaf="true" data-offset-key="14263:0" data-first-offset="true"><span data-slate-string="true"> 作为列名，并使用 CreatedAt、UpdatedAt、DeletedAt 字段追踪创建、更新和删除时间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14264"><span data-slate-object="text" data-key="14265"><span data-slate-leaf="true" data-offset-key="14265:0" data-first-offset="true"><span data-slate-string="true">使用 GORM 的默认规则，可以减少代码量，但我更喜欢的方式是</span></span></span><span data-slate-object="text" data-key="14266"><span data-slate-leaf="true" data-offset-key="14266:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">直接指明字段名和表名</span></span></span></span><span data-slate-object="text" data-key="14267"><span data-slate-leaf="true" data-offset-key="14267:0" data-first-offset="true"><span data-slate-string="true">。例如，有以下模型：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14268"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14269"><span data-slate-object="text" data-key="14270"><span data-slate-leaf="true" data-offset-key="14270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14271"><span data-slate-leaf="true" data-offset-key="14271:0" data-first-offset="true"><span data-slate-string="true"> Animal </span></span></span><span data-slate-object="text" data-key="14272"><span data-slate-leaf="true" data-offset-key="14272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14273"><span data-slate-leaf="true" data-offset-key="14273:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14274"><span data-slate-object="text" data-key="14275"><span data-slate-leaf="true" data-offset-key="14275:0" data-first-offset="true"><span data-slate-string="true">  AnimalID </span></span></span><span data-slate-object="text" data-key="14276"><span data-slate-leaf="true" data-offset-key="14276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14277"><span data-slate-leaf="true" data-offset-key="14277:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14278"><span data-slate-leaf="true" data-offset-key="14278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 列名 `animal_id`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14279"><span data-slate-object="text" data-key="14280"><span data-slate-leaf="true" data-offset-key="14280:0" data-first-offset="true"><span data-slate-string="true">  Birthday time.Time    </span></span></span><span data-slate-object="text" data-key="14281"><span data-slate-leaf="true" data-offset-key="14281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 列名 `birthday`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14282"><span data-slate-object="text" data-key="14283"><span data-slate-leaf="true" data-offset-key="14283:0" data-first-offset="true"><span data-slate-string="true">  Age      </span></span></span><span data-slate-object="text" data-key="14284"><span data-slate-leaf="true" data-offset-key="14284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14285"><span data-slate-leaf="true" data-offset-key="14285:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14286"><span data-slate-leaf="true" data-offset-key="14286:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 列名 `age`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14287"><span data-slate-object="text" data-key="14288"><span data-slate-leaf="true" data-offset-key="14288:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14289"><span data-slate-object="text" data-key="14290"><span data-slate-leaf="true" data-offset-key="14290:0" data-first-offset="true"><span data-slate-string="true">上述模型对应的表名为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14291"><span data-slate-object="text" data-key="14292"><span data-slate-leaf="true" data-offset-key="14292:0" data-first-offset="true"><span data-slate-string="true">animals</span></span></span></span><span data-slate-object="text" data-key="14293"><span data-slate-leaf="true" data-offset-key="14293:0" data-first-offset="true"><span data-slate-string="true"> ，列名分别为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14294"><span data-slate-object="text" data-key="14295"><span data-slate-leaf="true" data-offset-key="14295:0" data-first-offset="true"><span data-slate-string="true">animal_id</span></span></span></span><span data-slate-object="text" data-key="14296"><span data-slate-leaf="true" data-offset-key="14296:0" data-first-offset="true"><span data-slate-string="true"> 、 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14297"><span data-slate-object="text" data-key="14298"><span data-slate-leaf="true" data-offset-key="14298:0" data-first-offset="true"><span data-slate-string="true">birthday</span></span></span></span><span data-slate-object="text" data-key="14299"><span data-slate-leaf="true" data-offset-key="14299:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14300"><span data-slate-object="text" data-key="14301"><span data-slate-leaf="true" data-offset-key="14301:0" data-first-offset="true"><span data-slate-string="true">age</span></span></span></span><span data-slate-object="text" data-key="14302"><span data-slate-leaf="true" data-offset-key="14302:0" data-first-offset="true"><span data-slate-string="true"> 。我们可以通过以下方式来重命名表名和列名，并将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14303"><span data-slate-object="text" data-key="14304"><span data-slate-leaf="true" data-offset-key="14304:0" data-first-offset="true"><span data-slate-string="true">AnimalID</span></span></span></span><span data-slate-object="text" data-key="14305"><span data-slate-leaf="true" data-offset-key="14305:0" data-first-offset="true"><span data-slate-string="true"> 设置为表的主键：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14306"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14307"><span data-slate-object="text" data-key="14308"><span data-slate-leaf="true" data-offset-key="14308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14309"><span data-slate-leaf="true" data-offset-key="14309:0" data-first-offset="true"><span data-slate-string="true"> Animal </span></span></span><span data-slate-object="text" data-key="14310"><span data-slate-leaf="true" data-offset-key="14310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14311"><span data-slate-leaf="true" data-offset-key="14311:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14312"><span data-slate-object="text" data-key="14313"><span data-slate-leaf="true" data-offset-key="14313:0" data-first-offset="true"><span data-slate-string="true">    AnimalID </span></span></span><span data-slate-object="text" data-key="14314"><span data-slate-leaf="true" data-offset-key="14314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14315"><span data-slate-leaf="true" data-offset-key="14315:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="14316"><span data-slate-leaf="true" data-offset-key="14316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:animalID;primarykey"`</span></span></span></span><span data-slate-object="text" data-key="14317"><span data-slate-leaf="true" data-offset-key="14317:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14318"><span data-slate-leaf="true" data-offset-key="14318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `animalID`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14319"><span data-slate-object="text" data-key="14320"><span data-slate-leaf="true" data-offset-key="14320:0" data-first-offset="true"><span data-slate-string="true">    Birthday time.Time </span></span></span><span data-slate-object="text" data-key="14321"><span data-slate-leaf="true" data-offset-key="14321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:birthday"`</span></span></span></span><span data-slate-object="text" data-key="14322"><span data-slate-leaf="true" data-offset-key="14322:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="14323"><span data-slate-leaf="true" data-offset-key="14323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `birthday`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14324"><span data-slate-object="text" data-key="14325"><span data-slate-leaf="true" data-offset-key="14325:0" data-first-offset="true"><span data-slate-string="true">    Age      </span></span></span><span data-slate-object="text" data-key="14326"><span data-slate-leaf="true" data-offset-key="14326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14327"><span data-slate-leaf="true" data-offset-key="14327:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="14328"><span data-slate-leaf="true" data-offset-key="14328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:age"`</span></span></span></span><span data-slate-object="text" data-key="14329"><span data-slate-leaf="true" data-offset-key="14329:0" data-first-offset="true"><span data-slate-string="true">                 </span></span></span><span data-slate-object="text" data-key="14330"><span data-slate-leaf="true" data-offset-key="14330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `age`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14331"><span data-slate-object="text" data-key="14332"><span data-slate-leaf="true" data-offset-key="14332:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14333"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14334"><span data-slate-object="text" data-key="14335"><span data-slate-leaf="true" data-offset-key="14335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14336"><span data-slate-leaf="true" data-offset-key="14336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14337"><span data-slate-leaf="true" data-offset-key="14337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(a *Animal)</span></span></span></span></span><span data-slate-object="text" data-key="14338"><span data-slate-leaf="true" data-offset-key="14338:0" data-first-offset="true"><span data-slate-string="true"> TableName() </span></span></span><span data-slate-object="text" data-key="14339"><span data-slate-leaf="true" data-offset-key="14339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="14340"><span data-slate-leaf="true" data-offset-key="14340:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14341"><span data-slate-object="text" data-key="14342"><span data-slate-leaf="true" data-offset-key="14342:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14343"><span data-slate-leaf="true" data-offset-key="14343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14344"><span data-slate-leaf="true" data-offset-key="14344:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14345"><span data-slate-leaf="true" data-offset-key="14345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"animal"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14346"><span data-slate-object="text" data-key="14347"><span data-slate-leaf="true" data-offset-key="14347:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14348"><span data-slate-object="text" data-key="14349"><span data-slate-leaf="true" data-offset-key="14349:0" data-first-offset="true"><span data-slate-string="true">上面的代码中，通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14350"><span data-slate-object="text" data-key="14351"><span data-slate-leaf="true" data-offset-key="14351:0" data-first-offset="true"><span data-slate-string="true">primaryKey</span></span></span></span><span data-slate-object="text" data-key="14352"><span data-slate-leaf="true" data-offset-key="14352:0" data-first-offset="true"><span data-slate-string="true"> 标签指定主键，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14353"><span data-slate-object="text" data-key="14354"><span data-slate-leaf="true" data-offset-key="14354:0" data-first-offset="true"><span data-slate-string="true">column</span></span></span></span><span data-slate-object="text" data-key="14355"><span data-slate-leaf="true" data-offset-key="14355:0" data-first-offset="true"><span data-slate-string="true"> 标签指定列名，通过给 Models 添加 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14356"><span data-slate-object="text" data-key="14357"><span data-slate-leaf="true" data-offset-key="14357:0" data-first-offset="true"><span data-slate-string="true">TableName</span></span></span></span><span data-slate-object="text" data-key="14358"><span data-slate-leaf="true" data-offset-key="14358:0" data-first-offset="true"><span data-slate-string="true"> 方法指定表名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14359"><span data-slate-object="text" data-key="14360"><span data-slate-leaf="true" data-offset-key="14360:0" data-first-offset="true"><span data-slate-string="true">数据库表通常会包含 4 个字段。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14361"><div data-slate-type="list-line" data-slate-object="block" data-key="14362"><span data-slate-object="text" data-key="14363"><span data-slate-leaf="true" data-offset-key="14363:0" data-first-offset="true"><span data-slate-string="true">ID：自增字段，也作为主键。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14364"><span data-slate-object="text" data-key="14365"><span data-slate-leaf="true" data-offset-key="14365:0" data-first-offset="true"><span data-slate-string="true">CreatedAt：记录创建时间。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14366"><span data-slate-object="text" data-key="14367"><span data-slate-leaf="true" data-offset-key="14367:0" data-first-offset="true"><span data-slate-string="true">UpdatedAt：记录更新时间。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14368"><span data-slate-object="text" data-key="14369"><span data-slate-leaf="true" data-offset-key="14369:0" data-first-offset="true"><span data-slate-string="true">DeletedAt：记录删除时间（软删除时有用）。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14370"><span data-slate-object="text" data-key="14371"><span data-slate-leaf="true" data-offset-key="14371:0" data-first-offset="true"><span data-slate-string="true">GORM 也预定义了包含这 4 个字段的 Models，在我们定义自己的 Models 时，可以直接内嵌到结构体内，例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14372"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14373"><span data-slate-object="text" data-key="14374"><span data-slate-leaf="true" data-offset-key="14374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14375"><span data-slate-leaf="true" data-offset-key="14375:0" data-first-offset="true"><span data-slate-string="true"> Animal </span></span></span><span data-slate-object="text" data-key="14376"><span data-slate-leaf="true" data-offset-key="14376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14377"><span data-slate-leaf="true" data-offset-key="14377:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14378"><span data-slate-object="text" data-key="14379"><span data-slate-leaf="true" data-offset-key="14379:0" data-first-offset="true"><span data-slate-string="true">    gorm.Model</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14380"><span data-slate-object="text" data-key="14381"><span data-slate-leaf="true" data-offset-key="14381:0" data-first-offset="true"><span data-slate-string="true">    AnimalID </span></span></span><span data-slate-object="text" data-key="14382"><span data-slate-leaf="true" data-offset-key="14382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14383"><span data-slate-leaf="true" data-offset-key="14383:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="14384"><span data-slate-leaf="true" data-offset-key="14384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:animalID"`</span></span></span></span><span data-slate-object="text" data-key="14385"><span data-slate-leaf="true" data-offset-key="14385:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14386"><span data-slate-leaf="true" data-offset-key="14386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `animalID`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14387"><span data-slate-object="text" data-key="14388"><span data-slate-leaf="true" data-offset-key="14388:0" data-first-offset="true"><span data-slate-string="true">    Birthday time.Time </span></span></span><span data-slate-object="text" data-key="14389"><span data-slate-leaf="true" data-offset-key="14389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:birthday"`</span></span></span></span><span data-slate-object="text" data-key="14390"><span data-slate-leaf="true" data-offset-key="14390:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14391"><span data-slate-leaf="true" data-offset-key="14391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `birthday`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14392"><span data-slate-object="text" data-key="14393"><span data-slate-leaf="true" data-offset-key="14393:0" data-first-offset="true"><span data-slate-string="true">    Age      </span></span></span><span data-slate-object="text" data-key="14394"><span data-slate-leaf="true" data-offset-key="14394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14395"><span data-slate-leaf="true" data-offset-key="14395:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="14396"><span data-slate-leaf="true" data-offset-key="14396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:age"`</span></span></span></span><span data-slate-object="text" data-key="14397"><span data-slate-leaf="true" data-offset-key="14397:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="14398"><span data-slate-leaf="true" data-offset-key="14398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列名设为 `age`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14399"><span data-slate-object="text" data-key="14400"><span data-slate-leaf="true" data-offset-key="14400:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14401"><span data-slate-object="text" data-key="14402"><span data-slate-leaf="true" data-offset-key="14402:0" data-first-offset="true"><span data-slate-string="true">Models 中的字段能支持很多 GORM 标签，但如果我们不使用 GORM 自动创建表和迁移表结构的功能，很多标签我们实际上是用不到的。在开发中，用得最多的是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14403"><span data-slate-object="text" data-key="14404"><span data-slate-leaf="true" data-offset-key="14404:0" data-first-offset="true"><span data-slate-string="true">column</span></span></span></span><span data-slate-object="text" data-key="14405"><span data-slate-leaf="true" data-offset-key="14405:0" data-first-offset="true"><span data-slate-string="true"> 标签。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14406" id="sr-toc-5"><span data-slate-object="text" data-key="14407"><span data-slate-leaf="true" data-offset-key="14407:0" data-first-offset="true"><span data-slate-string="true">连接数据库</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14408"><span data-slate-object="text" data-key="14409"><span data-slate-leaf="true" data-offset-key="14409:0" data-first-offset="true"><span data-slate-string="true">在进行数据库的 CURD 操作之前，我们首先需要连接数据库。你可以通过以下代码连接 MySQL 数据库：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14410"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14411"><span data-slate-object="text" data-key="14412"><span data-slate-leaf="true" data-offset-key="14412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="14413"><span data-slate-leaf="true" data-offset-key="14413:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14414"><span data-slate-object="text" data-key="14415"><span data-slate-leaf="true" data-offset-key="14415:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="14416"><span data-slate-leaf="true" data-offset-key="14416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"gorm.io/driver/mysql"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14417"><span data-slate-object="text" data-key="14418"><span data-slate-leaf="true" data-offset-key="14418:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="14419"><span data-slate-leaf="true" data-offset-key="14419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"gorm.io/gorm"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14420"><span data-slate-object="text" data-key="14421"><span data-slate-leaf="true" data-offset-key="14421:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14422"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14423"><span data-slate-object="text" data-key="14424"><span data-slate-leaf="true" data-offset-key="14424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14425"><span data-slate-leaf="true" data-offset-key="14425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14426"><span data-slate-leaf="true" data-offset-key="14426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="14427"><span data-slate-leaf="true" data-offset-key="14427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="14428"><span data-slate-leaf="true" data-offset-key="14428:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14429"><span data-slate-object="text" data-key="14430"><span data-slate-leaf="true" data-offset-key="14430:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="14431"><span data-slate-leaf="true" data-offset-key="14431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14432"><span data-slate-object="text" data-key="14433"><span data-slate-leaf="true" data-offset-key="14433:0" data-first-offset="true"><span data-slate-string="true">  dsn := </span></span></span><span data-slate-object="text" data-key="14434"><span data-slate-leaf="true" data-offset-key="14434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14435"><span data-slate-object="text" data-key="14436"><span data-slate-leaf="true" data-offset-key="14436:0" data-first-offset="true"><span data-slate-string="true">  db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14437"><span data-slate-object="text" data-key="14438"><span data-slate-leaf="true" data-offset-key="14438:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14439"><span data-slate-object="text" data-key="14440"><span data-slate-leaf="true" data-offset-key="14440:0" data-first-offset="true"><span data-slate-string="true">如果需要 GORM 正确地处理 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14441"><span data-slate-object="text" data-key="14442"><span data-slate-leaf="true" data-offset-key="14442:0" data-first-offset="true"><span data-slate-string="true">time.Time</span></span></span></span><span data-slate-object="text" data-key="14443"><span data-slate-leaf="true" data-offset-key="14443:0" data-first-offset="true"><span data-slate-string="true"> 类型，在连接数据库时需要带上 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14444"><span data-slate-object="text" data-key="14445"><span data-slate-leaf="true" data-offset-key="14445:0" data-first-offset="true"><span data-slate-string="true">parseTime</span></span></span></span><span data-slate-object="text" data-key="14446"><span data-slate-leaf="true" data-offset-key="14446:0" data-first-offset="true"><span data-slate-string="true"> 参数。如果要支持完整的 UTF-8 编码，可将</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14447"><span data-slate-object="text" data-key="14448"><span data-slate-leaf="true" data-offset-key="14448:0" data-first-offset="true"><span data-slate-string="true"> charset=utf8</span></span></span></span><span data-slate-object="text" data-key="14449"><span data-slate-leaf="true" data-offset-key="14449:0" data-first-offset="true"><span data-slate-string="true"> 更改为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14450"><span data-slate-object="text" data-key="14451"><span data-slate-leaf="true" data-offset-key="14451:0" data-first-offset="true"><span data-slate-string="true"> charset=utf8mb4</span></span></span></span><span data-slate-object="text" data-key="14452"><span data-slate-leaf="true" data-offset-key="14452:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14453"><span data-slate-object="text" data-key="14454"><span data-slate-leaf="true" data-offset-key="14454:0" data-first-offset="true"><span data-slate-string="true">GORM 支持连接池，底层是用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14455"><span data-slate-object="text" data-key="14456"><span data-slate-leaf="true" data-offset-key="14456:0" data-first-offset="true"><span data-slate-string="true">database/sql</span></span></span></span><span data-slate-object="text" data-key="14457"><span data-slate-leaf="true" data-offset-key="14457:0" data-first-offset="true"><span data-slate-string="true"> 包来维护连接池的，连接池设置如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14458"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14459"><span data-slate-object="text" data-key="14460"><span data-slate-leaf="true" data-offset-key="14460:0" data-first-offset="true"><span data-slate-string="true">sqlDB, err := db.DB()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14461"><span data-slate-object="text" data-key="14462"><span data-slate-leaf="true" data-offset-key="14462:0" data-first-offset="true"><span data-slate-string="true">sqlDB.SetMaxIdleConns(</span></span></span><span data-slate-object="text" data-key="14463"><span data-slate-leaf="true" data-offset-key="14463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="14464"><span data-slate-leaf="true" data-offset-key="14464:0" data-first-offset="true"><span data-slate-string="true">)              </span></span></span><span data-slate-object="text" data-key="14465"><span data-slate-leaf="true" data-offset-key="14465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 MySQL 的最大空闲连接数（推荐 100）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14466"><span data-slate-object="text" data-key="14467"><span data-slate-leaf="true" data-offset-key="14467:0" data-first-offset="true"><span data-slate-string="true">sqlDB.SetMaxOpenConns(</span></span></span><span data-slate-object="text" data-key="14468"><span data-slate-leaf="true" data-offset-key="14468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="14469"><span data-slate-leaf="true" data-offset-key="14469:0" data-first-offset="true"><span data-slate-string="true">)             </span></span></span><span data-slate-object="text" data-key="14470"><span data-slate-leaf="true" data-offset-key="14470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 MySQL 的最大连接数（推荐 100）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14471"><span data-slate-object="text" data-key="14472"><span data-slate-leaf="true" data-offset-key="14472:0" data-first-offset="true"><span data-slate-string="true">sqlDB.SetConnMaxLifetime(time.Hour)    </span></span></span><span data-slate-object="text" data-key="14473"><span data-slate-leaf="true" data-offset-key="14473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 MySQL 的空闲连接最大存活时间（推荐 10s）</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14474"><span data-slate-object="text" data-key="14475"><span data-slate-leaf="true" data-offset-key="14475:0" data-first-offset="true"><span data-slate-string="true">上面这些设置，也可以应用在大型后端项目中。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14476" id="sr-toc-6"><span data-slate-object="text" data-key="14477"><span data-slate-leaf="true" data-offset-key="14477:0" data-first-offset="true"><span data-slate-string="true">创建记录</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14478"><span data-slate-object="text" data-key="14479"><span data-slate-leaf="true" data-offset-key="14479:0" data-first-offset="true"><span data-slate-string="true">我们可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14480"><span data-slate-object="text" data-key="14481"><span data-slate-leaf="true" data-offset-key="14481:0" data-first-offset="true"><span data-slate-string="true">db.Create</span></span></span></span><span data-slate-object="text" data-key="14482"><span data-slate-leaf="true" data-offset-key="14482:0" data-first-offset="true"><span data-slate-string="true"> 方法来创建一条记录：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14483"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14484"><span data-slate-object="text" data-key="14485"><span data-slate-leaf="true" data-offset-key="14485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14486"><span data-slate-leaf="true" data-offset-key="14486:0" data-first-offset="true"><span data-slate-string="true"> User </span></span></span><span data-slate-object="text" data-key="14487"><span data-slate-leaf="true" data-offset-key="14487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14488"><span data-slate-leaf="true" data-offset-key="14488:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14489"><span data-slate-object="text" data-key="14490"><span data-slate-leaf="true" data-offset-key="14490:0" data-first-offset="true"><span data-slate-string="true">  gorm.Model</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14491"><span data-slate-object="text" data-key="14492"><span data-slate-leaf="true" data-offset-key="14492:0" data-first-offset="true"><span data-slate-string="true">  Name         </span></span></span><span data-slate-object="text" data-key="14493"><span data-slate-leaf="true" data-offset-key="14493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14494"><span data-slate-object="text" data-key="14495"><span data-slate-leaf="true" data-offset-key="14495:0" data-first-offset="true"><span data-slate-string="true">  Age          </span></span></span><span data-slate-object="text" data-key="14496"><span data-slate-leaf="true" data-offset-key="14496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint8</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14497"><span data-slate-object="text" data-key="14498"><span data-slate-leaf="true" data-offset-key="14498:0" data-first-offset="true"><span data-slate-string="true">  Birthday     *time.Time</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14499"><span data-slate-object="text" data-key="14500"><span data-slate-leaf="true" data-offset-key="14500:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14501"><span data-slate-object="text" data-key="14502"><span data-slate-leaf="true" data-offset-key="14502:0" data-first-offset="true"><span data-slate-string="true">user := User{Name: </span></span></span><span data-slate-object="text" data-key="14503"><span data-slate-leaf="true" data-offset-key="14503:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Jinzhu"</span></span></span></span><span data-slate-object="text" data-key="14504"><span data-slate-leaf="true" data-offset-key="14504:0" data-first-offset="true"><span data-slate-string="true">, Age: </span></span></span><span data-slate-object="text" data-key="14505"><span data-slate-leaf="true" data-offset-key="14505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">18</span></span></span></span><span data-slate-object="text" data-key="14506"><span data-slate-leaf="true" data-offset-key="14506:0" data-first-offset="true"><span data-slate-string="true">, Birthday: time.Now()}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14507"><span data-slate-object="text" data-key="14508"><span data-slate-leaf="true" data-offset-key="14508:0" data-first-offset="true"><span data-slate-string="true">result := db.Create(&amp;user) </span></span></span><span data-slate-object="text" data-key="14509"><span data-slate-leaf="true" data-offset-key="14509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 通过数据的指针来创建</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14510"><span data-slate-object="text" data-key="14511"><span data-slate-leaf="true" data-offset-key="14511:0" data-first-offset="true"><span data-slate-string="true">db.Create 函数会返回如下 3 个值：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14512"><div data-slate-type="list-line" data-slate-object="block" data-key="14513"><span data-slate-object="text" data-key="14514"><span data-slate-leaf="true" data-offset-key="14514:0" data-first-offset="true"><span data-slate-string="true">user.ID：返回插入数据的主键，这个是直接赋值给 user 变量。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14515"><span data-slate-object="text" data-key="14516"><span data-slate-leaf="true" data-offset-key="14516:0" data-first-offset="true"><span data-slate-string="true">result.Error：返回 error。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14517"><span data-slate-object="text" data-key="14518"><span data-slate-leaf="true" data-offset-key="14518:0" data-first-offset="true"><span data-slate-string="true">result.RowsAffected：返回插入记录的条数。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14519"><span data-slate-object="text" data-key="14520"><span data-slate-leaf="true" data-offset-key="14520:0" data-first-offset="true"><span data-slate-string="true">当需要插入的数据量比较大时，可以批量插入，以提高插入性能：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14521"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14522"><span data-slate-object="text" data-key="14523"><span data-slate-leaf="true" data-offset-key="14523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="14524"><span data-slate-leaf="true" data-offset-key="14524:0" data-first-offset="true"><span data-slate-string="true"> users = []User{{Name: </span></span></span><span data-slate-object="text" data-key="14525"><span data-slate-leaf="true" data-offset-key="14525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu1"</span></span></span></span><span data-slate-object="text" data-key="14526"><span data-slate-leaf="true" data-offset-key="14526:0" data-first-offset="true"><span data-slate-string="true">}, {Name: </span></span></span><span data-slate-object="text" data-key="14527"><span data-slate-leaf="true" data-offset-key="14527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu2"</span></span></span></span><span data-slate-object="text" data-key="14528"><span data-slate-leaf="true" data-offset-key="14528:0" data-first-offset="true"><span data-slate-string="true">}, {Name: </span></span></span><span data-slate-object="text" data-key="14529"><span data-slate-leaf="true" data-offset-key="14529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu3"</span></span></span></span><span data-slate-object="text" data-key="14530"><span data-slate-leaf="true" data-offset-key="14530:0" data-first-offset="true"><span data-slate-string="true">}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14531"><span data-slate-object="text" data-key="14532"><span data-slate-leaf="true" data-offset-key="14532:0" data-first-offset="true"><span data-slate-string="true">DB.Create(&amp;users)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14533"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14534"><span data-slate-object="text" data-key="14535"><span data-slate-leaf="true" data-offset-key="14535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="14536"><span data-slate-leaf="true" data-offset-key="14536:0" data-first-offset="true"><span data-slate-string="true"> _, user := </span></span></span><span data-slate-object="text" data-key="14537"><span data-slate-leaf="true" data-offset-key="14537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="14538"><span data-slate-leaf="true" data-offset-key="14538:0" data-first-offset="true"><span data-slate-string="true"> users {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14539"><span data-slate-object="text" data-key="14540"><span data-slate-leaf="true" data-offset-key="14540:0" data-first-offset="true"><span data-slate-string="true">  user.ID </span></span></span><span data-slate-object="text" data-key="14541"><span data-slate-leaf="true" data-offset-key="14541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1,2,3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14542"><span data-slate-object="text" data-key="14543"><span data-slate-leaf="true" data-offset-key="14543:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14544" id="sr-toc-7"><span data-slate-object="text" data-key="14545"><span data-slate-leaf="true" data-offset-key="14545:0" data-first-offset="true"><span data-slate-string="true">删除记录</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14546"><span data-slate-object="text" data-key="14547"><span data-slate-leaf="true" data-offset-key="14547:0" data-first-offset="true"><span data-slate-string="true">我们可以通过 Delete 方法删除记录：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14548"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14549"><span data-slate-object="text" data-key="14550"><span data-slate-leaf="true" data-offset-key="14550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// DELETE from users where id = 10 AND name = "jinzhu";</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14551"><span data-slate-object="text" data-key="14552"><span data-slate-leaf="true" data-offset-key="14552:0" data-first-offset="true"><span data-slate-string="true">db.Where(</span></span></span><span data-slate-object="text" data-key="14553"><span data-slate-leaf="true" data-offset-key="14553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name = ?"</span></span></span></span><span data-slate-object="text" data-key="14554"><span data-slate-leaf="true" data-offset-key="14554:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14555"><span data-slate-leaf="true" data-offset-key="14555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu"</span></span></span></span><span data-slate-object="text" data-key="14556"><span data-slate-leaf="true" data-offset-key="14556:0" data-first-offset="true"><span data-slate-string="true">).Delete(&amp;user)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14557"><span data-slate-object="text" data-key="14558"><span data-slate-leaf="true" data-offset-key="14558:0" data-first-offset="true"><span data-slate-string="true">GORM 也支持根据主键进行删除，例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14559"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14560"><span data-slate-object="text" data-key="14561"><span data-slate-leaf="true" data-offset-key="14561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// DELETE FROM users WHERE id = 10;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14562"><span data-slate-object="text" data-key="14563"><span data-slate-leaf="true" data-offset-key="14563:0" data-first-offset="true"><span data-slate-string="true">db.Delete(&amp;User{}, </span></span></span><span data-slate-object="text" data-key="14564"><span data-slate-leaf="true" data-offset-key="14564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="14565"><span data-slate-leaf="true" data-offset-key="14565:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14566"><span data-slate-object="text" data-key="14567"><span data-slate-leaf="true" data-offset-key="14567:0" data-first-offset="true"><span data-slate-string="true">不过，我更喜欢使用 db.Where 的方式进行删除，这种方式有两个优点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14568"><span data-slate-object="text" data-key="14569"><span data-slate-leaf="true" data-offset-key="14569:0" data-first-offset="true"><span data-slate-string="true">第一个优点是删除方式更通用。使用 db.Where 不仅可以根据主键删除，还能够随意组合条件进行删除。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14570"><span data-slate-object="text" data-key="14571"><span data-slate-leaf="true" data-offset-key="14571:0" data-first-offset="true"><span data-slate-string="true">第二个优点是删除方式更显式，这意味着更易读。如果使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14572"><span data-slate-object="text" data-key="14573"><span data-slate-leaf="true" data-offset-key="14573:0" data-first-offset="true"><span data-slate-string="true"> db.Delete(&amp;User{}, 10)</span></span></span></span><span data-slate-object="text" data-key="14574"><span data-slate-leaf="true" data-offset-key="14574:0" data-first-offset="true"><span data-slate-string="true">，你还需要确认 User 的主键，如果记错了主键，还可能会引入 Bug。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14575"><span data-slate-object="text" data-key="14576"><span data-slate-leaf="true" data-offset-key="14576:0" data-first-offset="true"><span data-slate-string="true">此外，GORM 也支持批量删除：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14577"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14578"><span data-slate-object="text" data-key="14579"><span data-slate-leaf="true" data-offset-key="14579:0" data-first-offset="true"><span data-slate-string="true">db.Where(</span></span></span><span data-slate-object="text" data-key="14580"><span data-slate-leaf="true" data-offset-key="14580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name in (?)"</span></span></span></span><span data-slate-object="text" data-key="14581"><span data-slate-leaf="true" data-offset-key="14581:0" data-first-offset="true"><span data-slate-string="true">, []</span></span></span><span data-slate-object="text" data-key="14582"><span data-slate-leaf="true" data-offset-key="14582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="14583"><span data-slate-leaf="true" data-offset-key="14583:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="14584"><span data-slate-leaf="true" data-offset-key="14584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu"</span></span></span></span><span data-slate-object="text" data-key="14585"><span data-slate-leaf="true" data-offset-key="14585:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14586"><span data-slate-leaf="true" data-offset-key="14586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="14587"><span data-slate-leaf="true" data-offset-key="14587:0" data-first-offset="true"><span data-slate-string="true">}).Delete(&amp;User{})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14588"><span data-slate-object="text" data-key="14589"><span data-slate-leaf="true" data-offset-key="14589:0" data-first-offset="true"><span data-slate-string="true">GORM 支持两种删除方法：软删除和永久删除。下面我来分别介绍下。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14590"><div data-slate-type="list-line" data-slate-object="block" data-key="14591"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14592"><span data-slate-leaf="true" data-offset-key="14592:0" data-first-offset="true"><span data-slate-string="true">软删除</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14593"><span data-slate-object="text" data-key="14594"><span data-slate-leaf="true" data-offset-key="14594:0" data-first-offset="true"><span data-slate-string="true">软删除是指执行 Delete 时，记录不会被从数据库中真正删除。GORM 会将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14595"><span data-slate-object="text" data-key="14596"><span data-slate-leaf="true" data-offset-key="14596:0" data-first-offset="true"><span data-slate-string="true">DeletedAt</span></span></span></span><span data-slate-object="text" data-key="14597"><span data-slate-leaf="true" data-offset-key="14597:0" data-first-offset="true"><span data-slate-string="true"> 设置为当前时间，并且不能通过正常的方式查询到该记录。如果模型包含了一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14598"><span data-slate-object="text" data-key="14599"><span data-slate-leaf="true" data-offset-key="14599:0" data-first-offset="true"><span data-slate-string="true">gorm.DeletedAt</span></span></span></span><span data-slate-object="text" data-key="14600"><span data-slate-leaf="true" data-offset-key="14600:0" data-first-offset="true"><span data-slate-string="true"> 字段，GORM 在执行删除操作时，会软删除该记录。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14601"><span data-slate-object="text" data-key="14602"><span data-slate-leaf="true" data-offset-key="14602:0" data-first-offset="true"><span data-slate-string="true">下面的删除方法就是一个软删除：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14603"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14604"><span data-slate-object="text" data-key="14605"><span data-slate-leaf="true" data-offset-key="14605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// UPDATE users SET deleted_at="2013-10-29 10:23" WHERE age = 20;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14606"><span data-slate-object="text" data-key="14607"><span data-slate-leaf="true" data-offset-key="14607:0" data-first-offset="true"><span data-slate-string="true">db.Where(</span></span></span><span data-slate-object="text" data-key="14608"><span data-slate-leaf="true" data-offset-key="14608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age = ?"</span></span></span></span><span data-slate-object="text" data-key="14609"><span data-slate-leaf="true" data-offset-key="14609:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14610"><span data-slate-leaf="true" data-offset-key="14610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">20</span></span></span></span><span data-slate-object="text" data-key="14611"><span data-slate-leaf="true" data-offset-key="14611:0" data-first-offset="true"><span data-slate-string="true">).Delete(&amp;User{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14612"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14613"><span data-slate-object="text" data-key="14614"><span data-slate-leaf="true" data-offset-key="14614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14615"><span data-slate-object="text" data-key="14616"><span data-slate-leaf="true" data-offset-key="14616:0" data-first-offset="true"><span data-slate-string="true">db.Where(</span></span></span><span data-slate-object="text" data-key="14617"><span data-slate-leaf="true" data-offset-key="14617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age = 20"</span></span></span></span><span data-slate-object="text" data-key="14618"><span data-slate-leaf="true" data-offset-key="14618:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;user)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14619"><span data-slate-object="text" data-key="14620"><span data-slate-leaf="true" data-offset-key="14620:0" data-first-offset="true"><span data-slate-string="true">可以看到，GORM 并没有真正把记录从数据库删除掉，而是只更新了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14621"><span data-slate-object="text" data-key="14622"><span data-slate-leaf="true" data-offset-key="14622:0" data-first-offset="true"><span data-slate-string="true">deleted_at</span></span></span></span><span data-slate-object="text" data-key="14623"><span data-slate-leaf="true" data-offset-key="14623:0" data-first-offset="true"><span data-slate-string="true"> 字段。在查询时，GORM 查询条件中新增了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14624"><span data-slate-object="text" data-key="14625"><span data-slate-leaf="true" data-offset-key="14625:0" data-first-offset="true"><span data-slate-string="true"> AND deleted_at IS NULL</span></span></span></span><span data-slate-object="text" data-key="14626"><span data-slate-leaf="true" data-offset-key="14626:0" data-first-offset="true"><span data-slate-string="true"> 条件，所以这些被设置过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14627"><span data-slate-object="text" data-key="14628"><span data-slate-leaf="true" data-offset-key="14628:0" data-first-offset="true"><span data-slate-string="true">deleted_at</span></span></span></span><span data-slate-object="text" data-key="14629"><span data-slate-leaf="true" data-offset-key="14629:0" data-first-offset="true"><span data-slate-string="true"> 字段的记录不会被查询到。对于一些比较重要的数据，我们可以通过软删除的方式删除记录，软删除可以使这些重要的数据后期能够被恢复，并且便于以后的排障。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14630"><span data-slate-object="text" data-key="14631"><span data-slate-leaf="true" data-offset-key="14631:0" data-first-offset="true"><span data-slate-string="true">我们可以通过下面的方式查找被软删除的记录：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14632"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14633"><span data-slate-object="text" data-key="14634"><span data-slate-leaf="true" data-offset-key="14634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users WHERE age = 20;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14635"><span data-slate-object="text" data-key="14636"><span data-slate-leaf="true" data-offset-key="14636:0" data-first-offset="true"><span data-slate-string="true">db.Unscoped().Where(</span></span></span><span data-slate-object="text" data-key="14637"><span data-slate-leaf="true" data-offset-key="14637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age = 20"</span></span></span></span><span data-slate-object="text" data-key="14638"><span data-slate-leaf="true" data-offset-key="14638:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;users)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="14639"><div data-slate-type="list-line" data-slate-object="block" data-key="14640"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14641"><span data-slate-leaf="true" data-offset-key="14641:0" data-first-offset="true"><span data-slate-string="true">永久删除</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14642"><span data-slate-object="text" data-key="14643"><span data-slate-leaf="true" data-offset-key="14643:0" data-first-offset="true"><span data-slate-string="true">如果想永久删除一条记录，可以使用 Unscoped：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14644"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14645"><span data-slate-object="text" data-key="14646"><span data-slate-leaf="true" data-offset-key="14646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// DELETE FROM orders WHERE id=10;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14647"><span data-slate-object="text" data-key="14648"><span data-slate-leaf="true" data-offset-key="14648:0" data-first-offset="true"><span data-slate-string="true">db.Unscoped().Delete(&amp;order)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14649"><span data-slate-object="text" data-key="14650"><span data-slate-leaf="true" data-offset-key="14650:0" data-first-offset="true"><span data-slate-string="true">或者，你也可以在模型中去掉 gorm.DeletedAt。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14651" id="sr-toc-8"><span data-slate-object="text" data-key="14652"><span data-slate-leaf="true" data-offset-key="14652:0" data-first-offset="true"><span data-slate-string="true">更新记录</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14653"><span data-slate-object="text" data-key="14654"><span data-slate-leaf="true" data-offset-key="14654:0" data-first-offset="true"><span data-slate-string="true">GORM 中，最常用的更新方法如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14655"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14656"><span data-slate-object="text" data-key="14657"><span data-slate-leaf="true" data-offset-key="14657:0" data-first-offset="true"><span data-slate-string="true">db.First(&amp;user)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14658"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14659"><span data-slate-object="text" data-key="14660"><span data-slate-leaf="true" data-offset-key="14660:0" data-first-offset="true"><span data-slate-string="true">user.Name = </span></span></span><span data-slate-object="text" data-key="14661"><span data-slate-leaf="true" data-offset-key="14661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu 2"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14662"><span data-slate-object="text" data-key="14663"><span data-slate-leaf="true" data-offset-key="14663:0" data-first-offset="true"><span data-slate-string="true">user.Age = </span></span></span><span data-slate-object="text" data-key="14664"><span data-slate-leaf="true" data-offset-key="14664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14665"><span data-slate-object="text" data-key="14666"><span data-slate-leaf="true" data-offset-key="14666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// UPDATE users SET name='jinzhu 2', age=100, birthday='2016-01-01', updated_at = '2013-11-17 21:34:10' WHERE id=111;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14667"><span data-slate-object="text" data-key="14668"><span data-slate-leaf="true" data-offset-key="14668:0" data-first-offset="true"><span data-slate-string="true">db.Save(&amp;user)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14669"><span data-slate-object="text" data-key="14670"><span data-slate-leaf="true" data-offset-key="14670:0" data-first-offset="true"><span data-slate-string="true">上述方法会保留所有字段，所以执行 Save 时，需要先执行 First，获取某个记录的所有列的值，然后再对需要更新的字段设置值。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14671"><span data-slate-object="text" data-key="14672"><span data-slate-leaf="true" data-offset-key="14672:0" data-first-offset="true"><span data-slate-string="true">还可以指定更新单个列：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14673"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14674"><span data-slate-object="text" data-key="14675"><span data-slate-leaf="true" data-offset-key="14675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// UPDATE users SET age=200, updated_at='2013-11-17 21:34:10' WHERE name='colin';</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14676"><span data-slate-object="text" data-key="14677"><span data-slate-leaf="true" data-offset-key="14677:0" data-first-offset="true"><span data-slate-string="true">db.Model(&amp;User{}).Where(</span></span></span><span data-slate-object="text" data-key="14678"><span data-slate-leaf="true" data-offset-key="14678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name = ?"</span></span></span></span><span data-slate-object="text" data-key="14679"><span data-slate-leaf="true" data-offset-key="14679:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14680"><span data-slate-leaf="true" data-offset-key="14680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="14681"><span data-slate-leaf="true" data-offset-key="14681:0" data-first-offset="true"><span data-slate-string="true">).Update(</span></span></span><span data-slate-object="text" data-key="14682"><span data-slate-leaf="true" data-offset-key="14682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age"</span></span></span></span><span data-slate-object="text" data-key="14683"><span data-slate-leaf="true" data-offset-key="14683:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14684"><span data-slate-leaf="true" data-offset-key="14684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span><span data-slate-object="text" data-key="14685"><span data-slate-leaf="true" data-offset-key="14685:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14686"><span data-slate-object="text" data-key="14687"><span data-slate-leaf="true" data-offset-key="14687:0" data-first-offset="true"><span data-slate-string="true">也可以指定更新多个列：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14688"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14689"><span data-slate-object="text" data-key="14690"><span data-slate-leaf="true" data-offset-key="14690:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d4f5062c" data-attr-id="27030" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE name = 'colin';</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14691"><span data-slate-object="text" data-key="14692"><span data-slate-leaf="true" data-offset-key="14692:0" data-first-offset="true"><span data-slate-string="true">db.Model(&amp;user).Where(</span></span></span><span data-slate-object="text" data-key="14693"><span data-slate-leaf="true" data-offset-key="14693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="14694"><span data-slate-leaf="true" data-offset-key="14694:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14695"><span data-slate-leaf="true" data-offset-key="14695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="14696"><span data-slate-leaf="true" data-offset-key="14696:0" data-first-offset="true"><span data-slate-string="true">).Updates(User{Name: </span></span></span><span data-slate-object="text" data-key="14697"><span data-slate-leaf="true" data-offset-key="14697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hello"</span></span></span></span><span data-slate-object="text" data-key="14698"><span data-slate-leaf="true" data-offset-key="14698:0" data-first-offset="true"><span data-slate-string="true">, Age: </span></span></span><span data-slate-object="text" data-key="14699"><span data-slate-leaf="true" data-offset-key="14699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">18</span></span></span></span><span data-slate-object="text" data-key="14700"><span data-slate-leaf="true" data-offset-key="14700:0" data-first-offset="true"><span data-slate-string="true">, Active: </span></span></span><span data-slate-object="text" data-key="14701"><span data-slate-leaf="true" data-offset-key="14701:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="14702"><span data-slate-leaf="true" data-offset-key="14702:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14703"><span data-slate-object="text" data-key="14704"><span data-slate-leaf="true" data-offset-key="14704:0" data-first-offset="true"><span data-slate-string="true">这里要注意，这个方法只会更新非零值的字段。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14705" id="sr-toc-9"><span data-slate-object="text" data-key="14706"><span data-slate-leaf="true" data-offset-key="14706:0" data-first-offset="true"><span data-slate-string="true">查询数据</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14707"><span data-slate-object="text" data-key="14708"><span data-slate-leaf="true" data-offset-key="14708:0" data-first-offset="true"><span data-slate-string="true">GORM 支持不同的查询方法，下面我来讲解三种在开发中经常用到的查询方式，分别是检索单个记录、查询所有符合条件的记录和智能选择字段。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14709"><div data-slate-type="list-line" data-slate-object="block" data-key="14710"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14711"><span data-slate-leaf="true" data-offset-key="14711:0" data-first-offset="true"><span data-slate-string="true">检索单个记录</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14712"><span data-slate-object="text" data-key="14713"><span data-slate-leaf="true" data-offset-key="14713:0" data-first-offset="true"><span data-slate-string="true">下面是检索单个记录的示例代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14714"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14715"><span data-slate-object="text" data-key="14716"><span data-slate-leaf="true" data-offset-key="14716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取第一条记录（主键升序）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14717"><span data-slate-object="text" data-key="14718"><span data-slate-leaf="true" data-offset-key="14718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users ORDER BY id LIMIT 1;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14719"><span data-slate-object="text" data-key="14720"><span data-slate-leaf="true" data-offset-key="14720:0" data-first-offset="true"><span data-slate-string="true">db.First(&amp;user)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14721"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14722"><span data-slate-object="text" data-key="14723"><span data-slate-leaf="true" data-offset-key="14723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取最后一条记录（主键降序）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14724"><span data-slate-object="text" data-key="14725"><span data-slate-leaf="true" data-offset-key="14725:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users ORDER BY id DESC LIMIT 1;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14726"><span data-slate-object="text" data-key="14727"><span data-slate-leaf="true" data-offset-key="14727:0" data-first-offset="true"><span data-slate-string="true">db.Last(&amp;user)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14728"><span data-slate-object="text" data-key="14729"><span data-slate-leaf="true" data-offset-key="14729:0" data-first-offset="true"><span data-slate-string="true">result := db.First(&amp;user)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14730"><span data-slate-object="text" data-key="14731"><span data-slate-leaf="true" data-offset-key="14731:0" data-first-offset="true"><span data-slate-string="true">result.RowsAffected </span></span></span><span data-slate-object="text" data-key="14732"><span data-slate-leaf="true" data-offset-key="14732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 返回找到的记录数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14733"><span data-slate-object="text" data-key="14734"><span data-slate-leaf="true" data-offset-key="14734:0" data-first-offset="true"><span data-slate-string="true">result.Error        </span></span></span><span data-slate-object="text" data-key="14735"><span data-slate-leaf="true" data-offset-key="14735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// returns error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14736"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14737"><span data-slate-object="text" data-key="14738"><span data-slate-leaf="true" data-offset-key="14738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查 ErrRecordNotFound 错误</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14739"><span data-slate-object="text" data-key="14740"><span data-slate-leaf="true" data-offset-key="14740:0" data-first-offset="true"><span data-slate-string="true">errors.Is(result.Error, gorm.ErrRecordNotFound)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14741"><span data-slate-object="text" data-key="14742"><span data-slate-leaf="true" data-offset-key="14742:0" data-first-offset="true"><span data-slate-string="true">如果 model 类型没有定义主键，则按第一个字段排序。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14743"><div data-slate-type="list-line" data-slate-object="block" data-key="14744"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14745"><span data-slate-leaf="true" data-offset-key="14745:0" data-first-offset="true"><span data-slate-string="true">查询所有符合条件的记录</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14746"><span data-slate-object="text" data-key="14747"><span data-slate-leaf="true" data-offset-key="14747:0" data-first-offset="true"><span data-slate-string="true">示例代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14748"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14749"><span data-slate-object="text" data-key="14750"><span data-slate-leaf="true" data-offset-key="14750:0" data-first-offset="true"><span data-slate-string="true">users := </span></span></span><span data-slate-object="text" data-key="14751"><span data-slate-leaf="true" data-offset-key="14751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="14752"><span data-slate-leaf="true" data-offset-key="14752:0" data-first-offset="true"><span data-slate-string="true">([]*User, </span></span></span><span data-slate-object="text" data-key="14753"><span data-slate-leaf="true" data-offset-key="14753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14754"><span data-slate-leaf="true" data-offset-key="14754:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14755"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14756"><span data-slate-object="text" data-key="14757"><span data-slate-leaf="true" data-offset-key="14757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users WHERE name &lt;&gt; 'jinzhu';</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14758"><span data-slate-object="text" data-key="14759"><span data-slate-leaf="true" data-offset-key="14759:0" data-first-offset="true"><span data-slate-string="true">db.Where(</span></span></span><span data-slate-object="text" data-key="14760"><span data-slate-leaf="true" data-offset-key="14760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name &lt;&gt; ?"</span></span></span></span><span data-slate-object="text" data-key="14761"><span data-slate-leaf="true" data-offset-key="14761:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14762"><span data-slate-leaf="true" data-offset-key="14762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu"</span></span></span></span><span data-slate-object="text" data-key="14763"><span data-slate-leaf="true" data-offset-key="14763:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;users)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="14764"><div data-slate-type="list-line" data-slate-object="block" data-key="14765"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="14766"><span data-slate-leaf="true" data-offset-key="14766:0" data-first-offset="true"><span data-slate-string="true">智能选择字段</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14767"><span data-slate-object="text" data-key="14768"><span data-slate-leaf="true" data-offset-key="14768:0" data-first-offset="true"><span data-slate-string="true">你可以通过 Select 方法，选择特定的字段。我们可以定义一个较小的结构体来接受选定的字段：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14769"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14770"><span data-slate-object="text" data-key="14771"><span data-slate-leaf="true" data-offset-key="14771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14772"><span data-slate-leaf="true" data-offset-key="14772:0" data-first-offset="true"><span data-slate-string="true"> APIUser </span></span></span><span data-slate-object="text" data-key="14773"><span data-slate-leaf="true" data-offset-key="14773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14774"><span data-slate-leaf="true" data-offset-key="14774:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14775"><span data-slate-object="text" data-key="14776"><span data-slate-leaf="true" data-offset-key="14776:0" data-first-offset="true"><span data-slate-string="true">  ID   </span></span></span><span data-slate-object="text" data-key="14777"><span data-slate-leaf="true" data-offset-key="14777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14778"><span data-slate-object="text" data-key="14779"><span data-slate-leaf="true" data-offset-key="14779:0" data-first-offset="true"><span data-slate-string="true">  Name </span></span></span><span data-slate-object="text" data-key="14780"><span data-slate-leaf="true" data-offset-key="14780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14781"><span data-slate-object="text" data-key="14782"><span data-slate-leaf="true" data-offset-key="14782:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14783"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14784"><span data-slate-object="text" data-key="14785"><span data-slate-leaf="true" data-offset-key="14785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT `id`, `name` FROM `users` LIMIT 10;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14786"><span data-slate-object="text" data-key="14787"><span data-slate-leaf="true" data-offset-key="14787:0" data-first-offset="true"><span data-slate-string="true">db.Model(&amp;User{}).Limit(</span></span></span><span data-slate-object="text" data-key="14788"><span data-slate-leaf="true" data-offset-key="14788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="14789"><span data-slate-leaf="true" data-offset-key="14789:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;APIUser{})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14790"><span data-slate-object="text" data-key="14791"><span data-slate-leaf="true" data-offset-key="14791:0" data-first-offset="true"><span data-slate-string="true">除了上面讲的三种常用的基本查询方法，GORM 还支持高级查询，下面我来介绍下。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14792" id="sr-toc-10"><span data-slate-object="text" data-key="14793"><span data-slate-leaf="true" data-offset-key="14793:0" data-first-offset="true"><span data-slate-string="true">高级查询</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14794"><span data-slate-object="text" data-key="14795"><span data-slate-leaf="true" data-offset-key="14795:0" data-first-offset="true"><span data-slate-string="true">GORM 支持很多高级查询功能，这里我主要介绍 4 种。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14796"><div data-slate-type="list-line" data-slate-object="block" data-key="14797"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14798"><span data-slate-leaf="true" data-offset-key="14798:0" data-first-offset="true"><span data-slate-string="true">指定检索记录时的排序方式</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14799"><span data-slate-object="text" data-key="14800"><span data-slate-leaf="true" data-offset-key="14800:0" data-first-offset="true"><span data-slate-string="true">示例代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14801"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14802"><span data-slate-object="text" data-key="14803"><span data-slate-leaf="true" data-offset-key="14803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users ORDER BY age desc, name;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14804"><span data-slate-object="text" data-key="14805"><span data-slate-leaf="true" data-offset-key="14805:0" data-first-offset="true"><span data-slate-string="true">db.Order(</span></span></span><span data-slate-object="text" data-key="14806"><span data-slate-leaf="true" data-offset-key="14806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age desc, name"</span></span></span></span><span data-slate-object="text" data-key="14807"><span data-slate-leaf="true" data-offset-key="14807:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;users)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="14808"><div data-slate-type="list-line" data-slate-object="block" data-key="14809"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14810"><span data-slate-leaf="true" data-offset-key="14810:0" data-first-offset="true"><span data-slate-string="true">Limit &amp; Offset</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14811"><span data-slate-object="text" data-key="14812"><span data-slate-leaf="true" data-offset-key="14812:0" data-first-offset="true"><span data-slate-string="true">Offset 指定从第几条记录开始查询，Limit 指定返回的最大记录数。Offset 和 Limit 值为 -1 时，消除 Offset 和 Limit 条件。另外，Limit 和 Offset 位置不同，效果也不同。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14813"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14814"><span data-slate-object="text" data-key="14815"><span data-slate-leaf="true" data-offset-key="14815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT * FROM users OFFSET 5 LIMIT 10;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14816"><span data-slate-object="text" data-key="14817"><span data-slate-leaf="true" data-offset-key="14817:0" data-first-offset="true"><span data-slate-string="true">db.Limit(</span></span></span><span data-slate-object="text" data-key="14818"><span data-slate-leaf="true" data-offset-key="14818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="14819"><span data-slate-leaf="true" data-offset-key="14819:0" data-first-offset="true"><span data-slate-string="true">).Offset(</span></span></span><span data-slate-object="text" data-key="14820"><span data-slate-leaf="true" data-offset-key="14820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="14821"><span data-slate-leaf="true" data-offset-key="14821:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;users)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="14822"><div data-slate-type="list-line" data-slate-object="block" data-key="14823"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="14824"><span data-slate-leaf="true" data-offset-key="14824:0" data-first-offset="true"><span data-slate-string="true">Distinct</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14825"><span data-slate-object="text" data-key="14826"><span data-slate-leaf="true" data-offset-key="14826:0" data-first-offset="true"><span data-slate-string="true">Distinct 可以从数据库记录中选择不同的值。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14827"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14828"><span data-slate-object="text" data-key="14829"><span data-slate-leaf="true" data-offset-key="14829:0" data-first-offset="true"><span data-slate-string="true">db.Distinct(</span></span></span><span data-slate-object="text" data-key="14830"><span data-slate-leaf="true" data-offset-key="14830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="14831"><span data-slate-leaf="true" data-offset-key="14831:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14832"><span data-slate-leaf="true" data-offset-key="14832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"age"</span></span></span></span><span data-slate-object="text" data-key="14833"><span data-slate-leaf="true" data-offset-key="14833:0" data-first-offset="true"><span data-slate-string="true">).Order(</span></span></span><span data-slate-object="text" data-key="14834"><span data-slate-leaf="true" data-offset-key="14834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name, age desc"</span></span></span></span><span data-slate-object="text" data-key="14835"><span data-slate-leaf="true" data-offset-key="14835:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;results)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="14836"><div data-slate-type="list-line" data-slate-object="block" data-key="14837"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="14838"><span data-slate-leaf="true" data-offset-key="14838:0" data-first-offset="true"><span data-slate-string="true">Count</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14839"><span data-slate-object="text" data-key="14840"><span data-slate-leaf="true" data-offset-key="14840:0" data-first-offset="true"><span data-slate-string="true">Count 可以获取匹配的条数。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14841"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14842"><span data-slate-object="text" data-key="14843"><span data-slate-leaf="true" data-offset-key="14843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="14844"><span data-slate-leaf="true" data-offset-key="14844:0" data-first-offset="true"><span data-slate-string="true"> count </span></span></span><span data-slate-object="text" data-key="14845"><span data-slate-leaf="true" data-offset-key="14845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14846"><span data-slate-object="text" data-key="14847"><span data-slate-leaf="true" data-offset-key="14847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SELECT count(1) FROM users WHERE name = 'jinzhu'; (count)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14848"><span data-slate-object="text" data-key="14849"><span data-slate-leaf="true" data-offset-key="14849:0" data-first-offset="true"><span data-slate-string="true">db.Model(&amp;User{}).Where(</span></span></span><span data-slate-object="text" data-key="14850"><span data-slate-leaf="true" data-offset-key="14850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name = ?"</span></span></span></span><span data-slate-object="text" data-key="14851"><span data-slate-leaf="true" data-offset-key="14851:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14852"><span data-slate-leaf="true" data-offset-key="14852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jinzhu"</span></span></span></span><span data-slate-object="text" data-key="14853"><span data-slate-leaf="true" data-offset-key="14853:0" data-first-offset="true"><span data-slate-string="true">).Count(&amp;count)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14854"><span data-slate-object="text" data-key="14855"><span data-slate-leaf="true" data-offset-key="14855:0" data-first-offset="true"><span data-slate-string="true">GORM 还支持很多高级查询功能，比如内联条件、Not 条件、Or 条件、Group &amp; Having、Joins、Group、FirstOrInit、FirstOrCreate、迭代、FindInBatches 等。因为 IAM 项目中没有用到这些高级特性，我在这里就不展开介绍了。你如果感兴趣，可以看下 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14856"><span data-slate-object="text" data-key="14857"><span data-slate-leaf="true" data-offset-key="14857:0" data-first-offset="true"><span data-slate-string="true">GORM 的官方文档</span></span></span></a><span data-slate-object="text" data-key="14858"><span data-slate-leaf="true" data-offset-key="14858:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14859" id="sr-toc-11"><span data-slate-object="text" data-key="14860"><span data-slate-leaf="true" data-offset-key="14860:0" data-first-offset="true"><span data-slate-string="true">原生 SQL</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14861"><span data-slate-object="text" data-key="14862"><span data-slate-leaf="true" data-offset-key="14862:0" data-first-offset="true"><span data-slate-string="true">GORM 支持原生查询 SQL 和执行 SQL。原生查询 SQL 用法如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14863"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14864"><span data-slate-object="text" data-key="14865"><span data-slate-leaf="true" data-offset-key="14865:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14866"><span data-slate-leaf="true" data-offset-key="14866:0" data-first-offset="true"><span data-slate-string="true"> Result </span></span></span><span data-slate-object="text" data-key="14867"><span data-slate-leaf="true" data-offset-key="14867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14868"><span data-slate-leaf="true" data-offset-key="14868:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14869"><span data-slate-object="text" data-key="14870"><span data-slate-leaf="true" data-offset-key="14870:0" data-first-offset="true"><span data-slate-string="true">  ID   </span></span></span><span data-slate-object="text" data-key="14871"><span data-slate-leaf="true" data-offset-key="14871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14872"><span data-slate-object="text" data-key="14873"><span data-slate-leaf="true" data-offset-key="14873:0" data-first-offset="true"><span data-slate-string="true">  Name </span></span></span><span data-slate-object="text" data-key="14874"><span data-slate-leaf="true" data-offset-key="14874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14875"><span data-slate-object="text" data-key="14876"><span data-slate-leaf="true" data-offset-key="14876:0" data-first-offset="true"><span data-slate-string="true">  Age  </span></span></span><span data-slate-object="text" data-key="14877"><span data-slate-leaf="true" data-offset-key="14877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14878"><span data-slate-object="text" data-key="14879"><span data-slate-leaf="true" data-offset-key="14879:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14880"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14881"><span data-slate-object="text" data-key="14882"><span data-slate-leaf="true" data-offset-key="14882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="14883"><span data-slate-leaf="true" data-offset-key="14883:0" data-first-offset="true"><span data-slate-string="true"> result Result</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14884"><span data-slate-object="text" data-key="14885"><span data-slate-leaf="true" data-offset-key="14885:0" data-first-offset="true"><span data-slate-string="true">db.Raw(</span></span></span><span data-slate-object="text" data-key="14886"><span data-slate-leaf="true" data-offset-key="14886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"SELECT id, name, age FROM users WHERE name = ?"</span></span></span></span><span data-slate-object="text" data-key="14887"><span data-slate-leaf="true" data-offset-key="14887:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14888"><span data-slate-leaf="true" data-offset-key="14888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="14889"><span data-slate-leaf="true" data-offset-key="14889:0" data-first-offset="true"><span data-slate-string="true">).Scan(&amp;result)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14890"><span data-slate-object="text" data-key="14891"><span data-slate-leaf="true" data-offset-key="14891:0" data-first-offset="true"><span data-slate-string="true">原生执行 SQL 用法如下；</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14892"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14893"><span data-slate-object="text" data-key="14894"><span data-slate-leaf="true" data-offset-key="14894:0" data-first-offset="true"><span data-slate-string="true">db.Exec(</span></span></span><span data-slate-object="text" data-key="14895"><span data-slate-leaf="true" data-offset-key="14895:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"DROP TABLE users"</span></span></span></span><span data-slate-object="text" data-key="14896"><span data-slate-leaf="true" data-offset-key="14896:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14897"><span data-slate-object="text" data-key="14898"><span data-slate-leaf="true" data-offset-key="14898:0" data-first-offset="true"><span data-slate-string="true">db.Exec(</span></span></span><span data-slate-object="text" data-key="14899"><span data-slate-leaf="true" data-offset-key="14899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"UPDATE orders SET shipped_at=? WHERE id IN ?"</span></span></span></span><span data-slate-object="text" data-key="14900"><span data-slate-leaf="true" data-offset-key="14900:0" data-first-offset="true"><span data-slate-string="true">, time.Now(), []</span></span></span><span data-slate-object="text" data-key="14901"><span data-slate-leaf="true" data-offset-key="14901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14902"><span data-slate-leaf="true" data-offset-key="14902:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="14903"><span data-slate-leaf="true" data-offset-key="14903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="14904"><span data-slate-leaf="true" data-offset-key="14904:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="14905"><span data-slate-leaf="true" data-offset-key="14905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="14906"><span data-slate-leaf="true" data-offset-key="14906:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="14907"><span data-slate-leaf="true" data-offset-key="14907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="14908"><span data-slate-leaf="true" data-offset-key="14908:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14909" id="sr-toc-12"><span data-slate-object="text" data-key="14910"><span data-slate-leaf="true" data-offset-key="14910:0" data-first-offset="true"><span data-slate-string="true">GORM 钩子</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14911"><span data-slate-object="text" data-key="14912"><span data-slate-leaf="true" data-offset-key="14912:0" data-first-offset="true"><span data-slate-string="true">GORM 支持钩子功能，例如下面这个在插入记录前执行的钩子：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14913"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14914"><span data-slate-object="text" data-key="14915"><span data-slate-leaf="true" data-offset-key="14915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14916"><span data-slate-leaf="true" data-offset-key="14916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14917"><span data-slate-leaf="true" data-offset-key="14917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(u *User)</span></span></span></span></span><span data-slate-object="text" data-key="14918"><span data-slate-leaf="true" data-offset-key="14918:0" data-first-offset="true"><span data-slate-string="true"> BeforeCreate(tx *gorm.DB) (err </span></span></span><span data-slate-object="text" data-key="14919"><span data-slate-leaf="true" data-offset-key="14919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="14920"><span data-slate-leaf="true" data-offset-key="14920:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14921"><span data-slate-object="text" data-key="14922"><span data-slate-leaf="true" data-offset-key="14922:0" data-first-offset="true"><span data-slate-string="true">  u.UUID = uuid.New()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14923"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14924"><span data-slate-object="text" data-key="14925"><span data-slate-leaf="true" data-offset-key="14925:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14926"><span data-slate-leaf="true" data-offset-key="14926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14927"><span data-slate-leaf="true" data-offset-key="14927:0" data-first-offset="true"><span data-slate-string="true"> u.Name == </span></span></span><span data-slate-object="text" data-key="14928"><span data-slate-leaf="true" data-offset-key="14928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"admin"</span></span></span></span><span data-slate-object="text" data-key="14929"><span data-slate-leaf="true" data-offset-key="14929:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14930"><span data-slate-object="text" data-key="14931"><span data-slate-leaf="true" data-offset-key="14931:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14932"><span data-slate-leaf="true" data-offset-key="14932:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14933"><span data-slate-leaf="true" data-offset-key="14933:0" data-first-offset="true"><span data-slate-string="true"> errors.New(</span></span></span><span data-slate-object="text" data-key="14934"><span data-slate-leaf="true" data-offset-key="14934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"invalid name"</span></span></span></span><span data-slate-object="text" data-key="14935"><span data-slate-leaf="true" data-offset-key="14935:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14936"><span data-slate-object="text" data-key="14937"><span data-slate-leaf="true" data-offset-key="14937:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14938"><span data-slate-object="text" data-key="14939"><span data-slate-leaf="true" data-offset-key="14939:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14940"><span data-slate-leaf="true" data-offset-key="14940:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14941"><span data-slate-object="text" data-key="14942"><span data-slate-leaf="true" data-offset-key="14942:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14943"><span data-slate-object="text" data-key="14944"><span data-slate-leaf="true" data-offset-key="14944:0" data-first-offset="true"><span data-slate-string="true">GORM 支持的钩子见下表：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14945"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/20/2c/20fb0b6a11dbcebd9ddf428517240d2c.jpg?wh=1920x1338"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14946" id="sr-toc-13"><span data-slate-object="text" data-key="14947"><span data-slate-leaf="true" data-offset-key="14947:0" data-first-offset="true"><span data-slate-string="true">iam-apiserver 中的 CURD 操作实战</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14948"><span data-slate-object="text" data-key="14949"><span data-slate-leaf="true" data-offset-key="14949:0" data-first-offset="true"><span data-slate-string="true">接下来，我来介绍下 iam-apiserver 是如何使用 GORM，对数据进行 CURD 操作的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14950"><span data-slate-object="text" data-key="14951"><span data-slate-leaf="true" data-offset-key="14951:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">首先，</span></span></span></span><span data-slate-object="text" data-key="14952"><span data-slate-leaf="true" data-offset-key="14952:0" data-first-offset="true"><span data-slate-string="true">我们需要配置连接 MySQL 的各类参数。iam-apiserver 通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14953"><span data-slate-object="text" data-key="14954"><span data-slate-leaf="true" data-offset-key="14954:0" data-first-offset="true"><span data-slate-string="true">NewMySQLOptions</span></span></span></a><span data-slate-object="text" data-key="14955"><span data-slate-leaf="true" data-offset-key="14955:0" data-first-offset="true"><span data-slate-string="true"> 函数创建了一个带有默认值的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14956"><span data-slate-object="text" data-key="14957"><span data-slate-leaf="true" data-offset-key="14957:0" data-first-offset="true"><span data-slate-string="true">MySQLOptions</span></span></span></a><span data-slate-object="text" data-key="14958"><span data-slate-leaf="true" data-offset-key="14958:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量，将该变量传给 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14959"><span data-slate-object="text" data-key="14960"><span data-slate-leaf="true" data-offset-key="14960:0" data-first-offset="true"><span data-slate-string="true">NewApp</span></span></span></a><span data-slate-object="text" data-key="14961"><span data-slate-leaf="true" data-offset-key="14961:0" data-first-offset="true"><span data-slate-string="true"> 函数。在 App 框架中，最终会调用 MySQLOptions 提供的 AddFlags 方法，将 MySQLOptions 提供的命令行参数添加到 Cobra 命令行中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14962"><span data-slate-object="text" data-key="14963"><span data-slate-leaf="true" data-offset-key="14963:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">接着，</span></span></span></span><span data-slate-object="text" data-key="14964"><span data-slate-leaf="true" data-offset-key="14964:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14965"><span data-slate-object="text" data-key="14966"><span data-slate-leaf="true" data-offset-key="14966:0" data-first-offset="true"><span data-slate-string="true">PrepareRun</span></span></span></a><span data-slate-object="text" data-key="14967"><span data-slate-leaf="true" data-offset-key="14967:0" data-first-offset="true"><span data-slate-string="true"> 函数中，调用 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14968"><span data-slate-object="text" data-key="14969"><span data-slate-leaf="true" data-offset-key="14969:0" data-first-offset="true"><span data-slate-string="true">GetMySQLFactoryOr</span></span></span></a><span data-slate-object="text" data-key="14970"><span data-slate-leaf="true" data-offset-key="14970:0" data-first-offset="true"><span data-slate-string="true"> 函数，初始化并获取仓库层的实例 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14971"><span data-slate-object="text" data-key="14972"><span data-slate-leaf="true" data-offset-key="14972:0" data-first-offset="true"><span data-slate-string="true">mysqlFactory</span></span></span></a><span data-slate-object="text" data-key="14973"><span data-slate-leaf="true" data-offset-key="14973:0" data-first-offset="true"><span data-slate-string="true">。实现了仓库层 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14974"><span data-slate-object="text" data-key="14975"><span data-slate-leaf="true" data-offset-key="14975:0" data-first-offset="true"><span data-slate-string="true">store.Factory</span></span></span></a><span data-slate-object="text" data-key="14976"><span data-slate-leaf="true" data-offset-key="14976:0" data-first-offset="true"><span data-slate-string="true"> 接口：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14977"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14978"><span data-slate-object="text" data-key="14979"><span data-slate-leaf="true" data-offset-key="14979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14980"><span data-slate-leaf="true" data-offset-key="14980:0" data-first-offset="true"><span data-slate-string="true"> Factory </span></span></span><span data-slate-object="text" data-key="14981"><span data-slate-leaf="true" data-offset-key="14981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="14982"><span data-slate-leaf="true" data-offset-key="14982:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14983"><span data-slate-object="text" data-key="14984"><span data-slate-leaf="true" data-offset-key="14984:0" data-first-offset="true"><span data-slate-string="true">    Users() UserStore</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14985"><span data-slate-object="text" data-key="14986"><span data-slate-leaf="true" data-offset-key="14986:0" data-first-offset="true"><span data-slate-string="true">    Secrets() SecretStore</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14987"><span data-slate-object="text" data-key="14988"><span data-slate-leaf="true" data-offset-key="14988:0" data-first-offset="true"><span data-slate-string="true">    Policies() PolicyStore</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14989"><span data-slate-object="text" data-key="14990"><span data-slate-leaf="true" data-offset-key="14990:0" data-first-offset="true"><span data-slate-string="true">    Close() </span></span></span><span data-slate-object="text" data-key="14991"><span data-slate-leaf="true" data-offset-key="14991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14992"><span data-slate-object="text" data-key="14993"><span data-slate-leaf="true" data-offset-key="14993:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14994"><span data-slate-object="text" data-key="14995"><span data-slate-leaf="true" data-offset-key="14995:0" data-first-offset="true"><span data-slate-string="true">GetMySQLFactoryOr 函数采用了我们在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14996"><span data-slate-object="text" data-key="14997"><span data-slate-leaf="true" data-offset-key="14997:0" data-first-offset="true"><span data-slate-string="true">11 讲</span></span></span></a><span data-slate-object="text" data-key="14998"><span data-slate-leaf="true" data-offset-key="14998:0" data-first-offset="true"><span data-slate-string="true"> 中提过的单例模式，确保 iam-apiserver 进程中只有一个仓库层的实例，这样可以减少内存开支和系统的性能开销。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14999"><span data-slate-object="text" data-key="15000"><span data-slate-leaf="true" data-offset-key="15000:0" data-first-offset="true"><span data-slate-string="true">GetMySQLFactoryOr 函数中，使用 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="15001"><span data-slate-object="text" data-key="15002"><span data-slate-leaf="true" data-offset-key="15002:0" data-first-offset="true"><span data-slate-string="true">github.com/marmotedu/iam/pkg/db</span></span></span></a><span data-slate-object="text" data-key="15003"><span data-slate-leaf="true" data-offset-key="15003:0" data-first-offset="true"><span data-slate-string="true"> 包提供的 New 函数，创建了 MySQL 实例。New 函数代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15004"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15005"><span data-slate-object="text" data-key="15006"><span data-slate-leaf="true" data-offset-key="15006:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15007"><span data-slate-leaf="true" data-offset-key="15007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15008"><span data-slate-leaf="true" data-offset-key="15008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">New</span></span></span></span></span><span data-slate-object="text" data-key="15009"><span data-slate-leaf="true" data-offset-key="15009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(opts *Options)</span></span></span></span></span><span data-slate-object="text" data-key="15010"><span data-slate-leaf="true" data-offset-key="15010:0" data-first-offset="true"><span data-slate-string="true"> (*gorm.DB, </span></span></span><span data-slate-object="text" data-key="15011"><span data-slate-leaf="true" data-offset-key="15011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15012"><span data-slate-leaf="true" data-offset-key="15012:0" data-first-offset="true"><span data-slate-string="true">) {    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15013"><span data-slate-object="text" data-key="15014"><span data-slate-leaf="true" data-offset-key="15014:0" data-first-offset="true"><span data-slate-string="true">    dsn := fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="15015"><span data-slate-leaf="true" data-offset-key="15015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`%s:%s@tcp(%s)/%s?charset=utf8&amp;parseTime=%t&amp;loc=%s`</span></span></span></span><span data-slate-object="text" data-key="15016"><span data-slate-leaf="true" data-offset-key="15016:0" data-first-offset="true"><span data-slate-string="true">,    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15017"><span data-slate-object="text" data-key="15018"><span data-slate-leaf="true" data-offset-key="15018:0" data-first-offset="true"><span data-slate-string="true">        opts.Username,                                                                 </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15019"><span data-slate-object="text" data-key="15020"><span data-slate-leaf="true" data-offset-key="15020:0" data-first-offset="true"><span data-slate-string="true">        opts.Password,                                 </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15021"><span data-slate-object="text" data-key="15022"><span data-slate-leaf="true" data-offset-key="15022:0" data-first-offset="true"><span data-slate-string="true">        opts.Host,                   </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15023"><span data-slate-object="text" data-key="15024"><span data-slate-leaf="true" data-offset-key="15024:0" data-first-offset="true"><span data-slate-string="true">        opts.Database,    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15025"><span data-slate-object="text" data-key="15026"><span data-slate-leaf="true" data-offset-key="15026:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15027"><span data-slate-leaf="true" data-offset-key="15027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="15028"><span data-slate-leaf="true" data-offset-key="15028:0" data-first-offset="true"><span data-slate-string="true">,                               </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15029"><span data-slate-object="text" data-key="15030"><span data-slate-leaf="true" data-offset-key="15030:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15031"><span data-slate-leaf="true" data-offset-key="15031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Local"</span></span></span></span><span data-slate-object="text" data-key="15032"><span data-slate-leaf="true" data-offset-key="15032:0" data-first-offset="true"><span data-slate-string="true">)    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15033"><span data-slate-object="text" data-key="15034"><span data-slate-leaf="true" data-offset-key="15034:0" data-first-offset="true"><span data-slate-string="true">                                                  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15035"><span data-slate-object="text" data-key="15036"><span data-slate-leaf="true" data-offset-key="15036:0" data-first-offset="true"><span data-slate-string="true">    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15037"><span data-slate-object="text" data-key="15038"><span data-slate-leaf="true" data-offset-key="15038:0" data-first-offset="true"><span data-slate-string="true">        Logger: logger.New(opts.LogLevel),                                                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15039"><span data-slate-object="text" data-key="15040"><span data-slate-leaf="true" data-offset-key="15040:0" data-first-offset="true"><span data-slate-string="true">    })    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15041"><span data-slate-object="text" data-key="15042"><span data-slate-leaf="true" data-offset-key="15042:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15043"><span data-slate-leaf="true" data-offset-key="15043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15044"><span data-slate-leaf="true" data-offset-key="15044:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="15045"><span data-slate-leaf="true" data-offset-key="15045:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15046"><span data-slate-leaf="true" data-offset-key="15046:0" data-first-offset="true"><span data-slate-string="true"> {                                   </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15047"><span data-slate-object="text" data-key="15048"><span data-slate-leaf="true" data-offset-key="15048:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15049"><span data-slate-leaf="true" data-offset-key="15049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15050"><span data-slate-leaf="true" data-offset-key="15050:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15051"><span data-slate-leaf="true" data-offset-key="15051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15052"><span data-slate-leaf="true" data-offset-key="15052:0" data-first-offset="true"><span data-slate-string="true">, err         </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15053"><span data-slate-object="text" data-key="15054"><span data-slate-leaf="true" data-offset-key="15054:0" data-first-offset="true"><span data-slate-string="true">    }    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15055"><span data-slate-object="text" data-key="15056"><span data-slate-leaf="true" data-offset-key="15056:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15057"><span data-slate-object="text" data-key="15058"><span data-slate-leaf="true" data-offset-key="15058:0" data-first-offset="true"><span data-slate-string="true">    sqlDB, err := db.DB()                              </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15059"><span data-slate-object="text" data-key="15060"><span data-slate-leaf="true" data-offset-key="15060:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15061"><span data-slate-leaf="true" data-offset-key="15061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15062"><span data-slate-leaf="true" data-offset-key="15062:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="15063"><span data-slate-leaf="true" data-offset-key="15063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15064"><span data-slate-leaf="true" data-offset-key="15064:0" data-first-offset="true"><span data-slate-string="true"> {                                                                </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15065"><span data-slate-object="text" data-key="15066"><span data-slate-leaf="true" data-offset-key="15066:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15067"><span data-slate-leaf="true" data-offset-key="15067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15068"><span data-slate-leaf="true" data-offset-key="15068:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15069"><span data-slate-leaf="true" data-offset-key="15069:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15070"><span data-slate-leaf="true" data-offset-key="15070:0" data-first-offset="true"><span data-slate-string="true">, err                              </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15071"><span data-slate-object="text" data-key="15072"><span data-slate-leaf="true" data-offset-key="15072:0" data-first-offset="true"><span data-slate-string="true">    }                                                                  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15073"><span data-slate-object="text" data-key="15074"><span data-slate-leaf="true" data-offset-key="15074:0" data-first-offset="true"><span data-slate-string="true">                                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15075"><span data-slate-object="text" data-key="15076"><span data-slate-leaf="true" data-offset-key="15076:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15077"><span data-slate-leaf="true" data-offset-key="15077:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetMaxOpenConns sets the maximum number of open connections to the database.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15078"><span data-slate-object="text" data-key="15079"><span data-slate-leaf="true" data-offset-key="15079:0" data-first-offset="true"><span data-slate-string="true">    sqlDB.SetMaxOpenConns(opts.MaxOpenConnections)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15080"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15081"><span data-slate-object="text" data-key="15082"><span data-slate-leaf="true" data-offset-key="15082:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15083"><span data-slate-leaf="true" data-offset-key="15083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetConnMaxLifetime sets the maximum amount of time a connection may be reused.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15084"><span data-slate-object="text" data-key="15085"><span data-slate-leaf="true" data-offset-key="15085:0" data-first-offset="true"><span data-slate-string="true">    sqlDB.SetConnMaxLifetime(opts.MaxConnectionLifeTime)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15086"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15087"><span data-slate-object="text" data-key="15088"><span data-slate-leaf="true" data-offset-key="15088:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15089"><span data-slate-leaf="true" data-offset-key="15089:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetMaxIdleConns sets the maximum number of connections in the idle connection pool.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15090"><span data-slate-object="text" data-key="15091"><span data-slate-leaf="true" data-offset-key="15091:0" data-first-offset="true"><span data-slate-string="true">    sqlDB.SetMaxIdleConns(opts.MaxIdleConnections)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15092"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15093"><span data-slate-object="text" data-key="15094"><span data-slate-leaf="true" data-offset-key="15094:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15095"><span data-slate-leaf="true" data-offset-key="15095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15096"><span data-slate-leaf="true" data-offset-key="15096:0" data-first-offset="true"><span data-slate-string="true"> db, </span></span></span><span data-slate-object="text" data-key="15097"><span data-slate-leaf="true" data-offset-key="15097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15098"><span data-slate-object="text" data-key="15099"><span data-slate-leaf="true" data-offset-key="15099:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15100"><span data-slate-object="text" data-key="15101"><span data-slate-leaf="true" data-offset-key="15101:0" data-first-offset="true"><span data-slate-string="true">上述代码中，我们先创建了一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15102"><span data-slate-object="text" data-key="15103"><span data-slate-leaf="true" data-offset-key="15103:0" data-first-offset="true"><span data-slate-string="true">*gorm.DB</span></span></span></span><span data-slate-object="text" data-key="15104"><span data-slate-leaf="true" data-offset-key="15104:0" data-first-offset="true"><span data-slate-string="true"> 类型的实例，并对该实例进行了如下设置：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="15105"><div data-slate-type="list-line" data-slate-object="block" data-key="15106"><span data-slate-object="text" data-key="15107"><span data-slate-leaf="true" data-offset-key="15107:0" data-first-offset="true"><span data-slate-string="true">通过 SetMaxOpenConns 方法，设置了 MySQL 的最大连接数（推荐 100）。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="15108"><span data-slate-object="text" data-key="15109"><span data-slate-leaf="true" data-offset-key="15109:0" data-first-offset="true"><span data-slate-string="true">通过 SetConnMaxLifetime 方法，设置了 MySQL 的空闲连接最大存活时间（推荐 10s）。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="15110"><span data-slate-object="text" data-key="15111"><span data-slate-leaf="true" data-offset-key="15111:0" data-first-offset="true"><span data-slate-string="true">通过 SetMaxIdleConns 方法，设置了 MySQL 的最大空闲连接数（推荐 100）。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15112"><span data-slate-object="text" data-key="15113"><span data-slate-leaf="true" data-offset-key="15113:0" data-first-offset="true"><span data-slate-string="true">GetMySQLFactoryOr 函数最后创建了 datastore 类型的变量 mysqlFactory，该变量是仓库层的变量。mysqlFactory 变量中，又包含了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15114"><span data-slate-object="text" data-key="15115"><span data-slate-leaf="true" data-offset-key="15115:0" data-first-offset="true"><span data-slate-string="true">*gorm.DB</span></span></span></span><span data-slate-object="text" data-key="15116"><span data-slate-leaf="true" data-offset-key="15116:0" data-first-offset="true"><span data-slate-string="true"> 类型的字段 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15117"><span data-slate-object="text" data-key="15118"><span data-slate-leaf="true" data-offset-key="15118:0" data-first-offset="true"><span data-slate-string="true">db</span></span></span></span><span data-slate-object="text" data-key="15119"><span data-slate-leaf="true" data-offset-key="15119:0" data-first-offset="true"><span data-slate-string="true"> 。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15120"><span data-slate-object="text" data-key="15121"><span data-slate-leaf="true" data-offset-key="15121:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">最终</span></span></span></span><span data-slate-object="text" data-key="15122"><span data-slate-leaf="true" data-offset-key="15122:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">，</span></span></span></span><span data-slate-object="text" data-key="15123"><span data-slate-leaf="true" data-offset-key="15123:0" data-first-offset="true"><span data-slate-string="true">我们通过仓库层的变量 mysqlFactory，调用其 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15124"><span data-slate-object="text" data-key="15125"><span data-slate-leaf="true" data-offset-key="15125:0" data-first-offset="true"><span data-slate-string="true">db</span></span></span></span><span data-slate-object="text" data-key="15126"><span data-slate-leaf="true" data-offset-key="15126:0" data-first-offset="true"><span data-slate-string="true"> 字段提供的方法来完成数据库的 CURD 操作。例如，创建密钥、更新密钥、删除密钥、获取密钥详情、查询密钥列表，具体代码如下（代码位于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="15127"><span data-slate-object="text" data-key="15128"><span data-slate-leaf="true" data-offset-key="15128:0" data-first-offset="true"><span data-slate-string="true">secret.go</span></span></span></a><span data-slate-object="text" data-key="15129"><span data-slate-leaf="true" data-offset-key="15129:0" data-first-offset="true"><span data-slate-string="true"> 文件中）：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15130"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15131"><span data-slate-object="text" data-key="15132"><span data-slate-leaf="true" data-offset-key="15132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Create creates a new secret.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15133"><span data-slate-object="text" data-key="15134"><span data-slate-leaf="true" data-offset-key="15134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15135"><span data-slate-leaf="true" data-offset-key="15135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15136"><span data-slate-leaf="true" data-offset-key="15136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s *secrets)</span></span></span></span></span><span data-slate-object="text" data-key="15137"><span data-slate-leaf="true" data-offset-key="15137:0" data-first-offset="true"><span data-slate-string="true"> Create(ctx context.Context, secret *v1.Secret, opts metav1.CreateOptions) </span></span></span><span data-slate-object="text" data-key="15138"><span data-slate-leaf="true" data-offset-key="15138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15139"><span data-slate-leaf="true" data-offset-key="15139:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15140"><span data-slate-object="text" data-key="15141"><span data-slate-leaf="true" data-offset-key="15141:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15142"><span data-slate-leaf="true" data-offset-key="15142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15143"><span data-slate-leaf="true" data-offset-key="15143:0" data-first-offset="true"><span data-slate-string="true"> s.db.Create(&amp;secret).Error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15144"><span data-slate-object="text" data-key="15145"><span data-slate-leaf="true" data-offset-key="15145:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15146"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15147"><span data-slate-object="text" data-key="15148"><span data-slate-leaf="true" data-offset-key="15148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Update updates an secret information by the secret identifier.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15149"><span data-slate-object="text" data-key="15150"><span data-slate-leaf="true" data-offset-key="15150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15151"><span data-slate-leaf="true" data-offset-key="15151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15152"><span data-slate-leaf="true" data-offset-key="15152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s *secrets)</span></span></span></span></span><span data-slate-object="text" data-key="15153"><span data-slate-leaf="true" data-offset-key="15153:0" data-first-offset="true"><span data-slate-string="true"> Update(ctx context.Context, secret *v1.Secret, opts metav1.UpdateOptions) </span></span></span><span data-slate-object="text" data-key="15154"><span data-slate-leaf="true" data-offset-key="15154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15155"><span data-slate-leaf="true" data-offset-key="15155:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15156"><span data-slate-object="text" data-key="15157"><span data-slate-leaf="true" data-offset-key="15157:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15158"><span data-slate-leaf="true" data-offset-key="15158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15159"><span data-slate-leaf="true" data-offset-key="15159:0" data-first-offset="true"><span data-slate-string="true"> s.db.Save(secret).Error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15160"><span data-slate-object="text" data-key="15161"><span data-slate-leaf="true" data-offset-key="15161:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15162"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15163"><span data-slate-object="text" data-key="15164"><span data-slate-leaf="true" data-offset-key="15164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Delete deletes the secret by the secret identifier.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15165"><span data-slate-object="text" data-key="15166"><span data-slate-leaf="true" data-offset-key="15166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15167"><span data-slate-leaf="true" data-offset-key="15167:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15168"><span data-slate-leaf="true" data-offset-key="15168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s *secrets)</span></span></span></span></span><span data-slate-object="text" data-key="15169"><span data-slate-leaf="true" data-offset-key="15169:0" data-first-offset="true"><span data-slate-string="true"> Delete(ctx context.Context, username, name </span></span></span><span data-slate-object="text" data-key="15170"><span data-slate-leaf="true" data-offset-key="15170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="15171"><span data-slate-leaf="true" data-offset-key="15171:0" data-first-offset="true"><span data-slate-string="true">, opts metav1.DeleteOptions) </span></span></span><span data-slate-object="text" data-key="15172"><span data-slate-leaf="true" data-offset-key="15172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15173"><span data-slate-leaf="true" data-offset-key="15173:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15174"><span data-slate-object="text" data-key="15175"><span data-slate-leaf="true" data-offset-key="15175:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15176"><span data-slate-leaf="true" data-offset-key="15176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15177"><span data-slate-leaf="true" data-offset-key="15177:0" data-first-offset="true"><span data-slate-string="true"> opts.Unscoped {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15178"><span data-slate-object="text" data-key="15179"><span data-slate-leaf="true" data-offset-key="15179:0" data-first-offset="true"><span data-slate-string="true">    s.db = s.db.Unscoped()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15180"><span data-slate-object="text" data-key="15181"><span data-slate-leaf="true" data-offset-key="15181:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15182"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15183"><span data-slate-object="text" data-key="15184"><span data-slate-leaf="true" data-offset-key="15184:0" data-first-offset="true"><span data-slate-string="true">  err := s.db.Where(</span></span></span><span data-slate-object="text" data-key="15185"><span data-slate-leaf="true" data-offset-key="15185:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username = ? and name = ?"</span></span></span></span><span data-slate-object="text" data-key="15186"><span data-slate-leaf="true" data-offset-key="15186:0" data-first-offset="true"><span data-slate-string="true">, username, name).Delete(&amp;v1.Secret{}).Error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15187"><span data-slate-object="text" data-key="15188"><span data-slate-leaf="true" data-offset-key="15188:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15189"><span data-slate-leaf="true" data-offset-key="15189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15190"><span data-slate-leaf="true" data-offset-key="15190:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="15191"><span data-slate-leaf="true" data-offset-key="15191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15192"><span data-slate-leaf="true" data-offset-key="15192:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; !errors.Is(err, gorm.ErrRecordNotFound) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15193"><span data-slate-object="text" data-key="15194"><span data-slate-leaf="true" data-offset-key="15194:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15195"><span data-slate-leaf="true" data-offset-key="15195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15196"><span data-slate-leaf="true" data-offset-key="15196:0" data-first-offset="true"><span data-slate-string="true"> errors.WithCode(code.ErrDatabase, err.Error())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15197"><span data-slate-object="text" data-key="15198"><span data-slate-leaf="true" data-offset-key="15198:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15199"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15200"><span data-slate-object="text" data-key="15201"><span data-slate-leaf="true" data-offset-key="15201:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15202"><span data-slate-leaf="true" data-offset-key="15202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15203"><span data-slate-leaf="true" data-offset-key="15203:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15204"><span data-slate-leaf="true" data-offset-key="15204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15205"><span data-slate-object="text" data-key="15206"><span data-slate-leaf="true" data-offset-key="15206:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15207"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15208"><span data-slate-object="text" data-key="15209"><span data-slate-leaf="true" data-offset-key="15209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get return an secret by the secret identifier.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15210"><span data-slate-object="text" data-key="15211"><span data-slate-leaf="true" data-offset-key="15211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15212"><span data-slate-leaf="true" data-offset-key="15212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15213"><span data-slate-leaf="true" data-offset-key="15213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s *secrets)</span></span></span></span></span><span data-slate-object="text" data-key="15214"><span data-slate-leaf="true" data-offset-key="15214:0" data-first-offset="true"><span data-slate-string="true"> Get(ctx context.Context, username, name </span></span></span><span data-slate-object="text" data-key="15215"><span data-slate-leaf="true" data-offset-key="15215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="15216"><span data-slate-leaf="true" data-offset-key="15216:0" data-first-offset="true"><span data-slate-string="true">, opts metav1.GetOptions) (*v1.Secret, </span></span></span><span data-slate-object="text" data-key="15217"><span data-slate-leaf="true" data-offset-key="15217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15218"><span data-slate-leaf="true" data-offset-key="15218:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15219"><span data-slate-object="text" data-key="15220"><span data-slate-leaf="true" data-offset-key="15220:0" data-first-offset="true"><span data-slate-string="true">  secret := &amp;v1.Secret{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15221"><span data-slate-object="text" data-key="15222"><span data-slate-leaf="true" data-offset-key="15222:0" data-first-offset="true"><span data-slate-string="true">  err := s.db.Where(</span></span></span><span data-slate-object="text" data-key="15223"><span data-slate-leaf="true" data-offset-key="15223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username = ? and name= ?"</span></span></span></span><span data-slate-object="text" data-key="15224"><span data-slate-leaf="true" data-offset-key="15224:0" data-first-offset="true"><span data-slate-string="true">, username, name).First(&amp;secret).Error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15225"><span data-slate-object="text" data-key="15226"><span data-slate-leaf="true" data-offset-key="15226:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15227"><span data-slate-leaf="true" data-offset-key="15227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15228"><span data-slate-leaf="true" data-offset-key="15228:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="15229"><span data-slate-leaf="true" data-offset-key="15229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15230"><span data-slate-leaf="true" data-offset-key="15230:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15231"><span data-slate-object="text" data-key="15232"><span data-slate-leaf="true" data-offset-key="15232:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15233"><span data-slate-leaf="true" data-offset-key="15233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15234"><span data-slate-leaf="true" data-offset-key="15234:0" data-first-offset="true"><span data-slate-string="true"> errors.Is(err, gorm.ErrRecordNotFound) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15235"><span data-slate-object="text" data-key="15236"><span data-slate-leaf="true" data-offset-key="15236:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="15237"><span data-slate-leaf="true" data-offset-key="15237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15238"><span data-slate-leaf="true" data-offset-key="15238:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15239"><span data-slate-leaf="true" data-offset-key="15239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15240"><span data-slate-leaf="true" data-offset-key="15240:0" data-first-offset="true"><span data-slate-string="true">, errors.WithCode(code.ErrSecretNotFound, err.Error())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15241"><span data-slate-object="text" data-key="15242"><span data-slate-leaf="true" data-offset-key="15242:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15243"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15244"><span data-slate-object="text" data-key="15245"><span data-slate-leaf="true" data-offset-key="15245:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15246"><span data-slate-leaf="true" data-offset-key="15246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15247"><span data-slate-leaf="true" data-offset-key="15247:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15248"><span data-slate-leaf="true" data-offset-key="15248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15249"><span data-slate-leaf="true" data-offset-key="15249:0" data-first-offset="true"><span data-slate-string="true">, errors.WithCode(code.ErrDatabase, err.Error())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15250"><span data-slate-object="text" data-key="15251"><span data-slate-leaf="true" data-offset-key="15251:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15252"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15253"><span data-slate-object="text" data-key="15254"><span data-slate-leaf="true" data-offset-key="15254:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15255"><span data-slate-leaf="true" data-offset-key="15255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15256"><span data-slate-leaf="true" data-offset-key="15256:0" data-first-offset="true"><span data-slate-string="true"> secret, </span></span></span><span data-slate-object="text" data-key="15257"><span data-slate-leaf="true" data-offset-key="15257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15258"><span data-slate-object="text" data-key="15259"><span data-slate-leaf="true" data-offset-key="15259:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15260"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15261"><span data-slate-object="text" data-key="15262"><span data-slate-leaf="true" data-offset-key="15262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// List return all secrets.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15263"><span data-slate-object="text" data-key="15264"><span data-slate-leaf="true" data-offset-key="15264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15265"><span data-slate-leaf="true" data-offset-key="15265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15266"><span data-slate-leaf="true" data-offset-key="15266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s *secrets)</span></span></span></span></span><span data-slate-object="text" data-key="15267"><span data-slate-leaf="true" data-offset-key="15267:0" data-first-offset="true"><span data-slate-string="true"> List(ctx context.Context, username </span></span></span><span data-slate-object="text" data-key="15268"><span data-slate-leaf="true" data-offset-key="15268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="15269"><span data-slate-leaf="true" data-offset-key="15269:0" data-first-offset="true"><span data-slate-string="true">, opts metav1.ListOptions) (*v1.SecretList, </span></span></span><span data-slate-object="text" data-key="15270"><span data-slate-leaf="true" data-offset-key="15270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="15271"><span data-slate-leaf="true" data-offset-key="15271:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15272"><span data-slate-object="text" data-key="15273"><span data-slate-leaf="true" data-offset-key="15273:0" data-first-offset="true"><span data-slate-string="true">  ret := &amp;v1.SecretList{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15274"><span data-slate-object="text" data-key="15275"><span data-slate-leaf="true" data-offset-key="15275:0" data-first-offset="true"><span data-slate-string="true">  ol := gormutil.Unpointer(opts.Offset, opts.Limit)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15276"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15277"><span data-slate-object="text" data-key="15278"><span data-slate-leaf="true" data-offset-key="15278:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15279"><span data-slate-leaf="true" data-offset-key="15279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15280"><span data-slate-leaf="true" data-offset-key="15280:0" data-first-offset="true"><span data-slate-string="true"> username != </span></span></span><span data-slate-object="text" data-key="15281"><span data-slate-leaf="true" data-offset-key="15281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="15282"><span data-slate-leaf="true" data-offset-key="15282:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15283"><span data-slate-object="text" data-key="15284"><span data-slate-leaf="true" data-offset-key="15284:0" data-first-offset="true"><span data-slate-string="true">    s.db = s.db.Where(</span></span></span><span data-slate-object="text" data-key="15285"><span data-slate-leaf="true" data-offset-key="15285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username = ?"</span></span></span></span><span data-slate-object="text" data-key="15286"><span data-slate-leaf="true" data-offset-key="15286:0" data-first-offset="true"><span data-slate-string="true">, username)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15287"><span data-slate-object="text" data-key="15288"><span data-slate-leaf="true" data-offset-key="15288:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15289"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15290"><span data-slate-object="text" data-key="15291"><span data-slate-leaf="true" data-offset-key="15291:0" data-first-offset="true"><span data-slate-string="true">  selector, _ := fields.ParseSelector(opts.FieldSelector)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15292"><span data-slate-object="text" data-key="15293"><span data-slate-leaf="true" data-offset-key="15293:0" data-first-offset="true"><span data-slate-string="true">  name, _ := selector.RequiresExactMatch(</span></span></span><span data-slate-object="text" data-key="15294"><span data-slate-leaf="true" data-offset-key="15294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="15295"><span data-slate-leaf="true" data-offset-key="15295:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15296"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15297"><span data-slate-object="text" data-key="15298"><span data-slate-leaf="true" data-offset-key="15298:0" data-first-offset="true"><span data-slate-string="true">  d := s.db.Where(</span></span></span><span data-slate-object="text" data-key="15299"><span data-slate-leaf="true" data-offset-key="15299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name like ?"</span></span></span></span><span data-slate-object="text" data-key="15300"><span data-slate-leaf="true" data-offset-key="15300:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15301"><span data-slate-leaf="true" data-offset-key="15301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%"</span></span></span></span><span data-slate-object="text" data-key="15302"><span data-slate-leaf="true" data-offset-key="15302:0" data-first-offset="true"><span data-slate-string="true">+name+</span></span></span><span data-slate-object="text" data-key="15303"><span data-slate-leaf="true" data-offset-key="15303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%"</span></span></span></span><span data-slate-object="text" data-key="15304"><span data-slate-leaf="true" data-offset-key="15304:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15305"><span data-slate-object="text" data-key="15306"><span data-slate-leaf="true" data-offset-key="15306:0" data-first-offset="true"><span data-slate-string="true">    Offset(ol.Offset).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15307"><span data-slate-object="text" data-key="15308"><span data-slate-leaf="true" data-offset-key="15308:0" data-first-offset="true"><span data-slate-string="true">    Limit(ol.Limit).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15309"><span data-slate-object="text" data-key="15310"><span data-slate-leaf="true" data-offset-key="15310:0" data-first-offset="true"><span data-slate-string="true">    Order(</span></span></span><span data-slate-object="text" data-key="15311"><span data-slate-leaf="true" data-offset-key="15311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"id desc"</span></span></span></span><span data-slate-object="text" data-key="15312"><span data-slate-leaf="true" data-offset-key="15312:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15313"><span data-slate-object="text" data-key="15314"><span data-slate-leaf="true" data-offset-key="15314:0" data-first-offset="true"><span data-slate-string="true">    Find(&amp;ret.Items).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15315"><span data-slate-object="text" data-key="15316"><span data-slate-leaf="true" data-offset-key="15316:0" data-first-offset="true"><span data-slate-string="true">    Offset(</span></span></span><span data-slate-object="text" data-key="15317"><span data-slate-leaf="true" data-offset-key="15317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="15318"><span data-slate-leaf="true" data-offset-key="15318:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15319"><span data-slate-object="text" data-key="15320"><span data-slate-leaf="true" data-offset-key="15320:0" data-first-offset="true"><span data-slate-string="true">    Limit(</span></span></span><span data-slate-object="text" data-key="15321"><span data-slate-leaf="true" data-offset-key="15321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="15322"><span data-slate-leaf="true" data-offset-key="15322:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15323"><span data-slate-object="text" data-key="15324"><span data-slate-leaf="true" data-offset-key="15324:0" data-first-offset="true"><span data-slate-string="true">    Count(&amp;ret.TotalCount)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15325"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15326"><span data-slate-object="text" data-key="15327"><span data-slate-leaf="true" data-offset-key="15327:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15328"><span data-slate-leaf="true" data-offset-key="15328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15329"><span data-slate-leaf="true" data-offset-key="15329:0" data-first-offset="true"><span data-slate-string="true"> ret, d.Error</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15330"><span data-slate-object="text" data-key="15331"><span data-slate-leaf="true" data-offset-key="15331:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15332"><span data-slate-object="text" data-key="15333"><span data-slate-leaf="true" data-offset-key="15333:0" data-first-offset="true"><span data-slate-string="true">上面的代码中， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15334"><span data-slate-object="text" data-key="15335"><span data-slate-leaf="true" data-offset-key="15335:0" data-first-offset="true"><span data-slate-string="true">s.db</span></span></span></span><span data-slate-object="text" data-key="15336"><span data-slate-leaf="true" data-offset-key="15336:0" data-first-offset="true"><span data-slate-string="true"> 就是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15337"><span data-slate-object="text" data-key="15338"><span data-slate-leaf="true" data-offset-key="15338:0" data-first-offset="true"><span data-slate-string="true">*gorm.DB</span></span></span></span><span data-slate-object="text" data-key="15339"><span data-slate-leaf="true" data-offset-key="15339:0" data-first-offset="true"><span data-slate-string="true"> 类型的字段。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15340"><span data-slate-object="text" data-key="15341"><span data-slate-leaf="true" data-offset-key="15341:0" data-first-offset="true"><span data-slate-string="true">上面的代码段执行了以下操作：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="15342"><div data-slate-type="list-line" data-slate-object="block" data-key="15343"><span data-slate-object="text" data-key="15344"><span data-slate-leaf="true" data-offset-key="15344:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15345"><span data-slate-object="text" data-key="15346"><span data-slate-leaf="true" data-offset-key="15346:0" data-first-offset="true"><span data-slate-string="true">s.db.Save</span></span></span></span><span data-slate-object="text" data-key="15347"><span data-slate-leaf="true" data-offset-key="15347:0" data-first-offset="true"><span data-slate-string="true"> 来更新数据库表的各字段；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="15348"><span data-slate-object="text" data-key="15349"><span data-slate-leaf="true" data-offset-key="15349:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15350"><span data-slate-object="text" data-key="15351"><span data-slate-leaf="true" data-offset-key="15351:0" data-first-offset="true"><span data-slate-string="true">s.db.Unscoped</span></span></span></span><span data-slate-object="text" data-key="15352"><span data-slate-leaf="true" data-offset-key="15352:0" data-first-offset="true"><span data-slate-string="true"> 来永久性从表中删除一行记录。对于支持软删除的资源，我们还可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15353"><span data-slate-object="text" data-key="15354"><span data-slate-leaf="true" data-offset-key="15354:0" data-first-offset="true"><span data-slate-string="true">opts.Unscoped</span></span></span></span><span data-slate-object="text" data-key="15355"><span data-slate-leaf="true" data-offset-key="15355:0" data-first-offset="true"><span data-slate-string="true"> 选项来控制是否永久删除记录。 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15356"><span data-slate-object="text" data-key="15357"><span data-slate-leaf="true" data-offset-key="15357:0" data-first-offset="true"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="15358"><span data-slate-leaf="true" data-offset-key="15358:0" data-first-offset="true"><span data-slate-string="true"> 永久删除， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15359"><span data-slate-object="text" data-key="15360"><span data-slate-leaf="true" data-offset-key="15360:0" data-first-offset="true"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="15361"><span data-slate-leaf="true" data-offset-key="15361:0" data-first-offset="true"><span data-slate-string="true"> 软删除，默认软删除。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="15362"><span data-slate-object="text" data-key="15363"><span data-slate-leaf="true" data-offset-key="15363:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15364"><span data-slate-object="text" data-key="15365"><span data-slate-leaf="true" data-offset-key="15365:0" data-first-offset="true"><span data-slate-string="true">errors.Is(err, gorm.ErrRecordNotFound)</span></span></span></span><span data-slate-object="text" data-key="15366"><span data-slate-leaf="true" data-offset-key="15366:0" data-first-offset="true"><span data-slate-string="true"> 来判断 GORM 返回的错误是否是没有找到记录的错误类型。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="15367"><span data-slate-object="text" data-key="15368"><span data-slate-leaf="true" data-offset-key="15368:0" data-first-offset="true"><span data-slate-string="true">通过下面两行代码，来获取查询条件 name 的值：</span></span></span></div></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15369"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15370"><span data-slate-object="text" data-key="15371"><span data-slate-leaf="true" data-offset-key="15371:0" data-first-offset="true"><span data-slate-string="true">selector, _ := fields.ParseSelector(opts.FieldSelector)    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15372"><span data-slate-object="text" data-key="15373"><span data-slate-leaf="true" data-offset-key="15373:0" data-first-offset="true"><span data-slate-string="true">name, _ := selector.RequiresExactMatch(</span></span></span><span data-slate-object="text" data-key="15374"><span data-slate-leaf="true" data-offset-key="15374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="15375"><span data-slate-leaf="true" data-offset-key="15375:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15376"><span data-slate-object="text" data-key="15377"><span data-slate-leaf="true" data-offset-key="15377:0" data-first-offset="true"><span data-slate-string="true">我们的整个调用链是：控制层 -&gt; 业务层 -&gt; 仓库层。这里你可能要问：</span></span></span><span data-slate-object="text" data-key="15378"><span data-slate-leaf="true" data-offset-key="15378:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">我们</span></span></span></span><span data-slate-object="text" data-key="15379"><span data-slate-leaf="true" data-offset-key="15379:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">是</span></span></span></span><span data-slate-object="text" data-key="15380"><span data-slate-leaf="true" data-offset-key="15380:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如何</span></span></span></span><span data-slate-object="text" data-key="15381"><span data-slate-leaf="true" data-offset-key="15381:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">调用</span></span></span></span><span data-slate-object="text" data-key="15382"><span data-slate-leaf="true" data-offset-key="15382:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">到</span></span></span></span><span data-slate-object="text" data-key="15383"><span data-slate-leaf="true" data-offset-key="15383:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">仓库层的</span></span></span></span><span data-slate-object="text" data-key="15384"><span data-slate-leaf="true" data-offset-key="15384:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">实例 mysqlFactory</span></span></span></span><span data-slate-object="text" data-key="15385"><span data-slate-leaf="true" data-offset-key="15385:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 的</span></span></span></span><span data-slate-object="text" data-key="15386"><span data-slate-leaf="true" data-offset-key="15386:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">呢？</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15387"><span data-slate-object="text" data-key="15388"><span data-slate-leaf="true" data-offset-key="15388:0" data-first-offset="true"><span data-slate-string="true">这是因为我们的控制层实例包含了业务层的实例。在创建控制层实例时，我们传入了业务层的实例：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15389"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15390"><span data-slate-object="text" data-key="15391"><span data-slate-leaf="true" data-offset-key="15391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="15392"><span data-slate-leaf="true" data-offset-key="15392:0" data-first-offset="true"><span data-slate-string="true"> UserController </span></span></span><span data-slate-object="text" data-key="15393"><span data-slate-leaf="true" data-offset-key="15393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="15394"><span data-slate-leaf="true" data-offset-key="15394:0" data-first-offset="true"><span data-slate-string="true"> {                                        </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15395"><span data-slate-object="text" data-key="15396"><span data-slate-leaf="true" data-offset-key="15396:0" data-first-offset="true"><span data-slate-string="true">    srv srvv1.Service                                                      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15397"><span data-slate-object="text" data-key="15398"><span data-slate-leaf="true" data-offset-key="15398:0" data-first-offset="true"><span data-slate-string="true">}                                                                          </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15399"><span data-slate-object="text" data-key="15400"><span data-slate-leaf="true" data-offset-key="15400:0" data-first-offset="true"><span data-slate-string="true">                                                                                            </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15401"><span data-slate-object="text" data-key="15402"><span data-slate-leaf="true" data-offset-key="15402:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// NewUserController creates a user handler.          </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15403"><span data-slate-object="text" data-key="15404"><span data-slate-leaf="true" data-offset-key="15404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15405"><span data-slate-leaf="true" data-offset-key="15405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15406"><span data-slate-leaf="true" data-offset-key="15406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewUserController</span></span></span></span></span><span data-slate-object="text" data-key="15407"><span data-slate-leaf="true" data-offset-key="15407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(store store.Factory)</span></span></span></span></span><span data-slate-object="text" data-key="15408"><span data-slate-leaf="true" data-offset-key="15408:0" data-first-offset="true"><span data-slate-string="true"> *UserController {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15409"><span data-slate-object="text" data-key="15410"><span data-slate-leaf="true" data-offset-key="15410:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15411"><span data-slate-leaf="true" data-offset-key="15411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15412"><span data-slate-leaf="true" data-offset-key="15412:0" data-first-offset="true"><span data-slate-string="true"> &amp;UserController{                                     </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15413"><span data-slate-object="text" data-key="15414"><span data-slate-leaf="true" data-offset-key="15414:0" data-first-offset="true"><span data-slate-string="true">        srv: srvv1.NewService(store),                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15415"><span data-slate-object="text" data-key="15416"><span data-slate-leaf="true" data-offset-key="15416:0" data-first-offset="true"><span data-slate-string="true">    }                                                      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15417"><span data-slate-object="text" data-key="15418"><span data-slate-leaf="true" data-offset-key="15418:0" data-first-offset="true"><span data-slate-string="true">} </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15419"><span data-slate-object="text" data-key="15420"><span data-slate-leaf="true" data-offset-key="15420:0" data-first-offset="true"><span data-slate-string="true">业务层的实例包含了仓库层的实例。在创建业务层实例时，传入了仓库层的实例：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15421"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15422"><span data-slate-object="text" data-key="15423"><span data-slate-leaf="true" data-offset-key="15423:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="15424"><span data-slate-leaf="true" data-offset-key="15424:0" data-first-offset="true"><span data-slate-string="true"> service </span></span></span><span data-slate-object="text" data-key="15425"><span data-slate-leaf="true" data-offset-key="15425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="15426"><span data-slate-leaf="true" data-offset-key="15426:0" data-first-offset="true"><span data-slate-string="true"> {                                                      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15427"><span data-slate-object="text" data-key="15428"><span data-slate-leaf="true" data-offset-key="15428:0" data-first-offset="true"><span data-slate-string="true">    store store.Factory                                                                     </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15429"><span data-slate-object="text" data-key="15430"><span data-slate-leaf="true" data-offset-key="15430:0" data-first-offset="true"><span data-slate-string="true">}                                                     </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15431"><span data-slate-object="text" data-key="15432"><span data-slate-leaf="true" data-offset-key="15432:0" data-first-offset="true"><span data-slate-string="true">                                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15433"><span data-slate-object="text" data-key="15434"><span data-slate-leaf="true" data-offset-key="15434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// NewService returns Service interface.                        </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15435"><span data-slate-object="text" data-key="15436"><span data-slate-leaf="true" data-offset-key="15436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15437"><span data-slate-leaf="true" data-offset-key="15437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15438"><span data-slate-leaf="true" data-offset-key="15438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewService</span></span></span></span></span><span data-slate-object="text" data-key="15439"><span data-slate-leaf="true" data-offset-key="15439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(store store.Factory)</span></span></span></span></span><span data-slate-object="text" data-key="15440"><span data-slate-leaf="true" data-offset-key="15440:0" data-first-offset="true"><span data-slate-string="true"> Service {                                    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15441"><span data-slate-object="text" data-key="15442"><span data-slate-leaf="true" data-offset-key="15442:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15443"><span data-slate-leaf="true" data-offset-key="15443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15444"><span data-slate-leaf="true" data-offset-key="15444:0" data-first-offset="true"><span data-slate-string="true"> &amp;service{                                       </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15445"><span data-slate-object="text" data-key="15446"><span data-slate-leaf="true" data-offset-key="15446:0" data-first-offset="true"><span data-slate-string="true">        store: store,                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15447"><span data-slate-object="text" data-key="15448"><span data-slate-leaf="true" data-offset-key="15448:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15449"><span data-slate-object="text" data-key="15450"><span data-slate-leaf="true" data-offset-key="15450:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15451"><span data-slate-object="text" data-key="15452"><span data-slate-leaf="true" data-offset-key="15452:0" data-first-offset="true"><span data-slate-string="true">通过这种包含关系，我们在控制层可以调用业务层的实例，在业务层又可以调用仓库层的实例。这样，我们最终通过仓库层实例的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15453"><span data-slate-object="text" data-key="15454"><span data-slate-leaf="true" data-offset-key="15454:0" data-first-offset="true"><span data-slate-string="true">db</span></span></span></span><span data-slate-object="text" data-key="15455"><span data-slate-leaf="true" data-offset-key="15455:0" data-first-offset="true"><span data-slate-string="true"> 字段（</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15456"><span data-slate-object="text" data-key="15457"><span data-slate-leaf="true" data-offset-key="15457:0" data-first-offset="true"><span data-slate-string="true">*gorm.DB</span></span></span></span><span data-slate-object="text" data-key="15458"><span data-slate-leaf="true" data-offset-key="15458:0" data-first-offset="true"><span data-slate-string="true"> 类型）完成数据库的 CURD 操作。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="15459" id="sr-toc-14"><span data-slate-object="text" data-key="15460"><span data-slate-leaf="true" data-offset-key="15460:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="15461"><span data-slate-object="text" data-key="15462"><span data-slate-leaf="true" data-offset-key="15462:0" data-first-offset="true"><span data-slate-string="true">在 Go 项目中，我们需要使用 ORM 来进行数据库的 CURD 操作。在 Go 生态中，当前最受欢迎的 ORM 是 GORM，IAM 项目也使用了 GORM。GORM 有很多功能，常用的功能有模型定义、连接数据库、创建记录、删除记录、更新记录和查询数据。这些常用功能的常见使用方式如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="15463"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15464"><span data-slate-object="text" data-key="15465"><span data-slate-leaf="true" data-offset-key="15465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="15466"><span data-slate-leaf="true" data-offset-key="15466:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15467"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15468"><span data-slate-object="text" data-key="15469"><span data-slate-leaf="true" data-offset-key="15469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="15470"><span data-slate-leaf="true" data-offset-key="15470:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15471"><span data-slate-object="text" data-key="15472"><span data-slate-leaf="true" data-offset-key="15472:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15473"><span data-slate-leaf="true" data-offset-key="15473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15474"><span data-slate-object="text" data-key="15475"><span data-slate-leaf="true" data-offset-key="15475:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15476"><span data-slate-leaf="true" data-offset-key="15476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15477"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15478"><span data-slate-object="text" data-key="15479"><span data-slate-leaf="true" data-offset-key="15479:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15480"><span data-slate-leaf="true" data-offset-key="15480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/spf13/pflag"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15481"><span data-slate-object="text" data-key="15482"><span data-slate-leaf="true" data-offset-key="15482:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15483"><span data-slate-leaf="true" data-offset-key="15483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"gorm.io/driver/mysql"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15484"><span data-slate-object="text" data-key="15485"><span data-slate-leaf="true" data-offset-key="15485:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15486"><span data-slate-leaf="true" data-offset-key="15486:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"gorm.io/gorm"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15487"><span data-slate-object="text" data-key="15488"><span data-slate-leaf="true" data-offset-key="15488:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15489"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15490"><span data-slate-object="text" data-key="15491"><span data-slate-leaf="true" data-offset-key="15491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="15492"><span data-slate-leaf="true" data-offset-key="15492:0" data-first-offset="true"><span data-slate-string="true"> Product </span></span></span><span data-slate-object="text" data-key="15493"><span data-slate-leaf="true" data-offset-key="15493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="15494"><span data-slate-leaf="true" data-offset-key="15494:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15495"><span data-slate-object="text" data-key="15496"><span data-slate-leaf="true" data-offset-key="15496:0" data-first-offset="true"><span data-slate-string="true">  gorm.Model</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15497"><span data-slate-object="text" data-key="15498"><span data-slate-leaf="true" data-offset-key="15498:0" data-first-offset="true"><span data-slate-string="true">  Code  </span></span></span><span data-slate-object="text" data-key="15499"><span data-slate-leaf="true" data-offset-key="15499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="15500"><span data-slate-leaf="true" data-offset-key="15500:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15501"><span data-slate-leaf="true" data-offset-key="15501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:code"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15502"><span data-slate-object="text" data-key="15503"><span data-slate-leaf="true" data-offset-key="15503:0" data-first-offset="true"><span data-slate-string="true">  Price </span></span></span><span data-slate-object="text" data-key="15504"><span data-slate-leaf="true" data-offset-key="15504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span><span data-slate-object="text" data-key="15505"><span data-slate-leaf="true" data-offset-key="15505:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="15506"><span data-slate-leaf="true" data-offset-key="15506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`gorm:"column:price"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15507"><span data-slate-object="text" data-key="15508"><span data-slate-leaf="true" data-offset-key="15508:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15509"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15510"><span data-slate-object="text" data-key="15511"><span data-slate-leaf="true" data-offset-key="15511:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// TableName maps to mysql table name.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15512"><span data-slate-object="text" data-key="15513"><span data-slate-leaf="true" data-offset-key="15513:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15514"><span data-slate-leaf="true" data-offset-key="15514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15515"><span data-slate-leaf="true" data-offset-key="15515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(p *Product)</span></span></span></span></span><span data-slate-object="text" data-key="15516"><span data-slate-leaf="true" data-offset-key="15516:0" data-first-offset="true"><span data-slate-string="true"> TableName() </span></span></span><span data-slate-object="text" data-key="15517"><span data-slate-leaf="true" data-offset-key="15517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="15518"><span data-slate-leaf="true" data-offset-key="15518:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15519"><span data-slate-object="text" data-key="15520"><span data-slate-leaf="true" data-offset-key="15520:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15521"><span data-slate-leaf="true" data-offset-key="15521:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15522"><span data-slate-leaf="true" data-offset-key="15522:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15523"><span data-slate-leaf="true" data-offset-key="15523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"product"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15524"><span data-slate-object="text" data-key="15525"><span data-slate-leaf="true" data-offset-key="15525:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15526"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15527"><span data-slate-object="text" data-key="15528"><span data-slate-leaf="true" data-offset-key="15528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="15529"><span data-slate-leaf="true" data-offset-key="15529:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15530"><span data-slate-object="text" data-key="15531"><span data-slate-leaf="true" data-offset-key="15531:0" data-first-offset="true"><span data-slate-string="true">  host     = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="15532"><span data-slate-leaf="true" data-offset-key="15532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"host"</span></span></span></span><span data-slate-object="text" data-key="15533"><span data-slate-leaf="true" data-offset-key="15533:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15534"><span data-slate-leaf="true" data-offset-key="15534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"H"</span></span></span></span><span data-slate-object="text" data-key="15535"><span data-slate-leaf="true" data-offset-key="15535:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15536"><span data-slate-leaf="true" data-offset-key="15536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"127.0.0.1:3306"</span></span></span></span><span data-slate-object="text" data-key="15537"><span data-slate-leaf="true" data-offset-key="15537:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15538"><span data-slate-leaf="true" data-offset-key="15538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"MySQL service host address"</span></span></span></span><span data-slate-object="text" data-key="15539"><span data-slate-leaf="true" data-offset-key="15539:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15540"><span data-slate-object="text" data-key="15541"><span data-slate-leaf="true" data-offset-key="15541:0" data-first-offset="true"><span data-slate-string="true">  username = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="15542"><span data-slate-leaf="true" data-offset-key="15542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="15543"><span data-slate-leaf="true" data-offset-key="15543:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15544"><span data-slate-leaf="true" data-offset-key="15544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"u"</span></span></span></span><span data-slate-object="text" data-key="15545"><span data-slate-leaf="true" data-offset-key="15545:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15546"><span data-slate-leaf="true" data-offset-key="15546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"root"</span></span></span></span><span data-slate-object="text" data-key="15547"><span data-slate-leaf="true" data-offset-key="15547:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15548"><span data-slate-leaf="true" data-offset-key="15548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Username for access to mysql service"</span></span></span></span><span data-slate-object="text" data-key="15549"><span data-slate-leaf="true" data-offset-key="15549:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15550"><span data-slate-object="text" data-key="15551"><span data-slate-leaf="true" data-offset-key="15551:0" data-first-offset="true"><span data-slate-string="true">  password = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="15552"><span data-slate-leaf="true" data-offset-key="15552:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"password"</span></span></span></span><span data-slate-object="text" data-key="15553"><span data-slate-leaf="true" data-offset-key="15553:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15554"><span data-slate-leaf="true" data-offset-key="15554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"p"</span></span></span></span><span data-slate-object="text" data-key="15555"><span data-slate-leaf="true" data-offset-key="15555:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15556"><span data-slate-leaf="true" data-offset-key="15556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"root"</span></span></span></span><span data-slate-object="text" data-key="15557"><span data-slate-leaf="true" data-offset-key="15557:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15558"><span data-slate-leaf="true" data-offset-key="15558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Password for access to mysql, should be used pair with password"</span></span></span></span><span data-slate-object="text" data-key="15559"><span data-slate-leaf="true" data-offset-key="15559:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15560"><span data-slate-object="text" data-key="15561"><span data-slate-leaf="true" data-offset-key="15561:0" data-first-offset="true"><span data-slate-string="true">  database = pflag.StringP(</span></span></span><span data-slate-object="text" data-key="15562"><span data-slate-leaf="true" data-offset-key="15562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"database"</span></span></span></span><span data-slate-object="text" data-key="15563"><span data-slate-leaf="true" data-offset-key="15563:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15564"><span data-slate-leaf="true" data-offset-key="15564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"d"</span></span></span></span><span data-slate-object="text" data-key="15565"><span data-slate-leaf="true" data-offset-key="15565:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15566"><span data-slate-leaf="true" data-offset-key="15566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"test"</span></span></span></span><span data-slate-object="text" data-key="15567"><span data-slate-leaf="true" data-offset-key="15567:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15568"><span data-slate-leaf="true" data-offset-key="15568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Database name to use"</span></span></span></span><span data-slate-object="text" data-key="15569"><span data-slate-leaf="true" data-offset-key="15569:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15570"><span data-slate-object="text" data-key="15571"><span data-slate-leaf="true" data-offset-key="15571:0" data-first-offset="true"><span data-slate-string="true">  help     = pflag.BoolP(</span></span></span><span data-slate-object="text" data-key="15572"><span data-slate-leaf="true" data-offset-key="15572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"help"</span></span></span></span><span data-slate-object="text" data-key="15573"><span data-slate-leaf="true" data-offset-key="15573:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15574"><span data-slate-leaf="true" data-offset-key="15574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"h"</span></span></span></span><span data-slate-object="text" data-key="15575"><span data-slate-leaf="true" data-offset-key="15575:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15576"><span data-slate-leaf="true" data-offset-key="15576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="15577"><span data-slate-leaf="true" data-offset-key="15577:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15578"><span data-slate-leaf="true" data-offset-key="15578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Print this help message"</span></span></span></span><span data-slate-object="text" data-key="15579"><span data-slate-leaf="true" data-offset-key="15579:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15580"><span data-slate-object="text" data-key="15581"><span data-slate-leaf="true" data-offset-key="15581:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15582"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15583"><span data-slate-object="text" data-key="15584"><span data-slate-leaf="true" data-offset-key="15584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15585"><span data-slate-leaf="true" data-offset-key="15585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15586"><span data-slate-leaf="true" data-offset-key="15586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="15587"><span data-slate-leaf="true" data-offset-key="15587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15588"><span data-slate-leaf="true" data-offset-key="15588:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15589"><span data-slate-object="text" data-key="15590"><span data-slate-leaf="true" data-offset-key="15590:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15591"><span data-slate-leaf="true" data-offset-key="15591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Parse command line flags</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15592"><span data-slate-object="text" data-key="15593"><span data-slate-leaf="true" data-offset-key="15593:0" data-first-offset="true"><span data-slate-string="true">  pflag.CommandLine.SortFlags = </span></span></span><span data-slate-object="text" data-key="15594"><span data-slate-leaf="true" data-offset-key="15594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15595"><span data-slate-object="text" data-key="15596"><span data-slate-leaf="true" data-offset-key="15596:0" data-first-offset="true"><span data-slate-string="true">  pflag.Usage = </span></span></span><span data-slate-object="text" data-key="15597"><span data-slate-leaf="true" data-offset-key="15597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15598"><span data-slate-leaf="true" data-offset-key="15598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="15599"><span data-slate-leaf="true" data-offset-key="15599:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15600"><span data-slate-object="text" data-key="15601"><span data-slate-leaf="true" data-offset-key="15601:0" data-first-offset="true"><span data-slate-string="true">    pflag.PrintDefaults()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15602"><span data-slate-object="text" data-key="15603"><span data-slate-leaf="true" data-offset-key="15603:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15604"><span data-slate-object="text" data-key="15605"><span data-slate-leaf="true" data-offset-key="15605:0" data-first-offset="true"><span data-slate-string="true">  pflag.Parse()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15606"><span data-slate-object="text" data-key="15607"><span data-slate-leaf="true" data-offset-key="15607:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15608"><span data-slate-leaf="true" data-offset-key="15608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15609"><span data-slate-leaf="true" data-offset-key="15609:0" data-first-offset="true"><span data-slate-string="true"> *help {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15610"><span data-slate-object="text" data-key="15611"><span data-slate-leaf="true" data-offset-key="15611:0" data-first-offset="true"><span data-slate-string="true">    pflag.Usage()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15612"><span data-slate-object="text" data-key="15613"><span data-slate-leaf="true" data-offset-key="15613:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15614"><span data-slate-leaf="true" data-offset-key="15614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15615"><span data-slate-object="text" data-key="15616"><span data-slate-leaf="true" data-offset-key="15616:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15617"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15618"><span data-slate-object="text" data-key="15619"><span data-slate-leaf="true" data-offset-key="15619:0" data-first-offset="true"><span data-slate-string="true">  dsn := fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="15620"><span data-slate-leaf="true" data-offset-key="15620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`%s:%s@tcp(%s)/%s?charset=utf8&amp;parseTime=%t&amp;loc=%s`</span></span></span></span><span data-slate-object="text" data-key="15621"><span data-slate-leaf="true" data-offset-key="15621:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15622"><span data-slate-object="text" data-key="15623"><span data-slate-leaf="true" data-offset-key="15623:0" data-first-offset="true"><span data-slate-string="true">    *username,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15624"><span data-slate-object="text" data-key="15625"><span data-slate-leaf="true" data-offset-key="15625:0" data-first-offset="true"><span data-slate-string="true">    *password,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15626"><span data-slate-object="text" data-key="15627"><span data-slate-leaf="true" data-offset-key="15627:0" data-first-offset="true"><span data-slate-string="true">    *host,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15628"><span data-slate-object="text" data-key="15629"><span data-slate-leaf="true" data-offset-key="15629:0" data-first-offset="true"><span data-slate-string="true">    *database,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15630"><span data-slate-object="text" data-key="15631"><span data-slate-leaf="true" data-offset-key="15631:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15632"><span data-slate-leaf="true" data-offset-key="15632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="15633"><span data-slate-leaf="true" data-offset-key="15633:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15634"><span data-slate-object="text" data-key="15635"><span data-slate-leaf="true" data-offset-key="15635:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15636"><span data-slate-leaf="true" data-offset-key="15636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Local"</span></span></span></span><span data-slate-object="text" data-key="15637"><span data-slate-leaf="true" data-offset-key="15637:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15638"><span data-slate-object="text" data-key="15639"><span data-slate-leaf="true" data-offset-key="15639:0" data-first-offset="true"><span data-slate-string="true">  db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15640"><span data-slate-object="text" data-key="15641"><span data-slate-leaf="true" data-offset-key="15641:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15642"><span data-slate-leaf="true" data-offset-key="15642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15643"><span data-slate-leaf="true" data-offset-key="15643:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="15644"><span data-slate-leaf="true" data-offset-key="15644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15645"><span data-slate-leaf="true" data-offset-key="15645:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15646"><span data-slate-object="text" data-key="15647"><span data-slate-leaf="true" data-offset-key="15647:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15648"><span data-slate-leaf="true" data-offset-key="15648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">panic</span></span></span></span><span data-slate-object="text" data-key="15649"><span data-slate-leaf="true" data-offset-key="15649:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15650"><span data-slate-leaf="true" data-offset-key="15650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"failed to connect database"</span></span></span></span><span data-slate-object="text" data-key="15651"><span data-slate-leaf="true" data-offset-key="15651:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15652"><span data-slate-object="text" data-key="15653"><span data-slate-leaf="true" data-offset-key="15653:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15654"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15655"><span data-slate-object="text" data-key="15656"><span data-slate-leaf="true" data-offset-key="15656:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15657"><span data-slate-leaf="true" data-offset-key="15657:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1. Auto migration for given models</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15658"><span data-slate-object="text" data-key="15659"><span data-slate-leaf="true" data-offset-key="15659:0" data-first-offset="true"><span data-slate-string="true">  db.AutoMigrate(&amp;Product{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15660"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15661"><span data-slate-object="text" data-key="15662"><span data-slate-leaf="true" data-offset-key="15662:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15663"><span data-slate-leaf="true" data-offset-key="15663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 2. Insert the value into database</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15664"><span data-slate-object="text" data-key="15665"><span data-slate-leaf="true" data-offset-key="15665:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15666"><span data-slate-leaf="true" data-offset-key="15666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15667"><span data-slate-leaf="true" data-offset-key="15667:0" data-first-offset="true"><span data-slate-string="true"> err := db.Create(&amp;Product{Code: </span></span></span><span data-slate-object="text" data-key="15668"><span data-slate-leaf="true" data-offset-key="15668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="15669"><span data-slate-leaf="true" data-offset-key="15669:0" data-first-offset="true"><span data-slate-string="true">, Price: </span></span></span><span data-slate-object="text" data-key="15670"><span data-slate-leaf="true" data-offset-key="15670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="15671"><span data-slate-leaf="true" data-offset-key="15671:0" data-first-offset="true"><span data-slate-string="true">}).Error; err != </span></span></span><span data-slate-object="text" data-key="15672"><span data-slate-leaf="true" data-offset-key="15672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15673"><span data-slate-leaf="true" data-offset-key="15673:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15674"><span data-slate-object="text" data-key="15675"><span data-slate-leaf="true" data-offset-key="15675:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15676"><span data-slate-leaf="true" data-offset-key="15676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Create error: %v"</span></span></span></span><span data-slate-object="text" data-key="15677"><span data-slate-leaf="true" data-offset-key="15677:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15678"><span data-slate-object="text" data-key="15679"><span data-slate-leaf="true" data-offset-key="15679:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15680"><span data-slate-object="text" data-key="15681"><span data-slate-leaf="true" data-offset-key="15681:0" data-first-offset="true"><span data-slate-string="true">  PrintProducts(db)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15682"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15683"><span data-slate-object="text" data-key="15684"><span data-slate-leaf="true" data-offset-key="15684:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15685"><span data-slate-leaf="true" data-offset-key="15685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 3. Find first record that match given conditions</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15686"><span data-slate-object="text" data-key="15687"><span data-slate-leaf="true" data-offset-key="15687:0" data-first-offset="true"><span data-slate-string="true">  product := &amp;Product{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15688"><span data-slate-object="text" data-key="15689"><span data-slate-leaf="true" data-offset-key="15689:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15690"><span data-slate-leaf="true" data-offset-key="15690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15691"><span data-slate-leaf="true" data-offset-key="15691:0" data-first-offset="true"><span data-slate-string="true"> err := db.Where(</span></span></span><span data-slate-object="text" data-key="15692"><span data-slate-leaf="true" data-offset-key="15692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code= ?"</span></span></span></span><span data-slate-object="text" data-key="15693"><span data-slate-leaf="true" data-offset-key="15693:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15694"><span data-slate-leaf="true" data-offset-key="15694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="15695"><span data-slate-leaf="true" data-offset-key="15695:0" data-first-offset="true"><span data-slate-string="true">).First(&amp;product).Error; err != </span></span></span><span data-slate-object="text" data-key="15696"><span data-slate-leaf="true" data-offset-key="15696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15697"><span data-slate-leaf="true" data-offset-key="15697:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15698"><span data-slate-object="text" data-key="15699"><span data-slate-leaf="true" data-offset-key="15699:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15700"><span data-slate-leaf="true" data-offset-key="15700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Get product error: %v"</span></span></span></span><span data-slate-object="text" data-key="15701"><span data-slate-leaf="true" data-offset-key="15701:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15702"><span data-slate-object="text" data-key="15703"><span data-slate-leaf="true" data-offset-key="15703:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15704"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15705"><span data-slate-object="text" data-key="15706"><span data-slate-leaf="true" data-offset-key="15706:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15707"><span data-slate-leaf="true" data-offset-key="15707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 4. Update value in database, if the value doesn't have primary key, will insert it</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15708"><span data-slate-object="text" data-key="15709"><span data-slate-leaf="true" data-offset-key="15709:0" data-first-offset="true"><span data-slate-string="true">  product.Price = </span></span></span><span data-slate-object="text" data-key="15710"><span data-slate-leaf="true" data-offset-key="15710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15711"><span data-slate-object="text" data-key="15712"><span data-slate-leaf="true" data-offset-key="15712:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15713"><span data-slate-leaf="true" data-offset-key="15713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15714"><span data-slate-leaf="true" data-offset-key="15714:0" data-first-offset="true"><span data-slate-string="true"> err := db.Save(product).Error; err != </span></span></span><span data-slate-object="text" data-key="15715"><span data-slate-leaf="true" data-offset-key="15715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15716"><span data-slate-leaf="true" data-offset-key="15716:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15717"><span data-slate-object="text" data-key="15718"><span data-slate-leaf="true" data-offset-key="15718:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15719"><span data-slate-leaf="true" data-offset-key="15719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Update product error: %v"</span></span></span></span><span data-slate-object="text" data-key="15720"><span data-slate-leaf="true" data-offset-key="15720:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15721"><span data-slate-object="text" data-key="15722"><span data-slate-leaf="true" data-offset-key="15722:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15723"><span data-slate-object="text" data-key="15724"><span data-slate-leaf="true" data-offset-key="15724:0" data-first-offset="true"><span data-slate-string="true">  PrintProducts(db)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15725"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15726"><span data-slate-object="text" data-key="15727"><span data-slate-leaf="true" data-offset-key="15727:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15728"><span data-slate-leaf="true" data-offset-key="15728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 5. Delete value match given conditions</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15729"><span data-slate-object="text" data-key="15730"><span data-slate-leaf="true" data-offset-key="15730:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15731"><span data-slate-leaf="true" data-offset-key="15731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15732"><span data-slate-leaf="true" data-offset-key="15732:0" data-first-offset="true"><span data-slate-string="true"> err := db.Where(</span></span></span><span data-slate-object="text" data-key="15733"><span data-slate-leaf="true" data-offset-key="15733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code = ?"</span></span></span></span><span data-slate-object="text" data-key="15734"><span data-slate-leaf="true" data-offset-key="15734:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15735"><span data-slate-leaf="true" data-offset-key="15735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"D42"</span></span></span></span><span data-slate-object="text" data-key="15736"><span data-slate-leaf="true" data-offset-key="15736:0" data-first-offset="true"><span data-slate-string="true">).Delete(&amp;Product{}).Error; err != </span></span></span><span data-slate-object="text" data-key="15737"><span data-slate-leaf="true" data-offset-key="15737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15738"><span data-slate-leaf="true" data-offset-key="15738:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15739"><span data-slate-object="text" data-key="15740"><span data-slate-leaf="true" data-offset-key="15740:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15741"><span data-slate-leaf="true" data-offset-key="15741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Delete product error: %v"</span></span></span></span><span data-slate-object="text" data-key="15742"><span data-slate-leaf="true" data-offset-key="15742:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15743"><span data-slate-object="text" data-key="15744"><span data-slate-leaf="true" data-offset-key="15744:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15745"><span data-slate-object="text" data-key="15746"><span data-slate-leaf="true" data-offset-key="15746:0" data-first-offset="true"><span data-slate-string="true">  PrintProducts(db)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15747"><span data-slate-object="text" data-key="15748"><span data-slate-leaf="true" data-offset-key="15748:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15749"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15750"><span data-slate-object="text" data-key="15751"><span data-slate-leaf="true" data-offset-key="15751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// List products</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15752"><span data-slate-object="text" data-key="15753"><span data-slate-leaf="true" data-offset-key="15753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="15754"><span data-slate-leaf="true" data-offset-key="15754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15755"><span data-slate-leaf="true" data-offset-key="15755:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PrintProducts</span></span></span></span></span><span data-slate-object="text" data-key="15756"><span data-slate-leaf="true" data-offset-key="15756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(db *gorm.DB)</span></span></span></span></span><span data-slate-object="text" data-key="15757"><span data-slate-leaf="true" data-offset-key="15757:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15758"><span data-slate-object="text" data-key="15759"><span data-slate-leaf="true" data-offset-key="15759:0" data-first-offset="true"><span data-slate-string="true">  products := </span></span></span><span data-slate-object="text" data-key="15760"><span data-slate-leaf="true" data-offset-key="15760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="15761"><span data-slate-leaf="true" data-offset-key="15761:0" data-first-offset="true"><span data-slate-string="true">([]*Product, </span></span></span><span data-slate-object="text" data-key="15762"><span data-slate-leaf="true" data-offset-key="15762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15763"><span data-slate-leaf="true" data-offset-key="15763:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15764"><span data-slate-object="text" data-key="15765"><span data-slate-leaf="true" data-offset-key="15765:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15766"><span data-slate-leaf="true" data-offset-key="15766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="15767"><span data-slate-leaf="true" data-offset-key="15767:0" data-first-offset="true"><span data-slate-string="true"> count </span></span></span><span data-slate-object="text" data-key="15768"><span data-slate-leaf="true" data-offset-key="15768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15769"><span data-slate-object="text" data-key="15770"><span data-slate-leaf="true" data-offset-key="15770:0" data-first-offset="true"><span data-slate-string="true">  d := db.Where(</span></span></span><span data-slate-object="text" data-key="15771"><span data-slate-leaf="true" data-offset-key="15771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"code like ?"</span></span></span></span><span data-slate-object="text" data-key="15772"><span data-slate-leaf="true" data-offset-key="15772:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15773"><span data-slate-leaf="true" data-offset-key="15773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%D%"</span></span></span></span><span data-slate-object="text" data-key="15774"><span data-slate-leaf="true" data-offset-key="15774:0" data-first-offset="true"><span data-slate-string="true">).Offset(</span></span></span><span data-slate-object="text" data-key="15775"><span data-slate-leaf="true" data-offset-key="15775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15776"><span data-slate-leaf="true" data-offset-key="15776:0" data-first-offset="true"><span data-slate-string="true">).Limit(</span></span></span><span data-slate-object="text" data-key="15777"><span data-slate-leaf="true" data-offset-key="15777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="15778"><span data-slate-leaf="true" data-offset-key="15778:0" data-first-offset="true"><span data-slate-string="true">).Order(</span></span></span><span data-slate-object="text" data-key="15779"><span data-slate-leaf="true" data-offset-key="15779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"id desc"</span></span></span></span><span data-slate-object="text" data-key="15780"><span data-slate-leaf="true" data-offset-key="15780:0" data-first-offset="true"><span data-slate-string="true">).Find(&amp;products).Offset(</span></span></span><span data-slate-object="text" data-key="15781"><span data-slate-leaf="true" data-offset-key="15781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="15782"><span data-slate-leaf="true" data-offset-key="15782:0" data-first-offset="true"><span data-slate-string="true">).Limit(</span></span></span><span data-slate-object="text" data-key="15783"><span data-slate-leaf="true" data-offset-key="15783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="15784"><span data-slate-leaf="true" data-offset-key="15784:0" data-first-offset="true"><span data-slate-string="true">).Count(&amp;count)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15785"><span data-slate-object="text" data-key="15786"><span data-slate-leaf="true" data-offset-key="15786:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15787"><span data-slate-leaf="true" data-offset-key="15787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15788"><span data-slate-leaf="true" data-offset-key="15788:0" data-first-offset="true"><span data-slate-string="true"> d.Error != </span></span></span><span data-slate-object="text" data-key="15789"><span data-slate-leaf="true" data-offset-key="15789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="15790"><span data-slate-leaf="true" data-offset-key="15790:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15791"><span data-slate-object="text" data-key="15792"><span data-slate-leaf="true" data-offset-key="15792:0" data-first-offset="true"><span data-slate-string="true">    log.Fatalf(</span></span></span><span data-slate-object="text" data-key="15793"><span data-slate-leaf="true" data-offset-key="15793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"List products error: %v"</span></span></span></span><span data-slate-object="text" data-key="15794"><span data-slate-leaf="true" data-offset-key="15794:0" data-first-offset="true"><span data-slate-string="true">, d.Error)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15795"><span data-slate-object="text" data-key="15796"><span data-slate-leaf="true" data-offset-key="15796:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15797"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15798"><span data-slate-object="text" data-key="15799"><span data-slate-leaf="true" data-offset-key="15799:0" data-first-offset="true"><span data-slate-string="true">  log.Printf(</span></span></span><span data-slate-object="text" data-key="15800"><span data-slate-leaf="true" data-offset-key="15800:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"totalcount: %d"</span></span></span></span><span data-slate-object="text" data-key="15801"><span data-slate-leaf="true" data-offset-key="15801:0" data-first-offset="true"><span data-slate-string="true">, count)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15802"><span data-slate-object="text" data-key="15803"><span data-slate-leaf="true" data-offset-key="15803:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="15804"><span data-slate-leaf="true" data-offset-key="15804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15805"><span data-slate-leaf="true" data-offset-key="15805:0" data-first-offset="true"><span data-slate-string="true"> _, product := </span></span></span><span data-slate-object="text" data-key="15806"><span data-slate-leaf="true" data-offset-key="15806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="15807"><span data-slate-leaf="true" data-offset-key="15807:0" data-first-offset="true"><span data-slate-string="true"> products {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15808"><span data-slate-object="text" data-key="15809"><span data-slate-leaf="true" data-offset-key="15809:0" data-first-offset="true"><span data-slate-string="true">    log.Printf(</span></span></span><span data-slate-object="text" data-key="15810"><span data-slate-leaf="true" data-offset-key="15810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\tcode: %s, price: %d\n"</span></span></span></span><span data-slate-object="text" data-key="15811"><span data-slate-leaf="true" data-offset-key="15811:0" data-first-offset="true"><span data-slate-string="true">, product.Code, product.Price)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15812"><span data-slate-object="text" data-key="15813"><span data-slate-leaf="true" data-offset-key="15813:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15814"><span data-slate-object="text" data-key="15815"><span data-slate-leaf="true" data-offset-key="15815:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15816"><span data-slate-object="text" data-key="15817"><span data-slate-leaf="true" data-offset-key="15817:0" data-first-offset="true"><span data-slate-string="true">此外，GORM 还支持原生查询 SQL 和原生执行 SQL，可以满足更加复杂的 SQL 场景。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15818"><span data-slate-object="text" data-key="15819"><span data-slate-leaf="true" data-offset-key="15819:0" data-first-offset="true"><span data-slate-string="true">GORM 中，还有一个非常有用的功能是支持 Hooks。Hooks 可以在执行某个 CURD 操作前被调用。在 Hook 中，可以添加一些非常有用的功能，例如生成唯一 ID。目前，GORM 支持 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15820"><span data-slate-object="text" data-key="15821"><span data-slate-leaf="true" data-offset-key="15821:0" data-first-offset="true"><span data-slate-string="true">BeforeXXX</span></span></span></span><span data-slate-object="text" data-key="15822"><span data-slate-leaf="true" data-offset-key="15822:0" data-first-offset="true"><span data-slate-string="true"> 、 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15823"><span data-slate-object="text" data-key="15824"><span data-slate-leaf="true" data-offset-key="15824:0" data-first-offset="true"><span data-slate-string="true">AfterXXX</span></span></span></span><span data-slate-object="text" data-key="15825"><span data-slate-leaf="true" data-offset-key="15825:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15826"><span data-slate-object="text" data-key="15827"><span data-slate-leaf="true" data-offset-key="15827:0" data-first-offset="true"><span data-slate-string="true">AfterFind</span></span></span></span><span data-slate-object="text" data-key="15828"><span data-slate-leaf="true" data-offset-key="15828:0" data-first-offset="true"><span data-slate-string="true"> Hook，其中 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="15829"><span data-slate-object="text" data-key="15830"><span data-slate-leaf="true" data-offset-key="15830:0" data-first-offset="true"><span data-slate-string="true">XXX</span></span></span></span><span data-slate-object="text" data-key="15831"><span data-slate-leaf="true" data-offset-key="15831:0" data-first-offset="true"><span data-slate-string="true"> 可以是 Save、Create、Delete、Update。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15832"><span data-slate-object="text" data-key="15833"><span data-slate-leaf="true" data-offset-key="15833:0" data-first-offset="true"><span data-slate-string="true">最后，我还介绍了 IAM 项目的 GORM 实战，具体使用方式跟总结中的示例代码大体保持一致，你可以返回文稿查看。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="15834" id="sr-toc-15"><span data-slate-object="text" data-key="15835"><span data-slate-leaf="true" data-offset-key="15835:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="15836"><div data-slate-type="list-line" data-slate-object="block" data-key="15837"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="15838"><span data-slate-leaf="true" data-offset-key="15838:0" data-first-offset="true"><span data-slate-string="true">GORM 支持 AutoMigrate 功能，思考下，你的生产环境是否可以使用 AutoMigrate 功能，为什么？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="15839"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="15840"><span data-slate-leaf="true" data-offset-key="15840:0" data-first-offset="true"><span data-slate-string="true">查看 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="15841"><span data-slate-object="text" data-key="15842"><span data-slate-leaf="true" data-offset-key="15842:0" data-first-offset="true"><span data-slate-string="true">GORM 官方文档</span></span></span></a><span data-slate-object="text" data-key="15843"><span data-slate-leaf="true" data-offset-key="15843:0" data-first-offset="true"><span data-slate-string="true">，看下如何用 GORM 实现事务回滚功能。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15844"><span data-slate-object="text" data-key="15845"><span data-slate-leaf="true" data-offset-key="15845:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>15</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-16">精选留言 (22)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Sch0ng</span></div></div><div>go 语言中，orm 使用 gorm 包。
gorm 功能全，操作界面符合直觉，不需要额外的理解负担。</div><div><p>作者回复：是这样的，老哥学习课程很认真！</p></div><div><div>2021-08-16</div><div><div><i></i></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
1. 首先定义一个 GORM 模型（Models），GORM 模型就是一个普普通通的 golang struct。使用结构体名的 snake_cases 作为表名，使用字段名的 snake_case 作为列名。
2. gorm.Model 为表增加了 ID、CreatedAt、UpdatedAt、DeletedAt 等字段。如果是资源表，建议统一资源的元数据。参见第 29 章节。
3. 在结构体中，通过 tag，指定数据库中字段的名称。
4. gorm 支持表 CRUD 操作，每种操作也会有各种变形，与 数据库操作相对应。
</div><div><p>作者回复: 6666</p></div><div><div>2021-12-03</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/21/5f/e2/e6d3d9bf.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>XI</span></div></div><div>go 的连接池网上教程有点少，go 连接 redis,monggodb 应该都需要连接池，gorm 官方文档连接池的讲解也是寥寥数语，老师能不能详细补充点连接池相关的，如何使用，如果能再加上 redis ，mongdb 的连接池一类的就更好了</div><div><p>作者回复：回头整理下。</p></div><div><div>2021-10-12</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/20/1e/18/9d1f1439.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>liaomars</span></div></div><div>老师：
sqlDB.SetMaxIdleConns (10)              // 设置 MySQL 的最大空闲连接数（推荐 100）
这个最大空闲连接数是 10 还是 100？代码写的是 10，注释写的是 100</div><div><p>作者回复: 100 哈，代码我找编辑更正下。</p></div><div><div>2021-12-03</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span> 刘世杰</span></div></div><div>老师您好，
我在使用 github.com/go-xorm/xorm 这个包连接 mycat 的时候
当我执行带？号的 sql 语句时出现 {"Number":1047,"Message":"Prepare unsupported!"} 报错
我应该怎么配置连接信息呢？
以下是我的数据库连接信息
user:pass@tcp (127.0.0.1:3306)/db?charset=utf8&amp;interpolateparams=true
以下是我执行的代码
engine := model.Get ()
uid := 1
var list [] model.User
res1 := engine.SQL ("select * from tr_user where id = ?", uid).Find (&amp;list)
res := engine.SQL ("select * from tr_user where id = 1").Find (&amp;list)
data := map [string] interface {}{
	"userid": con.Uid,
	"res": res,
	"res1": res1,
	"list": list,
}
以上 res1 打印的信息是 "res1":{"Number":1047,"Message":"Prepare unsupported!"}
res 运行的 sql 能够正常运行
直连数据库的时候，本地连接数据库，以上代码均正常
使用 mycat 时，无法正常执行 sql
网上看了一些文档，说是 interpolateparams 这个参数的问题，但是我试了都没有用</div><div><p>作者回复：没用过 github.com/go-xorm/xorm 这个包。

建议使用 gorm 包哈，有问题可以问我，这个包我熟悉</p></div><div><div>2021-11-26</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 徐海浪</span></div></div><div>生产环境不应该使用 AutoMigrate，除非有靠谱的 code review 流程，否则随着协作的人数越多，越容易失控</div><div><p>作者回复：是的，生产环境最好别使用 AutoMigrate</p></div><div><div>2021-11-23</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>helloworld</span></div></div><div>测试发现项目中的软删除功能不起作用，需要将源码
https://github.com/marmotedu/component-base/blob/master/pkg/meta/v1/types.go 中的
DeletedAt *time.Time `json:"-"gorm:"column:deletedAt;index:idx_deletedAt"` 
改为: 	
DeletedAt gorm.DeletedAt `json:"-"gorm:"index;column:deletedAt"`

</div><div><p>作者回复：感谢反馈，我修复下</p></div><div><div>2021-11-09</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>helloworld</span></div></div><div>看了下 iam 启动过程的源码，发现依赖的 mysql 实例获取不到也不会退出程序，个人感觉这样设计是否更好：写两个函数，一个用来初始化 mysql 单例，一个用来获取 mysql 单例，在 server 的 Preparerun 函数中来初始化，初始化失败则退出程序提示用户，在 router 中来获取已经初始化过的 mysql 单例，这样感觉更清晰一些～</div><div><p>作者回复: GetMySQLFactoryOr 这个函数如果实例不存在会返回 err，这个地方你可以根据需要，判断 err 是否为 nil，如果！=nil，可以终止程序。

iam 之所以没有退出，原因如下：
1. 后续在执行请求时，如果初始化数据库失败，请求会报错，也就是说，如果初始化数据库失败，一定能够被感知到，并被修复。
2. 当时是方便测试吧，数据库初始化失败，不会影响程序启动，不会影响其他功能。</p></div><div><div>2021-11-04</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/80/67/4e381da5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Derek</span></div></div><div>老师，拿要是连接多个数据库，不同的 struct 使用不同的库要怎么搞，是不是要初始化好几个连接，然后指定一下 struct 用的库？</div><div><p>作者回复：可以这么来定义下：
// Factory defines the iam platform storage interface.    
type DBIns2Store interface {Users () UserStore
    Secrets () SecretStore
    Policies () PolicyStore
    Close () error
}

type DBIns2Store interface { 
}

type Factory interface {               
    DBIns1Store DBIns2Store                                                           
    DBIns2Store DBIns2Store                            
}</p></div><div><div>2021-10-27</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/14/5b/a1656a72.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 潘达</span></div></div><div>gorm 下是否有从表中直接生成 struct 的工具呢，xorm 下的反向生成工具还是挺实用的</div><div><p>作者回复：试试这个：https://github.com/Shelnutt2/db2struct</p></div><div><div>2021-09-15</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>helloworld</span></div></div><div>“如果没有指定表名，则 GORM 使用结构体名的蛇形复数作为表名。例如：结构体名为 DockerInstance ，则表名为 dockerInstances 。”，蛇形不是下划线连接吗</div><div><p>作者回复：这里写的有问题，我找编辑更新下，感谢反馈</p></div><div><div>2021-08-12</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/a5/5b/164dc7d2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 二三闲语</span></div></div><div>怎么配置主从，多库</div><div><p>作者回复：主从，是 mysql 实例层保证的，应用层可以不用关注。

多库，可以参照现有的实现，在 Store 层添加一个新的 db 实例</p></div><div><div>2021-08-09</div><div><div><i></i><span>3</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 友</span></div></div><div>目前用过几款 orm。有 beego 自带的  gorm ent</div><div><div>2021-08-03</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 那时刻</span></div></div><div>请问老师，在链接数据库 New 方法里，是否要调用下 sqlDB.ping 来确定链接是否成功呢？</div><div><p>作者回复：不用哈，如果没连接成功功能测试时，你是能感觉到的，那时候可以修复下。

不过加上也可以</p></div><div><div>2021-08-03</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>GORM 支持 AutoMigrate 功能，思考下，你的生产环境是否可以使用 AutoMigrate 功能，为什么？

肯定不能啊，生产环境严格的要死，提交的 SQL 都要一圈的审核，怎么能直接偏移，爆炸了年奖全都没了</div><div><p>作者回复：是的呀，最好别用 AutoMigrate</p></div><div><div>2021-08-03</div><div><div><i></i><span>3</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/d7/f1/ce10759d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>wei 丶</span></div></div><div>孔大，ent 咋样 有没有 ent 的讲解呢 👀</div><div><div>2022-08-01</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>左耳朵东</span></div></div><div>“接着，在 PrepareRun 函数中，调用 GetMySQLFactoryOr 函数，初始化并获取仓库层的实例 mysqlFactory” 
PrepareRun 函数中调用 GetMySQLFactoryOr 获取的仓库层实例是为了在优雅关停时关闭数据库，初始化仓库层实例步骤是在这个方法里完成的：func (c *completedExtraConfig) New () (*grpcAPIServer, error)</div><div><div>2022-05-11</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1b/8e/62/5cb377fd.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>yangchnet</span></div></div><div>问题：
1. 请问老师了解 sqlc 这个包吗
2. 数据库版本迁移老师有没有靠谱好用的工具推荐</div><div><p>作者回复: 1. 不了解
2. MySQL 数据库迁移吗，这个可以 github 上或者网上搜索下，如何搜索，可以参考：结束语 | 如何让自己的 Go 研发之路走得更远？里面如何选择开源项目的指南</p></div><div><div>2022-02-08</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>geek_geek</span></div></div><div>老是请问事物怎么启动？</div><div><div>2021-12-23</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/8f/61/cf0d0a95.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>huining</span></div></div><div>如果按照这样写，那用不了事务啊，比如老师的代码里删除用户时，是先调用 polices.delete (), 然后再 delete 用户，那假如中途出错，也无法回滚。我的做法是再加一个 * DB 参数，但是感觉写起来很丑，方法里要判断之前是否启动了事务。所以如果想要添加对事务的支持应该怎么做呢？</div><div><p>作者回复：如果要用事务，肯定是要传 * db 参数。

或者在失败时调用 defer func () {s.srv.Delete ()}() 这样的语句，来回滚</p></div><div><div>2021-12-15</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".s"><outline class="toc-level-h1" data-reactid=".s.0" style="width: 175px;"><active data-reactid=".s.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".s.0.1"><span data-reactid=".s.0.1.0"> 30 | ORM：CURD 神器 GORM 包介绍及实战</span></a></outline><outline class="toc-level-h2" data-reactid=".s.1" style="width: 165px;"><active data-reactid=".s.1.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".s.1.1"><span data-reactid=".s.1.1.0">GORM 基础知识介绍</span></a></outline><outline class="toc-level-h2" data-reactid=".s.2" style="width: 165px;"><active data-reactid=".s.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".s.2.1"><span data-reactid=".s.2.1.0">通过示例学习 GORM</span></a></outline><outline class="toc-level-h2" data-reactid=".s.3" style="width: 165px;"><active data-reactid=".s.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".s.3.1"><span data-reactid=".s.3.1.0">GORM 常用操作讲解</span></a></outline><outline class="toc-level-h3" data-reactid=".s.4" style="width: 155px;"><active data-reactid=".s.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".s.4.1"><span data-reactid=".s.4.1.0">模型定义</span></a></outline><outline class="toc-level-h3" data-reactid=".s.5" style="width: 155px;"><active data-reactid=".s.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".s.5.1"><span data-reactid=".s.5.1.0">连接数据库</span></a></outline><outline class="toc-level-h3" data-reactid=".s.6" style="width: 155px;"><active data-reactid=".s.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".s.6.1"><span data-reactid=".s.6.1.0">创建记录</span></a></outline><outline class="toc-level-h3" data-reactid=".s.7" style="width: 155px;"><active data-reactid=".s.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".s.7.1"><span data-reactid=".s.7.1.0">删除记录</span></a></outline><outline class="toc-level-h3" data-reactid=".s.8" style="width: 155px;"><active data-reactid=".s.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".s.8.1"><span data-reactid=".s.8.1.0">更新记录</span></a></outline><outline class="toc-level-h3" data-reactid=".s.9" style="width: 155px;"><active data-reactid=".s.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".s.9.1"><span data-reactid=".s.9.1.0">查询数据</span></a></outline><outline class="toc-level-h3" data-reactid=".s.a" style="width: 155px;"><active data-reactid=".s.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".s.a.1"><span data-reactid=".s.a.1.0">高级查询</span></a></outline><outline class="toc-level-h3" data-reactid=".s.b" style="width: 155px;"><active data-reactid=".s.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".s.b.1"><span data-reactid=".s.b.1.0">原生 SQL</span></a></outline><outline class="toc-level-h3" data-reactid=".s.c" style="width: 155px;"><active data-reactid=".s.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".s.c.1"><span data-reactid=".s.c.1.0">GORM 钩子</span></a></outline><outline class="toc-level-h2" data-reactid=".s.d" style="width: 165px;"><active data-reactid=".s.d.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".s.d.1"><span data-reactid=".s.d.1.0">iam-apiserver 中的 CURD 操作实战</span></a></outline><outline class="toc-level-h2" data-reactid=".s.e" style="width: 165px;"><active data-reactid=".s.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".s.e.1"><span data-reactid=".s.e.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".s.f" style="width: 165px;"><active data-reactid=".s.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".s.f.1"><span data-reactid=".s.f.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".s.g" style="width: 165px;"><active data-reactid=".s.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".s.g.1"><span data-reactid=".s.g.1.0">精选留言 (22)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/403351" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>