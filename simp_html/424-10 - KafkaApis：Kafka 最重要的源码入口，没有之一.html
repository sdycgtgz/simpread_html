
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 10 | KafkaApis：Kafka 最重要的源码入口，没有之一</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>10 | KafkaApis：Kafka 最重要的源码入口，没有之一</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">为什么读源码逐渐成为了必选项？它究竟有什么作用呢？</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">10 | KafkaApis：Kafka 最重要的源码入口，没有之一</h1><div><span>胡夕</span> <span> 2020-05-09</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/3d/64/3d1b5901633f5a8ddb4ebe885f8ea864.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：胡夕</span><span>大小：15.66M</span><span> 时长：17:06</span></div></div><audio title="10 | KafkaApis：Kafka最重要的源码入口，没有之一" src="https://res001.geekbang.org//media/audio/05/61/05454b44470855c818a8aa247ebca361/ld/ld.m3u8" __idm_id__="49165"></audio></div><div><div><div><div data-slate-editor="true" data-key="11535" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="11536"><span data-slate-object="text" data-key="11537"><span data-slate-leaf="true" data-offset-key="11537:0" data-first-offset="true"><span data-slate-string="true">你好，我是胡夕。今天，我们来收尾 Kafka 请求处理模块的源码学习。讲到这里，关于整个模块，我们还有最后一个知识点尚未掌握，那就是 KafkaApis 类。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11538"><span data-slate-object="text" data-key="11539"><span data-slate-leaf="true" data-offset-key="11539:0" data-first-offset="true"><span data-slate-string="true">在上节课中，我提到过，请求的实际处理逻辑是封装在 KafkaApis 类中的。你一定很想知道，这个类到底是做什么的吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11540"><span data-slate-object="text" data-key="11541"><span data-slate-leaf="true" data-offset-key="11541:0" data-first-offset="true"><span data-slate-string="true">实际上，我一直认为，KafkaApis 是 Kafka 最重要的源码入口。因为，每次要查找 Kafka 某个功能的实现代码时，我们几乎总要从这个 KafkaApis.scala 文件开始找起，然后一层一层向下钻取，直到定位到实现功能的代码处为止。比如，如果你想知道创建 Topic 的流程，你只需要查看 KafkaApis 的 handleCreateTopicsRequest 方法；如果你想弄懂 Consumer 提交位移是怎么实现的，查询 handleOffsetCommitRequest 方法就行了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11542"><span data-slate-object="text" data-key="11543"><span data-slate-leaf="true" data-offset-key="11543:0" data-first-offset="true"><span data-slate-string="true">除此之外，在这一遍遍的钻取过程中，我们还会慢慢地</span></span></span><span data-slate-object="text" data-key="11544"><span data-slate-leaf="true" data-offset-key="11544:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">掌握 Kafka 实现各种功能的代码路径和源码分布，从而建立起对整个 Kafka 源码工程的完整认识</span></span></span></span><span data-slate-object="text" data-key="11545"><span data-slate-leaf="true" data-offset-key="11545:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11546"><span data-slate-object="text" data-key="11547"><span data-slate-leaf="true" data-offset-key="11547:0" data-first-offset="true"><span data-slate-string="true">如果这些还不足以吸引你阅读这部分源码，那么，我再给你分享一个真实的案例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11548"><span data-slate-object="text" data-key="11549"><span data-slate-leaf="true" data-offset-key="11549:0" data-first-offset="true"><span data-slate-string="true">之前，在使用 Kafka 时，我发现，Producer 程序一旦向一个不存在的主题发送消息，在创建主题之后，Producer 端会抛出一个警告：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="11550"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11551"><span data-slate-object="text" data-key="11552"><span data-slate-leaf="true" data-offset-key="11552:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Error</span></span></span></span><span data-slate-object="text" data-key="11553"><span data-slate-leaf="true" data-offset-key="11553:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11554"><span data-slate-leaf="true" data-offset-key="11554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="11555"><span data-slate-leaf="true" data-offset-key="11555:0" data-first-offset="true"><span data-slate-string="true"> fetching metadata </span></span></span><span data-slate-object="text" data-key="11556"><span data-slate-leaf="true" data-offset-key="11556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">with</span></span></span></span><span data-slate-object="text" data-key="11557"><span data-slate-leaf="true" data-offset-key="11557:0" data-first-offset="true"><span data-slate-string="true"> correlation id </span></span></span><span data-slate-object="text" data-key="11558"><span data-slate-leaf="true" data-offset-key="11558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="11559"><span data-slate-leaf="true" data-offset-key="11559:0" data-first-offset="true"><span data-slate-string="true"> : {test-topic=</span></span></span><span data-slate-object="text" data-key="11560"><span data-slate-leaf="true" data-offset-key="11560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LEADER_NOT_AVAILABLE</span></span></span></span><span data-slate-object="text" data-key="11561"><span data-slate-leaf="true" data-offset-key="11561:0" data-first-offset="true"><span data-slate-string="true">} (org.</span></span></span><span data-slate-object="text" data-key="11562"><span data-slate-leaf="true" data-offset-key="11562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">apache</span></span></span></span><span data-slate-object="text" data-key="11563"><span data-slate-leaf="true" data-offset-key="11563:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="11564"><span data-slate-leaf="true" data-offset-key="11564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kafka</span></span></span></span><span data-slate-object="text" data-key="11565"><span data-slate-leaf="true" data-offset-key="11565:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="11566"><span data-slate-leaf="true" data-offset-key="11566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">clients</span></span></span></span><span data-slate-object="text" data-key="11567"><span data-slate-leaf="true" data-offset-key="11567:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="11568"><span data-slate-leaf="true" data-offset-key="11568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NetworkClient</span></span></span></span><span data-slate-object="text" data-key="11569"><span data-slate-leaf="true" data-offset-key="11569:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11570"><span data-slate-object="text" data-key="11571"><span data-slate-leaf="true" data-offset-key="11571:0" data-first-offset="true"><span data-slate-string="true">我一直很好奇，这里的 LEADER_NOT_AVAILABLE 异常是在哪里抛出来的。直到有一天，我在浏览 KafkaApis 代码时，突然发现了 createTopics 方法的这两行代码：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="11572"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11573"><span data-slate-object="text" data-key="11574"><span data-slate-leaf="true" data-offset-key="11574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span></span><span data-slate-object="text" data-key="11575"><span data-slate-leaf="true" data-offset-key="11575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> def </span></span></span></span><span data-slate-object="text" data-key="11576"><span data-slate-leaf="true" data-offset-key="11576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">createTopic</span></span></span></span></span><span data-slate-object="text" data-key="11577"><span data-slate-leaf="true" data-offset-key="11577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(topic: String,</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11578"><span data-slate-object="text" data-key="11579"><span data-slate-leaf="true" data-offset-key="11579:0" data-first-offset="true"><span data-slate-string="true">  numPartitions: Int, replicationFactor: Int,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11580"><span data-slate-object="text" data-key="11581"><span data-slate-leaf="true" data-offset-key="11581:0" data-first-offset="true"><span data-slate-string="true">  properties: util.Properties = </span></span></span><span data-slate-object="text" data-key="11582"><span data-slate-leaf="true" data-offset-key="11582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="11583"><span data-slate-leaf="true" data-offset-key="11583:0" data-first-offset="true"><span data-slate-string="true"> util.Properties()): MetadataResponseTopic = {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11584"><span data-slate-object="text" data-key="11585"><span data-slate-leaf="true" data-offset-key="11585:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11586"><span data-slate-leaf="true" data-offset-key="11586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">try</span></span></span></span><span data-slate-object="text" data-key="11587"><span data-slate-leaf="true" data-offset-key="11587:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11588"><span data-slate-object="text" data-key="11589"><span data-slate-leaf="true" data-offset-key="11589:0" data-first-offset="true"><span data-slate-string="true">    adminZkClient.</span></span></span><span data-slate-object="text" data-key="11590"><span data-slate-leaf="true" data-offset-key="11590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">createTopic</span></span></span></span><span data-slate-object="text" data-key="11591"><span data-slate-leaf="true" data-offset-key="11591:0" data-first-offset="true"><span data-slate-string="true">(topic, numPartitions, replicationFactor, properties, RackAwareMode.Safe)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11592"><span data-slate-object="text" data-key="11593"><span data-slate-leaf="true" data-offset-key="11593:0" data-first-offset="true"><span data-slate-string="true">    ......</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11594"><span data-slate-object="text" data-key="11595"><span data-slate-leaf="true" data-offset-key="11595:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11596"><span data-slate-leaf="true" data-offset-key="11596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 显式封装一个 LEADER_NOT_AVAILABLE Response</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11597"><span data-slate-object="text" data-key="11598"><span data-slate-leaf="true" data-offset-key="11598:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11599"><span data-slate-leaf="true" data-offset-key="11599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">metadataResponseTopic</span></span></span></span><span data-slate-object="text" data-key="11600"><span data-slate-leaf="true" data-offset-key="11600:0" data-first-offset="true"><span data-slate-string="true">(Errors.LEADER_NOT_AVAILABLE, topic, </span></span></span><span data-slate-object="text" data-key="11601"><span data-slate-leaf="true" data-offset-key="11601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">isInternal</span></span></span></span><span data-slate-object="text" data-key="11602"><span data-slate-leaf="true" data-offset-key="11602:0" data-first-offset="true"><span data-slate-string="true">(topic), util.Collections.</span></span></span><span data-slate-object="text" data-key="11603"><span data-slate-leaf="true" data-offset-key="11603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">emptyList</span></span></span></span><span data-slate-object="text" data-key="11604"><span data-slate-leaf="true" data-offset-key="11604:0" data-first-offset="true"><span data-slate-string="true">())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11605"><span data-slate-object="text" data-key="11606"><span data-slate-leaf="true" data-offset-key="11606:0" data-first-offset="true"><span data-slate-string="true">  } </span></span></span><span data-slate-object="text" data-key="11607"><span data-slate-leaf="true" data-offset-key="11607:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">catch</span></span></span></span><span data-slate-object="text" data-key="11608"><span data-slate-leaf="true" data-offset-key="11608:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11609"><span data-slate-object="text" data-key="11610"><span data-slate-leaf="true" data-offset-key="11610:0" data-first-offset="true"><span data-slate-string="true">    ......</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11611"><span data-slate-object="text" data-key="11612"><span data-slate-leaf="true" data-offset-key="11612:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11613"><span data-slate-object="text" data-key="11614"><span data-slate-leaf="true" data-offset-key="11614:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11615"><span data-slate-object="text" data-key="11616"><span data-slate-leaf="true" data-offset-key="11616:0" data-first-offset="true"><span data-slate-string="true">这时，我才恍然大悟，原来，Broker 端创建完主题后，会显式地通知 Clients 端 LEADER_NOT_AVAILABLE 异常。Clients 端接收到该异常后，会主动更新元数据，去获取新创建主题的信息。你看，如果不是亲自查看源代码，我们是无法解释这种现象的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11617"><span data-slate-object="text" data-key="11618"><span data-slate-leaf="true" data-offset-key="11618:0" data-first-offset="true"><span data-slate-string="true">那么，既然 KafkaApis 这么重要，现在，我们就来看看这个大名鼎鼎的入口文件吧。我会先给你介绍下它的定义以及最重要的 handle 方法，然后再解释一下其他的重要方法。学完这节课以后，你就能掌握，从 KafkaApis 类开始去寻找单个功能具体代码位置的方法了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11619"><span data-slate-object="text" data-key="11620"><span data-slate-leaf="true" data-offset-key="11620:0" data-first-offset="true"><span data-slate-string="true">事实上，相比于之前更多是向你分享知识的做法，</span></span></span><span data-slate-object="text" data-key="11621"><span data-slate-leaf="true" data-offset-key="11621:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这节课我分享的是学习知识的方法</span></span></span></span><span data-slate-object="text" data-key="11622"><span data-slate-leaf="true" data-offset-key="11622:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11623" id="sr-toc-1"><span data-slate-object="text" data-key="11624"><span data-slate-leaf="true" data-offset-key="11624:0" data-first-offset="true"><span data-slate-string="true">KafkaApis 类定义</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11625"><span data-slate-object="text" data-key="11626"><span data-slate-leaf="true" data-offset-key="11626:0" data-first-offset="true"><span data-slate-string="true">好了， 我们首先来看下 KafkaApis 类的定义。KafkaApis 类定义在源码文件 KafkaApis.scala 中。该文件位于 core 工程的 server 包下，是一个将近 3000 行的巨型文件。好在它实现的逻辑并不复杂，绝大部分代码都是用来处理所有 Kafka 请求类型的，因此，代码结构整体上显得非常规整。一会儿我们在学习 handle 方法时，你一定会所有体会。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11627"><span data-slate-object="text" data-key="11628"><span data-slate-leaf="true" data-offset-key="11628:0" data-first-offset="true"><span data-slate-string="true">KafkaApis 类的定义代码如下：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="11629"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11630"><span data-slate-object="text" data-key="11631"><span data-slate-leaf="true" data-offset-key="11631:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="11632"><span data-slate-leaf="true" data-offset-key="11632:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11633"><span data-slate-leaf="true" data-offset-key="11633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">KafkaApis</span></span></span></span><span data-slate-object="text" data-key="11634"><span data-slate-leaf="true" data-offset-key="11634:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11635"><span data-slate-object="text" data-key="11636"><span data-slate-leaf="true" data-offset-key="11636:0" data-first-offset="true"><span data-slate-string="true">  val requestChannel: RequestChannel, </span></span></span><span data-slate-object="text" data-key="11637"><span data-slate-leaf="true" data-offset-key="11637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 请求通道</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11638"><span data-slate-object="text" data-key="11639"><span data-slate-leaf="true" data-offset-key="11639:0" data-first-offset="true"><span data-slate-string="true">  val replicaManager: ReplicaManager, </span></span></span><span data-slate-object="text" data-key="11640"><span data-slate-leaf="true" data-offset-key="11640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 副本管理器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11641"><span data-slate-object="text" data-key="11642"><span data-slate-leaf="true" data-offset-key="11642:0" data-first-offset="true"><span data-slate-string="true">  val adminManager: AdminManager,   </span></span></span><span data-slate-object="text" data-key="11643"><span data-slate-leaf="true" data-offset-key="11643:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 主题、分区、配置等方面的管理器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11644"><span data-slate-object="text" data-key="11645"><span data-slate-leaf="true" data-offset-key="11645:0" data-first-offset="true"><span data-slate-string="true">    val groupCoordinator: GroupCoordinator,  </span></span></span><span data-slate-object="text" data-key="11646"><span data-slate-leaf="true" data-offset-key="11646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 消费者组协调器组件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11647"><span data-slate-object="text" data-key="11648"><span data-slate-leaf="true" data-offset-key="11648:0" data-first-offset="true"><span data-slate-string="true">  val txnCoordinator: TransactionCoordinator,  </span></span></span><span data-slate-object="text" data-key="11649"><span data-slate-leaf="true" data-offset-key="11649:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 事务管理器组件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11650"><span data-slate-object="text" data-key="11651"><span data-slate-leaf="true" data-offset-key="11651:0" data-first-offset="true"><span data-slate-string="true">  val controller: KafkaController,  </span></span></span><span data-slate-object="text" data-key="11652"><span data-slate-leaf="true" data-offset-key="11652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 控制器组件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11653"><span data-slate-object="text" data-key="11654"><span data-slate-leaf="true" data-offset-key="11654:0" data-first-offset="true"><span data-slate-string="true">  val zkClient: KafkaZkClient,    </span></span></span><span data-slate-object="text" data-key="11655"><span data-slate-leaf="true" data-offset-key="11655:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ZooKeeper 客户端程序，Kafka 依赖于该类实现与 ZooKeeper 交互</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11656"><span data-slate-object="text" data-key="11657"><span data-slate-leaf="true" data-offset-key="11657:0" data-first-offset="true"><span data-slate-string="true">  val brokerId: Int,          </span></span></span><span data-slate-object="text" data-key="11658"><span data-slate-leaf="true" data-offset-key="11658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//broker.id 参数值</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11659"><span data-slate-object="text" data-key="11660"><span data-slate-leaf="true" data-offset-key="11660:0" data-first-offset="true"><span data-slate-string="true">    val config: KafkaConfig,      </span></span></span><span data-slate-object="text" data-key="11661"><span data-slate-leaf="true" data-offset-key="11661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Kafka 配置类</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11662"><span data-slate-object="text" data-key="11663"><span data-slate-leaf="true" data-offset-key="11663:0" data-first-offset="true"><span data-slate-string="true">    val metadataCache: MetadataCache,  </span></span></span><span data-slate-object="text" data-key="11664"><span data-slate-leaf="true" data-offset-key="11664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 元数据缓存类</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11665"><span data-slate-object="text" data-key="11666"><span data-slate-leaf="true" data-offset-key="11666:0" data-first-offset="true"><span data-slate-string="true">    val metrics: Metrics,      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11667"><span data-slate-object="text" data-key="11668"><span data-slate-leaf="true" data-offset-key="11668:0" data-first-offset="true"><span data-slate-string="true">  val authorizer: Option[Authorizer],</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11669"><span data-slate-object="text" data-key="11670"><span data-slate-leaf="true" data-offset-key="11670:0" data-first-offset="true"><span data-slate-string="true">  val quotas: QuotaManagers,          </span></span></span><span data-slate-object="text" data-key="11671"><span data-slate-leaf="true" data-offset-key="11671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 配额管理器组件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11672"><span data-slate-object="text" data-key="11673"><span data-slate-leaf="true" data-offset-key="11673:0" data-first-offset="true"><span data-slate-string="true">  val fetchManager: FetchManager,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11674"><span data-slate-object="text" data-key="11675"><span data-slate-leaf="true" data-offset-key="11675:0" data-first-offset="true"><span data-slate-string="true">  brokerTopicStats: BrokerTopicStats,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11676"><span data-slate-object="text" data-key="11677"><span data-slate-leaf="true" data-offset-key="11677:0" data-first-offset="true"><span data-slate-string="true">  val clusterId: String,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11678"><span data-slate-object="text" data-key="11679"><span data-slate-leaf="true" data-offset-key="11679:0" data-first-offset="true"><span data-slate-string="true">  time: Time,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11680"><span data-slate-object="text" data-key="11681"><span data-slate-leaf="true" data-offset-key="11681:0" data-first-offset="true"><span data-slate-string="true">  val tokenManager: DelegationTokenManager) </span></span></span><span data-slate-object="text" data-key="11682"><span data-slate-leaf="true" data-offset-key="11682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">extends</span></span></span></span><span data-slate-object="text" data-key="11683"><span data-slate-leaf="true" data-offset-key="11683:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11684"><span data-slate-leaf="true" data-offset-key="11684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Logging</span></span></span></span><span data-slate-object="text" data-key="11685"><span data-slate-leaf="true" data-offset-key="11685:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11686"><span data-slate-object="text" data-key="11687"><span data-slate-leaf="true" data-offset-key="11687:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11688"><span data-slate-leaf="true" data-offset-key="11688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="11689"><span data-slate-leaf="true" data-offset-key="11689:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11690"><span data-slate-leaf="true" data-offset-key="11690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FetchResponseStats</span></span></span></span><span data-slate-object="text" data-key="11691"><span data-slate-leaf="true" data-offset-key="11691:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11692"><span data-slate-leaf="true" data-offset-key="11692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11693"><span data-slate-leaf="true" data-offset-key="11693:0" data-first-offset="true"><span data-slate-string="true"> Map[TopicPartition, RecordConversionStats]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11694"><span data-slate-object="text" data-key="11695"><span data-slate-leaf="true" data-offset-key="11695:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11696"><span data-slate-leaf="true" data-offset-key="11696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11697"><span data-slate-leaf="true" data-offset-key="11697:0" data-first-offset="true"><span data-slate-string="true">.logIdent = </span></span></span><span data-slate-object="text" data-key="11698"><span data-slate-leaf="true" data-offset-key="11698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"[KafkaApi-%d]"</span></span></span></span><span data-slate-object="text" data-key="11699"><span data-slate-leaf="true" data-offset-key="11699:0" data-first-offset="true"><span data-slate-string="true">.format(brokerId)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11700"><span data-slate-object="text" data-key="11701"><span data-slate-leaf="true" data-offset-key="11701:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11702"><span data-slate-leaf="true" data-offset-key="11702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="11703"><span data-slate-leaf="true" data-offset-key="11703:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11704"><span data-slate-leaf="true" data-offset-key="11704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adminZkClient</span></span></span></span><span data-slate-object="text" data-key="11705"><span data-slate-leaf="true" data-offset-key="11705:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11706"><span data-slate-leaf="true" data-offset-key="11706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11707"><span data-slate-leaf="true" data-offset-key="11707:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11708"><span data-slate-leaf="true" data-offset-key="11708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="11709"><span data-slate-leaf="true" data-offset-key="11709:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11710"><span data-slate-leaf="true" data-offset-key="11710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AdminZkClient</span></span></span></span><span data-slate-object="text" data-key="11711"><span data-slate-leaf="true" data-offset-key="11711:0" data-first-offset="true"><span data-slate-string="true">(zkClient)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11712"><span data-slate-object="text" data-key="11713"><span data-slate-leaf="true" data-offset-key="11713:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11714"><span data-slate-leaf="true" data-offset-key="11714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11715"><span data-slate-leaf="true" data-offset-key="11715:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11716"><span data-slate-leaf="true" data-offset-key="11716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="11717"><span data-slate-leaf="true" data-offset-key="11717:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11718"><span data-slate-leaf="true" data-offset-key="11718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">alterAclsPurgatory</span></span></span></span><span data-slate-object="text" data-key="11719"><span data-slate-leaf="true" data-offset-key="11719:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11720"><span data-slate-leaf="true" data-offset-key="11720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11721"><span data-slate-leaf="true" data-offset-key="11721:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11722"><span data-slate-leaf="true" data-offset-key="11722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="11723"><span data-slate-leaf="true" data-offset-key="11723:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11724"><span data-slate-leaf="true" data-offset-key="11724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">DelayedFuturePurgatory</span></span></span></span><span data-slate-object="text" data-key="11725"><span data-slate-leaf="true" data-offset-key="11725:0" data-first-offset="true"><span data-slate-string="true">(purgatoryName = </span></span></span><span data-slate-object="text" data-key="11726"><span data-slate-leaf="true" data-offset-key="11726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"AlterAcls"</span></span></span></span><span data-slate-object="text" data-key="11727"><span data-slate-leaf="true" data-offset-key="11727:0" data-first-offset="true"><span data-slate-string="true">, brokerId = config.brokerId)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11728"><span data-slate-object="text" data-key="11729"><span data-slate-leaf="true" data-offset-key="11729:0" data-first-offset="true"><span data-slate-string="true">  ......</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11730"><span data-slate-object="text" data-key="11731"><span data-slate-leaf="true" data-offset-key="11731:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11732"><span data-slate-object="text" data-key="11733"><span data-slate-leaf="true" data-offset-key="11733:0" data-first-offset="true"><span data-slate-string="true">我为一些重要的字段添加了注释信息。为了方便你理解，我还画了一张思维导图，罗列出了比较重要的组件：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11734"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/4f/cc/4fc050472d3c81fa27564297e07d67cc.jpg?wh=2250*3387"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11735"><span data-slate-object="text" data-key="11736"><span data-slate-leaf="true" data-offset-key="11736:0" data-first-offset="true"><span data-slate-string="true">从这张图可以看出，KafkaApis 下可谓是大牌云集。放眼整个源码工程，KafkaApis 关联的 “大佬级” 组件都是最多的！在 KafkaApis 中，你几乎能找到 Kafka 所有重量级的组件，比如，负责副本管理的 ReplicaManager、维护消费者组的 GroupCoordinator 以及操作 Controller 组件的 KafkaController，等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11737"><span data-slate-object="text" data-key="11738"><span data-slate-leaf="true" data-offset-key="11738:0" data-first-offset="true"><span data-slate-string="true">在处理不同类型的 RPC 请求时，KafkaApis 会用到不同的组件，因此，在创建 KafkaApis 实例时，我们必须把可能用到的组件一并传给它，这也是它汇聚众多大牌组件于一身的原因。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11739"><span data-slate-object="text" data-key="11740"><span data-slate-leaf="true" data-offset-key="11740:0" data-first-offset="true"><span data-slate-string="true">我说 KafkaApis 是入口类的另一个原因也在于此。你完全可以打开 KafkaApis.scala 文件，然后根据它的定义一个一个地去研习这些重量级组件的实现原理。等你对这些组件的代码了然于胸了，说不定下一个写源码课的人就是你了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11741" id="sr-toc-2"><span data-slate-object="text" data-key="11742"><span data-slate-leaf="true" data-offset-key="11742:0" data-first-offset="true"><span data-slate-string="true">KafkaApis 方法入口</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11743"><span data-slate-object="text" data-key="11744"><span data-slate-leaf="true" data-offset-key="11744:0" data-first-offset="true"><span data-slate-string="true">那，作为 Kafka 源码的入口类，它都定义了哪些方法呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11745"><span data-slate-object="text" data-key="11746"><span data-slate-leaf="true" data-offset-key="11746:0" data-first-offset="true"><span data-slate-string="true">如果你翻开 KafkaApis 类的代码，你会发现，它封装了很多以 handle 开头的方法。每一个这样的方法都对应于一类请求类型，而它们的总方法入口就是 handle 方法。实际上，你完全可以在 handle 方法间不断跳转，去到任意一类请求被处理的实际代码中。下面这段代码就是 handle 方法的完整实现，我们来看一下：</span></span></span></div><div data-code-language="dart" data-slate-type="pre" data-slate-object="block" data-key="11747"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11748"><span data-slate-object="text" data-key="11749"><span data-slate-leaf="true" data-offset-key="11749:0" data-first-offset="true"><span data-slate-string="true">def handle(request: RequestChannel.Request): Unit = {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11750"><span data-slate-object="text" data-key="11751"><span data-slate-leaf="true" data-offset-key="11751:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11752"><span data-slate-leaf="true" data-offset-key="11752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">try</span></span></span></span><span data-slate-object="text" data-key="11753"><span data-slate-leaf="true" data-offset-key="11753:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11754"><span data-slate-object="text" data-key="11755"><span data-slate-leaf="true" data-offset-key="11755:0" data-first-offset="true"><span data-slate-string="true">    trace(s</span></span></span><span data-slate-object="text" data-key="11756"><span data-slate-leaf="true" data-offset-key="11756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Handling request:</span></span></span></span><span data-slate-object="text" data-key="11757"><span data-slate-leaf="true" data-offset-key="11757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${request.requestDesc(</span></span></span></span></span><span data-slate-object="text" data-key="11758"><span data-slate-leaf="true" data-offset-key="11758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span></span></span><span data-slate-object="text" data-key="11759"><span data-slate-leaf="true" data-offset-key="11759:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)}</span></span></span></span></span><span data-slate-object="text" data-key="11760"><span data-slate-leaf="true" data-offset-key="11760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> from connection </span></span></span></span><span data-slate-object="text" data-key="11761"><span data-slate-leaf="true" data-offset-key="11761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${request.context.connectionId}</span></span></span></span></span><span data-slate-object="text" data-key="11762"><span data-slate-leaf="true" data-offset-key="11762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">;"</span></span></span></span><span data-slate-object="text" data-key="11763"><span data-slate-leaf="true" data-offset-key="11763:0" data-first-offset="true"><span data-slate-string="true"> +</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11764"><span data-slate-object="text" data-key="11765"><span data-slate-leaf="true" data-offset-key="11765:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span><span data-slate-object="text" data-key="11766"><span data-slate-leaf="true" data-offset-key="11766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"securityProtocol:</span></span></span></span><span data-slate-object="text" data-key="11767"><span data-slate-leaf="true" data-offset-key="11767:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${request.context.securityProtocol}</span></span></span></span></span><span data-slate-object="text" data-key="11768"><span data-slate-leaf="true" data-offset-key="11768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">,principal:</span></span></span></span><span data-slate-object="text" data-key="11769"><span data-slate-leaf="true" data-offset-key="11769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${request.context.principal}</span></span></span></span></span><span data-slate-object="text" data-key="11770"><span data-slate-leaf="true" data-offset-key="11770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="11771"><span data-slate-leaf="true" data-offset-key="11771:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11772"><span data-slate-object="text" data-key="11773"><span data-slate-leaf="true" data-offset-key="11773:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11774"><span data-slate-leaf="true" data-offset-key="11774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 根据请求头部信息中的 apiKey 字段判断属于哪类请求</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11775"><span data-slate-object="text" data-key="11776"><span data-slate-leaf="true" data-offset-key="11776:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11777"><span data-slate-leaf="true" data-offset-key="11777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 然后调用响应的 handle*** 方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11778"><span data-slate-object="text" data-key="11779"><span data-slate-leaf="true" data-offset-key="11779:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11780"><span data-slate-leaf="true" data-offset-key="11780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果新增 RPC 协议类型，则：</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11781"><span data-slate-object="text" data-key="11782"><span data-slate-leaf="true" data-offset-key="11782:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11783"><span data-slate-leaf="true" data-offset-key="11783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1. 添加新的 apiKey 标识新请求类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11784"><span data-slate-object="text" data-key="11785"><span data-slate-leaf="true" data-offset-key="11785:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11786"><span data-slate-leaf="true" data-offset-key="11786:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 2. 添加新的 case 分支</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11787"><span data-slate-object="text" data-key="11788"><span data-slate-leaf="true" data-offset-key="11788:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11789"><span data-slate-leaf="true" data-offset-key="11789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 3. 添加对应的 handle*** 方法   </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11790"><span data-slate-object="text" data-key="11791"><span data-slate-leaf="true" data-offset-key="11791:0" data-first-offset="true"><span data-slate-string="true">    request.header.apiKey match {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11792"><span data-slate-object="text" data-key="11793"><span data-slate-leaf="true" data-offset-key="11793:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11794"><span data-slate-leaf="true" data-offset-key="11794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11795"><span data-slate-leaf="true" data-offset-key="11795:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.PRODUCE =&gt; handleProduceRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11796"><span data-slate-object="text" data-key="11797"><span data-slate-leaf="true" data-offset-key="11797:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11798"><span data-slate-leaf="true" data-offset-key="11798:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11799"><span data-slate-leaf="true" data-offset-key="11799:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.FETCH =&gt; handleFetchRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11800"><span data-slate-object="text" data-key="11801"><span data-slate-leaf="true" data-offset-key="11801:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11802"><span data-slate-leaf="true" data-offset-key="11802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11803"><span data-slate-leaf="true" data-offset-key="11803:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.LIST_OFFSETS =&gt; handleListOffsetRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11804"><span data-slate-object="text" data-key="11805"><span data-slate-leaf="true" data-offset-key="11805:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11806"><span data-slate-leaf="true" data-offset-key="11806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11807"><span data-slate-leaf="true" data-offset-key="11807:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.METADATA =&gt; handleTopicMetadataRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11808"><span data-slate-object="text" data-key="11809"><span data-slate-leaf="true" data-offset-key="11809:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11810"><span data-slate-leaf="true" data-offset-key="11810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11811"><span data-slate-leaf="true" data-offset-key="11811:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.LEADER_AND_ISR =&gt; handleLeaderAndIsrRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11812"><span data-slate-object="text" data-key="11813"><span data-slate-leaf="true" data-offset-key="11813:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11814"><span data-slate-leaf="true" data-offset-key="11814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11815"><span data-slate-leaf="true" data-offset-key="11815:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.STOP_REPLICA =&gt; handleStopReplicaRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11816"><span data-slate-object="text" data-key="11817"><span data-slate-leaf="true" data-offset-key="11817:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11818"><span data-slate-leaf="true" data-offset-key="11818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11819"><span data-slate-leaf="true" data-offset-key="11819:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.UPDATE_METADATA =&gt; handleUpdateMetadataRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11820"><span data-slate-object="text" data-key="11821"><span data-slate-leaf="true" data-offset-key="11821:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11822"><span data-slate-leaf="true" data-offset-key="11822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11823"><span data-slate-leaf="true" data-offset-key="11823:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.CONTROLLED_SHUTDOWN =&gt; handleControlledShutdownRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11824"><span data-slate-object="text" data-key="11825"><span data-slate-leaf="true" data-offset-key="11825:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11826"><span data-slate-leaf="true" data-offset-key="11826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11827"><span data-slate-leaf="true" data-offset-key="11827:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.OFFSET_COMMIT =&gt; handleOffsetCommitRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11828"><span data-slate-object="text" data-key="11829"><span data-slate-leaf="true" data-offset-key="11829:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11830"><span data-slate-leaf="true" data-offset-key="11830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11831"><span data-slate-leaf="true" data-offset-key="11831:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.OFFSET_FETCH =&gt; handleOffsetFetchRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11832"><span data-slate-object="text" data-key="11833"><span data-slate-leaf="true" data-offset-key="11833:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11834"><span data-slate-leaf="true" data-offset-key="11834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11835"><span data-slate-leaf="true" data-offset-key="11835:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.FIND_COORDINATOR =&gt; handleFindCoordinatorRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11836"><span data-slate-object="text" data-key="11837"><span data-slate-leaf="true" data-offset-key="11837:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11838"><span data-slate-leaf="true" data-offset-key="11838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11839"><span data-slate-leaf="true" data-offset-key="11839:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.JOIN_GROUP =&gt; handleJoinGroupRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11840"><span data-slate-object="text" data-key="11841"><span data-slate-leaf="true" data-offset-key="11841:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11842"><span data-slate-leaf="true" data-offset-key="11842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11843"><span data-slate-leaf="true" data-offset-key="11843:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.HEARTBEAT =&gt; handleHeartbeatRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11844"><span data-slate-object="text" data-key="11845"><span data-slate-leaf="true" data-offset-key="11845:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11846"><span data-slate-leaf="true" data-offset-key="11846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11847"><span data-slate-leaf="true" data-offset-key="11847:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.LEAVE_GROUP =&gt; handleLeaveGroupRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11848"><span data-slate-object="text" data-key="11849"><span data-slate-leaf="true" data-offset-key="11849:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11850"><span data-slate-leaf="true" data-offset-key="11850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11851"><span data-slate-leaf="true" data-offset-key="11851:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.SYNC_GROUP =&gt; handleSyncGroupRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11852"><span data-slate-object="text" data-key="11853"><span data-slate-leaf="true" data-offset-key="11853:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11854"><span data-slate-leaf="true" data-offset-key="11854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11855"><span data-slate-leaf="true" data-offset-key="11855:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_GROUPS =&gt; handleDescribeGroupRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11856"><span data-slate-object="text" data-key="11857"><span data-slate-leaf="true" data-offset-key="11857:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11858"><span data-slate-leaf="true" data-offset-key="11858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11859"><span data-slate-leaf="true" data-offset-key="11859:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.LIST_GROUPS =&gt; handleListGroupsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11860"><span data-slate-object="text" data-key="11861"><span data-slate-leaf="true" data-offset-key="11861:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11862"><span data-slate-leaf="true" data-offset-key="11862:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11863"><span data-slate-leaf="true" data-offset-key="11863:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.SASL_HANDSHAKE =&gt; handleSaslHandshakeRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11864"><span data-slate-object="text" data-key="11865"><span data-slate-leaf="true" data-offset-key="11865:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11866"><span data-slate-leaf="true" data-offset-key="11866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11867"><span data-slate-leaf="true" data-offset-key="11867:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.API_VERSIONS =&gt; handleApiVersionsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11868"><span data-slate-object="text" data-key="11869"><span data-slate-leaf="true" data-offset-key="11869:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11870"><span data-slate-leaf="true" data-offset-key="11870:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11871"><span data-slate-leaf="true" data-offset-key="11871:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.CREATE_TOPICS =&gt; handleCreateTopicsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11872"><span data-slate-object="text" data-key="11873"><span data-slate-leaf="true" data-offset-key="11873:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11874"><span data-slate-leaf="true" data-offset-key="11874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11875"><span data-slate-leaf="true" data-offset-key="11875:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DELETE_TOPICS =&gt; handleDeleteTopicsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11876"><span data-slate-object="text" data-key="11877"><span data-slate-leaf="true" data-offset-key="11877:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11878"><span data-slate-leaf="true" data-offset-key="11878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11879"><span data-slate-leaf="true" data-offset-key="11879:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DELETE_RECORDS =&gt; handleDeleteRecordsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11880"><span data-slate-object="text" data-key="11881"><span data-slate-leaf="true" data-offset-key="11881:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11882"><span data-slate-leaf="true" data-offset-key="11882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11883"><span data-slate-leaf="true" data-offset-key="11883:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.INIT_PRODUCER_ID =&gt; handleInitProducerIdRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11884"><span data-slate-object="text" data-key="11885"><span data-slate-leaf="true" data-offset-key="11885:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11886"><span data-slate-leaf="true" data-offset-key="11886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11887"><span data-slate-leaf="true" data-offset-key="11887:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.OFFSET_FOR_LEADER_EPOCH =&gt; handleOffsetForLeaderEpochRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11888"><span data-slate-object="text" data-key="11889"><span data-slate-leaf="true" data-offset-key="11889:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11890"><span data-slate-leaf="true" data-offset-key="11890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11891"><span data-slate-leaf="true" data-offset-key="11891:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ADD_PARTITIONS_TO_TXN =&gt; handleAddPartitionToTxnRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11892"><span data-slate-object="text" data-key="11893"><span data-slate-leaf="true" data-offset-key="11893:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11894"><span data-slate-leaf="true" data-offset-key="11894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11895"><span data-slate-leaf="true" data-offset-key="11895:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ADD_OFFSETS_TO_TXN =&gt; handleAddOffsetsToTxnRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11896"><span data-slate-object="text" data-key="11897"><span data-slate-leaf="true" data-offset-key="11897:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11898"><span data-slate-leaf="true" data-offset-key="11898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11899"><span data-slate-leaf="true" data-offset-key="11899:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.END_TXN =&gt; handleEndTxnRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11900"><span data-slate-object="text" data-key="11901"><span data-slate-leaf="true" data-offset-key="11901:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11902"><span data-slate-leaf="true" data-offset-key="11902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11903"><span data-slate-leaf="true" data-offset-key="11903:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.WRITE_TXN_MARKERS =&gt; handleWriteTxnMarkersRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11904"><span data-slate-object="text" data-key="11905"><span data-slate-leaf="true" data-offset-key="11905:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11906"><span data-slate-leaf="true" data-offset-key="11906:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11907"><span data-slate-leaf="true" data-offset-key="11907:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.TXN_OFFSET_COMMIT =&gt; handleTxnOffsetCommitRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11908"><span data-slate-object="text" data-key="11909"><span data-slate-leaf="true" data-offset-key="11909:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11910"><span data-slate-leaf="true" data-offset-key="11910:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11911"><span data-slate-leaf="true" data-offset-key="11911:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_ACLS =&gt; handleDescribeAcls(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11912"><span data-slate-object="text" data-key="11913"><span data-slate-leaf="true" data-offset-key="11913:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11914"><span data-slate-leaf="true" data-offset-key="11914:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11915"><span data-slate-leaf="true" data-offset-key="11915:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.CREATE_ACLS =&gt; handleCreateAcls(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11916"><span data-slate-object="text" data-key="11917"><span data-slate-leaf="true" data-offset-key="11917:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11918"><span data-slate-leaf="true" data-offset-key="11918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11919"><span data-slate-leaf="true" data-offset-key="11919:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DELETE_ACLS =&gt; handleDeleteAcls(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11920"><span data-slate-object="text" data-key="11921"><span data-slate-leaf="true" data-offset-key="11921:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11922"><span data-slate-leaf="true" data-offset-key="11922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11923"><span data-slate-leaf="true" data-offset-key="11923:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ALTER_CONFIGS =&gt; handleAlterConfigsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11924"><span data-slate-object="text" data-key="11925"><span data-slate-leaf="true" data-offset-key="11925:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11926"><span data-slate-leaf="true" data-offset-key="11926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11927"><span data-slate-leaf="true" data-offset-key="11927:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_CONFIGS =&gt; handleDescribeConfigsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11928"><span data-slate-object="text" data-key="11929"><span data-slate-leaf="true" data-offset-key="11929:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11930"><span data-slate-leaf="true" data-offset-key="11930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11931"><span data-slate-leaf="true" data-offset-key="11931:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ALTER_REPLICA_LOG_DIRS =&gt; handleAlterReplicaLogDirsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11932"><span data-slate-object="text" data-key="11933"><span data-slate-leaf="true" data-offset-key="11933:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11934"><span data-slate-leaf="true" data-offset-key="11934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11935"><span data-slate-leaf="true" data-offset-key="11935:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_LOG_DIRS =&gt; handleDescribeLogDirsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11936"><span data-slate-object="text" data-key="11937"><span data-slate-leaf="true" data-offset-key="11937:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11938"><span data-slate-leaf="true" data-offset-key="11938:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11939"><span data-slate-leaf="true" data-offset-key="11939:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.SASL_AUTHENTICATE =&gt; handleSaslAuthenticateRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11940"><span data-slate-object="text" data-key="11941"><span data-slate-leaf="true" data-offset-key="11941:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11942"><span data-slate-leaf="true" data-offset-key="11942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11943"><span data-slate-leaf="true" data-offset-key="11943:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.CREATE_PARTITIONS =&gt; handleCreatePartitionsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11944"><span data-slate-object="text" data-key="11945"><span data-slate-leaf="true" data-offset-key="11945:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11946"><span data-slate-leaf="true" data-offset-key="11946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11947"><span data-slate-leaf="true" data-offset-key="11947:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.CREATE_DELEGATION_TOKEN =&gt; handleCreateTokenRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11948"><span data-slate-object="text" data-key="11949"><span data-slate-leaf="true" data-offset-key="11949:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11950"><span data-slate-leaf="true" data-offset-key="11950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11951"><span data-slate-leaf="true" data-offset-key="11951:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.RENEW_DELEGATION_TOKEN =&gt; handleRenewTokenRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11952"><span data-slate-object="text" data-key="11953"><span data-slate-leaf="true" data-offset-key="11953:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11954"><span data-slate-leaf="true" data-offset-key="11954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11955"><span data-slate-leaf="true" data-offset-key="11955:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.EXPIRE_DELEGATION_TOKEN =&gt; handleExpireTokenRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11956"><span data-slate-object="text" data-key="11957"><span data-slate-leaf="true" data-offset-key="11957:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11958"><span data-slate-leaf="true" data-offset-key="11958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11959"><span data-slate-leaf="true" data-offset-key="11959:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_DELEGATION_TOKEN =&gt; handleDescribeTokensRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11960"><span data-slate-object="text" data-key="11961"><span data-slate-leaf="true" data-offset-key="11961:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11962"><span data-slate-leaf="true" data-offset-key="11962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11963"><span data-slate-leaf="true" data-offset-key="11963:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DELETE_GROUPS =&gt; handleDeleteGroupsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11964"><span data-slate-object="text" data-key="11965"><span data-slate-leaf="true" data-offset-key="11965:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11966"><span data-slate-leaf="true" data-offset-key="11966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11967"><span data-slate-leaf="true" data-offset-key="11967:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ELECT_LEADERS =&gt; handleElectReplicaLeader(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11968"><span data-slate-object="text" data-key="11969"><span data-slate-leaf="true" data-offset-key="11969:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11970"><span data-slate-leaf="true" data-offset-key="11970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11971"><span data-slate-leaf="true" data-offset-key="11971:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.INCREMENTAL_ALTER_CONFIGS =&gt; handleIncrementalAlterConfigsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11972"><span data-slate-object="text" data-key="11973"><span data-slate-leaf="true" data-offset-key="11973:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11974"><span data-slate-leaf="true" data-offset-key="11974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11975"><span data-slate-leaf="true" data-offset-key="11975:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ALTER_PARTITION_REASSIGNMENTS =&gt; handleAlterPartitionReassignmentsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11976"><span data-slate-object="text" data-key="11977"><span data-slate-leaf="true" data-offset-key="11977:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11978"><span data-slate-leaf="true" data-offset-key="11978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11979"><span data-slate-leaf="true" data-offset-key="11979:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.LIST_PARTITION_REASSIGNMENTS =&gt; handleListPartitionReassignmentsRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11980"><span data-slate-object="text" data-key="11981"><span data-slate-leaf="true" data-offset-key="11981:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11982"><span data-slate-leaf="true" data-offset-key="11982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11983"><span data-slate-leaf="true" data-offset-key="11983:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.OFFSET_DELETE =&gt; handleOffsetDeleteRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11984"><span data-slate-object="text" data-key="11985"><span data-slate-leaf="true" data-offset-key="11985:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11986"><span data-slate-leaf="true" data-offset-key="11986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11987"><span data-slate-leaf="true" data-offset-key="11987:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.DESCRIBE_CLIENT_QUOTAS =&gt; handleDescribeClientQuotasRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11988"><span data-slate-object="text" data-key="11989"><span data-slate-leaf="true" data-offset-key="11989:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="11990"><span data-slate-leaf="true" data-offset-key="11990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="11991"><span data-slate-leaf="true" data-offset-key="11991:0" data-first-offset="true"><span data-slate-string="true"> ApiKeys.ALTER_CLIENT_QUOTAS =&gt; handleAlterClientQuotasRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11992"><span data-slate-object="text" data-key="11993"><span data-slate-leaf="true" data-offset-key="11993:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11994"><span data-slate-object="text" data-key="11995"><span data-slate-leaf="true" data-offset-key="11995:0" data-first-offset="true"><span data-slate-string="true">  } </span></span></span><span data-slate-object="text" data-key="11996"><span data-slate-leaf="true" data-offset-key="11996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">catch</span></span></span></span><span data-slate-object="text" data-key="11997"><span data-slate-leaf="true" data-offset-key="11997:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11998"><span data-slate-object="text" data-key="11999"><span data-slate-leaf="true" data-offset-key="11999:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12000"><span data-slate-leaf="true" data-offset-key="12000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果是严重错误，则抛出异常</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12001"><span data-slate-object="text" data-key="12002"><span data-slate-leaf="true" data-offset-key="12002:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12003"><span data-slate-leaf="true" data-offset-key="12003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="12004"><span data-slate-leaf="true" data-offset-key="12004:0" data-first-offset="true"><span data-slate-string="true"> e: FatalExitError =&gt; </span></span></span><span data-slate-object="text" data-key="12005"><span data-slate-leaf="true" data-offset-key="12005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="12006"><span data-slate-leaf="true" data-offset-key="12006:0" data-first-offset="true"><span data-slate-string="true"> e</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12007"><span data-slate-object="text" data-key="12008"><span data-slate-leaf="true" data-offset-key="12008:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12009"><span data-slate-leaf="true" data-offset-key="12009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 普通异常的话，记录下错误日志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12010"><span data-slate-object="text" data-key="12011"><span data-slate-leaf="true" data-offset-key="12011:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12012"><span data-slate-leaf="true" data-offset-key="12012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="12013"><span data-slate-leaf="true" data-offset-key="12013:0" data-first-offset="true"><span data-slate-string="true"> e: Throwable =&gt; handleError(request, e)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12014"><span data-slate-object="text" data-key="12015"><span data-slate-leaf="true" data-offset-key="12015:0" data-first-offset="true"><span data-slate-string="true">  } </span></span></span><span data-slate-object="text" data-key="12016"><span data-slate-leaf="true" data-offset-key="12016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">finally</span></span></span></span><span data-slate-object="text" data-key="12017"><span data-slate-leaf="true" data-offset-key="12017:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12018"><span data-slate-object="text" data-key="12019"><span data-slate-leaf="true" data-offset-key="12019:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12020"><span data-slate-leaf="true" data-offset-key="12020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 记录一下请求本地完成时间，即 Broker 处理完该请求的时间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12021"><span data-slate-object="text" data-key="12022"><span data-slate-leaf="true" data-offset-key="12022:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12023"><span data-slate-leaf="true" data-offset-key="12023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12024"><span data-slate-leaf="true" data-offset-key="12024:0" data-first-offset="true"><span data-slate-string="true"> (request.apiLocalCompleteTimeNanos &lt; </span></span></span><span data-slate-object="text" data-key="12025"><span data-slate-leaf="true" data-offset-key="12025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="12026"><span data-slate-leaf="true" data-offset-key="12026:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12027"><span data-slate-object="text" data-key="12028"><span data-slate-leaf="true" data-offset-key="12028:0" data-first-offset="true"><span data-slate-string="true">      request.apiLocalCompleteTimeNanos = time.nanoseconds</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12029"><span data-slate-object="text" data-key="12030"><span data-slate-leaf="true" data-offset-key="12030:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12031"><span data-slate-object="text" data-key="12032"><span data-slate-leaf="true" data-offset-key="12032:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12033"><span data-slate-object="text" data-key="12034"><span data-slate-leaf="true" data-offset-key="12034:0" data-first-offset="true"><span data-slate-string="true">如果你跟着这门课一直学习的话，你应该会发现，我很少贴某个类或方法的完整代码，因为没必要，还会浪费你的时间。但是，这个 handle 方法有点特殊，所以我把完整的代码展现给你。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12035"><span data-slate-object="text" data-key="12036"><span data-slate-leaf="true" data-offset-key="12036:0" data-first-offset="true"><span data-slate-string="true">它利用 Scala 语言中的模式匹配语法，完整地列出了对所有请求类型的处理逻辑。通过该方法，你能串联出 Kafka 处理任何请求的源码路径。我强烈推荐你在课下以几个比较重要的请求类型为学习目标，从 handle 方法出发，去探寻一下代码是如何为这些请求服务的，以加深你对 Broker 端代码的整体熟练度。这对你后续深入学习源码或解决实际问题非常有帮助。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12037"><span data-slate-object="text" data-key="12038"><span data-slate-leaf="true" data-offset-key="12038:0" data-first-offset="true"><span data-slate-string="true">从上面的代码中，你应该很容易就能找到其中的规律：</span></span></span><span data-slate-object="text" data-key="12039"><span data-slate-leaf="true" data-offset-key="12039:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这个方法是处理具体请求用的</span></span></span></span><span data-slate-object="text" data-key="12040"><span data-slate-leaf="true" data-offset-key="12040:0" data-first-offset="true"><span data-slate-string="true">。处理每类请求的方法名均以 handle 开头，即 handle×××Request。比如，处理 PRODUCE 请求的方法叫 handleProduceRequest，处理 FETCH 请求的方法叫 handleFetchRequest 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12041"><span data-slate-object="text" data-key="12042"><span data-slate-leaf="true" data-offset-key="12042:0" data-first-offset="true"><span data-slate-string="true">如果你点开 ApiKeys，你会发现，</span></span></span><span data-slate-object="text" data-key="12043"><span data-slate-leaf="true" data-offset-key="12043:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">它实际上是一个枚举类型，里面封装了目前 Kafka 定义所有的 RPC 协议</span></span></span></span><span data-slate-object="text" data-key="12044"><span data-slate-leaf="true" data-offset-key="12044:0" data-first-offset="true"><span data-slate-string="true">。值得一提的是，Kafka 社区维护了一个官方文档，专门记录这些 RPC 协议，包括不同版本所需的 Request 格式和 Response 格式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12045"><span data-slate-object="text" data-key="12046"><span data-slate-leaf="true" data-offset-key="12046:0" data-first-offset="true"><span data-slate-string="true">从这个 handle 方法中，我们也能得到这样的结论：每当社区添加新的 RPC 协议时，Broker 端大致需要做三件事情。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12047"><div data-slate-type="list-line" data-slate-object="block" data-key="12048"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12049"><span data-slate-leaf="true" data-offset-key="12049:0" data-first-offset="true"><span data-slate-string="true">更新 ApiKeys 枚举，加入新的 RPC ApiKey；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12050"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12051"><span data-slate-leaf="true" data-offset-key="12051:0" data-first-offset="true"><span data-slate-string="true">在 KafkaApis 中添加对应的 handle×××Request 方法，实现对该 RPC 请求的处理逻辑；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12052"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="12053"><span data-slate-leaf="true" data-offset-key="12053:0" data-first-offset="true"><span data-slate-string="true">更新 KafkaApis 的 handle 方法，添加针对 RPC 协议的 case 分支。</span></span></span></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12054" id="sr-toc-3"><span data-slate-object="text" data-key="12055"><span data-slate-leaf="true" data-offset-key="12055:0" data-first-offset="true"><span data-slate-string="true">其他重要方法</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12056"><span data-slate-object="text" data-key="12057"><span data-slate-leaf="true" data-offset-key="12057:0" data-first-offset="true"><span data-slate-string="true">抛开 KafkaApis 的定义和 handle 方法，还有几个常用的方法也很重要，比如，用于发送 Response 的一组方法，以及用于鉴权的方法。特别是前者，它是任何一类请求被处理之后都要做的必要步骤。毕竟，请求被处理完成还不够，Kafka 还需要把处理结果发送给请求发送方。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12058"><span data-slate-object="text" data-key="12059"><span data-slate-leaf="true" data-offset-key="12059:0" data-first-offset="true"><span data-slate-string="true">首先就是 </span></span></span><span data-slate-object="text" data-key="12060"><span data-slate-leaf="true" data-offset-key="12060:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendResponse 系列方法</span></span></span></span><span data-slate-object="text" data-key="12061"><span data-slate-leaf="true" data-offset-key="12061:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12062"><span data-slate-object="text" data-key="12063"><span data-slate-leaf="true" data-offset-key="12063:0" data-first-offset="true"><span data-slate-string="true">为什么说是系列方法呢？因为源码中带有 sendResponse 字眼的方法有 7 个之多。我分别来介绍一下。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12064"><div data-slate-type="list-line" data-slate-object="block" data-key="12065"><span data-slate-object="text" data-key="12066"><span data-slate-leaf="true" data-offset-key="12066:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendResponse</span></span></span></span><span data-slate-object="text" data-key="12067"><span data-slate-leaf="true" data-offset-key="12067:0" data-first-offset="true"><span data-slate-string="true">（RequestChannel.Response）：最底层的 Response 发送方法。本质上，它调用了 SocketServer 组件中 RequestChannel 的 sendResponse 方法，我在前面的课程中讲到过，RequestChannel 的 sendResponse 方法会把待发送的 Response 对象添加到对应 Processor 线程的 Response 队列上，然后交由 Processor 线程完成网络间的数据传输。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12068"><span data-slate-object="text" data-key="12069"><span data-slate-leaf="true" data-offset-key="12069:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendResponse</span></span></span></span><span data-slate-object="text" data-key="12070"><span data-slate-leaf="true" data-offset-key="12070:0" data-first-offset="true"><span data-slate-string="true">（RequestChannel.Request，responseOpt: Option [AbstractResponse]，onComplete: Option [Send =&gt; Unit]）：该方法接收的实际上是 Request，而非 Response，因此，它会在内部构造出 Response 对象之后，再调用 sendResponse 方法。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12071"><span data-slate-object="text" data-key="12072"><span data-slate-leaf="true" data-offset-key="12072:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendNoOpResponseExemptThrottle</span></span></span></span><span data-slate-object="text" data-key="12073"><span data-slate-leaf="true" data-offset-key="12073:0" data-first-offset="true"><span data-slate-string="true">：发送 NoOpResponse 类型的 Response 而不受请求通道上限流（throttling）的限制。所谓的 NoOpResponse，是指 Processor 线程取出该类型的 Response 后，不执行真正的 I/O 发送操作。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12074"><span data-slate-object="text" data-key="12075"><span data-slate-leaf="true" data-offset-key="12075:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendErrorResponseExemptThrottle</span></span></span></span><span data-slate-object="text" data-key="12076"><span data-slate-leaf="true" data-offset-key="12076:0" data-first-offset="true"><span data-slate-string="true">：发送携带错误信息的 Response 而不受限流限制。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12077"><span data-slate-object="text" data-key="12078"><span data-slate-leaf="true" data-offset-key="12078:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendResponseExemptThrottle</span></span></span></span><span data-slate-object="text" data-key="12079"><span data-slate-leaf="true" data-offset-key="12079:0" data-first-offset="true"><span data-slate-string="true">：发送普通 Response 而不受限流限制。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12080"><span data-slate-object="text" data-key="12081"><span data-slate-leaf="true" data-offset-key="12081:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendErrorResponseMaybeThrottle</span></span></span></span><span data-slate-object="text" data-key="12082"><span data-slate-leaf="true" data-offset-key="12082:0" data-first-offset="true"><span data-slate-string="true">：发送携带错误信息的 Response 但接受限流的约束。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12083"><span data-slate-object="text" data-key="12084"><span data-slate-leaf="true" data-offset-key="12084:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">sendResponseMaybeThrottle</span></span></span></span><span data-slate-object="text" data-key="12085"><span data-slate-leaf="true" data-offset-key="12085:0" data-first-offset="true"><span data-slate-string="true">：发送普通 Response 但接受限流的约束。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12086"><span data-slate-object="text" data-key="12087"><span data-slate-leaf="true" data-offset-key="12087:0" data-first-offset="true"><span data-slate-string="true">这组方法最关键的还是第一个 sendResponse 方法。大部分类型的请求被处理完成后都会使用这个方法将 Response 发送出去。至于上面这组方法中的其他方法，它们会在内部调用第一个 sendResponse 方法。当然，在调用之前，这些方法通常都拥有一些定制化的逻辑。比如 sendResponseMaybeThrottle 方法就会在执行 sendResponse 逻辑前，先尝试对请求所属的请求通道进行限流操作。因此，</span></span></span><span data-slate-object="text" data-key="12088"><span data-slate-leaf="true" data-offset-key="12088:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">我们要着重掌握第一个 sendResponse 方法是怎么将 Response 对象发送出去的</span></span></span></span><span data-slate-object="text" data-key="12089"><span data-slate-leaf="true" data-offset-key="12089:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12090"><span data-slate-object="text" data-key="12091"><span data-slate-leaf="true" data-offset-key="12091:0" data-first-offset="true"><span data-slate-string="true">就像我前面说的，</span></span></span><span data-slate-object="text" data-key="12092"><span data-slate-leaf="true" data-offset-key="12092:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">KafkaApis 实际上是把处理完成的 Response 放回到前端 Processor 线程的 Response 队列中，而真正将 Response 返还给 Clients 或其他 Broker 的，其实是 Processor 线程，而不是执行 KafkaApis 逻辑的 KafkaRequestHandler 线程</span></span></span></span><span data-slate-object="text" data-key="12093"><span data-slate-leaf="true" data-offset-key="12093:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12094"><span data-slate-object="text" data-key="12095"><span data-slate-leaf="true" data-offset-key="12095:0" data-first-offset="true"><span data-slate-string="true">另一个非常重要的方法是 authorize 方法，咱们看看它的代码：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="12096"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12097"><span data-slate-object="text" data-key="12098"><span data-slate-leaf="true" data-offset-key="12098:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="12099"><span data-slate-leaf="true" data-offset-key="12099:0" data-first-offset="true"><span data-slate-string="true">[server] def </span></span></span><span data-slate-object="text" data-key="12100"><span data-slate-leaf="true" data-offset-key="12100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorize</span></span></span></span><span data-slate-object="text" data-key="12101"><span data-slate-leaf="true" data-offset-key="12101:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12102"><span data-slate-leaf="true" data-offset-key="12102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">requestContext</span></span></span></span><span data-slate-object="text" data-key="12103"><span data-slate-leaf="true" data-offset-key="12103:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12104"><span data-slate-leaf="true" data-offset-key="12104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">RequestContext</span></span></span></span><span data-slate-object="text" data-key="12105"><span data-slate-leaf="true" data-offset-key="12105:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12106"><span data-slate-object="text" data-key="12107"><span data-slate-leaf="true" data-offset-key="12107:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12108"><span data-slate-leaf="true" data-offset-key="12108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">operation</span></span></span></span><span data-slate-object="text" data-key="12109"><span data-slate-leaf="true" data-offset-key="12109:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12110"><span data-slate-leaf="true" data-offset-key="12110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AclOperation</span></span></span></span><span data-slate-object="text" data-key="12111"><span data-slate-leaf="true" data-offset-key="12111:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12112"><span data-slate-object="text" data-key="12113"><span data-slate-leaf="true" data-offset-key="12113:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12114"><span data-slate-leaf="true" data-offset-key="12114:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">resourceType</span></span></span></span><span data-slate-object="text" data-key="12115"><span data-slate-leaf="true" data-offset-key="12115:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12116"><span data-slate-leaf="true" data-offset-key="12116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ResourceType</span></span></span></span><span data-slate-object="text" data-key="12117"><span data-slate-leaf="true" data-offset-key="12117:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12118"><span data-slate-object="text" data-key="12119"><span data-slate-leaf="true" data-offset-key="12119:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12120"><span data-slate-leaf="true" data-offset-key="12120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">resourceName</span></span></span></span><span data-slate-object="text" data-key="12121"><span data-slate-leaf="true" data-offset-key="12121:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12122"><span data-slate-leaf="true" data-offset-key="12122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="12123"><span data-slate-leaf="true" data-offset-key="12123:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12124"><span data-slate-object="text" data-key="12125"><span data-slate-leaf="true" data-offset-key="12125:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12126"><span data-slate-leaf="true" data-offset-key="12126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">logIfAllowed</span></span></span></span><span data-slate-object="text" data-key="12127"><span data-slate-leaf="true" data-offset-key="12127:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12128"><span data-slate-leaf="true" data-offset-key="12128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Boolean</span></span></span></span><span data-slate-object="text" data-key="12129"><span data-slate-leaf="true" data-offset-key="12129:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="12130"><span data-slate-leaf="true" data-offset-key="12130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="12131"><span data-slate-leaf="true" data-offset-key="12131:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12132"><span data-slate-object="text" data-key="12133"><span data-slate-leaf="true" data-offset-key="12133:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12134"><span data-slate-leaf="true" data-offset-key="12134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">logIfDenied</span></span></span></span><span data-slate-object="text" data-key="12135"><span data-slate-leaf="true" data-offset-key="12135:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12136"><span data-slate-leaf="true" data-offset-key="12136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Boolean</span></span></span></span><span data-slate-object="text" data-key="12137"><span data-slate-leaf="true" data-offset-key="12137:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="12138"><span data-slate-leaf="true" data-offset-key="12138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="12139"><span data-slate-leaf="true" data-offset-key="12139:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12140"><span data-slate-object="text" data-key="12141"><span data-slate-leaf="true" data-offset-key="12141:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12142"><span data-slate-leaf="true" data-offset-key="12142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">refCount</span></span></span></span><span data-slate-object="text" data-key="12143"><span data-slate-leaf="true" data-offset-key="12143:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12144"><span data-slate-leaf="true" data-offset-key="12144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Int</span></span></span></span><span data-slate-object="text" data-key="12145"><span data-slate-leaf="true" data-offset-key="12145:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="12146"><span data-slate-leaf="true" data-offset-key="12146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12147"><span data-slate-leaf="true" data-offset-key="12147:0" data-first-offset="true"><span data-slate-string="true">): </span></span></span><span data-slate-object="text" data-key="12148"><span data-slate-leaf="true" data-offset-key="12148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Boolean</span></span></span></span><span data-slate-object="text" data-key="12149"><span data-slate-leaf="true" data-offset-key="12149:0" data-first-offset="true"><span data-slate-string="true"> = {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12150"><span data-slate-object="text" data-key="12151"><span data-slate-leaf="true" data-offset-key="12151:0" data-first-offset="true"><span data-slate-string="true">  authorizer.</span></span></span><span data-slate-object="text" data-key="12152"><span data-slate-leaf="true" data-offset-key="12152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forall</span></span></span></span><span data-slate-object="text" data-key="12153"><span data-slate-leaf="true" data-offset-key="12153:0" data-first-offset="true"><span data-slate-string="true"> { </span></span></span><span data-slate-object="text" data-key="12154"><span data-slate-leaf="true" data-offset-key="12154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authZ</span></span></span></span></span><span data-slate-object="text" data-key="12155"><span data-slate-leaf="true" data-offset-key="12155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12156"><span data-slate-object="text" data-key="12157"><span data-slate-leaf="true" data-offset-key="12157:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12158"><span data-slate-leaf="true" data-offset-key="12158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取待鉴权的资源类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12159"><span data-slate-object="text" data-key="12160"><span data-slate-leaf="true" data-offset-key="12160:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12161"><span data-slate-leaf="true" data-offset-key="12161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 常见的资源类型如 TOPIC、GROUP、CLUSTER 等</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12162"><span data-slate-object="text" data-key="12163"><span data-slate-leaf="true" data-offset-key="12163:0" data-first-offset="true"><span data-slate-string="true">    val resource = </span></span></span><span data-slate-object="text" data-key="12164"><span data-slate-leaf="true" data-offset-key="12164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12165"><span data-slate-leaf="true" data-offset-key="12165:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12166"><span data-slate-leaf="true" data-offset-key="12166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ResourcePattern</span></span></span></span><span data-slate-object="text" data-key="12167"><span data-slate-leaf="true" data-offset-key="12167:0" data-first-offset="true"><span data-slate-string="true">(resourceType, resourceName, </span></span></span><span data-slate-object="text" data-key="12168"><span data-slate-leaf="true" data-offset-key="12168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PatternType</span></span></span></span><span data-slate-object="text" data-key="12169"><span data-slate-leaf="true" data-offset-key="12169:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12170"><span data-slate-leaf="true" data-offset-key="12170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LITERAL</span></span></span></span><span data-slate-object="text" data-key="12171"><span data-slate-leaf="true" data-offset-key="12171:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12172"><span data-slate-object="text" data-key="12173"><span data-slate-leaf="true" data-offset-key="12173:0" data-first-offset="true"><span data-slate-string="true">    val actions = </span></span></span><span data-slate-object="text" data-key="12174"><span data-slate-leaf="true" data-offset-key="12174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Collections</span></span></span></span><span data-slate-object="text" data-key="12175"><span data-slate-leaf="true" data-offset-key="12175:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12176"><span data-slate-leaf="true" data-offset-key="12176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">singletonList</span></span></span></span><span data-slate-object="text" data-key="12177"><span data-slate-leaf="true" data-offset-key="12177:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12178"><span data-slate-leaf="true" data-offset-key="12178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12179"><span data-slate-leaf="true" data-offset-key="12179:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12180"><span data-slate-leaf="true" data-offset-key="12180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Action</span></span></span></span><span data-slate-object="text" data-key="12181"><span data-slate-leaf="true" data-offset-key="12181:0" data-first-offset="true"><span data-slate-string="true">(operation, resource, refCount, logIfAllowed, logIfDenied))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12182"><span data-slate-object="text" data-key="12183"><span data-slate-leaf="true" data-offset-key="12183:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12184"><span data-slate-leaf="true" data-offset-key="12184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 返回鉴权结果，是 ALLOWED 还是 DENIED</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12185"><span data-slate-object="text" data-key="12186"><span data-slate-leaf="true" data-offset-key="12186:0" data-first-offset="true"><span data-slate-string="true">    authZ.</span></span></span><span data-slate-object="text" data-key="12187"><span data-slate-leaf="true" data-offset-key="12187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorize</span></span></span></span><span data-slate-object="text" data-key="12188"><span data-slate-leaf="true" data-offset-key="12188:0" data-first-offset="true"><span data-slate-string="true">(requestContext, actions).</span></span></span><span data-slate-object="text" data-key="12189"><span data-slate-leaf="true" data-offset-key="12189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asScala</span></span></span></span><span data-slate-object="text" data-key="12190"><span data-slate-leaf="true" data-offset-key="12190:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12191"><span data-slate-leaf="true" data-offset-key="12191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">head</span></span></span></span><span data-slate-object="text" data-key="12192"><span data-slate-leaf="true" data-offset-key="12192:0" data-first-offset="true"><span data-slate-string="true"> == </span></span></span><span data-slate-object="text" data-key="12193"><span data-slate-leaf="true" data-offset-key="12193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AuthorizationResult</span></span></span></span><span data-slate-object="text" data-key="12194"><span data-slate-leaf="true" data-offset-key="12194:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12195"><span data-slate-leaf="true" data-offset-key="12195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ALLOWED</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12196"><span data-slate-object="text" data-key="12197"><span data-slate-leaf="true" data-offset-key="12197:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12198"><span data-slate-object="text" data-key="12199"><span data-slate-leaf="true" data-offset-key="12199:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12200"><span data-slate-object="text" data-key="12201"><span data-slate-leaf="true" data-offset-key="12201:0" data-first-offset="true"><span data-slate-string="true">这个方法是做</span></span></span><span data-slate-object="text" data-key="12202"><span data-slate-leaf="true" data-offset-key="12202:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">授权检验</span></span></span></span><span data-slate-object="text" data-key="12203"><span data-slate-leaf="true" data-offset-key="12203:0" data-first-offset="true"><span data-slate-string="true">的。目前，Kafka 所有的 RPC 请求都要求发送者（无论是 Clients，还是其他 Broker）必须具备特定的权限。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12204"><span data-slate-object="text" data-key="12205"><span data-slate-leaf="true" data-offset-key="12205:0" data-first-offset="true"><span data-slate-string="true">接下来，我用创建主题的代码来举个例子，说明一下 authorize 方法的实际应用，以下是 handleCreateTopicsRequest 方法的片段：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="12206"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12207"><span data-slate-object="text" data-key="12208"><span data-slate-leaf="true" data-offset-key="12208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 是否具有 CLUSTER 资源的 CREATE 权限</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12209"><span data-slate-object="text" data-key="12210"><span data-slate-leaf="true" data-offset-key="12210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="12211"><span data-slate-leaf="true" data-offset-key="12211:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12212"><span data-slate-leaf="true" data-offset-key="12212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">hasClusterAuthorization</span></span></span></span><span data-slate-object="text" data-key="12213"><span data-slate-leaf="true" data-offset-key="12213:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12214"><span data-slate-leaf="true" data-offset-key="12214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12215"><span data-slate-leaf="true" data-offset-key="12215:0" data-first-offset="true"><span data-slate-string="true"> authorize(request, CREATE, CLUSTER, CLUSTER_NAME, logIfDenied = </span></span></span><span data-slate-object="text" data-key="12216"><span data-slate-leaf="true" data-offset-key="12216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="12217"><span data-slate-leaf="true" data-offset-key="12217:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12218"><span data-slate-object="text" data-key="12219"><span data-slate-leaf="true" data-offset-key="12219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="12220"><span data-slate-leaf="true" data-offset-key="12220:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12221"><span data-slate-leaf="true" data-offset-key="12221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">topics</span></span></span></span><span data-slate-object="text" data-key="12222"><span data-slate-leaf="true" data-offset-key="12222:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12223"><span data-slate-leaf="true" data-offset-key="12223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12224"><span data-slate-leaf="true" data-offset-key="12224:0" data-first-offset="true"><span data-slate-string="true"> createTopicsRequest.data.topics.asScala.map(_.name)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12225"><span data-slate-object="text" data-key="12226"><span data-slate-leaf="true" data-offset-key="12226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果具有 CLUSTER CREATE 权限，则允许主题创建，否则，还要查看是否具有 TOPIC 资源的 CREATE 权限</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12227"><span data-slate-object="text" data-key="12228"><span data-slate-leaf="true" data-offset-key="12228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="12229"><span data-slate-leaf="true" data-offset-key="12229:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12230"><span data-slate-leaf="true" data-offset-key="12230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorizedTopics</span></span></span></span><span data-slate-object="text" data-key="12231"><span data-slate-leaf="true" data-offset-key="12231:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12232"><span data-slate-leaf="true" data-offset-key="12232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12233"><span data-slate-leaf="true" data-offset-key="12233:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12234"><span data-slate-leaf="true" data-offset-key="12234:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12235"><span data-slate-leaf="true" data-offset-key="12235:0" data-first-offset="true"><span data-slate-string="true"> (hasClusterAuthorization) topics.toSet </span></span></span><span data-slate-object="text" data-key="12236"><span data-slate-leaf="true" data-offset-key="12236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="12237"><span data-slate-leaf="true" data-offset-key="12237:0" data-first-offset="true"><span data-slate-string="true"> filterAuthorized(request, CREATE, TOPIC, topics.toSeq)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12238"><span data-slate-object="text" data-key="12239"><span data-slate-leaf="true" data-offset-key="12239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 是否具有 TOPIC 资源的 DESCRIBE_CONFIGS 权限</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12240"><span data-slate-object="text" data-key="12241"><span data-slate-leaf="true" data-offset-key="12241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">val</span></span></span></span><span data-slate-object="text" data-key="12242"><span data-slate-leaf="true" data-offset-key="12242:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12243"><span data-slate-leaf="true" data-offset-key="12243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorizedForDescribeConfigs</span></span></span></span><span data-slate-object="text" data-key="12244"><span data-slate-leaf="true" data-offset-key="12244:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12245"><span data-slate-leaf="true" data-offset-key="12245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12246"><span data-slate-leaf="true" data-offset-key="12246:0" data-first-offset="true"><span data-slate-string="true"> filterAuthorized(request, DESCRIBE_CONFIGS, TOPIC, topics.toSeq, logIfDenied = </span></span></span><span data-slate-object="text" data-key="12247"><span data-slate-leaf="true" data-offset-key="12247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="12248"><span data-slate-leaf="true" data-offset-key="12248:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12249"><span data-slate-object="text" data-key="12250"><span data-slate-leaf="true" data-offset-key="12250:0" data-first-offset="true"><span data-slate-string="true">  .map(name =&gt; name -&gt; results.find(name)).toMap</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12251"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12252"><span data-slate-object="text" data-key="12253"><span data-slate-leaf="true" data-offset-key="12253:0" data-first-offset="true"><span data-slate-string="true">results.asScala.foreach(topic =&gt; {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12254"><span data-slate-object="text" data-key="12255"><span data-slate-leaf="true" data-offset-key="12255:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12256"><span data-slate-leaf="true" data-offset-key="12256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12257"><span data-slate-leaf="true" data-offset-key="12257:0" data-first-offset="true"><span data-slate-string="true"> (results.findAll(topic.name).size &gt; </span></span></span><span data-slate-object="text" data-key="12258"><span data-slate-leaf="true" data-offset-key="12258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12259"><span data-slate-leaf="true" data-offset-key="12259:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12260"><span data-slate-object="text" data-key="12261"><span data-slate-leaf="true" data-offset-key="12261:0" data-first-offset="true"><span data-slate-string="true">    topic.setErrorCode(Errors.INVALID_REQUEST.code)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12262"><span data-slate-object="text" data-key="12263"><span data-slate-leaf="true" data-offset-key="12263:0" data-first-offset="true"><span data-slate-string="true">    topic.setErrorMessage(</span></span></span><span data-slate-object="text" data-key="12264"><span data-slate-leaf="true" data-offset-key="12264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Found multiple entries for this topic."</span></span></span></span><span data-slate-object="text" data-key="12265"><span data-slate-leaf="true" data-offset-key="12265:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12266"><span data-slate-object="text" data-key="12267"><span data-slate-leaf="true" data-offset-key="12267:0" data-first-offset="true"><span data-slate-string="true">  } </span></span></span><span data-slate-object="text" data-key="12268"><span data-slate-leaf="true" data-offset-key="12268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="12269"><span data-slate-leaf="true" data-offset-key="12269:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12270"><span data-slate-leaf="true" data-offset-key="12270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12271"><span data-slate-leaf="true" data-offset-key="12271:0" data-first-offset="true"><span data-slate-string="true"> (!authorizedTopics.contains(topic.name)) { </span></span></span><span data-slate-object="text" data-key="12272"><span data-slate-leaf="true" data-offset-key="12272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果不具备 CLUSTER 资源的 CREATE 权限或 TOPIC 资源的 CREATE 权限，认证失败！</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12273"><span data-slate-object="text" data-key="12274"><span data-slate-leaf="true" data-offset-key="12274:0" data-first-offset="true"><span data-slate-string="true">    topic.setErrorCode(Errors.TOPIC_AUTHORIZATION_FAILED.code)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12275"><span data-slate-object="text" data-key="12276"><span data-slate-leaf="true" data-offset-key="12276:0" data-first-offset="true"><span data-slate-string="true">    topic.setErrorMessage(</span></span></span><span data-slate-object="text" data-key="12277"><span data-slate-leaf="true" data-offset-key="12277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Authorization failed."</span></span></span></span><span data-slate-object="text" data-key="12278"><span data-slate-leaf="true" data-offset-key="12278:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12279"><span data-slate-object="text" data-key="12280"><span data-slate-leaf="true" data-offset-key="12280:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12281"><span data-slate-object="text" data-key="12282"><span data-slate-leaf="true" data-offset-key="12282:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12283"><span data-slate-leaf="true" data-offset-key="12283:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12284"><span data-slate-leaf="true" data-offset-key="12284:0" data-first-offset="true"><span data-slate-string="true"> (!authorizedForDescribeConfigs.contains(topic.name)) { </span></span></span><span data-slate-object="text" data-key="12285"><span data-slate-leaf="true" data-offset-key="12285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果不具备 TOPIC 资源的 DESCRIBE_CONFIGS 权限，设置主题配置错误码</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12286"><span data-slate-object="text" data-key="12287"><span data-slate-leaf="true" data-offset-key="12287:0" data-first-offset="true"><span data-slate-string="true">    topic.setTopicConfigErrorCode(Errors.TOPIC_AUTHORIZATION_FAILED.code)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12288"><span data-slate-object="text" data-key="12289"><span data-slate-leaf="true" data-offset-key="12289:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12290"><span data-slate-object="text" data-key="12291"><span data-slate-leaf="true" data-offset-key="12291:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12292"><span data-slate-object="text" data-key="12293"><span data-slate-leaf="true" data-offset-key="12293:0" data-first-offset="true"><span data-slate-string="true">......</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12294"><span data-slate-object="text" data-key="12295"><span data-slate-leaf="true" data-offset-key="12295:0" data-first-offset="true"><span data-slate-string="true">这段代码调用 authorize 方法，来判断 Clients 方法是否具有创建主题的权限，如果没有，则显式标记 TOPIC_AUTHORIZATION_FAILED，告知 Clients 端。目前，Kafka 所有的权限控制均发生在 KafkaApis 中，即</span></span></span><span data-slate-object="text" data-key="12296"><span data-slate-leaf="true" data-offset-key="12296:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">所有请求在处理前，都需要调用 authorize 方法做权限校验，以保证请求能够被继续执行</span></span></span></span><span data-slate-object="text" data-key="12297"><span data-slate-leaf="true" data-offset-key="12297:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12298" id="sr-toc-4"><span data-slate-object="text" data-key="12299"><span data-slate-leaf="true" data-offset-key="12299:0" data-first-offset="true"><span data-slate-string="true">KafkaApis 请求处理实例解析</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12300"><span data-slate-object="text" data-key="12301"><span data-slate-leaf="true" data-offset-key="12301:0" data-first-offset="true"><span data-slate-string="true">在了解了 KafkaApis 的代码结构之后，我拿一段真实的代码，来说明一下该类中某个协议处理方法大致的执行流程是什么样的，以便让你更清楚地了解请求处理逻辑。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12302"><span data-slate-object="text" data-key="12303"><span data-slate-leaf="true" data-offset-key="12303:0" data-first-offset="true"><span data-slate-string="true">值得注意的是，这里的请求处理逻辑和之前所说的请求处理全流程是有所区别的。今天，我们关注的是</span></span></span><span data-slate-object="text" data-key="12304"><span data-slate-leaf="true" data-offset-key="12304:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">功能层面上请求被处理的逻辑代码</span></span></span></span><span data-slate-object="text" data-key="12305"><span data-slate-leaf="true" data-offset-key="12305:0" data-first-offset="true"><span data-slate-string="true">，之前的请求处理全流程主要聚焦流程方面的代码，即一个请求从被发送到 Broker 端到 Broker 端返还 Response 的代码路径。应该这么说，</span></span></span><span data-slate-object="text" data-key="12306"><span data-slate-leaf="true" data-offset-key="12306:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">所有类型请求的被处理流程都是相同的，但是，每类请求却有不同的功能实现逻辑</span></span></span></span><span data-slate-object="text" data-key="12307"><span data-slate-leaf="true" data-offset-key="12307:0" data-first-offset="true"><span data-slate-string="true">，而这就是 KafkaApis 类中的各个 handle×××Request 方法要做的事情。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12308"><span data-slate-object="text" data-key="12309"><span data-slate-leaf="true" data-offset-key="12309:0" data-first-offset="true"><span data-slate-string="true">下面，我以 handleListGroupsRequest 方法为例来介绍一下。顾名思义，这是处理 ListGroupsRequest 请求的方法。这类请求的 Response 应该返回集群中的消费者组信息。我们来看下它的实现：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="12310"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12311"><span data-slate-object="text" data-key="12312"><span data-slate-leaf="true" data-offset-key="12312:0" data-first-offset="true"><span data-slate-string="true">def </span></span></span><span data-slate-object="text" data-key="12313"><span data-slate-leaf="true" data-offset-key="12313:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">handleListGroupsRequest</span></span></span></span><span data-slate-object="text" data-key="12314"><span data-slate-leaf="true" data-offset-key="12314:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12315"><span data-slate-leaf="true" data-offset-key="12315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">request</span></span></span></span><span data-slate-object="text" data-key="12316"><span data-slate-leaf="true" data-offset-key="12316:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12317"><span data-slate-leaf="true" data-offset-key="12317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">RequestChannel</span></span></span></span><span data-slate-object="text" data-key="12318"><span data-slate-leaf="true" data-offset-key="12318:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12319"><span data-slate-leaf="true" data-offset-key="12319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Request</span></span></span></span><span data-slate-object="text" data-key="12320"><span data-slate-leaf="true" data-offset-key="12320:0" data-first-offset="true"><span data-slate-string="true">): </span></span></span><span data-slate-object="text" data-key="12321"><span data-slate-leaf="true" data-offset-key="12321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Unit</span></span></span></span><span data-slate-object="text" data-key="12322"><span data-slate-leaf="true" data-offset-key="12322:0" data-first-offset="true"><span data-slate-string="true"> = {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12323"><span data-slate-object="text" data-key="12324"><span data-slate-leaf="true" data-offset-key="12324:0" data-first-offset="true"><span data-slate-string="true">    val (error, groups) = groupCoordinator.</span></span></span><span data-slate-object="text" data-key="12325"><span data-slate-leaf="true" data-offset-key="12325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">handleListGroups</span></span></span></span><span data-slate-object="text" data-key="12326"><span data-slate-leaf="true" data-offset-key="12326:0" data-first-offset="true"><span data-slate-string="true">() </span></span></span><span data-slate-object="text" data-key="12327"><span data-slate-leaf="true" data-offset-key="12327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 调用 GroupCoordinator 的 handleListGroups 方法拿到所有 Group 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12328"><span data-slate-object="text" data-key="12329"><span data-slate-leaf="true" data-offset-key="12329:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12330"><span data-slate-leaf="true" data-offset-key="12330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果 Clients 具备 CLUSTER 资源的 DESCRIBE 权限</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12331"><span data-slate-object="text" data-key="12332"><span data-slate-leaf="true" data-offset-key="12332:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12333"><span data-slate-leaf="true" data-offset-key="12333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12334"><span data-slate-leaf="true" data-offset-key="12334:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="12335"><span data-slate-leaf="true" data-offset-key="12335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorize</span></span></span></span><span data-slate-object="text" data-key="12336"><span data-slate-leaf="true" data-offset-key="12336:0" data-first-offset="true"><span data-slate-string="true">(request, </span></span></span><span data-slate-object="text" data-key="12337"><span data-slate-leaf="true" data-offset-key="12337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">DESCRIBE</span></span></span></span><span data-slate-object="text" data-key="12338"><span data-slate-leaf="true" data-offset-key="12338:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12339"><span data-slate-leaf="true" data-offset-key="12339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CLUSTER</span></span></span></span><span data-slate-object="text" data-key="12340"><span data-slate-leaf="true" data-offset-key="12340:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12341"><span data-slate-leaf="true" data-offset-key="12341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CLUSTER_NAME</span></span></span></span><span data-slate-object="text" data-key="12342"><span data-slate-leaf="true" data-offset-key="12342:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12343"><span data-slate-object="text" data-key="12344"><span data-slate-leaf="true" data-offset-key="12344:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="12345"><span data-slate-leaf="true" data-offset-key="12345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 直接使用刚才拿到的 Group 数据封装进 Response 然后发送</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12346"><span data-slate-object="text" data-key="12347"><span data-slate-leaf="true" data-offset-key="12347:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="12348"><span data-slate-leaf="true" data-offset-key="12348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sendResponseMaybeThrottle</span></span></span></span><span data-slate-object="text" data-key="12349"><span data-slate-leaf="true" data-offset-key="12349:0" data-first-offset="true"><span data-slate-string="true">(request, </span></span></span><span data-slate-object="text" data-key="12350"><span data-slate-leaf="true" data-offset-key="12350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">requestThrottleMs</span></span></span></span></span><span data-slate-object="text" data-key="12351"><span data-slate-leaf="true" data-offset-key="12351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12352"><span data-slate-object="text" data-key="12353"><span data-slate-leaf="true" data-offset-key="12353:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12354"><span data-slate-leaf="true" data-offset-key="12354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12355"><span data-slate-leaf="true" data-offset-key="12355:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12356"><span data-slate-leaf="true" data-offset-key="12356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponse</span></span></span></span><span data-slate-object="text" data-key="12357"><span data-slate-leaf="true" data-offset-key="12357:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12358"><span data-slate-leaf="true" data-offset-key="12358:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12359"><span data-slate-leaf="true" data-offset-key="12359:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12360"><span data-slate-leaf="true" data-offset-key="12360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponseData</span></span></span></span><span data-slate-object="text" data-key="12361"><span data-slate-leaf="true" data-offset-key="12361:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12362"><span data-slate-object="text" data-key="12363"><span data-slate-leaf="true" data-offset-key="12363:0" data-first-offset="true"><span data-slate-string="true">            .</span></span></span><span data-slate-object="text" data-key="12364"><span data-slate-leaf="true" data-offset-key="12364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setErrorCode</span></span></span></span><span data-slate-object="text" data-key="12365"><span data-slate-leaf="true" data-offset-key="12365:0" data-first-offset="true"><span data-slate-string="true">(error.</span></span></span><span data-slate-object="text" data-key="12366"><span data-slate-leaf="true" data-offset-key="12366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">code</span></span></span></span><span data-slate-object="text" data-key="12367"><span data-slate-leaf="true" data-offset-key="12367:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12368"><span data-slate-object="text" data-key="12369"><span data-slate-leaf="true" data-offset-key="12369:0" data-first-offset="true"><span data-slate-string="true">            .</span></span></span><span data-slate-object="text" data-key="12370"><span data-slate-leaf="true" data-offset-key="12370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setGroups</span></span></span></span><span data-slate-object="text" data-key="12371"><span data-slate-leaf="true" data-offset-key="12371:0" data-first-offset="true"><span data-slate-string="true">(groups.</span></span></span><span data-slate-object="text" data-key="12372"><span data-slate-leaf="true" data-offset-key="12372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="12373"><span data-slate-leaf="true" data-offset-key="12373:0" data-first-offset="true"><span data-slate-string="true"> { </span></span></span><span data-slate-object="text" data-key="12374"><span data-slate-leaf="true" data-offset-key="12374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span></span><span data-slate-object="text" data-key="12375"><span data-slate-leaf="true" data-offset-key="12375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span><span data-slate-object="text" data-key="12376"><span data-slate-leaf="true" data-offset-key="12376:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12377"><span data-slate-leaf="true" data-offset-key="12377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12378"><span data-slate-leaf="true" data-offset-key="12378:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12379"><span data-slate-leaf="true" data-offset-key="12379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponseData</span></span></span></span><span data-slate-object="text" data-key="12380"><span data-slate-leaf="true" data-offset-key="12380:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12381"><span data-slate-leaf="true" data-offset-key="12381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListedGroup</span></span></span></span><span data-slate-object="text" data-key="12382"><span data-slate-leaf="true" data-offset-key="12382:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12383"><span data-slate-object="text" data-key="12384"><span data-slate-leaf="true" data-offset-key="12384:0" data-first-offset="true"><span data-slate-string="true">              .</span></span></span><span data-slate-object="text" data-key="12385"><span data-slate-leaf="true" data-offset-key="12385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setGroupId</span></span></span></span><span data-slate-object="text" data-key="12386"><span data-slate-leaf="true" data-offset-key="12386:0" data-first-offset="true"><span data-slate-string="true">(group.</span></span></span><span data-slate-object="text" data-key="12387"><span data-slate-leaf="true" data-offset-key="12387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">groupId</span></span></span></span><span data-slate-object="text" data-key="12388"><span data-slate-leaf="true" data-offset-key="12388:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12389"><span data-slate-object="text" data-key="12390"><span data-slate-leaf="true" data-offset-key="12390:0" data-first-offset="true"><span data-slate-string="true">              .</span></span></span><span data-slate-object="text" data-key="12391"><span data-slate-leaf="true" data-offset-key="12391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setProtocolType</span></span></span></span><span data-slate-object="text" data-key="12392"><span data-slate-leaf="true" data-offset-key="12392:0" data-first-offset="true"><span data-slate-string="true">(group.</span></span></span><span data-slate-object="text" data-key="12393"><span data-slate-leaf="true" data-offset-key="12393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">protocolType</span></span></span></span><span data-slate-object="text" data-key="12394"><span data-slate-leaf="true" data-offset-key="12394:0" data-first-offset="true"><span data-slate-string="true">)}.</span></span></span><span data-slate-object="text" data-key="12395"><span data-slate-leaf="true" data-offset-key="12395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asJava</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12396"><span data-slate-object="text" data-key="12397"><span data-slate-leaf="true" data-offset-key="12397:0" data-first-offset="true"><span data-slate-string="true">            )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12398"><span data-slate-object="text" data-key="12399"><span data-slate-leaf="true" data-offset-key="12399:0" data-first-offset="true"><span data-slate-string="true">            .</span></span></span><span data-slate-object="text" data-key="12400"><span data-slate-leaf="true" data-offset-key="12400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setThrottleTimeMs</span></span></span></span><span data-slate-object="text" data-key="12401"><span data-slate-leaf="true" data-offset-key="12401:0" data-first-offset="true"><span data-slate-string="true">(requestThrottleMs)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12402"><span data-slate-object="text" data-key="12403"><span data-slate-leaf="true" data-offset-key="12403:0" data-first-offset="true"><span data-slate-string="true">        ))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12404"><span data-slate-object="text" data-key="12405"><span data-slate-leaf="true" data-offset-key="12405:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12406"><span data-slate-leaf="true" data-offset-key="12406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="12407"><span data-slate-leaf="true" data-offset-key="12407:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12408"><span data-slate-object="text" data-key="12409"><span data-slate-leaf="true" data-offset-key="12409:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="12410"><span data-slate-leaf="true" data-offset-key="12410:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 找出 Clients 对哪些 Group 有 GROUP 资源的 DESCRIBE 权限，返回这些 Group 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12411"><span data-slate-object="text" data-key="12412"><span data-slate-leaf="true" data-offset-key="12412:0" data-first-offset="true"><span data-slate-string="true">      val filteredGroups = groups.</span></span></span><span data-slate-object="text" data-key="12413"><span data-slate-leaf="true" data-offset-key="12413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="12414"><span data-slate-leaf="true" data-offset-key="12414:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12415"><span data-slate-leaf="true" data-offset-key="12415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span></span><span data-slate-object="text" data-key="12416"><span data-slate-leaf="true" data-offset-key="12416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span><span data-slate-object="text" data-key="12417"><span data-slate-leaf="true" data-offset-key="12417:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12418"><span data-slate-leaf="true" data-offset-key="12418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authorize</span></span></span></span><span data-slate-object="text" data-key="12419"><span data-slate-leaf="true" data-offset-key="12419:0" data-first-offset="true"><span data-slate-string="true">(request, </span></span></span><span data-slate-object="text" data-key="12420"><span data-slate-leaf="true" data-offset-key="12420:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">DESCRIBE</span></span></span></span><span data-slate-object="text" data-key="12421"><span data-slate-leaf="true" data-offset-key="12421:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12422"><span data-slate-leaf="true" data-offset-key="12422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GROUP</span></span></span></span><span data-slate-object="text" data-key="12423"><span data-slate-leaf="true" data-offset-key="12423:0" data-first-offset="true"><span data-slate-string="true">, group.</span></span></span><span data-slate-object="text" data-key="12424"><span data-slate-leaf="true" data-offset-key="12424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">groupId</span></span></span></span><span data-slate-object="text" data-key="12425"><span data-slate-leaf="true" data-offset-key="12425:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12426"><span data-slate-object="text" data-key="12427"><span data-slate-leaf="true" data-offset-key="12427:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="12428"><span data-slate-leaf="true" data-offset-key="12428:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sendResponseMaybeThrottle</span></span></span></span><span data-slate-object="text" data-key="12429"><span data-slate-leaf="true" data-offset-key="12429:0" data-first-offset="true"><span data-slate-string="true">(request, </span></span></span><span data-slate-object="text" data-key="12430"><span data-slate-leaf="true" data-offset-key="12430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">requestThrottleMs</span></span></span></span></span><span data-slate-object="text" data-key="12431"><span data-slate-leaf="true" data-offset-key="12431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12432"><span data-slate-object="text" data-key="12433"><span data-slate-leaf="true" data-offset-key="12433:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12434"><span data-slate-leaf="true" data-offset-key="12434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12435"><span data-slate-leaf="true" data-offset-key="12435:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12436"><span data-slate-leaf="true" data-offset-key="12436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponse</span></span></span></span><span data-slate-object="text" data-key="12437"><span data-slate-leaf="true" data-offset-key="12437:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12438"><span data-slate-leaf="true" data-offset-key="12438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12439"><span data-slate-leaf="true" data-offset-key="12439:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12440"><span data-slate-leaf="true" data-offset-key="12440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponseData</span></span></span></span><span data-slate-object="text" data-key="12441"><span data-slate-leaf="true" data-offset-key="12441:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12442"><span data-slate-object="text" data-key="12443"><span data-slate-leaf="true" data-offset-key="12443:0" data-first-offset="true"><span data-slate-string="true">          .</span></span></span><span data-slate-object="text" data-key="12444"><span data-slate-leaf="true" data-offset-key="12444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setErrorCode</span></span></span></span><span data-slate-object="text" data-key="12445"><span data-slate-leaf="true" data-offset-key="12445:0" data-first-offset="true"><span data-slate-string="true">(error.</span></span></span><span data-slate-object="text" data-key="12446"><span data-slate-leaf="true" data-offset-key="12446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">code</span></span></span></span><span data-slate-object="text" data-key="12447"><span data-slate-leaf="true" data-offset-key="12447:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12448"><span data-slate-object="text" data-key="12449"><span data-slate-leaf="true" data-offset-key="12449:0" data-first-offset="true"><span data-slate-string="true">          .</span></span></span><span data-slate-object="text" data-key="12450"><span data-slate-leaf="true" data-offset-key="12450:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setGroups</span></span></span></span><span data-slate-object="text" data-key="12451"><span data-slate-leaf="true" data-offset-key="12451:0" data-first-offset="true"><span data-slate-string="true">(filteredGroups.</span></span></span><span data-slate-object="text" data-key="12452"><span data-slate-leaf="true" data-offset-key="12452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="12453"><span data-slate-leaf="true" data-offset-key="12453:0" data-first-offset="true"><span data-slate-string="true"> { </span></span></span><span data-slate-object="text" data-key="12454"><span data-slate-leaf="true" data-offset-key="12454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span></span><span data-slate-object="text" data-key="12455"><span data-slate-leaf="true" data-offset-key="12455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> =&gt;</span></span></span></span><span data-slate-object="text" data-key="12456"><span data-slate-leaf="true" data-offset-key="12456:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12457"><span data-slate-leaf="true" data-offset-key="12457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12458"><span data-slate-leaf="true" data-offset-key="12458:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12459"><span data-slate-leaf="true" data-offset-key="12459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListGroupsResponseData</span></span></span></span><span data-slate-object="text" data-key="12460"><span data-slate-leaf="true" data-offset-key="12460:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12461"><span data-slate-leaf="true" data-offset-key="12461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListedGroup</span></span></span></span><span data-slate-object="text" data-key="12462"><span data-slate-leaf="true" data-offset-key="12462:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12463"><span data-slate-object="text" data-key="12464"><span data-slate-leaf="true" data-offset-key="12464:0" data-first-offset="true"><span data-slate-string="true">            .</span></span></span><span data-slate-object="text" data-key="12465"><span data-slate-leaf="true" data-offset-key="12465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setGroupId</span></span></span></span><span data-slate-object="text" data-key="12466"><span data-slate-leaf="true" data-offset-key="12466:0" data-first-offset="true"><span data-slate-string="true">(group.</span></span></span><span data-slate-object="text" data-key="12467"><span data-slate-leaf="true" data-offset-key="12467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">groupId</span></span></span></span><span data-slate-object="text" data-key="12468"><span data-slate-leaf="true" data-offset-key="12468:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12469"><span data-slate-object="text" data-key="12470"><span data-slate-leaf="true" data-offset-key="12470:0" data-first-offset="true"><span data-slate-string="true">            .</span></span></span><span data-slate-object="text" data-key="12471"><span data-slate-leaf="true" data-offset-key="12471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setProtocolType</span></span></span></span><span data-slate-object="text" data-key="12472"><span data-slate-leaf="true" data-offset-key="12472:0" data-first-offset="true"><span data-slate-string="true">(group.</span></span></span><span data-slate-object="text" data-key="12473"><span data-slate-leaf="true" data-offset-key="12473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">protocolType</span></span></span></span><span data-slate-object="text" data-key="12474"><span data-slate-leaf="true" data-offset-key="12474:0" data-first-offset="true"><span data-slate-string="true">)}.</span></span></span><span data-slate-object="text" data-key="12475"><span data-slate-leaf="true" data-offset-key="12475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asJava</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12476"><span data-slate-object="text" data-key="12477"><span data-slate-leaf="true" data-offset-key="12477:0" data-first-offset="true"><span data-slate-string="true">          )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12478"><span data-slate-object="text" data-key="12479"><span data-slate-leaf="true" data-offset-key="12479:0" data-first-offset="true"><span data-slate-string="true">          .</span></span></span><span data-slate-object="text" data-key="12480"><span data-slate-leaf="true" data-offset-key="12480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">setThrottleTimeMs</span></span></span></span><span data-slate-object="text" data-key="12481"><span data-slate-leaf="true" data-offset-key="12481:0" data-first-offset="true"><span data-slate-string="true">(requestThrottleMs)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12482"><span data-slate-object="text" data-key="12483"><span data-slate-leaf="true" data-offset-key="12483:0" data-first-offset="true"><span data-slate-string="true">        ))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12484"><span data-slate-object="text" data-key="12485"><span data-slate-leaf="true" data-offset-key="12485:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12486"><span data-slate-object="text" data-key="12487"><span data-slate-leaf="true" data-offset-key="12487:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12488"><span data-slate-object="text" data-key="12489"><span data-slate-leaf="true" data-offset-key="12489:0" data-first-offset="true"><span data-slate-string="true">我用一张流程图，来说明一下这个执行逻辑：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12490"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/75/f3/7529b94b80cead7158be5a277e7ff4f3.jpg?wh=2284*3842"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12491"><span data-slate-object="text" data-key="12492"><span data-slate-leaf="true" data-offset-key="12492:0" data-first-offset="true"><span data-slate-string="true">大体来看，handleListGroupsRequest 方法的实现逻辑非常简单。通过 GroupCoordinator 组件获取到所有的消费者组信息之后，代码对这些 Group 进行了权限校验，并最终根据校验结果，决定给 Clients 返回哪些可见的消费者组。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12493" id="sr-toc-5"><span data-slate-object="text" data-key="12494"><span data-slate-leaf="true" data-offset-key="12494:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12495"><span data-slate-object="text" data-key="12496"><span data-slate-leaf="true" data-offset-key="12496:0" data-first-offset="true"><span data-slate-string="true">好了， 我们总结一下 KafkaApis 类的要点。如前所述，我们重点学习了 KafkaApis 类的定义及其重要方法 handle。下面这些关键知识点，希望你能掌握。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12497"><div data-slate-type="list-line" data-slate-object="block" data-key="12498"><span data-slate-object="text" data-key="12499"><span data-slate-leaf="true" data-offset-key="12499:0" data-first-offset="true"><span data-slate-string="true">KafkaApis 是 Broker 端所有功能的入口，同时关联了超多的 Kafka 组件。它绝对是你学习源码的第一入口。面对庞大的源码工程，如果你不知道从何下手，那就先从 KafkaApis.scala 这个文件开始吧。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12500"><span data-slate-object="text" data-key="12501"><span data-slate-leaf="true" data-offset-key="12501:0" data-first-offset="true"><span data-slate-string="true">handle 方法封装了所有 RPC 请求的具体处理逻辑。每当社区新增 RPC 协议时，增加对应的 handle×××Request 方法和 case 分支都是首要的。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12502"><span data-slate-object="text" data-key="12503"><span data-slate-leaf="true" data-offset-key="12503:0" data-first-offset="true"><span data-slate-string="true">sendResponse 系列方法负责发送 Response 给请求发送方。发送 Response 的逻辑是将 Response 对象放置在 Processor 线程的 Response 队列中，然后交由 Processor 线程实现网络发送。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12504"><span data-slate-object="text" data-key="12505"><span data-slate-leaf="true" data-offset-key="12505:0" data-first-offset="true"><span data-slate-string="true">authorize 方法是请求处理前权限校验层的主要逻辑实现。你可以查看一下</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12506"><span data-slate-object="text" data-key="12507"><span data-slate-leaf="true" data-offset-key="12507:0" data-first-offset="true"><span data-slate-string="true">官方文档</span></span></span></a><span data-slate-object="text" data-key="12508"><span data-slate-leaf="true" data-offset-key="12508:0" data-first-offset="true"><span data-slate-string="true">，了解一下当前都有哪些权限，然后对照着具体的方法，找出每类 RPC 协议都要求 Clients 端具备什么权限。</span></span></span></div></div><div data-slate-type="image" data-slate-object="block" data-key="12509"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/9e/4c/9ebd3f25518e387a7a60200a8b62114c.jpg?wh=2380*3004"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12510"><span data-slate-object="text" data-key="12511"><span data-slate-leaf="true" data-offset-key="12511:0" data-first-offset="true"><span data-slate-string="true">至此，关于 Kafka 请求处理模块的内容，我们就全部学完了。在这个模块中，我们先从 RequestChannel 入手，探讨了 Kafka 中请求队列的实现原理，之后，我花了两节课的时间，重点介绍了 SocketServer 组件，包括 Acceptor 线程、Processor 线程等子组件的源码以及请求被处理的全流程。今天，我们重点研究了 KafkaApis 类这个顶层的请求功能处理逻辑入口，补齐了请求处理的最后一块 “拼图”。我希望你能够把这个模块的课程多看几遍，认真思考一下这里面的关键实现要点，彻底搞明白 Kafka 网络通信的核心机制。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12512"><span data-slate-object="text" data-key="12513"><span data-slate-leaf="true" data-offset-key="12513:0" data-first-offset="true"><span data-slate-string="true">从下节课开始，我们将进入鼎鼎有名的控制器（Controller）组件的源码学习。我会花 5 节课的时间，带你深入学习 Controller 的方方面面，敬请期待。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12514" id="sr-toc-6"><span data-slate-object="text" data-key="12515"><span data-slate-leaf="true" data-offset-key="12515:0" data-first-offset="true"><span data-slate-string="true">课后讨论</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12516"><span data-slate-object="text" data-key="12517"><span data-slate-leaf="true" data-offset-key="12517:0" data-first-offset="true"><span data-slate-string="true">最后，请思考这样一个问题：如果一个 Consumer 要向 Broker 提交位移，它应该具备什么权限？你能说出 KafkaApis 中的哪段代码说明了所需的权限要求吗？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12518"><span data-slate-object="text" data-key="12519"><span data-slate-leaf="true" data-offset-key="12519:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区写下你的思考和答案，跟我交流讨论，也欢迎你把今天的内容分享给你的朋友。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-7">精选留言 (8)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>胡夕</span></div><span>置顶</span></div><div>你好，我是胡夕。我来公布上节课的 “课后讨论” 题答案啦～

上节课，咱们重点了解了请求处理的全流程。课后我请你思考这样一个问题，即请求处理流程的哪些部分应用了经典的 “生产者 - 消费者” 模式。其实在 Kafka 的网路通信层，请求队列和响应队列都应用了生产者 - 消费者模式。请求队列的生产者是 Processor 线程，消费者是 KafkaRequestHandler 线程；响应队列的生产者是 KafkaRequestHandler 线程，而 Processor 线程是消费者。

okay，你同意这个说法吗？或者说你有其他的看法吗？我们可以一起讨论下。</div><div><div>2020-05-19</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1a/9a/25/3e5e942b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>张子涵</span></div></div><div>个人觉得答案应该在 handleOffsetCommitRequest 方法中，比较贴近的应该是这一段                         
  //reject the request if not authorized to the group
    if (!authorize (request, READ, GROUP, offsetCommitRequest.data.groupId)) {
      val error = Errors.GROUP_AUTHORIZATION_FAILED
      val responseTopicList = OffsetCommitRequest.getErrorResponseTopics (
        offsetCommitRequest.data.topics,
        error)

      sendResponseMaybeThrottle (request, requestThrottleMs =&gt; new OffsetCommitResponse (
        new OffsetCommitResponseData ()
            .setTopics (responseTopicList)
            .setThrottleTimeMs (requestThrottleMs)
      ))   如果没有授权给组，则拒绝请求</div><div><p>作者回复: ������</p></div><div><div>2020-08-21</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span> 懂码哥 (GerryWen)</span></div></div><div>胡总，我们目前生产版本是 2.1.0，遇到一个比较严重也比较紧急问题，希望您能帮忙分析一下是不是版本问题。  很奇怪的现象就是重启某个有问题的 broker 就正常了，但是维持不到八个小时，又出问题了。
我把 jira 贴一下，你帮我看下，是否有人遇到同样问题问你。看 jira 回答，是在 2.1.1 版本修复了。
https://issues.apache.org/jira/browse/KAFKA-7697
https://issues.apache.org/jira/browse/KAFKA-7870
https://issues.apache.org/jira/browse/KAFKA-6582
谢谢谢谢谢谢！</div><div><p>作者回复：信息量太少了，光说是一个奇怪的问题，没有日志和相关描述很难判断啊：(

快速验证的话不妨升级到 2.1.1 试试呢</p></div><div><div>2020-07-08</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/76/53/21d62a23.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 鲁・本</span></div></div><div>if (!authorize (request.context, READ, GROUP, offsetCommitRequest.data.groupId)) {
需要消费者组有读权限</div><div><p>作者回复: ������</p></div><div><div>2020-08-27</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>曾轼麟</span></div></div><div>提交位移在 handleOffsetCommitRequest 方法中，需要判断当前发起 commitRequest 的 Consumer 对这个 group 是否有读权限</div><div><p>作者回复：是的～</p></div><div><div>2020-05-31</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 空知</span></div></div><div>有 READ 权限就可以了～～</div><div><p>作者回复：能确定所在代码吗：）</p></div><div><div>2020-05-14</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1d/ef/6b/5e8f6536.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>伯安知心</span></div></div><div>我看的 kafka 版本 0.9 中提交 consumer 位移在 handleoffsetcommitrequest 方法中，执行 authorize 验证在 simpleaclauthorizer 类 map 中是否包含这个用户，如果有则验证通过。</div><div><p>作者回复：是的，是否能再进一步，看看它需要什么权限？</p></div><div><div>2020-05-10</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/43/56/62c38c36.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>欧阳</span></div></div><div>老师，你好。学习 kafka 很容易想到 raft，理论上很多近似和相同的地方。我的问题是：在实际生产环境中，需要搭建跨地域的集群，保证一致性是不是根本就不太可行？集群随时都有可能脑裂？isr 集合一直变来变去。
如果不能跨地域的话，异地多中心的数据如何保证一致性呢？</div><div><p>作者回复：一般采用多套 Kafka 集群 + 异步同步的方式</p></div><div><div>2020-05-09</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".11"><outline class="toc-level-h1" data-reactid=".11.0" style="width: 175px;"><active data-reactid=".11.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".11.0.1"><span data-reactid=".11.0.1.0">10 | KafkaApis：Kafka 最重要的源码入口，没有之一</span></a></outline><outline class="toc-level-h2" data-reactid=".11.1" style="width: 165px;"><active data-reactid=".11.1.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".11.1.1"><span data-reactid=".11.1.1.0">KafkaApis 类定义</span></a></outline><outline class="toc-level-h2" data-reactid=".11.2" style="width: 165px;"><active data-reactid=".11.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".11.2.1"><span data-reactid=".11.2.1.0">KafkaApis 方法入口</span></a></outline><outline class="toc-level-h2" data-reactid=".11.3" style="width: 165px;"><active data-reactid=".11.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".11.3.1"><span data-reactid=".11.3.1.0">其他重要方法</span></a></outline><outline class="toc-level-h2" data-reactid=".11.4" style="width: 165px;"><active data-reactid=".11.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".11.4.1"><span data-reactid=".11.4.1.0">KafkaApis 请求处理实例解析</span></a></outline><outline class="toc-level-h2" data-reactid=".11.5" style="width: 165px;"><active data-reactid=".11.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".11.5.1"><span data-reactid=".11.5.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".11.6" style="width: 165px;"><active data-reactid=".11.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".11.6.1"><span data-reactid=".11.6.1.0">课后讨论</span></a></outline><outline class="toc-level-h2" data-reactid=".11.7" style="width: 165px;"><active data-reactid=".11.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".11.7.1"><span data-reactid=".11.7.1.0">精选留言 (8)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/233919" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>