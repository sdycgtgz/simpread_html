
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 14 | 项目管理：如何编写高质量的 Makefile？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>14 | 项目管理：如何编写高质量的 Makefile？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">14 | 项目管理：如何编写高质量的 Makefile？</h1><div><span>孔令飞</span> <span> 2021-06-26</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/07/aa/076987fa5d16e3b785f4b8e2a4a728aa.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：13.66M</span><span> 时长：14:57</span></div></div><audio title="14 | 项目管理：如何编写高质量的Makefile？" src="https://res001.geekbang.org/media/audio/b6/16/b676dda72c61a595148bb9c2fda7fa16/ld/ld.m3u8" __idm_id__="311311"></audio></div><div><div><div><div data-slate-editor="true" data-key="11235" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="11236"><span data-slate-object="text" data-key="11237"><span data-slate-leaf="true" data-offset-key="11237:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。今天我们来聊聊如何编写高质量的 Makefile。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11238"><span data-slate-object="text" data-key="11239"><span data-slate-leaf="true" data-offset-key="11239:0" data-first-offset="true"><span data-slate-string="true">我们在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11240"><span data-slate-object="text" data-key="11241"><span data-slate-leaf="true" data-offset-key="11241:0" data-first-offset="true"><span data-slate-string="true">第 10 讲</span></span></span></a><span data-slate-object="text" data-key="11242"><span data-slate-leaf="true" data-offset-key="11242:0" data-first-offset="true"><span data-slate-string="true"> 学习过，要写出一个优雅的 Go 项目，不仅仅是要开发一个优秀的 Go 应用，而且还要能够高效地管理项目。有效手段之一，就是通过 Makefile 来管理我们的项目，这就要求我们要为项目编写 Makefile 文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11243"><span data-slate-object="text" data-key="11244"><span data-slate-leaf="true" data-offset-key="11244:0" data-first-offset="true"><span data-slate-string="true">在和其他开发同学交流时，我发现大家都认可 Makefile 强大的项目管理能力，也会自己编写 Makefile。但是其中的一些人项目管理做得并不好，我和他们进一步交流后发现，这些同学在用 Makefile 简单的语法重复编写一些低质量 Makefile 文件，根本没有把 Makefile 的功能充分发挥出来。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11245"><span data-slate-object="text" data-key="11246"><span data-slate-leaf="true" data-offset-key="11246:0" data-first-offset="true"><span data-slate-string="true">下面给你举个例子，你就会理解低质量的 Makefile 文件是什么样的了。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="11247"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11248"><span data-slate-object="text" data-key="11249"><span data-slate-leaf="true" data-offset-key="11249:0" data-first-offset="true"><span data-slate-string="true">build: clean vet</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11250"><span data-slate-object="text" data-key="11251"><span data-slate-leaf="true" data-offset-key="11251:0" data-first-offset="true"><span data-slate-string="true">  @</span></span></span><span data-slate-object="text" data-key="11252"><span data-slate-leaf="true" data-offset-key="11252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="11253"><span data-slate-leaf="true" data-offset-key="11253:0" data-first-offset="true"><span data-slate-string="true"> -p ./Role</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11254"><span data-slate-object="text" data-key="11255"><span data-slate-leaf="true" data-offset-key="11255:0" data-first-offset="true"><span data-slate-string="true">  @</span></span></span><span data-slate-object="text" data-key="11256"><span data-slate-leaf="true" data-offset-key="11256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">export</span></span></span></span><span data-slate-object="text" data-key="11257"><span data-slate-leaf="true" data-offset-key="11257:0" data-first-offset="true"><span data-slate-string="true"> GOOS=linux &amp;&amp; go build -v .</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11258"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11259"><span data-slate-object="text" data-key="11260"><span data-slate-leaf="true" data-offset-key="11260:0" data-first-offset="true"><span data-slate-string="true">vet:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11261"><span data-slate-object="text" data-key="11262"><span data-slate-leaf="true" data-offset-key="11262:0" data-first-offset="true"><span data-slate-string="true">  go vet ./...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11263"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11264"><span data-slate-object="text" data-key="11265"><span data-slate-leaf="true" data-offset-key="11265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fmt</span></span></span></span><span data-slate-object="text" data-key="11266"><span data-slate-leaf="true" data-offset-key="11266:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11267"><span data-slate-object="text" data-key="11268"><span data-slate-leaf="true" data-offset-key="11268:0" data-first-offset="true"><span data-slate-string="true">  go </span></span></span><span data-slate-object="text" data-key="11269"><span data-slate-leaf="true" data-offset-key="11269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fmt</span></span></span></span><span data-slate-object="text" data-key="11270"><span data-slate-leaf="true" data-offset-key="11270:0" data-first-offset="true"><span data-slate-string="true"> ./...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11271"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11272"><span data-slate-object="text" data-key="11273"><span data-slate-leaf="true" data-offset-key="11273:0" data-first-offset="true"><span data-slate-string="true">clean:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11274"><span data-slate-object="text" data-key="11275"><span data-slate-leaf="true" data-offset-key="11275:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11276"><span data-slate-leaf="true" data-offset-key="11276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">rm</span></span></span></span><span data-slate-object="text" data-key="11277"><span data-slate-leaf="true" data-offset-key="11277:0" data-first-offset="true"><span data-slate-string="true"> -rf dashboard</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11278"><span data-slate-object="text" data-key="11279"><span data-slate-leaf="true" data-offset-key="11279:0" data-first-offset="true"><span data-slate-string="true">上面这个 Makefile 存在不少问题。例如：功能简单，只能完成最基本的编译、格式化等操作，像构建镜像、自动生成代码等一些高阶的功能都没有；扩展性差，没法编译出可在 Mac 下运行的二进制文件；没有 Help 功能，使用难度高；单 Makefile 文件，结构单一，不适合添加一些复杂的管理功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11280"><span data-slate-object="text" data-key="11281"><span data-slate-leaf="true" data-offset-key="11281:0" data-first-offset="true"><span data-slate-string="true">所以，我们不光要编写 Makefile，还要编写高质量的 Makefile。那么如何编写一个高质量的 Makefile 呢？我觉得，可以通过以下 4 个方法来实现：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="11282"><div data-slate-type="list-line" data-slate-object="block" data-key="11283"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="11284"><span data-slate-leaf="true" data-offset-key="11284:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d80d2500" data-attr-id="27940" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">打好基础，也就是熟练掌握 Makefile 的语法。</span></span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11285"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="11286"><span data-slate-leaf="true" data-offset-key="11286:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_12247f8e" data-attr-id="27941" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">做好准备工作，也就是提前规划 Makefile 要实现的功能。</span></span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11287"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="11288"><span data-slate-leaf="true" data-offset-key="11288:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_acf07170" data-attr-id="27942" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">进行规划，设计一个合理的 Makefile 结构。</span></span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11289"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="11290"><span data-slate-leaf="true" data-offset-key="11290:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d4fe058f" data-attr-id="27943" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">掌握方法，用好 Makefile 的编写技巧。</span></span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11291"><span data-slate-object="text" data-key="11292"><span data-slate-leaf="true" data-offset-key="11292:0" data-first-offset="true"><span data-slate-string="true">那么接下来，我们就详细看看这些方法。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11293" id="sr-toc-1"><span data-slate-object="text" data-key="11294"><span data-slate-leaf="true" data-offset-key="11294:0" data-first-offset="true"><span data-slate-string="true">熟练掌握 Makefile 语法</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11295"><span data-slate-object="text" data-key="11296"><span data-slate-leaf="true" data-offset-key="11296:0" data-first-offset="true"><span data-slate-string="true">工欲善其事，必先利其器。编写高质量 Makefile 的第一步，便是熟练掌握 Makefile 的核心语法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11297"><span data-slate-object="text" data-key="11298"><span data-slate-leaf="true" data-offset-key="11298:0" data-first-offset="true"><span data-slate-string="true">因为 Makefile 的语法比较多，我把一些建议你重点掌握的语法放在了近期会更新的特别放送中，包括 Makefile 规则语法、伪目标、变量赋值、条件语句和 Makefile 常用函数等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11299"><span data-slate-object="text" data-key="11300"><span data-slate-leaf="true" data-offset-key="11300:0" data-first-offset="true"><span data-slate-string="true">如果你想更深入、全面地学习 Makefile 的语法，我推荐你学习陈皓老师编写的</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11301"><span data-slate-object="text" data-key="11302"><span data-slate-leaf="true" data-offset-key="11302:0" data-first-offset="true"><span data-slate-string="true">《跟我一起写 Makefile》 (PDF 重制版)</span></span></span></a><span data-slate-object="text" data-key="11303"><span data-slate-leaf="true" data-offset-key="11303:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11304" id="sr-toc-2"><span data-slate-object="text" data-key="11305"><span data-slate-leaf="true" data-offset-key="11305:0" data-first-offset="true"><span data-slate-string="true">规划 Makefile 要实现的功能</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11306"><span data-slate-object="text" data-key="11307"><span data-slate-leaf="true" data-offset-key="11307:0" data-first-offset="true"><span data-slate-string="true">接着，我们需要规划 Makefile 要实现的功能。提前规划好功能，有利于你设计 Makefile 的整体结构和实现方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11308"><span data-slate-object="text" data-key="11309"><span data-slate-leaf="true" data-offset-key="11309:0" data-first-offset="true"><span data-slate-string="true">不同项目拥有不同的 Makefile 功能，这些功能中一小部分是通过目标文件来实现的，但更多的功能是通过伪目标来实现的。对于 Go 项目来说，虽然不同项目集成的功能不一样，但绝大部分项目都需要实现一些通用的功能。接下来，我们就来看看，在一个大型 Go 项目中 Makefile 通常可以实现的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11310"><span data-slate-object="text" data-key="11311"><span data-slate-leaf="true" data-offset-key="11311:0" data-first-offset="true"><span data-slate-string="true">下面是 IAM 项目的 Makefile 所集成的功能，希望会对你日后设计 Makefile 有一些帮助。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="11312"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11313"><span data-slate-object="text" data-key="11314"><span data-slate-leaf="true" data-offset-key="11314:0" data-first-offset="true"><span data-slate-string="true">$ make </span></span></span><span data-slate-object="text" data-key="11315"><span data-slate-leaf="true" data-offset-key="11315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11316"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11317"><span data-slate-object="text" data-key="11318"><span data-slate-leaf="true" data-offset-key="11318:0" data-first-offset="true"><span data-slate-string="true">Usage: make &lt;TARGETS&gt; &lt;OPTIONS&gt; ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11319"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11320"><span data-slate-object="text" data-key="11321"><span data-slate-leaf="true" data-offset-key="11321:0" data-first-offset="true"><span data-slate-string="true">Targets:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11322"><span data-slate-object="text" data-key="11323"><span data-slate-leaf="true" data-offset-key="11323:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11324"><span data-slate-leaf="true" data-offset-key="11324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 代码生成类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11325"><span data-slate-object="text" data-key="11326"><span data-slate-leaf="true" data-offset-key="11326:0" data-first-offset="true"><span data-slate-string="true">  gen                Generate </span></span></span><span data-slate-object="text" data-key="11327"><span data-slate-leaf="true" data-offset-key="11327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11328"><span data-slate-leaf="true" data-offset-key="11328:0" data-first-offset="true"><span data-slate-string="true"> necessary files, such </span></span></span><span data-slate-object="text" data-key="11329"><span data-slate-leaf="true" data-offset-key="11329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="11330"><span data-slate-leaf="true" data-offset-key="11330:0" data-first-offset="true"><span data-slate-string="true"> error code files.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11331"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11332"><span data-slate-object="text" data-key="11333"><span data-slate-leaf="true" data-offset-key="11333:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11334"><span data-slate-leaf="true" data-offset-key="11334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 格式化类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11335"><span data-slate-object="text" data-key="11336"><span data-slate-leaf="true" data-offset-key="11336:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11337"><span data-slate-leaf="true" data-offset-key="11337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="11338"><span data-slate-leaf="true" data-offset-key="11338:0" data-first-offset="true"><span data-slate-string="true">             Gofmt (reformat) package sources (exclude vendor </span></span></span><span data-slate-object="text" data-key="11339"><span data-slate-leaf="true" data-offset-key="11339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">dir</span></span></span></span><span data-slate-object="text" data-key="11340"><span data-slate-leaf="true" data-offset-key="11340:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11341"><span data-slate-leaf="true" data-offset-key="11341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="11342"><span data-slate-leaf="true" data-offset-key="11342:0" data-first-offset="true"><span data-slate-string="true"> existed).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11343"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11344"><span data-slate-object="text" data-key="11345"><span data-slate-leaf="true" data-offset-key="11345:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11346"><span data-slate-leaf="true" data-offset-key="11346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 静态代码检查</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11347"><span data-slate-object="text" data-key="11348"><span data-slate-leaf="true" data-offset-key="11348:0" data-first-offset="true"><span data-slate-string="true">  lint               Check syntax </span></span></span><span data-slate-object="text" data-key="11349"><span data-slate-leaf="true" data-offset-key="11349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">and</span></span></span></span><span data-slate-object="text" data-key="11350"><span data-slate-leaf="true" data-offset-key="11350:0" data-first-offset="true"><span data-slate-string="true"> styling of go sources.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11351"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11352"><span data-slate-object="text" data-key="11353"><span data-slate-leaf="true" data-offset-key="11353:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11354"><span data-slate-leaf="true" data-offset-key="11354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 测试类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11355"><span data-slate-object="text" data-key="11356"><span data-slate-leaf="true" data-offset-key="11356:0" data-first-offset="true"><span data-slate-string="true">  test               Run unit test.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11357"><span data-slate-object="text" data-key="11358"><span data-slate-leaf="true" data-offset-key="11358:0" data-first-offset="true"><span data-slate-string="true">  cover              Run unit test </span></span></span><span data-slate-object="text" data-key="11359"><span data-slate-leaf="true" data-offset-key="11359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">and</span></span></span></span><span data-slate-object="text" data-key="11360"><span data-slate-leaf="true" data-offset-key="11360:0" data-first-offset="true"><span data-slate-string="true"> get test coverage.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11361"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11362"><span data-slate-object="text" data-key="11363"><span data-slate-leaf="true" data-offset-key="11363:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11364"><span data-slate-leaf="true" data-offset-key="11364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 构建类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11365"><span data-slate-object="text" data-key="11366"><span data-slate-leaf="true" data-offset-key="11366:0" data-first-offset="true"><span data-slate-string="true">  build              Build source code </span></span></span><span data-slate-object="text" data-key="11367"><span data-slate-leaf="true" data-offset-key="11367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11368"><span data-slate-leaf="true" data-offset-key="11368:0" data-first-offset="true"><span data-slate-string="true"> host platform.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11369"><span data-slate-object="text" data-key="11370"><span data-slate-leaf="true" data-offset-key="11370:0" data-first-offset="true"><span data-slate-string="true">  build.multiarch    Build source code </span></span></span><span data-slate-object="text" data-key="11371"><span data-slate-leaf="true" data-offset-key="11371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11372"><span data-slate-leaf="true" data-offset-key="11372:0" data-first-offset="true"><span data-slate-string="true"> multiple platforms. See option PLATFORMS.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11373"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11374"><span data-slate-object="text" data-key="11375"><span data-slate-leaf="true" data-offset-key="11375:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11376"><span data-slate-leaf="true" data-offset-key="11376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># Docker 镜像打包类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11377"><span data-slate-object="text" data-key="11378"><span data-slate-leaf="true" data-offset-key="11378:0" data-first-offset="true"><span data-slate-string="true">  image              Build docker images </span></span></span><span data-slate-object="text" data-key="11379"><span data-slate-leaf="true" data-offset-key="11379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11380"><span data-slate-leaf="true" data-offset-key="11380:0" data-first-offset="true"><span data-slate-string="true"> host arch.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11381"><span data-slate-object="text" data-key="11382"><span data-slate-leaf="true" data-offset-key="11382:0" data-first-offset="true"><span data-slate-string="true">  image.multiarch    Build docker images </span></span></span><span data-slate-object="text" data-key="11383"><span data-slate-leaf="true" data-offset-key="11383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11384"><span data-slate-leaf="true" data-offset-key="11384:0" data-first-offset="true"><span data-slate-string="true"> multiple platforms. See option PLATFORMS.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11385"><span data-slate-object="text" data-key="11386"><span data-slate-leaf="true" data-offset-key="11386:0" data-first-offset="true"><span data-slate-string="true">  push               Build docker images </span></span></span><span data-slate-object="text" data-key="11387"><span data-slate-leaf="true" data-offset-key="11387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11388"><span data-slate-leaf="true" data-offset-key="11388:0" data-first-offset="true"><span data-slate-string="true"> host arch </span></span></span><span data-slate-object="text" data-key="11389"><span data-slate-leaf="true" data-offset-key="11389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">and</span></span></span></span><span data-slate-object="text" data-key="11390"><span data-slate-leaf="true" data-offset-key="11390:0" data-first-offset="true"><span data-slate-string="true"> push images to registry.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11391"><span data-slate-object="text" data-key="11392"><span data-slate-leaf="true" data-offset-key="11392:0" data-first-offset="true"><span data-slate-string="true">  push.multiarch     Build docker images </span></span></span><span data-slate-object="text" data-key="11393"><span data-slate-leaf="true" data-offset-key="11393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11394"><span data-slate-leaf="true" data-offset-key="11394:0" data-first-offset="true"><span data-slate-string="true"> multiple platforms </span></span></span><span data-slate-object="text" data-key="11395"><span data-slate-leaf="true" data-offset-key="11395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">and</span></span></span></span><span data-slate-object="text" data-key="11396"><span data-slate-leaf="true" data-offset-key="11396:0" data-first-offset="true"><span data-slate-string="true"> push images to registry.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11397"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11398"><span data-slate-object="text" data-key="11399"><span data-slate-leaf="true" data-offset-key="11399:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11400"><span data-slate-leaf="true" data-offset-key="11400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 部署类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11401"><span data-slate-object="text" data-key="11402"><span data-slate-leaf="true" data-offset-key="11402:0" data-first-offset="true"><span data-slate-string="true">  deploy             Deploy updated components to development env.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11403"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11404"><span data-slate-object="text" data-key="11405"><span data-slate-leaf="true" data-offset-key="11405:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11406"><span data-slate-leaf="true" data-offset-key="11406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 清理类命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11407"><span data-slate-object="text" data-key="11408"><span data-slate-leaf="true" data-offset-key="11408:0" data-first-offset="true"><span data-slate-string="true">  clean              Remove </span></span></span><span data-slate-object="text" data-key="11409"><span data-slate-leaf="true" data-offset-key="11409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11410"><span data-slate-leaf="true" data-offset-key="11410:0" data-first-offset="true"><span data-slate-string="true"> files that are created by building.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11411"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11412"><span data-slate-object="text" data-key="11413"><span data-slate-leaf="true" data-offset-key="11413:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11414"><span data-slate-leaf="true" data-offset-key="11414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 其他命令，不同项目会有区别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11415"><span data-slate-object="text" data-key="11416"><span data-slate-leaf="true" data-offset-key="11416:0" data-first-offset="true"><span data-slate-string="true">  release            Release iam</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11417"><span data-slate-object="text" data-key="11418"><span data-slate-leaf="true" data-offset-key="11418:0" data-first-offset="true"><span data-slate-string="true">  verify-copyright   Verify the boilerplate headers </span></span></span><span data-slate-object="text" data-key="11419"><span data-slate-leaf="true" data-offset-key="11419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11420"><span data-slate-leaf="true" data-offset-key="11420:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11421"><span data-slate-leaf="true" data-offset-key="11421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11422"><span data-slate-leaf="true" data-offset-key="11422:0" data-first-offset="true"><span data-slate-string="true"> files.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11423"><span data-slate-object="text" data-key="11424"><span data-slate-leaf="true" data-offset-key="11424:0" data-first-offset="true"><span data-slate-string="true">  ca                 Generate CA files </span></span></span><span data-slate-object="text" data-key="11425"><span data-slate-leaf="true" data-offset-key="11425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="11426"><span data-slate-leaf="true" data-offset-key="11426:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11427"><span data-slate-leaf="true" data-offset-key="11427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11428"><span data-slate-leaf="true" data-offset-key="11428:0" data-first-offset="true"><span data-slate-string="true"> iam components.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11429"><span data-slate-object="text" data-key="11430"><span data-slate-leaf="true" data-offset-key="11430:0" data-first-offset="true"><span data-slate-string="true">  install            Install iam system </span></span></span><span data-slate-object="text" data-key="11431"><span data-slate-leaf="true" data-offset-key="11431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">with</span></span></span></span><span data-slate-object="text" data-key="11432"><span data-slate-leaf="true" data-offset-key="11432:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11433"><span data-slate-leaf="true" data-offset-key="11433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11434"><span data-slate-leaf="true" data-offset-key="11434:0" data-first-offset="true"><span data-slate-string="true"> its components.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11435"><span data-slate-object="text" data-key="11436"><span data-slate-leaf="true" data-offset-key="11436:0" data-first-offset="true"><span data-slate-string="true">  swagger            Generate swagger document.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11437"><span data-slate-object="text" data-key="11438"><span data-slate-leaf="true" data-offset-key="11438:0" data-first-offset="true"><span data-slate-string="true">  tools              install dependent tools.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11439"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11440"><span data-slate-object="text" data-key="11441"><span data-slate-leaf="true" data-offset-key="11441:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11442"><span data-slate-leaf="true" data-offset-key="11442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 帮助命令</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11443"><span data-slate-object="text" data-key="11444"><span data-slate-leaf="true" data-offset-key="11444:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11445"><span data-slate-leaf="true" data-offset-key="11445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span><span data-slate-object="text" data-key="11446"><span data-slate-leaf="true" data-offset-key="11446:0" data-first-offset="true"><span data-slate-string="true">               Show this </span></span></span><span data-slate-object="text" data-key="11447"><span data-slate-leaf="true" data-offset-key="11447:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span><span data-slate-object="text" data-key="11448"><span data-slate-leaf="true" data-offset-key="11448:0" data-first-offset="true"><span data-slate-string="true"> info.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11449"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11450"><span data-slate-object="text" data-key="11451"><span data-slate-leaf="true" data-offset-key="11451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 选项</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11452"><span data-slate-object="text" data-key="11453"><span data-slate-leaf="true" data-offset-key="11453:0" data-first-offset="true"><span data-slate-string="true">Options:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11454"><span data-slate-object="text" data-key="11455"><span data-slate-leaf="true" data-offset-key="11455:0" data-first-offset="true"><span data-slate-string="true">  DEBUG        Whether to generate debug symbols. Default </span></span></span><span data-slate-object="text" data-key="11456"><span data-slate-leaf="true" data-offset-key="11456:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">is</span></span></span></span><span data-slate-object="text" data-key="11457"><span data-slate-leaf="true" data-offset-key="11457:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11458"><span data-slate-leaf="true" data-offset-key="11458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11459"><span data-slate-object="text" data-key="11460"><span data-slate-leaf="true" data-offset-key="11460:0" data-first-offset="true"><span data-slate-string="true">  BINS         The binaries to build. Default </span></span></span><span data-slate-object="text" data-key="11461"><span data-slate-leaf="true" data-offset-key="11461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">is</span></span></span></span><span data-slate-object="text" data-key="11462"><span data-slate-leaf="true" data-offset-key="11462:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11463"><span data-slate-leaf="true" data-offset-key="11463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="11464"><span data-slate-leaf="true" data-offset-key="11464:0" data-first-offset="true"><span data-slate-string="true"> of cmd.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11465"><span data-slate-object="text" data-key="11466"><span data-slate-leaf="true" data-offset-key="11466:0" data-first-offset="true"><span data-slate-string="true">               This option </span></span></span><span data-slate-object="text" data-key="11467"><span data-slate-leaf="true" data-offset-key="11467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">is</span></span></span></span><span data-slate-object="text" data-key="11468"><span data-slate-leaf="true" data-offset-key="11468:0" data-first-offset="true"><span data-slate-string="true"> available when using: make build/build.multiarch</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11469"><span data-slate-object="text" data-key="11470"><span data-slate-leaf="true" data-offset-key="11470:0" data-first-offset="true"><span data-slate-string="true">               Example: make build BINS=</span></span></span><span data-slate-object="text" data-key="11471"><span data-slate-leaf="true" data-offset-key="11471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iam-apiserver iam-authz-server"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11472"><span data-slate-object="text" data-key="11473"><span data-slate-leaf="true" data-offset-key="11473:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11474"><span data-slate-object="text" data-key="11475"><span data-slate-leaf="true" data-offset-key="11475:0" data-first-offset="true"><span data-slate-string="true">更详细的命令，你可以在 IAM 项目仓库根目录下执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11476"><span data-slate-object="text" data-key="11477"><span data-slate-leaf="true" data-offset-key="11477:0" data-first-offset="true"><span data-slate-string="true"> make help</span></span></span></span><span data-slate-object="text" data-key="11478"><span data-slate-leaf="true" data-offset-key="11478:0" data-first-offset="true"><span data-slate-string="true"> 查看。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11479"><span data-slate-object="text" data-key="11480"><span data-slate-leaf="true" data-offset-key="11480:0" data-first-offset="true"><span data-slate-string="true">通常而言，Go 项目的 Makefile 应该实现以下功能：格式化代码、静态代码检查、单元测试、代码构建、文件清理、帮助等等。如果通过 docker 部署，还需要有 docker 镜像打包功能。因为 Go 是跨平台的语言，所以构建和 docker 打包命令，还要能够支持不同的 CPU 架构和平台。为了能够更好地控制 Makefile 命令的行为，还需要支持 Options。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11481"><span data-slate-object="text" data-key="11482"><span data-slate-leaf="true" data-offset-key="11482:0" data-first-offset="true"><span data-slate-string="true">为了方便查看 Makefile 集成了哪些功能，我们需要支持 help 命令。help 命令最好通过解析 Makefile 文件来输出集成的功能，例如：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="11483"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11484"><span data-slate-object="text" data-key="11485"><span data-slate-leaf="true" data-offset-key="11485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## help: Show this help info.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11486"><span data-slate-object="text" data-key="11487"><span data-slate-leaf="true" data-offset-key="11487:0" data-first-offset="true"><span data-slate-string="true">.PHONY: </span></span></span><span data-slate-object="text" data-key="11488"><span data-slate-leaf="true" data-offset-key="11488:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11489"><span data-slate-object="text" data-key="11490"><span data-slate-leaf="true" data-offset-key="11490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span><span data-slate-object="text" data-key="11491"><span data-slate-leaf="true" data-offset-key="11491:0" data-first-offset="true"><span data-slate-string="true">: Makefile</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11492"><span data-slate-object="text" data-key="11493"><span data-slate-leaf="true" data-offset-key="11493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @echo -e </span></span></span></span><span data-slate-object="text" data-key="11494"><span data-slate-leaf="true" data-offset-key="11494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\nUsage: make &lt;TARGETS&gt; &lt;OPTIONS&gt; ...\n\nTargets:"</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11495"><span data-slate-object="text" data-key="11496"><span data-slate-leaf="true" data-offset-key="11496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @sed -n </span></span></span></span><span data-slate-object="text" data-key="11497"><span data-slate-leaf="true" data-offset-key="11497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'s/^##//p'</span></span></span></span></span><span data-slate-object="text" data-key="11498"><span data-slate-leaf="true" data-offset-key="11498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> $&lt; | column -t -s </span></span></span></span><span data-slate-object="text" data-key="11499"><span data-slate-leaf="true" data-offset-key="11499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">':'</span></span></span></span></span><span data-slate-object="text" data-key="11500"><span data-slate-leaf="true" data-offset-key="11500:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> | sed -e </span></span></span></span><span data-slate-object="text" data-key="11501"><span data-slate-leaf="true" data-offset-key="11501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'s/^/ /'</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11502"><span data-slate-object="text" data-key="11503"><span data-slate-leaf="true" data-offset-key="11503:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @echo </span></span></span></span><span data-slate-object="text" data-key="11504"><span data-slate-leaf="true" data-offset-key="11504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"$$USAGE_OPTIONS"</span></span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11505"><span data-slate-object="text" data-key="11506"><span data-slate-leaf="true" data-offset-key="11506:0" data-first-offset="true"><span data-slate-string="true">上面的 help 命令，通过解析 Makefile 文件中的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11507"><span data-slate-object="text" data-key="11508"><span data-slate-leaf="true" data-offset-key="11508:0" data-first-offset="true"><span data-slate-string="true">##</span></span></span></span><span data-slate-object="text" data-key="11509"><span data-slate-leaf="true" data-offset-key="11509:0" data-first-offset="true"><span data-slate-string="true">注释，获取支持的命令。通过这种方式，我们以后新加命令时，就不用再对 help 命令进行修改了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11510"><span data-slate-object="text" data-key="11511"><span data-slate-leaf="true" data-offset-key="11511:0" data-first-offset="true"><span data-slate-string="true">你可以参考上面的 Makefile 管理功能，结合自己项目的需求，整理出一个 Makefile 要实现的功能列表，并初步确定实现思路和方法。做完这些，你的编写前准备工作就基本完成了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11512" id="sr-toc-3"><span data-slate-object="text" data-key="11513"><span data-slate-leaf="true" data-offset-key="11513:0" data-first-offset="true"><span data-slate-string="true">设计合理的 Makefile 结构</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11514"><span data-slate-object="text" data-key="11515"><span data-slate-leaf="true" data-offset-key="11515:0" data-first-offset="true"><span data-slate-string="true">设计完 Makefile 需要实现的功能，接下来我们就进入 Makefile 编写阶段。编写阶段的第一步，就是设计一个合理的 Makefile 结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11516"><span data-slate-object="text" data-key="11517"><span data-slate-leaf="true" data-offset-key="11517:0" data-first-offset="true"><span data-slate-string="true">对于大型项目来说，需要管理的内容很多，所有管理功能都集成在一个 Makefile 中，可能会导致 Makefile 很大，难以阅读和维护，所以</span></span></span><span data-slate-object="text" data-key="11518"><span data-slate-leaf="true" data-offset-key="11518:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">建议采用分层的设计方法，根目录下的 Makefile 聚合所有的 Makefile 命令，具体实现则按功能分类，放在另外的 Makefile 中</span></span></span></span><span data-slate-object="text" data-key="11519"><span data-slate-leaf="true" data-offset-key="11519:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11520"><span data-slate-object="text" data-key="11521"><span data-slate-leaf="true" data-offset-key="11521:0" data-first-offset="true"><span data-slate-string="true">我们经常会在 Makefile 命令中集成 shell 脚本，但如果 shell 脚本过于复杂，也会导致 Makefile 内容过多，难以阅读和维护。并且在 Makefile 中集成复杂的 shell 脚本，编写体验也很差。对于这种情况，</span></span></span><span data-slate-object="text" data-key="11522"><span data-slate-leaf="true" data-offset-key="11522:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">可以将复杂的 shell 命令封装在 shell 脚本中，供 Makefile 直接调用，而一些简单的命令则可以直接集成在 Makefile 中</span></span></span></span><span data-slate-object="text" data-key="11523"><span data-slate-leaf="true" data-offset-key="11523:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11524"><span data-slate-object="text" data-key="11525"><span data-slate-leaf="true" data-offset-key="11525:0" data-first-offset="true"><span data-slate-string="true">所以，最终我推荐的 Makefile 结构如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11526"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/5c/f7/5c524e0297b6d6e4e151643d2e1bbbf7.png?wh=2575x1017"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11527"><span data-slate-object="text" data-key="11528"><span data-slate-leaf="true" data-offset-key="11528:0" data-first-offset="true"><span data-slate-string="true">在上面的 Makefile 组织方式中，根目录下的 Makefile 聚合了项目所有的管理功能，这些管理功能通过 Makefile 伪目标的方式实现。同时，还将这些伪目标进行分类，把相同类别的伪目标放在同一个 Makefile 中，这样可以使得 Makefile 更容易维护。对于复杂的命令，则编写成独立的 shell 脚本，并在 Makefile 命令中调用这些 shell 脚本。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11529"><span data-slate-object="text" data-key="11530"><span data-slate-leaf="true" data-offset-key="11530:0" data-first-offset="true"><span data-slate-string="true">举个例子，下面是 IAM 项目的 Makefile 组织结构：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="11531"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11532"><span data-slate-object="text" data-key="11533"><span data-slate-leaf="true" data-offset-key="11533:0" data-first-offset="true"><span data-slate-string="true">├── Makefile</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11534"><span data-slate-object="text" data-key="11535"><span data-slate-leaf="true" data-offset-key="11535:0" data-first-offset="true"><span data-slate-string="true">├── scripts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11536"><span data-slate-object="text" data-key="11537"><span data-slate-leaf="true" data-offset-key="11537:0" data-first-offset="true"><span data-slate-string="true">│   ├── gendoc.sh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11538"><span data-slate-object="text" data-key="11539"><span data-slate-leaf="true" data-offset-key="11539:0" data-first-offset="true"><span data-slate-string="true">│   ├── </span></span></span><span data-slate-object="text" data-key="11540"><span data-slate-leaf="true" data-offset-key="11540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="11541"><span data-slate-leaf="true" data-offset-key="11541:0" data-first-offset="true"><span data-slate-string="true">-rules</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11542"><span data-slate-object="text" data-key="11543"><span data-slate-leaf="true" data-offset-key="11543:0" data-first-offset="true"><span data-slate-string="true">│   │   ├── gen.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11544"><span data-slate-object="text" data-key="11545"><span data-slate-leaf="true" data-offset-key="11545:0" data-first-offset="true"><span data-slate-string="true">│   │   ├── golang.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11546"><span data-slate-object="text" data-key="11547"><span data-slate-leaf="true" data-offset-key="11547:0" data-first-offset="true"><span data-slate-string="true">│   │   ├── image.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11548"><span data-slate-object="text" data-key="11549"><span data-slate-leaf="true" data-offset-key="11549:0" data-first-offset="true"><span data-slate-string="true">│   │   └── ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11550"><span data-slate-object="text" data-key="11551"><span data-slate-leaf="true" data-offset-key="11551:0" data-first-offset="true"><span data-slate-string="true">    └── ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11552"><span data-slate-object="text" data-key="11553"><span data-slate-leaf="true" data-offset-key="11553:0" data-first-offset="true"><span data-slate-string="true">我们将相同类别的操作统一放在 scripts/make-rules 目录下的 Makefile 文件中。Makefile 的文件名参考分类命名，例如 golang.mk。最后，在 /Makefile 中 include 这些 Makefile。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11554"><span data-slate-object="text" data-key="11555"><span data-slate-leaf="true" data-offset-key="11555:0" data-first-offset="true"><span data-slate-string="true">为了跟 Makefile 的层级相匹配，golang.mk 中的所有目标都按</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11556"><span data-slate-object="text" data-key="11557"><span data-slate-leaf="true" data-offset-key="11557:0" data-first-offset="true"><span data-slate-string="true"> go.xxx</span></span></span></span><span data-slate-object="text" data-key="11558"><span data-slate-leaf="true" data-offset-key="11558:0" data-first-offset="true"><span data-slate-string="true"> 这种方式命名。通过这种命名方式，我们可以很容易分辨出某个目标完成什么功能，放在什么文件里，这在复杂的 Makefile 中尤其有用。以下是 IAM 项目根目录下，Makefile 的内容摘录，你可以看一看，作为参考：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="11559"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11560"><span data-slate-object="text" data-key="11561"><span data-slate-leaf="true" data-offset-key="11561:0" data-first-offset="true"><span data-slate-string="true">include scripts/make-rules/golang.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11562"><span data-slate-object="text" data-key="11563"><span data-slate-leaf="true" data-offset-key="11563:0" data-first-offset="true"><span data-slate-string="true">include scripts/make-rules/image.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11564"><span data-slate-object="text" data-key="11565"><span data-slate-leaf="true" data-offset-key="11565:0" data-first-offset="true"><span data-slate-string="true">include scripts/make-rules/gen.mk</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11566"><span data-slate-object="text" data-key="11567"><span data-slate-leaf="true" data-offset-key="11567:0" data-first-offset="true"><span data-slate-string="true">include scripts/make-rules/...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11568"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11569"><span data-slate-object="text" data-key="11570"><span data-slate-leaf="true" data-offset-key="11570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## build: Build source code for host platform.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11571"><span data-slate-object="text" data-key="11572"><span data-slate-leaf="true" data-offset-key="11572:0" data-first-offset="true"><span data-slate-string="true">.PHONY: build</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11573"><span data-slate-object="text" data-key="11574"><span data-slate-leaf="true" data-offset-key="11574:0" data-first-offset="true"><span data-slate-string="true">build:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11575"><span data-slate-object="text" data-key="11576"><span data-slate-leaf="true" data-offset-key="11576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11577"><span data-slate-leaf="true" data-offset-key="11577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span></span><span data-slate-object="text" data-key="11578"><span data-slate-leaf="true" data-offset-key="11578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) go.build</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11579"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11580"><span data-slate-object="text" data-key="11581"><span data-slate-leaf="true" data-offset-key="11581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## build.multiarch: Build source code for multiple platforms. See option PLATFORMS.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11582"><span data-slate-object="text" data-key="11583"><span data-slate-leaf="true" data-offset-key="11583:0" data-first-offset="true"><span data-slate-string="true">.PHONY: build.multiarch</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11584"><span data-slate-object="text" data-key="11585"><span data-slate-leaf="true" data-offset-key="11585:0" data-first-offset="true"><span data-slate-string="true">build.multiarch:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11586"><span data-slate-object="text" data-key="11587"><span data-slate-leaf="true" data-offset-key="11587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11588"><span data-slate-leaf="true" data-offset-key="11588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span></span><span data-slate-object="text" data-key="11589"><span data-slate-leaf="true" data-offset-key="11589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) go.build.multiarch</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11590"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11591"><span data-slate-object="text" data-key="11592"><span data-slate-leaf="true" data-offset-key="11592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## image: Build docker images for host arch.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11593"><span data-slate-object="text" data-key="11594"><span data-slate-leaf="true" data-offset-key="11594:0" data-first-offset="true"><span data-slate-string="true">.PHONY: image</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11595"><span data-slate-object="text" data-key="11596"><span data-slate-leaf="true" data-offset-key="11596:0" data-first-offset="true"><span data-slate-string="true">image:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11597"><span data-slate-object="text" data-key="11598"><span data-slate-leaf="true" data-offset-key="11598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11599"><span data-slate-leaf="true" data-offset-key="11599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span></span><span data-slate-object="text" data-key="11600"><span data-slate-leaf="true" data-offset-key="11600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) image.build</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11601"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11602"><span data-slate-object="text" data-key="11603"><span data-slate-leaf="true" data-offset-key="11603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## push: Build docker images for host arch and push images to registry.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11604"><span data-slate-object="text" data-key="11605"><span data-slate-leaf="true" data-offset-key="11605:0" data-first-offset="true"><span data-slate-string="true">.PHONY: push</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11606"><span data-slate-object="text" data-key="11607"><span data-slate-leaf="true" data-offset-key="11607:0" data-first-offset="true"><span data-slate-string="true">push:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11608"><span data-slate-object="text" data-key="11609"><span data-slate-leaf="true" data-offset-key="11609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11610"><span data-slate-leaf="true" data-offset-key="11610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span></span><span data-slate-object="text" data-key="11611"><span data-slate-leaf="true" data-offset-key="11611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) image.push</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11612"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11613"><span data-slate-object="text" data-key="11614"><span data-slate-leaf="true" data-offset-key="11614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">## ca: Generate CA files for all iam components.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11615"><span data-slate-object="text" data-key="11616"><span data-slate-leaf="true" data-offset-key="11616:0" data-first-offset="true"><span data-slate-string="true">.PHONY: ca</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11617"><span data-slate-object="text" data-key="11618"><span data-slate-leaf="true" data-offset-key="11618:0" data-first-offset="true"><span data-slate-string="true">ca:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11619"><span data-slate-object="text" data-key="11620"><span data-slate-leaf="true" data-offset-key="11620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11621"><span data-slate-leaf="true" data-offset-key="11621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span></span><span data-slate-object="text" data-key="11622"><span data-slate-leaf="true" data-offset-key="11622:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) gen.ca</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11623"><span data-slate-object="text" data-key="11624"><span data-slate-leaf="true" data-offset-key="11624:0" data-first-offset="true"><span data-slate-string="true">另外，一个合理的 Makefile 结构应该具有前瞻性。也就是说，要在不改变现有结构的情况下，接纳后面的新功能。这就需要你整理好 Makefile 当前要实现的功能、即将要实现的功能和未来可能会实现的功能，然后基于这些功能，利用 Makefile 编程技巧，编写可扩展的 Makefile。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11625"><span data-slate-object="text" data-key="11626"><span data-slate-leaf="true" data-offset-key="11626:0" data-first-offset="true"><span data-slate-string="true">这里需要你注意：上面的 Makefile 通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11627"><span data-slate-object="text" data-key="11628"><span data-slate-leaf="true" data-offset-key="11628:0" data-first-offset="true"><span data-slate-string="true">.PHONY</span></span></span></span><span data-slate-object="text" data-key="11629"><span data-slate-leaf="true" data-offset-key="11629:0" data-first-offset="true"><span data-slate-string="true"> 标识定义了大量的伪目标，定义伪目标一定要加 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11630"><span data-slate-object="text" data-key="11631"><span data-slate-leaf="true" data-offset-key="11631:0" data-first-offset="true"><span data-slate-string="true">.PHONY</span></span></span></span><span data-slate-object="text" data-key="11632"><span data-slate-leaf="true" data-offset-key="11632:0" data-first-offset="true"><span data-slate-string="true"> 标识，否则当有同名的文件时，伪目标可能不会被执行。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11633" id="sr-toc-4"><span data-slate-object="text" data-key="11634"><span data-slate-leaf="true" data-offset-key="11634:0" data-first-offset="true"><span data-slate-string="true">掌握 Makefile 编写技巧</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11635"><span data-slate-object="text" data-key="11636"><span data-slate-leaf="true" data-offset-key="11636:0" data-first-offset="true"><span data-slate-string="true">最后，在编写过程中，你还需要掌握一些 Makefile 的编写技巧，这些技巧可以使你编写的 Makefile 扩展性更强，功能更强大。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11637"><span data-slate-object="text" data-key="11638"><span data-slate-leaf="true" data-offset-key="11638:0" data-first-offset="true"><span data-slate-string="true">接下来，我会把自己长期开发过程中积累的一些 Makefile 编写经验分享给你。这些技巧，你需要在实际编写中多加练习，并形成编写习惯。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11639" id="sr-toc-5"><span data-slate-object="text" data-key="11640"><span data-slate-leaf="true" data-offset-key="11640:0" data-first-offset="true"><span data-slate-string="true">技巧 1：善用通配符和自动变量</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11641"><span data-slate-object="text" data-key="11642"><span data-slate-leaf="true" data-offset-key="11642:0" data-first-offset="true"><span data-slate-string="true">Makefile 允许对目标进行类似正则运算的匹配，主要用到的通配符是</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11643"><span data-slate-object="text" data-key="11644"><span data-slate-leaf="true" data-offset-key="11644:0" data-first-offset="true"><span data-slate-string="true"> %</span></span></span></span><span data-slate-object="text" data-key="11645"><span data-slate-leaf="true" data-offset-key="11645:0" data-first-offset="true"><span data-slate-string="true">。通过使用通配符，可以使不同的目标使用相同的规则，从而使 Makefile 扩展性更强，也更简洁。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11646"><span data-slate-object="text" data-key="11647"><span data-slate-leaf="true" data-offset-key="11647:0" data-first-offset="true"><span data-slate-string="true">我们的 IAM 实战项目中，就大量使用了通配符</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11648"><span data-slate-object="text" data-key="11649"><span data-slate-leaf="true" data-offset-key="11649:0" data-first-offset="true"><span data-slate-string="true"> %</span></span></span></span><span data-slate-object="text" data-key="11650"><span data-slate-leaf="true" data-offset-key="11650:0" data-first-offset="true"><span data-slate-string="true">，例如：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11651"><span data-slate-object="text" data-key="11652"><span data-slate-leaf="true" data-offset-key="11652:0" data-first-offset="true"><span data-slate-string="true">go.build.%</span></span></span></span><span data-slate-object="text" data-key="11653"><span data-slate-leaf="true" data-offset-key="11653:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11654"><span data-slate-object="text" data-key="11655"><span data-slate-leaf="true" data-offset-key="11655:0" data-first-offset="true"><span data-slate-string="true">ca.gen.%</span></span></span></span><span data-slate-object="text" data-key="11656"><span data-slate-leaf="true" data-offset-key="11656:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11657"><span data-slate-object="text" data-key="11658"><span data-slate-leaf="true" data-offset-key="11658:0" data-first-offset="true"><span data-slate-string="true">deploy.run.%</span></span></span></span><span data-slate-object="text" data-key="11659"><span data-slate-leaf="true" data-offset-key="11659:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11660"><span data-slate-object="text" data-key="11661"><span data-slate-leaf="true" data-offset-key="11661:0" data-first-offset="true"><span data-slate-string="true">tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11662"><span data-slate-leaf="true" data-offset-key="11662:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11663"><span data-slate-object="text" data-key="11664"><span data-slate-leaf="true" data-offset-key="11664:0" data-first-offset="true"><span data-slate-string="true">tools.install.%</span></span></span></span><span data-slate-object="text" data-key="11665"><span data-slate-leaf="true" data-offset-key="11665:0" data-first-offset="true"><span data-slate-string="true"> 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11666"><span data-slate-object="text" data-key="11667"><span data-slate-leaf="true" data-offset-key="11667:0" data-first-offset="true"><span data-slate-string="true">这里，我们来看一个具体的例子，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11668"><span data-slate-object="text" data-key="11669"><span data-slate-leaf="true" data-offset-key="11669:0" data-first-offset="true"><span data-slate-string="true">tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11670"><span data-slate-leaf="true" data-offset-key="11670:0" data-first-offset="true"><span data-slate-string="true">（位于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11671"><span data-slate-object="text" data-key="11672"><span data-slate-leaf="true" data-offset-key="11672:0" data-first-offset="true"><span data-slate-string="true">scripts/make-rules/tools.mk</span></span></span></a><span data-slate-object="text" data-key="11673"><span data-slate-leaf="true" data-offset-key="11673:0" data-first-offset="true"><span data-slate-string="true"> 文件中）定义如下：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="11674"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11675"><span data-slate-object="text" data-key="11676"><span data-slate-leaf="true" data-offset-key="11676:0" data-first-offset="true"><span data-slate-string="true">tools.</span></span></span><span data-slate-object="text" data-key="11677"><span data-slate-leaf="true" data-offset-key="11677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="11678"><span data-slate-leaf="true" data-offset-key="11678:0" data-first-offset="true"><span data-slate-string="true">.%:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11679"><span data-slate-object="text" data-key="11680"><span data-slate-leaf="true" data-offset-key="11680:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11681"><span data-slate-leaf="true" data-offset-key="11681:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@if</span></span></span></span><span data-slate-object="text" data-key="11682"><span data-slate-leaf="true" data-offset-key="11682:0" data-first-offset="true"><span data-slate-string="true"> ! which $* &amp;&gt;</span></span></span><span data-slate-object="text" data-key="11683"><span data-slate-leaf="true" data-offset-key="11683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/dev/</span></span></span></span><span data-slate-object="text" data-key="11684"><span data-slate-leaf="true" data-offset-key="11684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="11685"><span data-slate-leaf="true" data-offset-key="11685:0" data-first-offset="true"><span data-slate-string="true">; then $(</span></span></span><span data-slate-object="text" data-key="11686"><span data-slate-leaf="true" data-offset-key="11686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span><span data-slate-object="text" data-key="11687"><span data-slate-leaf="true" data-offset-key="11687:0" data-first-offset="true"><span data-slate-string="true">) tools.</span></span></span><span data-slate-object="text" data-key="11688"><span data-slate-leaf="true" data-offset-key="11688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">install</span></span></span></span><span data-slate-object="text" data-key="11689"><span data-slate-leaf="true" data-offset-key="11689:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="11690"><span data-slate-leaf="true" data-offset-key="11690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$</span></span></span></span><span data-slate-object="text" data-key="11691"><span data-slate-leaf="true" data-offset-key="11691:0" data-first-offset="true"><span data-slate-string="true">*; fi</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11692"><span data-slate-type="code" data-slate-object="inline" data-key="11693"><span data-slate-object="text" data-key="11694"><span data-slate-leaf="true" data-offset-key="11694:0" data-first-offset="true"><span data-slate-string="true">make tools.verify.swagger</span></span></span></span><span data-slate-object="text" data-key="11695"><span data-slate-leaf="true" data-offset-key="11695:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11696"><span data-slate-object="text" data-key="11697"><span data-slate-leaf="true" data-offset-key="11697:0" data-first-offset="true"><span data-slate-string="true">make tools.verify.mockgen</span></span></span></span><span data-slate-object="text" data-key="11698"><span data-slate-leaf="true" data-offset-key="11698:0" data-first-offset="true"><span data-slate-string="true"> 等均可以使用上面定义的规则，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11699"><span data-slate-object="text" data-key="11700"><span data-slate-leaf="true" data-offset-key="11700:0" data-first-offset="true"><span data-slate-string="true">%</span></span></span></span><span data-slate-object="text" data-key="11701"><span data-slate-leaf="true" data-offset-key="11701:0" data-first-offset="true"><span data-slate-string="true"> 分别代表了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11702"><span data-slate-object="text" data-key="11703"><span data-slate-leaf="true" data-offset-key="11703:0" data-first-offset="true"><span data-slate-string="true"> swagger</span></span></span></span><span data-slate-object="text" data-key="11704"><span data-slate-leaf="true" data-offset-key="11704:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11705"><span data-slate-object="text" data-key="11706"><span data-slate-leaf="true" data-offset-key="11706:0" data-first-offset="true"><span data-slate-string="true"> mockgen</span></span></span></span><span data-slate-object="text" data-key="11707"><span data-slate-leaf="true" data-offset-key="11707:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11708"><span data-slate-object="text" data-key="11709"><span data-slate-leaf="true" data-offset-key="11709:0" data-first-offset="true"><span data-slate-string="true">如果不使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11710"><span data-slate-object="text" data-key="11711"><span data-slate-leaf="true" data-offset-key="11711:0" data-first-offset="true"><span data-slate-string="true"> %</span></span></span></span><span data-slate-object="text" data-key="11712"><span data-slate-leaf="true" data-offset-key="11712:0" data-first-offset="true"><span data-slate-string="true">，则我们需要分别为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11713"><span data-slate-object="text" data-key="11714"><span data-slate-leaf="true" data-offset-key="11714:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.swagger</span></span></span></span><span data-slate-object="text" data-key="11715"><span data-slate-leaf="true" data-offset-key="11715:0" data-first-offset="true"><span data-slate-string="true"> 和</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11716"><span data-slate-object="text" data-key="11717"><span data-slate-leaf="true" data-offset-key="11717:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.mockgen</span></span></span></span><span data-slate-object="text" data-key="11718"><span data-slate-leaf="true" data-offset-key="11718:0" data-first-offset="true"><span data-slate-string="true"> 定义规则，很麻烦，后面修改也困难。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11719"><span data-slate-object="text" data-key="11720"><span data-slate-leaf="true" data-offset-key="11720:0" data-first-offset="true"><span data-slate-string="true">另外，这里也能看出</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11721"><span data-slate-object="text" data-key="11722"><span data-slate-leaf="true" data-offset-key="11722:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11723"><span data-slate-leaf="true" data-offset-key="11723:0" data-first-offset="true"><span data-slate-string="true"> 这种命名方式的好处：tools 说明依赖的定义位于</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11724"><span data-slate-object="text" data-key="11725"><span data-slate-leaf="true" data-offset-key="11725:0" data-first-offset="true"><span data-slate-string="true"> scripts/make-rules/tools.mk</span></span></span></span><span data-slate-object="text" data-key="11726"><span data-slate-leaf="true" data-offset-key="11726:0" data-first-offset="true"><span data-slate-string="true"> Makefile 中；</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11727"><span data-slate-object="text" data-key="11728"><span data-slate-leaf="true" data-offset-key="11728:0" data-first-offset="true"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="11729"><span data-slate-leaf="true" data-offset-key="11729:0" data-first-offset="true"><span data-slate-string="true"> 说明</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11730"><span data-slate-object="text" data-key="11731"><span data-slate-leaf="true" data-offset-key="11731:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11732"><span data-slate-leaf="true" data-offset-key="11732:0" data-first-offset="true"><span data-slate-string="true"> 伪目标属于 verify 分类，主要用来验证工具是否安装。通过这种命名方式，你可以很容易地知道目标位于哪个 Makefile 文件中，以及想要完成的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11733"><span data-slate-object="text" data-key="11734"><span data-slate-leaf="true" data-offset-key="11734:0" data-first-offset="true"><span data-slate-string="true">另外，上面的定义中还用到了自动变量</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11735"><span data-slate-object="text" data-key="11736"><span data-slate-leaf="true" data-offset-key="11736:0" data-first-offset="true"><span data-slate-string="true"> $*</span></span></span></span><span data-slate-object="text" data-key="11737"><span data-slate-leaf="true" data-offset-key="11737:0" data-first-offset="true"><span data-slate-string="true">，用来指代被匹配的值</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11738"><span data-slate-object="text" data-key="11739"><span data-slate-leaf="true" data-offset-key="11739:0" data-first-offset="true"><span data-slate-string="true"> swagger</span></span></span></span><span data-slate-object="text" data-key="11740"><span data-slate-leaf="true" data-offset-key="11740:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11741"><span data-slate-object="text" data-key="11742"><span data-slate-leaf="true" data-offset-key="11742:0" data-first-offset="true"><span data-slate-string="true">mockgen</span></span></span></span><span data-slate-object="text" data-key="11743"><span data-slate-leaf="true" data-offset-key="11743:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11744" id="sr-toc-6"><span data-slate-object="text" data-key="11745"><span data-slate-leaf="true" data-offset-key="11745:0" data-first-offset="true"><span data-slate-string="true">技巧 2：善用函数</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11746"><span data-slate-object="text" data-key="11747"><span data-slate-leaf="true" data-offset-key="11747:0" data-first-offset="true"><span data-slate-string="true">Makefile 自带的函数能够帮助我们实现很多强大的功能。所以，在我们编写 Makefile 的过程中，如果有功能需求，可以优先使用这些函数。我把常用的函数以及它们实现的功能整理在了 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11748"><span data-slate-object="text" data-key="11749"><span data-slate-leaf="true" data-offset-key="11749:0" data-first-offset="true"><span data-slate-string="true">Makefile 常用函数列表</span></span></span></a><span data-slate-object="text" data-key="11750"><span data-slate-leaf="true" data-offset-key="11750:0" data-first-offset="true"><span data-slate-string="true"> 中，你可以参考下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11751"><span data-slate-object="text" data-key="11752"><span data-slate-leaf="true" data-offset-key="11752:0" data-first-offset="true"><span data-slate-string="true">IAM 的 Makefile 文件中大量使用了上述函数，如果你想查看这些函数的具体使用方法和场景，可以参考 IAM 项目的 Makefile 文件 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11753"><span data-slate-object="text" data-key="11754"><span data-slate-leaf="true" data-offset-key="11754:0" data-first-offset="true"><span data-slate-string="true">make-rules</span></span></span></a><span data-slate-object="text" data-key="11755"><span data-slate-leaf="true" data-offset-key="11755:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11756" id="sr-toc-7"><span data-slate-object="text" data-key="11757"><span data-slate-leaf="true" data-offset-key="11757:0" data-first-offset="true"><span data-slate-string="true">技巧 3：依赖需要用到的工具</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11758"><span data-slate-object="text" data-key="11759"><span data-slate-leaf="true" data-offset-key="11759:0" data-first-offset="true"><span data-slate-string="true">如果 Makefile 某个目标的命令中用到了某个工具，可以将该工具放在目标的依赖中。这样，当执行该目标时，就可以指定检查系统是否安装该工具，如果没有安装则自动安装，从而实现更高程度的自动化。例如，/Makefile 文件中，format 伪目标，定义如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="11760"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11761"><span data-slate-object="text" data-key="11762"><span data-slate-leaf="true" data-offset-key="11762:0" data-first-offset="true"><span data-slate-string="true">.PHONY: </span></span></span><span data-slate-object="text" data-key="11763"><span data-slate-leaf="true" data-offset-key="11763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11764"><span data-slate-object="text" data-key="11765"><span data-slate-leaf="true" data-offset-key="11765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="11766"><span data-slate-leaf="true" data-offset-key="11766:0" data-first-offset="true"><span data-slate-string="true">: tools.verify.golines tools.verify.goimports</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11767"><span data-slate-object="text" data-key="11768"><span data-slate-leaf="true" data-offset-key="11768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @echo </span></span></span></span><span data-slate-object="text" data-key="11769"><span data-slate-leaf="true" data-offset-key="11769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"===========&gt; Formating codes"</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11770"><span data-slate-object="text" data-key="11771"><span data-slate-leaf="true" data-offset-key="11771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11772"><span data-slate-leaf="true" data-offset-key="11772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FIND</span></span></span></span></span><span data-slate-object="text" data-key="11773"><span data-slate-leaf="true" data-offset-key="11773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) -type f -name </span></span></span></span><span data-slate-object="text" data-key="11774"><span data-slate-leaf="true" data-offset-key="11774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'*.go'</span></span></span></span></span><span data-slate-object="text" data-key="11775"><span data-slate-leaf="true" data-offset-key="11775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> | $(</span></span></span></span><span data-slate-object="text" data-key="11776"><span data-slate-leaf="true" data-offset-key="11776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XARGS</span></span></span></span></span><span data-slate-object="text" data-key="11777"><span data-slate-leaf="true" data-offset-key="11777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) gofmt -s -w</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11778"><span data-slate-object="text" data-key="11779"><span data-slate-leaf="true" data-offset-key="11779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11780"><span data-slate-leaf="true" data-offset-key="11780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FIND</span></span></span></span></span><span data-slate-object="text" data-key="11781"><span data-slate-leaf="true" data-offset-key="11781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) -type f -name </span></span></span></span><span data-slate-object="text" data-key="11782"><span data-slate-leaf="true" data-offset-key="11782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'*.go'</span></span></span></span></span><span data-slate-object="text" data-key="11783"><span data-slate-leaf="true" data-offset-key="11783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> | $(</span></span></span></span><span data-slate-object="text" data-key="11784"><span data-slate-leaf="true" data-offset-key="11784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XARGS</span></span></span></span></span><span data-slate-object="text" data-key="11785"><span data-slate-leaf="true" data-offset-key="11785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) goimports -w -local $(</span></span></span></span><span data-slate-object="text" data-key="11786"><span data-slate-leaf="true" data-offset-key="11786:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ROOT_PACKAGE</span></span></span></span></span><span data-slate-object="text" data-key="11787"><span data-slate-leaf="true" data-offset-key="11787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11788"><span data-slate-object="text" data-key="11789"><span data-slate-leaf="true" data-offset-key="11789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11790"><span data-slate-leaf="true" data-offset-key="11790:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FIND</span></span></span></span></span><span data-slate-object="text" data-key="11791"><span data-slate-leaf="true" data-offset-key="11791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) -type f -name </span></span></span></span><span data-slate-object="text" data-key="11792"><span data-slate-leaf="true" data-offset-key="11792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'*.go'</span></span></span></span></span><span data-slate-object="text" data-key="11793"><span data-slate-leaf="true" data-offset-key="11793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> | $(</span></span></span></span><span data-slate-object="text" data-key="11794"><span data-slate-leaf="true" data-offset-key="11794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XARGS</span></span></span></span></span><span data-slate-object="text" data-key="11795"><span data-slate-leaf="true" data-offset-key="11795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) golines -w --max-len=</span></span></span></span><span data-slate-object="text" data-key="11796"><span data-slate-leaf="true" data-offset-key="11796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">120</span></span></span></span></span><span data-slate-object="text" data-key="11797"><span data-slate-leaf="true" data-offset-key="11797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> --reformat-tags --shorten-comments --ignore-generated .</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11798"><span data-slate-object="text" data-key="11799"><span data-slate-leaf="true" data-offset-key="11799:0" data-first-offset="true"><span data-slate-string="true">你可以看到，format 依赖</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11800"><span data-slate-object="text" data-key="11801"><span data-slate-leaf="true" data-offset-key="11801:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.golines tools.verify.goimports</span></span></span></span><span data-slate-object="text" data-key="11802"><span data-slate-leaf="true" data-offset-key="11802:0" data-first-offset="true"><span data-slate-string="true">。我们再来看下</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11803"><span data-slate-object="text" data-key="11804"><span data-slate-leaf="true" data-offset-key="11804:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.golines</span></span></span></span><span data-slate-object="text" data-key="11805"><span data-slate-leaf="true" data-offset-key="11805:0" data-first-offset="true"><span data-slate-string="true"> 的定义：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="11806"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11807"><span data-slate-object="text" data-key="11808"><span data-slate-leaf="true" data-offset-key="11808:0" data-first-offset="true"><span data-slate-string="true">tools.</span></span></span><span data-slate-object="text" data-key="11809"><span data-slate-leaf="true" data-offset-key="11809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="11810"><span data-slate-leaf="true" data-offset-key="11810:0" data-first-offset="true"><span data-slate-string="true">.%:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11811"><span data-slate-object="text" data-key="11812"><span data-slate-leaf="true" data-offset-key="11812:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="11813"><span data-slate-leaf="true" data-offset-key="11813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@if</span></span></span></span><span data-slate-object="text" data-key="11814"><span data-slate-leaf="true" data-offset-key="11814:0" data-first-offset="true"><span data-slate-string="true"> ! which $* &amp;&gt;</span></span></span><span data-slate-object="text" data-key="11815"><span data-slate-leaf="true" data-offset-key="11815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/dev/</span></span></span></span><span data-slate-object="text" data-key="11816"><span data-slate-leaf="true" data-offset-key="11816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="11817"><span data-slate-leaf="true" data-offset-key="11817:0" data-first-offset="true"><span data-slate-string="true">; then $(</span></span></span><span data-slate-object="text" data-key="11818"><span data-slate-leaf="true" data-offset-key="11818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span><span data-slate-object="text" data-key="11819"><span data-slate-leaf="true" data-offset-key="11819:0" data-first-offset="true"><span data-slate-string="true">) tools.</span></span></span><span data-slate-object="text" data-key="11820"><span data-slate-leaf="true" data-offset-key="11820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">install</span></span></span></span><span data-slate-object="text" data-key="11821"><span data-slate-leaf="true" data-offset-key="11821:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="11822"><span data-slate-leaf="true" data-offset-key="11822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$</span></span></span></span><span data-slate-object="text" data-key="11823"><span data-slate-leaf="true" data-offset-key="11823:0" data-first-offset="true"><span data-slate-string="true">*; fi</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11824"><span data-slate-object="text" data-key="11825"><span data-slate-leaf="true" data-offset-key="11825:0" data-first-offset="true"><span data-slate-string="true">再来看下</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11826"><span data-slate-object="text" data-key="11827"><span data-slate-leaf="true" data-offset-key="11827:0" data-first-offset="true"><span data-slate-string="true"> tools.install.$*</span></span></span></span><span data-slate-object="text" data-key="11828"><span data-slate-leaf="true" data-offset-key="11828:0" data-first-offset="true"><span data-slate-string="true"> 规则：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="11829"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11830"><span data-slate-object="text" data-key="11831"><span data-slate-leaf="true" data-offset-key="11831:0" data-first-offset="true"><span data-slate-string="true">.PHONY: install.golines</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11832"><span data-slate-object="text" data-key="11833"><span data-slate-leaf="true" data-offset-key="11833:0" data-first-offset="true"><span data-slate-string="true">install.golines:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11834"><span data-slate-object="text" data-key="11835"><span data-slate-leaf="true" data-offset-key="11835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @$(</span></span></span></span><span data-slate-object="text" data-key="11836"><span data-slate-leaf="true" data-offset-key="11836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO</span></span></span></span></span><span data-slate-object="text" data-key="11837"><span data-slate-leaf="true" data-offset-key="11837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">) get -u github.com/segmentio/golines</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11838"><span data-slate-object="text" data-key="11839"><span data-slate-leaf="true" data-offset-key="11839:0" data-first-offset="true"><span data-slate-string="true">通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11840"><span data-slate-object="text" data-key="11841"><span data-slate-leaf="true" data-offset-key="11841:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11842"><span data-slate-leaf="true" data-offset-key="11842:0" data-first-offset="true"><span data-slate-string="true"> 规则定义，我们可以知道，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11843"><span data-slate-object="text" data-key="11844"><span data-slate-leaf="true" data-offset-key="11844:0" data-first-offset="true"><span data-slate-string="true">tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11845"><span data-slate-leaf="true" data-offset-key="11845:0" data-first-offset="true"><span data-slate-string="true"> 会先检查工具是否安装，如果没有安装，就会执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11846"><span data-slate-object="text" data-key="11847"><span data-slate-leaf="true" data-offset-key="11847:0" data-first-offset="true"><span data-slate-string="true"> tools.install.$*</span></span></span></span><span data-slate-object="text" data-key="11848"><span data-slate-leaf="true" data-offset-key="11848:0" data-first-offset="true"><span data-slate-string="true"> 来安装。如此一来，当我们执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11849"><span data-slate-object="text" data-key="11850"><span data-slate-leaf="true" data-offset-key="11850:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.%</span></span></span></span><span data-slate-object="text" data-key="11851"><span data-slate-leaf="true" data-offset-key="11851:0" data-first-offset="true"><span data-slate-string="true"> 目标时，如果系统没有安装 golines 命令，就会自动调用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11852"><span data-slate-object="text" data-key="11853"><span data-slate-leaf="true" data-offset-key="11853:0" data-first-offset="true"><span data-slate-string="true"> go get</span></span></span></span><span data-slate-object="text" data-key="11854"><span data-slate-leaf="true" data-offset-key="11854:0" data-first-offset="true"><span data-slate-string="true"> 安装，提高了 Makefile 的自动化程度。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11855" id="sr-toc-8"><span data-slate-object="text" data-key="11856"><span data-slate-leaf="true" data-offset-key="11856:0" data-first-offset="true"><span data-slate-string="true">技巧 4：把常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11857"><span data-slate-object="text" data-key="11858"><span data-slate-leaf="true" data-offset-key="11858:0" data-first-offset="true"><span data-slate-string="true">一个项目，尤其是大型项目，有很多需要管理的地方，其中大部分都可以通过 Makefile 实现自动化操作。不过，为了保持 /Makefile 文件的整洁性，我们不能把所有的命令都添加在 /Makefile 文件中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11859"><span data-slate-object="text" data-key="11860"><span data-slate-leaf="true" data-offset-key="11860:0" data-first-offset="true"><span data-slate-string="true">一个比较好的建议是，将常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中，并在 /Makefile 中 include 这些分类 Makefile。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11861"><span data-slate-object="text" data-key="11862"><span data-slate-leaf="true" data-offset-key="11862:0" data-first-offset="true"><span data-slate-string="true">例如，IAM 项目的 /Makefile 集成了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11863"><span data-slate-object="text" data-key="11864"><span data-slate-leaf="true" data-offset-key="11864:0" data-first-offset="true"><span data-slate-string="true"> format</span></span></span></span><span data-slate-object="text" data-key="11865"><span data-slate-leaf="true" data-offset-key="11865:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11866"><span data-slate-object="text" data-key="11867"><span data-slate-leaf="true" data-offset-key="11867:0" data-first-offset="true"><span data-slate-string="true">lint</span></span></span></span><span data-slate-object="text" data-key="11868"><span data-slate-leaf="true" data-offset-key="11868:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11869"><span data-slate-object="text" data-key="11870"><span data-slate-leaf="true" data-offset-key="11870:0" data-first-offset="true"><span data-slate-string="true">test</span></span></span></span><span data-slate-object="text" data-key="11871"><span data-slate-leaf="true" data-offset-key="11871:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11872"><span data-slate-object="text" data-key="11873"><span data-slate-leaf="true" data-offset-key="11873:0" data-first-offset="true"><span data-slate-string="true">build</span></span></span></span><span data-slate-object="text" data-key="11874"><span data-slate-leaf="true" data-offset-key="11874:0" data-first-offset="true"><span data-slate-string="true"> 等常用命令，而将</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11875"><span data-slate-object="text" data-key="11876"><span data-slate-leaf="true" data-offset-key="11876:0" data-first-offset="true"><span data-slate-string="true"> gen.errcode.code</span></span></span></span><span data-slate-object="text" data-key="11877"><span data-slate-leaf="true" data-offset-key="11877:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11878"><span data-slate-object="text" data-key="11879"><span data-slate-leaf="true" data-offset-key="11879:0" data-first-offset="true"><span data-slate-string="true">gen.errcode.doc</span></span></span></span><span data-slate-object="text" data-key="11880"><span data-slate-leaf="true" data-offset-key="11880:0" data-first-offset="true"><span data-slate-string="true"> 这类不常用的功能放在 scripts/make-rules/gen.mk 文件中。当然，我们也可以直接执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11881"><span data-slate-object="text" data-key="11882"><span data-slate-leaf="true" data-offset-key="11882:0" data-first-offset="true"><span data-slate-string="true">make gen.errcode.code</span></span></span></span><span data-slate-object="text" data-key="11883"><span data-slate-leaf="true" data-offset-key="11883:0" data-first-offset="true"><span data-slate-string="true"> 来执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11884"><span data-slate-object="text" data-key="11885"><span data-slate-leaf="true" data-offset-key="11885:0" data-first-offset="true"><span data-slate-string="true"> gen.errcode.code</span></span></span></span><span data-slate-object="text" data-key="11886"><span data-slate-leaf="true" data-offset-key="11886:0" data-first-offset="true"><span data-slate-string="true"> 伪目标。通过这种方式，既可以保证 /Makefile 的简洁、易维护，又可以通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11887"><span data-slate-object="text" data-key="11888"><span data-slate-leaf="true" data-offset-key="11888:0" data-first-offset="true"><span data-slate-string="true"> make</span></span></span></span><span data-slate-object="text" data-key="11889"><span data-slate-leaf="true" data-offset-key="11889:0" data-first-offset="true"><span data-slate-string="true"> 命令来运行伪目标，更加灵活。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11890" id="sr-toc-9"><span data-slate-object="text" data-key="11891"><span data-slate-leaf="true" data-offset-key="11891:0" data-first-offset="true"><span data-slate-string="true">技巧 5：编写可扩展的 Makefile</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11892"><span data-slate-object="text" data-key="11893"><span data-slate-leaf="true" data-offset-key="11893:0" data-first-offset="true"><span data-slate-string="true">什么叫可扩展的 Makefile 呢？在我看来，可扩展的 Makefile 包含两层含义：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="11894"><div data-slate-type="list-line" data-slate-object="block" data-key="11895"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="11896"><span data-slate-leaf="true" data-offset-key="11896:0" data-first-offset="true"><span data-slate-string="true">可以在不改变 Makefile 结构的情况下添加新功能。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11897"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="11898"><span data-slate-leaf="true" data-offset-key="11898:0" data-first-offset="true"><span data-slate-string="true">扩展项目时，新功能可以自动纳入到 Makefile 现有逻辑中。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11899"><span data-slate-object="text" data-key="11900"><span data-slate-leaf="true" data-offset-key="11900:0" data-first-offset="true"><span data-slate-string="true">其中的第一点，我们可以通过设计合理的 Makefile 结构来实现。要实现第二点，就需要我们在编写 Makefile 时采用一定的技巧，例如多用通配符、自动变量、函数等。这里我们来看一个例子，可以让你更好地理解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11901"><span data-slate-object="text" data-key="11902"><span data-slate-leaf="true" data-offset-key="11902:0" data-first-offset="true"><span data-slate-string="true">在我们 IAM 实战项目的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11903"><span data-slate-object="text" data-key="11904"><span data-slate-leaf="true" data-offset-key="11904:0" data-first-offset="true"><span data-slate-string="true">golang.mk</span></span></span></a><span data-slate-object="text" data-key="11905"><span data-slate-leaf="true" data-offset-key="11905:0" data-first-offset="true"><span data-slate-string="true"> 中，执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11906"><span data-slate-object="text" data-key="11907"><span data-slate-leaf="true" data-offset-key="11907:0" data-first-offset="true"><span data-slate-string="true">make go.build</span></span></span></span><span data-slate-object="text" data-key="11908"><span data-slate-leaf="true" data-offset-key="11908:0" data-first-offset="true"><span data-slate-string="true"> 时能够构建 cmd/ 目录下的所有组件，也就是说，当有新组件添加时， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11909"><span data-slate-object="text" data-key="11910"><span data-slate-leaf="true" data-offset-key="11910:0" data-first-offset="true"><span data-slate-string="true">make go.build</span></span></span></span><span data-slate-object="text" data-key="11911"><span data-slate-leaf="true" data-offset-key="11911:0" data-first-offset="true"><span data-slate-string="true"> 仍然能够构建新增的组件，这就实现了上面说的第二点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11912"><span data-slate-object="text" data-key="11913"><span data-slate-leaf="true" data-offset-key="11913:0" data-first-offset="true"><span data-slate-string="true">具体实现方法如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="11914"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11915"><span data-slate-object="text" data-key="11916"><span data-slate-leaf="true" data-offset-key="11916:0" data-first-offset="true"><span data-slate-string="true">COMMANDS ?= $(filter-out %.md, $(wildcard </span></span></span><span data-slate-object="text" data-key="11917"><span data-slate-leaf="true" data-offset-key="11917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${ROOT_DIR}</span></span></span></span><span data-slate-object="text" data-key="11918"><span data-slate-leaf="true" data-offset-key="11918:0" data-first-offset="true"><span data-slate-string="true">/cmd/*))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11919"><span data-slate-object="text" data-key="11920"><span data-slate-leaf="true" data-offset-key="11920:0" data-first-offset="true"><span data-slate-string="true">BINS ?= $(foreach cmd,</span></span></span><span data-slate-object="text" data-key="11921"><span data-slate-leaf="true" data-offset-key="11921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${COMMANDS}</span></span></span></span><span data-slate-object="text" data-key="11922"><span data-slate-leaf="true" data-offset-key="11922:0" data-first-offset="true"><span data-slate-string="true">,$(notdir </span></span></span><span data-slate-object="text" data-key="11923"><span data-slate-leaf="true" data-offset-key="11923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${cmd}</span></span></span></span><span data-slate-object="text" data-key="11924"><span data-slate-leaf="true" data-offset-key="11924:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11925"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11926"><span data-slate-object="text" data-key="11927"><span data-slate-leaf="true" data-offset-key="11927:0" data-first-offset="true"><span data-slate-string="true">.PHONY: go.build</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11928"><span data-slate-object="text" data-key="11929"><span data-slate-leaf="true" data-offset-key="11929:0" data-first-offset="true"><span data-slate-string="true">go.build: go.build.verify $(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11930"><span data-slate-object="text" data-key="11931"><span data-slate-leaf="true" data-offset-key="11931:0" data-first-offset="true"><span data-slate-string="true">.PHONY: go.build.%               </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11932"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11933"><span data-slate-object="text" data-key="11934"><span data-slate-leaf="true" data-offset-key="11934:0" data-first-offset="true"><span data-slate-string="true">go.build.%:             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11935"><span data-slate-object="text" data-key="11936"><span data-slate-leaf="true" data-offset-key="11936:0" data-first-offset="true"><span data-slate-string="true">  $(</span></span></span><span data-slate-object="text" data-key="11937"><span data-slate-leaf="true" data-offset-key="11937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="11938"><span data-slate-leaf="true" data-offset-key="11938:0" data-first-offset="true"><span data-slate-string="true"> COMMAND := $(word 2,$(subst ., ,$*)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11939"><span data-slate-object="text" data-key="11940"><span data-slate-leaf="true" data-offset-key="11940:0" data-first-offset="true"><span data-slate-string="true">  $(</span></span></span><span data-slate-object="text" data-key="11941"><span data-slate-leaf="true" data-offset-key="11941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="11942"><span data-slate-leaf="true" data-offset-key="11942:0" data-first-offset="true"><span data-slate-string="true"> PLATFORM := $(word 1,$(subst ., ,$*)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11943"><span data-slate-object="text" data-key="11944"><span data-slate-leaf="true" data-offset-key="11944:0" data-first-offset="true"><span data-slate-string="true">  $(</span></span></span><span data-slate-object="text" data-key="11945"><span data-slate-leaf="true" data-offset-key="11945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="11946"><span data-slate-leaf="true" data-offset-key="11946:0" data-first-offset="true"><span data-slate-string="true"> OS := $(word 1,$(subst _, ,$(PLATFORM))))           </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11947"><span data-slate-object="text" data-key="11948"><span data-slate-leaf="true" data-offset-key="11948:0" data-first-offset="true"><span data-slate-string="true">  $(</span></span></span><span data-slate-object="text" data-key="11949"><span data-slate-leaf="true" data-offset-key="11949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="11950"><span data-slate-leaf="true" data-offset-key="11950:0" data-first-offset="true"><span data-slate-string="true"> ARCH := $(word 2,$(subst _, ,$(PLATFORM))))                         </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11951"><span data-slate-object="text" data-key="11952"><span data-slate-leaf="true" data-offset-key="11952:0" data-first-offset="true"><span data-slate-string="true">  @</span></span></span><span data-slate-object="text" data-key="11953"><span data-slate-leaf="true" data-offset-key="11953:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">echo</span></span></span></span><span data-slate-object="text" data-key="11954"><span data-slate-leaf="true" data-offset-key="11954:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11955"><span data-slate-leaf="true" data-offset-key="11955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"===========&gt; Building binary </span></span></span></span><span data-slate-object="text" data-key="11956"><span data-slate-leaf="true" data-offset-key="11956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$(COMMAND)</span></span></span></span></span><span data-slate-object="text" data-key="11957"><span data-slate-leaf="true" data-offset-key="11957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="11958"><span data-slate-leaf="true" data-offset-key="11958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$(VERSION)</span></span></span></span></span><span data-slate-object="text" data-key="11959"><span data-slate-leaf="true" data-offset-key="11959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> for </span></span></span></span><span data-slate-object="text" data-key="11960"><span data-slate-leaf="true" data-offset-key="11960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$(OS)</span></span></span></span></span><span data-slate-object="text" data-key="11961"><span data-slate-leaf="true" data-offset-key="11961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="11962"><span data-slate-leaf="true" data-offset-key="11962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$(ARCH)</span></span></span></span></span><span data-slate-object="text" data-key="11963"><span data-slate-leaf="true" data-offset-key="11963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11964"><span data-slate-object="text" data-key="11965"><span data-slate-leaf="true" data-offset-key="11965:0" data-first-offset="true"><span data-slate-string="true">  @</span></span></span><span data-slate-object="text" data-key="11966"><span data-slate-leaf="true" data-offset-key="11966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="11967"><span data-slate-leaf="true" data-offset-key="11967:0" data-first-offset="true"><span data-slate-string="true"> -p $(OUTPUT_DIR)/platforms/$(OS)/$(ARCH)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11968"><span data-slate-object="text" data-key="11969"><span data-slate-leaf="true" data-offset-key="11969:0" data-first-offset="true"><span data-slate-string="true">  @CGO_ENABLED=0 GOOS=$(OS) GOARCH=$(ARCH) $(GO) build $(GO_BUILD_FLAGS) -o $(OUTPUT_DIR)/platforms/$(OS)/$(ARCH)/$(COMMAND)$(GO_OUT_EXT) $(ROOT_PACKAGE)/cmd/$(COMMAND)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11970"><span data-slate-object="text" data-key="11971"><span data-slate-leaf="true" data-offset-key="11971:0" data-first-offset="true"><span data-slate-string="true">当执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11972"><span data-slate-object="text" data-key="11973"><span data-slate-leaf="true" data-offset-key="11973:0" data-first-offset="true"><span data-slate-string="true"> make go.build</span></span></span></span><span data-slate-object="text" data-key="11974"><span data-slate-leaf="true" data-offset-key="11974:0" data-first-offset="true"><span data-slate-string="true"> 时，会执行 go.build 的依赖 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11975"><span data-slate-object="text" data-key="11976"><span data-slate-leaf="true" data-offset-key="11976:0" data-first-offset="true"><span data-slate-string="true">$(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS)))</span></span></span></span><span data-slate-object="text" data-key="11977"><span data-slate-leaf="true" data-offset-key="11977:0" data-first-offset="true"><span data-slate-string="true"> ,</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11978"><span data-slate-object="text" data-key="11979"><span data-slate-leaf="true" data-offset-key="11979:0" data-first-offset="true"><span data-slate-string="true">addprefix</span></span></span></span><span data-slate-object="text" data-key="11980"><span data-slate-leaf="true" data-offset-key="11980:0" data-first-offset="true"><span data-slate-string="true"> 函数最终返回字符串 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11981"><span data-slate-object="text" data-key="11982"><span data-slate-leaf="true" data-offset-key="11982:0" data-first-offset="true"><span data-slate-string="true">go.build.linux_amd64.iamctl go.build.linux_amd64.iam-authz-server go.build.linux_amd64.iam-apiserver ...</span></span></span></span><span data-slate-object="text" data-key="11983"><span data-slate-leaf="true" data-offset-key="11983:0" data-first-offset="true"><span data-slate-string="true"> ，这时候就会执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11984"><span data-slate-object="text" data-key="11985"><span data-slate-leaf="true" data-offset-key="11985:0" data-first-offset="true"><span data-slate-string="true">go.build.%</span></span></span></span><span data-slate-object="text" data-key="11986"><span data-slate-leaf="true" data-offset-key="11986:0" data-first-offset="true"><span data-slate-string="true"> 伪目标。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11987"><span data-slate-object="text" data-key="11988"><span data-slate-leaf="true" data-offset-key="11988:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11989"><span data-slate-object="text" data-key="11990"><span data-slate-leaf="true" data-offset-key="11990:0" data-first-offset="true"><span data-slate-string="true">go.build.%</span></span></span></span><span data-slate-object="text" data-key="11991"><span data-slate-leaf="true" data-offset-key="11991:0" data-first-offset="true"><span data-slate-string="true"> 伪目标中，通过 eval、word、subst 函数组合，算出了 COMMAND 的值 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11992"><span data-slate-object="text" data-key="11993"><span data-slate-leaf="true" data-offset-key="11993:0" data-first-offset="true"><span data-slate-string="true">iamctl/iam-apiserver/iam-authz-server/...</span></span></span></span><span data-slate-object="text" data-key="11994"><span data-slate-leaf="true" data-offset-key="11994:0" data-first-offset="true"><span data-slate-string="true">，最终通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11995"><span data-slate-object="text" data-key="11996"><span data-slate-leaf="true" data-offset-key="11996:0" data-first-offset="true"><span data-slate-string="true">$(ROOT_PACKAGE)/cmd/$(COMMAND)</span></span></span></span><span data-slate-object="text" data-key="11997"><span data-slate-leaf="true" data-offset-key="11997:0" data-first-offset="true"><span data-slate-string="true"> 定位到需要构建的组件的 main 函数所在目录。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11998"><span data-slate-object="text" data-key="11999"><span data-slate-leaf="true" data-offset-key="11999:0" data-first-offset="true"><span data-slate-string="true">上述实现中有两个技巧，你可以注意下。首先，通过</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12000"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12001"><span data-slate-object="text" data-key="12002"><span data-slate-leaf="true" data-offset-key="12002:0" data-first-offset="true"><span data-slate-string="true">COMMANDS ?= $(filter-out %.md, $(wildcard </span></span></span><span data-slate-object="text" data-key="12003"><span data-slate-leaf="true" data-offset-key="12003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${ROOT_DIR}</span></span></span></span><span data-slate-object="text" data-key="12004"><span data-slate-leaf="true" data-offset-key="12004:0" data-first-offset="true"><span data-slate-string="true">/cmd/*))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12005"><span data-slate-object="text" data-key="12006"><span data-slate-leaf="true" data-offset-key="12006:0" data-first-offset="true"><span data-slate-string="true">BINS ?= $(foreach cmd,</span></span></span><span data-slate-object="text" data-key="12007"><span data-slate-leaf="true" data-offset-key="12007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${COMMANDS}</span></span></span></span><span data-slate-object="text" data-key="12008"><span data-slate-leaf="true" data-offset-key="12008:0" data-first-offset="true"><span data-slate-string="true">,$(notdir </span></span></span><span data-slate-object="text" data-key="12009"><span data-slate-leaf="true" data-offset-key="12009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${cmd}</span></span></span></span><span data-slate-object="text" data-key="12010"><span data-slate-leaf="true" data-offset-key="12010:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12011"><span data-slate-object="text" data-key="12012"><span data-slate-leaf="true" data-offset-key="12012:0" data-first-offset="true"><span data-slate-string="true">获取到了 cmd/ 目录下的所有组件名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12013"><span data-slate-object="text" data-key="12014"><span data-slate-leaf="true" data-offset-key="12014:0" data-first-offset="true"><span data-slate-string="true">接着，通过使用通配符和自动变量，自动匹配到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12015"><span data-slate-object="text" data-key="12016"><span data-slate-leaf="true" data-offset-key="12016:0" data-first-offset="true"><span data-slate-string="true"> go.build.linux_amd64.iam-authz-server</span></span></span></span><span data-slate-object="text" data-key="12017"><span data-slate-leaf="true" data-offset-key="12017:0" data-first-offset="true"><span data-slate-string="true"> 这类伪目标并构建。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12018"><span data-slate-object="text" data-key="12019"><span data-slate-leaf="true" data-offset-key="12019:0" data-first-offset="true"><span data-slate-string="true">可以看到，想要编写一个可扩展的 Makefile，熟练掌握 Makefile 的用法是基础，更多的是需要我们动脑思考如何去编写 Makefile。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12020" id="sr-toc-10"><span data-slate-object="text" data-key="12021"><span data-slate-leaf="true" data-offset-key="12021:0" data-first-offset="true"><span data-slate-string="true">技巧 6：将所有输出存放在一个目录下，方便清理和查找</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12022"><span data-slate-object="text" data-key="12023"><span data-slate-leaf="true" data-offset-key="12023:0" data-first-offset="true"><span data-slate-string="true">在执行 Makefile 的过程中，会输出各种各样的文件，例如 Go 编译后的二进制文件、测试覆盖率数据等，我建议你把这些文件统一放在一个目录下，方便后期的清理和查找。通常我们可以把它们放在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12024"><span data-slate-object="text" data-key="12025"><span data-slate-leaf="true" data-offset-key="12025:0" data-first-offset="true"><span data-slate-string="true">_output</span></span></span></span><span data-slate-object="text" data-key="12026"><span data-slate-leaf="true" data-offset-key="12026:0" data-first-offset="true"><span data-slate-string="true"> 这类目录下，这样清理时就很方便，只需要清理</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12027"><span data-slate-object="text" data-key="12028"><span data-slate-leaf="true" data-offset-key="12028:0" data-first-offset="true"><span data-slate-string="true">_output</span></span></span></span><span data-slate-object="text" data-key="12029"><span data-slate-leaf="true" data-offset-key="12029:0" data-first-offset="true"><span data-slate-string="true"> 文件夹就可以，例如：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12030"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12031"><span data-slate-object="text" data-key="12032"><span data-slate-leaf="true" data-offset-key="12032:0" data-first-offset="true"><span data-slate-string="true">.PHONY: go.clean</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12033"><span data-slate-object="text" data-key="12034"><span data-slate-leaf="true" data-offset-key="12034:0" data-first-offset="true"><span data-slate-string="true">go.clean:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12035"><span data-slate-object="text" data-key="12036"><span data-slate-leaf="true" data-offset-key="12036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @echo </span></span></span></span><span data-slate-object="text" data-key="12037"><span data-slate-leaf="true" data-offset-key="12037:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"===========&gt; Cleaning all build output"</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12038"><span data-slate-object="text" data-key="12039"><span data-slate-leaf="true" data-offset-key="12039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">  @-rm -vrf $(</span></span></span></span><span data-slate-object="text" data-key="12040"><span data-slate-leaf="true" data-offset-key="12040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OUTPUT_DIR</span></span></span></span></span><span data-slate-object="text" data-key="12041"><span data-slate-leaf="true" data-offset-key="12041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12042"><span data-slate-object="text" data-key="12043"><span data-slate-leaf="true" data-offset-key="12043:0" data-first-offset="true"><span data-slate-string="true">这里要注意，要用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12044"><span data-slate-object="text" data-key="12045"><span data-slate-leaf="true" data-offset-key="12045:0" data-first-offset="true"><span data-slate-string="true"> -rm</span></span></span></span><span data-slate-object="text" data-key="12046"><span data-slate-leaf="true" data-offset-key="12046:0" data-first-offset="true"><span data-slate-string="true">，而不是</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12047"><span data-slate-object="text" data-key="12048"><span data-slate-leaf="true" data-offset-key="12048:0" data-first-offset="true"><span data-slate-string="true"> rm</span></span></span></span><span data-slate-object="text" data-key="12049"><span data-slate-leaf="true" data-offset-key="12049:0" data-first-offset="true"><span data-slate-string="true">，防止在没有</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12050"><span data-slate-object="text" data-key="12051"><span data-slate-leaf="true" data-offset-key="12051:0" data-first-offset="true"><span data-slate-string="true">_output</span></span></span></span><span data-slate-object="text" data-key="12052"><span data-slate-leaf="true" data-offset-key="12052:0" data-first-offset="true"><span data-slate-string="true"> 目录时，执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12053"><span data-slate-object="text" data-key="12054"><span data-slate-leaf="true" data-offset-key="12054:0" data-first-offset="true"><span data-slate-string="true"> make go.clean</span></span></span></span><span data-slate-object="text" data-key="12055"><span data-slate-leaf="true" data-offset-key="12055:0" data-first-offset="true"><span data-slate-string="true"> 报错。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12056" id="sr-toc-11"><span data-slate-object="text" data-key="12057"><span data-slate-leaf="true" data-offset-key="12057:0" data-first-offset="true"><span data-slate-string="true">技巧 7：使用带层级的命名方式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12058"><span data-slate-object="text" data-key="12059"><span data-slate-leaf="true" data-offset-key="12059:0" data-first-offset="true"><span data-slate-string="true">通过使用带层级的命名方式，例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12060"><span data-slate-object="text" data-key="12061"><span data-slate-leaf="true" data-offset-key="12061:0" data-first-offset="true"><span data-slate-string="true"> tools.verify.swagger</span></span></span></span><span data-slate-object="text" data-key="12062"><span data-slate-leaf="true" data-offset-key="12062:0" data-first-offset="true"><span data-slate-string="true"> ，我们可以实现</span></span></span><span data-slate-object="text" data-key="12063"><span data-slate-leaf="true" data-offset-key="12063:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">目标分组管理</span></span></span></span><span data-slate-object="text" data-key="12064"><span data-slate-leaf="true" data-offset-key="12064:0" data-first-offset="true"><span data-slate-string="true">。这样做的好处有很多。首先，当 Makefile 有大量目标时，通过分组，我们可以更好地管理这些目标。其次，分组也能方便理解，可以通过组名一眼识别出该目标的功能类别。最后，这样做还可以大大减小目标重名的概率。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12065"><span data-slate-object="text" data-key="12066"><span data-slate-leaf="true" data-offset-key="12066:0" data-first-offset="true"><span data-slate-string="true">例如，IAM 项目的 Makefile 就大量采用了下面这种命名方式。</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="12067"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12068"><span data-slate-object="text" data-key="12069"><span data-slate-leaf="true" data-offset-key="12069:0" data-first-offset="true"><span data-slate-string="true">.PHONY: gen.run</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12070"><span data-slate-object="text" data-key="12071"><span data-slate-leaf="true" data-offset-key="12071:0" data-first-offset="true"><span data-slate-string="true">gen.run: gen.clean gen.errcode gen.docgo</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12072"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12073"><span data-slate-object="text" data-key="12074"><span data-slate-leaf="true" data-offset-key="12074:0" data-first-offset="true"><span data-slate-string="true">.PHONY: gen.errcode</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12075"><span data-slate-object="text" data-key="12076"><span data-slate-leaf="true" data-offset-key="12076:0" data-first-offset="true"><span data-slate-string="true">gen.errcode: gen.errcode.code gen.errcode.doc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12077"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12078"><span data-slate-object="text" data-key="12079"><span data-slate-leaf="true" data-offset-key="12079:0" data-first-offset="true"><span data-slate-string="true">.PHONY: gen.errcode.code</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12080"><span data-slate-object="text" data-key="12081"><span data-slate-leaf="true" data-offset-key="12081:0" data-first-offset="true"><span data-slate-string="true">gen.errcode.code: tools.verify.codegen</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12082"><span data-slate-object="text" data-key="12083"><span data-slate-leaf="true" data-offset-key="12083:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12084"><span data-slate-object="text" data-key="12085"><span data-slate-leaf="true" data-offset-key="12085:0" data-first-offset="true"><span data-slate-string="true">.PHONY: gen.errcode.doc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12086"><span data-slate-object="text" data-key="12087"><span data-slate-leaf="true" data-offset-key="12087:0" data-first-offset="true"><span data-slate-string="true">gen.errcode.doc: tools.verify.codegen</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12088"><span data-slate-object="text" data-key="12089"><span data-slate-leaf="true" data-offset-key="12089:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12090" id="sr-toc-12"><span data-slate-object="text" data-key="12091"><span data-slate-leaf="true" data-offset-key="12091:0" data-first-offset="true"><span data-slate-string="true">技巧 8：做好目标拆分</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12092"><span data-slate-object="text" data-key="12093"><span data-slate-leaf="true" data-offset-key="12093:0" data-first-offset="true"><span data-slate-string="true">还有一个比较实用的技巧：我们要合理地拆分目标。比如，我们可以将安装工具拆分成两个目标：验证工具是否已安装和安装工具。通过这种方式，可以给我们的 Makefile 带来更大的灵活性。例如：我们可以根据需要选择性地执行其中一个操作，也可以两个操作一起执行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12094"><span data-slate-object="text" data-key="12095"><span data-slate-leaf="true" data-offset-key="12095:0" data-first-offset="true"><span data-slate-string="true">这里来看一个例子：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="12096"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12097"><span data-slate-object="text" data-key="12098"><span data-slate-leaf="true" data-offset-key="12098:0" data-first-offset="true"><span data-slate-string="true">gen.</span></span></span><span data-slate-object="text" data-key="12099"><span data-slate-leaf="true" data-offset-key="12099:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">errcode</span></span></span></span><span data-slate-object="text" data-key="12100"><span data-slate-leaf="true" data-offset-key="12100:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12101"><span data-slate-leaf="true" data-offset-key="12101:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">code</span></span></span></span><span data-slate-object="text" data-key="12102"><span data-slate-leaf="true" data-offset-key="12102:0" data-first-offset="true"><span data-slate-string="true">: tools.</span></span></span><span data-slate-object="text" data-key="12103"><span data-slate-leaf="true" data-offset-key="12103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="12104"><span data-slate-leaf="true" data-offset-key="12104:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12105"><span data-slate-leaf="true" data-offset-key="12105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">codegen</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12106"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12107"><span data-slate-object="text" data-key="12108"><span data-slate-leaf="true" data-offset-key="12108:0" data-first-offset="true"><span data-slate-string="true">tools.</span></span></span><span data-slate-object="text" data-key="12109"><span data-slate-leaf="true" data-offset-key="12109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="12110"><span data-slate-leaf="true" data-offset-key="12110:0" data-first-offset="true"><span data-slate-string="true">.%:    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12111"><span data-slate-object="text" data-key="12112"><span data-slate-leaf="true" data-offset-key="12112:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12113"><span data-slate-leaf="true" data-offset-key="12113:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@if</span></span></span></span><span data-slate-object="text" data-key="12114"><span data-slate-leaf="true" data-offset-key="12114:0" data-first-offset="true"><span data-slate-string="true"> ! which $* &amp;&gt;</span></span></span><span data-slate-object="text" data-key="12115"><span data-slate-leaf="true" data-offset-key="12115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/dev/</span></span></span></span><span data-slate-object="text" data-key="12116"><span data-slate-leaf="true" data-offset-key="12116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="12117"><span data-slate-leaf="true" data-offset-key="12117:0" data-first-offset="true"><span data-slate-string="true">; then $(</span></span></span><span data-slate-object="text" data-key="12118"><span data-slate-leaf="true" data-offset-key="12118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span><span data-slate-object="text" data-key="12119"><span data-slate-leaf="true" data-offset-key="12119:0" data-first-offset="true"><span data-slate-string="true">) tools.</span></span></span><span data-slate-object="text" data-key="12120"><span data-slate-leaf="true" data-offset-key="12120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">install</span></span></span></span><span data-slate-object="text" data-key="12121"><span data-slate-leaf="true" data-offset-key="12121:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12122"><span data-slate-leaf="true" data-offset-key="12122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$</span></span></span></span><span data-slate-object="text" data-key="12123"><span data-slate-leaf="true" data-offset-key="12123:0" data-first-offset="true"><span data-slate-string="true">*; fi  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12124"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12125"><span data-slate-object="text" data-key="12126"><span data-slate-leaf="true" data-offset-key="12126:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12127"><span data-slate-leaf="true" data-offset-key="12127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PHONY</span></span></span></span><span data-slate-object="text" data-key="12128"><span data-slate-leaf="true" data-offset-key="12128:0" data-first-offset="true"><span data-slate-string="true">: install.</span></span></span><span data-slate-object="text" data-key="12129"><span data-slate-leaf="true" data-offset-key="12129:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">codegen</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12130"><span data-slate-object="text" data-key="12131"><span data-slate-leaf="true" data-offset-key="12131:0" data-first-offset="true"><span data-slate-string="true">install.</span></span></span><span data-slate-object="text" data-key="12132"><span data-slate-leaf="true" data-offset-key="12132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">codegen</span></span></span></span><span data-slate-object="text" data-key="12133"><span data-slate-leaf="true" data-offset-key="12133:0" data-first-offset="true"><span data-slate-string="true">:              </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12134"><span data-slate-object="text" data-key="12135"><span data-slate-leaf="true" data-offset-key="12135:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12136"><span data-slate-leaf="true" data-offset-key="12136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@$</span></span></span></span><span data-slate-object="text" data-key="12137"><span data-slate-leaf="true" data-offset-key="12137:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12138"><span data-slate-leaf="true" data-offset-key="12138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO</span></span></span></span><span data-slate-object="text" data-key="12139"><span data-slate-leaf="true" data-offset-key="12139:0" data-first-offset="true"><span data-slate-string="true">) install ${</span></span></span><span data-slate-object="text" data-key="12140"><span data-slate-leaf="true" data-offset-key="12140:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ROOT_DIR</span></span></span></span><span data-slate-object="text" data-key="12141"><span data-slate-leaf="true" data-offset-key="12141:0" data-first-offset="true"><span data-slate-string="true">}/tools/codegen/codegen.</span></span></span><span data-slate-object="text" data-key="12142"><span data-slate-leaf="true" data-offset-key="12142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12143"><span data-slate-object="text" data-key="12144"><span data-slate-leaf="true" data-offset-key="12144:0" data-first-offset="true"><span data-slate-string="true">上面的 Makefile 中，gen.errcode.code 依赖了 tools.verify.codegen，tools.verify.codegen 会先检查 codegen 命令是否存在，如果不存在，再调用 install.codegen 来安装 codegen 工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12145"><span data-slate-object="text" data-key="12146"><span data-slate-leaf="true" data-offset-key="12146:0" data-first-offset="true"><span data-slate-string="true">如果我们的 Makefile 设计是：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="12147"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12148"><span data-slate-object="text" data-key="12149"><span data-slate-leaf="true" data-offset-key="12149:0" data-first-offset="true"><span data-slate-string="true">gen.errcode.code: install.codegen</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12150"><span data-slate-object="text" data-key="12151"><span data-slate-leaf="true" data-offset-key="12151:0" data-first-offset="true"><span data-slate-string="true">那每次执行 gen.errcode.code 都要重新安装 codegen 命令，这种操作是不必要的，还会导致 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12152"><span data-slate-object="text" data-key="12153"><span data-slate-leaf="true" data-offset-key="12153:0" data-first-offset="true"><span data-slate-string="true">make gen.errcode.code</span></span></span></span><span data-slate-object="text" data-key="12154"><span data-slate-leaf="true" data-offset-key="12154:0" data-first-offset="true"><span data-slate-string="true"> 执行很慢。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12155" id="sr-toc-13"><span data-slate-object="text" data-key="12156"><span data-slate-leaf="true" data-offset-key="12156:0" data-first-offset="true"><span data-slate-string="true">技巧 9：设置 OPTIONS</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12157"><span data-slate-object="text" data-key="12158"><span data-slate-leaf="true" data-offset-key="12158:0" data-first-offset="true"><span data-slate-string="true">编写 Makefile 时，我们还需要把一些可变的功能通过 OPTIONS 来控制。为了帮助你理解，这里还是拿 IAM 项目的 Makefile 来举例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12159"><span data-slate-object="text" data-key="12160"><span data-slate-leaf="true" data-offset-key="12160:0" data-first-offset="true"><span data-slate-string="true">假设我们需要通过一个选项 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12161"><span data-slate-object="text" data-key="12162"><span data-slate-leaf="true" data-offset-key="12162:0" data-first-offset="true"><span data-slate-string="true">V</span></span></span></span><span data-slate-object="text" data-key="12163"><span data-slate-leaf="true" data-offset-key="12163:0" data-first-offset="true"><span data-slate-string="true"> ，来控制是否需要在执行 Makefile 时打印详细的信息。这可以通过下面的步骤来实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12164"><span data-slate-object="text" data-key="12165"><span data-slate-leaf="true" data-offset-key="12165:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">首先，</span></span></span></span><span data-slate-object="text" data-key="12166"><span data-slate-leaf="true" data-offset-key="12166:0" data-first-offset="true"><span data-slate-string="true">在 /Makefile 中定义 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12167"><span data-slate-object="text" data-key="12168"><span data-slate-leaf="true" data-offset-key="12168:0" data-first-offset="true"><span data-slate-string="true">USAGE_OPTIONS</span></span></span></span><span data-slate-object="text" data-key="12169"><span data-slate-leaf="true" data-offset-key="12169:0" data-first-offset="true"><span data-slate-string="true"> 。定义 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12170"><span data-slate-object="text" data-key="12171"><span data-slate-leaf="true" data-offset-key="12171:0" data-first-offset="true"><span data-slate-string="true">USAGE_OPTIONS</span></span></span></span><span data-slate-object="text" data-key="12172"><span data-slate-leaf="true" data-offset-key="12172:0" data-first-offset="true"><span data-slate-string="true"> 可以使开发者在执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12173"><span data-slate-object="text" data-key="12174"><span data-slate-leaf="true" data-offset-key="12174:0" data-first-offset="true"><span data-slate-string="true">make help</span></span></span></span><span data-slate-object="text" data-key="12175"><span data-slate-leaf="true" data-offset-key="12175:0" data-first-offset="true"><span data-slate-string="true"> 后感知到此 OPTION，并根据需要进行设置。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12176"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12177"><span data-slate-object="text" data-key="12178"><span data-slate-leaf="true" data-offset-key="12178:0" data-first-offset="true"><span data-slate-string="true">define USAGE_OPTIONS    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12179"><span data-slate-object="text" data-key="12180"><span data-slate-leaf="true" data-offset-key="12180:0" data-first-offset="true"><span data-slate-string="true">                         </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12181"><span data-slate-object="text" data-key="12182"><span data-slate-leaf="true" data-offset-key="12182:0" data-first-offset="true"><span data-slate-string="true">Options:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12183"><span data-slate-object="text" data-key="12184"><span data-slate-leaf="true" data-offset-key="12184:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12185"><span data-slate-object="text" data-key="12186"><span data-slate-leaf="true" data-offset-key="12186:0" data-first-offset="true"><span data-slate-string="true">  BINS         The binaries to build. Default </span></span></span><span data-slate-object="text" data-key="12187"><span data-slate-leaf="true" data-offset-key="12187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">is</span></span></span></span><span data-slate-object="text" data-key="12188"><span data-slate-leaf="true" data-offset-key="12188:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12189"><span data-slate-leaf="true" data-offset-key="12189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">all</span></span></span></span><span data-slate-object="text" data-key="12190"><span data-slate-leaf="true" data-offset-key="12190:0" data-first-offset="true"><span data-slate-string="true"> of cmd.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12191"><span data-slate-object="text" data-key="12192"><span data-slate-leaf="true" data-offset-key="12192:0" data-first-offset="true"><span data-slate-string="true">               ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12193"><span data-slate-object="text" data-key="12194"><span data-slate-leaf="true" data-offset-key="12194:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12195"><span data-slate-object="text" data-key="12196"><span data-slate-leaf="true" data-offset-key="12196:0" data-first-offset="true"><span data-slate-string="true">  V            </span></span></span><span data-slate-object="text" data-key="12197"><span data-slate-leaf="true" data-offset-key="12197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Set</span></span></span></span><span data-slate-object="text" data-key="12198"><span data-slate-leaf="true" data-offset-key="12198:0" data-first-offset="true"><span data-slate-string="true"> to </span></span></span><span data-slate-object="text" data-key="12199"><span data-slate-leaf="true" data-offset-key="12199:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12200"><span data-slate-leaf="true" data-offset-key="12200:0" data-first-offset="true"><span data-slate-string="true"> enable verbose build. Default </span></span></span><span data-slate-object="text" data-key="12201"><span data-slate-leaf="true" data-offset-key="12201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">is</span></span></span></span><span data-slate-object="text" data-key="12202"><span data-slate-leaf="true" data-offset-key="12202:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12203"><span data-slate-leaf="true" data-offset-key="12203:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.</span></span></span></span><span data-slate-object="text" data-key="12204"><span data-slate-leaf="true" data-offset-key="12204:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12205"><span data-slate-object="text" data-key="12206"><span data-slate-leaf="true" data-offset-key="12206:0" data-first-offset="true"><span data-slate-string="true">en</span></span></span><span data-slate-object="text" data-key="12207"><span data-slate-leaf="true" data-offset-key="12207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12208"><span data-slate-leaf="true" data-offset-key="12208:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12209"><span data-slate-object="text" data-key="12210"><span data-slate-leaf="true" data-offset-key="12210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">export</span></span></span></span><span data-slate-object="text" data-key="12211"><span data-slate-leaf="true" data-offset-key="12211:0" data-first-offset="true"><span data-slate-string="true"> USAGE_OPTIONS    </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12212"><span data-slate-object="text" data-key="12213"><span data-slate-leaf="true" data-offset-key="12213:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">接着，</span></span></span></span><span data-slate-object="text" data-key="12214"><span data-slate-leaf="true" data-offset-key="12214:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12215"><span data-slate-object="text" data-key="12216"><span data-slate-leaf="true" data-offset-key="12216:0" data-first-offset="true"><span data-slate-string="true">scripts/make-rules/common.mk</span></span></span></a><span data-slate-object="text" data-key="12217"><span data-slate-leaf="true" data-offset-key="12217:0" data-first-offset="true"><span data-slate-string="true"> 文件中，我们通过判断有没有设置 V 选项，来选择不同的行为：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12218"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12219"><span data-slate-object="text" data-key="12220"><span data-slate-leaf="true" data-offset-key="12220:0" data-first-offset="true"><span data-slate-string="true">ifn</span></span></span><span data-slate-object="text" data-key="12221"><span data-slate-leaf="true" data-offset-key="12221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12222"><span data-slate-leaf="true" data-offset-key="12222:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12223"><span data-slate-leaf="true" data-offset-key="12223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">V</span></span></span></span><span data-slate-object="text" data-key="12224"><span data-slate-leaf="true" data-offset-key="12224:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12225"><span data-slate-object="text" data-key="12226"><span data-slate-leaf="true" data-offset-key="12226:0" data-first-offset="true"><span data-slate-string="true">MAKEFLAGS += --no-</span></span></span><span data-slate-object="text" data-key="12227"><span data-slate-leaf="true" data-offset-key="12227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12228"><span data-slate-leaf="true" data-offset-key="12228:0" data-first-offset="true"><span data-slate-string="true">-directory    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12229"><span data-slate-object="text" data-key="12230"><span data-slate-leaf="true" data-offset-key="12230:0" data-first-offset="true"><span data-slate-string="true">endif</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12231"><span data-slate-object="text" data-key="12232"><span data-slate-leaf="true" data-offset-key="12232:0" data-first-offset="true"><span data-slate-string="true">当然，我们还可以通过下面的方法来使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12233"><span data-slate-object="text" data-key="12234"><span data-slate-leaf="true" data-offset-key="12234:0" data-first-offset="true"><span data-slate-string="true">V</span></span></span></span><span data-slate-object="text" data-key="12235"><span data-slate-leaf="true" data-offset-key="12235:0" data-first-offset="true"><span data-slate-string="true"> ：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="12236"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12237"><span data-slate-object="text" data-key="12238"><span data-slate-leaf="true" data-offset-key="12238:0" data-first-offset="true"><span data-slate-string="true">ifeq ($(origin V), </span></span></span><span data-slate-object="text" data-key="12239"><span data-slate-leaf="true" data-offset-key="12239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">undefined</span></span></span></span><span data-slate-object="text" data-key="12240"><span data-slate-leaf="true" data-offset-key="12240:0" data-first-offset="true"><span data-slate-string="true">)                                </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12241"><span data-slate-object="text" data-key="12242"><span data-slate-leaf="true" data-offset-key="12242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKEFLAGS</span></span></span></span><span data-slate-object="text" data-key="12243"><span data-slate-leaf="true" data-offset-key="12243:0" data-first-offset="true"><span data-slate-string="true"> += --no-print-directory              </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12244"><span data-slate-object="text" data-key="12245"><span data-slate-leaf="true" data-offset-key="12245:0" data-first-offset="true"><span data-slate-string="true">endif</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12246"><span data-slate-object="text" data-key="12247"><span data-slate-leaf="true" data-offset-key="12247:0" data-first-offset="true"><span data-slate-string="true">上面，我介绍了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12248"><span data-slate-object="text" data-key="12249"><span data-slate-leaf="true" data-offset-key="12249:0" data-first-offset="true"><span data-slate-string="true">V</span></span></span></span><span data-slate-object="text" data-key="12250"><span data-slate-leaf="true" data-offset-key="12250:0" data-first-offset="true"><span data-slate-string="true"> OPTION，我们在 Makefile 中通过判断有没有定义 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12251"><span data-slate-object="text" data-key="12252"><span data-slate-leaf="true" data-offset-key="12252:0" data-first-offset="true"><span data-slate-string="true">V</span></span></span></span><span data-slate-object="text" data-key="12253"><span data-slate-leaf="true" data-offset-key="12253:0" data-first-offset="true"><span data-slate-string="true"> ，来执行不同的操作。其实还有一种 OPTION，这种 OPTION 的值我们在 Makefile 中是直接使用的，例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12254"><span data-slate-object="text" data-key="12255"><span data-slate-leaf="true" data-offset-key="12255:0" data-first-offset="true"><span data-slate-string="true"> BINS</span></span></span></span><span data-slate-object="text" data-key="12256"><span data-slate-leaf="true" data-offset-key="12256:0" data-first-offset="true"><span data-slate-string="true">。针对这种 OPTION，我们可以通过以下方式来使用：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="12257"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12258"><span data-slate-object="text" data-key="12259"><span data-slate-leaf="true" data-offset-key="12259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BINS</span></span></span></span><span data-slate-object="text" data-key="12260"><span data-slate-leaf="true" data-offset-key="12260:0" data-first-offset="true"><span data-slate-string="true"> ?= $(foreach cmd,${</span></span></span><span data-slate-object="text" data-key="12261"><span data-slate-leaf="true" data-offset-key="12261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">COMMANDS</span></span></span></span><span data-slate-object="text" data-key="12262"><span data-slate-leaf="true" data-offset-key="12262:0" data-first-offset="true"><span data-slate-string="true">},$(notdir ${cmd}))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12263"><span data-slate-object="text" data-key="12264"><span data-slate-leaf="true" data-offset-key="12264:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12265"><span data-slate-object="text" data-key="12266"><span data-slate-leaf="true" data-offset-key="12266:0" data-first-offset="true"><span data-slate-string="true">go.</span></span></span><span data-slate-object="text" data-key="12267"><span data-slate-leaf="true" data-offset-key="12267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">build</span></span></span></span><span data-slate-object="text" data-key="12268"><span data-slate-leaf="true" data-offset-key="12268:0" data-first-offset="true"><span data-slate-string="true">: go.</span></span></span><span data-slate-object="text" data-key="12269"><span data-slate-leaf="true" data-offset-key="12269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">build</span></span></span></span><span data-slate-object="text" data-key="12270"><span data-slate-leaf="true" data-offset-key="12270:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12271"><span data-slate-leaf="true" data-offset-key="12271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="12272"><span data-slate-leaf="true" data-offset-key="12272:0" data-first-offset="true"><span data-slate-string="true"> $(addprefix go.</span></span></span><span data-slate-object="text" data-key="12273"><span data-slate-leaf="true" data-offset-key="12273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">build</span></span></span></span><span data-slate-object="text" data-key="12274"><span data-slate-leaf="true" data-offset-key="12274:0" data-first-offset="true"><span data-slate-string="true">., $(addprefix $(</span></span></span><span data-slate-object="text" data-key="12275"><span data-slate-leaf="true" data-offset-key="12275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PLATFORM</span></span></span></span><span data-slate-object="text" data-key="12276"><span data-slate-leaf="true" data-offset-key="12276:0" data-first-offset="true"><span data-slate-string="true">)., $(</span></span></span><span data-slate-object="text" data-key="12277"><span data-slate-leaf="true" data-offset-key="12277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BINS</span></span></span></span><span data-slate-object="text" data-key="12278"><span data-slate-leaf="true" data-offset-key="12278:0" data-first-offset="true"><span data-slate-string="true">)))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12279"><span data-slate-object="text" data-key="12280"><span data-slate-leaf="true" data-offset-key="12280:0" data-first-offset="true"><span data-slate-string="true">也就是说，通过 </span></span></span><span data-slate-object="text" data-key="12281"><span data-slate-leaf="true" data-offset-key="12281:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">?=</span></span></span></span><span data-slate-object="text" data-key="12282"><span data-slate-leaf="true" data-offset-key="12282:0" data-first-offset="true"><span data-slate-string="true"> 来判断 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12283"><span data-slate-object="text" data-key="12284"><span data-slate-leaf="true" data-offset-key="12284:0" data-first-offset="true"><span data-slate-string="true">BINS</span></span></span></span><span data-slate-object="text" data-key="12285"><span data-slate-leaf="true" data-offset-key="12285:0" data-first-offset="true"><span data-slate-string="true"> 变量有没有被赋值，如果没有，则赋予等号后的值。接下来，就可以在 Makefile 规则中使用它。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12286" id="sr-toc-14"><span data-slate-object="text" data-key="12287"><span data-slate-leaf="true" data-offset-key="12287:0" data-first-offset="true"><span data-slate-string="true">技巧 10：定义环境变量</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12288"><span data-slate-object="text" data-key="12289"><span data-slate-leaf="true" data-offset-key="12289:0" data-first-offset="true"><span data-slate-string="true">我们可以在 Makefile 中定义一些环境变量，例如：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="12290"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12291"><span data-slate-object="text" data-key="12292"><span data-slate-leaf="true" data-offset-key="12292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO</span></span></span></span><span data-slate-object="text" data-key="12293"><span data-slate-leaf="true" data-offset-key="12293:0" data-first-offset="true"><span data-slate-string="true"> := go                                          </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12294"><span data-slate-object="text" data-key="12295"><span data-slate-leaf="true" data-offset-key="12295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO_SUPPORTED_VERSIONS</span></span></span></span><span data-slate-object="text" data-key="12296"><span data-slate-leaf="true" data-offset-key="12296:0" data-first-offset="true"><span data-slate-string="true"> ?= </span></span></span><span data-slate-object="text" data-key="12297"><span data-slate-leaf="true" data-offset-key="12297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1.13</span></span></span></span><span data-slate-object="text" data-key="12298"><span data-slate-leaf="true" data-offset-key="12298:0" data-first-offset="true"><span data-slate-string="true">|</span></span></span><span data-slate-object="text" data-key="12299"><span data-slate-leaf="true" data-offset-key="12299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1.14</span></span></span></span><span data-slate-object="text" data-key="12300"><span data-slate-leaf="true" data-offset-key="12300:0" data-first-offset="true"><span data-slate-string="true">|</span></span></span><span data-slate-object="text" data-key="12301"><span data-slate-leaf="true" data-offset-key="12301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1.15</span></span></span></span><span data-slate-object="text" data-key="12302"><span data-slate-leaf="true" data-offset-key="12302:0" data-first-offset="true"><span data-slate-string="true">|</span></span></span><span data-slate-object="text" data-key="12303"><span data-slate-leaf="true" data-offset-key="12303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1.16</span></span></span></span><span data-slate-object="text" data-key="12304"><span data-slate-leaf="true" data-offset-key="12304:0" data-first-offset="true"><span data-slate-string="true">|</span></span></span><span data-slate-object="text" data-key="12305"><span data-slate-leaf="true" data-offset-key="12305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1.17</span></span></span></span><span data-slate-object="text" data-key="12306"><span data-slate-leaf="true" data-offset-key="12306:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12307"><span data-slate-object="text" data-key="12308"><span data-slate-leaf="true" data-offset-key="12308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO_LDFLAGS</span></span></span></span><span data-slate-object="text" data-key="12309"><span data-slate-leaf="true" data-offset-key="12309:0" data-first-offset="true"><span data-slate-string="true"> += -X $(</span></span></span><span data-slate-object="text" data-key="12310"><span data-slate-leaf="true" data-offset-key="12310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">VERSION_PACKAGE</span></span></span></span><span data-slate-object="text" data-key="12311"><span data-slate-leaf="true" data-offset-key="12311:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="12312"><span data-slate-leaf="true" data-offset-key="12312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GitVersion</span></span></span></span><span data-slate-object="text" data-key="12313"><span data-slate-leaf="true" data-offset-key="12313:0" data-first-offset="true"><span data-slate-string="true">=$(</span></span></span><span data-slate-object="text" data-key="12314"><span data-slate-leaf="true" data-offset-key="12314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">VERSION</span></span></span></span><span data-slate-object="text" data-key="12315"><span data-slate-leaf="true" data-offset-key="12315:0" data-first-offset="true"><span data-slate-string="true">) \    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12316"><span data-slate-object="text" data-key="12317"><span data-slate-leaf="true" data-offset-key="12317:0" data-first-offset="true"><span data-slate-string="true">  -X $(</span></span></span><span data-slate-object="text" data-key="12318"><span data-slate-leaf="true" data-offset-key="12318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">VERSION_PACKAGE</span></span></span></span><span data-slate-object="text" data-key="12319"><span data-slate-leaf="true" data-offset-key="12319:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="12320"><span data-slate-leaf="true" data-offset-key="12320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GitCommit</span></span></span></span><span data-slate-object="text" data-key="12321"><span data-slate-leaf="true" data-offset-key="12321:0" data-first-offset="true"><span data-slate-string="true">=$(</span></span></span><span data-slate-object="text" data-key="12322"><span data-slate-leaf="true" data-offset-key="12322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GIT_COMMIT</span></span></span></span><span data-slate-object="text" data-key="12323"><span data-slate-leaf="true" data-offset-key="12323:0" data-first-offset="true"><span data-slate-string="true">) \       </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12324"><span data-slate-object="text" data-key="12325"><span data-slate-leaf="true" data-offset-key="12325:0" data-first-offset="true"><span data-slate-string="true">  -X $(</span></span></span><span data-slate-object="text" data-key="12326"><span data-slate-leaf="true" data-offset-key="12326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">VERSION_PACKAGE</span></span></span></span><span data-slate-object="text" data-key="12327"><span data-slate-leaf="true" data-offset-key="12327:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="12328"><span data-slate-leaf="true" data-offset-key="12328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GitTreeState</span></span></span></span><span data-slate-object="text" data-key="12329"><span data-slate-leaf="true" data-offset-key="12329:0" data-first-offset="true"><span data-slate-string="true">=$(</span></span></span><span data-slate-object="text" data-key="12330"><span data-slate-leaf="true" data-offset-key="12330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GIT_TREE_STATE</span></span></span></span><span data-slate-object="text" data-key="12331"><span data-slate-leaf="true" data-offset-key="12331:0" data-first-offset="true"><span data-slate-string="true">) \                          </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12332"><span data-slate-object="text" data-key="12333"><span data-slate-leaf="true" data-offset-key="12333:0" data-first-offset="true"><span data-slate-string="true">  -X $(</span></span></span><span data-slate-object="text" data-key="12334"><span data-slate-leaf="true" data-offset-key="12334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">VERSION_PACKAGE</span></span></span></span><span data-slate-object="text" data-key="12335"><span data-slate-leaf="true" data-offset-key="12335:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="12336"><span data-slate-leaf="true" data-offset-key="12336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BuildDate</span></span></span></span><span data-slate-object="text" data-key="12337"><span data-slate-leaf="true" data-offset-key="12337:0" data-first-offset="true"><span data-slate-string="true">=$(shell date -u +</span></span></span><span data-slate-object="text" data-key="12338"><span data-slate-leaf="true" data-offset-key="12338:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'%Y-%m-%dT%H:%M:%SZ'</span></span></span></span><span data-slate-object="text" data-key="12339"><span data-slate-leaf="true" data-offset-key="12339:0" data-first-offset="true"><span data-slate-string="true">)    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12340"><span data-slate-object="text" data-key="12341"><span data-slate-leaf="true" data-offset-key="12341:0" data-first-offset="true"><span data-slate-string="true">ifneq ($(</span></span></span><span data-slate-object="text" data-key="12342"><span data-slate-leaf="true" data-offset-key="12342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">DLV</span></span></span></span><span data-slate-object="text" data-key="12343"><span data-slate-leaf="true" data-offset-key="12343:0" data-first-offset="true"><span data-slate-string="true">),)                                                                                                                              </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12344"><span data-slate-object="text" data-key="12345"><span data-slate-leaf="true" data-offset-key="12345:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12346"><span data-slate-leaf="true" data-offset-key="12346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO_BUILD_FLAGS</span></span></span></span><span data-slate-object="text" data-key="12347"><span data-slate-leaf="true" data-offset-key="12347:0" data-first-offset="true"><span data-slate-string="true"> += -gcflags </span></span></span><span data-slate-object="text" data-key="12348"><span data-slate-leaf="true" data-offset-key="12348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"all=-N -l"</span></span></span></span><span data-slate-object="text" data-key="12349"><span data-slate-leaf="true" data-offset-key="12349:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12350"><span data-slate-object="text" data-key="12351"><span data-slate-leaf="true" data-offset-key="12351:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12352"><span data-slate-leaf="true" data-offset-key="12352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LDFLAGS</span></span></span></span><span data-slate-object="text" data-key="12353"><span data-slate-leaf="true" data-offset-key="12353:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="12354"><span data-slate-leaf="true" data-offset-key="12354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="12355"><span data-slate-leaf="true" data-offset-key="12355:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12356"><span data-slate-object="text" data-key="12357"><span data-slate-leaf="true" data-offset-key="12357:0" data-first-offset="true"><span data-slate-string="true">endif                                                                                   </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12358"><span data-slate-object="text" data-key="12359"><span data-slate-leaf="true" data-offset-key="12359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GO_BUILD_FLAGS</span></span></span></span><span data-slate-object="text" data-key="12360"><span data-slate-leaf="true" data-offset-key="12360:0" data-first-offset="true"><span data-slate-string="true"> += -tags=jsoniter -ldflags </span></span></span><span data-slate-object="text" data-key="12361"><span data-slate-leaf="true" data-offset-key="12361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"$(GO_LDFLAGS)"</span></span></span></span><span data-slate-object="text" data-key="12362"><span data-slate-leaf="true" data-offset-key="12362:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12363"><span data-slate-object="text" data-key="12364"><span data-slate-leaf="true" data-offset-key="12364:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12365"><span data-slate-object="text" data-key="12366"><span data-slate-leaf="true" data-offset-key="12366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FIND</span></span></span></span><span data-slate-object="text" data-key="12367"><span data-slate-leaf="true" data-offset-key="12367:0" data-first-offset="true"><span data-slate-string="true"> := find . ! -path </span></span></span><span data-slate-object="text" data-key="12368"><span data-slate-leaf="true" data-offset-key="12368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./third_party/*'</span></span></span></span><span data-slate-object="text" data-key="12369"><span data-slate-leaf="true" data-offset-key="12369:0" data-first-offset="true"><span data-slate-string="true"> ! -path </span></span></span><span data-slate-object="text" data-key="12370"><span data-slate-leaf="true" data-offset-key="12370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./vendor/*'</span></span></span></span><span data-slate-object="text" data-key="12371"><span data-slate-leaf="true" data-offset-key="12371:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12372"><span data-slate-object="text" data-key="12373"><span data-slate-leaf="true" data-offset-key="12373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XARGS</span></span></span></span><span data-slate-object="text" data-key="12374"><span data-slate-leaf="true" data-offset-key="12374:0" data-first-offset="true"><span data-slate-string="true"> := xargs --no-run-</span></span></span><span data-slate-object="text" data-key="12375"><span data-slate-leaf="true" data-offset-key="12375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12376"><span data-slate-leaf="true" data-offset-key="12376:0" data-first-offset="true"><span data-slate-string="true">-empty </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12377"><span data-slate-object="text" data-key="12378"><span data-slate-leaf="true" data-offset-key="12378:0" data-first-offset="true"><span data-slate-string="true">这些环境变量和编程中使用宏定义的作用是一样的：只要修改一处，就可以使很多地方同时生效，避免了重复的工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12379"><span data-slate-object="text" data-key="12380"><span data-slate-leaf="true" data-offset-key="12380:0" data-first-offset="true"><span data-slate-string="true">通常，我们可以将 GO、GO_BUILD_FLAGS、FIND 这类变量定义为环境变量。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12381" id="sr-toc-15"><span data-slate-object="text" data-key="12382"><span data-slate-leaf="true" data-offset-key="12382:0" data-first-offset="true"><span data-slate-string="true">技巧 11：自己调用自己</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12383"><span data-slate-object="text" data-key="12384"><span data-slate-leaf="true" data-offset-key="12384:0" data-first-offset="true"><span data-slate-string="true">在编写 Makefile 的过程中，你可能会遇到这样一种情况：A-Target 目标命令中，需要完成操作 B-Action，而操作 B-Action 我们已经通过伪目标 B-Target 实现过。为了达到最大的代码复用度，这时候最好的方式是在 A-Target 的命令中执行 B-Target。方法如下：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="12385"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12386"><span data-slate-object="text" data-key="12387"><span data-slate-leaf="true" data-offset-key="12387:0" data-first-offset="true"><span data-slate-string="true">tools.</span></span></span><span data-slate-object="text" data-key="12388"><span data-slate-leaf="true" data-offset-key="12388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">verify</span></span></span></span><span data-slate-object="text" data-key="12389"><span data-slate-leaf="true" data-offset-key="12389:0" data-first-offset="true"><span data-slate-string="true">.%:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12390"><span data-slate-object="text" data-key="12391"><span data-slate-leaf="true" data-offset-key="12391:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="12392"><span data-slate-leaf="true" data-offset-key="12392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@if</span></span></span></span><span data-slate-object="text" data-key="12393"><span data-slate-leaf="true" data-offset-key="12393:0" data-first-offset="true"><span data-slate-string="true"> ! which $* &amp;&gt;</span></span></span><span data-slate-object="text" data-key="12394"><span data-slate-leaf="true" data-offset-key="12394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/dev/</span></span></span></span><span data-slate-object="text" data-key="12395"><span data-slate-leaf="true" data-offset-key="12395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="12396"><span data-slate-leaf="true" data-offset-key="12396:0" data-first-offset="true"><span data-slate-string="true">; then $(</span></span></span><span data-slate-object="text" data-key="12397"><span data-slate-leaf="true" data-offset-key="12397:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MAKE</span></span></span></span><span data-slate-object="text" data-key="12398"><span data-slate-leaf="true" data-offset-key="12398:0" data-first-offset="true"><span data-slate-string="true">) tools.</span></span></span><span data-slate-object="text" data-key="12399"><span data-slate-leaf="true" data-offset-key="12399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">install</span></span></span></span><span data-slate-object="text" data-key="12400"><span data-slate-leaf="true" data-offset-key="12400:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12401"><span data-slate-leaf="true" data-offset-key="12401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$</span></span></span></span><span data-slate-object="text" data-key="12402"><span data-slate-leaf="true" data-offset-key="12402:0" data-first-offset="true"><span data-slate-string="true">*; fi</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12403"><span data-slate-object="text" data-key="12404"><span data-slate-leaf="true" data-offset-key="12404:0" data-first-offset="true"><span data-slate-string="true">这里，我们通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12405"><span data-slate-object="text" data-key="12406"><span data-slate-leaf="true" data-offset-key="12406:0" data-first-offset="true"><span data-slate-string="true">$(MAKE)</span></span></span></span><span data-slate-object="text" data-key="12407"><span data-slate-leaf="true" data-offset-key="12407:0" data-first-offset="true"><span data-slate-string="true"> 调用了伪目标 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12408"><span data-slate-object="text" data-key="12409"><span data-slate-leaf="true" data-offset-key="12409:0" data-first-offset="true"><span data-slate-string="true">tools.install.$*</span></span></span></span><span data-slate-object="text" data-key="12410"><span data-slate-leaf="true" data-offset-key="12410:0" data-first-offset="true"><span data-slate-string="true"> 。要注意的是，默认情况下，Makefile 在切换目录时会输出以下信息：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="12411"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12412"><span data-slate-object="text" data-key="12413"><span data-slate-leaf="true" data-offset-key="12413:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12414"><span data-slate-leaf="true" data-offset-key="12414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="12415"><span data-slate-leaf="true" data-offset-key="12415:0" data-first-offset="true"><span data-slate-string="true"> tools.install.codegen</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12416"><span data-slate-object="text" data-key="12417"><span data-slate-leaf="true" data-offset-key="12417:0" data-first-offset="true"><span data-slate-string="true">===========&gt; Installing codegen</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12418"><span data-slate-object="text" data-key="12419"><span data-slate-leaf="true" data-offset-key="12419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="12420"><span data-slate-leaf="true" data-offset-key="12420:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="12421"><span data-slate-leaf="true" data-offset-key="12421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12422"><span data-slate-leaf="true" data-offset-key="12422:0" data-first-offset="true"><span data-slate-string="true">]: Entering directory </span></span></span><span data-slate-object="text" data-key="12423"><span data-slate-leaf="true" data-offset-key="12423:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`/home/colin/workspace/golang/src/github.com/marmotedu/iam'</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12424"><span data-slate-object="text" data-key="12425"><span data-slate-leaf="true" data-offset-key="12425:0" data-first-offset="true"><span data-slate-string="true">make[1]: Leaving directory `/home/colin/workspace/golang/src/github.com/marmotedu/iam</span></span></span><span data-slate-object="text" data-key="12426"><span data-slate-leaf="true" data-offset-key="12426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12427"><span data-slate-object="text" data-key="12428"><span data-slate-leaf="true" data-offset-key="12428:0" data-first-offset="true"><span data-slate-string="true">如果觉得 </span></span></span><span data-slate-object="text" data-key="12429"><span data-slate-leaf="true" data-offset-key="12429:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Entering directory</span></span></span></span><span data-slate-object="text" data-key="12430"><span data-slate-leaf="true" data-offset-key="12430:0" data-first-offset="true"><span data-slate-string="true"> 这类信息很烦人，可以通过设置 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12431"><span data-slate-object="text" data-key="12432"><span data-slate-leaf="true" data-offset-key="12432:0" data-first-offset="true"><span data-slate-string="true">MAKEFLAGS += --no-print-directory</span></span></span></span><span data-slate-object="text" data-key="12433"><span data-slate-leaf="true" data-offset-key="12433:0" data-first-offset="true"><span data-slate-string="true"> 来禁止 Makefile 打印这些信息。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12434" id="sr-toc-16"><span data-slate-object="text" data-key="12435"><span data-slate-leaf="true" data-offset-key="12435:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12436"><span data-slate-object="text" data-key="12437"><span data-slate-leaf="true" data-offset-key="12437:0" data-first-offset="true"><span data-slate-string="true">如果你想要高效管理项目，使用 Makefile 来管理是目前的最佳实践。我们可以通过下面的几个方法，来编写一个高质量的 Makefile。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12438"><span data-slate-object="text" data-key="12439"><span data-slate-leaf="true" data-offset-key="12439:0" data-first-offset="true"><span data-slate-string="true">首先，你需要熟练掌握 Makefile 的语法。我建议你重点掌握以下语法：Makefile 规则语法、伪目标、变量赋值、特殊变量、自动化变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12440"><span data-slate-object="text" data-key="12441"><span data-slate-leaf="true" data-offset-key="12441:0" data-first-offset="true"><span data-slate-string="true">接着，我们需要提前规划 Makefile 要实现的功能。一个大型 Go 项目通常需要实现以下功能：代码生成类命令、格式化类命令、静态代码检查、 测试类命令、构建类命令、Docker 镜像打包类命令、部署类命令、清理类命令，等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12442"><span data-slate-object="text" data-key="12443"><span data-slate-leaf="true" data-offset-key="12443:0" data-first-offset="true"><span data-slate-string="true">然后，我们还需要通过 Makefile 功能分类、文件分层、复杂命令脚本化等方式，来设计一个合理的 Makefile 结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12444"><span data-slate-object="text" data-key="12445"><span data-slate-leaf="true" data-offset-key="12445:0" data-first-offset="true"><span data-slate-string="true">最后，我们还需要掌握一些 Makefile 编写技巧，例如：善用通配符、自动变量和函数；编写可扩展的 Makefile；使用带层级的命名方式，等等。通过这些技巧，可以进一步保证我们编写出一个高质量的 Makefile。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12446" id="sr-toc-17"><span data-slate-object="text" data-key="12447"><span data-slate-leaf="true" data-offset-key="12447:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="12448"><div data-slate-type="list-line" data-slate-object="block" data-key="12449"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12450"><span data-slate-leaf="true" data-offset-key="12450:0" data-first-offset="true"><span data-slate-string="true">走读 IAM 项目的 Makefile 实现，看下 IAM 项目是如何通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12451"><span data-slate-object="text" data-key="12452"><span data-slate-leaf="true" data-offset-key="12452:0" data-first-offset="true"><span data-slate-string="true">make tools.install</span></span></span></span><span data-slate-object="text" data-key="12453"><span data-slate-leaf="true" data-offset-key="12453:0" data-first-offset="true"><span data-slate-string="true"> 一键安装所有功能，通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12454"><span data-slate-object="text" data-key="12455"><span data-slate-leaf="true" data-offset-key="12455:0" data-first-offset="true"><span data-slate-string="true">make tools.install.xxx</span></span></span></span><span data-slate-object="text" data-key="12456"><span data-slate-leaf="true" data-offset-key="12456:0" data-first-offset="true"><span data-slate-string="true"> 来指定安装 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12457"><span data-slate-object="text" data-key="12458"><span data-slate-leaf="true" data-offset-key="12458:0" data-first-offset="true"><span data-slate-string="true">xxx</span></span></span></span><span data-slate-object="text" data-key="12459"><span data-slate-leaf="true" data-offset-key="12459:0" data-first-offset="true"><span data-slate-string="true"> 工具的。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12460"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12461"><span data-slate-leaf="true" data-offset-key="12461:0" data-first-offset="true"><span data-slate-string="true">你编写 Makefile 的时候，还用到过哪些编写技巧呢？欢迎和我分享你的经验，或者你踩过的坑。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12462"><span data-slate-object="text" data-key="12463"><span data-slate-leaf="true" data-offset-key="12463:0" data-first-offset="true"><span data-slate-string="true">期待在留言区看到你的思考和答案，也欢迎和我一起探讨关于 Makefile 的问题，我们下一讲见！</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>16</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-18">精选留言 (17)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>helloworld</span></div></div><div>格式化代码、静态代码检查，这种 ide 或 vim 都会配置保存时格式化和代码检查，还有必要写在 makefile 中吗</div><div><p>作者回复: ide/vim 不会进行静态代码检查。

ide/vim 的格式化是可配的。而且 ide/vim 的格式化更多的是用了 gofmt -w 这种格式化。

这里将格式化代码放在 Makefile 有个选择：
1. 更丰富，可配置的格式化代码功能，比如：支持 golines、goimport、gofmt 后面还可以根据需要增加更多
2. 确保每一个开发者用的都是同一种格式化方法（ide/vim 的格式化不一定每一个开发者都会陪，更不一定配置的格式化选项是一致的）

将格式化放在 Makefile 中，可以确保某个动作一定会被执行，并且执行的效果是一致的。
</p></div><div><div>2021-06-26</div><div><div><i></i><span>4</span></div><div><i></i><span>15</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/ed/0a/18201290.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Juniper</span></div></div><div>这部分以前没接触过，先战略性放弃，后面再回来好好啃</div><div><div>2021-09-29</div><div><div><i></i><span>1</span></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Vackine</span></div></div><div>写好一个功能齐全的项目的 makefile，然后只对 makefile 的各个功能做编排，是不是就可以做到基本的持续发布了？</div><div><p>作者回复：持续发布需要 CI/CD 系统的支持。

写好 Makefile 只能说方便 CI 系统直接调用。离 CI/C 差的还远</p></div><div><div>2021-06-26</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：Makefile 是高效项目管理的重要工具，编写高质量的 Makefile，方便你做 CI 的检查，不至于自己的代码提交上以后，被提示各种不通过（静态代码检查、格式错误、单元测试等）。

要做好 Makefile 的管理，可按照下面的步骤：1. 学习 Makefile 语法；2. 规划 Makefile 要实现的功能；3. 规划 Makefile 结构；4. 善用 Makefile 技巧。

直接拷贝 IAM 项目的 Makefile，也很香。</div><div><p>作者回复：直接 copy 可能更香</p></div><div><div>2021-11-26</div><div><div><i></i><span>2</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 左耳朵东</span></div></div><div>.PHONY: format
format: tools.verify.golines
.PHONY: tools.verify.%
tools.verify.%:
	@if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi
这里的 $* 是指 ‘golines’ 还是 ‘tools.verify.golines’ 呢？</div><div><div>2022-08-23</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Calvin</span></div></div><div>对 Windows 系统不友好，实际 CRUD 业务中，更多人是在 Windows 下开发吧（IDE 选 VSCode 或 GoLand）。</div><div><p>作者回复：还有些在 Mac 上开发。

这个教程没必要在 Mac、Windows 平台下都适配一份。
之所以选择 Linux 是因为以下原因：

1. 因为 Windows、Mac、Linux 都有开发者，但该教程只能选择一个平台，所以选择了 Linux
2. 将来部署服务是在 Linux 上部署的，在学习时，在 Linux 上完成开发部署，也是学习 Linux 的一个途径，为将来工作中， 在 Linux 下操作打下基础</p></div><div><div>2022-04-18</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/e6/74/8b8097c1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>牛 2 特工</span></div></div><div>go 为什么不设计专用的构建工具 
把常见通用的任务都集成了</div><div><p>作者回复：编译工具，不太适合集成太多这类功能。

而且这类功能具体实现也跟项目有关系，不好标准化处理</p></div><div><div>2022-03-15</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1f/cf/63/23db516f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>CSB22</span></div></div><div>您有没有比较好的 makefile editor 推荐么？</div><div><p>作者回复：暂时没有，直接用编辑器编辑其实也没啥问题</p></div><div><div>2022-03-02</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2c/66/04/1919d4b4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>夏心 C.J</span></div></div><div>$* 是指示目标模式中 % 及其之前的部分，不是指代被匹配的值 swagger、mockgen 吧？</div><div><p>作者回复：不会的</p></div><div><div>2022-02-11</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1b/8e/62/5cb377fd.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>yangchnet</span></div></div><div>第二遍了，越读越觉得总结的到位精辟。</div><div><div>2022-02-09</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>党</span></div></div><div>win 上没有 make 命令 老师你的开发环境是 linux 或者 mac 么 win 上怎么搞 make</div><div><p>作者回复: win 上没试过，你可以调研下怎么搞。这个课程全都是在 Linux 上搞的</p></div><div><div>2022-01-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1e/f5/0b/73628618.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>兔嘟嘟</span></div></div><div>请问老师如何看待 Makefile 已过时的言论？
在知乎上查找相关资料时，发现很多人认为 Makefile 过时了，只需要学习 cmake、bazel 之类的，各种说法都有，现在有点晕</div><div><p>作者回复：我感觉 Makefile 没过时，kubernetes 等大型项目都是用的 Makefile。

Makefile 功能强大，应对超大型的项目都没问题，对于一般的项目更不是瓶颈了。</p></div><div><div>2021-10-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/ad/e6/bf43ee14.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>ggchangan</span></div></div><div>老师的课程真是超值，特别感谢！有个问题请教下，怎么自动生成基于 suite 的测试代码呢？</div><div><p>作者回复：调研了下，当前应该没有这类工具。如果你了解有，欢迎评论区分享。</p></div><div><div>2021-10-14</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Daiver</span></div></div><div>老师，看到 iam 项目下面的 license 文件中添加了其他库的说明，这个是手动加上去的吗</div><div><p>作者回复：也是自动生成的，iam 中很多都是通过工具来搞的</p></div><div><div>2021-09-23</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Sch0ng</span></div></div><div>使用 Makefile 可以高效管理 go 项目。</div><div><div>2021-08-10</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/01/8c/41adb537.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Tiandh</span></div></div><div>[going@dev iam]$ make install
make[1]: *** No rule to make target 'install.install'.  Stop.
make: *** [Makefile:154: install] Error 2
[going@dev iam]$ </div><div><p>作者回复：这个命令目前还只是个占位符，不建议用。底层代码已实现，但还没测试，后续会补上</p></div><div><div>2021-06-28</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/72/2a/c4042a20.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>骑蜗牛的勇士</span></div></div><div>看 iam 源码，各功能的 service 和 store 都是每次调用的时候，返回一个新的实例，这样对性能有影响吗，或者是有别的考虑吗？</div><div><p>作者回复：返回的是已经初始化好的实例</p></div><div><div>2021-06-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1a"><outline class="toc-level-h1" data-reactid=".1a.0" style="width: 175px;"><active data-reactid=".1a.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1a.0.1"><span data-reactid=".1a.0.1.0">14 | 项目管理：如何编写高质量的 Makefile？</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.1" style="width: 165px;"><active data-reactid=".1a.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1a.1.1"><span data-reactid=".1a.1.1.0">熟练掌握 Makefile 语法</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.2" style="width: 165px;"><active data-reactid=".1a.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1a.2.1"><span data-reactid=".1a.2.1.0">规划 Makefile 要实现的功能</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.3" style="width: 165px;"><active data-reactid=".1a.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1a.3.1"><span data-reactid=".1a.3.1.0">设计合理的 Makefile 结构</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.4" style="width: 165px;"><active data-reactid=".1a.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1a.4.1"><span data-reactid=".1a.4.1.0">掌握 Makefile 编写技巧</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.5" style="width: 155px;"><active data-reactid=".1a.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1a.5.1"><span data-reactid=".1a.5.1.0">技巧 1：善用通配符和自动变量</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.6" style="width: 155px;"><active data-reactid=".1a.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1a.6.1"><span data-reactid=".1a.6.1.0">技巧 2：善用函数</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.7" style="width: 155px;"><active data-reactid=".1a.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1a.7.1"><span data-reactid=".1a.7.1.0">技巧 3：依赖需要用到的工具</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.8" style="width: 155px;"><active data-reactid=".1a.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1a.8.1"><span data-reactid=".1a.8.1.0">技巧 4：把常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.9" style="width: 155px;"><active data-reactid=".1a.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1a.9.1"><span data-reactid=".1a.9.1.0">技巧 5：编写可扩展的 Makefile</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.a" style="width: 155px;"><active data-reactid=".1a.a.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".1a.a.1"><span data-reactid=".1a.a.1.0">技巧 6：将所有输出存放在一个目录下，方便清理和查找</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.b" style="width: 155px;"><active data-reactid=".1a.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".1a.b.1"><span data-reactid=".1a.b.1.0">技巧 7：使用带层级的命名方式</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.c" style="width: 155px;"><active data-reactid=".1a.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".1a.c.1"><span data-reactid=".1a.c.1.0">技巧 8：做好目标拆分</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.d" style="width: 155px;"><active data-reactid=".1a.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".1a.d.1"><span data-reactid=".1a.d.1.0">技巧 9：设置 OPTIONS</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.e" style="width: 155px;"><active data-reactid=".1a.e.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".1a.e.1"><span data-reactid=".1a.e.1.0">技巧 10：定义环境变量</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.f" style="width: 155px;"><active data-reactid=".1a.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".1a.f.1"><span data-reactid=".1a.f.1.0">技巧 11：自己调用自己</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.g" style="width: 165px;"><active data-reactid=".1a.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".1a.g.1"><span data-reactid=".1a.g.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.h" style="width: 165px;"><active data-reactid=".1a.h.0"></active><a class="toc-outline-theme-github" href="#sr-toc-17" data-reactid=".1a.h.1"><span data-reactid=".1a.h.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.i" style="width: 165px;"><active data-reactid=".1a.i.0"></active><a class="toc-outline-theme-github" href="#sr-toc-18" data-reactid=".1a.i.1"><span data-reactid=".1a.i.1.0">精选留言 (17)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/388920" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>