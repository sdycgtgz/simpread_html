
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 35 | 效率神器：如何设计和实现一个命令行客户端工具？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>35 | 效率神器：如何设计和实现一个命令行客户端工具？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">这一讲我们来了解目前业界有哪些优秀的开源日志包，以及手把手教你从 0 编写一个日志包</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 35 | 效率神器：如何设计和实现一个命令行客户端工具？</h1><div><span>孔令飞</span> <span> 2021-08-14</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/90/44/900f44430300520aa9c5678b668f7344.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：14.70M</span><span> 时长：16:06</span></div></div><audio title="35 | 效率神器：如何设计和实现一个命令行客户端工具？" src="https://res001.geekbang.org/media/audio/a2/27/a250cabb45d0193986496aafda569727/ld/ld.m3u8" __idm_id__="319503"></audio></div><div><div><div><div data-slate-editor="true" data-key="21425" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="21426"><span data-slate-object="text" data-key="21427"><span data-slate-leaf="true" data-offset-key="21427:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。今天我们来聊聊，如何实现一个命令行客户端工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21428"><span data-slate-object="text" data-key="21429"><span data-slate-leaf="true" data-offset-key="21429:0" data-first-offset="true"><span data-slate-string="true">如果你用过 Kubernetes、Istio、etcd，那你一定用过这些开源项目所提供的命令行工具：kubectl、istioctl、etcdctl。一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21430"><span data-slate-object="text" data-key="21431"><span data-slate-leaf="true" data-offset-key="21431:0" data-first-offset="true"><span data-slate-string="true">xxx</span></span></span></span><span data-slate-object="text" data-key="21432"><span data-slate-leaf="true" data-offset-key="21432:0" data-first-offset="true"><span data-slate-string="true"> 项目，伴随着一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21433"><span data-slate-object="text" data-key="21434"><span data-slate-leaf="true" data-offset-key="21434:0" data-first-offset="true"><span data-slate-string="true">xxxctl</span></span></span></span><span data-slate-object="text" data-key="21435"><span data-slate-leaf="true" data-offset-key="21435:0" data-first-offset="true"><span data-slate-string="true"> 命令行工具，这似乎已经成为一种趋势，在一些大型系统中更是常见。提供 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21436"><span data-slate-object="text" data-key="21437"><span data-slate-leaf="true" data-offset-key="21437:0" data-first-offset="true"><span data-slate-string="true">xxxctl</span></span></span></span><span data-slate-object="text" data-key="21438"><span data-slate-leaf="true" data-offset-key="21438:0" data-first-offset="true"><span data-slate-string="true"> 命令行工具有这两个好处：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21439"><div data-slate-type="list-line" data-slate-object="block" data-key="21440"><span data-slate-object="text" data-key="21441"><span data-slate-leaf="true" data-offset-key="21441:0" data-first-offset="true"><span data-slate-string="true">实现自动化：可以通过在脚本中调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21442"><span data-slate-object="text" data-key="21443"><span data-slate-leaf="true" data-offset-key="21443:0" data-first-offset="true"><span data-slate-string="true">xxxctl</span></span></span></span><span data-slate-object="text" data-key="21444"><span data-slate-leaf="true" data-offset-key="21444:0" data-first-offset="true"><span data-slate-string="true"> 工具，实现自动化。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21445"><span data-slate-object="text" data-key="21446"><span data-slate-leaf="true" data-offset-key="21446:0" data-first-offset="true"><span data-slate-string="true">提高效率：通过将应用的功能封装成命令和参数，方便运维、开发人员在 Linux 服务器上调用。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21447"><span data-slate-object="text" data-key="21448"><span data-slate-leaf="true" data-offset-key="21448:0" data-first-offset="true"><span data-slate-string="true">其中，kubectl 命令设计的功能最为复杂，也是非常优秀的命令行工具，IAM 项目的 iamctl 客户端工具就是仿照 kubectl 来实现的。这一讲，我就通过剖析 iamctl 命令行工具的实现，来介绍下如何实现一个优秀的客户端工具。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="21449" id="sr-toc-1"><span data-slate-object="text" data-key="21450"><span data-slate-leaf="true" data-offset-key="21450:0" data-first-offset="true"><span data-slate-string="true">常见客户端介绍</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="21451"><span data-slate-object="text" data-key="21452"><span data-slate-leaf="true" data-offset-key="21452:0" data-first-offset="true"><span data-slate-string="true">在介绍 iamctl 命令行工具的实现之前，我们先来看下常见的客户端。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21453"><span data-slate-object="text" data-key="21454"><span data-slate-leaf="true" data-offset-key="21454:0" data-first-offset="true"><span data-slate-string="true">客户端又叫用户端，与后端服务相对应，安装在客户机上，用户可以使用这些客户端访问后端服务。不同的客户端面向的人群不同，所能提供的访问能力也有差异。常见的客户端有下面这几种：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21455"><div data-slate-type="list-line" data-slate-object="block" data-key="21456"><span data-slate-object="text" data-key="21457"><span data-slate-leaf="true" data-offset-key="21457:0" data-first-offset="true"><span data-slate-string="true">前端，包括浏览器、手机应用；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21458"><span data-slate-object="text" data-key="21459"><span data-slate-leaf="true" data-offset-key="21459:0" data-first-offset="true"><span data-slate-string="true">SDK；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21460"><span data-slate-object="text" data-key="21461"><span data-slate-leaf="true" data-offset-key="21461:0" data-first-offset="true"><span data-slate-string="true">命令行工具；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21462"><span data-slate-object="text" data-key="21463"><span data-slate-leaf="true" data-offset-key="21463:0" data-first-offset="true"><span data-slate-string="true">其他终端。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21464"><span data-slate-object="text" data-key="21465"><span data-slate-leaf="true" data-offset-key="21465:0" data-first-offset="true"><span data-slate-string="true">接下来，我就来分别介绍下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21466"><span data-slate-object="text" data-key="21467"><span data-slate-leaf="true" data-offset-key="21467:0" data-first-offset="true"><span data-slate-string="true">浏览器和手机应用提供一个交互界面供用户访问后端服务，使用体验最好，面向的人群是最终的用户。这两类客户端也称为前端。前端由前端开发人员进行开发，并通过 API 接口，调用后端的服务。后端开发人员不需要关注这两类客户端，只需要关注如何提供 API 接口即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21468"><span data-slate-object="text" data-key="21469"><span data-slate-leaf="true" data-offset-key="21469:0" data-first-offset="true"><span data-slate-string="true">SDK（Software Development Kit）也是一个客户端，供开发者调用。开发者调用 API 时，如果是通过 HTTP 协议，需要编写 HTTP 的调用代码、HTTP 请求包的封装和返回包的解封，还要处理 HTTP 的状态码，使用起来不是很方便。SDK 其实是封装了 API 接口的一系列函数集合，开发者通过调用 SDK 中的函数调用 API 接口，提供 SDK 主要是方便开发者调用，减少工作量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21470"><span data-slate-object="text" data-key="21471"><span data-slate-leaf="true" data-offset-key="21471:0" data-first-offset="true"><span data-slate-string="true">命令行工具是可以在操作系统上执行的一个二进制程序，提供了一种比 SDK 和 API 接口更方便快捷的访问后端服务的途径，供运维或者开发人员在服务器上直接执行使用，或者在自动化脚本中调用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21472"><span data-slate-object="text" data-key="21473"><span data-slate-leaf="true" data-offset-key="21473:0" data-first-offset="true"><span data-slate-string="true">还有其他各类客户端，这里我列举一些常见的。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21474"><div data-slate-type="list-line" data-slate-object="block" data-key="21475"><span data-slate-object="text" data-key="21476"><span data-slate-leaf="true" data-offset-key="21476:0" data-first-offset="true"><span data-slate-string="true">终端设备：POS 机、学习机、智能音箱等。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21477"><span data-slate-object="text" data-key="21478"><span data-slate-leaf="true" data-offset-key="21478:0" data-first-offset="true"><span data-slate-string="true">第三方应用程序：通过调用 API 接口或者 SDK，调用我们提供的后端服务，从而实现自身的功能。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21479"><span data-slate-object="text" data-key="21480"><span data-slate-leaf="true" data-offset-key="21480:0" data-first-offset="true"><span data-slate-string="true">脚本：脚本中通过 API 接口或者命令行工具，调用我们提供的后端服务，实现自动化。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21481"><span data-slate-object="text" data-key="21482"><span data-slate-leaf="true" data-offset-key="21482:0" data-first-offset="true"><span data-slate-string="true">这些其他的各类客户端，都是通过调用 API 接口使用后端服务的，它们跟前端一样，也不需要后台开发人员开发。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21483"><span data-slate-object="text" data-key="21484"><span data-slate-leaf="true" data-offset-key="21484:0" data-first-offset="true"><span data-slate-string="true">需要后台开发人员投入工作量进行研发的客户端是 SDK 和命令行工具。这两类客户端工具有个调用和被调用的顺序，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="21485"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e9/91/e97e547bec77dc7129615b11792f1291.jpg?wh=1920x568"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21486"><span data-slate-object="text" data-key="21487"><span data-slate-leaf="true" data-offset-key="21487:0" data-first-offset="true"><span data-slate-string="true">你可以看到，命令行工具和 SDK 最终都是通过 API 接口调用后端服务的，通过这种方式可以保证服务的一致性，并减少为适配多个客户端所带来的额外开发工作量。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="21488" id="sr-toc-2"><span data-slate-object="text" data-key="21489"><span data-slate-leaf="true" data-offset-key="21489:0" data-first-offset="true"><span data-slate-string="true">大型系统客户端（xxxctl）的特点</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="21490"><span data-slate-object="text" data-key="21491"><span data-slate-leaf="true" data-offset-key="21491:0" data-first-offset="true"><span data-slate-string="true">通过学习 kubectl、istioctl、etcdctl 这些优秀的命令行工具，可以发现一个大型系统的命令行工具，通常具有下面这些特点：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21492"><div data-slate-type="list-line" data-slate-object="block" data-key="21493"><span data-slate-object="text" data-key="21494"><span data-slate-leaf="true" data-offset-key="21494:0" data-first-offset="true"><span data-slate-string="true">支持命令和子命令，命令 / 子命名有自己独有的命令行参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21495"><span data-slate-object="text" data-key="21496"><span data-slate-leaf="true" data-offset-key="21496:0" data-first-offset="true"><span data-slate-string="true">支持一些特殊的命令。比如支持 completion 命令，completion 命令可以输出 bash/zsh 自动补全脚本，实现命令行及参数的自动补全。还支持 version 命令，version 命令不仅可以输出客户端的版本，还可以输出服务端的版本（如果有需要）。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21497"><span data-slate-object="text" data-key="21498"><span data-slate-leaf="true" data-offset-key="21498:0" data-first-offset="true"><span data-slate-string="true">支持全局 option，全局 option 可以作为所有命令及子命令的命令行参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21499"><span data-slate-object="text" data-key="21500"><span data-slate-leaf="true" data-offset-key="21500:0" data-first-offset="true"><span data-slate-string="true">支持 -h/help，-h/help 可以打印 xxxctl 的帮助信息，例如：</span></span></span></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21501"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21502"><span data-slate-object="text" data-key="21503"><span data-slate-leaf="true" data-offset-key="21503:0" data-first-offset="true"><span data-slate-string="true">$ iamctl -h</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21504"><span data-slate-object="text" data-key="21505"><span data-slate-leaf="true" data-offset-key="21505:0" data-first-offset="true"><span data-slate-string="true">iamctl controls the iam platform, is the client side tool </span></span></span><span data-slate-object="text" data-key="21506"><span data-slate-leaf="true" data-offset-key="21506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21507"><span data-slate-leaf="true" data-offset-key="21507:0" data-first-offset="true"><span data-slate-string="true"> iam platform.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21508"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21509"><span data-slate-object="text" data-key="21510"><span data-slate-leaf="true" data-offset-key="21510:0" data-first-offset="true"><span data-slate-string="true"> Find more information at:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21511"><span data-slate-object="text" data-key="21512"><span data-slate-leaf="true" data-offset-key="21512:0" data-first-offset="true"><span data-slate-string="true">https://github.com/marmotedu/iam/blob/master/docs/guide/en-US/cmd/iamctl/iamctl.md</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21513"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21514"><span data-slate-object="text" data-key="21515"><span data-slate-leaf="true" data-offset-key="21515:0" data-first-offset="true"><span data-slate-string="true">Basic Commands:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21516"><span data-slate-object="text" data-key="21517"><span data-slate-leaf="true" data-offset-key="21517:0" data-first-offset="true"><span data-slate-string="true">  info        Print the host information</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21518"><span data-slate-object="text" data-key="21519"><span data-slate-leaf="true" data-offset-key="21519:0" data-first-offset="true"><span data-slate-string="true">  color       Print colors supported by the current terminal</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21520"><span data-slate-object="text" data-key="21521"><span data-slate-leaf="true" data-offset-key="21521:0" data-first-offset="true"><span data-slate-string="true">  new         Generate demo </span></span></span><span data-slate-object="text" data-key="21522"><span data-slate-leaf="true" data-offset-key="21522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">command</span></span></span></span><span data-slate-object="text" data-key="21523"><span data-slate-leaf="true" data-offset-key="21523:0" data-first-offset="true"><span data-slate-string="true"> code</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21524"><span data-slate-object="text" data-key="21525"><span data-slate-leaf="true" data-offset-key="21525:0" data-first-offset="true"><span data-slate-string="true">  jwt         JWT command-line tool</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21526"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21527"><span data-slate-object="text" data-key="21528"><span data-slate-leaf="true" data-offset-key="21528:0" data-first-offset="true"><span data-slate-string="true">Identity and Access Management Commands:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21529"><span data-slate-object="text" data-key="21530"><span data-slate-leaf="true" data-offset-key="21530:0" data-first-offset="true"><span data-slate-string="true">  user        Manage </span></span></span><span data-slate-object="text" data-key="21531"><span data-slate-leaf="true" data-offset-key="21531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">users</span></span></span></span><span data-slate-object="text" data-key="21532"><span data-slate-leaf="true" data-offset-key="21532:0" data-first-offset="true"><span data-slate-string="true"> on iam platform</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21533"><span data-slate-object="text" data-key="21534"><span data-slate-leaf="true" data-offset-key="21534:0" data-first-offset="true"><span data-slate-string="true">  secret      Manage secrets on iam platform</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21535"><span data-slate-object="text" data-key="21536"><span data-slate-leaf="true" data-offset-key="21536:0" data-first-offset="true"><span data-slate-string="true">  policy      Manage authorization policies on iam platform</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21537"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21538"><span data-slate-object="text" data-key="21539"><span data-slate-leaf="true" data-offset-key="21539:0" data-first-offset="true"><span data-slate-string="true">Troubleshooting and Debugging Commands:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21540"><span data-slate-object="text" data-key="21541"><span data-slate-leaf="true" data-offset-key="21541:0" data-first-offset="true"><span data-slate-string="true">  validate    Validate the basic environment </span></span></span><span data-slate-object="text" data-key="21542"><span data-slate-leaf="true" data-offset-key="21542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21543"><span data-slate-leaf="true" data-offset-key="21543:0" data-first-offset="true"><span data-slate-string="true"> iamctl to run</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21544"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21545"><span data-slate-object="text" data-key="21546"><span data-slate-leaf="true" data-offset-key="21546:0" data-first-offset="true"><span data-slate-string="true">Settings Commands:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21547"><span data-slate-object="text" data-key="21548"><span data-slate-leaf="true" data-offset-key="21548:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="21549"><span data-slate-leaf="true" data-offset-key="21549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="21550"><span data-slate-leaf="true" data-offset-key="21550:0" data-first-offset="true"><span data-slate-string="true">         Set specific features on objects</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21551"><span data-slate-object="text" data-key="21552"><span data-slate-leaf="true" data-offset-key="21552:0" data-first-offset="true"><span data-slate-string="true">  completion  Output shell completion code </span></span></span><span data-slate-object="text" data-key="21553"><span data-slate-leaf="true" data-offset-key="21553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21554"><span data-slate-leaf="true" data-offset-key="21554:0" data-first-offset="true"><span data-slate-string="true"> the specified shell (bash or zsh)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21555"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21556"><span data-slate-object="text" data-key="21557"><span data-slate-leaf="true" data-offset-key="21557:0" data-first-offset="true"><span data-slate-string="true">Other Commands:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21558"><span data-slate-object="text" data-key="21559"><span data-slate-leaf="true" data-offset-key="21559:0" data-first-offset="true"><span data-slate-string="true">  version     Print the client and server version information</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21560"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21561"><span data-slate-object="text" data-key="21562"><span data-slate-leaf="true" data-offset-key="21562:0" data-first-offset="true"><span data-slate-string="true">Usage:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21563"><span data-slate-object="text" data-key="21564"><span data-slate-leaf="true" data-offset-key="21564:0" data-first-offset="true"><span data-slate-string="true">  iamctl [flags] [options]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21565"></div><div data-slate-type="code-line" data-slate-object="block" data-key="21566"><span data-slate-object="text" data-key="21567"><span data-slate-leaf="true" data-offset-key="21567:0" data-first-offset="true"><span data-slate-string="true">Use </span></span></span><span data-slate-object="text" data-key="21568"><span data-slate-leaf="true" data-offset-key="21568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iamctl &lt;command&gt; --help"</span></span></span></span><span data-slate-object="text" data-key="21569"><span data-slate-leaf="true" data-offset-key="21569:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="21570"><span data-slate-leaf="true" data-offset-key="21570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21571"><span data-slate-leaf="true" data-offset-key="21571:0" data-first-offset="true"><span data-slate-string="true"> more information about a given </span></span></span><span data-slate-object="text" data-key="21572"><span data-slate-leaf="true" data-offset-key="21572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">command</span></span></span></span><span data-slate-object="text" data-key="21573"><span data-slate-leaf="true" data-offset-key="21573:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21574"><span data-slate-object="text" data-key="21575"><span data-slate-leaf="true" data-offset-key="21575:0" data-first-offset="true"><span data-slate-string="true">Use </span></span></span><span data-slate-object="text" data-key="21576"><span data-slate-leaf="true" data-offset-key="21576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iamctl options"</span></span></span></span><span data-slate-object="text" data-key="21577"><span data-slate-leaf="true" data-offset-key="21577:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="21578"><span data-slate-leaf="true" data-offset-key="21578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21579"><span data-slate-leaf="true" data-offset-key="21579:0" data-first-offset="true"><span data-slate-string="true"> a list of global command-line options (applies to all commands).</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="21580"><div data-slate-type="list-line" data-slate-object="block" data-key="21581"><span data-slate-object="text" data-key="21582"><span data-slate-leaf="true" data-offset-key="21582:0" data-first-offset="true"><span data-slate-string="true">支持 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21583"><span data-slate-object="text" data-key="21584"><span data-slate-leaf="true" data-offset-key="21584:0" data-first-offset="true"><span data-slate-string="true">xxxctl help [command | command subcommand] [command | command subcommand] -h</span></span></span></span><span data-slate-object="text" data-key="21585"><span data-slate-leaf="true" data-offset-key="21585:0" data-first-offset="true"><span data-slate-string="true"> ，打印命令 / 子命令的帮助信息，格式通常为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21586"><span data-slate-object="text" data-key="21587"><span data-slate-leaf="true" data-offset-key="21587:0" data-first-offset="true"><span data-slate-string="true">命令描述 + 使用方法</span></span></span></span><span data-slate-object="text" data-key="21588"><span data-slate-leaf="true" data-offset-key="21588:0" data-first-offset="true"><span data-slate-string="true">  。例如：</span></span></span></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21589"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21590"><span data-slate-object="text" data-key="21591"><span data-slate-leaf="true" data-offset-key="21591:0" data-first-offset="true"><span data-slate-string="true">$ istioctl </span></span></span><span data-slate-object="text" data-key="21592"><span data-slate-leaf="true" data-offset-key="21592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">help</span></span></span></span><span data-slate-object="text" data-key="21593"><span data-slate-leaf="true" data-offset-key="21593:0" data-first-offset="true"><span data-slate-string="true"> register</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21594"><span data-slate-object="text" data-key="21595"><span data-slate-leaf="true" data-offset-key="21595:0" data-first-offset="true"><span data-slate-string="true">Registers a service instance (e.g. VM) joining the mesh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21596"><span data-slate-object="text" data-key="21597"><span data-slate-leaf="true" data-offset-key="21597:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21598"><span data-slate-object="text" data-key="21599"><span data-slate-leaf="true" data-offset-key="21599:0" data-first-offset="true"><span data-slate-string="true">Usage:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21600"><span data-slate-object="text" data-key="21601"><span data-slate-leaf="true" data-offset-key="21601:0" data-first-offset="true"><span data-slate-string="true">  istioctl register &lt;svcname&gt; &lt;ip&gt; [name1:]port1 [name2:]port2 ... [flags]</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21602"><span data-slate-object="text" data-key="21603"><span data-slate-leaf="true" data-offset-key="21603:0" data-first-offset="true"><span data-slate-string="true">除此之外，一个大型系统的命令行工具还可以支持一些更高阶的功能，例如：支持命令分组，支持配置文件，支持命令的使用 example，等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21604"><span data-slate-object="text" data-key="21605"><span data-slate-leaf="true" data-offset-key="21605:0" data-first-offset="true"><span data-slate-string="true">在 Go 生态中，如果我们要找一个符合上面所有特点的命令行工具，那非 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21606"><span data-slate-object="text" data-key="21607"><span data-slate-leaf="true" data-offset-key="21607:0" data-first-offset="true"><span data-slate-string="true">kubectl</span></span></span></a><span data-slate-object="text" data-key="21608"><span data-slate-leaf="true" data-offset-key="21608:0" data-first-offset="true"><span data-slate-string="true"> 莫属。因为我今天要重点讲的 iamctl 客户端工具，就是仿照它来实现的，所以这里就不展开介绍 kubectl 了，不过还是建议你认真研究下 kubectl 的实现。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="21609" id="sr-toc-3"><span data-slate-object="text" data-key="21610"><span data-slate-leaf="true" data-offset-key="21610:0" data-first-offset="true"><span data-slate-string="true">iamctl 的核心实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="21611"><span data-slate-object="text" data-key="21612"><span data-slate-leaf="true" data-offset-key="21612:0" data-first-offset="true"><span data-slate-string="true">接下来，我就来介绍 IAM 系统自带的 iamctl 客户端工具，它是仿照 kubectl 来实现的，能够满足一个大型系统客户端工具的需求。我会从 iamctl 的功能、代码结构、命令行选项和配置文件解析 4 个方面来介绍。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21613" id="sr-toc-4"><span data-slate-object="text" data-key="21614"><span data-slate-leaf="true" data-offset-key="21614:0" data-first-offset="true"><span data-slate-string="true">iamctl 的功能</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21615"><span data-slate-object="text" data-key="21616"><span data-slate-leaf="true" data-offset-key="21616:0" data-first-offset="true"><span data-slate-string="true">iamctl 将命令进行了分类。这里，我也建议你对命令进行分类，因为通过分类，不仅可以协助你理解命令的用途，还能帮你快速定位某类命令。另外，当命令很多时，分类也可以使命令看起来更规整。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21617"><span data-slate-object="text" data-key="21618"><span data-slate-leaf="true" data-offset-key="21618:0" data-first-offset="true"><span data-slate-string="true">iamctl 实现的命令如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="21619"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1d/da/1dee217f8be94ae1c3c1d9b29d627eda.jpg?wh=1920x1696"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21620"><span data-slate-object="text" data-key="21621"><span data-slate-leaf="true" data-offset-key="21621:0" data-first-offset="true"><span data-slate-string="true">更详细的功能，你可以参考 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21622"><span data-slate-object="text" data-key="21623"><span data-slate-leaf="true" data-offset-key="21623:0" data-first-offset="true"><span data-slate-string="true">iamctl -h</span></span></span></span><span data-slate-object="text" data-key="21624"><span data-slate-leaf="true" data-offset-key="21624:0" data-first-offset="true"><span data-slate-string="true"> 。我建议你在实现 xxxctl 工具时，考虑实现下面这几个功能。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21625"><div data-slate-type="list-line" data-slate-object="block" data-key="21626"><span data-slate-object="text" data-key="21627"><span data-slate-leaf="true" data-offset-key="21627:0" data-first-offset="true"><span data-slate-string="true">API 功能：平台具有的 API 功能，都能通过 xxxctl 方便地进行调用。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21628"><span data-slate-object="text" data-key="21629"><span data-slate-leaf="true" data-offset-key="21629:0" data-first-offset="true"><span data-slate-string="true">工具：一些使用 IAM 系统时有用的功能，比如签发 JWT Token。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21630"><span data-slate-object="text" data-key="21631"><span data-slate-leaf="true" data-offset-key="21631:0" data-first-offset="true"><span data-slate-string="true">version、completion、validate 命令。</span></span></span></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21632" id="sr-toc-5"><span data-slate-object="text" data-key="21633"><span data-slate-leaf="true" data-offset-key="21633:0" data-first-offset="true"><span data-slate-string="true">代码结构</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21634"><span data-slate-object="text" data-key="21635"><span data-slate-leaf="true" data-offset-key="21635:0" data-first-offset="true"><span data-slate-string="true">iamctl 工具的 main 函数位于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21636"><span data-slate-object="text" data-key="21637"><span data-slate-leaf="true" data-offset-key="21637:0" data-first-offset="true"><span data-slate-string="true">iamctl.go</span></span></span></a><span data-slate-object="text" data-key="21638"><span data-slate-leaf="true" data-offset-key="21638:0" data-first-offset="true"><span data-slate-string="true"> 文件中。命令的实现存放在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21639"><span data-slate-object="text" data-key="21640"><span data-slate-leaf="true" data-offset-key="21640:0" data-first-offset="true"><span data-slate-string="true">internal/iamctl/cmd/cmd.go</span></span></span></a><span data-slate-object="text" data-key="21641"><span data-slate-leaf="true" data-offset-key="21641:0" data-first-offset="true"><span data-slate-string="true"> 文件中。iamctl 的命令统一存放在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21642"><span data-slate-object="text" data-key="21643"><span data-slate-leaf="true" data-offset-key="21643:0" data-first-offset="true"><span data-slate-string="true">internal/iamctl/cmd</span></span></span></a><span data-slate-object="text" data-key="21644"><span data-slate-leaf="true" data-offset-key="21644:0" data-first-offset="true"><span data-slate-string="true"> 目录下，每个命令都是一个 Go 包，包名即为命令名，</span></span><span data-slate-leaf="true" data-offset-key="21644:1"><span data-slate-object="annotation" data-annotation-key="gkann_f7432910" data-attr-id="39900" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">具体实现存放在 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21645"><span data-slate-object="text" data-key="21646"><span data-slate-leaf="true" data-offset-key="21646:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f7432910" data-attr-id="39900" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">internal/iamctl/cmd/&lt;命令&gt;/&lt; 命令 &gt;.go</span></span></span></span></span><span data-slate-object="text" data-key="21647"><span data-slate-leaf="true" data-offset-key="21647:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f7432910" data-attr-id="39900" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 文件中。如果命令有子命令，则子命令的实现存放在 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21648"><span data-slate-object="text" data-key="21649"><span data-slate-leaf="true" data-offset-key="21649:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f7432910" data-attr-id="39900" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">internal/iamctl/cmd/&lt;命令&gt;/&lt; 命令 &gt;_&lt; 子命令 &gt;.go</span></span></span></span></span><span data-slate-object="text" data-key="21650"><span data-slate-leaf="true" data-offset-key="21650:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f7432910" data-attr-id="39900" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 文件中。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21651"><span data-slate-object="text" data-key="21652"><span data-slate-leaf="true" data-offset-key="21652:0" data-first-offset="true"><span data-slate-string="true">使用这种代码组织方式，即使是在命令很多的情况下，也能让代码井然有序，方便定位和维护代码。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21653" id="sr-toc-6"><span data-slate-object="text" data-key="21654"><span data-slate-leaf="true" data-offset-key="21654:0" data-first-offset="true"><span data-slate-string="true">命令行选项</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21655"><span data-slate-object="text" data-key="21656"><span data-slate-leaf="true" data-offset-key="21656:0" data-first-offset="true"><span data-slate-string="true">添加命令行选项的代码在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21657"><span data-slate-object="text" data-key="21658"><span data-slate-leaf="true" data-offset-key="21658:0" data-first-offset="true"><span data-slate-string="true">NewIAMCtlCommand</span></span></span></a><span data-slate-object="text" data-key="21659"><span data-slate-leaf="true" data-offset-key="21659:0" data-first-offset="true"><span data-slate-string="true"> 函数中，核心代码为：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="21660"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21661"><span data-slate-object="text" data-key="21662"><span data-slate-leaf="true" data-offset-key="21662:0" data-first-offset="true"><span data-slate-string="true">flags := cmds.PersistentFlags()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21663"><span data-slate-object="text" data-key="21664"><span data-slate-leaf="true" data-offset-key="21664:0" data-first-offset="true"><span data-slate-string="true">...                                                                             </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21665"><span data-slate-object="text" data-key="21666"><span data-slate-leaf="true" data-offset-key="21666:0" data-first-offset="true"><span data-slate-string="true">iamConfigFlags := genericclioptions.NewConfigFlags(</span></span></span><span data-slate-object="text" data-key="21667"><span data-slate-leaf="true" data-offset-key="21667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="21668"><span data-slate-leaf="true" data-offset-key="21668:0" data-first-offset="true"><span data-slate-string="true">).WithDeprecatedPasswordFlag().WithDeprecatedSecretFlag()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21669"><span data-slate-object="text" data-key="21670"><span data-slate-leaf="true" data-offset-key="21670:0" data-first-offset="true"><span data-slate-string="true">iamConfigFlags.AddFlags(flags)                                   </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21671"><span data-slate-object="text" data-key="21672"><span data-slate-leaf="true" data-offset-key="21672:0" data-first-offset="true"><span data-slate-string="true">matchVersionIAMConfigFlags := cmdutil.NewMatchVersionFlags(iamConfigFlags)                </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21673"><span data-slate-object="text" data-key="21674"><span data-slate-leaf="true" data-offset-key="21674:0" data-first-offset="true"><span data-slate-string="true">matchVersionIAMConfigFlags.AddFlags(cmds.PersistentFlags())</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21675"><span data-slate-type="code" data-slate-object="inline" data-key="21676"><span data-slate-object="text" data-key="21677"><span data-slate-leaf="true" data-offset-key="21677:0" data-first-offset="true"><span data-slate-string="true">NewConfigFlags(true)</span></span></span></span><span data-slate-object="text" data-key="21678"><span data-slate-leaf="true" data-offset-key="21678:0" data-first-offset="true"><span data-slate-string="true"> 返回带有默认值的参数，并通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21679"><span data-slate-object="text" data-key="21680"><span data-slate-leaf="true" data-offset-key="21680:0" data-first-offset="true"><span data-slate-string="true">iamConfigFlags.AddFlags(flags)</span></span></span></span><span data-slate-object="text" data-key="21681"><span data-slate-leaf="true" data-offset-key="21681:0" data-first-offset="true"><span data-slate-string="true"> 添加到 cobra 的命令行 flag 中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21682"><span data-slate-type="code" data-slate-object="inline" data-key="21683"><span data-slate-object="text" data-key="21684"><span data-slate-leaf="true" data-offset-key="21684:0" data-first-offset="true"><span data-slate-string="true">NewConfigFlags(true)</span></span></span></span><span data-slate-object="text" data-key="21685"><span data-slate-leaf="true" data-offset-key="21685:0" data-first-offset="true"><span data-slate-string="true"> 返回结构体类型的值都是指针类型，这样做的好处是：程序可以判断出是否指定了某个参数，从而可以根据需要添加参数。例如：可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21686"><span data-slate-object="text" data-key="21687"><span data-slate-leaf="true" data-offset-key="21687:0" data-first-offset="true"><span data-slate-string="true">WithDeprecatedPasswordFlag()</span></span></span></span><span data-slate-object="text" data-key="21688"><span data-slate-leaf="true" data-offset-key="21688:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21689"><span data-slate-object="text" data-key="21690"><span data-slate-leaf="true" data-offset-key="21690:0" data-first-offset="true"><span data-slate-string="true">WithDeprecatedSecretFlag()</span></span></span></span><span data-slate-object="text" data-key="21691"><span data-slate-leaf="true" data-offset-key="21691:0" data-first-offset="true"><span data-slate-string="true"> 添加密码和密钥认证参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21692"><span data-slate-type="code" data-slate-object="inline" data-key="21693"><span data-slate-object="text" data-key="21694"><span data-slate-leaf="true" data-offset-key="21694:0" data-first-offset="true"><span data-slate-string="true">NewMatchVersionFlags</span></span></span></span><span data-slate-object="text" data-key="21695"><span data-slate-leaf="true" data-offset-key="21695:0" data-first-offset="true"><span data-slate-string="true"> 指定是否需要服务端版本和客户端版本一致。如果不一致，在调用服务接口时会报错。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21696" id="sr-toc-7"><span data-slate-object="text" data-key="21697"><span data-slate-leaf="true" data-offset-key="21697:0" data-first-offset="true"><span data-slate-string="true">配置文件解析</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21698"><span data-slate-object="text" data-key="21699"><span data-slate-leaf="true" data-offset-key="21699:0" data-first-offset="true"><span data-slate-string="true">iamctl 需要连接 iam-apiserver，来完成用户、策略和密钥的增删改查，并且需要进行认证。要完成这些功能，需要有比较多的配置项。这些配置项如果每次都在命令行选项指定，会很麻烦，也容易出错。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21700"><span data-slate-object="text" data-key="21701"><span data-slate-leaf="true" data-offset-key="21701:0" data-first-offset="true"><span data-slate-string="true">最好的方式是保存到配置文件中，并加载配置文件。加载配置文件的代码位于 NewIAMCtlCommand 函数中，代码如下：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="21702"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21703"><span data-slate-object="text" data-key="21704"><span data-slate-leaf="true" data-offset-key="21704:0" data-first-offset="true"><span data-slate-string="true">_ = viper.</span></span></span><span data-slate-object="text" data-key="21705"><span data-slate-leaf="true" data-offset-key="21705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Bind</span></span></span></span><span data-slate-object="text" data-key="21706"><span data-slate-leaf="true" data-offset-key="21706:0" data-first-offset="true"><span data-slate-string="true">PFlags(cmds.</span></span></span><span data-slate-object="text" data-key="21707"><span data-slate-leaf="true" data-offset-key="21707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PersistentFlags</span></span></span></span><span data-slate-object="text" data-key="21708"><span data-slate-leaf="true" data-offset-key="21708:0" data-first-offset="true"><span data-slate-string="true">())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21709"><span data-slate-object="text" data-key="21710"><span data-slate-leaf="true" data-offset-key="21710:0" data-first-offset="true"><span data-slate-string="true">cobra.</span></span></span><span data-slate-object="text" data-key="21711"><span data-slate-leaf="true" data-offset-key="21711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnInitialize</span></span></span></span><span data-slate-object="text" data-key="21712"><span data-slate-leaf="true" data-offset-key="21712:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="21713"><span data-slate-leaf="true" data-offset-key="21713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span><span data-slate-object="text" data-key="21714"><span data-slate-leaf="true" data-offset-key="21714:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="21715"><span data-slate-leaf="true" data-offset-key="21715:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21716"><span data-slate-object="text" data-key="21717"><span data-slate-leaf="true" data-offset-key="21717:0" data-first-offset="true"><span data-slate-string="true">    genericapiserver.</span></span></span><span data-slate-object="text" data-key="21718"><span data-slate-leaf="true" data-offset-key="21718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LoadConfig</span></span></span></span><span data-slate-object="text" data-key="21719"><span data-slate-leaf="true" data-offset-key="21719:0" data-first-offset="true"><span data-slate-string="true">(viper.</span></span></span><span data-slate-object="text" data-key="21720"><span data-slate-leaf="true" data-offset-key="21720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GetString</span></span></span></span><span data-slate-object="text" data-key="21721"><span data-slate-leaf="true" data-offset-key="21721:0" data-first-offset="true"><span data-slate-string="true">(genericclioptions.</span></span></span><span data-slate-object="text" data-key="21722"><span data-slate-leaf="true" data-offset-key="21722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">FlagIAMConfig</span></span></span></span><span data-slate-object="text" data-key="21723"><span data-slate-leaf="true" data-offset-key="21723:0" data-first-offset="true"><span data-slate-string="true">), </span></span></span><span data-slate-object="text" data-key="21724"><span data-slate-leaf="true" data-offset-key="21724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iamctl"</span></span></span></span><span data-slate-object="text" data-key="21725"><span data-slate-leaf="true" data-offset-key="21725:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21726"><span data-slate-object="text" data-key="21727"><span data-slate-leaf="true" data-offset-key="21727:0" data-first-offset="true"><span data-slate-string="true">})  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21728"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21729"><span data-slate-object="text" data-key="21730"><span data-slate-leaf="true" data-offset-key="21730:0" data-first-offset="true"><span data-slate-string="true">iamctl 会按以下优先级加载配置文件：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21731"><div data-slate-type="list-line" data-slate-object="block" data-key="21732"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="21733"><span data-slate-leaf="true" data-offset-key="21733:0" data-first-offset="true"><span data-slate-string="true">命令行参 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21734"><span data-slate-object="text" data-key="21735"><span data-slate-leaf="true" data-offset-key="21735:0" data-first-offset="true"><span data-slate-string="true">--iamconfig</span></span></span></span><span data-slate-object="text" data-key="21736"><span data-slate-leaf="true" data-offset-key="21736:0" data-first-offset="true"><span data-slate-string="true"> 指定的配置文件。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="21737"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="21738"><span data-slate-leaf="true" data-offset-key="21738:0" data-first-offset="true"><span data-slate-string="true">当前目录下的 iamctl.yaml 文件。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="21739"><div data-code-line-number="3"></div><div><span data-slate-type="code" data-slate-object="inline" data-key="21740"><span data-slate-object="text" data-key="21741"><span data-slate-leaf="true" data-offset-key="21741:0" data-first-offset="true"><span data-slate-string="true">$HOME/.iam/iamctl.yaml</span></span></span></span><span data-slate-object="text" data-key="21742"><span data-slate-leaf="true" data-offset-key="21742:0" data-first-offset="true"><span data-slate-string="true"> 文件。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21743"><span data-slate-object="text" data-key="21744"><span data-slate-leaf="true" data-offset-key="21744:0" data-first-offset="true"><span data-slate-string="true">这种加载方式具有两个好处。首先是可以手动指定不同的配置文件，这在多环境、多配置下尤为重要。其次是方便使用，可以把配置存放在默认的加载路径中，在执行命令时，就不用再指定 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21745"><span data-slate-object="text" data-key="21746"><span data-slate-leaf="true" data-offset-key="21746:0" data-first-offset="true"><span data-slate-string="true">--iamconfig</span></span></span></span><span data-slate-object="text" data-key="21747"><span data-slate-leaf="true" data-offset-key="21747:0" data-first-offset="true"><span data-slate-string="true"> 参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21748"><span data-slate-object="text" data-key="21749"><span data-slate-leaf="true" data-offset-key="21749:0" data-first-offset="true"><span data-slate-string="true">加载完配置文件之后，就可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21750"><span data-slate-object="text" data-key="21751"><span data-slate-leaf="true" data-offset-key="21751:0" data-first-offset="true"><span data-slate-string="true">viper.Get&lt;Type&gt;()</span></span></span></span><span data-slate-object="text" data-key="21752"><span data-slate-leaf="true" data-offset-key="21752:0" data-first-offset="true"><span data-slate-string="true"> 函数来获取配置。例如，iamctl 使用了以下 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21753"><span data-slate-object="text" data-key="21754"><span data-slate-leaf="true" data-offset-key="21754:0" data-first-offset="true"><span data-slate-string="true">viper.Get&lt;Type&gt;</span></span></span></span><span data-slate-object="text" data-key="21755"><span data-slate-leaf="true" data-offset-key="21755:0" data-first-offset="true"><span data-slate-string="true"> 方法：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="21756"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/8b/42/8bce5d0b9ab45b5238d70b73175cf642.png?wh=1920x813"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="21757" id="sr-toc-8"><span data-slate-object="text" data-key="21758"><span data-slate-leaf="true" data-offset-key="21758:0" data-first-offset="true"><span data-slate-string="true">iamctl 中子命令是如何构建的？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="21759"><span data-slate-object="text" data-key="21760"><span data-slate-leaf="true" data-offset-key="21760:0" data-first-offset="true"><span data-slate-string="true">讲完了 iamctl 命令行工具的核心实现，我们再来看看 iamctl 命令行工具中，子命令是如何构建的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21761"><span data-slate-object="text" data-key="21762"><span data-slate-leaf="true" data-offset-key="21762:0" data-first-offset="true"><span data-slate-string="true">命令行工具的核心是命令，有很多种方法可以构建一个命令，但还是有一些比较好的构建方法，值得我们去参考。接下来，我来介绍下如何用比较好的方式去构建命令。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21763" id="sr-toc-9"><span data-slate-object="text" data-key="21764"><span data-slate-leaf="true" data-offset-key="21764:0" data-first-offset="true"><span data-slate-string="true">命令构建</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21765"><span data-slate-object="text" data-key="21766"><span data-slate-leaf="true" data-offset-key="21766:0" data-first-offset="true"><span data-slate-string="true">命令行工具的核心能力是提供各类命令，来完成不同功能，每个命令构建的方式可以完全不同，但最好能按相同的方式去构建，并抽象成一个模型。如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="21767"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1e/93/1e78d2f387be0bcbae573d486e391e93.jpg?wh=1920x916"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21768"><span data-slate-object="text" data-key="21769"><span data-slate-leaf="true" data-offset-key="21769:0" data-first-offset="true"><span data-slate-string="true">你可以将一个命令行工具提供的命令进行分组。每个分组包含多个命令，每个命令又可以具有多个子命令，子命令和父命令在构建方式上完全一致。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21770"><span data-slate-object="text" data-key="21771"><span data-slate-leaf="true" data-offset-key="21771:0" data-first-offset="true"><span data-slate-string="true">每个命令可以按下面的四种方式构建。具体代码你可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="21772"><span data-slate-object="text" data-key="21773"><span data-slate-leaf="true" data-offset-key="21773:0" data-first-offset="true"><span data-slate-string="true">internal/iamctl/cmd/user/user_update.go</span></span></span></a><span data-slate-object="text" data-key="21774"><span data-slate-leaf="true" data-offset-key="21774:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21775"><div data-slate-type="list-line" data-slate-object="block" data-key="21776"><span data-slate-object="text" data-key="21777"><span data-slate-leaf="true" data-offset-key="21777:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21778"><span data-slate-object="text" data-key="21779"><span data-slate-leaf="true" data-offset-key="21779:0" data-first-offset="true"><span data-slate-string="true">NewCmdXyz</span></span></span></span><span data-slate-object="text" data-key="21780"><span data-slate-leaf="true" data-offset-key="21780:0" data-first-offset="true"><span data-slate-string="true"> 函数创建命令框架。 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21781"><span data-slate-object="text" data-key="21782"><span data-slate-leaf="true" data-offset-key="21782:0" data-first-offset="true"><span data-slate-string="true">NewCmdXyz</span></span></span></span><span data-slate-object="text" data-key="21783"><span data-slate-leaf="true" data-offset-key="21783:0" data-first-offset="true"><span data-slate-string="true"> 函数通过创建一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21784"><span data-slate-object="text" data-key="21785"><span data-slate-leaf="true" data-offset-key="21785:0" data-first-offset="true"><span data-slate-string="true">cobra.Command</span></span></span></span><span data-slate-object="text" data-key="21786"><span data-slate-leaf="true" data-offset-key="21786:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量来创建命令；通过指定 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21787"><span data-slate-object="text" data-key="21788"><span data-slate-leaf="true" data-offset-key="21788:0" data-first-offset="true"><span data-slate-string="true">cobra.Command</span></span></span></span><span data-slate-object="text" data-key="21789"><span data-slate-leaf="true" data-offset-key="21789:0" data-first-offset="true"><span data-slate-string="true"> 结构体类型的 Short、Long、Example 字段，来指定该命令的使用文档</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21790"><span data-slate-object="text" data-key="21791"><span data-slate-leaf="true" data-offset-key="21791:0" data-first-offset="true"><span data-slate-string="true"> iamctl -h</span></span></span></span><span data-slate-object="text" data-key="21792"><span data-slate-leaf="true" data-offset-key="21792:0" data-first-offset="true"><span data-slate-string="true"> 、详细使用文档</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21793"><span data-slate-object="text" data-key="21794"><span data-slate-leaf="true" data-offset-key="21794:0" data-first-offset="true"><span data-slate-string="true"> iamctl xyz -h</span></span></span></span><span data-slate-object="text" data-key="21795"><span data-slate-leaf="true" data-offset-key="21795:0" data-first-offset="true"><span data-slate-string="true"> 和使用示例。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21796"><span data-slate-object="text" data-key="21797"><span data-slate-leaf="true" data-offset-key="21797:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21798"><span data-slate-object="text" data-key="21799"><span data-slate-leaf="true" data-offset-key="21799:0" data-first-offset="true"><span data-slate-string="true">cmd.Flags().XxxxVar</span></span></span></span><span data-slate-object="text" data-key="21800"><span data-slate-leaf="true" data-offset-key="21800:0" data-first-offset="true"><span data-slate-string="true"> 来给该命令添加命令行选项。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21801"><span data-slate-object="text" data-key="21802"><span data-slate-leaf="true" data-offset-key="21802:0" data-first-offset="true"><span data-slate-string="true">为了在不指定命令行参数时，能够按照默认的方式执行命令，可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21803"><span data-slate-object="text" data-key="21804"><span data-slate-leaf="true" data-offset-key="21804:0" data-first-offset="true"><span data-slate-string="true">NewXyzOptions</span></span></span></span><span data-slate-object="text" data-key="21805"><span data-slate-leaf="true" data-offset-key="21805:0" data-first-offset="true"><span data-slate-string="true"> 函数返回一个设置了默认选项的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21806"><span data-slate-object="text" data-key="21807"><span data-slate-leaf="true" data-offset-key="21807:0" data-first-offset="true"><span data-slate-string="true">XyzOptions</span></span></span></span><span data-slate-object="text" data-key="21808"><span data-slate-leaf="true" data-offset-key="21808:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21809"><span data-slate-type="code" data-slate-object="inline" data-key="21810"><span data-slate-object="text" data-key="21811"><span data-slate-leaf="true" data-offset-key="21811:0" data-first-offset="true"><span data-slate-string="true">XyzOptions</span></span></span></span><span data-slate-object="text" data-key="21812"><span data-slate-leaf="true" data-offset-key="21812:0" data-first-offset="true"><span data-slate-string="true"> 选项具有 Complete 、Validate 和 Run 三个方法，分别完成选项补全、选项验证和命令执行。命令的执行逻辑可以在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21813"><span data-slate-object="text" data-key="21814"><span data-slate-leaf="true" data-offset-key="21814:0" data-first-offset="true"><span data-slate-string="true">func (o *XyzOptions) Run(args []string) error</span></span></span></span><span data-slate-object="text" data-key="21815"><span data-slate-leaf="true" data-offset-key="21815:0" data-first-offset="true"><span data-slate-string="true"> 函数中编写。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21816"><span data-slate-object="text" data-key="21817"><span data-slate-leaf="true" data-offset-key="21817:0" data-first-offset="true"><span data-slate-string="true">按相同的方式去构建命令，抽象成一个通用模型，这种方式有下面四个好处。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="21818"><div data-slate-type="list-line" data-slate-object="block" data-key="21819"><span data-slate-object="text" data-key="21820"><span data-slate-leaf="true" data-offset-key="21820:0" data-first-offset="true"><span data-slate-string="true">减少理解成本：理解一个命令的构建方式，就可以理解其他命令的构建方式。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21821"><span data-slate-object="text" data-key="21822"><span data-slate-leaf="true" data-offset-key="21822:0" data-first-offset="true"><span data-slate-string="true">提高新命令的开发效率：可以复用其他命令的开发框架，新命令只需填写业务逻辑即可。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21823"><span data-slate-object="text" data-key="21824"><span data-slate-leaf="true" data-offset-key="21824:0" data-first-offset="true"><span data-slate-string="true">自动生成命令：可以按照规定的命令模型，自动生成新的命令。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="21825"><span data-slate-object="text" data-key="21826"><span data-slate-leaf="true" data-offset-key="21826:0" data-first-offset="true"><span data-slate-string="true">易维护：因为所有的命令都来自于同一个命令模型，所以可以保持一致的代码风格，方便后期维护。</span></span></span></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="21827" id="sr-toc-10"><span data-slate-object="text" data-key="21828"><span data-slate-leaf="true" data-offset-key="21828:0" data-first-offset="true"><span data-slate-string="true">自动生成命令</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="21829"><span data-slate-object="text" data-key="21830"><span data-slate-leaf="true" data-offset-key="21830:0" data-first-offset="true"><span data-slate-string="true">上面讲到，自动生成命令模型的好处之一是可以自动生成命令，下面让我们来具体看下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21831"><span data-slate-object="text" data-key="21832"><span data-slate-leaf="true" data-offset-key="21832:0" data-first-offset="true"><span data-slate-string="true">iamctl 自带了命令生成工具，下面我们看看生成方法，一共可以分成 5 步。这里假设生成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21833"><span data-slate-object="text" data-key="21834"><span data-slate-leaf="true" data-offset-key="21834:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21835"><span data-slate-leaf="true" data-offset-key="21835:0" data-first-offset="true"><span data-slate-string="true"> 命令。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21836"><span data-slate-object="text" data-key="21837"><span data-slate-leaf="true" data-offset-key="21837:0" data-first-offset="true"><span data-slate-string="true">第一步，新建一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21838"><span data-slate-object="text" data-key="21839"><span data-slate-leaf="true" data-offset-key="21839:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21840"><span data-slate-leaf="true" data-offset-key="21840:0" data-first-offset="true"><span data-slate-string="true"> 目录，用来存放 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21841"><span data-slate-object="text" data-key="21842"><span data-slate-leaf="true" data-offset-key="21842:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21843"><span data-slate-leaf="true" data-offset-key="21843:0" data-first-offset="true"><span data-slate-string="true"> 命令源码：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21844"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21845"><span data-slate-object="text" data-key="21846"><span data-slate-leaf="true" data-offset-key="21846:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="21847"><span data-slate-leaf="true" data-offset-key="21847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="21848"><span data-slate-leaf="true" data-offset-key="21848:0" data-first-offset="true"><span data-slate-string="true"> internal/iamctl/cmd/xyz</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21849"><span data-slate-object="text" data-key="21850"><span data-slate-leaf="true" data-offset-key="21850:0" data-first-offset="true"><span data-slate-string="true">第二步，在 xyz 目录下，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21851"><span data-slate-object="text" data-key="21852"><span data-slate-leaf="true" data-offset-key="21852:0" data-first-offset="true"><span data-slate-string="true">iamctl new</span></span></span></span><span data-slate-object="text" data-key="21853"><span data-slate-leaf="true" data-offset-key="21853:0" data-first-offset="true"><span data-slate-string="true"> 命令生成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21854"><span data-slate-object="text" data-key="21855"><span data-slate-leaf="true" data-offset-key="21855:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21856"><span data-slate-leaf="true" data-offset-key="21856:0" data-first-offset="true"><span data-slate-string="true"> 命令源码：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21857"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21858"><span data-slate-object="text" data-key="21859"><span data-slate-leaf="true" data-offset-key="21859:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="21860"><span data-slate-leaf="true" data-offset-key="21860:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cd</span></span></span></span><span data-slate-object="text" data-key="21861"><span data-slate-leaf="true" data-offset-key="21861:0" data-first-offset="true"><span data-slate-string="true"> internal/iamctl/cmd/xyz/</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21862"><span data-slate-object="text" data-key="21863"><span data-slate-leaf="true" data-offset-key="21863:0" data-first-offset="true"><span data-slate-string="true">$ iamctl new xyz</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21864"><span data-slate-object="text" data-key="21865"><span data-slate-leaf="true" data-offset-key="21865:0" data-first-offset="true"><span data-slate-string="true">Command file generated: xyz.go</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21866"><span data-slate-object="text" data-key="21867"><span data-slate-leaf="true" data-offset-key="21867:0" data-first-offset="true"><span data-slate-string="true">第三步，将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21868"><span data-slate-object="text" data-key="21869"><span data-slate-leaf="true" data-offset-key="21869:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21870"><span data-slate-leaf="true" data-offset-key="21870:0" data-first-offset="true"><span data-slate-string="true">  命令添加到 root 命令中，假设 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21871"><span data-slate-object="text" data-key="21872"><span data-slate-leaf="true" data-offset-key="21872:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21873"><span data-slate-leaf="true" data-offset-key="21873:0" data-first-offset="true"><span data-slate-string="true"> 属于 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21874"><span data-slate-object="text" data-key="21875"><span data-slate-leaf="true" data-offset-key="21875:0" data-first-offset="true"><span data-slate-string="true">Settings Commands</span></span></span></span><span data-slate-object="text" data-key="21876"><span data-slate-leaf="true" data-offset-key="21876:0" data-first-offset="true"><span data-slate-string="true"> 命令分组。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21877"><span data-slate-object="text" data-key="21878"><span data-slate-leaf="true" data-offset-key="21878:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21879"><span data-slate-object="text" data-key="21880"><span data-slate-leaf="true" data-offset-key="21880:0" data-first-offset="true"><span data-slate-string="true">NewIAMCtlCommand</span></span></span></span><span data-slate-object="text" data-key="21881"><span data-slate-leaf="true" data-offset-key="21881:0" data-first-offset="true"><span data-slate-string="true"> 函数中，找到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21882"><span data-slate-object="text" data-key="21883"><span data-slate-leaf="true" data-offset-key="21883:0" data-first-offset="true"><span data-slate-string="true">Settings Commands</span></span></span></span><span data-slate-object="text" data-key="21884"><span data-slate-leaf="true" data-offset-key="21884:0" data-first-offset="true"><span data-slate-string="true"> 分组，将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21885"><span data-slate-object="text" data-key="21886"><span data-slate-leaf="true" data-offset-key="21886:0" data-first-offset="true"><span data-slate-string="true">NewCmdXyz</span></span></span></span><span data-slate-object="text" data-key="21887"><span data-slate-leaf="true" data-offset-key="21887:0" data-first-offset="true"><span data-slate-string="true"> 追加到 Commands 数组后面：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="21888"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21889"><span data-slate-object="text" data-key="21890"><span data-slate-leaf="true" data-offset-key="21890:0" data-first-offset="true"><span data-slate-string="true">       {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21891"><span data-slate-object="text" data-key="21892"><span data-slate-leaf="true" data-offset-key="21892:0" data-first-offset="true"><span data-slate-string="true">            Message: </span></span></span><span data-slate-object="text" data-key="21893"><span data-slate-leaf="true" data-offset-key="21893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Settings Commands:"</span></span></span></span><span data-slate-object="text" data-key="21894"><span data-slate-leaf="true" data-offset-key="21894:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21895"><span data-slate-object="text" data-key="21896"><span data-slate-leaf="true" data-offset-key="21896:0" data-first-offset="true"><span data-slate-string="true">            Commands: []*cobra.Command{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21897"><span data-slate-object="text" data-key="21898"><span data-slate-leaf="true" data-offset-key="21898:0" data-first-offset="true"><span data-slate-string="true">                set.NewCmdSet(f, ioStreams),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21899"><span data-slate-object="text" data-key="21900"><span data-slate-leaf="true" data-offset-key="21900:0" data-first-offset="true"><span data-slate-string="true">                completion.NewCmdCompletion(ioStreams.Out, </span></span></span><span data-slate-object="text" data-key="21901"><span data-slate-leaf="true" data-offset-key="21901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="21902"><span data-slate-leaf="true" data-offset-key="21902:0" data-first-offset="true"><span data-slate-string="true">),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21903"><span data-slate-object="text" data-key="21904"><span data-slate-leaf="true" data-offset-key="21904:0" data-first-offset="true"><span data-slate-string="true">                xyz.NewCmdXyz(f, ioStreams),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21905"><span data-slate-object="text" data-key="21906"><span data-slate-leaf="true" data-offset-key="21906:0" data-first-offset="true"><span data-slate-string="true">            },</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21907"><span data-slate-object="text" data-key="21908"><span data-slate-leaf="true" data-offset-key="21908:0" data-first-offset="true"><span data-slate-string="true">        }, </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21909"><span data-slate-object="text" data-key="21910"><span data-slate-leaf="true" data-offset-key="21910:0" data-first-offset="true"><span data-slate-string="true">第四步，编译 iamctl：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21911"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21912"><span data-slate-object="text" data-key="21913"><span data-slate-leaf="true" data-offset-key="21913:0" data-first-offset="true"><span data-slate-string="true">$ make build BINS=iamctl  </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21914"><span data-slate-object="text" data-key="21915"><span data-slate-leaf="true" data-offset-key="21915:0" data-first-offset="true"><span data-slate-string="true">第五步，测试：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="21916"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="21917"><span data-slate-object="text" data-key="21918"><span data-slate-leaf="true" data-offset-key="21918:0" data-first-offset="true"><span data-slate-string="true">$ iamctl xyz -h</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21919"><span data-slate-object="text" data-key="21920"><span data-slate-leaf="true" data-offset-key="21920:0" data-first-offset="true"><span data-slate-string="true">A longer description that spans multiple lines and likely contains examples and usage of using your </span></span></span><span data-slate-object="text" data-key="21921"><span data-slate-leaf="true" data-offset-key="21921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">command</span></span></span></span><span data-slate-object="text" data-key="21922"><span data-slate-leaf="true" data-offset-key="21922:0" data-first-offset="true"><span data-slate-string="true">. For</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21923"><span data-slate-object="text" data-key="21924"><span data-slate-leaf="true" data-offset-key="21924:0" data-first-offset="true"><span data-slate-string="true">example:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21925"><span data-slate-object="text" data-key="21926"><span data-slate-leaf="true" data-offset-key="21926:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21927"><span data-slate-object="text" data-key="21928"><span data-slate-leaf="true" data-offset-key="21928:0" data-first-offset="true"><span data-slate-string="true"> Cobra is a CLI library </span></span></span><span data-slate-object="text" data-key="21929"><span data-slate-leaf="true" data-offset-key="21929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21930"><span data-slate-leaf="true" data-offset-key="21930:0" data-first-offset="true"><span data-slate-string="true"> Go that empowers applications. This application is a tool to generate the needed files to</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21931"><span data-slate-object="text" data-key="21932"><span data-slate-leaf="true" data-offset-key="21932:0" data-first-offset="true"><span data-slate-string="true">quickly create a Cobra application.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21933"><span data-slate-object="text" data-key="21934"><span data-slate-leaf="true" data-offset-key="21934:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21935"><span data-slate-object="text" data-key="21936"><span data-slate-leaf="true" data-offset-key="21936:0" data-first-offset="true"><span data-slate-string="true">Examples:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21937"><span data-slate-object="text" data-key="21938"><span data-slate-leaf="true" data-offset-key="21938:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="21939"><span data-slate-leaf="true" data-offset-key="21939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># Print all option values for xyz</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21940"><span data-slate-object="text" data-key="21941"><span data-slate-leaf="true" data-offset-key="21941:0" data-first-offset="true"><span data-slate-string="true">  iamctl xyz marmotedu marmotedupass</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21942"><span data-slate-object="text" data-key="21943"><span data-slate-leaf="true" data-offset-key="21943:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21944"><span data-slate-object="text" data-key="21945"><span data-slate-leaf="true" data-offset-key="21945:0" data-first-offset="true"><span data-slate-string="true">Options:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21946"><span data-slate-object="text" data-key="21947"><span data-slate-leaf="true" data-offset-key="21947:0" data-first-offset="true"><span data-slate-string="true">  -b, --bool=</span></span></span><span data-slate-object="text" data-key="21948"><span data-slate-leaf="true" data-offset-key="21948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="21949"><span data-slate-leaf="true" data-offset-key="21949:0" data-first-offset="true"><span data-slate-string="true">: Bool option.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21950"><span data-slate-object="text" data-key="21951"><span data-slate-leaf="true" data-offset-key="21951:0" data-first-offset="true"><span data-slate-string="true">  -i, --int=0: Int option.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21952"><span data-slate-object="text" data-key="21953"><span data-slate-leaf="true" data-offset-key="21953:0" data-first-offset="true"><span data-slate-string="true">      --slice=[]: String slice option.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21954"><span data-slate-object="text" data-key="21955"><span data-slate-leaf="true" data-offset-key="21955:0" data-first-offset="true"><span data-slate-string="true">      --string=</span></span></span><span data-slate-object="text" data-key="21956"><span data-slate-leaf="true" data-offset-key="21956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'default'</span></span></span></span><span data-slate-object="text" data-key="21957"><span data-slate-leaf="true" data-offset-key="21957:0" data-first-offset="true"><span data-slate-string="true">: String option.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21958"><span data-slate-object="text" data-key="21959"><span data-slate-leaf="true" data-offset-key="21959:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21960"><span data-slate-object="text" data-key="21961"><span data-slate-leaf="true" data-offset-key="21961:0" data-first-offset="true"><span data-slate-string="true">Usage:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21962"><span data-slate-object="text" data-key="21963"><span data-slate-leaf="true" data-offset-key="21963:0" data-first-offset="true"><span data-slate-string="true">  iamctl xyz USERNAME PASSWORD [options]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21964"><span data-slate-object="text" data-key="21965"><span data-slate-leaf="true" data-offset-key="21965:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21966"><span data-slate-object="text" data-key="21967"><span data-slate-leaf="true" data-offset-key="21967:0" data-first-offset="true"><span data-slate-string="true">Use </span></span></span><span data-slate-object="text" data-key="21968"><span data-slate-leaf="true" data-offset-key="21968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iamctl options"</span></span></span></span><span data-slate-object="text" data-key="21969"><span data-slate-leaf="true" data-offset-key="21969:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="21970"><span data-slate-leaf="true" data-offset-key="21970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="21971"><span data-slate-leaf="true" data-offset-key="21971:0" data-first-offset="true"><span data-slate-string="true"> a list of global command-line options (applies to all commands).</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21972"><span data-slate-object="text" data-key="21973"><span data-slate-leaf="true" data-offset-key="21973:0" data-first-offset="true"><span data-slate-string="true">$ iamctl xyz marmotedu marmotedupass</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21974"><span data-slate-object="text" data-key="21975"><span data-slate-leaf="true" data-offset-key="21975:0" data-first-offset="true"><span data-slate-string="true">The following is option values:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21976"><span data-slate-object="text" data-key="21977"><span data-slate-leaf="true" data-offset-key="21977:0" data-first-offset="true"><span data-slate-string="true">==&gt; --string: default(complete)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21978"><span data-slate-object="text" data-key="21979"><span data-slate-leaf="true" data-offset-key="21979:0" data-first-offset="true"><span data-slate-string="true">==&gt; --slice: []</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21980"><span data-slate-object="text" data-key="21981"><span data-slate-leaf="true" data-offset-key="21981:0" data-first-offset="true"><span data-slate-string="true">==&gt; --int: 0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21982"><span data-slate-object="text" data-key="21983"><span data-slate-leaf="true" data-offset-key="21983:0" data-first-offset="true"><span data-slate-string="true">==&gt; --bool: </span></span></span><span data-slate-object="text" data-key="21984"><span data-slate-leaf="true" data-offset-key="21984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21985"><span data-slate-object="text" data-key="21986"><span data-slate-leaf="true" data-offset-key="21986:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21987"><span data-slate-object="text" data-key="21988"><span data-slate-leaf="true" data-offset-key="21988:0" data-first-offset="true"><span data-slate-string="true">The following is args values:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21989"><span data-slate-object="text" data-key="21990"><span data-slate-leaf="true" data-offset-key="21990:0" data-first-offset="true"><span data-slate-string="true">==&gt; username: marmotedu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="21991"><span data-slate-object="text" data-key="21992"><span data-slate-leaf="true" data-offset-key="21992:0" data-first-offset="true"><span data-slate-string="true">==&gt; password: marmotedupass</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="21993"><span data-slate-object="text" data-key="21994"><span data-slate-leaf="true" data-offset-key="21994:0" data-first-offset="true"><span data-slate-string="true">你可以看到，经过短短的几步，就添加了一个新的命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21995"><span data-slate-object="text" data-key="21996"><span data-slate-leaf="true" data-offset-key="21996:0" data-first-offset="true"><span data-slate-string="true">xyz</span></span></span></span><span data-slate-object="text" data-key="21997"><span data-slate-leaf="true" data-offset-key="21997:0" data-first-offset="true"><span data-slate-string="true"> 。 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="21998"><span data-slate-object="text" data-key="21999"><span data-slate-leaf="true" data-offset-key="21999:0" data-first-offset="true"><span data-slate-string="true">iamctl new</span></span></span></span><span data-slate-object="text" data-key="22000"><span data-slate-leaf="true" data-offset-key="22000:0" data-first-offset="true"><span data-slate-string="true"> 命令不仅可以生成不带子命令的命令，还可以生成带有子命令的命令，生成方式如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="22001"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22002"><span data-slate-object="text" data-key="22003"><span data-slate-leaf="true" data-offset-key="22003:0" data-first-offset="true"><span data-slate-string="true">$ iamctl new -g xyz</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22004"><span data-slate-object="text" data-key="22005"><span data-slate-leaf="true" data-offset-key="22005:0" data-first-offset="true"><span data-slate-string="true">Command file generated: xyz.go</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22006"><span data-slate-object="text" data-key="22007"><span data-slate-leaf="true" data-offset-key="22007:0" data-first-offset="true"><span data-slate-string="true">Command file generated: xyz_subcmd1.go</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22008"><span data-slate-object="text" data-key="22009"><span data-slate-leaf="true" data-offset-key="22009:0" data-first-offset="true"><span data-slate-string="true">Command file generated: xyz_subcmd2.go</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="22010" id="sr-toc-11"><span data-slate-object="text" data-key="22011"><span data-slate-leaf="true" data-offset-key="22011:0" data-first-offset="true"><span data-slate-string="true">命令自动补全</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="22012"><span data-slate-object="text" data-key="22013"><span data-slate-leaf="true" data-offset-key="22013:0" data-first-offset="true"><span data-slate-string="true">cobra 会根据注册的命令自动生成补全脚本，可以补全父命令、子命令和选项参数。在 bash 下，可以按下面的方式配置自动补全功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22014"><span data-slate-object="text" data-key="22015"><span data-slate-leaf="true" data-offset-key="22015:0" data-first-offset="true"><span data-slate-string="true">第一步，生成自动补全脚本：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="22016"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22017"><span data-slate-object="text" data-key="22018"><span data-slate-leaf="true" data-offset-key="22018:0" data-first-offset="true"><span data-slate-string="true">$ iamctl completion bash &gt; ~/.iam/completion.bash.inc</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22019"><span data-slate-object="text" data-key="22020"><span data-slate-leaf="true" data-offset-key="22020:0" data-first-offset="true"><span data-slate-string="true">第二步，登陆时加载 bash，自动补全脚本：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="22021"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22022"><span data-slate-object="text" data-key="22023"><span data-slate-leaf="true" data-offset-key="22023:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="22024"><span data-slate-leaf="true" data-offset-key="22024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">echo</span></span></span></span><span data-slate-object="text" data-key="22025"><span data-slate-leaf="true" data-offset-key="22025:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="22026"><span data-slate-leaf="true" data-offset-key="22026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"source'</span></span></span></span><span data-slate-object="text" data-key="22027"><span data-slate-leaf="true" data-offset-key="22027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span></span><span data-slate-object="text" data-key="22028"><span data-slate-leaf="true" data-offset-key="22028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/.iam/completion.bash.inc'"</span></span></span></span><span data-slate-object="text" data-key="22029"><span data-slate-leaf="true" data-offset-key="22029:0" data-first-offset="true"><span data-slate-string="true"> &gt;&gt; </span></span></span><span data-slate-object="text" data-key="22030"><span data-slate-leaf="true" data-offset-key="22030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="22031"><span data-slate-leaf="true" data-offset-key="22031:0" data-first-offset="true"><span data-slate-string="true">/.bash_profile</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22032"><span data-slate-object="text" data-key="22033"><span data-slate-leaf="true" data-offset-key="22033:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="22034"><span data-slate-leaf="true" data-offset-key="22034:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">source</span></span></span></span><span data-slate-object="text" data-key="22035"><span data-slate-leaf="true" data-offset-key="22035:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="22036"><span data-slate-leaf="true" data-offset-key="22036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="22037"><span data-slate-leaf="true" data-offset-key="22037:0" data-first-offset="true"><span data-slate-string="true">/.bash_profile</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22038"><span data-slate-object="text" data-key="22039"><span data-slate-leaf="true" data-offset-key="22039:0" data-first-offset="true"><span data-slate-string="true">第三步，测试自动补全功能：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="22040"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22041"><span data-slate-object="text" data-key="22042"><span data-slate-leaf="true" data-offset-key="22042:0" data-first-offset="true"><span data-slate-string="true">$ iamctl xy&lt;TAB&gt; </span></span></span><span data-slate-object="text" data-key="22043"><span data-slate-leaf="true" data-offset-key="22043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 按 TAB 键，自动补全为：iamctl xyz</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22044"><span data-slate-object="text" data-key="22045"><span data-slate-leaf="true" data-offset-key="22045:0" data-first-offset="true"><span data-slate-string="true">$ iamctl xyz --b&lt;TAB&gt; </span></span></span><span data-slate-object="text" data-key="22046"><span data-slate-leaf="true" data-offset-key="22046:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 按 TAB 键，自动补全为：iamctl xyz --bool</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="22047" id="sr-toc-12"><span data-slate-object="text" data-key="22048"><span data-slate-leaf="true" data-offset-key="22048:0" data-first-offset="true"><span data-slate-string="true">更友好的输出</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="22049"><span data-slate-object="text" data-key="22050"><span data-slate-leaf="true" data-offset-key="22050:0" data-first-offset="true"><span data-slate-string="true">在开发命令时，可以通过一些技巧来提高使用体验。我经常会在输出中打印一些彩色输出，或者将一些输出以表格的形式输出，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="22051"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/74/42/74ef80708c853c20811e1e7bed7bde42.png?wh=651x226"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22052"><span data-slate-object="text" data-key="22053"><span data-slate-leaf="true" data-offset-key="22053:0" data-first-offset="true"><span data-slate-string="true">这里，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22054"><span data-slate-object="text" data-key="22055"><span data-slate-leaf="true" data-offset-key="22055:0" data-first-offset="true"><span data-slate-string="true">github.com/olekukonko/tablewriter</span></span></span></span><span data-slate-object="text" data-key="22056"><span data-slate-leaf="true" data-offset-key="22056:0" data-first-offset="true"><span data-slate-string="true"> 包来实现表格功能，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22057"><span data-slate-object="text" data-key="22058"><span data-slate-leaf="true" data-offset-key="22058:0" data-first-offset="true"><span data-slate-string="true">github.com/fatih/color</span></span></span></span><span data-slate-object="text" data-key="22059"><span data-slate-leaf="true" data-offset-key="22059:0" data-first-offset="true"><span data-slate-string="true"> 包来打印带色彩的字符串。具体使用方法，你可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22060"><span data-slate-object="text" data-key="22061"><span data-slate-leaf="true" data-offset-key="22061:0" data-first-offset="true"><span data-slate-string="true">internal/iamctl/cmd/validate/validate.go</span></span></span></a><span data-slate-object="text" data-key="22062"><span data-slate-leaf="true" data-offset-key="22062:0" data-first-offset="true"><span data-slate-string="true"> 文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22063"><span data-slate-type="code" data-slate-object="inline" data-key="22064"><span data-slate-object="text" data-key="22065"><span data-slate-leaf="true" data-offset-key="22065:0" data-first-offset="true"><span data-slate-string="true">github.com/fatih/color</span></span></span></span><span data-slate-object="text" data-key="22066"><span data-slate-leaf="true" data-offset-key="22066:0" data-first-offset="true"><span data-slate-string="true"> 包可以给字符串标示颜色，字符串和颜色的对应关系可通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22067"><span data-slate-object="text" data-key="22068"><span data-slate-leaf="true" data-offset-key="22068:0" data-first-offset="true"><span data-slate-string="true">iamctl color</span></span></span></span><span data-slate-object="text" data-key="22069"><span data-slate-leaf="true" data-offset-key="22069:0" data-first-offset="true"><span data-slate-string="true"> 来查看，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="22070"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/47/b9/47593869e1b10b15a35e16c661d818b9.png?wh=991x672"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="22071" id="sr-toc-13"><span data-slate-object="text" data-key="22072"><span data-slate-leaf="true" data-offset-key="22072:0" data-first-offset="true"><span data-slate-string="true">iamctl 是如何进行 API 调用的？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="22073"><span data-slate-object="text" data-key="22074"><span data-slate-leaf="true" data-offset-key="22074:0" data-first-offset="true"><span data-slate-string="true">上面我介绍了 iamctl 命令的构建方式，那么这里我们再来看下 iamctl 是如何请求服务端 API 接口的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22075"><span data-slate-object="text" data-key="22076"><span data-slate-leaf="true" data-offset-key="22076:0" data-first-offset="true"><span data-slate-string="true">Go 后端服务的功能通常通过 API 接口来对外暴露，一个后端服务可能供很多个终端使用，比如浏览器、命令行工具、手机等。为了保持功能的一致性，这些终端都会调用同一套 API 来完成相同的功能，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="22077"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/fb/bb/fb6de4f63454dd6471e023d73b8548bb.jpg?wh=1920x742"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22078"><span data-slate-object="text" data-key="22079"><span data-slate-leaf="true" data-offset-key="22079:0" data-first-offset="true"><span data-slate-string="true">如果命令行工具需要用到后端服务的功能，也需要通过 API 调用的方式。理想情况下，Go 后端服务对外暴露的所有 API 功能，都可以通过命令行工具来完成。一个 API 接口对应一个命令，API 接口的参数映射到命令的参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22080"><span data-slate-object="text" data-key="22081"><span data-slate-leaf="true" data-offset-key="22081:0" data-first-offset="true"><span data-slate-string="true">要调用服务端的 API 接口，最便捷的方法是通过 SDK 来调用，对于一些没有实现 SDK 的接口，也可以直接调用。所以，在命令行工具中，需要支持以下两种调用方式：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="22082"><div data-slate-type="list-line" data-slate-object="block" data-key="22083"><span data-slate-object="text" data-key="22084"><span data-slate-leaf="true" data-offset-key="22084:0" data-first-offset="true"><span data-slate-string="true">通过 SDK 调用服务端 API 接口。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="22085"><span data-slate-object="text" data-key="22086"><span data-slate-leaf="true" data-offset-key="22086:0" data-first-offset="true"><span data-slate-string="true">直接调用服务端的 API 接口（本专栏是 REST API 接口）。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22087"><span data-slate-object="text" data-key="22088"><span data-slate-leaf="true" data-offset-key="22088:0" data-first-offset="true"><span data-slate-string="true">iamctl 通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22089"><span data-slate-object="text" data-key="22090"><span data-slate-leaf="true" data-offset-key="22090:0" data-first-offset="true"><span data-slate-string="true">cmdutil.NewFactory</span></span></span></a><span data-slate-object="text" data-key="22091"><span data-slate-leaf="true" data-offset-key="22091:0" data-first-offset="true"><span data-slate-string="true"> 创建一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22092"><span data-slate-object="text" data-key="22093"><span data-slate-leaf="true" data-offset-key="22093:0" data-first-offset="true"><span data-slate-string="true">Factory</span></span></span></span><span data-slate-object="text" data-key="22094"><span data-slate-leaf="true" data-offset-key="22094:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22095"><span data-slate-object="text" data-key="22096"><span data-slate-leaf="true" data-offset-key="22096:0" data-first-offset="true"><span data-slate-string="true">f</span></span></span></span><span data-slate-object="text" data-key="22097"><span data-slate-leaf="true" data-offset-key="22097:0" data-first-offset="true"><span data-slate-string="true"> ， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22098"><span data-slate-object="text" data-key="22099"><span data-slate-leaf="true" data-offset-key="22099:0" data-first-offset="true"><span data-slate-string="true">Factory</span></span></span></span><span data-slate-object="text" data-key="22100"><span data-slate-leaf="true" data-offset-key="22100:0" data-first-offset="true"><span data-slate-string="true"> 定义为：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22101"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22102"><span data-slate-object="text" data-key="22103"><span data-slate-leaf="true" data-offset-key="22103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="22104"><span data-slate-leaf="true" data-offset-key="22104:0" data-first-offset="true"><span data-slate-string="true"> Factory </span></span></span><span data-slate-object="text" data-key="22105"><span data-slate-leaf="true" data-offset-key="22105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="22106"><span data-slate-leaf="true" data-offset-key="22106:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22107"><span data-slate-object="text" data-key="22108"><span data-slate-leaf="true" data-offset-key="22108:0" data-first-offset="true"><span data-slate-string="true">    genericclioptions.RESTClientGetter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22109"><span data-slate-object="text" data-key="22110"><span data-slate-leaf="true" data-offset-key="22110:0" data-first-offset="true"><span data-slate-string="true">    IAMClientSet() (*marmotedu.Clientset, </span></span></span><span data-slate-object="text" data-key="22111"><span data-slate-leaf="true" data-offset-key="22111:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="22112"><span data-slate-leaf="true" data-offset-key="22112:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22113"><span data-slate-object="text" data-key="22114"><span data-slate-leaf="true" data-offset-key="22114:0" data-first-offset="true"><span data-slate-string="true">    RESTClient() (*restclient.RESTClient, </span></span></span><span data-slate-object="text" data-key="22115"><span data-slate-leaf="true" data-offset-key="22115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="22116"><span data-slate-leaf="true" data-offset-key="22116:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22117"><span data-slate-object="text" data-key="22118"><span data-slate-leaf="true" data-offset-key="22118:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22119"><span data-slate-object="text" data-key="22120"><span data-slate-leaf="true" data-offset-key="22120:0" data-first-offset="true"><span data-slate-string="true">将变量 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22121"><span data-slate-object="text" data-key="22122"><span data-slate-leaf="true" data-offset-key="22122:0" data-first-offset="true"><span data-slate-string="true">f</span></span></span></span><span data-slate-object="text" data-key="22123"><span data-slate-leaf="true" data-offset-key="22123:0" data-first-offset="true"><span data-slate-string="true"> 传入到命令中，在命令中使用 Factory 接口提供的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22124"><span data-slate-object="text" data-key="22125"><span data-slate-leaf="true" data-offset-key="22125:0" data-first-offset="true"><span data-slate-string="true">RESTClient()</span></span></span></span><span data-slate-object="text" data-key="22126"><span data-slate-leaf="true" data-offset-key="22126:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22127"><span data-slate-object="text" data-key="22128"><span data-slate-leaf="true" data-offset-key="22128:0" data-first-offset="true"><span data-slate-string="true">IAMClientSet()</span></span></span></span><span data-slate-object="text" data-key="22129"><span data-slate-leaf="true" data-offset-key="22129:0" data-first-offset="true"><span data-slate-string="true"> 方法，分别返回 RESTful API 客户端和 SDK 客户端，从而使用客户端提供的接口函数。代码可参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22130"><span data-slate-object="text" data-key="22131"><span data-slate-leaf="true" data-offset-key="22131:0" data-first-offset="true"><span data-slate-string="true">internal/iamctl/cmd/version/version.go</span></span></span></a><span data-slate-object="text" data-key="22132"><span data-slate-leaf="true" data-offset-key="22132:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="22133" id="sr-toc-14"><span data-slate-object="text" data-key="22134"><span data-slate-leaf="true" data-offset-key="22134:0" data-first-offset="true"><span data-slate-string="true">客户端配置文件</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="22135"><span data-slate-object="text" data-key="22136"><span data-slate-leaf="true" data-offset-key="22136:0" data-first-offset="true"><span data-slate-string="true">如果要创建 RESTful API 客户端和 SDK 的客户端，需要调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22137"><span data-slate-object="text" data-key="22138"><span data-slate-leaf="true" data-offset-key="22138:0" data-first-offset="true"><span data-slate-string="true">f.ToRESTConfig()</span></span></span></span><span data-slate-object="text" data-key="22139"><span data-slate-leaf="true" data-offset-key="22139:0" data-first-offset="true"><span data-slate-string="true"> 函数返回 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22140"><span data-slate-object="text" data-key="22141"><span data-slate-leaf="true" data-offset-key="22141:0" data-first-offset="true"><span data-slate-string="true">*github.com/marmotedu/marmotedu-sdk-go/rest.Config</span></span></span></span><span data-slate-object="text" data-key="22142"><span data-slate-leaf="true" data-offset-key="22142:0" data-first-offset="true"><span data-slate-string="true"> 类型的配置变量，然后再基于 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22143"><span data-slate-object="text" data-key="22144"><span data-slate-leaf="true" data-offset-key="22144:0" data-first-offset="true"><span data-slate-string="true">rest.Config</span></span></span></span><span data-slate-object="text" data-key="22145"><span data-slate-leaf="true" data-offset-key="22145:0" data-first-offset="true"><span data-slate-string="true"> 类型的配置变量创建客户端。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22146"><span data-slate-type="code" data-slate-object="inline" data-key="22147"><span data-slate-object="text" data-key="22148"><span data-slate-leaf="true" data-offset-key="22148:0" data-first-offset="true"><span data-slate-string="true">f.ToRESTConfig</span></span></span></span><span data-slate-object="text" data-key="22149"><span data-slate-leaf="true" data-offset-key="22149:0" data-first-offset="true"><span data-slate-string="true"> 函数最终是调用 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22150"><span data-slate-object="text" data-key="22151"><span data-slate-leaf="true" data-offset-key="22151:0" data-first-offset="true"><span data-slate-string="true">toRawIAMConfigLoader</span></span></span></a><span data-slate-object="text" data-key="22152"><span data-slate-leaf="true" data-offset-key="22152:0" data-first-offset="true"><span data-slate-string="true"> 函数来生成配置的，代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22153"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22154"><span data-slate-object="text" data-key="22155"><span data-slate-leaf="true" data-offset-key="22155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="22156"><span data-slate-leaf="true" data-offset-key="22156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="22157"><span data-slate-leaf="true" data-offset-key="22157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *ConfigFlags)</span></span></span></span></span><span data-slate-object="text" data-key="22158"><span data-slate-leaf="true" data-offset-key="22158:0" data-first-offset="true"><span data-slate-string="true"> toRawIAMConfigLoader() clientcmd.ClientConfig {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22159"><span data-slate-object="text" data-key="22160"><span data-slate-leaf="true" data-offset-key="22160:0" data-first-offset="true"><span data-slate-string="true">    config := clientcmd.NewConfig()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22161"><span data-slate-object="text" data-key="22162"><span data-slate-leaf="true" data-offset-key="22162:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="22163"><span data-slate-leaf="true" data-offset-key="22163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="22164"><span data-slate-leaf="true" data-offset-key="22164:0" data-first-offset="true"><span data-slate-string="true"> err := viper.Unmarshal(&amp;config); err != </span></span></span><span data-slate-object="text" data-key="22165"><span data-slate-leaf="true" data-offset-key="22165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22166"><span data-slate-leaf="true" data-offset-key="22166:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22167"><span data-slate-object="text" data-key="22168"><span data-slate-leaf="true" data-offset-key="22168:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="22169"><span data-slate-leaf="true" data-offset-key="22169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">panic</span></span></span></span><span data-slate-object="text" data-key="22170"><span data-slate-leaf="true" data-offset-key="22170:0" data-first-offset="true"><span data-slate-string="true">(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22171"><span data-slate-object="text" data-key="22172"><span data-slate-leaf="true" data-offset-key="22172:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22173"></div><div data-slate-type="code-line" data-slate-object="block" data-key="22174"><span data-slate-object="text" data-key="22175"><span data-slate-leaf="true" data-offset-key="22175:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="22176"><span data-slate-leaf="true" data-offset-key="22176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22177"><span data-slate-leaf="true" data-offset-key="22177:0" data-first-offset="true"><span data-slate-string="true"> clientcmd.NewClientConfigFromConfig(config)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22178"><span data-slate-object="text" data-key="22179"><span data-slate-leaf="true" data-offset-key="22179:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22180"><span data-slate-type="code" data-slate-object="inline" data-key="22181"><span data-slate-object="text" data-key="22182"><span data-slate-leaf="true" data-offset-key="22182:0" data-first-offset="true"><span data-slate-string="true">toRawIAMConfigLoader</span></span></span></span><span data-slate-object="text" data-key="22183"><span data-slate-leaf="true" data-offset-key="22183:0" data-first-offset="true"><span data-slate-string="true"> 返回 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22184"><span data-slate-object="text" data-key="22185"><span data-slate-leaf="true" data-offset-key="22185:0" data-first-offset="true"><span data-slate-string="true">clientcmd.ClientConfig</span></span></span></span><span data-slate-object="text" data-key="22186"><span data-slate-leaf="true" data-offset-key="22186:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22187"><span data-slate-object="text" data-key="22188"><span data-slate-leaf="true" data-offset-key="22188:0" data-first-offset="true"><span data-slate-string="true">clientcmd.ClientConfig</span></span></span></span><span data-slate-object="text" data-key="22189"><span data-slate-leaf="true" data-offset-key="22189:0" data-first-offset="true"><span data-slate-string="true"> 类型提供了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22190"><span data-slate-object="text" data-key="22191"><span data-slate-leaf="true" data-offset-key="22191:0" data-first-offset="true"><span data-slate-string="true">ClientConfig</span></span></span></span><span data-slate-object="text" data-key="22192"><span data-slate-leaf="true" data-offset-key="22192:0" data-first-offset="true"><span data-slate-string="true"> 方法，用来返回</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22193"><span data-slate-object="text" data-key="22194"><span data-slate-leaf="true" data-offset-key="22194:0" data-first-offset="true"><span data-slate-string="true"> *rest.Config</span></span></span></span><span data-slate-object="text" data-key="22195"><span data-slate-leaf="true" data-offset-key="22195:0" data-first-offset="true"><span data-slate-string="true"> 类型的变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22196"><span data-slate-object="text" data-key="22197"><span data-slate-leaf="true" data-offset-key="22197:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22198"><span data-slate-object="text" data-key="22199"><span data-slate-leaf="true" data-offset-key="22199:0" data-first-offset="true"><span data-slate-string="true">toRawIAMConfigLoader</span></span></span></span><span data-slate-object="text" data-key="22200"><span data-slate-leaf="true" data-offset-key="22200:0" data-first-offset="true"><span data-slate-string="true"> 函数内部，通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22201"><span data-slate-object="text" data-key="22202"><span data-slate-leaf="true" data-offset-key="22202:0" data-first-offset="true"><span data-slate-string="true">viper.Unmarshal</span></span></span></span><span data-slate-object="text" data-key="22203"><span data-slate-leaf="true" data-offset-key="22203:0" data-first-offset="true"><span data-slate-string="true"> 将 viper 中存储的配置解析到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22204"><span data-slate-object="text" data-key="22205"><span data-slate-leaf="true" data-offset-key="22205:0" data-first-offset="true"><span data-slate-string="true">clientcmd.Config</span></span></span></span><span data-slate-object="text" data-key="22206"><span data-slate-leaf="true" data-offset-key="22206:0" data-first-offset="true"><span data-slate-string="true"> 类型的结构体变量中。viper 中存储的配置，是在 cobra 命令启动时通过 LoadConfig 函数加载的，代码如下（位于 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22207"><span data-slate-object="text" data-key="22208"><span data-slate-leaf="true" data-offset-key="22208:0" data-first-offset="true"><span data-slate-string="true">NewIAMCtlCommand</span></span></span></span><span data-slate-object="text" data-key="22209"><span data-slate-leaf="true" data-offset-key="22209:0" data-first-offset="true"><span data-slate-string="true"> 函数中）：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22210"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22211"><span data-slate-object="text" data-key="22212"><span data-slate-leaf="true" data-offset-key="22212:0" data-first-offset="true"><span data-slate-string="true">cobra.OnInitialize(</span></span></span><span data-slate-object="text" data-key="22213"><span data-slate-leaf="true" data-offset-key="22213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="22214"><span data-slate-leaf="true" data-offset-key="22214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="22215"><span data-slate-leaf="true" data-offset-key="22215:0" data-first-offset="true"><span data-slate-string="true"> {                     </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22216"><span data-slate-object="text" data-key="22217"><span data-slate-leaf="true" data-offset-key="22217:0" data-first-offset="true"><span data-slate-string="true">    genericapiserver.LoadConfig(viper.GetString(genericclioptions.FlagIAMConfig), </span></span></span><span data-slate-object="text" data-key="22218"><span data-slate-leaf="true" data-offset-key="22218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"config"</span></span></span></span><span data-slate-object="text" data-key="22219"><span data-slate-leaf="true" data-offset-key="22219:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22220"><span data-slate-object="text" data-key="22221"><span data-slate-leaf="true" data-offset-key="22221:0" data-first-offset="true"><span data-slate-string="true">}) </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22222"><span data-slate-object="text" data-key="22223"><span data-slate-leaf="true" data-offset-key="22223:0" data-first-offset="true"><span data-slate-string="true">你可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22224"><span data-slate-object="text" data-key="22225"><span data-slate-leaf="true" data-offset-key="22225:0" data-first-offset="true"><span data-slate-string="true">--config</span></span></span></span><span data-slate-object="text" data-key="22226"><span data-slate-leaf="true" data-offset-key="22226:0" data-first-offset="true"><span data-slate-string="true"> 选项，指定配置文件的路径。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="22227" id="sr-toc-15"><span data-slate-object="text" data-key="22228"><span data-slate-leaf="true" data-offset-key="22228:0" data-first-offset="true"><span data-slate-string="true">SDK 调用</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="22229"><span data-slate-object="text" data-key="22230"><span data-slate-leaf="true" data-offset-key="22230:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22231"><span data-slate-object="text" data-key="22232"><span data-slate-leaf="true" data-offset-key="22232:0" data-first-offset="true"><span data-slate-string="true">IAMClient</span></span></span></a><span data-slate-object="text" data-key="22233"><span data-slate-leaf="true" data-offset-key="22233:0" data-first-offset="true"><span data-slate-string="true"> 返回 SDK 客户端，代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22234"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22235"><span data-slate-object="text" data-key="22236"><span data-slate-leaf="true" data-offset-key="22236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="22237"><span data-slate-leaf="true" data-offset-key="22237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="22238"><span data-slate-leaf="true" data-offset-key="22238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *factoryImpl)</span></span></span></span></span><span data-slate-object="text" data-key="22239"><span data-slate-leaf="true" data-offset-key="22239:0" data-first-offset="true"><span data-slate-string="true"> IAMClient() (*iam.IamClient, </span></span></span><span data-slate-object="text" data-key="22240"><span data-slate-leaf="true" data-offset-key="22240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="22241"><span data-slate-leaf="true" data-offset-key="22241:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22242"><span data-slate-object="text" data-key="22243"><span data-slate-leaf="true" data-offset-key="22243:0" data-first-offset="true"><span data-slate-string="true">  clientConfig, err := f.ToRESTConfig()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22244"><span data-slate-object="text" data-key="22245"><span data-slate-leaf="true" data-offset-key="22245:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="22246"><span data-slate-leaf="true" data-offset-key="22246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="22247"><span data-slate-leaf="true" data-offset-key="22247:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="22248"><span data-slate-leaf="true" data-offset-key="22248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22249"><span data-slate-leaf="true" data-offset-key="22249:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22250"><span data-slate-object="text" data-key="22251"><span data-slate-leaf="true" data-offset-key="22251:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="22252"><span data-slate-leaf="true" data-offset-key="22252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22253"><span data-slate-leaf="true" data-offset-key="22253:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="22254"><span data-slate-leaf="true" data-offset-key="22254:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22255"><span data-slate-leaf="true" data-offset-key="22255:0" data-first-offset="true"><span data-slate-string="true">, err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22256"><span data-slate-object="text" data-key="22257"><span data-slate-leaf="true" data-offset-key="22257:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22258"><span data-slate-object="text" data-key="22259"><span data-slate-leaf="true" data-offset-key="22259:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="22260"><span data-slate-leaf="true" data-offset-key="22260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22261"><span data-slate-leaf="true" data-offset-key="22261:0" data-first-offset="true"><span data-slate-string="true"> iam.NewForConfig(clientConfig)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22262"><span data-slate-object="text" data-key="22263"><span data-slate-leaf="true" data-offset-key="22263:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22264"><span data-slate-type="code" data-slate-object="inline" data-key="22265"><span data-slate-object="text" data-key="22266"><span data-slate-leaf="true" data-offset-key="22266:0" data-first-offset="true"><span data-slate-string="true">marmotedu.Clientset</span></span></span></span><span data-slate-object="text" data-key="22267"><span data-slate-leaf="true" data-offset-key="22267:0" data-first-offset="true"><span data-slate-string="true"> 提供了 iam-apiserver 的所有接口。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="22268" id="sr-toc-16"><span data-slate-object="text" data-key="22269"><span data-slate-leaf="true" data-offset-key="22269:0" data-first-offset="true"><span data-slate-string="true">REST API 调用</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="22270"><span data-slate-object="text" data-key="22271"><span data-slate-leaf="true" data-offset-key="22271:0" data-first-offset="true"><span data-slate-string="true">通过 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="22272"><span data-slate-object="text" data-key="22273"><span data-slate-leaf="true" data-offset-key="22273:0" data-first-offset="true"><span data-slate-string="true">RESTClient()</span></span></span></a><span data-slate-object="text" data-key="22274"><span data-slate-leaf="true" data-offset-key="22274:0" data-first-offset="true"><span data-slate-string="true"> 返回 RESTful API 客户端，代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22275"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22276"><span data-slate-object="text" data-key="22277"><span data-slate-leaf="true" data-offset-key="22277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="22278"><span data-slate-leaf="true" data-offset-key="22278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="22279"><span data-slate-leaf="true" data-offset-key="22279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *factoryImpl)</span></span></span></span></span><span data-slate-object="text" data-key="22280"><span data-slate-leaf="true" data-offset-key="22280:0" data-first-offset="true"><span data-slate-string="true"> RESTClient() (*restclient.RESTClient, </span></span></span><span data-slate-object="text" data-key="22281"><span data-slate-leaf="true" data-offset-key="22281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="22282"><span data-slate-leaf="true" data-offset-key="22282:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22283"><span data-slate-object="text" data-key="22284"><span data-slate-leaf="true" data-offset-key="22284:0" data-first-offset="true"><span data-slate-string="true">  clientConfig, err := f.ToRESTConfig()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22285"><span data-slate-object="text" data-key="22286"><span data-slate-leaf="true" data-offset-key="22286:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="22287"><span data-slate-leaf="true" data-offset-key="22287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="22288"><span data-slate-leaf="true" data-offset-key="22288:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="22289"><span data-slate-leaf="true" data-offset-key="22289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22290"><span data-slate-leaf="true" data-offset-key="22290:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22291"><span data-slate-object="text" data-key="22292"><span data-slate-leaf="true" data-offset-key="22292:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="22293"><span data-slate-leaf="true" data-offset-key="22293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22294"><span data-slate-leaf="true" data-offset-key="22294:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="22295"><span data-slate-leaf="true" data-offset-key="22295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22296"><span data-slate-leaf="true" data-offset-key="22296:0" data-first-offset="true"><span data-slate-string="true">, err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22297"><span data-slate-object="text" data-key="22298"><span data-slate-leaf="true" data-offset-key="22298:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22299"><span data-slate-object="text" data-key="22300"><span data-slate-leaf="true" data-offset-key="22300:0" data-first-offset="true"><span data-slate-string="true">  setIAMDefaults(clientConfig)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22301"><span data-slate-object="text" data-key="22302"><span data-slate-leaf="true" data-offset-key="22302:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="22303"><span data-slate-leaf="true" data-offset-key="22303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22304"><span data-slate-leaf="true" data-offset-key="22304:0" data-first-offset="true"><span data-slate-string="true"> restclient.RESTClientFor(clientConfig)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22305"><span data-slate-object="text" data-key="22306"><span data-slate-leaf="true" data-offset-key="22306:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22307"><span data-slate-object="text" data-key="22308"><span data-slate-leaf="true" data-offset-key="22308:0" data-first-offset="true"><span data-slate-string="true">可以通过下面的方式访问 RESTful API 接口：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="22309"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="22310"><span data-slate-object="text" data-key="22311"><span data-slate-leaf="true" data-offset-key="22311:0" data-first-offset="true"><span data-slate-string="true">serverVersion *version.Info</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22312"></div><div data-slate-type="code-line" data-slate-object="block" data-key="22313"><span data-slate-object="text" data-key="22314"><span data-slate-leaf="true" data-offset-key="22314:0" data-first-offset="true"><span data-slate-string="true">client, _ := f.RESTClient()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22315"><span data-slate-object="text" data-key="22316"><span data-slate-leaf="true" data-offset-key="22316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="22317"><span data-slate-leaf="true" data-offset-key="22317:0" data-first-offset="true"><span data-slate-string="true"> err := client.Get().AbsPath(</span></span></span><span data-slate-object="text" data-key="22318"><span data-slate-leaf="true" data-offset-key="22318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/version"</span></span></span></span><span data-slate-object="text" data-key="22319"><span data-slate-leaf="true" data-offset-key="22319:0" data-first-offset="true"><span data-slate-string="true">).Do(context.TODO()).Into(&amp;serverVersion); err != </span></span></span><span data-slate-object="text" data-key="22320"><span data-slate-leaf="true" data-offset-key="22320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="22321"><span data-slate-leaf="true" data-offset-key="22321:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22322"><span data-slate-object="text" data-key="22323"><span data-slate-leaf="true" data-offset-key="22323:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="22324"><span data-slate-leaf="true" data-offset-key="22324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="22325"><span data-slate-leaf="true" data-offset-key="22325:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="22326"><span data-slate-object="text" data-key="22327"><span data-slate-leaf="true" data-offset-key="22327:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22328"><span data-slate-object="text" data-key="22329"><span data-slate-leaf="true" data-offset-key="22329:0" data-first-offset="true"><span data-slate-string="true">上面的代码请求了 iam-apiserver 的 /version 接口，并将返回结果保存在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22330"><span data-slate-object="text" data-key="22331"><span data-slate-leaf="true" data-offset-key="22331:0" data-first-offset="true"><span data-slate-string="true">serverVersion</span></span></span></span><span data-slate-object="text" data-key="22332"><span data-slate-leaf="true" data-offset-key="22332:0" data-first-offset="true"><span data-slate-string="true"> 变量中。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="22333" id="sr-toc-17"><span data-slate-object="text" data-key="22334"><span data-slate-leaf="true" data-offset-key="22334:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="22335"><span data-slate-object="text" data-key="22336"><span data-slate-leaf="true" data-offset-key="22336:0" data-first-offset="true"><span data-slate-string="true">这一讲，我主要剖析了 iamctl 命令行工具的实现，进而向你介绍了如何实现一个优秀的客户端工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22337"><span data-slate-object="text" data-key="22338"><span data-slate-leaf="true" data-offset-key="22338:0" data-first-offset="true"><span data-slate-string="true">对于一个大型系统 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22339"><span data-slate-object="text" data-key="22340"><span data-slate-leaf="true" data-offset-key="22340:0" data-first-offset="true"><span data-slate-string="true">xxx</span></span></span></span><span data-slate-object="text" data-key="22341"><span data-slate-leaf="true" data-offset-key="22341:0" data-first-offset="true"><span data-slate-string="true"> 来说，通常需要有一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22342"><span data-slate-object="text" data-key="22343"><span data-slate-leaf="true" data-offset-key="22343:0" data-first-offset="true"><span data-slate-string="true">xxxctl</span></span></span></span><span data-slate-object="text" data-key="22344"><span data-slate-leaf="true" data-offset-key="22344:0" data-first-offset="true"><span data-slate-string="true"> 命令行工具， </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22345"><span data-slate-object="text" data-key="22346"><span data-slate-leaf="true" data-offset-key="22346:0" data-first-offset="true"><span data-slate-string="true">xxxctl</span></span></span></span><span data-slate-object="text" data-key="22347"><span data-slate-leaf="true" data-offset-key="22347:0" data-first-offset="true"><span data-slate-string="true"> 命令行工具可以方便开发、运维使用系统功能，并能实现功能自动化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22348"><span data-slate-object="text" data-key="22349"><span data-slate-leaf="true" data-offset-key="22349:0" data-first-offset="true"><span data-slate-string="true">IAM 项目参考 kubectl，实现了命令行工具 iamctl。iamctl 集成了很多功能，我们可以通过 iamctl 子命令来使用这些功能。例如，我们可以通过 iamctl 对用户、密钥和策略进行 CURD 操作；可以设置 iamctl 自动补全脚本；可以查看 IAM 系统的版本信息。甚至，你还可以使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22350"><span data-slate-object="text" data-key="22351"><span data-slate-leaf="true" data-offset-key="22351:0" data-first-offset="true"><span data-slate-string="true">iamctl new</span></span></span></span><span data-slate-object="text" data-key="22352"><span data-slate-leaf="true" data-offset-key="22352:0" data-first-offset="true"><span data-slate-string="true"> 命令，快速创建一个 iamctl 子命令模板。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22353"><span data-slate-object="text" data-key="22354"><span data-slate-leaf="true" data-offset-key="22354:0" data-first-offset="true"><span data-slate-string="true">iamctl 使用了 cobra、pflag、viper 包来构建，每个子命令又包含了一些基本的功能，例如短描述、长描述、使用示例、命令行选项、选项校验等。iamctl 命令可以加载不同的配置文件，来连接不同的客户端。iamctl 通过 SDK 调用、REST API 调用两种方式来调用服务端 API 接口。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="22355" id="sr-toc-18"><span data-slate-object="text" data-key="22356"><span data-slate-leaf="true" data-offset-key="22356:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="22357"><div data-slate-type="list-line" data-slate-object="block" data-key="22358"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="22359"><span data-slate-leaf="true" data-offset-key="22359:0" data-first-offset="true"><span data-slate-string="true">尝试在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22360"><span data-slate-object="text" data-key="22361"><span data-slate-leaf="true" data-offset-key="22361:0" data-first-offset="true"><span data-slate-string="true">iamctl</span></span></span></span><span data-slate-object="text" data-key="22362"><span data-slate-leaf="true" data-offset-key="22362:0" data-first-offset="true"><span data-slate-string="true"> 中添加一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="22363"><span data-slate-object="text" data-key="22364"><span data-slate-leaf="true" data-offset-key="22364:0" data-first-offset="true"><span data-slate-string="true">cliprint</span></span></span></span><span data-slate-object="text" data-key="22365"><span data-slate-leaf="true" data-offset-key="22365:0" data-first-offset="true"><span data-slate-string="true"> 子命令，该子命令会读取并打印命令行选项。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="22366"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="22367"><span data-slate-leaf="true" data-offset-key="22367:0" data-first-offset="true"><span data-slate-string="true">思考下，还有哪些好的命令行工具构建方式，欢迎在留言区分享。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="22368"><span data-slate-object="text" data-key="22369"><span data-slate-leaf="true" data-offset-key="22369:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-19">精选留言 (8)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
iamctl 工具的实现参考了 kubectl 命令的实现
对功能和选项进行分组
代码结构的组织方式：internal/iamctl/cmd/&lt;命令&gt;/&lt; 命令 &gt;_&lt; 子命令 &gt;.go 
子命令的构建方式：可手动扩展也可使用 iamctl new 自动生成。保证构建命令方式的一致性。
iamctl 支持通过 RESTClient 和 SDK 两种方式调用后端服务，f cmdutil.Factory 作为命令实现的第一个参数，按需实例化客户端。</div><div><div>2021-12-04</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 宙斯</span></div></div><div>有 cmd 为什么还单独分割出来一个 tools 呢？tools 感觉放到 cmd 里面也是可以的</div><div><p>作者回复: tools 说明是工具，cmd / 下的程序都属于 iam 服务。</p></div><div><div>2021-11-11</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/83/17/df99b53d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 随风而过</span></div></div><div>这套命令行基本通用，还学到大型开源项目的命令行工具的构建，我一般开发都是些 shell 脚本，没想到 cobra、pflag、viper 包来构建的更好使，效率还更高</div><div><div>2021-09-08</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 我来也</span></div></div><div>老师的项目真全，连 ctl 都有了。😁
本地一个 make 命令，就构建出来了对应架构的可执行文件。

有个地方比较好奇，咨询一下老师：
老师的 zsh 补全脚本是如何生成的，为什么是在代码中定义的常量？
https://github.com/marmotedu/iam/blob/922885b4a502c589785eb08a61522ca03bc8ba55/internal/iamctl/cmd/completion/completion.go#L139-L163

而 ko 的 zsh 补全是完全有代码自动生成的：
https://github.com/google/ko/blob/0af2e5e8a9107523c287d7c67af874d3837cc39f/pkg/commands/completion.go#L35

重点来了：
ko 的 bash 补全是可以正常工作的，但 zsh 补全在我这有点不正常。
    （按了 Tag 虽然能出提示，但有其他错误。不知道哪来的，也不好调试。）
老师的 zsh 补全是好使的！</div><div><p>作者回复: zsh 脚本是 cobra 框架自动生成的。如果生成的 zsh 自动补全脚本有问题，可能说明没有正确使用 cobra 或者 cobra 有问题，提议 google 下</p></div><div><div>2021-08-14</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/43/cf/118c4ef5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>lunar</span></div></div><div>一个盛老师，一个这个老师，是真写代码啊！！！可能是对 cli 开发不熟悉，看代码里用了 viper, 直接先看 viper 迷瞪了两天，还是先看 cobra 吧</div><div><div>2021-09-12</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Sch0ng</span></div></div><div>命令行客户端工具是大型项目交互和管理的一部分。
又学到了一个最佳实践，赞👍</div><div><div>2021-08-17</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>我来也</span></div></div><div>有新的发现：
ko 自动生成的代码中，嵌套了中括号，就会导致补全失败。

ko completion zsh 生成的代码是这样：
 '--platform [Which platform to use when pulling a multi-platform base. Format: all | &lt;os&gt;[/&lt;arch&gt;[/&lt;variant&gt;]][,platform]*]:' \

这个在使用 Tab 补全时就会报错：
_arguments:comparguments:325: invalid option definition: --platform [Which platform to use when pulling a multi-platform base. Format: all | &lt;os&gt;[/&lt;arch&gt;[/&lt;variant&gt;]][,platform]*]:

如果手动将上面生成的代码改成：
'--platform [Which platform to use when pulling a multi-platform base. Format: all | &lt;os&gt;&lt;/&lt;arch&gt;&lt;/&lt;variant&gt;&gt;&gt;&lt;,platform&gt;*]:' \

再使用 ko apply --&lt;Tab&gt; 时，就不会遇到上面的错误了。

现在就只剩下最后一个问题了：
ko 补全时，出现的错误不知道哪来的，比较尴尬。

➜  zsh ✗ autoload exec
➜  zsh ✗ ko ap&lt;Tab&gt;
(eval):6: exec: function definition file not found
Error: required flag (s) "image" not set
➜  zsh ✗ ko apply --help

</div><div><p>作者回复：牛批！</p></div><div><div>2021-08-14</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>cool!</div><div><div>2021-08-14</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".17"><outline class="toc-level-h1" data-reactid=".17.0" style="width: 175px;"><active data-reactid=".17.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".17.0.1"><span data-reactid=".17.0.1.0"> 35 | 效率神器：如何设计和实现一个命令行客户端工具？</span></a></outline><outline class="toc-level-h2" data-reactid=".17.1" style="width: 165px;"><active data-reactid=".17.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".17.1.1"><span data-reactid=".17.1.1.0">常见客户端介绍</span></a></outline><outline class="toc-level-h2" data-reactid=".17.2" style="width: 165px;"><active data-reactid=".17.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".17.2.1"><span data-reactid=".17.2.1.0">大型系统客户端（xxxctl）的特点</span></a></outline><outline class="toc-level-h2" data-reactid=".17.3" style="width: 165px;"><active data-reactid=".17.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".17.3.1"><span data-reactid=".17.3.1.0">iamctl 的核心实现</span></a></outline><outline class="toc-level-h3" data-reactid=".17.4" style="width: 155px;"><active data-reactid=".17.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".17.4.1"><span data-reactid=".17.4.1.0">iamctl 的功能</span></a></outline><outline class="toc-level-h3" data-reactid=".17.5" style="width: 155px;"><active data-reactid=".17.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".17.5.1"><span data-reactid=".17.5.1.0">代码结构</span></a></outline><outline class="toc-level-h3" data-reactid=".17.6" style="width: 155px;"><active data-reactid=".17.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".17.6.1"><span data-reactid=".17.6.1.0">命令行选项</span></a></outline><outline class="toc-level-h3" data-reactid=".17.7" style="width: 155px;"><active data-reactid=".17.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".17.7.1"><span data-reactid=".17.7.1.0">配置文件解析</span></a></outline><outline class="toc-level-h2" data-reactid=".17.8" style="width: 165px;"><active data-reactid=".17.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".17.8.1"><span data-reactid=".17.8.1.0">iamctl 中子命令是如何构建的？</span></a></outline><outline class="toc-level-h3" data-reactid=".17.9" style="width: 155px;"><active data-reactid=".17.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".17.9.1"><span data-reactid=".17.9.1.0">命令构建</span></a></outline><outline class="toc-level-h3" data-reactid=".17.a" style="width: 155px;"><active data-reactid=".17.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".17.a.1"><span data-reactid=".17.a.1.0">自动生成命令</span></a></outline><outline class="toc-level-h3" data-reactid=".17.b" style="width: 155px;"><active data-reactid=".17.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".17.b.1"><span data-reactid=".17.b.1.0">命令自动补全</span></a></outline><outline class="toc-level-h3" data-reactid=".17.c" style="width: 155px;"><active data-reactid=".17.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".17.c.1"><span data-reactid=".17.c.1.0">更友好的输出</span></a></outline><outline class="toc-level-h2" data-reactid=".17.d" style="width: 165px;"><active data-reactid=".17.d.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".17.d.1"><span data-reactid=".17.d.1.0">iamctl 是如何进行 API 调用的？</span></a></outline><outline class="toc-level-h3" data-reactid=".17.e" style="width: 155px;"><active data-reactid=".17.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".17.e.1"><span data-reactid=".17.e.1.0">客户端配置文件</span></a></outline><outline class="toc-level-h3" data-reactid=".17.f" style="width: 155px;"><active data-reactid=".17.f.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".17.f.1"><span data-reactid=".17.f.1.0">SDK 调用</span></a></outline><outline class="toc-level-h3" data-reactid=".17.g" style="width: 155px;"><active data-reactid=".17.g.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".17.g.1"><span data-reactid=".17.g.1.0">REST API 调用</span></a></outline><outline class="toc-level-h2" data-reactid=".17.h" style="width: 165px;"><active data-reactid=".17.h.0"></active><a class="toc-outline-theme-github" href="#sr-toc-17" data-reactid=".17.h.1"><span data-reactid=".17.h.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".17.i" style="width: 165px;"><active data-reactid=".17.i.0"></active><a class="toc-outline-theme-github" href="#sr-toc-18" data-reactid=".17.i.1"><span data-reactid=".17.i.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".17.j" style="width: 165px;"><active data-reactid=".17.j.0"></active><a class="toc-outline-theme-github" href="#sr-toc-19" data-reactid=".17.j.1"><span data-reactid=".17.j.1.0">精选留言 (8)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/407922" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>