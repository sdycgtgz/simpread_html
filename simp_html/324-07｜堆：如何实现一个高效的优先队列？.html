
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 07｜堆：如何实现一个高效的优先队列？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>07｜堆：如何实现一个高效的优先队列？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">让我们一起来探索工程实战中每天都存在的算法问题吧！</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">07｜堆：如何实现一个高效的优先队列？</h1><div><span>黄清昊</span> <span> 2021-12-25</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/c9/4f/c9a29a6134e31969567526f82d2ca04f.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：黄清昊</span><span>大小：18.18M</span><span> 时长：19:54</span></div></div><audio title="07｜堆：如何实现一个高效的优先队列？" src="https://res001.geekbang.org/media/audio/4f/47/4f615f2yye77b1b569ee974b858e6e47/ld/ld.m3u8" __idm_id__="40969"></audio></div><div><div><div><div data-slate-editor="true" data-key="4334" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="4335"><span data-slate-object="text" data-key="4336"><span data-slate-leaf="true" data-offset-key="4336:0" data-first-offset="true"><span data-slate-string="true">你好，我是微扰君。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4337"><span data-slate-object="text" data-key="4338"><span data-slate-leaf="true" data-offset-key="4338:0" data-first-offset="true"><span data-slate-string="true">上一讲学习了基于红黑树的 ordered_map 的实现，今天我们来介绍另外一种有趣的树，heap，也就是堆。堆的应用非常广泛，我们常说的堆排序的堆就是指这种树状数据结构，除此之外还可以用来解决诸如 TopK，或者合并多个有序小文件之类的问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4339"><span data-slate-object="text" data-key="4340"><span data-slate-leaf="true" data-offset-key="4340:0" data-first-offset="true"><span data-slate-string="true">堆也是我们最后一个基础数据结构容器 - 优先队列的常见底层实现方式。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4341" id="sr-toc-1"><span data-slate-object="text" data-key="4342"><span data-slate-leaf="true" data-offset-key="4342:0" data-first-offset="true"><span data-slate-string="true">优先队列</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4343"><span data-slate-object="text" data-key="4344"><span data-slate-leaf="true" data-offset-key="4344:0" data-first-offset="true"><span data-slate-string="true">你一定还记得之前讲过的线性数据结构 queue 吧，也就是队列，一种先进先出的数据结构，生活中这种先进先出的场景也很常见，我们当时举了一个在餐厅排队取号的例子，先来的人一定会先取到号，也先被叫到号，这完美地符合队列的语义。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4345"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/03/75/031f3908df1315910fab5543a50e9575.jpg?wh=1920x736"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4346"><span data-slate-object="text" data-key="4347"><span data-slate-leaf="true" data-offset-key="4347:0" data-first-offset="true"><span data-slate-string="true">那如果我们现在希望允许一部分人插队呢？比如在医院中，大部分病人都有序的挂号排队，但这时候如果来了一个重症病患，我们就很可能需要破坏先进先出的规则，让医生优先诊断治疗这位病患。这种场景中的队列，我们就可以定义为 “优先队列”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4348"><span data-slate-object="text" data-key="4349"><span data-slate-leaf="true" data-offset-key="4349:0" data-first-offset="true"><span data-slate-string="true">优先队列中的每个元素，我们会赋予它一个优先级，优先级相同的元素我们还是遵循先进先出的原则，</span></span></span><span data-slate-object="text" data-key="4350"><span data-slate-leaf="true" data-offset-key="4350:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">但一定会保证队列中优先级更高的元素先出队，即使它进队时间更晚</span></span></span></span><span data-slate-object="text" data-key="4351"><span data-slate-leaf="true" data-offset-key="4351:0" data-first-offset="true"><span data-slate-string="true">。比如例子中的重症病患来的并不早，但依旧得到了医生的优先治疗。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4352"><span data-slate-object="text" data-key="4353"><span data-slate-leaf="true" data-offset-key="4353:0" data-first-offset="true"><span data-slate-string="true">对于这种优先队列，我们应该如何高效地实现呢？</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4354" id="sr-toc-2"><span data-slate-object="text" data-key="4355"><span data-slate-leaf="true" data-offset-key="4355:0" data-first-offset="true"><span data-slate-string="true">如何实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4356"><span data-slate-object="text" data-key="4357"><span data-slate-leaf="true" data-offset-key="4357:0" data-first-offset="true"><span data-slate-string="true">其实也很容易想到不止一种方案。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4358"><span data-slate-object="text" data-key="4359"><span data-slate-leaf="true" data-offset-key="4359:0" data-first-offset="true"><span data-slate-string="true">比如，一种比较暴力的思路可以是：我们依旧用线性容器存储元素。在入队的时候，我们不关心优先级的影响直接按顺序存入容器中，</span></span></span><span data-slate-object="text" data-key="4360"><span data-slate-leaf="true" data-offset-key="4360:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">出队的时候，则遍历容器找到最高优先级的元素出队</span></span></span></span><span data-slate-object="text" data-key="4361"><span data-slate-leaf="true" data-offset-key="4361:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4362"><span data-slate-object="text" data-key="4363"><span data-slate-leaf="true" data-offset-key="4363:0" data-first-offset="true"><span data-slate-string="true">由于入队的时候没有对优先级做任何处理，所以出队的元素显然可能在线性容器中任意一个位置，基于之前所学的知识，遇到节点删除的场景，用链表显然比用动态数组有更好的时间复杂度。但即使如此，每次出队时我们也需要遍历链表，所以时间复杂度为 O (N)。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4364"><span data-slate-object="text" data-key="4365"><span data-slate-leaf="true" data-offset-key="4365:0" data-first-offset="true"><span data-slate-string="true">那与之相对的，另一种同样基于链表的思路也可以是，</span></span></span><span data-slate-object="text" data-key="4366"><span data-slate-leaf="true" data-offset-key="4366:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">我们每次在入队的时候进行一些额外的调整，使得整个队列一直满足优先级更高的元素在更前面的约束</span></span></span></span><span data-slate-object="text" data-key="4367"><span data-slate-leaf="true" data-offset-key="4367:0" data-first-offset="true"><span data-slate-string="true">，这样出队的时候就比较简单。当然这样会导致入队的时候都需要进行一次类似于插入排序的操作，最差情况下也会要遍历完整个链表，时间复杂度同样为 O (N)。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4368"><span data-slate-object="text" data-key="4369"><span data-slate-leaf="true" data-offset-key="4369:0" data-first-offset="true"><span data-slate-string="true">假设出队和入队操作数量相等，均摊下来，每一次操作的时间复杂度就是 O (N)。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4370"><span data-slate-object="text" data-key="4371"><span data-slate-leaf="true" data-offset-key="4371:0" data-first-offset="true"><span data-slate-string="true">看示意图辅助你理解，队列里的数字代表权重，a、b、c、d、e 代表着入队的值，我们假设入队顺序和值的字典序是一致的。上面的队列画的就是入队的时候就按照优先级排好序的情况，所以直接从队尾出队即可；下面的队列是入队的时候直接放到队尾，出队的时候要按照优先级取出元素。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4372"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/80/c9/804e072a611c89dc87f762f1119c08c9.jpg?wh=1920x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4373"><span data-slate-object="text" data-key="4374"><span data-slate-leaf="true" data-offset-key="4374:0" data-first-offset="true"><span data-slate-string="true">那有没有一种入队和出队都相对来说比较高效的方式呢？答案是肯定的，</span></span></span><span data-slate-object="text" data-key="4375"><span data-slate-leaf="true" data-offset-key="4375:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">只是我们需要抛弃线性的存储结构</span></span></span></span><span data-slate-object="text" data-key="4376"><span data-slate-leaf="true" data-offset-key="4376:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4377"><span data-slate-object="text" data-key="4378"><span data-slate-leaf="true" data-offset-key="4378:0" data-first-offset="true"><span data-slate-string="true">不知道你是不是也想到了上一章讲的红黑树。其实你的想法是对的，红黑树当然是可以用来实现优先级队列的一种方式，我们建红黑树的时候以优先级为 key 作为排序依据即可。入队的时候可以直接 push 入队，出队 pop 的时候先从树中找到优先级高的，也就是树的最右节点，然后移除即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4379"><span data-slate-object="text" data-key="4380"><span data-slate-leaf="true" data-offset-key="4380:0" data-first-offset="true"><span data-slate-string="true">这些操作的复杂度都是 O (logN)，所以出队和入队的复杂度自然也就是 O (logN)。所以，基于红黑树的优先队列复杂度均摊下来，相比于之前基于线性表的 O (N) 复杂度，显然更胜一筹。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4381"><span data-slate-object="text" data-key="4382"><span data-slate-leaf="true" data-offset-key="4382:0" data-first-offset="true"><span data-slate-string="true">但是由于我们不会进行类似 “找出优先级第 3 高的元素出队” 这样的操作，</span></span></span><span data-slate-object="text" data-key="4383"><span data-slate-leaf="true" data-offset-key="4383:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">其实并不需要一直维护完全的顺序信息，只是需要能在每次出队时，找到优先级最高的元素即可。那有没有更合适的选择呢</span></span></span></span><span data-slate-object="text" data-key="4384"><span data-slate-leaf="true" data-offset-key="4384:0" data-first-offset="true"><span data-slate-string="true">？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4385"><span data-slate-object="text" data-key="4386"><span data-slate-leaf="true" data-offset-key="4386:0" data-first-offset="true"><span data-slate-string="true">相比复杂的红黑树，</span></span><span data-slate-leaf="true" data-offset-key="4386:1"><span data-slate-object="annotation" data-annotation-key="gkann_be3d2f37" data-attr-id="36920" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">简明的 “二叉堆” 就是这样一种特别适合用来动态维护一组元素中最大或者最小值的数据结构，</span></span></span><span data-slate-leaf="true" data-offset-key="4386:2"><span data-slate-string="true">它也是各大语言实现优先级队列的首选。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4387" id="sr-toc-3"><span data-slate-object="text" data-key="4388"><span data-slate-leaf="true" data-offset-key="4388:0" data-first-offset="true"><span data-slate-string="true">二叉堆</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4389"><span data-slate-object="text" data-key="4390"><span data-slate-leaf="true" data-offset-key="4390:0" data-first-offset="true"><span data-slate-string="true">二叉堆，这个数据结构是 1964 年斯坦福大学教授 Robert W．Floyd 和 J．Williams 在发明堆排序的时候提出，之所以想介绍一下它的历史，主要是因为 Robert W．Floyd 是一个文科出生，后来自学计算机科学，逆袭成为斯坦福终身教授的大佬。我想这多多少少能证明热爱的力量，也能给可能是非科班出身的你我一些信心吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4391"><span data-slate-object="text" data-key="4392"><span data-slate-leaf="true" data-offset-key="4392:0" data-first-offset="true"><span data-slate-string="true">好啦回归正题，“二叉堆”，也就是 binary heap，顾名思义，这个数据结构也是建立在一种特别的二叉树上的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4393"><span data-slate-object="text" data-key="4394"><span data-slate-leaf="true" data-offset-key="4394:0" data-first-offset="true"><span data-slate-string="true">它主要有两个约束：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="4395"><div data-slate-type="list-line" data-slate-object="block" data-key="4396"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="4397"><span data-slate-leaf="true" data-offset-key="4397:0" data-first-offset="true"><span data-slate-string="true">二叉堆是一颗满二叉树。也就是说，除了最后一层外的每一层都没有空节点，且最后一层所有节点靠左排列，不存在从左到右中间有某些节点为空。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="4398"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="4399"><span data-slate-leaf="true" data-offset-key="4399:0" data-first-offset="true"><span data-slate-string="true">二叉堆中的</span></span></span><span data-slate-object="text" data-key="4400"><span data-slate-leaf="true" data-offset-key="4400:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">每个节点和其子节点都有一样的偏序关系，</span></span></span><span data-slate-leaf="true" data-offset-key="4400:1"><span data-slate-object="annotation" data-annotation-key="gkann_73b2fb66" data-attr-id="42111" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">要么大于要么小于</span></span></span></span></span><span data-slate-object="text" data-key="4401"><span data-slate-leaf="true" data-offset-key="4401:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_73b2fb66" data-attr-id="42111" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，这两种情况分别对应大顶堆和小顶堆。所以大顶堆就要求堆中所有节点的值，一定大于其左右子树中的任何一个节点的值，也就是说顶部的节点一定是最大的，故称为大顶堆。小顶堆就正好相反。</span></span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4402"><span data-slate-object="text" data-key="4403"><span data-slate-leaf="true" data-offset-key="4403:0" data-first-offset="true"><span data-slate-string="true">有了这样的约束，可以保证根节点要么是最大的要么是最小的，也让我们在出队入队的操作里调整的成本很小，整个过程有点像冒泡排序的感觉，我们马上讲解具体的细节。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4404"><span data-slate-object="text" data-key="4405"><span data-slate-leaf="true" data-offset-key="4405:0" data-first-offset="true"><span data-slate-string="true">比如下图中左边就是一个二叉堆，但中间因为不满足满二叉树的约束，就不是一个二叉堆；右边因为不满足完全的有序关系也不是一个二叉堆。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4406"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9e/82/9e58f9e5d39a0ef5748ea511ae481e82.jpg?wh=1920x1145"></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4407" id="sr-toc-4"><span data-slate-object="text" data-key="4408"><span data-slate-leaf="true" data-offset-key="4408:0" data-first-offset="true"><span data-slate-string="true">为什么这么设计</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4409"><span data-slate-object="text" data-key="4410"><span data-slate-leaf="true" data-offset-key="4410:0" data-first-offset="true"><span data-slate-string="true">那现在我们来看看，这样的数据结构设计对于维护优先队列有什么帮助呢？和红黑树一样，二叉堆这样的树状结构同样暗含了关键的顺序信息，而我们核心就是利用这样的信息，在插入时进行更少的操作，而避免像线性表那样做从头到尾的顺序遍历。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4411"><span data-slate-object="text" data-key="4412"><span data-slate-leaf="true" data-offset-key="4412:0" data-first-offset="true"><span data-slate-string="true">为了实现优先级队列，我们会用优先级，priority，来作为二叉堆节点间大小比较的依据。假设我们始终希望出队的是优先级更高的元素，那可以</span></span></span><span data-slate-object="text" data-key="4413"><span data-slate-leaf="true" data-offset-key="4413:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">采用大顶堆作为优先队列的底层实现，这样每次只需要从顶部取出元素即可获得优先级最高的元素。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4414"><span data-slate-object="text" data-key="4415"><span data-slate-leaf="true" data-offset-key="4415:0" data-first-offset="true"><span data-slate-string="true">当然很重要的一点是，取出元素后显然会在树的顶部产生一个空位，我们需要进行一定的操作使得大顶堆的性质得以保全。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4416"><span data-slate-object="text" data-key="4417"><span data-slate-leaf="true" data-offset-key="4417:0" data-first-offset="true"><span data-slate-string="true">同样，为了享受直接从顶部取出优先级最高元素的便利，我们在插入元素时也要让二叉堆的性质得以保持。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4418"><span data-slate-object="text" data-key="4419"><span data-slate-leaf="true" data-offset-key="4419:0" data-first-offset="true"><span data-slate-string="true">幸运的是，正是因为二叉树是一个满二叉树，其高度约等于 LogN，其中 N 为优先队列中元素的个数。而第二条约束父子节点之间的有序关系，让我们每次做 pop 和 push 操作，只需要经过最多二叉树高度次的交换调整即可保持堆的所有特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4420"><span data-slate-object="text" data-key="4421"><span data-slate-leaf="true" data-offset-key="4421:0" data-first-offset="true"><span data-slate-string="true">这样，我们就得到了一个入队和出队操作复杂度都为 O (LogN) 的数据结构，虽然均摊的时间复杂度和红黑树是一样的，但实现的难度却要小很多，所以今天我们就结合源码来讲解。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4422" id="sr-toc-5"><span data-slate-object="text" data-key="4423"><span data-slate-leaf="true" data-offset-key="4423:0" data-first-offset="true"><span data-slate-string="true">PriorityQueue 的实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4424"><span data-slate-object="text" data-key="4425"><span data-slate-leaf="true" data-offset-key="4425:0" data-first-offset="true"><span data-slate-string="true">以 JDK14 中的 PriorityQueue 为例（后面简称 PQ），我们来分析一个生产环境中的优先队列要怎么基于堆实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4426"><span data-slate-object="text" data-key="4427"><span data-slate-leaf="true" data-offset-key="4427:0" data-first-offset="true"><span data-slate-string="true">先来看看 JDK 中优先队列数据结构的基本定义，我们会讲一些重要的成员变量和方法。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="4428"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="4429"><span data-slate-object="text" data-key="4430"><span data-slate-leaf="true" data-offset-key="4430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4431"><span data-slate-leaf="true" data-offset-key="4431:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4432"><span data-slate-leaf="true" data-offset-key="4432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="4433"><span data-slate-leaf="true" data-offset-key="4433:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4434"><span data-slate-leaf="true" data-offset-key="4434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PriorityQueue</span></span></span></span><span data-slate-object="text" data-key="4435"><span data-slate-leaf="true" data-offset-key="4435:0" data-first-offset="true"><span data-slate-string="true">&lt;E&gt; </span></span></span><span data-slate-object="text" data-key="4436"><span data-slate-leaf="true" data-offset-key="4436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">extends</span></span></span></span><span data-slate-object="text" data-key="4437"><span data-slate-leaf="true" data-offset-key="4437:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4438"><span data-slate-leaf="true" data-offset-key="4438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AbstractQueue</span></span></span></span><span data-slate-object="text" data-key="4439"><span data-slate-leaf="true" data-offset-key="4439:0" data-first-offset="true"><span data-slate-string="true">&lt;E&gt;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4440"><span data-slate-object="text" data-key="4441"><span data-slate-leaf="true" data-offset-key="4441:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4442"><span data-slate-leaf="true" data-offset-key="4442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">implements</span></span></span></span><span data-slate-object="text" data-key="4443"><span data-slate-leaf="true" data-offset-key="4443:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4444"><span data-slate-leaf="true" data-offset-key="4444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">java</span></span></span></span><span data-slate-object="text" data-key="4445"><span data-slate-leaf="true" data-offset-key="4445:0" data-first-offset="true"><span data-slate-string="true">.io.Serializable {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4446"><span data-slate-object="text" data-key="4447"><span data-slate-leaf="true" data-offset-key="4447:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4448"><span data-slate-leaf="true" data-offset-key="4448:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4449"><span data-slate-object="text" data-key="4450"><span data-slate-leaf="true" data-offset-key="4450:0" data-first-offset="true"><span data-slate-string="true">       * Priority queue represented as a balanced binary heap: the two</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4451"><span data-slate-object="text" data-key="4452"><span data-slate-leaf="true" data-offset-key="4452:0" data-first-offset="true"><span data-slate-string="true">       * children of queue[n] are queue[2*n+1] and queue[2*(n+1)].  The</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4453"><span data-slate-object="text" data-key="4454"><span data-slate-leaf="true" data-offset-key="4454:0" data-first-offset="true"><span data-slate-string="true">       * priority queue is ordered by comparator, or by the elements'</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4455"><span data-slate-object="text" data-key="4456"><span data-slate-leaf="true" data-offset-key="4456:0" data-first-offset="true"><span data-slate-string="true">       * natural ordering, if comparator is null: For each node n in the</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4457"><span data-slate-object="text" data-key="4458"><span data-slate-leaf="true" data-offset-key="4458:0" data-first-offset="true"><span data-slate-string="true">       * heap and each descendant d of n, n &lt;= d.  The element with the</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4459"><span data-slate-object="text" data-key="4460"><span data-slate-leaf="true" data-offset-key="4460:0" data-first-offset="true"><span data-slate-string="true">       * lowest value is in queue[0], assuming the queue is nonempty.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4461"><span data-slate-object="text" data-key="4462"><span data-slate-leaf="true" data-offset-key="4462:0" data-first-offset="true"><span data-slate-string="true">       */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4463"><span data-slate-object="text" data-key="4464"><span data-slate-leaf="true" data-offset-key="4464:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4465"><span data-slate-leaf="true" data-offset-key="4465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">transient</span></span></span></span><span data-slate-object="text" data-key="4466"><span data-slate-leaf="true" data-offset-key="4466:0" data-first-offset="true"><span data-slate-string="true"> Object[] queue; </span></span></span><span data-slate-object="text" data-key="4467"><span data-slate-leaf="true" data-offset-key="4467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// non-private to simplify nested class access</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4468"><span data-slate-object="text" data-key="4469"><span data-slate-leaf="true" data-offset-key="4469:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4470"><span data-slate-object="text" data-key="4471"><span data-slate-leaf="true" data-offset-key="4471:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4472"><span data-slate-leaf="true" data-offset-key="4472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4473"><span data-slate-object="text" data-key="4474"><span data-slate-leaf="true" data-offset-key="4474:0" data-first-offset="true"><span data-slate-string="true">       * The number of elements in the priority queue.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4475"><span data-slate-object="text" data-key="4476"><span data-slate-leaf="true" data-offset-key="4476:0" data-first-offset="true"><span data-slate-string="true">       */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4477"><span data-slate-object="text" data-key="4478"><span data-slate-leaf="true" data-offset-key="4478:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4479"><span data-slate-leaf="true" data-offset-key="4479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="4480"><span data-slate-leaf="true" data-offset-key="4480:0" data-first-offset="true"><span data-slate-string="true"> size;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4481"><span data-slate-object="text" data-key="4482"><span data-slate-leaf="true" data-offset-key="4482:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4483"><span data-slate-object="text" data-key="4484"><span data-slate-leaf="true" data-offset-key="4484:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4485"><span data-slate-leaf="true" data-offset-key="4485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4486"><span data-slate-object="text" data-key="4487"><span data-slate-leaf="true" data-offset-key="4487:0" data-first-offset="true"><span data-slate-string="true">       * Inserts the specified element into this priority queue.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4488"><span data-slate-object="text" data-key="4489"><span data-slate-leaf="true" data-offset-key="4489:0" data-first-offset="true"><span data-slate-string="true">       *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4490"><span data-slate-object="text" data-key="4491"><span data-slate-leaf="true" data-offset-key="4491:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4492"><span data-slate-leaf="true" data-offset-key="4492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@return</span></span></span></span><span data-slate-object="text" data-key="4493"><span data-slate-leaf="true" data-offset-key="4493:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span><span data-slate-object="text" data-key="4494"><span data-slate-leaf="true" data-offset-key="4494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@code</span></span></span></span><span data-slate-object="text" data-key="4495"><span data-slate-leaf="true" data-offset-key="4495:0" data-first-offset="true"><span data-slate-string="true"> true} (as specified by {</span></span></span><span data-slate-object="text" data-key="4496"><span data-slate-leaf="true" data-offset-key="4496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@link</span></span></span></span><span data-slate-object="text" data-key="4497"><span data-slate-leaf="true" data-offset-key="4497:0" data-first-offset="true"><span data-slate-string="true"> Queue#offer})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4498"><span data-slate-object="text" data-key="4499"><span data-slate-leaf="true" data-offset-key="4499:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4500"><span data-slate-leaf="true" data-offset-key="4500:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@throws</span></span></span></span><span data-slate-object="text" data-key="4501"><span data-slate-leaf="true" data-offset-key="4501:0" data-first-offset="true"><span data-slate-string="true"> ClassCastException if the specified element cannot be</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4502"><span data-slate-object="text" data-key="4503"><span data-slate-leaf="true" data-offset-key="4503:0" data-first-offset="true"><span data-slate-string="true">       *         compared with elements currently in this priority queue</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4504"><span data-slate-object="text" data-key="4505"><span data-slate-leaf="true" data-offset-key="4505:0" data-first-offset="true"><span data-slate-string="true">       *         according to the priority queue's ordering</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4506"><span data-slate-object="text" data-key="4507"><span data-slate-leaf="true" data-offset-key="4507:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4508"><span data-slate-leaf="true" data-offset-key="4508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@throws</span></span></span></span><span data-slate-object="text" data-key="4509"><span data-slate-leaf="true" data-offset-key="4509:0" data-first-offset="true"><span data-slate-string="true"> NullPointerException if the specified element is null</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4510"><span data-slate-object="text" data-key="4511"><span data-slate-leaf="true" data-offset-key="4511:0" data-first-offset="true"><span data-slate-string="true">       */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4512"><span data-slate-object="text" data-key="4513"><span data-slate-leaf="true" data-offset-key="4513:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4514"><span data-slate-leaf="true" data-offset-key="4514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4515"><span data-slate-leaf="true" data-offset-key="4515:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4516"><span data-slate-leaf="true" data-offset-key="4516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">boolean</span></span></span></span><span data-slate-object="text" data-key="4517"><span data-slate-leaf="true" data-offset-key="4517:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4518"><span data-slate-leaf="true" data-offset-key="4518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">offer</span></span></span></span><span data-slate-object="text" data-key="4519"><span data-slate-leaf="true" data-offset-key="4519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(E e)</span></span></span></span><span data-slate-object="text" data-key="4520"><span data-slate-leaf="true" data-offset-key="4520:0" data-first-offset="true"><span data-slate-string="true"> {...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4521"><span data-slate-object="text" data-key="4522"><span data-slate-leaf="true" data-offset-key="4522:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4523"><span data-slate-object="text" data-key="4524"><span data-slate-leaf="true" data-offset-key="4524:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4525"><span data-slate-leaf="true" data-offset-key="4525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4526"><span data-slate-object="text" data-key="4527"><span data-slate-leaf="true" data-offset-key="4527:0" data-first-offset="true"><span data-slate-string="true">       * Increases the capacity of the array.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4528"><span data-slate-object="text" data-key="4529"><span data-slate-leaf="true" data-offset-key="4529:0" data-first-offset="true"><span data-slate-string="true">       *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4530"><span data-slate-object="text" data-key="4531"><span data-slate-leaf="true" data-offset-key="4531:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4532"><span data-slate-leaf="true" data-offset-key="4532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="4533"><span data-slate-leaf="true" data-offset-key="4533:0" data-first-offset="true"><span data-slate-string="true"> minCapacity the desired minimum capacity</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4534"><span data-slate-object="text" data-key="4535"><span data-slate-leaf="true" data-offset-key="4535:0" data-first-offset="true"><span data-slate-string="true">       */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4536"><span data-slate-object="text" data-key="4537"><span data-slate-leaf="true" data-offset-key="4537:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4538"><span data-slate-leaf="true" data-offset-key="4538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="4539"><span data-slate-leaf="true" data-offset-key="4539:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4540"><span data-slate-leaf="true" data-offset-key="4540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="4541"><span data-slate-leaf="true" data-offset-key="4541:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4542"><span data-slate-leaf="true" data-offset-key="4542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">grow</span></span></span></span><span data-slate-object="text" data-key="4543"><span data-slate-leaf="true" data-offset-key="4543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="4544"><span data-slate-leaf="true" data-offset-key="4544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="4545"><span data-slate-leaf="true" data-offset-key="4545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> minCapacity)</span></span></span></span><span data-slate-object="text" data-key="4546"><span data-slate-leaf="true" data-offset-key="4546:0" data-first-offset="true"><span data-slate-string="true"> {...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4547"><span data-slate-object="text" data-key="4548"><span data-slate-leaf="true" data-offset-key="4548:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4549"><span data-slate-object="text" data-key="4550"><span data-slate-leaf="true" data-offset-key="4550:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4551"><span data-slate-leaf="true" data-offset-key="4551:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4552"><span data-slate-leaf="true" data-offset-key="4552:0" data-first-offset="true"><span data-slate-string="true"> E </span></span></span><span data-slate-object="text" data-key="4553"><span data-slate-leaf="true" data-offset-key="4553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">peek</span></span></span></span><span data-slate-object="text" data-key="4554"><span data-slate-leaf="true" data-offset-key="4554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="4555"><span data-slate-leaf="true" data-offset-key="4555:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4556"><span data-slate-object="text" data-key="4557"><span data-slate-leaf="true" data-offset-key="4557:0" data-first-offset="true"><span data-slate-string="true">          </span></span></span><span data-slate-object="text" data-key="4558"><span data-slate-leaf="true" data-offset-key="4558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4559"><span data-slate-leaf="true" data-offset-key="4559:0" data-first-offset="true"><span data-slate-string="true"> (E) queue[</span></span></span><span data-slate-object="text" data-key="4560"><span data-slate-leaf="true" data-offset-key="4560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4561"><span data-slate-leaf="true" data-offset-key="4561:0" data-first-offset="true"><span data-slate-string="true">];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4562"><span data-slate-object="text" data-key="4563"><span data-slate-leaf="true" data-offset-key="4563:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4564"></div><div data-slate-type="code-line" data-slate-object="block" data-key="4565"><span data-slate-object="text" data-key="4566"><span data-slate-leaf="true" data-offset-key="4566:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4567"><span data-slate-leaf="true" data-offset-key="4567:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4568"><span data-slate-object="text" data-key="4569"><span data-slate-leaf="true" data-offset-key="4569:0" data-first-offset="true"><span data-slate-string="true">       * Inserts item x at position k, maintaining heap invariant by</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4570"><span data-slate-object="text" data-key="4571"><span data-slate-leaf="true" data-offset-key="4571:0" data-first-offset="true"><span data-slate-string="true">       * promoting x up the tree until it is greater than or equal to</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4572"><span data-slate-object="text" data-key="4573"><span data-slate-leaf="true" data-offset-key="4573:0" data-first-offset="true"><span data-slate-string="true">       * its parent, or is the root.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4574"><span data-slate-object="text" data-key="4575"><span data-slate-leaf="true" data-offset-key="4575:0" data-first-offset="true"><span data-slate-string="true">       *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4576"><span data-slate-object="text" data-key="4577"><span data-slate-leaf="true" data-offset-key="4577:0" data-first-offset="true"><span data-slate-string="true">       * To simplify and speed up coercions and comparisons, the</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4578"><span data-slate-object="text" data-key="4579"><span data-slate-leaf="true" data-offset-key="4579:0" data-first-offset="true"><span data-slate-string="true">       * Comparable and Comparator versions are separated into different</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4580"><span data-slate-object="text" data-key="4581"><span data-slate-leaf="true" data-offset-key="4581:0" data-first-offset="true"><span data-slate-string="true">       * methods that are otherwise identical. (Similarly for siftDown.)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4582"><span data-slate-object="text" data-key="4583"><span data-slate-leaf="true" data-offset-key="4583:0" data-first-offset="true"><span data-slate-string="true">       *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4584"><span data-slate-object="text" data-key="4585"><span data-slate-leaf="true" data-offset-key="4585:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4586"><span data-slate-leaf="true" data-offset-key="4586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="4587"><span data-slate-leaf="true" data-offset-key="4587:0" data-first-offset="true"><span data-slate-string="true"> k the position to fill</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4588"><span data-slate-object="text" data-key="4589"><span data-slate-leaf="true" data-offset-key="4589:0" data-first-offset="true"><span data-slate-string="true">       * </span></span></span><span data-slate-object="text" data-key="4590"><span data-slate-leaf="true" data-offset-key="4590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="4591"><span data-slate-leaf="true" data-offset-key="4591:0" data-first-offset="true"><span data-slate-string="true"> x the item to insert</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4592"><span data-slate-object="text" data-key="4593"><span data-slate-leaf="true" data-offset-key="4593:0" data-first-offset="true"><span data-slate-string="true">       */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4594"><span data-slate-object="text" data-key="4595"><span data-slate-leaf="true" data-offset-key="4595:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4596"><span data-slate-leaf="true" data-offset-key="4596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="4597"><span data-slate-leaf="true" data-offset-key="4597:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4598"><span data-slate-leaf="true" data-offset-key="4598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="4599"><span data-slate-leaf="true" data-offset-key="4599:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4600"><span data-slate-leaf="true" data-offset-key="4600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">siftUp</span></span></span></span><span data-slate-object="text" data-key="4601"><span data-slate-leaf="true" data-offset-key="4601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="4602"><span data-slate-leaf="true" data-offset-key="4602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="4603"><span data-slate-leaf="true" data-offset-key="4603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> k, E x)</span></span></span></span><span data-slate-object="text" data-key="4604"><span data-slate-leaf="true" data-offset-key="4604:0" data-first-offset="true"><span data-slate-string="true"> {...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4605"><span data-slate-object="text" data-key="4606"><span data-slate-leaf="true" data-offset-key="4606:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4607"><span data-slate-object="text" data-key="4608"><span data-slate-leaf="true" data-offset-key="4608:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="4609"><span data-slate-leaf="true" data-offset-key="4609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4610"><span data-slate-leaf="true" data-offset-key="4610:0" data-first-offset="true"><span data-slate-string="true"> E </span></span></span><span data-slate-object="text" data-key="4611"><span data-slate-leaf="true" data-offset-key="4611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">poll</span></span></span></span><span data-slate-object="text" data-key="4612"><span data-slate-leaf="true" data-offset-key="4612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="4613"><span data-slate-leaf="true" data-offset-key="4613:0" data-first-offset="true"><span data-slate-string="true"> {...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4614"><span data-slate-object="text" data-key="4615"><span data-slate-leaf="true" data-offset-key="4615:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4616"><span data-slate-object="text" data-key="4617"><span data-slate-leaf="true" data-offset-key="4617:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4618"><span data-slate-object="text" data-key="4619"><span data-slate-leaf="true" data-offset-key="4619:0" data-first-offset="true"><span data-slate-string="true">首先要看堆元素在内存中到底是怎么存储的。可以看到：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="4620"><div data-slate-type="list-line" data-slate-object="block" data-key="4621"><span data-slate-object="text" data-key="4622"><span data-slate-leaf="true" data-offset-key="4622:0" data-first-offset="true"><span data-slate-string="true">成员变量 size，它显然用于表示优先队列中元素的大小。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="4623"><span data-slate-object="text" data-key="4624"><span data-slate-leaf="true" data-offset-key="4624:0" data-first-offset="true"><span data-slate-string="true">成员变量中有一个叫 queue 的数组，这就是堆中元素存放的地方。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4625"><span data-slate-object="text" data-key="4626"><span data-slate-leaf="true" data-offset-key="4626:0" data-first-offset="true"><span data-slate-string="true">你这个时候可能就会有些疑惑了？诶？那我们堆的树状结构到哪里去了，为什么还是一个线性的存储结构呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4627"><span data-slate-object="text" data-key="4628"><span data-slate-leaf="true" data-offset-key="4628:0" data-first-offset="true"><span data-slate-string="true">其实，</span></span></span><span data-slate-object="text" data-key="4629"><span data-slate-leaf="true" data-offset-key="4629:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在 JDK 中的 PQ 实现里，并没有和我们想象中一般的树那样采用节点 + 指针来实现树状数据结构，而是用了内存上连续的数组来模拟</span></span></span></span><span data-slate-object="text" data-key="4630"><span data-slate-leaf="true" data-offset-key="4630:0" data-first-offset="true"><span data-slate-string="true">。代码中的 queue 数组就是用来表示堆这一树状结构的成员变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4631"><span data-slate-object="text" data-key="4632"><span data-slate-leaf="true" data-offset-key="4632:0" data-first-offset="true"><span data-slate-string="true">这么讲可能你不是很理解，我们看下面的图。图中画的就是一个大顶堆的示例，上下分别代表堆的树状结构本身和存储到 queue 数组中的样子。你可以通过元素的值来判断两种表示间的对应关系。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4633"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9f/09/9f8fc9d9e5ca9d60da352219c4c62209.jpg?wh=2312x1379"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4634"><span data-slate-object="text" data-key="4635"><span data-slate-leaf="true" data-offset-key="4635:0" data-first-offset="true"><span data-slate-string="true">相信你也发现了，图中的数组就是</span></span></span><span data-slate-object="text" data-key="4636"><span data-slate-leaf="true" data-offset-key="4636:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">按照对树做层序遍历的方式依次排列的</span></span></span></span><span data-slate-object="text" data-key="4637"><span data-slate-leaf="true" data-offset-key="4637:0" data-first-offset="true"><span data-slate-string="true">，所以数组中下标为 0 的元素就是堆顶的元素，我们也用箭头将数组元素中的父子关系都标记出来了。由于二叉树每一层元素个数都是上一层两倍的特性，你会发现，queue [k] 节点，它的左子节点为 queue [2</span></span></span><span data-slate-object="text" data-key="4638"><span data-slate-leaf="true" data-offset-key="4638:0" data-first-offset="true"><span data-slate-type="italic" data-slate-object="mark"><span data-slate-string="true">k+1]，右子节点为 queue [2</span></span></span></span><span data-slate-object="text" data-key="4639"><span data-slate-leaf="true" data-offset-key="4639:0" data-first-offset="true"><span data-slate-string="true">k+2]。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4640"><span data-slate-object="text" data-key="4641"><span data-slate-leaf="true" data-offset-key="4641:0" data-first-offset="true"><span data-slate-string="true">事实上，不止二叉堆，其实一般的二叉树也是可以用数组表示的，如果你做过 LeetCode 上相关试题的话，也会经常碰到类似的表示方式。大部分时候，用数组表示树写起来比较简单，不需要引入类似指针的概念，也不用定义树节点的类或者结构体。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4642"><span data-slate-object="text" data-key="4643"><span data-slate-leaf="true" data-offset-key="4643:0" data-first-offset="true"><span data-slate-string="true">但如果二叉树不是满的，数组中会有大量的空值，非常浪费空间。</span></span></span><span data-slate-object="text" data-key="4644"><span data-slate-leaf="true" data-offset-key="4644:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">而堆本身满二叉树的特性，则让我们可以选择用数组作为底层二叉树实现而不至于浪费大量的内存</span></span></span></span><span data-slate-object="text" data-key="4645"><span data-slate-leaf="true" data-offset-key="4645:0" data-first-offset="true"><span data-slate-string="true">，这就是 JDK 中为什么可以使用数组作为底层存储的原因。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4646" id="sr-toc-6"><span data-slate-object="text" data-key="4647"><span data-slate-leaf="true" data-offset-key="4647:0" data-first-offset="true"><span data-slate-string="true">堆的操作</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4648"><span data-slate-object="text" data-key="4649"><span data-slate-leaf="true" data-offset-key="4649:0" data-first-offset="true"><span data-slate-string="true">有了底层的数据表示，下面我们来了解一下堆的两个重要操作，插入和删除。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4650"><span data-slate-object="text" data-key="4651"><span data-slate-leaf="true" data-offset-key="4651:0" data-first-offset="true"><span data-slate-string="true">首先看堆的插入操作，也就是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="4652"><span data-slate-object="text" data-key="4653"><span data-slate-leaf="true" data-offset-key="4653:0" data-first-offset="true"><span data-slate-string="true">offer</span></span></span></span><span data-slate-object="text" data-key="4654"><span data-slate-leaf="true" data-offset-key="4654:0" data-first-offset="true"><span data-slate-string="true"> 方法，对应的代码如下：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="4655"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="4656"><span data-slate-object="text" data-key="4657"><span data-slate-leaf="true" data-offset-key="4657:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4658"><span data-slate-object="text" data-key="4659"><span data-slate-leaf="true" data-offset-key="4659:0" data-first-offset="true"><span data-slate-string="true"> * Inserts the specified element into this priority queue.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4660"><span data-slate-object="text" data-key="4661"><span data-slate-leaf="true" data-offset-key="4661:0" data-first-offset="true"><span data-slate-string="true"> *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4662"><span data-slate-object="text" data-key="4663"><span data-slate-leaf="true" data-offset-key="4663:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="4664"><span data-slate-leaf="true" data-offset-key="4664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@return</span></span></span></span><span data-slate-object="text" data-key="4665"><span data-slate-leaf="true" data-offset-key="4665:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span><span data-slate-object="text" data-key="4666"><span data-slate-leaf="true" data-offset-key="4666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@code</span></span></span></span><span data-slate-object="text" data-key="4667"><span data-slate-leaf="true" data-offset-key="4667:0" data-first-offset="true"><span data-slate-string="true"> true} (as specified by {</span></span></span><span data-slate-object="text" data-key="4668"><span data-slate-leaf="true" data-offset-key="4668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@link</span></span></span></span><span data-slate-object="text" data-key="4669"><span data-slate-leaf="true" data-offset-key="4669:0" data-first-offset="true"><span data-slate-string="true"> Queue#offer})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4670"><span data-slate-object="text" data-key="4671"><span data-slate-leaf="true" data-offset-key="4671:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="4672"><span data-slate-leaf="true" data-offset-key="4672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@throws</span></span></span></span><span data-slate-object="text" data-key="4673"><span data-slate-leaf="true" data-offset-key="4673:0" data-first-offset="true"><span data-slate-string="true"> ClassCastException if the specified element cannot be</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4674"><span data-slate-object="text" data-key="4675"><span data-slate-leaf="true" data-offset-key="4675:0" data-first-offset="true"><span data-slate-string="true"> *         compared with elements currently in this priority queue</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4676"><span data-slate-object="text" data-key="4677"><span data-slate-leaf="true" data-offset-key="4677:0" data-first-offset="true"><span data-slate-string="true"> *         according to the priority queue's ordering</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4678"><span data-slate-object="text" data-key="4679"><span data-slate-leaf="true" data-offset-key="4679:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="4680"><span data-slate-leaf="true" data-offset-key="4680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@throws</span></span></span></span><span data-slate-object="text" data-key="4681"><span data-slate-leaf="true" data-offset-key="4681:0" data-first-offset="true"><span data-slate-string="true"> NullPointerException if the specified element is null</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4682"><span data-slate-object="text" data-key="4683"><span data-slate-leaf="true" data-offset-key="4683:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4684"><span data-slate-object="text" data-key="4685"><span data-slate-leaf="true" data-offset-key="4685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4686"><span data-slate-leaf="true" data-offset-key="4686:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4687"><span data-slate-leaf="true" data-offset-key="4687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">boolean</span></span></span></span><span data-slate-object="text" data-key="4688"><span data-slate-leaf="true" data-offset-key="4688:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4689"><span data-slate-leaf="true" data-offset-key="4689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">offer</span></span></span></span><span data-slate-object="text" data-key="4690"><span data-slate-leaf="true" data-offset-key="4690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(E e)</span></span></span></span><span data-slate-object="text" data-key="4691"><span data-slate-leaf="true" data-offset-key="4691:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4692"><span data-slate-object="text" data-key="4693"><span data-slate-leaf="true" data-offset-key="4693:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4694"><span data-slate-leaf="true" data-offset-key="4694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4695"><span data-slate-leaf="true" data-offset-key="4695:0" data-first-offset="true"><span data-slate-string="true"> (e == </span></span></span><span data-slate-object="text" data-key="4696"><span data-slate-leaf="true" data-offset-key="4696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="4697"><span data-slate-leaf="true" data-offset-key="4697:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4698"><span data-slate-object="text" data-key="4699"><span data-slate-leaf="true" data-offset-key="4699:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4700"><span data-slate-leaf="true" data-offset-key="4700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="4701"><span data-slate-leaf="true" data-offset-key="4701:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4702"><span data-slate-leaf="true" data-offset-key="4702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="4703"><span data-slate-leaf="true" data-offset-key="4703:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4704"><span data-slate-leaf="true" data-offset-key="4704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NullPointerException</span></span></span></span><span data-slate-object="text" data-key="4705"><span data-slate-leaf="true" data-offset-key="4705:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4706"><span data-slate-object="text" data-key="4707"><span data-slate-leaf="true" data-offset-key="4707:0" data-first-offset="true"><span data-slate-string="true">    modCount++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4708"><span data-slate-object="text" data-key="4709"><span data-slate-leaf="true" data-offset-key="4709:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4710"><span data-slate-leaf="true" data-offset-key="4710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="4711"><span data-slate-leaf="true" data-offset-key="4711:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4712"><span data-slate-leaf="true" data-offset-key="4712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">i</span></span></span></span><span data-slate-object="text" data-key="4713"><span data-slate-leaf="true" data-offset-key="4713:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4714"><span data-slate-leaf="true" data-offset-key="4714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="4715"><span data-slate-leaf="true" data-offset-key="4715:0" data-first-offset="true"><span data-slate-string="true"> size;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4716"><span data-slate-object="text" data-key="4717"><span data-slate-leaf="true" data-offset-key="4717:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4718"><span data-slate-leaf="true" data-offset-key="4718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4719"><span data-slate-leaf="true" data-offset-key="4719:0" data-first-offset="true"><span data-slate-string="true"> (i&gt;= queue.length)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4720"><span data-slate-object="text" data-key="4721"><span data-slate-leaf="true" data-offset-key="4721:0" data-first-offset="true"><span data-slate-string="true">        grow(i + </span></span></span><span data-slate-object="text" data-key="4722"><span data-slate-leaf="true" data-offset-key="4722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="4723"><span data-slate-leaf="true" data-offset-key="4723:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4724"><span data-slate-object="text" data-key="4725"><span data-slate-leaf="true" data-offset-key="4725:0" data-first-offset="true"><span data-slate-string="true">    siftUp(i, e);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4726"><span data-slate-object="text" data-key="4727"><span data-slate-leaf="true" data-offset-key="4727:0" data-first-offset="true"><span data-slate-string="true">    size = i + </span></span></span><span data-slate-object="text" data-key="4728"><span data-slate-leaf="true" data-offset-key="4728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="4729"><span data-slate-leaf="true" data-offset-key="4729:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4730"><span data-slate-object="text" data-key="4731"><span data-slate-leaf="true" data-offset-key="4731:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4732"><span data-slate-leaf="true" data-offset-key="4732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4733"><span data-slate-leaf="true" data-offset-key="4733:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4734"><span data-slate-leaf="true" data-offset-key="4734:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="4735"><span data-slate-leaf="true" data-offset-key="4735:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4736"><span data-slate-object="text" data-key="4737"><span data-slate-leaf="true" data-offset-key="4737:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4738"><span data-slate-object="text" data-key="4739"><span data-slate-leaf="true" data-offset-key="4739:0" data-first-offset="true"><span data-slate-string="true">该方法接收一个待插入的元素 e，在 18 行中将堆的大小增加 1，这个非常直观。有两个函数详细解释一下，grow 和 siftUp。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4740" id="sr-toc-7"><span data-slate-object="text" data-key="4741"><span data-slate-leaf="true" data-offset-key="4741:0" data-first-offset="true"><span data-slate-string="true">grow 函数</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4742"><span data-slate-object="text" data-key="4743"><span data-slate-leaf="true" data-offset-key="4743:0" data-first-offset="true"><span data-slate-string="true">grow 函数用于扩展数组的大小。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4744"><span data-slate-object="text" data-key="4745"><span data-slate-leaf="true" data-offset-key="4745:0" data-first-offset="true"><span data-slate-string="true">我们用数组模拟堆，就必然要给出一个数组的大小，这也就限制了二叉堆的最大大小。但这在使用过程中并不方便，我们没有办法在各种场景下都准确预估堆所需使用的最大元素个数。所以和 STL 的 vector 一样，JDK 中的 PriorityQueue，通过内置的 grow 函数和扩容机制解决了堆动态大小的问题。grow 函数具体做的事情我们最后再讲。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4746"><span data-slate-object="text" data-key="4747"><span data-slate-leaf="true" data-offset-key="4747:0" data-first-offset="true"><span data-slate-string="true">所以在 offer 方法里，如果发现当前插入的元素已经超过了内置 queue 数组的容量，我们需要进行扩容操作，这就是第 15-16 行代码所做的事情。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4748" id="sr-toc-8"><span data-slate-object="text" data-key="4749"><span data-slate-leaf="true" data-offset-key="4749:0" data-first-offset="true"><span data-slate-string="true">siftUp 函数</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4750"><span data-slate-object="text" data-key="4751"><span data-slate-leaf="true" data-offset-key="4751:0" data-first-offset="true"><span data-slate-string="true">现在我们来看 siftUp 的过程，具体的插入操作其实就隐藏在了 siftUp 这个函数中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4752"><span data-slate-object="text" data-key="4753"><span data-slate-leaf="true" data-offset-key="4753:0" data-first-offset="true"><span data-slate-string="true">之所以叫 siftUp，就是因为这个插入的过程是自下而上的。我们结合具体例子，来讲解 siftUp 的过程，先搞清楚思路，再来看对应的代码就很好理解了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4754"><span data-slate-object="text" data-key="4755"><span data-slate-leaf="true" data-offset-key="4755:0" data-first-offset="true"><span data-slate-string="true">假设有这样的一个二叉堆，我们想要插入一个新的元素。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4756"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/fy/23/fyy22c38b93f0fda3a33682eea0db823.jpg?wh=1920x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4757"><span data-slate-object="text" data-key="4758"><span data-slate-leaf="true" data-offset-key="4758:0" data-first-offset="true"><span data-slate-string="true">可以先将该元素插入到数组的尾部，也就是堆中的最后一个位置，这是一个 O (1) 的操作，因为不涉及任何元素的移位。然后要做的，就是将这个元素一路往上交换使得二叉堆可以保持自身的 2 条特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4759"><span data-slate-object="text" data-key="4760"><span data-slate-leaf="true" data-offset-key="4760:0" data-first-offset="true"><span data-slate-string="true">由于我们是将新的元素放到堆的尾部，没有空开任何一个子节点，所以</span></span></span><span data-slate-object="text" data-key="4761"><span data-slate-leaf="true" data-offset-key="4761:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">只是进行元素的交换，并不会破坏堆是满二叉树的特性，因而我们只需要关注父节点比所有子节点大这一特性</span></span></span></span><span data-slate-object="text" data-key="4762"><span data-slate-leaf="true" data-offset-key="4762:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4763"><span data-slate-object="text" data-key="4764"><span data-slate-leaf="true" data-offset-key="4764:0" data-first-offset="true"><span data-slate-string="true">所以将该节点不断和其父节点比较，如果比父节点大，将该节点和父节点交换，并继续和该节点新的父节点进行比较。由于原来的父亲节点一定比其左右子节点（其中一个是这次调整的节点，另一个是他的兄弟节点）都大，所以将其和父亲节点交换位置，一定也能保证该节点比其兄弟节点大。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4765"><span data-slate-object="text" data-key="4766"><span data-slate-leaf="true" data-offset-key="4766:0" data-first-offset="true"><span data-slate-string="true">而只要发现该节点已经比父节点小了，我们就可以结束这次的比较、交换之旅，堆已经重新满足了特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4767"><span data-slate-object="text" data-key="4768"><span data-slate-leaf="true" data-offset-key="4768:0" data-first-offset="true"><span data-slate-string="true">结合示意图理解，比如在堆的最后一个位置插入 92。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4769"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ac/42/ac8d9a6bc4fa5cdac42a286ccf250042.jpg?wh=1920x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4770"><span data-slate-object="text" data-key="4771"><span data-slate-leaf="true" data-offset-key="4771:0" data-first-offset="true"><span data-slate-string="true">我们要先把 92 和 47 比较，发现 92 比 47 大的时候，互换位置；然后继续比较，会交换 92 和 76 的位置，关注父子节点的大小要求特性，因为 76 本身比 52 大，所以交换后一定也能保证 92 比 52。这就是堆 siftUp 的过程。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4772"><span data-slate-object="text" data-key="4773"><span data-slate-leaf="true" data-offset-key="4773:0" data-first-offset="true"><span data-slate-string="true">这里再稍微补充两句，堆和红黑树不一样，我们在整个过程中只关心父子节点之间的大小关系，而不用在意兄弟节点之间的大小关系，比如原本 4（47）节点是比 5（52）节点小的，现在 4 节点（76）比 5 节点（52）大了，这并不会破坏堆的性质。这也是堆之所以调整比红黑树简单很多的地方。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4774"><span data-slate-object="text" data-key="4775"><span data-slate-leaf="true" data-offset-key="4775:0" data-first-offset="true"><span data-slate-string="true">了解这个过程，对应的代码就非常好懂了。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="4776"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="4777"><span data-slate-object="text" data-key="4778"><span data-slate-leaf="true" data-offset-key="4778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="4779"><span data-slate-leaf="true" data-offset-key="4779:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4780"><span data-slate-leaf="true" data-offset-key="4780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="4781"><span data-slate-leaf="true" data-offset-key="4781:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4782"><span data-slate-leaf="true" data-offset-key="4782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">siftUp</span></span></span></span><span data-slate-object="text" data-key="4783"><span data-slate-leaf="true" data-offset-key="4783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="4784"><span data-slate-leaf="true" data-offset-key="4784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="4785"><span data-slate-leaf="true" data-offset-key="4785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> k, E x)</span></span></span></span><span data-slate-object="text" data-key="4786"><span data-slate-leaf="true" data-offset-key="4786:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4787"><span data-slate-object="text" data-key="4788"><span data-slate-leaf="true" data-offset-key="4788:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4789"><span data-slate-leaf="true" data-offset-key="4789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4790"><span data-slate-leaf="true" data-offset-key="4790:0" data-first-offset="true"><span data-slate-string="true"> (comparator != </span></span></span><span data-slate-object="text" data-key="4791"><span data-slate-leaf="true" data-offset-key="4791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="4792"><span data-slate-leaf="true" data-offset-key="4792:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4793"><span data-slate-object="text" data-key="4794"><span data-slate-leaf="true" data-offset-key="4794:0" data-first-offset="true"><span data-slate-string="true">        siftUpUsingComparator(k, x, queue, comparator);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4795"><span data-slate-object="text" data-key="4796"><span data-slate-leaf="true" data-offset-key="4796:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4797"><span data-slate-leaf="true" data-offset-key="4797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4798"><span data-slate-object="text" data-key="4799"><span data-slate-leaf="true" data-offset-key="4799:0" data-first-offset="true"><span data-slate-string="true">        siftUpComparable(k, x, queue);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4800"><span data-slate-object="text" data-key="4801"><span data-slate-leaf="true" data-offset-key="4801:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4802"></div><div data-slate-type="code-line" data-slate-object="block" data-key="4803"></div><div data-slate-type="code-line" data-slate-object="block" data-key="4804"></div><div data-slate-type="code-line" data-slate-object="block" data-key="4805"><span data-slate-object="text" data-key="4806"><span data-slate-leaf="true" data-offset-key="4806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="4807"><span data-slate-leaf="true" data-offset-key="4807:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4808"><span data-slate-leaf="true" data-offset-key="4808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="4809"><span data-slate-leaf="true" data-offset-key="4809:0" data-first-offset="true"><span data-slate-string="true"> &lt;T&gt; </span></span></span><span data-slate-object="text" data-key="4810"><span data-slate-leaf="true" data-offset-key="4810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="4811"><span data-slate-leaf="true" data-offset-key="4811:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4812"><span data-slate-leaf="true" data-offset-key="4812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">siftUpComparable</span></span></span></span><span data-slate-object="text" data-key="4813"><span data-slate-leaf="true" data-offset-key="4813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="4814"><span data-slate-leaf="true" data-offset-key="4814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="4815"><span data-slate-leaf="true" data-offset-key="4815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> k, T x, Object[] es)</span></span></span></span><span data-slate-object="text" data-key="4816"><span data-slate-leaf="true" data-offset-key="4816:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4817"><span data-slate-object="text" data-key="4818"><span data-slate-leaf="true" data-offset-key="4818:0" data-first-offset="true"><span data-slate-string="true">    Comparable&lt;? </span></span></span><span data-slate-object="text" data-key="4819"><span data-slate-leaf="true" data-offset-key="4819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="4820"><span data-slate-leaf="true" data-offset-key="4820:0" data-first-offset="true"><span data-slate-string="true"> T&gt; key = (Comparable&lt;? </span></span></span><span data-slate-object="text" data-key="4821"><span data-slate-leaf="true" data-offset-key="4821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="4822"><span data-slate-leaf="true" data-offset-key="4822:0" data-first-offset="true"><span data-slate-string="true"> T&gt;) x;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4823"><span data-slate-object="text" data-key="4824"><span data-slate-leaf="true" data-offset-key="4824:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4825"><span data-slate-leaf="true" data-offset-key="4825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="4826"><span data-slate-leaf="true" data-offset-key="4826:0" data-first-offset="true"><span data-slate-string="true"> (k&gt; </span></span></span><span data-slate-object="text" data-key="4827"><span data-slate-leaf="true" data-offset-key="4827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4828"><span data-slate-leaf="true" data-offset-key="4828:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4829"><span data-slate-object="text" data-key="4830"><span data-slate-leaf="true" data-offset-key="4830:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4831"><span data-slate-leaf="true" data-offset-key="4831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 计算父节点的下标</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4832"><span data-slate-object="text" data-key="4833"><span data-slate-leaf="true" data-offset-key="4833:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4834"><span data-slate-leaf="true" data-offset-key="4834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="4835"><span data-slate-leaf="true" data-offset-key="4835:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4836"><span data-slate-leaf="true" data-offset-key="4836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">parent</span></span></span></span><span data-slate-object="text" data-key="4837"><span data-slate-leaf="true" data-offset-key="4837:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4838"><span data-slate-leaf="true" data-offset-key="4838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="4839"><span data-slate-leaf="true" data-offset-key="4839:0" data-first-offset="true"><span data-slate-string="true"> (k - </span></span></span><span data-slate-object="text" data-key="4840"><span data-slate-leaf="true" data-offset-key="4840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="4841"><span data-slate-leaf="true" data-offset-key="4841:0" data-first-offset="true"><span data-slate-string="true">) &gt;&gt;&gt; </span></span></span><span data-slate-object="text" data-key="4842"><span data-slate-leaf="true" data-offset-key="4842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="4843"><span data-slate-leaf="true" data-offset-key="4843:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4844"><span data-slate-object="text" data-key="4845"><span data-slate-leaf="true" data-offset-key="4845:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4846"><span data-slate-leaf="true" data-offset-key="4846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Object</span></span></span></span><span data-slate-object="text" data-key="4847"><span data-slate-leaf="true" data-offset-key="4847:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4848"><span data-slate-leaf="true" data-offset-key="4848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">e</span></span></span></span><span data-slate-object="text" data-key="4849"><span data-slate-leaf="true" data-offset-key="4849:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4850"><span data-slate-leaf="true" data-offset-key="4850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="4851"><span data-slate-leaf="true" data-offset-key="4851:0" data-first-offset="true"><span data-slate-string="true"> es[parent];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4852"><span data-slate-object="text" data-key="4853"><span data-slate-leaf="true" data-offset-key="4853:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4854"><span data-slate-leaf="true" data-offset-key="4854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 比较当前节点和父节点的关系 如果当前节点优先级更高，我们可以直接结束比较</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4855"><span data-slate-object="text" data-key="4856"><span data-slate-leaf="true" data-offset-key="4856:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4857"><span data-slate-leaf="true" data-offset-key="4857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4858"><span data-slate-leaf="true" data-offset-key="4858:0" data-first-offset="true"><span data-slate-string="true"> (key.compareTo((T) e) &gt;= </span></span></span><span data-slate-object="text" data-key="4859"><span data-slate-leaf="true" data-offset-key="4859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4860"><span data-slate-leaf="true" data-offset-key="4860:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4861"><span data-slate-object="text" data-key="4862"><span data-slate-leaf="true" data-offset-key="4862:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4863"><span data-slate-leaf="true" data-offset-key="4863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span><span data-slate-object="text" data-key="4864"><span data-slate-leaf="true" data-offset-key="4864:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4865"><span data-slate-object="text" data-key="4866"><span data-slate-leaf="true" data-offset-key="4866:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4867"><span data-slate-leaf="true" data-offset-key="4867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 交换节点</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4868"><span data-slate-object="text" data-key="4869"><span data-slate-leaf="true" data-offset-key="4869:0" data-first-offset="true"><span data-slate-string="true">        es[k] = e;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4870"><span data-slate-object="text" data-key="4871"><span data-slate-leaf="true" data-offset-key="4871:0" data-first-offset="true"><span data-slate-string="true">        k = parent;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4872"><span data-slate-object="text" data-key="4873"><span data-slate-leaf="true" data-offset-key="4873:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4874"><span data-slate-object="text" data-key="4875"><span data-slate-leaf="true" data-offset-key="4875:0" data-first-offset="true"><span data-slate-string="true">    es[k] = key;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4876"><span data-slate-object="text" data-key="4877"><span data-slate-leaf="true" data-offset-key="4877:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4878"><span data-slate-object="text" data-key="4879"><span data-slate-leaf="true" data-offset-key="4879:0" data-first-offset="true"><span data-slate-string="true">因为 PriorityQueue 里存放的可以是任何元素，用户也可以自定义比较关系，所以 Java 的 PQ 实现里引入了比较符和泛型的概念。&lt;T&gt; 就是 Java 中泛型相关的语法，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="4880"><span data-slate-object="text" data-key="4881"><span data-slate-leaf="true" data-offset-key="4881:0" data-first-offset="true"><span data-slate-string="true">siftUpUsingComparator </span></span></span></span><span data-slate-object="text" data-key="4882"><span data-slate-leaf="true" data-offset-key="4882:0" data-first-offset="true"><span data-slate-string="true">则给了用户自定义比较符的自由；不熟悉的同学可以自行搜索相关资料了解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4883"><span data-slate-object="text" data-key="4884"><span data-slate-leaf="true" data-offset-key="4884:0" data-first-offset="true"><span data-slate-string="true">我们直接看 siftUpComparable 方法，也就是元素类型自带比较方法的情况。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4885"><span data-slate-object="text" data-key="4886"><span data-slate-leaf="true" data-offset-key="4886:0" data-first-offset="true"><span data-slate-string="true">我们要比较这个新节点和父节点的值，那怎么定位父节点呢？回忆一下前面讲 queue 底层存储的时候讲过的父子节点关系，</span></span></span><span data-slate-object="text" data-key="4887"><span data-slate-leaf="true" data-offset-key="4887:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对 queue [k] 来说，它的父节点一定是 queue [(k-1)/2]。当然 k 需要大于 0，否则 k 就已经是根节点了</span></span></span></span><span data-slate-object="text" data-key="4888"><span data-slate-leaf="true" data-offset-key="4888:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4889"><span data-slate-object="text" data-key="4890"><span data-slate-leaf="true" data-offset-key="4890:0" data-first-offset="true"><span data-slate-string="true">所以 11-18 行的循环就是在做 siftUp 中和父节点比较并交换的操作，第 14 行就是对应 key 比 e 大，也就是子节点比父节点大的情况，此时我们就可以退出循环了。这也说明 PQ 默认情况下实现的是小顶堆。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4891" id="sr-toc-9"><span data-slate-object="text" data-key="4892"><span data-slate-leaf="true" data-offset-key="4892:0" data-first-offset="true"><span data-slate-string="true">删除的 poll 操作</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4893"><span data-slate-object="text" data-key="4894"><span data-slate-leaf="true" data-offset-key="4894:0" data-first-offset="true"><span data-slate-string="true">好，下面看 PQ 中第二个主要操作，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="4895"><span data-slate-object="text" data-key="4896"><span data-slate-leaf="true" data-offset-key="4896:0" data-first-offset="true"><span data-slate-string="true">poll</span></span></span></span><span data-slate-object="text" data-key="4897"><span data-slate-leaf="true" data-offset-key="4897:0" data-first-offset="true"><span data-slate-string="true"> 操作，这是我们返回并删除堆顶元素的操作，也就是从优先队列中取出最高优先级元素的操作。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="4898"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="4899"><span data-slate-object="text" data-key="4900"><span data-slate-leaf="true" data-offset-key="4900:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="4901"><span data-slate-leaf="true" data-offset-key="4901:0" data-first-offset="true"><span data-slate-string="true"> E </span></span></span><span data-slate-object="text" data-key="4902"><span data-slate-leaf="true" data-offset-key="4902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">poll</span></span></span></span><span data-slate-object="text" data-key="4903"><span data-slate-leaf="true" data-offset-key="4903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="4904"><span data-slate-leaf="true" data-offset-key="4904:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4905"><span data-slate-object="text" data-key="4906"><span data-slate-leaf="true" data-offset-key="4906:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4907"><span data-slate-leaf="true" data-offset-key="4907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="4908"><span data-slate-leaf="true" data-offset-key="4908:0" data-first-offset="true"><span data-slate-string="true"> Object[] es;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4909"><span data-slate-object="text" data-key="4910"><span data-slate-leaf="true" data-offset-key="4910:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4911"><span data-slate-leaf="true" data-offset-key="4911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="4912"><span data-slate-leaf="true" data-offset-key="4912:0" data-first-offset="true"><span data-slate-string="true"> E result;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4913"><span data-slate-object="text" data-key="4914"><span data-slate-leaf="true" data-offset-key="4914:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4915"><span data-slate-leaf="true" data-offset-key="4915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 取出堆顶元素</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4916"><span data-slate-object="text" data-key="4917"><span data-slate-leaf="true" data-offset-key="4917:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4918"><span data-slate-leaf="true" data-offset-key="4918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4919"><span data-slate-leaf="true" data-offset-key="4919:0" data-first-offset="true"><span data-slate-string="true"> ((result = (E) ((es = queue)[</span></span></span><span data-slate-object="text" data-key="4920"><span data-slate-leaf="true" data-offset-key="4920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4921"><span data-slate-leaf="true" data-offset-key="4921:0" data-first-offset="true"><span data-slate-string="true">])) != </span></span></span><span data-slate-object="text" data-key="4922"><span data-slate-leaf="true" data-offset-key="4922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="4923"><span data-slate-leaf="true" data-offset-key="4923:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4924"><span data-slate-object="text" data-key="4925"><span data-slate-leaf="true" data-offset-key="4925:0" data-first-offset="true"><span data-slate-string="true">        modCount++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4926"><span data-slate-object="text" data-key="4927"><span data-slate-leaf="true" data-offset-key="4927:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4928"><span data-slate-leaf="true" data-offset-key="4928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="4929"><span data-slate-leaf="true" data-offset-key="4929:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4930"><span data-slate-leaf="true" data-offset-key="4930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="4931"><span data-slate-leaf="true" data-offset-key="4931:0" data-first-offset="true"><span data-slate-string="true"> n;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4932"><span data-slate-object="text" data-key="4933"><span data-slate-leaf="true" data-offset-key="4933:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4934"><span data-slate-leaf="true" data-offset-key="4934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 其实就是要将最后一个元素放到顶部</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4935"><span data-slate-object="text" data-key="4936"><span data-slate-leaf="true" data-offset-key="4936:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4937"><span data-slate-leaf="true" data-offset-key="4937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="4938"><span data-slate-leaf="true" data-offset-key="4938:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4939"><span data-slate-leaf="true" data-offset-key="4939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">E</span></span></span></span><span data-slate-object="text" data-key="4940"><span data-slate-leaf="true" data-offset-key="4940:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4941"><span data-slate-leaf="true" data-offset-key="4941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">x</span></span></span></span><span data-slate-object="text" data-key="4942"><span data-slate-leaf="true" data-offset-key="4942:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4943"><span data-slate-leaf="true" data-offset-key="4943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="4944"><span data-slate-leaf="true" data-offset-key="4944:0" data-first-offset="true"><span data-slate-string="true"> (E) es[(n = --size)];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4945"><span data-slate-object="text" data-key="4946"><span data-slate-leaf="true" data-offset-key="4946:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4947"><span data-slate-leaf="true" data-offset-key="4947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将最后一个元素置空</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4948"><span data-slate-object="text" data-key="4949"><span data-slate-leaf="true" data-offset-key="4949:0" data-first-offset="true"><span data-slate-string="true">        es[n] = </span></span></span><span data-slate-object="text" data-key="4950"><span data-slate-leaf="true" data-offset-key="4950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="4951"><span data-slate-leaf="true" data-offset-key="4951:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4952"><span data-slate-object="text" data-key="4953"><span data-slate-leaf="true" data-offset-key="4953:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4954"><span data-slate-leaf="true" data-offset-key="4954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 进行 siftdown 操作</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4955"><span data-slate-object="text" data-key="4956"><span data-slate-leaf="true" data-offset-key="4956:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4957"><span data-slate-leaf="true" data-offset-key="4957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4958"><span data-slate-leaf="true" data-offset-key="4958:0" data-first-offset="true"><span data-slate-string="true"> (n&gt; </span></span></span><span data-slate-object="text" data-key="4959"><span data-slate-leaf="true" data-offset-key="4959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4960"><span data-slate-leaf="true" data-offset-key="4960:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4961"><span data-slate-object="text" data-key="4962"><span data-slate-leaf="true" data-offset-key="4962:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4963"><span data-slate-leaf="true" data-offset-key="4963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="4964"><span data-slate-leaf="true" data-offset-key="4964:0" data-first-offset="true"><span data-slate-string="true"> Comparator&lt;? </span></span></span><span data-slate-object="text" data-key="4965"><span data-slate-leaf="true" data-offset-key="4965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="4966"><span data-slate-leaf="true" data-offset-key="4966:0" data-first-offset="true"><span data-slate-string="true"> E&gt; cmp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4967"><span data-slate-object="text" data-key="4968"><span data-slate-leaf="true" data-offset-key="4968:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4969"><span data-slate-leaf="true" data-offset-key="4969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4970"><span data-slate-leaf="true" data-offset-key="4970:0" data-first-offset="true"><span data-slate-string="true"> ((cmp = comparator) == </span></span></span><span data-slate-object="text" data-key="4971"><span data-slate-leaf="true" data-offset-key="4971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="4972"><span data-slate-leaf="true" data-offset-key="4972:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4973"><span data-slate-object="text" data-key="4974"><span data-slate-leaf="true" data-offset-key="4974:0" data-first-offset="true"><span data-slate-string="true">                siftDownComparable(</span></span></span><span data-slate-object="text" data-key="4975"><span data-slate-leaf="true" data-offset-key="4975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4976"><span data-slate-leaf="true" data-offset-key="4976:0" data-first-offset="true"><span data-slate-string="true">, x, es, n);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4977"><span data-slate-object="text" data-key="4978"><span data-slate-leaf="true" data-offset-key="4978:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4979"><span data-slate-leaf="true" data-offset-key="4979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4980"><span data-slate-object="text" data-key="4981"><span data-slate-leaf="true" data-offset-key="4981:0" data-first-offset="true"><span data-slate-string="true">                siftDownUsingComparator(</span></span></span><span data-slate-object="text" data-key="4982"><span data-slate-leaf="true" data-offset-key="4982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4983"><span data-slate-leaf="true" data-offset-key="4983:0" data-first-offset="true"><span data-slate-string="true">, x, es, n, cmp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4984"><span data-slate-object="text" data-key="4985"><span data-slate-leaf="true" data-offset-key="4985:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4986"><span data-slate-object="text" data-key="4987"><span data-slate-leaf="true" data-offset-key="4987:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4988"><span data-slate-object="text" data-key="4989"><span data-slate-leaf="true" data-offset-key="4989:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4990"><span data-slate-leaf="true" data-offset-key="4990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4991"><span data-slate-leaf="true" data-offset-key="4991:0" data-first-offset="true"><span data-slate-string="true"> result;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4992"><span data-slate-object="text" data-key="4993"><span data-slate-leaf="true" data-offset-key="4993:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4994"><span data-slate-object="text" data-key="4995"><span data-slate-leaf="true" data-offset-key="4995:0" data-first-offset="true"><span data-slate-string="true">重点理解第 7 行和关键的 siftDown 函数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4996"><span data-slate-object="text" data-key="4997"><span data-slate-leaf="true" data-offset-key="4997:0" data-first-offset="true"><span data-slate-string="true">要取出堆顶元素，数组第一个元素就会有所空缺。基于 siftUp 的想法（还是用刚才的大顶堆），我们第一反应很容易想到，直接从空缺的根节点开始，找其左右子节点中大的一个提拔到当前空缺的位置，然后依次找新的空位左右子节点哪个位置可以提拔上来，直到没有子节点为止。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4998"><span data-slate-object="text" data-key="4999"><span data-slate-leaf="true" data-offset-key="4999:0" data-first-offset="true"><span data-slate-string="true">这个思路确实很自然，但有一个比较大的问题就是，如果我们在第一次比较的时候选择了左节点提升上来，当右节点并不为空时，最后得到的树一定不是一个满二叉树了，这就破坏了堆的基本性质。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5000"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a8/21/a8ea7c6bd1d46c96aaca2c4c0da1ca21.jpg?wh=1920x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5001"><span data-slate-object="text" data-key="5002"><span data-slate-leaf="true" data-offset-key="5002:0" data-first-offset="true"><span data-slate-string="true">那怎么做呢？一个比较巧妙的想法就是和代码里第 7 行一样，将根节点删除后，我们把二叉堆中最后的元素提到根节点的位置，这样又可以保证新的二叉树是一颗满二叉树了，然后要做的就和前面所说的一样，比较 + 交换。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5003"><span data-slate-object="text" data-key="5004"><span data-slate-leaf="true" data-offset-key="5004:0" data-first-offset="true"><span data-slate-string="true">看大顶堆的例子，现在要删掉最大的元素 92，怎么做呢？首先把堆中最后一个节点也就是 47 提到堆顶的空位，然后依次比较左右节点；47 比 90、79 都小，但 90 更大，所以我们用 47 和 90 进行交换。同理 47 和 76 也需要交换。这样我们就完成了优先队列优先级最高元素出队的操作。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5005"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ab/db/abfff0c466175ab7427127784a14b5db.jpg?wh=1920x1145"></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5006" id="sr-toc-10"><span data-slate-object="text" data-key="5007"><span data-slate-leaf="true" data-offset-key="5007:0" data-first-offset="true"><span data-slate-string="true">siftDown 函数</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5008"><span data-slate-object="text" data-key="5009"><span data-slate-leaf="true" data-offset-key="5009:0" data-first-offset="true"><span data-slate-string="true">回到代码，这里说的比较 + 交换的过程就是由 siftDown 这个函数完成的：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="5010"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5011"><span data-slate-object="text" data-key="5012"><span data-slate-leaf="true" data-offset-key="5012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="5013"><span data-slate-leaf="true" data-offset-key="5013:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5014"><span data-slate-leaf="true" data-offset-key="5014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="5015"><span data-slate-leaf="true" data-offset-key="5015:0" data-first-offset="true"><span data-slate-string="true"> &lt;T&gt; </span></span></span><span data-slate-object="text" data-key="5016"><span data-slate-leaf="true" data-offset-key="5016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="5017"><span data-slate-leaf="true" data-offset-key="5017:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5018"><span data-slate-leaf="true" data-offset-key="5018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">siftDownComparable</span></span></span></span><span data-slate-object="text" data-key="5019"><span data-slate-leaf="true" data-offset-key="5019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="5020"><span data-slate-leaf="true" data-offset-key="5020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="5021"><span data-slate-leaf="true" data-offset-key="5021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> k, T x, Object[] es, </span></span></span></span><span data-slate-object="text" data-key="5022"><span data-slate-leaf="true" data-offset-key="5022:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="5023"><span data-slate-leaf="true" data-offset-key="5023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> n)</span></span></span></span><span data-slate-object="text" data-key="5024"><span data-slate-leaf="true" data-offset-key="5024:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5025"><span data-slate-object="text" data-key="5026"><span data-slate-leaf="true" data-offset-key="5026:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5027"><span data-slate-leaf="true" data-offset-key="5027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// assert n &gt; 0;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5028"><span data-slate-object="text" data-key="5029"><span data-slate-leaf="true" data-offset-key="5029:0" data-first-offset="true"><span data-slate-string="true">    Comparable&lt;? </span></span></span><span data-slate-object="text" data-key="5030"><span data-slate-leaf="true" data-offset-key="5030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="5031"><span data-slate-leaf="true" data-offset-key="5031:0" data-first-offset="true"><span data-slate-string="true"> T&gt; key = (Comparable&lt;? </span></span></span><span data-slate-object="text" data-key="5032"><span data-slate-leaf="true" data-offset-key="5032:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="5033"><span data-slate-leaf="true" data-offset-key="5033:0" data-first-offset="true"><span data-slate-string="true"> T&gt;)x;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5034"><span data-slate-object="text" data-key="5035"><span data-slate-leaf="true" data-offset-key="5035:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5036"><span data-slate-leaf="true" data-offset-key="5036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5037"><span data-slate-leaf="true" data-offset-key="5037:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5038"><span data-slate-leaf="true" data-offset-key="5038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">half</span></span></span></span><span data-slate-object="text" data-key="5039"><span data-slate-leaf="true" data-offset-key="5039:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5040"><span data-slate-leaf="true" data-offset-key="5040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5041"><span data-slate-leaf="true" data-offset-key="5041:0" data-first-offset="true"><span data-slate-string="true"> n &gt;&gt;&gt; </span></span></span><span data-slate-object="text" data-key="5042"><span data-slate-leaf="true" data-offset-key="5042:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="5043"><span data-slate-leaf="true" data-offset-key="5043:0" data-first-offset="true"><span data-slate-string="true">;           </span></span></span><span data-slate-object="text" data-key="5044"><span data-slate-leaf="true" data-offset-key="5044:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// loop while a non-leaf</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5045"><span data-slate-object="text" data-key="5046"><span data-slate-leaf="true" data-offset-key="5046:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5047"><span data-slate-leaf="true" data-offset-key="5047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="5048"><span data-slate-leaf="true" data-offset-key="5048:0" data-first-offset="true"><span data-slate-string="true"> (k &lt; half) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5049"><span data-slate-object="text" data-key="5050"><span data-slate-leaf="true" data-offset-key="5050:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5051"><span data-slate-leaf="true" data-offset-key="5051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5052"><span data-slate-leaf="true" data-offset-key="5052:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5053"><span data-slate-leaf="true" data-offset-key="5053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">child</span></span></span></span><span data-slate-object="text" data-key="5054"><span data-slate-leaf="true" data-offset-key="5054:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5055"><span data-slate-leaf="true" data-offset-key="5055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5056"><span data-slate-leaf="true" data-offset-key="5056:0" data-first-offset="true"><span data-slate-string="true"> (k &lt;&lt; </span></span></span><span data-slate-object="text" data-key="5057"><span data-slate-leaf="true" data-offset-key="5057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="5058"><span data-slate-leaf="true" data-offset-key="5058:0" data-first-offset="true"><span data-slate-string="true">) + </span></span></span><span data-slate-object="text" data-key="5059"><span data-slate-leaf="true" data-offset-key="5059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="5060"><span data-slate-leaf="true" data-offset-key="5060:0" data-first-offset="true"><span data-slate-string="true">; </span></span></span><span data-slate-object="text" data-key="5061"><span data-slate-leaf="true" data-offset-key="5061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// assume left child is least</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5062"><span data-slate-object="text" data-key="5063"><span data-slate-leaf="true" data-offset-key="5063:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5064"><span data-slate-leaf="true" data-offset-key="5064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Object</span></span></span></span><span data-slate-object="text" data-key="5065"><span data-slate-leaf="true" data-offset-key="5065:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5066"><span data-slate-leaf="true" data-offset-key="5066:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">c</span></span></span></span><span data-slate-object="text" data-key="5067"><span data-slate-leaf="true" data-offset-key="5067:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5068"><span data-slate-leaf="true" data-offset-key="5068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5069"><span data-slate-leaf="true" data-offset-key="5069:0" data-first-offset="true"><span data-slate-string="true"> es[child];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5070"><span data-slate-object="text" data-key="5071"><span data-slate-leaf="true" data-offset-key="5071:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5072"><span data-slate-leaf="true" data-offset-key="5072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5073"><span data-slate-leaf="true" data-offset-key="5073:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5074"><span data-slate-leaf="true" data-offset-key="5074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">right</span></span></span></span><span data-slate-object="text" data-key="5075"><span data-slate-leaf="true" data-offset-key="5075:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5076"><span data-slate-leaf="true" data-offset-key="5076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5077"><span data-slate-leaf="true" data-offset-key="5077:0" data-first-offset="true"><span data-slate-string="true"> child + </span></span></span><span data-slate-object="text" data-key="5078"><span data-slate-leaf="true" data-offset-key="5078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="5079"><span data-slate-leaf="true" data-offset-key="5079:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5080"><span data-slate-object="text" data-key="5081"><span data-slate-leaf="true" data-offset-key="5081:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5082"><span data-slate-leaf="true" data-offset-key="5082:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5083"><span data-slate-leaf="true" data-offset-key="5083:0" data-first-offset="true"><span data-slate-string="true"> (right &lt; n &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5084"><span data-slate-object="text" data-key="5085"><span data-slate-leaf="true" data-offset-key="5085:0" data-first-offset="true"><span data-slate-string="true">            ((Comparable&lt;? </span></span></span><span data-slate-object="text" data-key="5086"><span data-slate-leaf="true" data-offset-key="5086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="5087"><span data-slate-leaf="true" data-offset-key="5087:0" data-first-offset="true"><span data-slate-string="true"> T&gt;) c).compareTo((T) es[right]) &gt; </span></span></span><span data-slate-object="text" data-key="5088"><span data-slate-leaf="true" data-offset-key="5088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="5089"><span data-slate-leaf="true" data-offset-key="5089:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5090"><span data-slate-object="text" data-key="5091"><span data-slate-leaf="true" data-offset-key="5091:0" data-first-offset="true"><span data-slate-string="true">            c = es[child = right];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5092"><span data-slate-object="text" data-key="5093"><span data-slate-leaf="true" data-offset-key="5093:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5094"><span data-slate-leaf="true" data-offset-key="5094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5095"><span data-slate-leaf="true" data-offset-key="5095:0" data-first-offset="true"><span data-slate-string="true"> (key.compareTo((T) c) &lt;= </span></span></span><span data-slate-object="text" data-key="5096"><span data-slate-leaf="true" data-offset-key="5096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="5097"><span data-slate-leaf="true" data-offset-key="5097:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5098"><span data-slate-object="text" data-key="5099"><span data-slate-leaf="true" data-offset-key="5099:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="5100"><span data-slate-leaf="true" data-offset-key="5100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span><span data-slate-object="text" data-key="5101"><span data-slate-leaf="true" data-offset-key="5101:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5102"><span data-slate-object="text" data-key="5103"><span data-slate-leaf="true" data-offset-key="5103:0" data-first-offset="true"><span data-slate-string="true">        es[k] = c;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5104"><span data-slate-object="text" data-key="5105"><span data-slate-leaf="true" data-offset-key="5105:0" data-first-offset="true"><span data-slate-string="true">        k = child;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5106"><span data-slate-object="text" data-key="5107"><span data-slate-leaf="true" data-offset-key="5107:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5108"><span data-slate-object="text" data-key="5109"><span data-slate-leaf="true" data-offset-key="5109:0" data-first-offset="true"><span data-slate-string="true">    es[k] = key;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5110"><span data-slate-object="text" data-key="5111"><span data-slate-leaf="true" data-offset-key="5111:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5112"><span data-slate-object="text" data-key="5113"><span data-slate-leaf="true" data-offset-key="5113:0" data-first-offset="true"><span data-slate-string="true">5-14 行就是之前所说的父亲节点和左右子节点循环比较并交换的过程。k 的左子节点下标为 (k&lt;&lt;1)+1，右子节点下标为左子节点 +1，这就是 6 行和 8 行代码的意义。在发现左右子节点都比根节点小之后，同样可以退出循环，否则和左右节点中小的一个交换即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5114"><span data-slate-object="text" data-key="5115"><span data-slate-leaf="true" data-offset-key="5115:0" data-first-offset="true"><span data-slate-string="true">嗯，如果只是要查看优先级最高的节点而不用出队，当然是非常简单了，我们直接取堆顶元素即可。也就是之前 PQ 定义的这几行代码：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="5116"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5117"><span data-slate-object="text" data-key="5118"><span data-slate-leaf="true" data-offset-key="5118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="5119"><span data-slate-leaf="true" data-offset-key="5119:0" data-first-offset="true"><span data-slate-string="true"> E </span></span></span><span data-slate-object="text" data-key="5120"><span data-slate-leaf="true" data-offset-key="5120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">peek</span></span></span></span><span data-slate-object="text" data-key="5121"><span data-slate-leaf="true" data-offset-key="5121:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="5122"><span data-slate-leaf="true" data-offset-key="5122:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5123"><span data-slate-object="text" data-key="5124"><span data-slate-leaf="true" data-offset-key="5124:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5125"><span data-slate-leaf="true" data-offset-key="5125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5126"><span data-slate-leaf="true" data-offset-key="5126:0" data-first-offset="true"><span data-slate-string="true"> (E) queue[</span></span></span><span data-slate-object="text" data-key="5127"><span data-slate-leaf="true" data-offset-key="5127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="5128"><span data-slate-leaf="true" data-offset-key="5128:0" data-first-offset="true"><span data-slate-string="true">];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5129"><span data-slate-object="text" data-key="5130"><span data-slate-leaf="true" data-offset-key="5130:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5131" id="sr-toc-11"><span data-slate-object="text" data-key="5132"><span data-slate-leaf="true" data-offset-key="5132:0" data-first-offset="true"><span data-slate-string="true">扩容机制</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5133"><span data-slate-object="text" data-key="5134"><span data-slate-leaf="true" data-offset-key="5134:0" data-first-offset="true"><span data-slate-string="true">那，最后我们来讲讲 PQ 的扩容机制，这是 PQ 虽然用数组作为底层存储，却不用限制优先队列大小的核心。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="5135"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5136"><span data-slate-object="text" data-key="5137"><span data-slate-leaf="true" data-offset-key="5137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5138"><span data-slate-object="text" data-key="5139"><span data-slate-leaf="true" data-offset-key="5139:0" data-first-offset="true"><span data-slate-string="true"> * Increases the capacity of the array.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5140"><span data-slate-object="text" data-key="5141"><span data-slate-leaf="true" data-offset-key="5141:0" data-first-offset="true"><span data-slate-string="true"> *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5142"><span data-slate-object="text" data-key="5143"><span data-slate-leaf="true" data-offset-key="5143:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="5144"><span data-slate-leaf="true" data-offset-key="5144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="5145"><span data-slate-leaf="true" data-offset-key="5145:0" data-first-offset="true"><span data-slate-string="true"> minCapacity the desired minimum capacity</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5146"><span data-slate-object="text" data-key="5147"><span data-slate-leaf="true" data-offset-key="5147:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5148"><span data-slate-object="text" data-key="5149"><span data-slate-leaf="true" data-offset-key="5149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="5150"><span data-slate-leaf="true" data-offset-key="5150:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5151"><span data-slate-leaf="true" data-offset-key="5151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="5152"><span data-slate-leaf="true" data-offset-key="5152:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5153"><span data-slate-leaf="true" data-offset-key="5153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">grow</span></span></span></span><span data-slate-object="text" data-key="5154"><span data-slate-leaf="true" data-offset-key="5154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="5155"><span data-slate-leaf="true" data-offset-key="5155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="5156"><span data-slate-leaf="true" data-offset-key="5156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> minCapacity)</span></span></span></span><span data-slate-object="text" data-key="5157"><span data-slate-leaf="true" data-offset-key="5157:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5158"><span data-slate-object="text" data-key="5159"><span data-slate-leaf="true" data-offset-key="5159:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5160"><span data-slate-leaf="true" data-offset-key="5160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5161"><span data-slate-leaf="true" data-offset-key="5161:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5162"><span data-slate-leaf="true" data-offset-key="5162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">oldCapacity</span></span></span></span><span data-slate-object="text" data-key="5163"><span data-slate-leaf="true" data-offset-key="5163:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5164"><span data-slate-leaf="true" data-offset-key="5164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5165"><span data-slate-leaf="true" data-offset-key="5165:0" data-first-offset="true"><span data-slate-string="true"> queue.length;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5166"><span data-slate-object="text" data-key="5167"><span data-slate-leaf="true" data-offset-key="5167:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5168"><span data-slate-leaf="true" data-offset-key="5168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Double size if small; else grow by 50%</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5169"><span data-slate-object="text" data-key="5170"><span data-slate-leaf="true" data-offset-key="5170:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5171"><span data-slate-leaf="true" data-offset-key="5171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5172"><span data-slate-leaf="true" data-offset-key="5172:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5173"><span data-slate-leaf="true" data-offset-key="5173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">newCapacity</span></span></span></span><span data-slate-object="text" data-key="5174"><span data-slate-leaf="true" data-offset-key="5174:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5175"><span data-slate-leaf="true" data-offset-key="5175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="5176"><span data-slate-leaf="true" data-offset-key="5176:0" data-first-offset="true"><span data-slate-string="true"> ArraysSupport.newLength(oldCapacity,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5177"><span data-slate-object="text" data-key="5178"><span data-slate-leaf="true" data-offset-key="5178:0" data-first-offset="true"><span data-slate-string="true">            minCapacity - oldCapacity, </span></span></span><span data-slate-object="text" data-key="5179"><span data-slate-leaf="true" data-offset-key="5179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* minimum growth */</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5180"><span data-slate-object="text" data-key="5181"><span data-slate-leaf="true" data-offset-key="5181:0" data-first-offset="true"><span data-slate-string="true">            oldCapacity &lt; </span></span></span><span data-slate-object="text" data-key="5182"><span data-slate-leaf="true" data-offset-key="5182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">64</span></span></span></span><span data-slate-object="text" data-key="5183"><span data-slate-leaf="true" data-offset-key="5183:0" data-first-offset="true"><span data-slate-string="true"> ? oldCapacity + </span></span></span><span data-slate-object="text" data-key="5184"><span data-slate-leaf="true" data-offset-key="5184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="5185"><span data-slate-leaf="true" data-offset-key="5185:0" data-first-offset="true"><span data-slate-string="true"> : oldCapacity &gt;&gt; </span></span></span><span data-slate-object="text" data-key="5186"><span data-slate-leaf="true" data-offset-key="5186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5187"><span data-slate-object="text" data-key="5188"><span data-slate-leaf="true" data-offset-key="5188:0" data-first-offset="true"><span data-slate-string="true">                                       </span></span></span><span data-slate-object="text" data-key="5189"><span data-slate-leaf="true" data-offset-key="5189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* preferred growth */</span></span></span></span><span data-slate-object="text" data-key="5190"><span data-slate-leaf="true" data-offset-key="5190:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5191"><span data-slate-object="text" data-key="5192"><span data-slate-leaf="true" data-offset-key="5192:0" data-first-offset="true"><span data-slate-string="true">    queue = Arrays.copyOf(queue, newCapacity);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5193"><span data-slate-object="text" data-key="5194"><span data-slate-leaf="true" data-offset-key="5194:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5195"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5196"><span data-slate-object="text" data-key="5197"><span data-slate-leaf="true" data-offset-key="5197:0" data-first-offset="true"><span data-slate-string="true">本质和之前讲的 STL 中的 vector 扩容思想如出一辙，就是将当前的数组搬到一段更大的连续数组中，新的数组容量为 newCapacity，旧的数组容量为 oldCapacity。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5198"><span data-slate-object="text" data-key="5199"><span data-slate-leaf="true" data-offset-key="5199:0" data-first-offset="true"><span data-slate-string="true">它俩的关系在第 11 行中可以看出来：如果原来的数组已经比较大了，那新数组的大小是旧数组大小的 1.5 倍，否则是 2 倍再 +2。至于为什么要成倍增长，你可以回看 vector 的章节，都是为了保证良好的均摊时间复杂度。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5200"><span data-slate-object="text" data-key="5201"><span data-slate-leaf="true" data-offset-key="5201:0" data-first-offset="true"><span data-slate-string="true">用于计算容量的 newLength 的方法还有个参数用于保证最小的扩容大小，如果你感兴趣可以自己研究一下。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5202" id="sr-toc-12"><span data-slate-object="text" data-key="5203"><span data-slate-leaf="true" data-offset-key="5203:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5204"><span data-slate-object="text" data-key="5205"><span data-slate-leaf="true" data-offset-key="5205:0" data-first-offset="true"><span data-slate-string="true">学完了 JDK 中 PriorityQueue 的主要实现机制和源码，现在你有没有掌握用数组模拟树的技巧呢？如果让你手写一个堆应该也不难了吧，这也是面试中算法的常考题目。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5206"><span data-slate-object="text" data-key="5207"><span data-slate-leaf="true" data-offset-key="5207:0" data-first-offset="true"><span data-slate-string="true">核心就是数组中父子节点的下标关系。下标为 k 的节点 queue [k]，它的左子节点为 queue [2</span></span></span><span data-slate-object="text" data-key="5208"><span data-slate-leaf="true" data-offset-key="5208:0" data-first-offset="true"><span data-slate-type="italic" data-slate-object="mark"><span data-slate-string="true">k+1]，右子节点为 queue [2</span></span></span></span><span data-slate-object="text" data-key="5209"><span data-slate-leaf="true" data-offset-key="5209:0" data-first-offset="true"><span data-slate-string="true">k+2]。理解了这一点，去实现 siftDown 和 siftUp 操作，相信对你来说不在话下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5210"><span data-slate-object="text" data-key="5211"><span data-slate-leaf="true" data-offset-key="5211:0" data-first-offset="true"><span data-slate-string="true">当然 JDK 为了提供一个更通用的优先队列，也引入了泛型，也提供了动态扩容的能力，这些内容和动态数组的实现非常相似的，你可以回去复习并尝试手写实现一下。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5212" id="sr-toc-13"><span data-slate-object="text" data-key="5213"><span data-slate-leaf="true" data-offset-key="5213:0" data-first-offset="true"><span data-slate-string="true">课后作业</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5214"><span data-slate-object="text" data-key="5215"><span data-slate-leaf="true" data-offset-key="5215:0" data-first-offset="true"><span data-slate-string="true">有了堆，实现优先队列的语义其实并不难。但有个问题想问问你，你觉得 Java 的优先队列是否真正保证了优先队列语义呢？比如优先队列中相同优先级的元素，是否应该要保证先进先出的特性？如果，JDK 中的没有这个保证，但我们却有这样的需求，你觉得应该如何改造呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5216"><span data-slate-object="text" data-key="5217"><span data-slate-leaf="true" data-offset-key="5217:0" data-first-offset="true"><span data-slate-string="true">这是一个开放问题，欢迎你在留言区参与讨论。如果你觉得这篇文章对你有帮助，也欢迎你转发给身边的朋友一起学习。我们下节课见～</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ae/c9/ae3f84a7816a06b6d618fcca689457c9.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-14">精选留言 (6)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Paul Shan</span></div></div><div>堆排序并不是稳定排序，所以相同序号没法做到先进后出，如果要保证先进先出，一种方法是再加一层，每个节点用一个队列而不是简单的节点表示，这样所有权值相同的节点就进入了一个队列，然后用这个队列保证先进先出。还有一种方法是修改对键值的定义，也就是把时间因素考虑近来，让时间作为排序的次要因子，这样就可以保证键值唯一。</div><div><p>作者回复：正解</p></div><div><div>2021-12-25</div><div><div><i></i><span>5</span></div><div><i></i><span>15</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/78/dc/bcdb3287.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 丶</span></div></div><div>昊哥，能不能讲解一下每篇文章后问题的答案呀？感觉自己心里有了答案，但是没有一个参考，总感觉不大对</div><div><p>作者回复：好的好的 不过一般都会有同学回复的还不错的 我回头看看是不是可以置顶之类的～</p></div><div><div>2021-12-28</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/09/2e/4badf056.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 余先声</span></div></div><div>要保证相同优先级的元素也需要保证 FIFO 的特性，那么可以新引入一个自增 id 的概念。比较器当判断优先级相等的时候，就按 id 的大小进行排序，id 小的在前，大的在后</div><div><div>2022-05-15</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/ff/e9/276b9753.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>SevenHe</span></div></div><div>一点收获，在遇到满二叉树或稠密二叉树的场景时，可以考虑用数组来存放，有如下优势：
1. 空间利用率高，比起指针的方式，也更满足内存局部性原理
2. 无需后继节点指针，内存占用也更小
3. 寻址效率高，结合位运算即可快速寻址</div><div><div>2022-03-22</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/7e/50/63749d73.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>muyinliu</span></div></div><div>这也说明 PQ 默认情况下实现的是小顶堆。
---
是否可以考虑把图都换成小顶堆的图，我第一次看本章的时候很疑惑，总觉得图和代码对不上号</div><div><p>作者回复：好的 我之后修改一下～</p></div><div><div>2022-03-21</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>ZeroIce</span></div></div><div>上面那个满二叉树是不是和完全二叉树混淆？</div><div><div>2022-02-07</div><div><div><i></i><span>1</span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".p"><outline class="toc-level-h1" data-reactid=".p.0" style="width: 175px;"><active data-reactid=".p.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".p.0.1"><span data-reactid=".p.0.1.0">07｜堆：如何实现一个高效的优先队列？</span></a></outline><outline class="toc-level-h3" data-reactid=".p.1" style="width: 155px;"><active data-reactid=".p.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".p.1.1"><span data-reactid=".p.1.1.0">优先队列</span></a></outline><outline class="toc-level-h3" data-reactid=".p.2" style="width: 155px;"><active data-reactid=".p.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".p.2.1"><span data-reactid=".p.2.1.0">如何实现</span></a></outline><outline class="toc-level-h2" data-reactid=".p.3" style="width: 165px;"><active data-reactid=".p.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".p.3.1"><span data-reactid=".p.3.1.0">二叉堆</span></a></outline><outline class="toc-level-h3" data-reactid=".p.4" style="width: 155px;"><active data-reactid=".p.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".p.4.1"><span data-reactid=".p.4.1.0">为什么这么设计</span></a></outline><outline class="toc-level-h3" data-reactid=".p.5" style="width: 155px;"><active data-reactid=".p.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".p.5.1"><span data-reactid=".p.5.1.0">PriorityQueue 的实现</span></a></outline><outline class="toc-level-h2" data-reactid=".p.6" style="width: 165px;"><active data-reactid=".p.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".p.6.1"><span data-reactid=".p.6.1.0">堆的操作</span></a></outline><outline class="toc-level-h3" data-reactid=".p.7" style="width: 155px;"><active data-reactid=".p.7.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".p.7.1"><span data-reactid=".p.7.1.0">grow 函数</span></a></outline><outline class="toc-level-h3" data-reactid=".p.8" style="width: 155px;"><active data-reactid=".p.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".p.8.1"><span data-reactid=".p.8.1.0">siftUp 函数</span></a></outline><outline class="toc-level-h3" data-reactid=".p.9" style="width: 155px;"><active data-reactid=".p.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".p.9.1"><span data-reactid=".p.9.1.0">删除的 poll 操作</span></a></outline><outline class="toc-level-h3" data-reactid=".p.a" style="width: 155px;"><active data-reactid=".p.a.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".p.a.1"><span data-reactid=".p.a.1.0">siftDown 函数</span></a></outline><outline class="toc-level-h3" data-reactid=".p.b" style="width: 155px;"><active data-reactid=".p.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".p.b.1"><span data-reactid=".p.b.1.0">扩容机制</span></a></outline><outline class="toc-level-h2" data-reactid=".p.c" style="width: 165px;"><active data-reactid=".p.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".p.c.1"><span data-reactid=".p.c.1.0">总结</span></a></outline><outline class="toc-level-h3" data-reactid=".p.d" style="width: 155px;"><active data-reactid=".p.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".p.d.1"><span data-reactid=".p.d.1.0">课后作业</span></a></outline><outline class="toc-level-h2" data-reactid=".p.e" style="width: 165px;"><active data-reactid=".p.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".p.e.1"><span data-reactid=".p.e.1.0">精选留言 (6)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/472166" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>