
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 24 | Web 服务：Web 服务核心功能有哪些，如何实现？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>24 | Web 服务：Web 服务核心功能有哪些，如何实现？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">这一讲我们来了解目前业界有哪些优秀的开源日志包，以及手把手教你从 0 编写一个日志包</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 24 | Web 服务：Web 服务核心功能有哪些，如何实现？</h1><div><span>孔令飞</span> <span> 2021-07-20</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/fc/b7/fcff4223eff78byy8ce1ec7e2d93c4b7.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：16.15M</span><span> 时长：17:40</span></div></div><audio title="24 | Web 服务：Web 服务核心功能有哪些，如何实现？" src="https://res001.geekbang.org/media/audio/e4/69/e4aaa191c0fc7174a8257ff4c4db5569/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="5111" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="5112"><span data-slate-object="text" data-key="5113"><span data-slate-leaf="true" data-offset-key="5113:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。从今天开始，我们进入实战第三站：服务开发。在这个部分，我会讲解 IAM 项目各个服务的构建方式，帮助你掌握 Go 开发阶段的各个技能点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5114"><span data-slate-object="text" data-key="5115"><span data-slate-leaf="true" data-offset-key="5115:0" data-first-offset="true"><span data-slate-string="true">在 Go 项目开发中，绝大部分情况下，我们是在写能提供某种功能的后端服务，这些功能以 RPC API 接口或者 RESTful API 接口的形式对外提供，能提供这两种 API 接口的服务也统称为 Web 服务。今天这一讲，我就通过介绍 RESTful API 风格的 Web 服务，来给你介绍下如何实现 Web 服务的核心功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5116"><span data-slate-object="text" data-key="5117"><span data-slate-leaf="true" data-offset-key="5117:0" data-first-offset="true"><span data-slate-string="true">那今天我们就来看下，Web 服务的核心功能有哪些，以及如何开发这些功能。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5118" id="sr-toc-1"><span data-slate-object="text" data-key="5119"><span data-slate-leaf="true" data-offset-key="5119:0" data-first-offset="true"><span data-slate-string="true">Web 服务的核心功能</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5120"><span data-slate-object="text" data-key="5121"><span data-slate-leaf="true" data-offset-key="5121:0" data-first-offset="true"><span data-slate-string="true">Web 服务有很多功能，为了便于你理解，我将这些功能分成了基础功能和高级功能两大类，并总结在了下面这张图中：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5122"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1a/2e/1a6d38450cdd0e115e505ab30113602e.jpg?wh=2248x1835"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5123"><span data-slate-object="text" data-key="5124"><span data-slate-leaf="true" data-offset-key="5124:0" data-first-offset="true"><span data-slate-string="true">下面，我就按图中的顺序，来串讲下这些功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5125"><span data-slate-object="text" data-key="5126"><span data-slate-leaf="true" data-offset-key="5126:0" data-first-offset="true"><span data-slate-string="true">要实现一个 Web 服务，首先我们要选择通信协议和通信格式。在 Go 项目开发中，有 HTTP+JSON 和 gRPC+Protobuf 两种组合可选。因为 iam-apiserver 主要提供的是 REST 风格的 API 接口，所以选择的是 HTTP+JSON 组合。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5127"><span data-slate-object="text" data-key="5128"><span data-slate-leaf="true" data-offset-key="5128:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Web 服务最核心的功能是路由匹配。</span></span></span></span><span data-slate-object="text" data-key="5129"><span data-slate-leaf="true" data-offset-key="5129:0" data-first-offset="true"><span data-slate-string="true">路由匹配其实就是根据</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="5130"><span data-slate-object="text" data-key="5131"><span data-slate-leaf="true" data-offset-key="5131:0" data-first-offset="true"><span data-slate-string="true"> (HTTP 方法，请求路径)</span></span></span></span><span data-slate-object="text" data-key="5132"><span data-slate-leaf="true" data-offset-key="5132:0" data-first-offset="true"><span data-slate-string="true"> 匹配到处理这个请求的函数，最终由该函数处理这次请求，并返回结果，过程如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5133"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/9d/1f5yydeffb32732e7d0e23a0a9cd369d.jpg?wh=2248x975"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5134"><span data-slate-object="text" data-key="5135"><span data-slate-leaf="true" data-offset-key="5135:0" data-first-offset="true"><span data-slate-string="true">一次 HTTP 请求经过路由匹配，最终将请求交由</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="5136"><span data-slate-object="text" data-key="5137"><span data-slate-leaf="true" data-offset-key="5137:0" data-first-offset="true"><span data-slate-string="true"> Delete(c *gin.Context)</span></span></span></span><span data-slate-object="text" data-key="5138"><span data-slate-leaf="true" data-offset-key="5138:0" data-first-offset="true"><span data-slate-string="true"> 函数来处理。变量</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="5139"><span data-slate-object="text" data-key="5140"><span data-slate-leaf="true" data-offset-key="5140:0" data-first-offset="true"><span data-slate-string="true"> c</span></span></span></span><span data-slate-object="text" data-key="5141"><span data-slate-leaf="true" data-offset-key="5141:0" data-first-offset="true"><span data-slate-string="true"> 中存放了这次请求的参数，在 Delete 函数中，我们可以进行参数解析、参数校验、逻辑处理，最终返回结果。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5142"><span data-slate-object="text" data-key="5143"><span data-slate-leaf="true" data-offset-key="5143:0" data-first-offset="true"><span data-slate-string="true">对于大型系统，可能会有很多个 API 接口，API 接口随着需求的更新迭代，可能会有多个版本，为了便于管理，我们需要</span></span></span><span data-slate-object="text" data-key="5144"><span data-slate-leaf="true" data-offset-key="5144:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对路由进行分组</span></span></span></span><span data-slate-object="text" data-key="5145"><span data-slate-leaf="true" data-offset-key="5145:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5146"><span data-slate-object="text" data-key="5147"><span data-slate-leaf="true" data-offset-key="5147:0" data-first-offset="true"><span data-slate-string="true">有时候，我们需要在一个服务进程中，同时开启 HTTP 服务的 80 端口和 HTTPS 的 443 端口，</span></span><span data-slate-leaf="true" data-offset-key="5147:1"><span data-slate-object="annotation" data-annotation-key="gkann_2cabc945" data-attr-id="43460" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">这样我们就可以做到：对内的服务，访问 80 端口，简化服务访问复杂度；对外的服务，访问更为安全的 HTTPS 服务。</span></span></span><span data-slate-leaf="true" data-offset-key="5147:2"><span data-slate-string="true">显然，我们没必要为相同功能启动多个服务进程，所以这时候就需要 Web 服务能够支持</span></span></span><span data-slate-object="text" data-key="5148"><span data-slate-leaf="true" data-offset-key="5148:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">一进程多服务</span></span></span></span><span data-slate-object="text" data-key="5149"><span data-slate-leaf="true" data-offset-key="5149:0" data-first-offset="true"><span data-slate-string="true">的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5150"><span data-slate-object="text" data-key="5151"><span data-slate-leaf="true" data-offset-key="5151:0" data-first-offset="true"><span data-slate-string="true">我们开发 Web 服务最核心的诉求是：输入一些参数，校验通过后，进行业务逻辑处理，然后返回结果。所以 Web 服务还应该能够进行</span></span></span><span data-slate-object="text" data-key="5152"><span data-slate-leaf="true" data-offset-key="5152:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">参数解析</span></span></span></span><span data-slate-object="text" data-key="5153"><span data-slate-leaf="true" data-offset-key="5153:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-object="text" data-key="5154"><span data-slate-leaf="true" data-offset-key="5154:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">参数校验</span></span></span></span><span data-slate-object="text" data-key="5155"><span data-slate-leaf="true" data-offset-key="5155:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-object="text" data-key="5156"><span data-slate-leaf="true" data-offset-key="5156:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">逻辑处理</span></span></span></span><span data-slate-object="text" data-key="5157"><span data-slate-leaf="true" data-offset-key="5157:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-object="text" data-key="5158"><span data-slate-leaf="true" data-offset-key="5158:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">返回结果</span></span></span></span><span data-slate-object="text" data-key="5159"><span data-slate-leaf="true" data-offset-key="5159:0" data-first-offset="true"><span data-slate-string="true">。这些都是 Web 服务的业务处理功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5160"><span data-slate-object="text" data-key="5161"><span data-slate-leaf="true" data-offset-key="5161:0" data-first-offset="true"><span data-slate-string="true">上面这些是 Web 服务的基本功能，此外，我们还需要支持一些高级功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5162"><span data-slate-object="text" data-key="5163"><span data-slate-leaf="true" data-offset-key="5163:0" data-first-offset="true"><span data-slate-string="true">在进行 HTTP 请求时，经常需要针对每一次请求都设置一些通用的操作，比如添加 Header、添加 RequestID、统计请求次数等，这就要求我们的 Web 服务能够支持</span></span></span><span data-slate-object="text" data-key="5164"><span data-slate-leaf="true" data-offset-key="5164:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">中间件</span></span></span></span><span data-slate-object="text" data-key="5165"><span data-slate-leaf="true" data-offset-key="5165:0" data-first-offset="true"><span data-slate-string="true">特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5166"><span data-slate-object="text" data-key="5167"><span data-slate-leaf="true" data-offset-key="5167:0" data-first-offset="true"><span data-slate-string="true">为了保证系统安全，对于每一个请求，我们都需要进行</span></span></span><span data-slate-object="text" data-key="5168"><span data-slate-leaf="true" data-offset-key="5168:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">认证</span></span></span></span><span data-slate-object="text" data-key="5169"><span data-slate-leaf="true" data-offset-key="5169:0" data-first-offset="true"><span data-slate-string="true">。Web 服务中，通常有两种认证方式，一种是基于用户名和密码，一种是基于 Token。认证通过之后，就可以继续处理请求了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5170"><span data-slate-object="text" data-key="5171"><span data-slate-leaf="true" data-offset-key="5171:0" data-first-offset="true"><span data-slate-string="true">为了方便定位和跟踪某一次请求，需要支持 </span></span></span><span data-slate-object="text" data-key="5172"><span data-slate-leaf="true" data-offset-key="5172:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">RequestID</span></span></span></span><span data-slate-object="text" data-key="5173"><span data-slate-leaf="true" data-offset-key="5173:0" data-first-offset="true"><span data-slate-string="true">，定位和跟踪 RequestID 主要是为了排障。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5174"><span data-slate-object="text" data-key="5175"><span data-slate-leaf="true" data-offset-key="5175:0" data-first-offset="true"><span data-slate-string="true">最后，当前的软件架构中，很多采用了前后端分离的架构。在前后端分离的架构中，前端访问地址和后端访问地址往往是不同的，浏览器为了安全，会针对这种情况设置跨域请求，所以 Web 服务需要能够处理浏览器的</span></span></span><span data-slate-object="text" data-key="5176"><span data-slate-leaf="true" data-offset-key="5176:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">跨域</span></span></span></span><span data-slate-object="text" data-key="5177"><span data-slate-leaf="true" data-offset-key="5177:0" data-first-offset="true"><span data-slate-string="true">请求。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5178"><span data-slate-object="text" data-key="5179"><span data-slate-leaf="true" data-offset-key="5179:0" data-first-offset="true"><span data-slate-string="true">到这里，我就把 Web 服务的基础功能和高级功能串讲了一遍。当然，上面只介绍了 Web 服务的核心功能，还有很多其他的功能，</span></span><span data-slate-leaf="true" data-offset-key="5179:1"><span data-slate-object="annotation" data-annotation-key="gkann_121acb58" data-attr-id="43199" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">你可以通过学习 </span></span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5180"><span data-slate-object="text" data-key="5181"><span data-slate-leaf="true" data-offset-key="5181:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_121acb58" data-attr-id="43199" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Gin 的官方文档</span></span></span></span></a><span data-slate-object="text" data-key="5182"><span data-slate-leaf="true" data-offset-key="5182:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_121acb58" data-attr-id="43199" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">来了解。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5183"><span data-slate-object="text" data-key="5184"><span data-slate-leaf="true" data-offset-key="5184:0" data-first-offset="true"><span data-slate-string="true">你可以看到，Web 服务有很多核心功能，这些功能我们可以基于 net/http 包自己封装。但在实际的项目开发中， 我们更多会选择使用基于 net/http 包进行封装的优秀开源 Web 框架。本实战项目选择了 Gin 框架。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5185"><span data-slate-object="text" data-key="5186"><span data-slate-leaf="true" data-offset-key="5186:0" data-first-offset="true"><span data-slate-string="true">接下来，我们主要看下 Gin 框架是如何实现以上核心功能的，这些功能我们在实际的开发中可以直接拿来使用。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5187" id="sr-toc-2"><span data-slate-object="text" data-key="5188"><span data-slate-leaf="true" data-offset-key="5188:0" data-first-offset="true"><span data-slate-string="true">为什么选择 Gin 框架？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5189"><span data-slate-object="text" data-key="5190"><span data-slate-leaf="true" data-offset-key="5190:0" data-first-offset="true"><span data-slate-string="true">优秀的 Web 框架有很多，我们为什么要选择 Gin 呢？在回答这个问题之前，我们先来看下选择 Web 框架时的关注点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5191"><span data-slate-object="text" data-key="5192"><span data-slate-leaf="true" data-offset-key="5192:0" data-first-offset="true"><span data-slate-string="true">在选择 Web 框架时，我们可以关注如下几点：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5193"><div data-slate-type="list-line" data-slate-object="block" data-key="5194"><span data-slate-object="text" data-key="5195"><span data-slate-leaf="true" data-offset-key="5195:0" data-first-offset="true"><span data-slate-string="true">路由功能；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5196"><span data-slate-object="text" data-key="5197"><span data-slate-leaf="true" data-offset-key="5197:0" data-first-offset="true"><span data-slate-string="true">是否具备 middleware/filter 能力；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5198"><span data-slate-object="text" data-key="5199"><span data-slate-leaf="true" data-offset-key="5199:0" data-first-offset="true"><span data-slate-string="true">HTTP 参数（path、query、form、header、body）解析和返回；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5200"><span data-slate-object="text" data-key="5201"><span data-slate-leaf="true" data-offset-key="5201:0" data-first-offset="true"><span data-slate-string="true">性能和稳定性；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5202"><span data-slate-object="text" data-key="5203"><span data-slate-leaf="true" data-offset-key="5203:0" data-first-offset="true"><span data-slate-string="true">使用复杂度；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5204"><span data-slate-object="text" data-key="5205"><span data-slate-leaf="true" data-offset-key="5205:0" data-first-offset="true"><span data-slate-string="true">社区活跃度。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5206"><span data-slate-object="text" data-key="5207"><span data-slate-leaf="true" data-offset-key="5207:0" data-first-offset="true"><span data-slate-string="true">按 GitHub Star 数来排名，当前比较火的 Go Web 框架有 Gin、Beego、Echo、Revel 、Martini。经过调研，我从中选择了 Gin 框架，原因是 Gin 具有如下特性：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5208"><div data-slate-type="list-line" data-slate-object="block" data-key="5209"><span data-slate-object="text" data-key="5210"><span data-slate-leaf="true" data-offset-key="5210:0" data-first-offset="true"><span data-slate-string="true">轻量级，代码质量高，性能比较高；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5211"><span data-slate-object="text" data-key="5212"><span data-slate-leaf="true" data-offset-key="5212:0" data-first-offset="true"><span data-slate-string="true">项目目前很活跃，并有很多可用的 Middleware；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5213"><span data-slate-object="text" data-key="5214"><span data-slate-leaf="true" data-offset-key="5214:0" data-first-offset="true"><span data-slate-string="true">作为一个 Web 框架，功能齐全，使用起来简单。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5215"><span data-slate-object="text" data-key="5216"><span data-slate-leaf="true" data-offset-key="5216:0" data-first-offset="true"><span data-slate-string="true">那接下来，我就先详细介绍下 Gin 框架。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5217"><a data-slate-type="link" data-slate-object="inline" data-key="5218"><span data-slate-object="text" data-key="5219"><span data-slate-leaf="true" data-offset-key="5219:0" data-first-offset="true"><span data-slate-string="true">Gin</span></span></span></a><span data-slate-object="text" data-key="5220"><span data-slate-leaf="true" data-offset-key="5220:0" data-first-offset="true"><span data-slate-string="true"> 是用 Go 语言编写的 Web 框架，功能完善，使用简单，性能很高。Gin 核心的路由功能是通过一个定制版的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5221"><span data-slate-object="text" data-key="5222"><span data-slate-leaf="true" data-offset-key="5222:0" data-first-offset="true"><span data-slate-string="true">HttpRouter</span></span></span></a><span data-slate-object="text" data-key="5223"><span data-slate-leaf="true" data-offset-key="5223:0" data-first-offset="true"><span data-slate-string="true"> 来实现的，具有很高的路由性能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5224"><span data-slate-object="text" data-key="5225"><span data-slate-leaf="true" data-offset-key="5225:0" data-first-offset="true"><span data-slate-string="true">Gin 有很多功能，这里我给你列出了它的一些核心功能：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5226"><div data-slate-type="list-line" data-slate-object="block" data-key="5227"><span data-slate-object="text" data-key="5228"><span data-slate-leaf="true" data-offset-key="5228:0" data-first-offset="true"><span data-slate-string="true">支持 HTTP 方法：GET、POST、PUT、PATCH、DELETE、OPTIONS。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5229"><span data-slate-object="text" data-key="5230"><span data-slate-leaf="true" data-offset-key="5230:0" data-first-offset="true"><span data-slate-string="true">支持不同位置的 HTTP 参数：路径参数（path）、查询字符串参数（query）、表单参数（form）、HTTP 头参数（header）、消息体参数（body）。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5231"><span data-slate-object="text" data-key="5232"><span data-slate-leaf="true" data-offset-key="5232:0" data-first-offset="true"><span data-slate-string="true">支持 HTTP 路由和路由分组。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5233"><span data-slate-object="text" data-key="5234"><span data-slate-leaf="true" data-offset-key="5234:0" data-first-offset="true"><span data-slate-string="true">支持 middleware 和自定义 middleware。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5235"><span data-slate-object="text" data-key="5236"><span data-slate-leaf="true" data-offset-key="5236:0" data-first-offset="true"><span data-slate-string="true">支持自定义 Log。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5237"><span data-slate-object="text" data-key="5238"><span data-slate-leaf="true" data-offset-key="5238:0" data-first-offset="true"><span data-slate-string="true">支持 binding 和 validation，支持自定义 validator。可以 bind 如下参数：query、path、body、header、form。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5239"><span data-slate-object="text" data-key="5240"><span data-slate-leaf="true" data-offset-key="5240:0" data-first-offset="true"><span data-slate-string="true">支持重定向。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5241"><span data-slate-object="text" data-key="5242"><span data-slate-leaf="true" data-offset-key="5242:0" data-first-offset="true"><span data-slate-string="true">支持 basic auth middleware。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5243"><span data-slate-object="text" data-key="5244"><span data-slate-leaf="true" data-offset-key="5244:0" data-first-offset="true"><span data-slate-string="true">支持自定义 HTTP 配置。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5245"><span data-slate-object="text" data-key="5246"><span data-slate-leaf="true" data-offset-key="5246:0" data-first-offset="true"><span data-slate-string="true">支持优雅关闭。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5247"><span data-slate-object="text" data-key="5248"><span data-slate-leaf="true" data-offset-key="5248:0" data-first-offset="true"><span data-slate-string="true">支持 HTTP2。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5249"><span data-slate-object="text" data-key="5250"><span data-slate-leaf="true" data-offset-key="5250:0" data-first-offset="true"><span data-slate-string="true">支持设置和获取 cookie。</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5251" id="sr-toc-3"><span data-slate-object="text" data-key="5252"><span data-slate-leaf="true" data-offset-key="5252:0" data-first-offset="true"><span data-slate-string="true">Gin 是如何支持 Web 服务基础功能的？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5253"><span data-slate-object="text" data-key="5254"><span data-slate-leaf="true" data-offset-key="5254:0" data-first-offset="true"><span data-slate-string="true">接下来，我们先通过一个具体的例子，看下 Gin 是如何支持 Web 服务基础功能的，后面再详细介绍这些功能的用法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5255"><span data-slate-object="text" data-key="5256"><span data-slate-leaf="true" data-offset-key="5256:0" data-first-offset="true"><span data-slate-string="true">我们创建一个 webfeature 目录，用来存放示例代码。因为要演示 HTTPS 的用法，所以需要创建证书文件。具体可以分为两步。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5257"><span data-slate-object="text" data-key="5258"><span data-slate-leaf="true" data-offset-key="5258:0" data-first-offset="true"><span data-slate-string="true">第一步，执行以下命令创建证书：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="5259"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5260"><span data-slate-object="text" data-key="5261"><span data-slate-leaf="true" data-offset-key="5261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cat</span></span></span></span><span data-slate-object="text" data-key="5262"><span data-slate-leaf="true" data-offset-key="5262:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt; </span></span></span><span data-slate-object="text" data-key="5263"><span data-slate-leaf="true" data-offset-key="5263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'EOF'</span></span></span></span><span data-slate-object="text" data-key="5264"><span data-slate-leaf="true" data-offset-key="5264:0" data-first-offset="true"><span data-slate-string="true"> &gt; ca.pem</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5265"><span data-slate-object="text" data-key="5266"><span data-slate-leaf="true" data-offset-key="5266:0" data-first-offset="true"><span data-slate-string="true">-----BEGIN CERTIFICATE-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5267"><span data-slate-object="text" data-key="5268"><span data-slate-leaf="true" data-offset-key="5268:0" data-first-offset="true"><span data-slate-string="true">MIICSjCCAbOgAwIBAgIJAJHGGR4dGioHMA0GCSqGSIb3DQEBCwUAMFYxCzAJBgNV</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5269"><span data-slate-object="text" data-key="5270"><span data-slate-leaf="true" data-offset-key="5270:0" data-first-offset="true"><span data-slate-string="true">BAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBX</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5271"><span data-slate-object="text" data-key="5272"><span data-slate-leaf="true" data-offset-key="5272:0" data-first-offset="true"><span data-slate-string="true">aWRnaXRzIFB0eSBMdGQxDzANBgNVBAMTBnRlc3RjYTAeFw0xNDExMTEyMjMxMjla</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5273"><span data-slate-object="text" data-key="5274"><span data-slate-leaf="true" data-offset-key="5274:0" data-first-offset="true"><span data-slate-string="true">Fw0yNDExMDgyMjMxMjlaMFYxCzAJBgNVBAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5275"><span data-slate-object="text" data-key="5276"><span data-slate-leaf="true" data-offset-key="5276:0" data-first-offset="true"><span data-slate-string="true">YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQxDzANBgNVBAMT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5277"><span data-slate-object="text" data-key="5278"><span data-slate-leaf="true" data-offset-key="5278:0" data-first-offset="true"><span data-slate-string="true">BnRlc3RjYTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwEDfBV5MYdlHVHJ7</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5279"><span data-slate-object="text" data-key="5280"><span data-slate-leaf="true" data-offset-key="5280:0" data-first-offset="true"><span data-slate-string="true">+L4nxrZy7mBfAVXpOc5vMYztssUI7mL2/iYujiIXM+weZYNTEpLdjyJdu7R5gGUu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5281"><span data-slate-object="text" data-key="5282"><span data-slate-leaf="true" data-offset-key="5282:0" data-first-offset="true"><span data-slate-string="true">g1jSVK/EPHfc74O7AyZU34PNIP4Sh33N+/A5YexrNgJlPY+E3GdVYi4ldWJjgkAd</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5283"><span data-slate-object="text" data-key="5284"><span data-slate-leaf="true" data-offset-key="5284:0" data-first-offset="true"><span data-slate-string="true">Qah2PH5ACLrIIC6tRka9hcaBlIECAwEAAaMgMB4wDAYDVR0TBAUwAwEB/zAOBgNV</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5285"><span data-slate-object="text" data-key="5286"><span data-slate-leaf="true" data-offset-key="5286:0" data-first-offset="true"><span data-slate-string="true">HQ8BAf8EBAMCAgQwDQYJKoZIhvcNAQELBQADgYEAHzC7jdYlzAVmddi/gdAeKPau</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5287"><span data-slate-object="text" data-key="5288"><span data-slate-leaf="true" data-offset-key="5288:0" data-first-offset="true"><span data-slate-string="true">sPBG/C2HCWqHzpCUHcKuvMzDVkY/MP2o6JIW2DBbY64bO/FceExhjcykgaYtCH/m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5289"><span data-slate-object="text" data-key="5290"><span data-slate-leaf="true" data-offset-key="5290:0" data-first-offset="true"><span data-slate-string="true">oIU63+CFOTtR7otyQAWHqXa7q4SbCDlG7DyRFxqG0txPtGvy12lgldA2+RgcigQG</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5291"><span data-slate-object="text" data-key="5292"><span data-slate-leaf="true" data-offset-key="5292:0" data-first-offset="true"><span data-slate-string="true">Dfcog5wrJytaQ6UA0wE=</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5293"><span data-slate-object="text" data-key="5294"><span data-slate-leaf="true" data-offset-key="5294:0" data-first-offset="true"><span data-slate-string="true">-----END CERTIFICATE-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5295"><span data-slate-object="text" data-key="5296"><span data-slate-leaf="true" data-offset-key="5296:0" data-first-offset="true"><span data-slate-string="true">EOF</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5297"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5298"><span data-slate-object="text" data-key="5299"><span data-slate-leaf="true" data-offset-key="5299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cat</span></span></span></span><span data-slate-object="text" data-key="5300"><span data-slate-leaf="true" data-offset-key="5300:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt; </span></span></span><span data-slate-object="text" data-key="5301"><span data-slate-leaf="true" data-offset-key="5301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'EOF'</span></span></span></span><span data-slate-object="text" data-key="5302"><span data-slate-leaf="true" data-offset-key="5302:0" data-first-offset="true"><span data-slate-string="true"> &gt; server.key</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5303"><span data-slate-object="text" data-key="5304"><span data-slate-leaf="true" data-offset-key="5304:0" data-first-offset="true"><span data-slate-string="true">-----BEGIN PRIVATE KEY-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5305"><span data-slate-object="text" data-key="5306"><span data-slate-leaf="true" data-offset-key="5306:0" data-first-offset="true"><span data-slate-string="true">MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAOHDFScoLCVJpYDD</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5307"><span data-slate-object="text" data-key="5308"><span data-slate-leaf="true" data-offset-key="5308:0" data-first-offset="true"><span data-slate-string="true">M4HYtIdV6Ake/sMNaaKdODjDMsux/4tDydlumN+fm+AjPEK5GHhGn1BgzkWF+slf</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5309"><span data-slate-object="text" data-key="5310"><span data-slate-leaf="true" data-offset-key="5310:0" data-first-offset="true"><span data-slate-string="true">3BxhrA/8dNsnunstVA7ZBgA/5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd9N8YwbBY</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5311"><span data-slate-object="text" data-key="5312"><span data-slate-leaf="true" data-offset-key="5312:0" data-first-offset="true"><span data-slate-string="true">AckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAECgYAn7qGnM2vbjJNBm0VZCkOkTIWm</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5313"><span data-slate-object="text" data-key="5314"><span data-slate-leaf="true" data-offset-key="5314:0" data-first-offset="true"><span data-slate-string="true">V10okw7EPJrdL2mkre9NasghNXbE1y5zDshx5Nt3KsazKOxTT8d0Jwh/3KbaN+YY</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5315"><span data-slate-object="text" data-key="5316"><span data-slate-leaf="true" data-offset-key="5316:0" data-first-offset="true"><span data-slate-string="true">tTCbKGW0pXDRBhwUHRcuRzScjli8Rih5UOCiZkhefUTcRb6xIhZJuQy71tjaSy0p</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5317"><span data-slate-object="text" data-key="5318"><span data-slate-leaf="true" data-offset-key="5318:0" data-first-offset="true"><span data-slate-string="true">dHZRmYyBYO2YEQ8xoQJBAPrJPhMBkzmEYFtyIEqAxQ/o/A6E+E4w8i+KM7nQCK7q</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5319"><span data-slate-object="text" data-key="5320"><span data-slate-leaf="true" data-offset-key="5320:0" data-first-offset="true"><span data-slate-string="true">K4JXzyXVAjLfyBZWHGM2uro/fjqPggGD6QH1qXCkI4MCQQDmdKeb2TrKRh5BY1LR</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5321"><span data-slate-object="text" data-key="5322"><span data-slate-leaf="true" data-offset-key="5322:0" data-first-offset="true"><span data-slate-string="true">81aJGKcJ2XbcDu6wMZK4oqWbTX2KiYn9GB0woM6nSr/Y6iy1u145YzYxEV/iMwff</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5323"><span data-slate-object="text" data-key="5324"><span data-slate-leaf="true" data-offset-key="5324:0" data-first-offset="true"><span data-slate-string="true">DJULAkB8B2MnyzOg0pNFJqBJuH29bKCcHa8gHJzqXhNO5lAlEbMK95p/P2Wi+4Hd</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5325"><span data-slate-object="text" data-key="5326"><span data-slate-leaf="true" data-offset-key="5326:0" data-first-offset="true"><span data-slate-string="true">aiEIAF1BF326QJcvYKmwSmrORp85AkAlSNxRJ50OWrfMZnBgzVjDx3xG6KsFQVk2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5327"><span data-slate-object="text" data-key="5328"><span data-slate-leaf="true" data-offset-key="5328:0" data-first-offset="true"><span data-slate-string="true">ol6VhqL6dFgKUORFUWBvnKSyhjJxurlPEahV6oo6+A+mPhFY8eUvAkAZQyTdupP3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5329"><span data-slate-object="text" data-key="5330"><span data-slate-leaf="true" data-offset-key="5330:0" data-first-offset="true"><span data-slate-string="true">XEFQKctGz+9+gKkemDp7LBBMEMBXrGTLPhpEfcjv/7KPdnFHYmhYeBTBnuVmTVWe</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5331"><span data-slate-object="text" data-key="5332"><span data-slate-leaf="true" data-offset-key="5332:0" data-first-offset="true"><span data-slate-string="true">F98XJ7tIFfJq</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5333"><span data-slate-object="text" data-key="5334"><span data-slate-leaf="true" data-offset-key="5334:0" data-first-offset="true"><span data-slate-string="true">-----END PRIVATE KEY-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5335"><span data-slate-object="text" data-key="5336"><span data-slate-leaf="true" data-offset-key="5336:0" data-first-offset="true"><span data-slate-string="true">EOF</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5337"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5338"><span data-slate-object="text" data-key="5339"><span data-slate-leaf="true" data-offset-key="5339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cat</span></span></span></span><span data-slate-object="text" data-key="5340"><span data-slate-leaf="true" data-offset-key="5340:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt; </span></span></span><span data-slate-object="text" data-key="5341"><span data-slate-leaf="true" data-offset-key="5341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'EOF'</span></span></span></span><span data-slate-object="text" data-key="5342"><span data-slate-leaf="true" data-offset-key="5342:0" data-first-offset="true"><span data-slate-string="true"> &gt; server.pem</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5343"><span data-slate-object="text" data-key="5344"><span data-slate-leaf="true" data-offset-key="5344:0" data-first-offset="true"><span data-slate-string="true">-----BEGIN CERTIFICATE-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5345"><span data-slate-object="text" data-key="5346"><span data-slate-leaf="true" data-offset-key="5346:0" data-first-offset="true"><span data-slate-string="true">MIICnDCCAgWgAwIBAgIBBzANBgkqhkiG9w0BAQsFADBWMQswCQYDVQQGEwJBVTET</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5347"><span data-slate-object="text" data-key="5348"><span data-slate-leaf="true" data-offset-key="5348:0" data-first-offset="true"><span data-slate-string="true">MBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lkZ2l0cyBQ</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5349"><span data-slate-object="text" data-key="5350"><span data-slate-leaf="true" data-offset-key="5350:0" data-first-offset="true"><span data-slate-string="true">dHkgTHRkMQ8wDQYDVQQDEwZ0ZXN0Y2EwHhcNMTUxMTA0MDIyMDI0WhcNMjUxMTAx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5351"><span data-slate-object="text" data-key="5352"><span data-slate-leaf="true" data-offset-key="5352:0" data-first-offset="true"><span data-slate-string="true">MDIyMDI0WjBlMQswCQYDVQQGEwJVUzERMA8GA1UECBMISWxsaW5vaXMxEDAOBgNV</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5353"><span data-slate-object="text" data-key="5354"><span data-slate-leaf="true" data-offset-key="5354:0" data-first-offset="true"><span data-slate-string="true">BAcTB0NoaWNhZ28xFTATBgNVBAoTDEV4YW1wbGUsIENvLjEaMBgGA1UEAxQRKi50</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5355"><span data-slate-object="text" data-key="5356"><span data-slate-leaf="true" data-offset-key="5356:0" data-first-offset="true"><span data-slate-string="true">ZXN0Lmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOHDFSco</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5357"><span data-slate-object="text" data-key="5358"><span data-slate-leaf="true" data-offset-key="5358:0" data-first-offset="true"><span data-slate-string="true">LCVJpYDDM4HYtIdV6Ake/sMNaaKdODjDMsux/4tDydlumN+fm+AjPEK5GHhGn1Bg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5359"><span data-slate-object="text" data-key="5360"><span data-slate-leaf="true" data-offset-key="5360:0" data-first-offset="true"><span data-slate-string="true">zkWF+slf3BxhrA/8dNsnunstVA7ZBgA/5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5361"><span data-slate-object="text" data-key="5362"><span data-slate-leaf="true" data-offset-key="5362:0" data-first-offset="true"><span data-slate-string="true">9N8YwbBYAckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAGjazBpMAkGA1UdEwQCMAAw</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5363"><span data-slate-object="text" data-key="5364"><span data-slate-leaf="true" data-offset-key="5364:0" data-first-offset="true"><span data-slate-string="true">CwYDVR0PBAQDAgXgME8GA1UdEQRIMEaCECoudGVzdC5nb29nbGUuZnKCGHdhdGVy</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5365"><span data-slate-object="text" data-key="5366"><span data-slate-leaf="true" data-offset-key="5366:0" data-first-offset="true"><span data-slate-string="true">em9vaS50ZXN0Lmdvb2dsZS5iZYISKi50ZXN0LnlvdXR1YmUuY29thwTAqAEDMA0G</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5367"><span data-slate-object="text" data-key="5368"><span data-slate-leaf="true" data-offset-key="5368:0" data-first-offset="true"><span data-slate-string="true">CSqGSIb3DQEBCwUAA4GBAJFXVifQNub1LUP4JlnX5lXNlo8FxZ2a12AFQs+bzoJ6</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5369"><span data-slate-object="text" data-key="5370"><span data-slate-leaf="true" data-offset-key="5370:0" data-first-offset="true"><span data-slate-string="true">hM044EDjqyxUqSbVePK0ni3w1fHQB5rY9yYC5f8G7aqqTY1QOhoUk8ZTSTRpnkTh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5371"><span data-slate-object="text" data-key="5372"><span data-slate-leaf="true" data-offset-key="5372:0" data-first-offset="true"><span data-slate-string="true">y4jjdvTZeLDVBlueZUTDRmy2feY5aZIU18vFDK08dTG0A87pppuv1LNIR3loveU8</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5373"><span data-slate-object="text" data-key="5374"><span data-slate-leaf="true" data-offset-key="5374:0" data-first-offset="true"><span data-slate-string="true">-----END CERTIFICATE-----</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5375"><span data-slate-object="text" data-key="5376"><span data-slate-leaf="true" data-offset-key="5376:0" data-first-offset="true"><span data-slate-string="true">EOF</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5377"><span data-slate-object="text" data-key="5378"><span data-slate-leaf="true" data-offset-key="5378:0" data-first-offset="true"><span data-slate-string="true">第二步，创建 main.go 文件：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5379"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div><div data-code-line-number="99"></div><div data-code-line-number="100"></div><div data-code-line-number="101"></div><div data-code-line-number="102"></div><div data-code-line-number="103"></div><div data-code-line-number="104"></div><div data-code-line-number="105"></div><div data-code-line-number="106"></div><div data-code-line-number="107"></div><div data-code-line-number="108"></div><div data-code-line-number="109"></div><div data-code-line-number="110"></div><div data-code-line-number="111"></div><div data-code-line-number="112"></div><div data-code-line-number="113"></div><div data-code-line-number="114"></div><div data-code-line-number="115"></div><div data-code-line-number="116"></div><div data-code-line-number="117"></div><div data-code-line-number="118"></div><div data-code-line-number="119"></div><div data-code-line-number="120"></div><div data-code-line-number="121"></div><div data-code-line-number="122"></div><div data-code-line-number="123"></div><div data-code-line-number="124"></div><div data-code-line-number="125"></div><div data-code-line-number="126"></div><div data-code-line-number="127"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5380"><span data-slate-object="text" data-key="5381"><span data-slate-leaf="true" data-offset-key="5381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="5382"><span data-slate-leaf="true" data-offset-key="5382:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5383"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5384"><span data-slate-object="text" data-key="5385"><span data-slate-leaf="true" data-offset-key="5385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="5386"><span data-slate-leaf="true" data-offset-key="5386:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5387"><span data-slate-object="text" data-key="5388"><span data-slate-leaf="true" data-offset-key="5388:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5389"><span data-slate-leaf="true" data-offset-key="5389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"fmt"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5390"><span data-slate-object="text" data-key="5391"><span data-slate-leaf="true" data-offset-key="5391:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5392"><span data-slate-leaf="true" data-offset-key="5392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5393"><span data-slate-object="text" data-key="5394"><span data-slate-leaf="true" data-offset-key="5394:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5395"><span data-slate-leaf="true" data-offset-key="5395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"net/http"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5396"><span data-slate-object="text" data-key="5397"><span data-slate-leaf="true" data-offset-key="5397:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5398"><span data-slate-leaf="true" data-offset-key="5398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"sync"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5399"><span data-slate-object="text" data-key="5400"><span data-slate-leaf="true" data-offset-key="5400:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5401"><span data-slate-leaf="true" data-offset-key="5401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"time"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5402"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5403"><span data-slate-object="text" data-key="5404"><span data-slate-leaf="true" data-offset-key="5404:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5405"><span data-slate-leaf="true" data-offset-key="5405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/gin-gonic/gin"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5406"><span data-slate-object="text" data-key="5407"><span data-slate-leaf="true" data-offset-key="5407:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5408"><span data-slate-leaf="true" data-offset-key="5408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"golang.org/x/sync/errgroup"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5409"><span data-slate-object="text" data-key="5410"><span data-slate-leaf="true" data-offset-key="5410:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5411"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5412"><span data-slate-object="text" data-key="5413"><span data-slate-leaf="true" data-offset-key="5413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="5414"><span data-slate-leaf="true" data-offset-key="5414:0" data-first-offset="true"><span data-slate-string="true"> Product </span></span></span><span data-slate-object="text" data-key="5415"><span data-slate-leaf="true" data-offset-key="5415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="5416"><span data-slate-leaf="true" data-offset-key="5416:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5417"><span data-slate-object="text" data-key="5418"><span data-slate-leaf="true" data-offset-key="5418:0" data-first-offset="true"><span data-slate-string="true">  Username    </span></span></span><span data-slate-object="text" data-key="5419"><span data-slate-leaf="true" data-offset-key="5419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5420"><span data-slate-leaf="true" data-offset-key="5420:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5421"><span data-slate-leaf="true" data-offset-key="5421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"username" binding:"required"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5422"><span data-slate-object="text" data-key="5423"><span data-slate-leaf="true" data-offset-key="5423:0" data-first-offset="true"><span data-slate-string="true">  Name        </span></span></span><span data-slate-object="text" data-key="5424"><span data-slate-leaf="true" data-offset-key="5424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5425"><span data-slate-leaf="true" data-offset-key="5425:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5426"><span data-slate-leaf="true" data-offset-key="5426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"name" binding:"required"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5427"><span data-slate-object="text" data-key="5428"><span data-slate-leaf="true" data-offset-key="5428:0" data-first-offset="true"><span data-slate-string="true">  Category    </span></span></span><span data-slate-object="text" data-key="5429"><span data-slate-leaf="true" data-offset-key="5429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5430"><span data-slate-leaf="true" data-offset-key="5430:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5431"><span data-slate-leaf="true" data-offset-key="5431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"category" binding:"required"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5432"><span data-slate-object="text" data-key="5433"><span data-slate-leaf="true" data-offset-key="5433:0" data-first-offset="true"><span data-slate-string="true">  Price       </span></span></span><span data-slate-object="text" data-key="5434"><span data-slate-leaf="true" data-offset-key="5434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5435"><span data-slate-leaf="true" data-offset-key="5435:0" data-first-offset="true"><span data-slate-string="true">       </span></span></span><span data-slate-object="text" data-key="5436"><span data-slate-leaf="true" data-offset-key="5436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"price" binding:"gte=0"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5437"><span data-slate-object="text" data-key="5438"><span data-slate-leaf="true" data-offset-key="5438:0" data-first-offset="true"><span data-slate-string="true">  Description </span></span></span><span data-slate-object="text" data-key="5439"><span data-slate-leaf="true" data-offset-key="5439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5440"><span data-slate-leaf="true" data-offset-key="5440:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5441"><span data-slate-leaf="true" data-offset-key="5441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"description"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5442"><span data-slate-object="text" data-key="5443"><span data-slate-leaf="true" data-offset-key="5443:0" data-first-offset="true"><span data-slate-string="true">  CreatedAt   time.Time </span></span></span><span data-slate-object="text" data-key="5444"><span data-slate-leaf="true" data-offset-key="5444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`json:"createdAt"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5445"><span data-slate-object="text" data-key="5446"><span data-slate-leaf="true" data-offset-key="5446:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5447"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5448"><span data-slate-object="text" data-key="5449"><span data-slate-leaf="true" data-offset-key="5449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="5450"><span data-slate-leaf="true" data-offset-key="5450:0" data-first-offset="true"><span data-slate-string="true"> productHandler </span></span></span><span data-slate-object="text" data-key="5451"><span data-slate-leaf="true" data-offset-key="5451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="5452"><span data-slate-leaf="true" data-offset-key="5452:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5453"><span data-slate-object="text" data-key="5454"><span data-slate-leaf="true" data-offset-key="5454:0" data-first-offset="true"><span data-slate-string="true">  sync.RWMutex</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5455"><span data-slate-object="text" data-key="5456"><span data-slate-leaf="true" data-offset-key="5456:0" data-first-offset="true"><span data-slate-string="true">  products </span></span></span><span data-slate-object="text" data-key="5457"><span data-slate-leaf="true" data-offset-key="5457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5458"><span data-slate-leaf="true" data-offset-key="5458:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5459"><span data-slate-leaf="true" data-offset-key="5459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5460"><span data-slate-leaf="true" data-offset-key="5460:0" data-first-offset="true"><span data-slate-string="true">]Product</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5461"><span data-slate-object="text" data-key="5462"><span data-slate-leaf="true" data-offset-key="5462:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5463"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5464"><span data-slate-object="text" data-key="5465"><span data-slate-leaf="true" data-offset-key="5465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5466"><span data-slate-leaf="true" data-offset-key="5466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5467"><span data-slate-leaf="true" data-offset-key="5467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">newProductHandler</span></span></span></span></span><span data-slate-object="text" data-key="5468"><span data-slate-leaf="true" data-offset-key="5468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="5469"><span data-slate-leaf="true" data-offset-key="5469:0" data-first-offset="true"><span data-slate-string="true"> *productHandler {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5470"><span data-slate-object="text" data-key="5471"><span data-slate-leaf="true" data-offset-key="5471:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5472"><span data-slate-leaf="true" data-offset-key="5472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5473"><span data-slate-leaf="true" data-offset-key="5473:0" data-first-offset="true"><span data-slate-string="true"> &amp;productHandler{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5474"><span data-slate-object="text" data-key="5475"><span data-slate-leaf="true" data-offset-key="5475:0" data-first-offset="true"><span data-slate-string="true">    products: </span></span></span><span data-slate-object="text" data-key="5476"><span data-slate-leaf="true" data-offset-key="5476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="5477"><span data-slate-leaf="true" data-offset-key="5477:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="5478"><span data-slate-leaf="true" data-offset-key="5478:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5479"><span data-slate-leaf="true" data-offset-key="5479:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5480"><span data-slate-leaf="true" data-offset-key="5480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5481"><span data-slate-leaf="true" data-offset-key="5481:0" data-first-offset="true"><span data-slate-string="true">]Product),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5482"><span data-slate-object="text" data-key="5483"><span data-slate-leaf="true" data-offset-key="5483:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5484"><span data-slate-object="text" data-key="5485"><span data-slate-leaf="true" data-offset-key="5485:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5486"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5487"><span data-slate-object="text" data-key="5488"><span data-slate-leaf="true" data-offset-key="5488:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5489"><span data-slate-leaf="true" data-offset-key="5489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5490"><span data-slate-leaf="true" data-offset-key="5490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(u *productHandler)</span></span></span></span></span><span data-slate-object="text" data-key="5491"><span data-slate-leaf="true" data-offset-key="5491:0" data-first-offset="true"><span data-slate-string="true"> Create(c *gin.Context) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5492"><span data-slate-object="text" data-key="5493"><span data-slate-leaf="true" data-offset-key="5493:0" data-first-offset="true"><span data-slate-string="true">  u.Lock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5494"><span data-slate-object="text" data-key="5495"><span data-slate-leaf="true" data-offset-key="5495:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5496"><span data-slate-leaf="true" data-offset-key="5496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="5497"><span data-slate-leaf="true" data-offset-key="5497:0" data-first-offset="true"><span data-slate-string="true"> u.Unlock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5498"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5499"><span data-slate-object="text" data-key="5500"><span data-slate-leaf="true" data-offset-key="5500:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5501"><span data-slate-leaf="true" data-offset-key="5501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1. 参数解析</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5502"><span data-slate-object="text" data-key="5503"><span data-slate-leaf="true" data-offset-key="5503:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5504"><span data-slate-leaf="true" data-offset-key="5504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="5505"><span data-slate-leaf="true" data-offset-key="5505:0" data-first-offset="true"><span data-slate-string="true"> product Product</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5506"><span data-slate-object="text" data-key="5507"><span data-slate-leaf="true" data-offset-key="5507:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5508"><span data-slate-leaf="true" data-offset-key="5508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5509"><span data-slate-leaf="true" data-offset-key="5509:0" data-first-offset="true"><span data-slate-string="true"> err := c.ShouldBindJSON(&amp;product); err != </span></span></span><span data-slate-object="text" data-key="5510"><span data-slate-leaf="true" data-offset-key="5510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5511"><span data-slate-leaf="true" data-offset-key="5511:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5512"><span data-slate-object="text" data-key="5513"><span data-slate-leaf="true" data-offset-key="5513:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusBadRequest, gin.H{</span></span></span><span data-slate-object="text" data-key="5514"><span data-slate-leaf="true" data-offset-key="5514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"error"</span></span></span></span><span data-slate-object="text" data-key="5515"><span data-slate-leaf="true" data-offset-key="5515:0" data-first-offset="true"><span data-slate-string="true">: err.Error()})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5516"><span data-slate-object="text" data-key="5517"><span data-slate-leaf="true" data-offset-key="5517:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5518"><span data-slate-leaf="true" data-offset-key="5518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5519"><span data-slate-object="text" data-key="5520"><span data-slate-leaf="true" data-offset-key="5520:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5521"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5522"><span data-slate-object="text" data-key="5523"><span data-slate-leaf="true" data-offset-key="5523:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5524"><span data-slate-leaf="true" data-offset-key="5524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 2. 参数校验</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5525"><span data-slate-object="text" data-key="5526"><span data-slate-leaf="true" data-offset-key="5526:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5527"><span data-slate-leaf="true" data-offset-key="5527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5528"><span data-slate-leaf="true" data-offset-key="5528:0" data-first-offset="true"><span data-slate-string="true"> _, ok := u.products[product.Name]; ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5529"><span data-slate-object="text" data-key="5530"><span data-slate-leaf="true" data-offset-key="5530:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusBadRequest, gin.H{</span></span></span><span data-slate-object="text" data-key="5531"><span data-slate-leaf="true" data-offset-key="5531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"error"</span></span></span></span><span data-slate-object="text" data-key="5532"><span data-slate-leaf="true" data-offset-key="5532:0" data-first-offset="true"><span data-slate-string="true">: fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="5533"><span data-slate-leaf="true" data-offset-key="5533:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"product %s already exist"</span></span></span></span><span data-slate-object="text" data-key="5534"><span data-slate-leaf="true" data-offset-key="5534:0" data-first-offset="true"><span data-slate-string="true">, product.Name)})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5535"><span data-slate-object="text" data-key="5536"><span data-slate-leaf="true" data-offset-key="5536:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5537"><span data-slate-leaf="true" data-offset-key="5537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5538"><span data-slate-object="text" data-key="5539"><span data-slate-leaf="true" data-offset-key="5539:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5540"><span data-slate-object="text" data-key="5541"><span data-slate-leaf="true" data-offset-key="5541:0" data-first-offset="true"><span data-slate-string="true">  product.CreatedAt = time.Now()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5542"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5543"><span data-slate-object="text" data-key="5544"><span data-slate-leaf="true" data-offset-key="5544:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5545"><span data-slate-leaf="true" data-offset-key="5545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 3. 逻辑处理</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5546"><span data-slate-object="text" data-key="5547"><span data-slate-leaf="true" data-offset-key="5547:0" data-first-offset="true"><span data-slate-string="true">  u.products[product.Name] = product</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5548"><span data-slate-object="text" data-key="5549"><span data-slate-leaf="true" data-offset-key="5549:0" data-first-offset="true"><span data-slate-string="true">  log.Printf(</span></span></span><span data-slate-object="text" data-key="5550"><span data-slate-leaf="true" data-offset-key="5550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Register product %s success"</span></span></span></span><span data-slate-object="text" data-key="5551"><span data-slate-leaf="true" data-offset-key="5551:0" data-first-offset="true"><span data-slate-string="true">, product.Name)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5552"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5553"><span data-slate-object="text" data-key="5554"><span data-slate-leaf="true" data-offset-key="5554:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5555"><span data-slate-leaf="true" data-offset-key="5555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 4. 返回结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5556"><span data-slate-object="text" data-key="5557"><span data-slate-leaf="true" data-offset-key="5557:0" data-first-offset="true"><span data-slate-string="true">  c.JSON(http.StatusOK, product)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5558"><span data-slate-object="text" data-key="5559"><span data-slate-leaf="true" data-offset-key="5559:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5560"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5561"><span data-slate-object="text" data-key="5562"><span data-slate-leaf="true" data-offset-key="5562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5563"><span data-slate-leaf="true" data-offset-key="5563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5564"><span data-slate-leaf="true" data-offset-key="5564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(u *productHandler)</span></span></span></span></span><span data-slate-object="text" data-key="5565"><span data-slate-leaf="true" data-offset-key="5565:0" data-first-offset="true"><span data-slate-string="true"> Get(c *gin.Context) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5566"><span data-slate-object="text" data-key="5567"><span data-slate-leaf="true" data-offset-key="5567:0" data-first-offset="true"><span data-slate-string="true">  u.Lock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5568"><span data-slate-object="text" data-key="5569"><span data-slate-leaf="true" data-offset-key="5569:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5570"><span data-slate-leaf="true" data-offset-key="5570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="5571"><span data-slate-leaf="true" data-offset-key="5571:0" data-first-offset="true"><span data-slate-string="true"> u.Unlock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5572"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5573"><span data-slate-object="text" data-key="5574"><span data-slate-leaf="true" data-offset-key="5574:0" data-first-offset="true"><span data-slate-string="true">  product, ok := u.products[c.Param(</span></span></span><span data-slate-object="text" data-key="5575"><span data-slate-leaf="true" data-offset-key="5575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="5576"><span data-slate-leaf="true" data-offset-key="5576:0" data-first-offset="true"><span data-slate-string="true">)]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5577"><span data-slate-object="text" data-key="5578"><span data-slate-leaf="true" data-offset-key="5578:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5579"><span data-slate-leaf="true" data-offset-key="5579:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5580"><span data-slate-leaf="true" data-offset-key="5580:0" data-first-offset="true"><span data-slate-string="true"> !ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5581"><span data-slate-object="text" data-key="5582"><span data-slate-leaf="true" data-offset-key="5582:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusNotFound, gin.H{</span></span></span><span data-slate-object="text" data-key="5583"><span data-slate-leaf="true" data-offset-key="5583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"error"</span></span></span></span><span data-slate-object="text" data-key="5584"><span data-slate-leaf="true" data-offset-key="5584:0" data-first-offset="true"><span data-slate-string="true">: fmt.Errorf(</span></span></span><span data-slate-object="text" data-key="5585"><span data-slate-leaf="true" data-offset-key="5585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"can not found product %s"</span></span></span></span><span data-slate-object="text" data-key="5586"><span data-slate-leaf="true" data-offset-key="5586:0" data-first-offset="true"><span data-slate-string="true">, c.Param(</span></span></span><span data-slate-object="text" data-key="5587"><span data-slate-leaf="true" data-offset-key="5587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="5588"><span data-slate-leaf="true" data-offset-key="5588:0" data-first-offset="true"><span data-slate-string="true">))})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5589"><span data-slate-object="text" data-key="5590"><span data-slate-leaf="true" data-offset-key="5590:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5591"><span data-slate-leaf="true" data-offset-key="5591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5592"><span data-slate-object="text" data-key="5593"><span data-slate-leaf="true" data-offset-key="5593:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5594"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5595"><span data-slate-object="text" data-key="5596"><span data-slate-leaf="true" data-offset-key="5596:0" data-first-offset="true"><span data-slate-string="true">  c.JSON(http.StatusOK, product)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5597"><span data-slate-object="text" data-key="5598"><span data-slate-leaf="true" data-offset-key="5598:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5599"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5600"><span data-slate-object="text" data-key="5601"><span data-slate-leaf="true" data-offset-key="5601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5602"><span data-slate-leaf="true" data-offset-key="5602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5603"><span data-slate-leaf="true" data-offset-key="5603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">router</span></span></span></span></span><span data-slate-object="text" data-key="5604"><span data-slate-leaf="true" data-offset-key="5604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="5605"><span data-slate-leaf="true" data-offset-key="5605:0" data-first-offset="true"><span data-slate-string="true"> http.Handler {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5606"><span data-slate-object="text" data-key="5607"><span data-slate-leaf="true" data-offset-key="5607:0" data-first-offset="true"><span data-slate-string="true">  router := gin.Default()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5608"><span data-slate-object="text" data-key="5609"><span data-slate-leaf="true" data-offset-key="5609:0" data-first-offset="true"><span data-slate-string="true">  productHandler := newProductHandler()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5610"><span data-slate-object="text" data-key="5611"><span data-slate-leaf="true" data-offset-key="5611:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5612"><span data-slate-leaf="true" data-offset-key="5612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由分组、中间件、认证</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5613"><span data-slate-object="text" data-key="5614"><span data-slate-leaf="true" data-offset-key="5614:0" data-first-offset="true"><span data-slate-string="true">  v1 := router.Group(</span></span></span><span data-slate-object="text" data-key="5615"><span data-slate-leaf="true" data-offset-key="5615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/v1"</span></span></span></span><span data-slate-object="text" data-key="5616"><span data-slate-leaf="true" data-offset-key="5616:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5617"><span data-slate-object="text" data-key="5618"><span data-slate-leaf="true" data-offset-key="5618:0" data-first-offset="true"><span data-slate-string="true">  {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5619"><span data-slate-object="text" data-key="5620"><span data-slate-leaf="true" data-offset-key="5620:0" data-first-offset="true"><span data-slate-string="true">    productv1 := v1.Group(</span></span></span><span data-slate-object="text" data-key="5621"><span data-slate-leaf="true" data-offset-key="5621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/products"</span></span></span></span><span data-slate-object="text" data-key="5622"><span data-slate-leaf="true" data-offset-key="5622:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5623"><span data-slate-object="text" data-key="5624"><span data-slate-leaf="true" data-offset-key="5624:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5625"><span data-slate-object="text" data-key="5626"><span data-slate-leaf="true" data-offset-key="5626:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="5627"><span data-slate-leaf="true" data-offset-key="5627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5628"><span data-slate-object="text" data-key="5629"><span data-slate-leaf="true" data-offset-key="5629:0" data-first-offset="true"><span data-slate-string="true">      productv1.POST(</span></span></span><span data-slate-object="text" data-key="5630"><span data-slate-leaf="true" data-offset-key="5630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="5631"><span data-slate-leaf="true" data-offset-key="5631:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Create)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5632"><span data-slate-object="text" data-key="5633"><span data-slate-leaf="true" data-offset-key="5633:0" data-first-offset="true"><span data-slate-string="true">      productv1.GET(</span></span></span><span data-slate-object="text" data-key="5634"><span data-slate-leaf="true" data-offset-key="5634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":name"</span></span></span></span><span data-slate-object="text" data-key="5635"><span data-slate-leaf="true" data-offset-key="5635:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Get)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5636"><span data-slate-object="text" data-key="5637"><span data-slate-leaf="true" data-offset-key="5637:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5638"><span data-slate-object="text" data-key="5639"><span data-slate-leaf="true" data-offset-key="5639:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5640"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5641"><span data-slate-object="text" data-key="5642"><span data-slate-leaf="true" data-offset-key="5642:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5643"><span data-slate-leaf="true" data-offset-key="5643:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5644"><span data-slate-leaf="true" data-offset-key="5644:0" data-first-offset="true"><span data-slate-string="true"> router</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5645"><span data-slate-object="text" data-key="5646"><span data-slate-leaf="true" data-offset-key="5646:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5647"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5648"><span data-slate-object="text" data-key="5649"><span data-slate-leaf="true" data-offset-key="5649:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5650"><span data-slate-leaf="true" data-offset-key="5650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5651"><span data-slate-leaf="true" data-offset-key="5651:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="5652"><span data-slate-leaf="true" data-offset-key="5652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="5653"><span data-slate-leaf="true" data-offset-key="5653:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5654"><span data-slate-object="text" data-key="5655"><span data-slate-leaf="true" data-offset-key="5655:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_dbfde8c4" data-attr-id="42322" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">  </span></span></span></span><span data-slate-object="text" data-key="5656"><span data-slate-leaf="true" data-offset-key="5656:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_dbfde8c4" data-attr-id="42322" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span></span><span data-slate-object="text" data-key="5657"><span data-slate-leaf="true" data-offset-key="5657:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_dbfde8c4" data-attr-id="42322" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> eg errgroup.Group</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5658"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5659"><span data-slate-object="text" data-key="5660"><span data-slate-leaf="true" data-offset-key="5660:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5661"><span data-slate-leaf="true" data-offset-key="5661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 一进程多端口</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5662"><span data-slate-object="text" data-key="5663"><span data-slate-leaf="true" data-offset-key="5663:0" data-first-offset="true"><span data-slate-string="true">  insecureServer := &amp;http.Server{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5664"><span data-slate-object="text" data-key="5665"><span data-slate-leaf="true" data-offset-key="5665:0" data-first-offset="true"><span data-slate-string="true">    Addr:         </span></span></span><span data-slate-object="text" data-key="5666"><span data-slate-leaf="true" data-offset-key="5666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span><span data-slate-object="text" data-key="5667"><span data-slate-leaf="true" data-offset-key="5667:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5668"><span data-slate-object="text" data-key="5669"><span data-slate-leaf="true" data-offset-key="5669:0" data-first-offset="true"><span data-slate-string="true">    Handler:      router(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5670"><span data-slate-object="text" data-key="5671"><span data-slate-leaf="true" data-offset-key="5671:0" data-first-offset="true"><span data-slate-string="true">    ReadTimeout:  </span></span></span><span data-slate-object="text" data-key="5672"><span data-slate-leaf="true" data-offset-key="5672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="5673"><span data-slate-leaf="true" data-offset-key="5673:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5674"><span data-slate-object="text" data-key="5675"><span data-slate-leaf="true" data-offset-key="5675:0" data-first-offset="true"><span data-slate-string="true">    WriteTimeout: </span></span></span><span data-slate-object="text" data-key="5676"><span data-slate-leaf="true" data-offset-key="5676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="5677"><span data-slate-leaf="true" data-offset-key="5677:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5678"><span data-slate-object="text" data-key="5679"><span data-slate-leaf="true" data-offset-key="5679:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5680"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5681"><span data-slate-object="text" data-key="5682"><span data-slate-leaf="true" data-offset-key="5682:0" data-first-offset="true"><span data-slate-string="true">  secureServer := &amp;http.Server{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5683"><span data-slate-object="text" data-key="5684"><span data-slate-leaf="true" data-offset-key="5684:0" data-first-offset="true"><span data-slate-string="true">    Addr:         </span></span></span><span data-slate-object="text" data-key="5685"><span data-slate-leaf="true" data-offset-key="5685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8443"</span></span></span></span><span data-slate-object="text" data-key="5686"><span data-slate-leaf="true" data-offset-key="5686:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5687"><span data-slate-object="text" data-key="5688"><span data-slate-leaf="true" data-offset-key="5688:0" data-first-offset="true"><span data-slate-string="true">    Handler:      router(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5689"><span data-slate-object="text" data-key="5690"><span data-slate-leaf="true" data-offset-key="5690:0" data-first-offset="true"><span data-slate-string="true">    ReadTimeout:  </span></span></span><span data-slate-object="text" data-key="5691"><span data-slate-leaf="true" data-offset-key="5691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="5692"><span data-slate-leaf="true" data-offset-key="5692:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5693"><span data-slate-object="text" data-key="5694"><span data-slate-leaf="true" data-offset-key="5694:0" data-first-offset="true"><span data-slate-string="true">    WriteTimeout: </span></span></span><span data-slate-object="text" data-key="5695"><span data-slate-leaf="true" data-offset-key="5695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="5696"><span data-slate-leaf="true" data-offset-key="5696:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5697"><span data-slate-object="text" data-key="5698"><span data-slate-leaf="true" data-offset-key="5698:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5699"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5700"><span data-slate-object="text" data-key="5701"><span data-slate-leaf="true" data-offset-key="5701:0" data-first-offset="true"><span data-slate-string="true">  eg.Go(</span></span></span><span data-slate-object="text" data-key="5702"><span data-slate-leaf="true" data-offset-key="5702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5703"><span data-slate-leaf="true" data-offset-key="5703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="5704"><span data-slate-leaf="true" data-offset-key="5704:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5705"><span data-slate-leaf="true" data-offset-key="5705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5706"><span data-slate-leaf="true" data-offset-key="5706:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5707"><span data-slate-object="text" data-key="5708"><span data-slate-leaf="true" data-offset-key="5708:0" data-first-offset="true"><span data-slate-string="true">    err := insecureServer.ListenAndServe()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5709"><span data-slate-object="text" data-key="5710"><span data-slate-leaf="true" data-offset-key="5710:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5711"><span data-slate-leaf="true" data-offset-key="5711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5712"><span data-slate-leaf="true" data-offset-key="5712:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="5713"><span data-slate-leaf="true" data-offset-key="5713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5714"><span data-slate-leaf="true" data-offset-key="5714:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; err != http.ErrServerClosed {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5715"><span data-slate-object="text" data-key="5716"><span data-slate-leaf="true" data-offset-key="5716:0" data-first-offset="true"><span data-slate-string="true">      log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5717"><span data-slate-object="text" data-key="5718"><span data-slate-leaf="true" data-offset-key="5718:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5719"><span data-slate-object="text" data-key="5720"><span data-slate-leaf="true" data-offset-key="5720:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5721"><span data-slate-leaf="true" data-offset-key="5721:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5722"><span data-slate-leaf="true" data-offset-key="5722:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5723"><span data-slate-object="text" data-key="5724"><span data-slate-leaf="true" data-offset-key="5724:0" data-first-offset="true"><span data-slate-string="true">  })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5725"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5726"><span data-slate-object="text" data-key="5727"><span data-slate-leaf="true" data-offset-key="5727:0" data-first-offset="true"><span data-slate-string="true">  eg.Go(</span></span></span><span data-slate-object="text" data-key="5728"><span data-slate-leaf="true" data-offset-key="5728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5729"><span data-slate-leaf="true" data-offset-key="5729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="5730"><span data-slate-leaf="true" data-offset-key="5730:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5731"><span data-slate-leaf="true" data-offset-key="5731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5732"><span data-slate-leaf="true" data-offset-key="5732:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5733"><span data-slate-object="text" data-key="5734"><span data-slate-leaf="true" data-offset-key="5734:0" data-first-offset="true"><span data-slate-string="true">    err := secureServer.ListenAndServeTLS(</span></span></span><span data-slate-object="text" data-key="5735"><span data-slate-leaf="true" data-offset-key="5735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.pem"</span></span></span></span><span data-slate-object="text" data-key="5736"><span data-slate-leaf="true" data-offset-key="5736:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5737"><span data-slate-leaf="true" data-offset-key="5737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.key"</span></span></span></span><span data-slate-object="text" data-key="5738"><span data-slate-leaf="true" data-offset-key="5738:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5739"><span data-slate-object="text" data-key="5740"><span data-slate-leaf="true" data-offset-key="5740:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5741"><span data-slate-leaf="true" data-offset-key="5741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5742"><span data-slate-leaf="true" data-offset-key="5742:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="5743"><span data-slate-leaf="true" data-offset-key="5743:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5744"><span data-slate-leaf="true" data-offset-key="5744:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; err != http.ErrServerClosed {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5745"><span data-slate-object="text" data-key="5746"><span data-slate-leaf="true" data-offset-key="5746:0" data-first-offset="true"><span data-slate-string="true">      log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5747"><span data-slate-object="text" data-key="5748"><span data-slate-leaf="true" data-offset-key="5748:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5749"><span data-slate-object="text" data-key="5750"><span data-slate-leaf="true" data-offset-key="5750:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5751"><span data-slate-leaf="true" data-offset-key="5751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5752"><span data-slate-leaf="true" data-offset-key="5752:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5753"><span data-slate-object="text" data-key="5754"><span data-slate-leaf="true" data-offset-key="5754:0" data-first-offset="true"><span data-slate-string="true">  })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5755"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5756"><span data-slate-object="text" data-key="5757"><span data-slate-leaf="true" data-offset-key="5757:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5758"><span data-slate-leaf="true" data-offset-key="5758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5759"><span data-slate-leaf="true" data-offset-key="5759:0" data-first-offset="true"><span data-slate-string="true"> err := eg.Wait(); err != </span></span></span><span data-slate-object="text" data-key="5760"><span data-slate-leaf="true" data-offset-key="5760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5761"><span data-slate-leaf="true" data-offset-key="5761:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5762"><span data-slate-object="text" data-key="5763"><span data-slate-leaf="true" data-offset-key="5763:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_ed937647" data-attr-id="41395" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    log.Fatal(err)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5764"><span data-slate-object="text" data-key="5765"><span data-slate-leaf="true" data-offset-key="5765:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5766"><span data-slate-object="text" data-key="5767"><span data-slate-leaf="true" data-offset-key="5767:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5768"><span data-slate-object="text" data-key="5769"><span data-slate-leaf="true" data-offset-key="5769:0" data-first-offset="true"><span data-slate-string="true">运行以上代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5770"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5771"><span data-slate-object="text" data-key="5772"><span data-slate-leaf="true" data-offset-key="5772:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="5773"><span data-slate-leaf="true" data-offset-key="5773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="5774"><span data-slate-leaf="true" data-offset-key="5774:0" data-first-offset="true"><span data-slate-string="true"> run main.</span></span></span><span data-slate-object="text" data-key="5775"><span data-slate-leaf="true" data-offset-key="5775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5776"><span data-slate-object="text" data-key="5777"><span data-slate-leaf="true" data-offset-key="5777:0" data-first-offset="true"><span data-slate-string="true">打开另外一个终端，请求 HTTP 接口：</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="5778"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5779"><span data-slate-object="text" data-key="5780"><span data-slate-leaf="true" data-offset-key="5780:0" data-first-offset="true"><span data-slate-string="true"># 创建产品</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5781"><span data-slate-object="text" data-key="5782"><span data-slate-leaf="true" data-offset-key="5782:0" data-first-offset="true"><span data-slate-string="true">$ curl -XPOST -H</span></span></span><span data-slate-object="text" data-key="5783"><span data-slate-leaf="true" data-offset-key="5783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Content-Type: application/json"</span></span></span></span><span data-slate-object="text" data-key="5784"><span data-slate-leaf="true" data-offset-key="5784:0" data-first-offset="true"><span data-slate-string="true"> -d'{</span></span></span><span data-slate-object="text" data-key="5785"><span data-slate-leaf="true" data-offset-key="5785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="5786"><span data-slate-leaf="true" data-offset-key="5786:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5787"><span data-slate-leaf="true" data-offset-key="5787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="5788"><span data-slate-leaf="true" data-offset-key="5788:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5789"><span data-slate-leaf="true" data-offset-key="5789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="5790"><span data-slate-leaf="true" data-offset-key="5790:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5791"><span data-slate-leaf="true" data-offset-key="5791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iphone12"</span></span></span></span><span data-slate-object="text" data-key="5792"><span data-slate-leaf="true" data-offset-key="5792:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5793"><span data-slate-leaf="true" data-offset-key="5793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"category"</span></span></span></span><span data-slate-object="text" data-key="5794"><span data-slate-leaf="true" data-offset-key="5794:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5795"><span data-slate-leaf="true" data-offset-key="5795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"phone"</span></span></span></span><span data-slate-object="text" data-key="5796"><span data-slate-leaf="true" data-offset-key="5796:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5797"><span data-slate-leaf="true" data-offset-key="5797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"price"</span></span></span></span><span data-slate-object="text" data-key="5798"><span data-slate-leaf="true" data-offset-key="5798:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5799"><span data-slate-leaf="true" data-offset-key="5799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8000</span></span></span></span><span data-slate-object="text" data-key="5800"><span data-slate-leaf="true" data-offset-key="5800:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5801"><span data-slate-leaf="true" data-offset-key="5801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"description"</span></span></span></span><span data-slate-object="text" data-key="5802"><span data-slate-leaf="true" data-offset-key="5802:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5803"><span data-slate-leaf="true" data-offset-key="5803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"cannot afford"</span></span></span></span><span data-slate-object="text" data-key="5804"><span data-slate-leaf="true" data-offset-key="5804:0" data-first-offset="true"><span data-slate-string="true">}' http:</span></span></span><span data-slate-object="text" data-key="5805"><span data-slate-leaf="true" data-offset-key="5805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//127.0.0.1:8080/v1/products</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5806"><span data-slate-object="text" data-key="5807"><span data-slate-leaf="true" data-offset-key="5807:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="5808"><span data-slate-leaf="true" data-offset-key="5808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="5809"><span data-slate-leaf="true" data-offset-key="5809:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5810"><span data-slate-leaf="true" data-offset-key="5810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="5811"><span data-slate-leaf="true" data-offset-key="5811:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5812"><span data-slate-leaf="true" data-offset-key="5812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="5813"><span data-slate-leaf="true" data-offset-key="5813:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5814"><span data-slate-leaf="true" data-offset-key="5814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iphone12"</span></span></span></span><span data-slate-object="text" data-key="5815"><span data-slate-leaf="true" data-offset-key="5815:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5816"><span data-slate-leaf="true" data-offset-key="5816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"category"</span></span></span></span><span data-slate-object="text" data-key="5817"><span data-slate-leaf="true" data-offset-key="5817:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5818"><span data-slate-leaf="true" data-offset-key="5818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"phone"</span></span></span></span><span data-slate-object="text" data-key="5819"><span data-slate-leaf="true" data-offset-key="5819:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5820"><span data-slate-leaf="true" data-offset-key="5820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"price"</span></span></span></span><span data-slate-object="text" data-key="5821"><span data-slate-leaf="true" data-offset-key="5821:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5822"><span data-slate-leaf="true" data-offset-key="5822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8000</span></span></span></span><span data-slate-object="text" data-key="5823"><span data-slate-leaf="true" data-offset-key="5823:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5824"><span data-slate-leaf="true" data-offset-key="5824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"description"</span></span></span></span><span data-slate-object="text" data-key="5825"><span data-slate-leaf="true" data-offset-key="5825:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5826"><span data-slate-leaf="true" data-offset-key="5826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"cannot afford"</span></span></span></span><span data-slate-object="text" data-key="5827"><span data-slate-leaf="true" data-offset-key="5827:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5828"><span data-slate-leaf="true" data-offset-key="5828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"createdAt"</span></span></span></span><span data-slate-object="text" data-key="5829"><span data-slate-leaf="true" data-offset-key="5829:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5830"><span data-slate-leaf="true" data-offset-key="5830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"2021-06-20T11:17:03.818065988+08:00"</span></span></span></span><span data-slate-object="text" data-key="5831"><span data-slate-leaf="true" data-offset-key="5831:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5832"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5833"><span data-slate-object="text" data-key="5834"><span data-slate-leaf="true" data-offset-key="5834:0" data-first-offset="true"><span data-slate-string="true"># 获取产品信息</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5835"><span data-slate-object="text" data-key="5836"><span data-slate-leaf="true" data-offset-key="5836:0" data-first-offset="true"><span data-slate-string="true">$ curl -XGET http:</span></span></span><span data-slate-object="text" data-key="5837"><span data-slate-leaf="true" data-offset-key="5837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//127.0.0.1:8080/v1/products/iphone12</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5838"><span data-slate-object="text" data-key="5839"><span data-slate-leaf="true" data-offset-key="5839:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="5840"><span data-slate-leaf="true" data-offset-key="5840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"username"</span></span></span></span><span data-slate-object="text" data-key="5841"><span data-slate-leaf="true" data-offset-key="5841:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5842"><span data-slate-leaf="true" data-offset-key="5842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="5843"><span data-slate-leaf="true" data-offset-key="5843:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5844"><span data-slate-leaf="true" data-offset-key="5844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="5845"><span data-slate-leaf="true" data-offset-key="5845:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5846"><span data-slate-leaf="true" data-offset-key="5846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"iphone12"</span></span></span></span><span data-slate-object="text" data-key="5847"><span data-slate-leaf="true" data-offset-key="5847:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5848"><span data-slate-leaf="true" data-offset-key="5848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"category"</span></span></span></span><span data-slate-object="text" data-key="5849"><span data-slate-leaf="true" data-offset-key="5849:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5850"><span data-slate-leaf="true" data-offset-key="5850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"phone"</span></span></span></span><span data-slate-object="text" data-key="5851"><span data-slate-leaf="true" data-offset-key="5851:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5852"><span data-slate-leaf="true" data-offset-key="5852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"price"</span></span></span></span><span data-slate-object="text" data-key="5853"><span data-slate-leaf="true" data-offset-key="5853:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5854"><span data-slate-leaf="true" data-offset-key="5854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8000</span></span></span></span><span data-slate-object="text" data-key="5855"><span data-slate-leaf="true" data-offset-key="5855:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5856"><span data-slate-leaf="true" data-offset-key="5856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"description"</span></span></span></span><span data-slate-object="text" data-key="5857"><span data-slate-leaf="true" data-offset-key="5857:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5858"><span data-slate-leaf="true" data-offset-key="5858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"cannot afford"</span></span></span></span><span data-slate-object="text" data-key="5859"><span data-slate-leaf="true" data-offset-key="5859:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="5860"><span data-slate-leaf="true" data-offset-key="5860:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"createdAt"</span></span></span></span><span data-slate-object="text" data-key="5861"><span data-slate-leaf="true" data-offset-key="5861:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="5862"><span data-slate-leaf="true" data-offset-key="5862:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"2021-06-20T11:17:03.818065988+08:00"</span></span></span></span><span data-slate-object="text" data-key="5863"><span data-slate-leaf="true" data-offset-key="5863:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5864"><span data-slate-object="text" data-key="5865"><span data-slate-leaf="true" data-offset-key="5865:0" data-first-offset="true"><span data-slate-string="true">示例代码存放地址为 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5866"><span data-slate-object="text" data-key="5867"><span data-slate-leaf="true" data-offset-key="5867:0" data-first-offset="true"><span data-slate-string="true">webfeature</span></span></span></a><span data-slate-object="text" data-key="5868"><span data-slate-leaf="true" data-offset-key="5868:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5869"><span data-slate-object="text" data-key="5870"><span data-slate-leaf="true" data-offset-key="5870:0" data-first-offset="true"><span data-slate-string="true">另外，Gin 项目仓库中也包含了很多使用示例，如果你想详细了解，可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5871"><span data-slate-object="text" data-key="5872"><span data-slate-leaf="true" data-offset-key="5872:0" data-first-offset="true"><span data-slate-string="true">gin examples</span></span></span></a><span data-slate-object="text" data-key="5873"><span data-slate-leaf="true" data-offset-key="5873:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5874"><span data-slate-object="text" data-key="5875"><span data-slate-leaf="true" data-offset-key="5875:0" data-first-offset="true"><span data-slate-string="true">下面，我来详细介绍下 Gin 是如何支持 Web 服务基础功能的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5876" id="sr-toc-4"><span data-slate-object="text" data-key="5877"><span data-slate-leaf="true" data-offset-key="5877:0" data-first-offset="true"><span data-slate-string="true">HTTP/HTTPS 支持</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5878"><span data-slate-object="text" data-key="5879"><span data-slate-leaf="true" data-offset-key="5879:0" data-first-offset="true"><span data-slate-string="true">因为 Gin 是基于 net/http 包封装的一个 Web 框架，所以它天然就支持 HTTP/HTTPS。在上述代码中，通过以下方式开启一个 HTTP 服务：</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="5880"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5881"><span data-slate-object="text" data-key="5882"><span data-slate-leaf="true" data-offset-key="5882:0" data-first-offset="true"><span data-slate-string="true">insecureServer := &amp;http.Server{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5883"><span data-slate-object="text" data-key="5884"><span data-slate-leaf="true" data-offset-key="5884:0" data-first-offset="true"><span data-slate-string="true">  Addr:         </span></span></span><span data-slate-object="text" data-key="5885"><span data-slate-leaf="true" data-offset-key="5885:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span><span data-slate-object="text" data-key="5886"><span data-slate-leaf="true" data-offset-key="5886:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5887"><span data-slate-object="text" data-key="5888"><span data-slate-leaf="true" data-offset-key="5888:0" data-first-offset="true"><span data-slate-string="true">  Handler:      </span></span></span><span data-slate-object="text" data-key="5889"><span data-slate-leaf="true" data-offset-key="5889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">router</span></span></span></span><span data-slate-object="text" data-key="5890"><span data-slate-leaf="true" data-offset-key="5890:0" data-first-offset="true"><span data-slate-string="true">(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5891"><span data-slate-object="text" data-key="5892"><span data-slate-leaf="true" data-offset-key="5892:0" data-first-offset="true"><span data-slate-string="true">  ReadTimeout:  </span></span></span><span data-slate-object="text" data-key="5893"><span data-slate-leaf="true" data-offset-key="5893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="5894"><span data-slate-leaf="true" data-offset-key="5894:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5895"><span data-slate-object="text" data-key="5896"><span data-slate-leaf="true" data-offset-key="5896:0" data-first-offset="true"><span data-slate-string="true">  WriteTimeout: </span></span></span><span data-slate-object="text" data-key="5897"><span data-slate-leaf="true" data-offset-key="5897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="5898"><span data-slate-leaf="true" data-offset-key="5898:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5899"><span data-slate-object="text" data-key="5900"><span data-slate-leaf="true" data-offset-key="5900:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5901"><span data-slate-object="text" data-key="5902"><span data-slate-leaf="true" data-offset-key="5902:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5903"><span data-slate-object="text" data-key="5904"><span data-slate-leaf="true" data-offset-key="5904:0" data-first-offset="true"><span data-slate-string="true">err := insecureServer.</span></span></span><span data-slate-object="text" data-key="5905"><span data-slate-leaf="true" data-offset-key="5905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListenAndServe</span></span></span></span><span data-slate-object="text" data-key="5906"><span data-slate-leaf="true" data-offset-key="5906:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5907"><span data-slate-object="text" data-key="5908"><span data-slate-leaf="true" data-offset-key="5908:0" data-first-offset="true"><span data-slate-string="true">通过以下方式开启一个 HTTPS 服务：</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="5909"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5910"><span data-slate-object="text" data-key="5911"><span data-slate-leaf="true" data-offset-key="5911:0" data-first-offset="true"><span data-slate-string="true">secureServer := &amp;http.Server{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5912"><span data-slate-object="text" data-key="5913"><span data-slate-leaf="true" data-offset-key="5913:0" data-first-offset="true"><span data-slate-string="true">  Addr:         </span></span></span><span data-slate-object="text" data-key="5914"><span data-slate-leaf="true" data-offset-key="5914:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8443"</span></span></span></span><span data-slate-object="text" data-key="5915"><span data-slate-leaf="true" data-offset-key="5915:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5916"><span data-slate-object="text" data-key="5917"><span data-slate-leaf="true" data-offset-key="5917:0" data-first-offset="true"><span data-slate-string="true">  Handler:      </span></span></span><span data-slate-object="text" data-key="5918"><span data-slate-leaf="true" data-offset-key="5918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">router</span></span></span></span><span data-slate-object="text" data-key="5919"><span data-slate-leaf="true" data-offset-key="5919:0" data-first-offset="true"><span data-slate-string="true">(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5920"><span data-slate-object="text" data-key="5921"><span data-slate-leaf="true" data-offset-key="5921:0" data-first-offset="true"><span data-slate-string="true">  ReadTimeout:  </span></span></span><span data-slate-object="text" data-key="5922"><span data-slate-leaf="true" data-offset-key="5922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="5923"><span data-slate-leaf="true" data-offset-key="5923:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5924"><span data-slate-object="text" data-key="5925"><span data-slate-leaf="true" data-offset-key="5925:0" data-first-offset="true"><span data-slate-string="true">  WriteTimeout: </span></span></span><span data-slate-object="text" data-key="5926"><span data-slate-leaf="true" data-offset-key="5926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="5927"><span data-slate-leaf="true" data-offset-key="5927:0" data-first-offset="true"><span data-slate-string="true"> * time.Second,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5928"><span data-slate-object="text" data-key="5929"><span data-slate-leaf="true" data-offset-key="5929:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5930"><span data-slate-object="text" data-key="5931"><span data-slate-leaf="true" data-offset-key="5931:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5932"><span data-slate-object="text" data-key="5933"><span data-slate-leaf="true" data-offset-key="5933:0" data-first-offset="true"><span data-slate-string="true">err := secureServer.</span></span></span><span data-slate-object="text" data-key="5934"><span data-slate-leaf="true" data-offset-key="5934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListenAndServeTLS</span></span></span></span><span data-slate-object="text" data-key="5935"><span data-slate-leaf="true" data-offset-key="5935:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="5936"><span data-slate-leaf="true" data-offset-key="5936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.pem"</span></span></span></span><span data-slate-object="text" data-key="5937"><span data-slate-leaf="true" data-offset-key="5937:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5938"><span data-slate-leaf="true" data-offset-key="5938:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.key"</span></span></span></span><span data-slate-object="text" data-key="5939"><span data-slate-leaf="true" data-offset-key="5939:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5940" id="sr-toc-5"><span data-slate-object="text" data-key="5941"><span data-slate-leaf="true" data-offset-key="5941:0" data-first-offset="true"><span data-slate-string="true">JSON 数据格式支持</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5942"><span data-slate-object="text" data-key="5943"><span data-slate-leaf="true" data-offset-key="5943:0" data-first-offset="true"><span data-slate-string="true">Gin 支持多种数据通信格式，例如 application/json、application/xml。可以通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="5944"><span data-slate-object="text" data-key="5945"><span data-slate-leaf="true" data-offset-key="5945:0" data-first-offset="true"><span data-slate-string="true"> c.ShouldBindJSON</span></span></span></span><span data-slate-object="text" data-key="5946"><span data-slate-leaf="true" data-offset-key="5946:0" data-first-offset="true"><span data-slate-string="true"> 函数，将 Body 中的 JSON 格式数据解析到指定的 Struct 中，通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="5947"><span data-slate-object="text" data-key="5948"><span data-slate-leaf="true" data-offset-key="5948:0" data-first-offset="true"><span data-slate-string="true"> c.JSON</span></span></span></span><span data-slate-object="text" data-key="5949"><span data-slate-leaf="true" data-offset-key="5949:0" data-first-offset="true"><span data-slate-string="true"> 函数返回 JSON 格式的数据。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5950" id="sr-toc-6"><span data-slate-object="text" data-key="5951"><span data-slate-leaf="true" data-offset-key="5951:0" data-first-offset="true"><span data-slate-string="true">路由匹配</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5952"><span data-slate-object="text" data-key="5953"><span data-slate-leaf="true" data-offset-key="5953:0" data-first-offset="true"><span data-slate-string="true">Gin 支持两种路由匹配规则。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5954"><span data-slate-object="text" data-key="5955"><span data-slate-leaf="true" data-offset-key="5955:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一种匹配规则是精确匹配。</span></span></span></span><span data-slate-object="text" data-key="5956"><span data-slate-leaf="true" data-offset-key="5956:0" data-first-offset="true"><span data-slate-string="true">例如，路由为 /products/:name，匹配情况如下表所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5957"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/11/df/11be05d7fe7f935e01725e2635f315df.jpg?wh=2248x1418"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5958"><span data-slate-object="text" data-key="5959"><span data-slate-leaf="true" data-offset-key="5959:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二种匹配规则是模糊匹配。</span></span></span></span><span data-slate-object="text" data-key="5960"><span data-slate-leaf="true" data-offset-key="5960:0" data-first-offset="true"><span data-slate-string="true">例如，路由为 /products/*name，匹配情况如下表所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5961"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b5/7b/b5ccd9924e53dd90a64af6002967b67b.jpg?wh=2248x1636"></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5962" id="sr-toc-7"><span data-slate-object="text" data-key="5963"><span data-slate-leaf="true" data-offset-key="5963:0" data-first-offset="true"><span data-slate-string="true">路由分组</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5964"><span data-slate-object="text" data-key="5965"><span data-slate-leaf="true" data-offset-key="5965:0" data-first-offset="true"><span data-slate-string="true">Gin 通过 Group 函数实现了路由分组的功能。路由分组是一个非常常用的功能，可以将相同版本的路由分为一组，也可以将相同 RESTful 资源的路由分为一组。例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5966"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5967"><span data-slate-object="text" data-key="5968"><span data-slate-leaf="true" data-offset-key="5968:0" data-first-offset="true"><span data-slate-string="true">v1 := router.Group(</span></span></span><span data-slate-object="text" data-key="5969"><span data-slate-leaf="true" data-offset-key="5969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/v1"</span></span></span></span><span data-slate-object="text" data-key="5970"><span data-slate-leaf="true" data-offset-key="5970:0" data-first-offset="true"><span data-slate-string="true">, gin.BasicAuth(gin.Accounts{</span></span></span><span data-slate-object="text" data-key="5971"><span data-slate-leaf="true" data-offset-key="5971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"foo"</span></span></span></span><span data-slate-object="text" data-key="5972"><span data-slate-leaf="true" data-offset-key="5972:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="5973"><span data-slate-leaf="true" data-offset-key="5973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="5974"><span data-slate-leaf="true" data-offset-key="5974:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5975"><span data-slate-leaf="true" data-offset-key="5975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="5976"><span data-slate-leaf="true" data-offset-key="5976:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="5977"><span data-slate-leaf="true" data-offset-key="5977:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="5978"><span data-slate-leaf="true" data-offset-key="5978:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5979"><span data-slate-object="text" data-key="5980"><span data-slate-leaf="true" data-offset-key="5980:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5981"><span data-slate-object="text" data-key="5982"><span data-slate-leaf="true" data-offset-key="5982:0" data-first-offset="true"><span data-slate-string="true">    productv1 := v1.Group(</span></span></span><span data-slate-object="text" data-key="5983"><span data-slate-leaf="true" data-offset-key="5983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/products"</span></span></span></span><span data-slate-object="text" data-key="5984"><span data-slate-leaf="true" data-offset-key="5984:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5985"><span data-slate-object="text" data-key="5986"><span data-slate-leaf="true" data-offset-key="5986:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5987"><span data-slate-object="text" data-key="5988"><span data-slate-leaf="true" data-offset-key="5988:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="5989"><span data-slate-leaf="true" data-offset-key="5989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5990"><span data-slate-object="text" data-key="5991"><span data-slate-leaf="true" data-offset-key="5991:0" data-first-offset="true"><span data-slate-string="true">        productv1.POST(</span></span></span><span data-slate-object="text" data-key="5992"><span data-slate-leaf="true" data-offset-key="5992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="5993"><span data-slate-leaf="true" data-offset-key="5993:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Create)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5994"><span data-slate-object="text" data-key="5995"><span data-slate-leaf="true" data-offset-key="5995:0" data-first-offset="true"><span data-slate-string="true">        productv1.GET(</span></span></span><span data-slate-object="text" data-key="5996"><span data-slate-leaf="true" data-offset-key="5996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":name"</span></span></span></span><span data-slate-object="text" data-key="5997"><span data-slate-leaf="true" data-offset-key="5997:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Get)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5998"><span data-slate-object="text" data-key="5999"><span data-slate-leaf="true" data-offset-key="5999:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6000"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6001"><span data-slate-object="text" data-key="6002"><span data-slate-leaf="true" data-offset-key="6002:0" data-first-offset="true"><span data-slate-string="true">    orderv1 := v1.Group(</span></span></span><span data-slate-object="text" data-key="6003"><span data-slate-leaf="true" data-offset-key="6003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/orders"</span></span></span></span><span data-slate-object="text" data-key="6004"><span data-slate-leaf="true" data-offset-key="6004:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6005"><span data-slate-object="text" data-key="6006"><span data-slate-leaf="true" data-offset-key="6006:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6007"><span data-slate-object="text" data-key="6008"><span data-slate-leaf="true" data-offset-key="6008:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6009"><span data-slate-leaf="true" data-offset-key="6009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6010"><span data-slate-object="text" data-key="6011"><span data-slate-leaf="true" data-offset-key="6011:0" data-first-offset="true"><span data-slate-string="true">        orderv1.POST(</span></span></span><span data-slate-object="text" data-key="6012"><span data-slate-leaf="true" data-offset-key="6012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6013"><span data-slate-leaf="true" data-offset-key="6013:0" data-first-offset="true"><span data-slate-string="true">, orderHandler.Create)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6014"><span data-slate-object="text" data-key="6015"><span data-slate-leaf="true" data-offset-key="6015:0" data-first-offset="true"><span data-slate-string="true">        orderv1.GET(</span></span></span><span data-slate-object="text" data-key="6016"><span data-slate-leaf="true" data-offset-key="6016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":name"</span></span></span></span><span data-slate-object="text" data-key="6017"><span data-slate-leaf="true" data-offset-key="6017:0" data-first-offset="true"><span data-slate-string="true">, orderHandler.Get)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6018"><span data-slate-object="text" data-key="6019"><span data-slate-leaf="true" data-offset-key="6019:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6020"><span data-slate-object="text" data-key="6021"><span data-slate-leaf="true" data-offset-key="6021:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6022"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6023"><span data-slate-object="text" data-key="6024"><span data-slate-leaf="true" data-offset-key="6024:0" data-first-offset="true"><span data-slate-string="true">v2 := router.Group(</span></span></span><span data-slate-object="text" data-key="6025"><span data-slate-leaf="true" data-offset-key="6025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/v2"</span></span></span></span><span data-slate-object="text" data-key="6026"><span data-slate-leaf="true" data-offset-key="6026:0" data-first-offset="true"><span data-slate-string="true">, gin.BasicAuth(gin.Accounts{</span></span></span><span data-slate-object="text" data-key="6027"><span data-slate-leaf="true" data-offset-key="6027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"foo"</span></span></span></span><span data-slate-object="text" data-key="6028"><span data-slate-leaf="true" data-offset-key="6028:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6029"><span data-slate-leaf="true" data-offset-key="6029:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="6030"><span data-slate-leaf="true" data-offset-key="6030:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6031"><span data-slate-leaf="true" data-offset-key="6031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="6032"><span data-slate-leaf="true" data-offset-key="6032:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6033"><span data-slate-leaf="true" data-offset-key="6033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="6034"><span data-slate-leaf="true" data-offset-key="6034:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6035"><span data-slate-object="text" data-key="6036"><span data-slate-leaf="true" data-offset-key="6036:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6037"><span data-slate-object="text" data-key="6038"><span data-slate-leaf="true" data-offset-key="6038:0" data-first-offset="true"><span data-slate-string="true">    productv2 := v2.Group(</span></span></span><span data-slate-object="text" data-key="6039"><span data-slate-leaf="true" data-offset-key="6039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/products"</span></span></span></span><span data-slate-object="text" data-key="6040"><span data-slate-leaf="true" data-offset-key="6040:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6041"><span data-slate-object="text" data-key="6042"><span data-slate-leaf="true" data-offset-key="6042:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6043"><span data-slate-object="text" data-key="6044"><span data-slate-leaf="true" data-offset-key="6044:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6045"><span data-slate-leaf="true" data-offset-key="6045:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6046"><span data-slate-object="text" data-key="6047"><span data-slate-leaf="true" data-offset-key="6047:0" data-first-offset="true"><span data-slate-string="true">        productv2.POST(</span></span></span><span data-slate-object="text" data-key="6048"><span data-slate-leaf="true" data-offset-key="6048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6049"><span data-slate-leaf="true" data-offset-key="6049:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Create)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6050"><span data-slate-object="text" data-key="6051"><span data-slate-leaf="true" data-offset-key="6051:0" data-first-offset="true"><span data-slate-string="true">        productv2.GET(</span></span></span><span data-slate-object="text" data-key="6052"><span data-slate-leaf="true" data-offset-key="6052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":name"</span></span></span></span><span data-slate-object="text" data-key="6053"><span data-slate-leaf="true" data-offset-key="6053:0" data-first-offset="true"><span data-slate-string="true">, productHandler.Get)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6054"><span data-slate-object="text" data-key="6055"><span data-slate-leaf="true" data-offset-key="6055:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6056"><span data-slate-object="text" data-key="6057"><span data-slate-leaf="true" data-offset-key="6057:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6058"><span data-slate-object="text" data-key="6059"><span data-slate-leaf="true" data-offset-key="6059:0" data-first-offset="true"><span data-slate-string="true">通过将路由分组，可以对相同分组的路由做统一处理。比如上面那个例子，我们可以通过代码</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="6060"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6061"><span data-slate-object="text" data-key="6062"><span data-slate-leaf="true" data-offset-key="6062:0" data-first-offset="true"><span data-slate-string="true">v1 := router.</span></span></span><span data-slate-object="text" data-key="6063"><span data-slate-leaf="true" data-offset-key="6063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Group</span></span></span></span><span data-slate-object="text" data-key="6064"><span data-slate-leaf="true" data-offset-key="6064:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6065"><span data-slate-leaf="true" data-offset-key="6065:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/v1"</span></span></span></span><span data-slate-object="text" data-key="6066"><span data-slate-leaf="true" data-offset-key="6066:0" data-first-offset="true"><span data-slate-string="true">, gin.</span></span></span><span data-slate-object="text" data-key="6067"><span data-slate-leaf="true" data-offset-key="6067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BasicAuth</span></span></span></span><span data-slate-object="text" data-key="6068"><span data-slate-leaf="true" data-offset-key="6068:0" data-first-offset="true"><span data-slate-string="true">(gin.Accounts{"foo": </span></span></span><span data-slate-object="text" data-key="6069"><span data-slate-leaf="true" data-offset-key="6069:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="6070"><span data-slate-leaf="true" data-offset-key="6070:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6071"><span data-slate-leaf="true" data-offset-key="6071:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="6072"><span data-slate-leaf="true" data-offset-key="6072:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6073"><span data-slate-leaf="true" data-offset-key="6073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="6074"><span data-slate-leaf="true" data-offset-key="6074:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6075"><span data-slate-object="text" data-key="6076"><span data-slate-leaf="true" data-offset-key="6076:0" data-first-offset="true"><span data-slate-string="true">给所有属于 v1 分组的路由都添加 gin.BasicAuth 中间件，以实现认证功能。中间件和认证，这里你先不用深究，下面讲高级功能的时候会介绍到。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6077" id="sr-toc-8"><span data-slate-object="text" data-key="6078"><span data-slate-leaf="true" data-offset-key="6078:0" data-first-offset="true"><span data-slate-string="true">一进程多服务</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6079"><span data-slate-object="text" data-key="6080"><span data-slate-leaf="true" data-offset-key="6080:0" data-first-offset="true"><span data-slate-string="true">我们可以通过以下方式实现一进程多服务：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6081"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6082"><span data-slate-object="text" data-key="6083"><span data-slate-leaf="true" data-offset-key="6083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="6084"><span data-slate-leaf="true" data-offset-key="6084:0" data-first-offset="true"><span data-slate-string="true"> eg errgroup.Group</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6085"><span data-slate-object="text" data-key="6086"><span data-slate-leaf="true" data-offset-key="6086:0" data-first-offset="true"><span data-slate-string="true">insecureServer := &amp;http.Server{...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6087"><span data-slate-object="text" data-key="6088"><span data-slate-leaf="true" data-offset-key="6088:0" data-first-offset="true"><span data-slate-string="true">secureServer := &amp;http.Server{...}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6089"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6090"><span data-slate-object="text" data-key="6091"><span data-slate-leaf="true" data-offset-key="6091:0" data-first-offset="true"><span data-slate-string="true">eg.Go(</span></span></span><span data-slate-object="text" data-key="6092"><span data-slate-leaf="true" data-offset-key="6092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6093"><span data-slate-leaf="true" data-offset-key="6093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6094"><span data-slate-leaf="true" data-offset-key="6094:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6095"><span data-slate-leaf="true" data-offset-key="6095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="6096"><span data-slate-leaf="true" data-offset-key="6096:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6097"><span data-slate-object="text" data-key="6098"><span data-slate-leaf="true" data-offset-key="6098:0" data-first-offset="true"><span data-slate-string="true">  err := insecureServer.ListenAndServe()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6099"><span data-slate-object="text" data-key="6100"><span data-slate-leaf="true" data-offset-key="6100:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6101"><span data-slate-leaf="true" data-offset-key="6101:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6102"><span data-slate-leaf="true" data-offset-key="6102:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6103"><span data-slate-leaf="true" data-offset-key="6103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6104"><span data-slate-leaf="true" data-offset-key="6104:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; err != http.ErrServerClosed {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6105"><span data-slate-object="text" data-key="6106"><span data-slate-leaf="true" data-offset-key="6106:0" data-first-offset="true"><span data-slate-string="true">    log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6107"><span data-slate-object="text" data-key="6108"><span data-slate-leaf="true" data-offset-key="6108:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6109"><span data-slate-object="text" data-key="6110"><span data-slate-leaf="true" data-offset-key="6110:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6111"><span data-slate-leaf="true" data-offset-key="6111:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6112"><span data-slate-leaf="true" data-offset-key="6112:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6113"><span data-slate-object="text" data-key="6114"><span data-slate-leaf="true" data-offset-key="6114:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6115"><span data-slate-object="text" data-key="6116"><span data-slate-leaf="true" data-offset-key="6116:0" data-first-offset="true"><span data-slate-string="true">eg.Go(</span></span></span><span data-slate-object="text" data-key="6117"><span data-slate-leaf="true" data-offset-key="6117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6118"><span data-slate-leaf="true" data-offset-key="6118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6119"><span data-slate-leaf="true" data-offset-key="6119:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6120"><span data-slate-leaf="true" data-offset-key="6120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="6121"><span data-slate-leaf="true" data-offset-key="6121:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6122"><span data-slate-object="text" data-key="6123"><span data-slate-leaf="true" data-offset-key="6123:0" data-first-offset="true"><span data-slate-string="true">  err := secureServer.ListenAndServeTLS(</span></span></span><span data-slate-object="text" data-key="6124"><span data-slate-leaf="true" data-offset-key="6124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.pem"</span></span></span></span><span data-slate-object="text" data-key="6125"><span data-slate-leaf="true" data-offset-key="6125:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6126"><span data-slate-leaf="true" data-offset-key="6126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"server.key"</span></span></span></span><span data-slate-object="text" data-key="6127"><span data-slate-leaf="true" data-offset-key="6127:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6128"><span data-slate-object="text" data-key="6129"><span data-slate-leaf="true" data-offset-key="6129:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6130"><span data-slate-leaf="true" data-offset-key="6130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6131"><span data-slate-leaf="true" data-offset-key="6131:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6132"><span data-slate-leaf="true" data-offset-key="6132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6133"><span data-slate-leaf="true" data-offset-key="6133:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; err != http.ErrServerClosed {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6134"><span data-slate-object="text" data-key="6135"><span data-slate-leaf="true" data-offset-key="6135:0" data-first-offset="true"><span data-slate-string="true">    log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6136"><span data-slate-object="text" data-key="6137"><span data-slate-leaf="true" data-offset-key="6137:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6138"><span data-slate-object="text" data-key="6139"><span data-slate-leaf="true" data-offset-key="6139:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6140"><span data-slate-leaf="true" data-offset-key="6140:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6141"><span data-slate-leaf="true" data-offset-key="6141:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6142"><span data-slate-object="text" data-key="6143"><span data-slate-leaf="true" data-offset-key="6143:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6144"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6145"><span data-slate-object="text" data-key="6146"><span data-slate-leaf="true" data-offset-key="6146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6147"><span data-slate-leaf="true" data-offset-key="6147:0" data-first-offset="true"><span data-slate-string="true"> err := eg.Wait(); err != </span></span></span><span data-slate-object="text" data-key="6148"><span data-slate-leaf="true" data-offset-key="6148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6149"><span data-slate-leaf="true" data-offset-key="6149:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6150"><span data-slate-object="text" data-key="6151"><span data-slate-leaf="true" data-offset-key="6151:0" data-first-offset="true"><span data-slate-string="true">  log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6152"><span data-slate-object="text" data-key="6153"><span data-slate-leaf="true" data-offset-key="6153:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6154"><span data-slate-object="text" data-key="6155"><span data-slate-leaf="true" data-offset-key="6155:0" data-first-offset="true"><span data-slate-string="true">上述代码实现了两个相同的服务，分别监听在不同的端口。这里需要注意的是，为了不阻塞启动第二个服务，我们需要把 ListenAndServe 函数放在 goroutine 中执行，并且调用 eg.Wait () 来阻塞程序进程，从而让两个 HTTP 服务在 goroutine 中持续监听端口，并提供服务。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6156" id="sr-toc-9"><span data-slate-object="text" data-key="6157"><span data-slate-leaf="true" data-offset-key="6157:0" data-first-offset="true"><span data-slate-string="true">参数解析、参数校验、逻辑处理、返回结果</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6158"><span data-slate-object="text" data-key="6159"><span data-slate-leaf="true" data-offset-key="6159:0" data-first-offset="true"><span data-slate-string="true">此外，Web 服务还应该具有参数解析、参数校验、逻辑处理、返回结果 4 类功能，因为这些功能联系紧密，我们放在一起来说。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6160"><span data-slate-object="text" data-key="6161"><span data-slate-leaf="true" data-offset-key="6161:0" data-first-offset="true"><span data-slate-string="true">在 productHandler 的 Create 方法中，我们通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6162"><span data-slate-object="text" data-key="6163"><span data-slate-leaf="true" data-offset-key="6163:0" data-first-offset="true"><span data-slate-string="true"> c.ShouldBindJSON</span></span></span></span><span data-slate-object="text" data-key="6164"><span data-slate-leaf="true" data-offset-key="6164:0" data-first-offset="true"><span data-slate-string="true"> 来解析参数，接下来自己编写校验代码，然后将 product 信息保存在内存中（也就是业务逻辑处理），最后通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6165"><span data-slate-object="text" data-key="6166"><span data-slate-leaf="true" data-offset-key="6166:0" data-first-offset="true"><span data-slate-string="true"> c.JSON</span></span></span></span><span data-slate-object="text" data-key="6167"><span data-slate-leaf="true" data-offset-key="6167:0" data-first-offset="true"><span data-slate-string="true"> 返回创建的 product 信息。代码如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6168"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6169"><span data-slate-object="text" data-key="6170"><span data-slate-leaf="true" data-offset-key="6170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6171"><span data-slate-leaf="true" data-offset-key="6171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6172"><span data-slate-leaf="true" data-offset-key="6172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(u *productHandler)</span></span></span></span></span><span data-slate-object="text" data-key="6173"><span data-slate-leaf="true" data-offset-key="6173:0" data-first-offset="true"><span data-slate-string="true"> Create(c *gin.Context) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6174"><span data-slate-object="text" data-key="6175"><span data-slate-leaf="true" data-offset-key="6175:0" data-first-offset="true"><span data-slate-string="true">  u.Lock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6176"><span data-slate-object="text" data-key="6177"><span data-slate-leaf="true" data-offset-key="6177:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6178"><span data-slate-leaf="true" data-offset-key="6178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="6179"><span data-slate-leaf="true" data-offset-key="6179:0" data-first-offset="true"><span data-slate-string="true"> u.Unlock()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6180"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6181"><span data-slate-object="text" data-key="6182"><span data-slate-leaf="true" data-offset-key="6182:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6183"><span data-slate-leaf="true" data-offset-key="6183:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 1. 参数解析</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6184"><span data-slate-object="text" data-key="6185"><span data-slate-leaf="true" data-offset-key="6185:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6186"><span data-slate-leaf="true" data-offset-key="6186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="6187"><span data-slate-leaf="true" data-offset-key="6187:0" data-first-offset="true"><span data-slate-string="true"> product Product</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6188"><span data-slate-object="text" data-key="6189"><span data-slate-leaf="true" data-offset-key="6189:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6190"><span data-slate-leaf="true" data-offset-key="6190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6191"><span data-slate-leaf="true" data-offset-key="6191:0" data-first-offset="true"><span data-slate-string="true"> err := c.ShouldBindJSON(&amp;product); err != </span></span></span><span data-slate-object="text" data-key="6192"><span data-slate-leaf="true" data-offset-key="6192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6193"><span data-slate-leaf="true" data-offset-key="6193:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6194"><span data-slate-object="text" data-key="6195"><span data-slate-leaf="true" data-offset-key="6195:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusBadRequest, gin.H{</span></span></span><span data-slate-object="text" data-key="6196"><span data-slate-leaf="true" data-offset-key="6196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"error"</span></span></span></span><span data-slate-object="text" data-key="6197"><span data-slate-leaf="true" data-offset-key="6197:0" data-first-offset="true"><span data-slate-string="true">: err.Error()})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6198"><span data-slate-object="text" data-key="6199"><span data-slate-leaf="true" data-offset-key="6199:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6200"><span data-slate-leaf="true" data-offset-key="6200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6201"><span data-slate-object="text" data-key="6202"><span data-slate-leaf="true" data-offset-key="6202:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6203"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6204"><span data-slate-object="text" data-key="6205"><span data-slate-leaf="true" data-offset-key="6205:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6206"><span data-slate-leaf="true" data-offset-key="6206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 2. 参数校验</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6207"><span data-slate-object="text" data-key="6208"><span data-slate-leaf="true" data-offset-key="6208:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6209"><span data-slate-leaf="true" data-offset-key="6209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6210"><span data-slate-leaf="true" data-offset-key="6210:0" data-first-offset="true"><span data-slate-string="true"> _, ok := u.products[product.Name]; ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6211"><span data-slate-object="text" data-key="6212"><span data-slate-leaf="true" data-offset-key="6212:0" data-first-offset="true"><span data-slate-string="true">    c.JSON(http.StatusBadRequest, gin.H{</span></span></span><span data-slate-object="text" data-key="6213"><span data-slate-leaf="true" data-offset-key="6213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"error"</span></span></span></span><span data-slate-object="text" data-key="6214"><span data-slate-leaf="true" data-offset-key="6214:0" data-first-offset="true"><span data-slate-string="true">: fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="6215"><span data-slate-leaf="true" data-offset-key="6215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"product %s already exist"</span></span></span></span><span data-slate-object="text" data-key="6216"><span data-slate-leaf="true" data-offset-key="6216:0" data-first-offset="true"><span data-slate-string="true">, product.Name)})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6217"><span data-slate-object="text" data-key="6218"><span data-slate-leaf="true" data-offset-key="6218:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6219"><span data-slate-leaf="true" data-offset-key="6219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6220"><span data-slate-object="text" data-key="6221"><span data-slate-leaf="true" data-offset-key="6221:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6222"><span data-slate-object="text" data-key="6223"><span data-slate-leaf="true" data-offset-key="6223:0" data-first-offset="true"><span data-slate-string="true">  product.CreatedAt = time.Now()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6224"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6225"><span data-slate-object="text" data-key="6226"><span data-slate-leaf="true" data-offset-key="6226:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6227"><span data-slate-leaf="true" data-offset-key="6227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 3. 逻辑处理</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6228"><span data-slate-object="text" data-key="6229"><span data-slate-leaf="true" data-offset-key="6229:0" data-first-offset="true"><span data-slate-string="true">  u.products[product.Name] = product</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6230"><span data-slate-object="text" data-key="6231"><span data-slate-leaf="true" data-offset-key="6231:0" data-first-offset="true"><span data-slate-string="true">  log.Printf(</span></span></span><span data-slate-object="text" data-key="6232"><span data-slate-leaf="true" data-offset-key="6232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Register product %s success"</span></span></span></span><span data-slate-object="text" data-key="6233"><span data-slate-leaf="true" data-offset-key="6233:0" data-first-offset="true"><span data-slate-string="true">, product.Name)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6234"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6235"><span data-slate-object="text" data-key="6236"><span data-slate-leaf="true" data-offset-key="6236:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6237"><span data-slate-leaf="true" data-offset-key="6237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 4. 返回结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6238"><span data-slate-object="text" data-key="6239"><span data-slate-leaf="true" data-offset-key="6239:0" data-first-offset="true"><span data-slate-string="true">  c.JSON(http.StatusOK, product)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6240"><span data-slate-object="text" data-key="6241"><span data-slate-leaf="true" data-offset-key="6241:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6242"><span data-slate-object="text" data-key="6243"><span data-slate-leaf="true" data-offset-key="6243:0" data-first-offset="true"><span data-slate-string="true">那这个时候，你可能会问：HTTP 的请求参数可以存在不同的位置，Gin 是如何解析的呢？这里，我们先来看下 HTTP 有哪些参数类型。</span></span><span data-slate-leaf="true" data-offset-key="6243:1"><span data-slate-object="annotation" data-annotation-key="gkann_62214718" data-attr-id="41396" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">HTTP 具有以下 5 种参数类型：</span></span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6244"><div data-slate-type="list-line" data-slate-object="block" data-key="6245"><span data-slate-object="text" data-key="6246"><span data-slate-leaf="true" data-offset-key="6246:0" data-first-offset="true"><span data-slate-string="true">路径参数（path）。例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6247"><span data-slate-object="text" data-key="6248"><span data-slate-leaf="true" data-offset-key="6248:0" data-first-offset="true"><span data-slate-string="true"> gin.Default().GET("/user/:name", nil)</span></span></span></span><span data-slate-object="text" data-key="6249"><span data-slate-leaf="true" data-offset-key="6249:0" data-first-offset="true"><span data-slate-string="true">， name 就是路径参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6250"><span data-slate-object="text" data-key="6251"><span data-slate-leaf="true" data-offset-key="6251:0" data-first-offset="true"><span data-slate-string="true">查询字符串参数（query）。例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6252"><span data-slate-object="text" data-key="6253"><span data-slate-leaf="true" data-offset-key="6253:0" data-first-offset="true"><span data-slate-string="true"> /welcome?firstname=Lingfei&amp;lastname=Kong</span></span></span></span><span data-slate-object="text" data-key="6254"><span data-slate-leaf="true" data-offset-key="6254:0" data-first-offset="true"><span data-slate-string="true">，firstname 和 lastname 就是查询字符串参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6255"><span data-slate-object="text" data-key="6256"><span data-slate-leaf="true" data-offset-key="6256:0" data-first-offset="true"><span data-slate-string="true">表单参数（form）。例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6257"><span data-slate-object="text" data-key="6258"><span data-slate-leaf="true" data-offset-key="6258:0" data-first-offset="true"><span data-slate-string="true"> curl -X POST -F 'username=colin' -F 'password=colin1234' http://mydomain.com/login</span></span></span></span><span data-slate-object="text" data-key="6259"><span data-slate-leaf="true" data-offset-key="6259:0" data-first-offset="true"><span data-slate-string="true">，username 和 password 就是表单参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6260"><span data-slate-object="text" data-key="6261"><span data-slate-leaf="true" data-offset-key="6261:0" data-first-offset="true"><span data-slate-string="true">HTTP 头参数（header）。例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6262"><span data-slate-object="text" data-key="6263"><span data-slate-leaf="true" data-offset-key="6263:0" data-first-offset="true"><span data-slate-string="true"> curl -X POST -H 'Content-Type: application/json' -d '{"username":"colin","password":"colin1234"}' http://mydomain.com/login</span></span></span></span><span data-slate-object="text" data-key="6264"><span data-slate-leaf="true" data-offset-key="6264:0" data-first-offset="true"><span data-slate-string="true">，Content-Type 就是 HTTP 头参数。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6265"><span data-slate-object="text" data-key="6266"><span data-slate-leaf="true" data-offset-key="6266:0" data-first-offset="true"><span data-slate-string="true">消息体参数（body）。例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="6267"><span data-slate-object="text" data-key="6268"><span data-slate-leaf="true" data-offset-key="6268:0" data-first-offset="true"><span data-slate-string="true"> curl -X POST -H 'Content-Type: application/json' -d '{"username":"colin","password":"colin1234"}' http://mydomain.com/login</span></span></span></span><span data-slate-object="text" data-key="6269"><span data-slate-leaf="true" data-offset-key="6269:0" data-first-offset="true"><span data-slate-string="true">，username 和 password 就是消息体参数。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6270"><span data-slate-object="text" data-key="6271"><span data-slate-leaf="true" data-offset-key="6271:0" data-first-offset="true"><span data-slate-string="true">Gin 提供了一些函数，来分别读取这些 HTTP 参数，每种类别会提供两种函数，一种函数可以直接读取某个参数的值，另外一种函数会把同类 HTTP 参数绑定到一个 Go 结构体中。比如，有如下路径参数：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="6272"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6273"><span data-slate-object="text" data-key="6274"><span data-slate-leaf="true" data-offset-key="6274:0" data-first-offset="true"><span data-slate-string="true">gin.Default().</span></span></span><span data-slate-object="text" data-key="6275"><span data-slate-leaf="true" data-offset-key="6275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GET</span></span></span></span><span data-slate-object="text" data-key="6276"><span data-slate-leaf="true" data-offset-key="6276:0" data-first-offset="true"><span data-slate-string="true">("/:name/:id", nil)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6277"><span data-slate-object="text" data-key="6278"><span data-slate-leaf="true" data-offset-key="6278:0" data-first-offset="true"><span data-slate-string="true">我们可以直接读取每个参数：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6279"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6280"><span data-slate-object="text" data-key="6281"><span data-slate-leaf="true" data-offset-key="6281:0" data-first-offset="true"><span data-slate-string="true">name := c.Param(</span></span></span><span data-slate-object="text" data-key="6282"><span data-slate-leaf="true" data-offset-key="6282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="6283"><span data-slate-leaf="true" data-offset-key="6283:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6284"><span data-slate-object="text" data-key="6285"><span data-slate-leaf="true" data-offset-key="6285:0" data-first-offset="true"><span data-slate-string="true">action := c.Param(</span></span></span><span data-slate-object="text" data-key="6286"><span data-slate-leaf="true" data-offset-key="6286:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"action"</span></span></span></span><span data-slate-object="text" data-key="6287"><span data-slate-leaf="true" data-offset-key="6287:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6288"><span data-slate-object="text" data-key="6289"><span data-slate-leaf="true" data-offset-key="6289:0" data-first-offset="true"><span data-slate-string="true">也可以将所有的路径参数，绑定到结构体中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6290"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6291"><span data-slate-object="text" data-key="6292"><span data-slate-leaf="true" data-offset-key="6292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="6293"><span data-slate-leaf="true" data-offset-key="6293:0" data-first-offset="true"><span data-slate-string="true"> Person </span></span></span><span data-slate-object="text" data-key="6294"><span data-slate-leaf="true" data-offset-key="6294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="6295"><span data-slate-leaf="true" data-offset-key="6295:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6296"><span data-slate-object="text" data-key="6297"><span data-slate-leaf="true" data-offset-key="6297:0" data-first-offset="true"><span data-slate-string="true">    ID </span></span></span><span data-slate-object="text" data-key="6298"><span data-slate-leaf="true" data-offset-key="6298:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6299"><span data-slate-leaf="true" data-offset-key="6299:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6300"><span data-slate-leaf="true" data-offset-key="6300:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`uri:"id" binding:"required,uuid"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6301"><span data-slate-object="text" data-key="6302"><span data-slate-leaf="true" data-offset-key="6302:0" data-first-offset="true"><span data-slate-string="true">    Name </span></span></span><span data-slate-object="text" data-key="6303"><span data-slate-leaf="true" data-offset-key="6303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6304"><span data-slate-leaf="true" data-offset-key="6304:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6305"><span data-slate-leaf="true" data-offset-key="6305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">`uri:"name" binding:"required"`</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6306"><span data-slate-object="text" data-key="6307"><span data-slate-leaf="true" data-offset-key="6307:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6308"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6309"><span data-slate-object="text" data-key="6310"><span data-slate-leaf="true" data-offset-key="6310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6311"><span data-slate-leaf="true" data-offset-key="6311:0" data-first-offset="true"><span data-slate-string="true"> err := c.ShouldBindUri(&amp;person); err != </span></span></span><span data-slate-object="text" data-key="6312"><span data-slate-leaf="true" data-offset-key="6312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6313"><span data-slate-leaf="true" data-offset-key="6313:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6314"><span data-slate-object="text" data-key="6315"><span data-slate-leaf="true" data-offset-key="6315:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6316"><span data-slate-leaf="true" data-offset-key="6316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// normal code</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6317"><span data-slate-object="text" data-key="6318"><span data-slate-leaf="true" data-offset-key="6318:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6319"><span data-slate-leaf="true" data-offset-key="6319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6320"><span data-slate-object="text" data-key="6321"><span data-slate-leaf="true" data-offset-key="6321:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6322"><span data-slate-object="text" data-key="6323"><span data-slate-leaf="true" data-offset-key="6323:0" data-first-offset="true"><span data-slate-string="true">Gin 在绑定参数时，是通过结构体的 tag 来判断要绑定哪类参数到结构体中的。这里要注意，不同的 HTTP 参数有不同的结构体 tag。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6324"><div data-slate-type="list-line" data-slate-object="block" data-key="6325"><span data-slate-object="text" data-key="6326"><span data-slate-leaf="true" data-offset-key="6326:0" data-first-offset="true"><span data-slate-string="true">路径参数：uri。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6327"><span data-slate-object="text" data-key="6328"><span data-slate-leaf="true" data-offset-key="6328:0" data-first-offset="true"><span data-slate-string="true">查询字符串参数：form。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6329"><span data-slate-object="text" data-key="6330"><span data-slate-leaf="true" data-offset-key="6330:0" data-first-offset="true"><span data-slate-string="true">表单参数：form。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6331"><span data-slate-object="text" data-key="6332"><span data-slate-leaf="true" data-offset-key="6332:0" data-first-offset="true"><span data-slate-string="true">HTTP 头参数：header。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6333"><span data-slate-object="text" data-key="6334"><span data-slate-leaf="true" data-offset-key="6334:0" data-first-offset="true"><span data-slate-string="true">消息体参数：会根据 Content-Type，自动选择使用 json 或者 xml，也可以调用 ShouldBindJSON 或者 ShouldBindXML 直接指定使用哪个 tag。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6335"><span data-slate-object="text" data-key="6336"><span data-slate-leaf="true" data-offset-key="6336:0" data-first-offset="true"><span data-slate-string="true">针对每种参数类型，Gin 都有对应的函数来获取和绑定这些参数。这些函数都是基于如下两个函数进行封装的：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6337"><div data-slate-type="list-line" data-slate-object="block" data-key="6338"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="6339"><span data-slate-leaf="true" data-offset-key="6339:0" data-first-offset="true"><span data-slate-string="true">ShouldBindWith(obj interface{}, b binding.Binding) error</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6340"><span data-slate-object="text" data-key="6341"><span data-slate-leaf="true" data-offset-key="6341:0" data-first-offset="true"><span data-slate-string="true">非常重要的一个函数，很多 ShouldBindXXX 函数底层都是调用 ShouldBindWith 函数来完成参数绑定的。该函数会根据传入的绑定引擎，将参数绑定到传入的结构体指针中，</span></span></span><span data-slate-object="text" data-key="6342"><span data-slate-leaf="true" data-offset-key="6342:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如果绑定失败，只返回错误内容，但不终止 HTTP 请求。</span></span></span></span><span data-slate-object="text" data-key="6343"><span data-slate-leaf="true" data-offset-key="6343:0" data-first-offset="true"><span data-slate-string="true">ShouldBindWith 支持多种绑定引擎，例如 binding.JSON、binding.Query、binding.Uri、binding.Header 等，更详细的信息你可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6344"><span data-slate-object="text" data-key="6345"><span data-slate-leaf="true" data-offset-key="6345:0" data-first-offset="true"><span data-slate-string="true">binding.go</span></span></span></a><span data-slate-object="text" data-key="6346"><span data-slate-leaf="true" data-offset-key="6346:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6347"><div data-slate-type="list-line" data-slate-object="block" data-key="6348"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="6349"><span data-slate-leaf="true" data-offset-key="6349:0" data-first-offset="true"><span data-slate-string="true">MustBindWith(obj interface{}, b binding.Binding) error</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6350"><span data-slate-object="text" data-key="6351"><span data-slate-leaf="true" data-offset-key="6351:0" data-first-offset="true"><span data-slate-string="true">这是另一个非常重要的函数，很多 BindXXX 函数底层都是调用 MustBindWith 函数来完成参数绑定的。该函数会根据传入的绑定引擎，将参数绑定到传入的结构体指针中，</span></span></span><span data-slate-object="text" data-key="6352"><span data-slate-leaf="true" data-offset-key="6352:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_3ab23c72" data-attr-id="30341" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如果绑定失败，返回错误并终止请求，返回 HTTP 400 错误。</span></span></span></span></span><span data-slate-object="text" data-key="6353"><span data-slate-leaf="true" data-offset-key="6353:0" data-first-offset="true"><span data-slate-string="true">MustBindWith 所支持的绑定引擎跟 ShouldBindWith 函数一样。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6354"><span data-slate-object="text" data-key="6355"><span data-slate-leaf="true" data-offset-key="6355:0" data-first-offset="true"><span data-slate-string="true">Gin 基于 ShouldBindWith 和 MustBindWith 这两个函数，又衍生出很多新的 Bind 函数。这些函数可以满足不同场景下获取 HTTP 参数的需求。Gin 提供的函数可以获取 5 个类别的 HTTP 参数。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6356"><div data-slate-type="list-line" data-slate-object="block" data-key="6357"><span data-slate-object="text" data-key="6358"><span data-slate-leaf="true" data-offset-key="6358:0" data-first-offset="true"><span data-slate-string="true">路径参数：ShouldBindUri、BindUri；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6359"><span data-slate-object="text" data-key="6360"><span data-slate-leaf="true" data-offset-key="6360:0" data-first-offset="true"><span data-slate-string="true">查询字符串参数：ShouldBindQuery、BindQuery；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6361"><span data-slate-object="text" data-key="6362"><span data-slate-leaf="true" data-offset-key="6362:0" data-first-offset="true"><span data-slate-string="true">表单参数：ShouldBind；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6363"><span data-slate-object="text" data-key="6364"><span data-slate-leaf="true" data-offset-key="6364:0" data-first-offset="true"><span data-slate-string="true">HTTP 头参数：ShouldBindHeader、BindHeader；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6365"><span data-slate-object="text" data-key="6366"><span data-slate-leaf="true" data-offset-key="6366:0" data-first-offset="true"><span data-slate-string="true">消息体参数：ShouldBindJSON、BindJSON 等。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6367"><span data-slate-object="text" data-key="6368"><span data-slate-leaf="true" data-offset-key="6368:0" data-first-offset="true"><span data-slate-string="true">每个类别的 Bind 函数，详细信息你可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6369"><span data-slate-object="text" data-key="6370"><span data-slate-leaf="true" data-offset-key="6370:0" data-first-offset="true"><span data-slate-string="true">Gin 提供的 Bind 函数</span></span></span></a><span data-slate-object="text" data-key="6371"><span data-slate-leaf="true" data-offset-key="6371:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6372"><span data-slate-object="text" data-key="6373"><span data-slate-leaf="true" data-offset-key="6373:0" data-first-offset="true"><span data-slate-string="true">这里要注意，Gin 并没有提供类似 ShouldBindForm、BindForm 这类函数来绑定表单参数，但我们可以通过 ShouldBind 来绑定表单参数。当 HTTP 方法为 GET 时，ShouldBind 只绑定 Query 类型的参数；当 HTTP 方法为 POST 时，会先检查 content-type 是否是 json 或者 xml，如果不是，则绑定 Form 类型的参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6374"><span data-slate-object="text" data-key="6375"><span data-slate-leaf="true" data-offset-key="6375:0" data-first-offset="true"><span data-slate-string="true">所以，ShouldBind 可以绑定 Form 类型的参数，但前提是 HTTP 方法是 POST，并且 content-type 不是 application/json、application/xml。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6376"><span data-slate-object="text" data-key="6377"><span data-slate-leaf="true" data-offset-key="6377:0" data-first-offset="true"><span data-slate-string="true">在 Go 项目开发中，我建议使用 ShouldBindXXX，这样可以确保我们设置的 HTTP Chain（Chain 可以理解为一个 HTTP 请求的一系列处理插件）能够继续被执行。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6378" id="sr-toc-10"><span data-slate-object="text" data-key="6379"><span data-slate-leaf="true" data-offset-key="6379:0" data-first-offset="true"><span data-slate-string="true">Gin 是如何支持 Web 服务高级功能的？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6380"><span data-slate-object="text" data-key="6381"><span data-slate-leaf="true" data-offset-key="6381:0" data-first-offset="true"><span data-slate-string="true">上面介绍了 Web 服务的基础功能，这里我再来介绍下高级功能。Web 服务可以具备多个高级功能，但比较核心的高级功能是中间件、认证、RequestID、跨域和优雅关停。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6382" id="sr-toc-11"><span data-slate-object="text" data-key="6383"><span data-slate-leaf="true" data-offset-key="6383:0" data-first-offset="true"><span data-slate-string="true">中间件</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6384"><span data-slate-object="text" data-key="6385"><span data-slate-leaf="true" data-offset-key="6385:0" data-first-offset="true"><span data-slate-string="true">Gin 支持中间件，HTTP 请求在转发到实际的处理函数之前，会被一系列加载的中间件进行处理。在中间件中，可以解析 HTTP 请求做一些逻辑处理，例如：跨域处理或者生成 X-Request-ID 并保存在 context 中，以便追踪某个请求。处理完之后，可以选择中断并返回这次请求，也可以选择将请求继续转交给下一个中间件处理。当所有的中间件都处理完之后，请求才会转给路由函数进行处理。具体流程如下图：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6386"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f0/80/f0783cb9ee8cffa969f846ebe8eae880.jpg?wh=2248x1655"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6387"><span data-slate-object="text" data-key="6388"><span data-slate-leaf="true" data-offset-key="6388:0" data-first-offset="true"><span data-slate-string="true">通过中间件，可以实现对所有请求都做统一的处理，提高开发效率，并使我们的代码更简洁。但是，因为所有的请求都需要经过中间件的处理，可能会增加请求延时。对于中间件特性，我有如下建议：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6389"><div data-slate-type="list-line" data-slate-object="block" data-key="6390"><span data-slate-object="text" data-key="6391"><span data-slate-leaf="true" data-offset-key="6391:0" data-first-offset="true"><span data-slate-string="true">中间件做成可加载的，通过配置文件指定程序启动时加载哪些中间件。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6392"><span data-slate-object="text" data-key="6393"><span data-slate-leaf="true" data-offset-key="6393:0" data-first-offset="true"><span data-slate-string="true">只将一些通用的、必要的功能做成中间件。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6394"><span data-slate-object="text" data-key="6395"><span data-slate-leaf="true" data-offset-key="6395:0" data-first-offset="true"><span data-slate-string="true">在编写中间件时，一定要保证中间件的代码质量和性能。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6396"><span data-slate-object="text" data-key="6397"><span data-slate-leaf="true" data-offset-key="6397:0" data-first-offset="true"><span data-slate-string="true">在 Gin 中，可以通过 gin.Engine 的 Use 方法来加载中间件。中间件可以加载到不同的位置上，而且不同的位置作用范围也不同，例如：</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="6398"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6399"><span data-slate-object="text" data-key="6400"><span data-slate-leaf="true" data-offset-key="6400:0" data-first-offset="true"><span data-slate-string="true">router := gin.</span></span></span><span data-slate-object="text" data-key="6401"><span data-slate-leaf="true" data-offset-key="6401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">New</span></span></span></span><span data-slate-object="text" data-key="6402"><span data-slate-leaf="true" data-offset-key="6402:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6403"><span data-slate-object="text" data-key="6404"><span data-slate-leaf="true" data-offset-key="6404:0" data-first-offset="true"><span data-slate-string="true">router.</span></span></span><span data-slate-object="text" data-key="6405"><span data-slate-leaf="true" data-offset-key="6405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Use</span></span></span></span><span data-slate-object="text" data-key="6406"><span data-slate-leaf="true" data-offset-key="6406:0" data-first-offset="true"><span data-slate-string="true">(gin.</span></span></span><span data-slate-object="text" data-key="6407"><span data-slate-leaf="true" data-offset-key="6407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Logger</span></span></span></span><span data-slate-object="text" data-key="6408"><span data-slate-leaf="true" data-offset-key="6408:0" data-first-offset="true"><span data-slate-string="true">(), gin.</span></span></span><span data-slate-object="text" data-key="6409"><span data-slate-leaf="true" data-offset-key="6409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Recovery</span></span></span></span><span data-slate-object="text" data-key="6410"><span data-slate-leaf="true" data-offset-key="6410:0" data-first-offset="true"><span data-slate-string="true">()) // 中间件作用于所有的 HTTP 请求</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6411"><span data-slate-object="text" data-key="6412"><span data-slate-leaf="true" data-offset-key="6412:0" data-first-offset="true"><span data-slate-string="true">v1 := router.</span></span></span><span data-slate-object="text" data-key="6413"><span data-slate-leaf="true" data-offset-key="6413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Group</span></span></span></span><span data-slate-object="text" data-key="6414"><span data-slate-leaf="true" data-offset-key="6414:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6415"><span data-slate-leaf="true" data-offset-key="6415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/v1"</span></span></span></span><span data-slate-object="text" data-key="6416"><span data-slate-leaf="true" data-offset-key="6416:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="6417"><span data-slate-leaf="true" data-offset-key="6417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Use</span></span></span></span><span data-slate-object="text" data-key="6418"><span data-slate-leaf="true" data-offset-key="6418:0" data-first-offset="true"><span data-slate-string="true">(gin.</span></span></span><span data-slate-object="text" data-key="6419"><span data-slate-leaf="true" data-offset-key="6419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BasicAuth</span></span></span></span><span data-slate-object="text" data-key="6420"><span data-slate-leaf="true" data-offset-key="6420:0" data-first-offset="true"><span data-slate-string="true">(gin.Accounts{"foo": </span></span></span><span data-slate-object="text" data-key="6421"><span data-slate-leaf="true" data-offset-key="6421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="6422"><span data-slate-leaf="true" data-offset-key="6422:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6423"><span data-slate-leaf="true" data-offset-key="6423:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="6424"><span data-slate-leaf="true" data-offset-key="6424:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6425"><span data-slate-leaf="true" data-offset-key="6425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="6426"><span data-slate-leaf="true" data-offset-key="6426:0" data-first-offset="true"><span data-slate-string="true">})) // 中间件作用于 v1 group</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6427"><span data-slate-object="text" data-key="6428"><span data-slate-leaf="true" data-offset-key="6428:0" data-first-offset="true"><span data-slate-string="true">v1</span></span></span><span data-slate-object="text" data-key="6429"><span data-slate-leaf="true" data-offset-key="6429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.POST</span></span></span></span><span data-slate-object="text" data-key="6430"><span data-slate-leaf="true" data-offset-key="6430:0" data-first-offset="true"><span data-slate-string="true">("/login", Login)</span></span></span><span data-slate-object="text" data-key="6431"><span data-slate-leaf="true" data-offset-key="6431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.Use</span></span></span></span><span data-slate-object="text" data-key="6432"><span data-slate-leaf="true" data-offset-key="6432:0" data-first-offset="true"><span data-slate-string="true">(gin</span></span></span><span data-slate-object="text" data-key="6433"><span data-slate-leaf="true" data-offset-key="6433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.BasicAuth</span></span></span></span><span data-slate-object="text" data-key="6434"><span data-slate-leaf="true" data-offset-key="6434:0" data-first-offset="true"><span data-slate-string="true">(gin</span></span></span><span data-slate-object="text" data-key="6435"><span data-slate-leaf="true" data-offset-key="6435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.Accounts</span></span></span></span><span data-slate-object="text" data-key="6436"><span data-slate-leaf="true" data-offset-key="6436:0" data-first-offset="true"><span data-slate-string="true">{"foo": </span></span></span><span data-slate-object="text" data-key="6437"><span data-slate-leaf="true" data-offset-key="6437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="6438"><span data-slate-leaf="true" data-offset-key="6438:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6439"><span data-slate-leaf="true" data-offset-key="6439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="6440"><span data-slate-leaf="true" data-offset-key="6440:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6441"><span data-slate-leaf="true" data-offset-key="6441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="6442"><span data-slate-leaf="true" data-offset-key="6442:0" data-first-offset="true"><span data-slate-string="true">})) // 中间件只作用于 /v1/login API 接口</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6443"><span data-slate-object="text" data-key="6444"><span data-slate-leaf="true" data-offset-key="6444:0" data-first-offset="true"><span data-slate-string="true">Gin 框架本身支持了一些中间件。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6445"><div data-slate-type="list-line" data-slate-object="block" data-key="6446"><span data-slate-object="text" data-key="6447"><span data-slate-leaf="true" data-offset-key="6447:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">gin.Logger()：</span></span></span></span><span data-slate-object="text" data-key="6448"><span data-slate-leaf="true" data-offset-key="6448:0" data-first-offset="true"><span data-slate-string="true">Logger 中间件会将日志写到 gin.DefaultWriter，gin.DefaultWriter 默认为 os.Stdout。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6449"><span data-slate-object="text" data-key="6450"><span data-slate-leaf="true" data-offset-key="6450:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">gin.Recovery()：</span></span></span></span><span data-slate-object="text" data-key="6451"><span data-slate-leaf="true" data-offset-key="6451:0" data-first-offset="true"><span data-slate-string="true">Recovery 中间件可以从任何 panic 恢复，并且写入一个 500 状态码。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6452"><span data-slate-object="text" data-key="6453"><span data-slate-leaf="true" data-offset-key="6453:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">gin.CustomRecovery(handle gin.RecoveryFunc)：</span></span></span></span><span data-slate-object="text" data-key="6454"><span data-slate-leaf="true" data-offset-key="6454:0" data-first-offset="true"><span data-slate-string="true">类似 Recovery 中间件，但是在恢复时还会调用传入的 handle 方法进行处理。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6455"><span data-slate-object="text" data-key="6456"><span data-slate-leaf="true" data-offset-key="6456:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">gin.BasicAuth()：</span></span></span></span><span data-slate-object="text" data-key="6457"><span data-slate-leaf="true" data-offset-key="6457:0" data-first-offset="true"><span data-slate-string="true">HTTP 请求基本认证（使用用户名和密码进行认证）。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6458"><span data-slate-object="text" data-key="6459"><span data-slate-leaf="true" data-offset-key="6459:0" data-first-offset="true"><span data-slate-string="true">另外，Gin 还支持自定义中间件。中间件其实是一个函数，函数类型为 gin.HandlerFunc，HandlerFunc 底层类型为 func (*Context)。如下是一个 Logger 中间件的实现：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6460"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6461"><span data-slate-object="text" data-key="6462"><span data-slate-leaf="true" data-offset-key="6462:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="6463"><span data-slate-leaf="true" data-offset-key="6463:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6464"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6465"><span data-slate-object="text" data-key="6466"><span data-slate-leaf="true" data-offset-key="6466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="6467"><span data-slate-leaf="true" data-offset-key="6467:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6468"><span data-slate-object="text" data-key="6469"><span data-slate-leaf="true" data-offset-key="6469:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6470"><span data-slate-leaf="true" data-offset-key="6470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6471"><span data-slate-object="text" data-key="6472"><span data-slate-leaf="true" data-offset-key="6472:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6473"><span data-slate-leaf="true" data-offset-key="6473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"time"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6474"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6475"><span data-slate-object="text" data-key="6476"><span data-slate-leaf="true" data-offset-key="6476:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6477"><span data-slate-leaf="true" data-offset-key="6477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/gin-gonic/gin"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6478"><span data-slate-object="text" data-key="6479"><span data-slate-leaf="true" data-offset-key="6479:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6480"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6481"><span data-slate-object="text" data-key="6482"><span data-slate-leaf="true" data-offset-key="6482:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6483"><span data-slate-leaf="true" data-offset-key="6483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6484"><span data-slate-leaf="true" data-offset-key="6484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Logger</span></span></span></span></span><span data-slate-object="text" data-key="6485"><span data-slate-leaf="true" data-offset-key="6485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6486"><span data-slate-leaf="true" data-offset-key="6486:0" data-first-offset="true"><span data-slate-string="true"> gin.HandlerFunc {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6487"><span data-slate-object="text" data-key="6488"><span data-slate-leaf="true" data-offset-key="6488:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6489"><span data-slate-leaf="true" data-offset-key="6489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6490"><span data-slate-leaf="true" data-offset-key="6490:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6491"><span data-slate-leaf="true" data-offset-key="6491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6492"><span data-slate-leaf="true" data-offset-key="6492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *gin.Context)</span></span></span></span></span><span data-slate-object="text" data-key="6493"><span data-slate-leaf="true" data-offset-key="6493:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6494"><span data-slate-object="text" data-key="6495"><span data-slate-leaf="true" data-offset-key="6495:0" data-first-offset="true"><span data-slate-string="true">    t := time.Now()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6496"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6497"><span data-slate-object="text" data-key="6498"><span data-slate-leaf="true" data-offset-key="6498:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6499"><span data-slate-leaf="true" data-offset-key="6499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置变量 example</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6500"><span data-slate-object="text" data-key="6501"><span data-slate-leaf="true" data-offset-key="6501:0" data-first-offset="true"><span data-slate-string="true">    c.Set(</span></span></span><span data-slate-object="text" data-key="6502"><span data-slate-leaf="true" data-offset-key="6502:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"example"</span></span></span></span><span data-slate-object="text" data-key="6503"><span data-slate-leaf="true" data-offset-key="6503:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6504"><span data-slate-leaf="true" data-offset-key="6504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"12345"</span></span></span></span><span data-slate-object="text" data-key="6505"><span data-slate-leaf="true" data-offset-key="6505:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6506"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6507"><span data-slate-object="text" data-key="6508"><span data-slate-leaf="true" data-offset-key="6508:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6509"><span data-slate-leaf="true" data-offset-key="6509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 请求之前</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6510"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6511"><span data-slate-object="text" data-key="6512"><span data-slate-leaf="true" data-offset-key="6512:0" data-first-offset="true"><span data-slate-string="true">    c.Next()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6513"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6514"><span data-slate-object="text" data-key="6515"><span data-slate-leaf="true" data-offset-key="6515:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6516"><span data-slate-leaf="true" data-offset-key="6516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 请求之后</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6517"><span data-slate-object="text" data-key="6518"><span data-slate-leaf="true" data-offset-key="6518:0" data-first-offset="true"><span data-slate-string="true">    latency := time.Since(t)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6519"><span data-slate-object="text" data-key="6520"><span data-slate-leaf="true" data-offset-key="6520:0" data-first-offset="true"><span data-slate-string="true">    log.Print(latency)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6521"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6522"><span data-slate-object="text" data-key="6523"><span data-slate-leaf="true" data-offset-key="6523:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6524"><span data-slate-leaf="true" data-offset-key="6524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 访问我们发送的状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6525"><span data-slate-object="text" data-key="6526"><span data-slate-leaf="true" data-offset-key="6526:0" data-first-offset="true"><span data-slate-string="true">    status := c.Writer.Status()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6527"><span data-slate-object="text" data-key="6528"><span data-slate-leaf="true" data-offset-key="6528:0" data-first-offset="true"><span data-slate-string="true">    log.Println(status)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6529"><span data-slate-object="text" data-key="6530"><span data-slate-leaf="true" data-offset-key="6530:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6531"><span data-slate-object="text" data-key="6532"><span data-slate-leaf="true" data-offset-key="6532:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6533"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6534"><span data-slate-object="text" data-key="6535"><span data-slate-leaf="true" data-offset-key="6535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6536"><span data-slate-leaf="true" data-offset-key="6536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6537"><span data-slate-leaf="true" data-offset-key="6537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="6538"><span data-slate-leaf="true" data-offset-key="6538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6539"><span data-slate-leaf="true" data-offset-key="6539:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6540"><span data-slate-object="text" data-key="6541"><span data-slate-leaf="true" data-offset-key="6541:0" data-first-offset="true"><span data-slate-string="true">  r := gin.New()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6542"><span data-slate-object="text" data-key="6543"><span data-slate-leaf="true" data-offset-key="6543:0" data-first-offset="true"><span data-slate-string="true">  r.Use(Logger())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6544"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6545"><span data-slate-object="text" data-key="6546"><span data-slate-leaf="true" data-offset-key="6546:0" data-first-offset="true"><span data-slate-string="true">  r.GET(</span></span></span><span data-slate-object="text" data-key="6547"><span data-slate-leaf="true" data-offset-key="6547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/test"</span></span></span></span><span data-slate-object="text" data-key="6548"><span data-slate-leaf="true" data-offset-key="6548:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6549"><span data-slate-leaf="true" data-offset-key="6549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6550"><span data-slate-leaf="true" data-offset-key="6550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *gin.Context)</span></span></span></span></span><span data-slate-object="text" data-key="6551"><span data-slate-leaf="true" data-offset-key="6551:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6552"><span data-slate-object="text" data-key="6553"><span data-slate-leaf="true" data-offset-key="6553:0" data-first-offset="true"><span data-slate-string="true">    example := c.MustGet(</span></span></span><span data-slate-object="text" data-key="6554"><span data-slate-leaf="true" data-offset-key="6554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"example"</span></span></span></span><span data-slate-object="text" data-key="6555"><span data-slate-leaf="true" data-offset-key="6555:0" data-first-offset="true"><span data-slate-string="true">).(</span></span></span><span data-slate-object="text" data-key="6556"><span data-slate-leaf="true" data-offset-key="6556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6557"><span data-slate-leaf="true" data-offset-key="6557:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6558"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6559"><span data-slate-object="text" data-key="6560"><span data-slate-leaf="true" data-offset-key="6560:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6561"><span data-slate-leaf="true" data-offset-key="6561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// it would print: "12345"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6562"><span data-slate-object="text" data-key="6563"><span data-slate-leaf="true" data-offset-key="6563:0" data-first-offset="true"><span data-slate-string="true">    log.Println(example)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6564"><span data-slate-object="text" data-key="6565"><span data-slate-leaf="true" data-offset-key="6565:0" data-first-offset="true"><span data-slate-string="true">  })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6566"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6567"><span data-slate-object="text" data-key="6568"><span data-slate-leaf="true" data-offset-key="6568:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6569"><span data-slate-leaf="true" data-offset-key="6569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Listen and serve on 0.0.0.0:8080</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6570"><span data-slate-object="text" data-key="6571"><span data-slate-leaf="true" data-offset-key="6571:0" data-first-offset="true"><span data-slate-string="true">  r.Run(</span></span></span><span data-slate-object="text" data-key="6572"><span data-slate-leaf="true" data-offset-key="6572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span><span data-slate-object="text" data-key="6573"><span data-slate-leaf="true" data-offset-key="6573:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6574"><span data-slate-object="text" data-key="6575"><span data-slate-leaf="true" data-offset-key="6575:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6576"><span data-slate-object="text" data-key="6577"><span data-slate-leaf="true" data-offset-key="6577:0" data-first-offset="true"><span data-slate-string="true">另外，还有很多开源的中间件可供我们选择，我把一些常用的总结在了表格里：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6578"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/67/10/67137697a09d9f37bd87a81bf322f510.jpg?wh=1832x1521"></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6579" id="sr-toc-12"><span data-slate-object="text" data-key="6580"><span data-slate-leaf="true" data-offset-key="6580:0" data-first-offset="true"><span data-slate-string="true">认证、RequestID、跨域</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6581"><span data-slate-object="text" data-key="6582"><span data-slate-leaf="true" data-offset-key="6582:0" data-first-offset="true"><span data-slate-string="true">认证、RequestID、跨域这三个高级功能，都可以通过 Gin 的中间件来实现，例如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6583"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6584"><span data-slate-object="text" data-key="6585"><span data-slate-leaf="true" data-offset-key="6585:0" data-first-offset="true"><span data-slate-string="true">router := gin.New()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6586"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6587"><span data-slate-object="text" data-key="6588"><span data-slate-leaf="true" data-offset-key="6588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 认证</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6589"><span data-slate-object="text" data-key="6590"><span data-slate-leaf="true" data-offset-key="6590:0" data-first-offset="true"><span data-slate-string="true">router.Use(gin.BasicAuth(gin.Accounts{</span></span></span><span data-slate-object="text" data-key="6591"><span data-slate-leaf="true" data-offset-key="6591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"foo"</span></span></span></span><span data-slate-object="text" data-key="6592"><span data-slate-leaf="true" data-offset-key="6592:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6593"><span data-slate-leaf="true" data-offset-key="6593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bar"</span></span></span></span><span data-slate-object="text" data-key="6594"><span data-slate-leaf="true" data-offset-key="6594:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6595"><span data-slate-leaf="true" data-offset-key="6595:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin"</span></span></span></span><span data-slate-object="text" data-key="6596"><span data-slate-leaf="true" data-offset-key="6596:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="6597"><span data-slate-leaf="true" data-offset-key="6597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"colin404"</span></span></span></span><span data-slate-object="text" data-key="6598"><span data-slate-leaf="true" data-offset-key="6598:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6599"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6600"><span data-slate-object="text" data-key="6601"><span data-slate-leaf="true" data-offset-key="6601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// RequestID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6602"><span data-slate-object="text" data-key="6603"><span data-slate-leaf="true" data-offset-key="6603:0" data-first-offset="true"><span data-slate-string="true">router.Use(requestid.New(requestid.Config{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6604"><span data-slate-object="text" data-key="6605"><span data-slate-leaf="true" data-offset-key="6605:0" data-first-offset="true"><span data-slate-string="true">    Generator: </span></span></span><span data-slate-object="text" data-key="6606"><span data-slate-leaf="true" data-offset-key="6606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6607"><span data-slate-leaf="true" data-offset-key="6607:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6608"><span data-slate-leaf="true" data-offset-key="6608:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6609"><span data-slate-leaf="true" data-offset-key="6609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6610"><span data-slate-leaf="true" data-offset-key="6610:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6611"><span data-slate-object="text" data-key="6612"><span data-slate-leaf="true" data-offset-key="6612:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6613"><span data-slate-leaf="true" data-offset-key="6613:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6614"><span data-slate-leaf="true" data-offset-key="6614:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6615"><span data-slate-leaf="true" data-offset-key="6615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"test"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6616"><span data-slate-object="text" data-key="6617"><span data-slate-leaf="true" data-offset-key="6617:0" data-first-offset="true"><span data-slate-string="true">    },</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6618"><span data-slate-object="text" data-key="6619"><span data-slate-leaf="true" data-offset-key="6619:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6620"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6621"><span data-slate-object="text" data-key="6622"><span data-slate-leaf="true" data-offset-key="6622:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 跨域</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6623"><span data-slate-object="text" data-key="6624"><span data-slate-leaf="true" data-offset-key="6624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// CORS for https://foo.com and https://github.com origins, allowing:</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6625"><span data-slate-object="text" data-key="6626"><span data-slate-leaf="true" data-offset-key="6626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// - PUT and PATCH methods</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6627"><span data-slate-object="text" data-key="6628"><span data-slate-leaf="true" data-offset-key="6628:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// - Origin header</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6629"><span data-slate-object="text" data-key="6630"><span data-slate-leaf="true" data-offset-key="6630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// - Credentials share</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6631"><span data-slate-object="text" data-key="6632"><span data-slate-leaf="true" data-offset-key="6632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// - Preflight requests cached for 12 hours</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6633"><span data-slate-object="text" data-key="6634"><span data-slate-leaf="true" data-offset-key="6634:0" data-first-offset="true"><span data-slate-string="true">router.Use(cors.New(cors.Config{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6635"><span data-slate-object="text" data-key="6636"><span data-slate-leaf="true" data-offset-key="6636:0" data-first-offset="true"><span data-slate-string="true">    AllowOrigins:     []</span></span></span><span data-slate-object="text" data-key="6637"><span data-slate-leaf="true" data-offset-key="6637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6638"><span data-slate-leaf="true" data-offset-key="6638:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="6639"><span data-slate-leaf="true" data-offset-key="6639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://foo.com"</span></span></span></span><span data-slate-object="text" data-key="6640"><span data-slate-leaf="true" data-offset-key="6640:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6641"><span data-slate-object="text" data-key="6642"><span data-slate-leaf="true" data-offset-key="6642:0" data-first-offset="true"><span data-slate-string="true">    AllowMethods:     []</span></span></span><span data-slate-object="text" data-key="6643"><span data-slate-leaf="true" data-offset-key="6643:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6644"><span data-slate-leaf="true" data-offset-key="6644:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="6645"><span data-slate-leaf="true" data-offset-key="6645:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"PUT"</span></span></span></span><span data-slate-object="text" data-key="6646"><span data-slate-leaf="true" data-offset-key="6646:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6647"><span data-slate-leaf="true" data-offset-key="6647:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"PATCH"</span></span></span></span><span data-slate-object="text" data-key="6648"><span data-slate-leaf="true" data-offset-key="6648:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6649"><span data-slate-object="text" data-key="6650"><span data-slate-leaf="true" data-offset-key="6650:0" data-first-offset="true"><span data-slate-string="true">    AllowHeaders:     []</span></span></span><span data-slate-object="text" data-key="6651"><span data-slate-leaf="true" data-offset-key="6651:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6652"><span data-slate-leaf="true" data-offset-key="6652:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="6653"><span data-slate-leaf="true" data-offset-key="6653:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Origin"</span></span></span></span><span data-slate-object="text" data-key="6654"><span data-slate-leaf="true" data-offset-key="6654:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6655"><span data-slate-object="text" data-key="6656"><span data-slate-leaf="true" data-offset-key="6656:0" data-first-offset="true"><span data-slate-string="true">    ExposeHeaders:    []</span></span></span><span data-slate-object="text" data-key="6657"><span data-slate-leaf="true" data-offset-key="6657:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6658"><span data-slate-leaf="true" data-offset-key="6658:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="6659"><span data-slate-leaf="true" data-offset-key="6659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Content-Length"</span></span></span></span><span data-slate-object="text" data-key="6660"><span data-slate-leaf="true" data-offset-key="6660:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6661"><span data-slate-object="text" data-key="6662"><span data-slate-leaf="true" data-offset-key="6662:0" data-first-offset="true"><span data-slate-string="true">    AllowCredentials: </span></span></span><span data-slate-object="text" data-key="6663"><span data-slate-leaf="true" data-offset-key="6663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="6664"><span data-slate-leaf="true" data-offset-key="6664:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6665"><span data-slate-object="text" data-key="6666"><span data-slate-leaf="true" data-offset-key="6666:0" data-first-offset="true"><span data-slate-string="true">    AllowOriginFunc: </span></span></span><span data-slate-object="text" data-key="6667"><span data-slate-leaf="true" data-offset-key="6667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6668"><span data-slate-leaf="true" data-offset-key="6668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(origin </span></span></span></span></span><span data-slate-object="text" data-key="6669"><span data-slate-leaf="true" data-offset-key="6669:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="6670"><span data-slate-leaf="true" data-offset-key="6670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="6671"><span data-slate-leaf="true" data-offset-key="6671:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6672"><span data-slate-leaf="true" data-offset-key="6672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="6673"><span data-slate-leaf="true" data-offset-key="6673:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6674"><span data-slate-object="text" data-key="6675"><span data-slate-leaf="true" data-offset-key="6675:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6676"><span data-slate-leaf="true" data-offset-key="6676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6677"><span data-slate-leaf="true" data-offset-key="6677:0" data-first-offset="true"><span data-slate-string="true"> origin == </span></span></span><span data-slate-object="text" data-key="6678"><span data-slate-leaf="true" data-offset-key="6678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://github.com"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6679"><span data-slate-object="text" data-key="6680"><span data-slate-leaf="true" data-offset-key="6680:0" data-first-offset="true"><span data-slate-string="true">    },</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6681"><span data-slate-object="text" data-key="6682"><span data-slate-leaf="true" data-offset-key="6682:0" data-first-offset="true"><span data-slate-string="true">    MaxAge: </span></span></span><span data-slate-object="text" data-key="6683"><span data-slate-leaf="true" data-offset-key="6683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">12</span></span></span></span><span data-slate-object="text" data-key="6684"><span data-slate-leaf="true" data-offset-key="6684:0" data-first-offset="true"><span data-slate-string="true"> * time.Hour,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6685"><span data-slate-object="text" data-key="6686"><span data-slate-leaf="true" data-offset-key="6686:0" data-first-offset="true"><span data-slate-string="true">}))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6687" id="sr-toc-13"><span data-slate-object="text" data-key="6688"><span data-slate-leaf="true" data-offset-key="6688:0" data-first-offset="true"><span data-slate-string="true">优雅关停</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6689"><span data-slate-object="text" data-key="6690"><span data-slate-leaf="true" data-offset-key="6690:0" data-first-offset="true"><span data-slate-string="true">Go 项目上线后，我们还需要不断迭代来丰富项目功能、修复 Bug 等，这也就意味着，我们要不断地重启 Go 服务。对于 HTTP 服务来说，如果访问量大，重启服务的时候可能还有很多连接没有断开，请求没有完成。如果这时候直接关闭服务，这些连接会直接断掉，请求异常终止，这就会对用户体验和产品口碑造成很大影响。因此，这种关闭方式不是一种优雅的关闭方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6691"><span data-slate-object="text" data-key="6692"><span data-slate-leaf="true" data-offset-key="6692:0" data-first-offset="true"><span data-slate-string="true">这时候，我们期望 HTTP 服务可以在处理完所有请求后，正常地关闭这些连接，也就是优雅地关闭服务。我们有两种方法来优雅关闭 HTTP 服务，分别是借助第三方的 Go 包和自己编码实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6693"><span data-slate-object="text" data-key="6694"><span data-slate-leaf="true" data-offset-key="6694:0" data-first-offset="true"><span data-slate-string="true">方法一：借助第三方的 Go 包</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6695"><span data-slate-object="text" data-key="6696"><span data-slate-leaf="true" data-offset-key="6696:0" data-first-offset="true"><span data-slate-string="true">如果使用第三方的 Go 包来实现优雅关闭，目前用得比较多的包是 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6697"><span data-slate-object="text" data-key="6698"><span data-slate-leaf="true" data-offset-key="6698:0" data-first-offset="true"><span data-slate-string="true">fvbock/endless</span></span></span></a><span data-slate-object="text" data-key="6699"><span data-slate-leaf="true" data-offset-key="6699:0" data-first-offset="true"><span data-slate-string="true">。我们可以使用 fvbock/endless 来替换掉 net/http 的 ListenAndServe 方法，例如：</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="6700"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6701"><span data-slate-object="text" data-key="6702"><span data-slate-leaf="true" data-offset-key="6702:0" data-first-offset="true"><span data-slate-string="true">router := gin.</span></span></span><span data-slate-object="text" data-key="6703"><span data-slate-leaf="true" data-offset-key="6703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Default</span></span></span></span><span data-slate-object="text" data-key="6704"><span data-slate-leaf="true" data-offset-key="6704:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6705"><span data-slate-object="text" data-key="6706"><span data-slate-leaf="true" data-offset-key="6706:0" data-first-offset="true"><span data-slate-string="true">router.</span></span></span><span data-slate-object="text" data-key="6707"><span data-slate-leaf="true" data-offset-key="6707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">GET</span></span></span></span><span data-slate-object="text" data-key="6708"><span data-slate-leaf="true" data-offset-key="6708:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6709"><span data-slate-leaf="true" data-offset-key="6709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/"</span></span></span></span><span data-slate-object="text" data-key="6710"><span data-slate-leaf="true" data-offset-key="6710:0" data-first-offset="true"><span data-slate-string="true">, handler)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6711"><span data-slate-object="text" data-key="6712"><span data-slate-leaf="true" data-offset-key="6712:0" data-first-offset="true"><span data-slate-string="true">// [...]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6713"><span data-slate-object="text" data-key="6714"><span data-slate-leaf="true" data-offset-key="6714:0" data-first-offset="true"><span data-slate-string="true">endless.</span></span></span><span data-slate-object="text" data-key="6715"><span data-slate-leaf="true" data-offset-key="6715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListenAndServe</span></span></span></span><span data-slate-object="text" data-key="6716"><span data-slate-leaf="true" data-offset-key="6716:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6717"><span data-slate-leaf="true" data-offset-key="6717:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":4242"</span></span></span></span><span data-slate-object="text" data-key="6718"><span data-slate-leaf="true" data-offset-key="6718:0" data-first-offset="true"><span data-slate-string="true">, router)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6719"><span data-slate-object="text" data-key="6720"><span data-slate-leaf="true" data-offset-key="6720:0" data-first-offset="true"><span data-slate-string="true">方法二：编码实现</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6721"><span data-slate-object="text" data-key="6722"><span data-slate-leaf="true" data-offset-key="6722:0" data-first-offset="true"><span data-slate-string="true">借助第三方包的好处是可以稍微减少一些编码工作量，但缺点是引入了一个新的依赖包，因此我更倾向于自己编码实现。Go 1.8 版本或者更新的版本，http.Server 内置的 Shutdown 方法，已经实现了优雅关闭。下面是一个示例：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6723"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6724"><span data-slate-object="text" data-key="6725"><span data-slate-leaf="true" data-offset-key="6725:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// +build go1.8</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6726"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6727"><span data-slate-object="text" data-key="6728"><span data-slate-leaf="true" data-offset-key="6728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="6729"><span data-slate-leaf="true" data-offset-key="6729:0" data-first-offset="true"><span data-slate-string="true"> main</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6730"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6731"><span data-slate-object="text" data-key="6732"><span data-slate-leaf="true" data-offset-key="6732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="6733"><span data-slate-leaf="true" data-offset-key="6733:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6734"><span data-slate-object="text" data-key="6735"><span data-slate-leaf="true" data-offset-key="6735:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6736"><span data-slate-leaf="true" data-offset-key="6736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"context"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6737"><span data-slate-object="text" data-key="6738"><span data-slate-leaf="true" data-offset-key="6738:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6739"><span data-slate-leaf="true" data-offset-key="6739:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6740"><span data-slate-object="text" data-key="6741"><span data-slate-leaf="true" data-offset-key="6741:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6742"><span data-slate-leaf="true" data-offset-key="6742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"net/http"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6743"><span data-slate-object="text" data-key="6744"><span data-slate-leaf="true" data-offset-key="6744:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6745"><span data-slate-leaf="true" data-offset-key="6745:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"os"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6746"><span data-slate-object="text" data-key="6747"><span data-slate-leaf="true" data-offset-key="6747:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6748"><span data-slate-leaf="true" data-offset-key="6748:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"os/signal"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6749"><span data-slate-object="text" data-key="6750"><span data-slate-leaf="true" data-offset-key="6750:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6751"><span data-slate-leaf="true" data-offset-key="6751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"syscall"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6752"><span data-slate-object="text" data-key="6753"><span data-slate-leaf="true" data-offset-key="6753:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6754"><span data-slate-leaf="true" data-offset-key="6754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"time"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6755"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6756"><span data-slate-object="text" data-key="6757"><span data-slate-leaf="true" data-offset-key="6757:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6758"><span data-slate-leaf="true" data-offset-key="6758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"github.com/gin-gonic/gin"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6759"><span data-slate-object="text" data-key="6760"><span data-slate-leaf="true" data-offset-key="6760:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6761"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6762"><span data-slate-object="text" data-key="6763"><span data-slate-leaf="true" data-offset-key="6763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6764"><span data-slate-leaf="true" data-offset-key="6764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6765"><span data-slate-leaf="true" data-offset-key="6765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="6766"><span data-slate-leaf="true" data-offset-key="6766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6767"><span data-slate-leaf="true" data-offset-key="6767:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6768"><span data-slate-object="text" data-key="6769"><span data-slate-leaf="true" data-offset-key="6769:0" data-first-offset="true"><span data-slate-string="true">  router := gin.Default()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6770"><span data-slate-object="text" data-key="6771"><span data-slate-leaf="true" data-offset-key="6771:0" data-first-offset="true"><span data-slate-string="true">  router.GET(</span></span></span><span data-slate-object="text" data-key="6772"><span data-slate-leaf="true" data-offset-key="6772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/"</span></span></span></span><span data-slate-object="text" data-key="6773"><span data-slate-leaf="true" data-offset-key="6773:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6774"><span data-slate-leaf="true" data-offset-key="6774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6775"><span data-slate-leaf="true" data-offset-key="6775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *gin.Context)</span></span></span></span></span><span data-slate-object="text" data-key="6776"><span data-slate-leaf="true" data-offset-key="6776:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6777"><span data-slate-object="text" data-key="6778"><span data-slate-leaf="true" data-offset-key="6778:0" data-first-offset="true"><span data-slate-string="true">    time.Sleep(</span></span></span><span data-slate-object="text" data-key="6779"><span data-slate-leaf="true" data-offset-key="6779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="6780"><span data-slate-leaf="true" data-offset-key="6780:0" data-first-offset="true"><span data-slate-string="true"> * time.Second)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6781"><span data-slate-object="text" data-key="6782"><span data-slate-leaf="true" data-offset-key="6782:0" data-first-offset="true"><span data-slate-string="true">    c.String(http.StatusOK, </span></span></span><span data-slate-object="text" data-key="6783"><span data-slate-leaf="true" data-offset-key="6783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Welcome Gin Server"</span></span></span></span><span data-slate-object="text" data-key="6784"><span data-slate-leaf="true" data-offset-key="6784:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6785"><span data-slate-object="text" data-key="6786"><span data-slate-leaf="true" data-offset-key="6786:0" data-first-offset="true"><span data-slate-string="true">  })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6787"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6788"><span data-slate-object="text" data-key="6789"><span data-slate-leaf="true" data-offset-key="6789:0" data-first-offset="true"><span data-slate-string="true">  srv := &amp;http.Server{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6790"><span data-slate-object="text" data-key="6791"><span data-slate-leaf="true" data-offset-key="6791:0" data-first-offset="true"><span data-slate-string="true">    Addr:    </span></span></span><span data-slate-object="text" data-key="6792"><span data-slate-leaf="true" data-offset-key="6792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span><span data-slate-object="text" data-key="6793"><span data-slate-leaf="true" data-offset-key="6793:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6794"><span data-slate-object="text" data-key="6795"><span data-slate-leaf="true" data-offset-key="6795:0" data-first-offset="true"><span data-slate-string="true">    Handler: router,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6796"><span data-slate-object="text" data-key="6797"><span data-slate-leaf="true" data-offset-key="6797:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6798"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6799"><span data-slate-object="text" data-key="6800"><span data-slate-leaf="true" data-offset-key="6800:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6801"><span data-slate-leaf="true" data-offset-key="6801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Initializing the server in a goroutine so that</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6802"><span data-slate-object="text" data-key="6803"><span data-slate-leaf="true" data-offset-key="6803:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6804"><span data-slate-leaf="true" data-offset-key="6804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// it won't block the graceful shutdown handling below</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6805"><span data-slate-object="text" data-key="6806"><span data-slate-leaf="true" data-offset-key="6806:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6807"><span data-slate-leaf="true" data-offset-key="6807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">go</span></span></span></span><span data-slate-object="text" data-key="6808"><span data-slate-leaf="true" data-offset-key="6808:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6809"><span data-slate-leaf="true" data-offset-key="6809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6810"><span data-slate-leaf="true" data-offset-key="6810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="6811"><span data-slate-leaf="true" data-offset-key="6811:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6812"><span data-slate-object="text" data-key="6813"><span data-slate-leaf="true" data-offset-key="6813:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6814"><span data-slate-leaf="true" data-offset-key="6814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6815"><span data-slate-leaf="true" data-offset-key="6815:0" data-first-offset="true"><span data-slate-string="true"> err := srv.ListenAndServe(); err != </span></span></span><span data-slate-object="text" data-key="6816"><span data-slate-leaf="true" data-offset-key="6816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6817"><span data-slate-leaf="true" data-offset-key="6817:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; err != http.ErrServerClosed {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6818"><span data-slate-object="text" data-key="6819"><span data-slate-leaf="true" data-offset-key="6819:0" data-first-offset="true"><span data-slate-string="true">      log.Fatalf(</span></span></span><span data-slate-object="text" data-key="6820"><span data-slate-leaf="true" data-offset-key="6820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"listen: %s\n"</span></span></span></span><span data-slate-object="text" data-key="6821"><span data-slate-leaf="true" data-offset-key="6821:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6822"><span data-slate-object="text" data-key="6823"><span data-slate-leaf="true" data-offset-key="6823:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6824"><span data-slate-object="text" data-key="6825"><span data-slate-leaf="true" data-offset-key="6825:0" data-first-offset="true"><span data-slate-string="true">  }()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6826"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6827"><span data-slate-object="text" data-key="6828"><span data-slate-leaf="true" data-offset-key="6828:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6829"><span data-slate-leaf="true" data-offset-key="6829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Wait for interrupt signal to gracefully shutdown the server with</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6830"><span data-slate-object="text" data-key="6831"><span data-slate-leaf="true" data-offset-key="6831:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6832"><span data-slate-leaf="true" data-offset-key="6832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// a timeout of 5 seconds.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6833"><span data-slate-object="text" data-key="6834"><span data-slate-leaf="true" data-offset-key="6834:0" data-first-offset="true"><span data-slate-string="true">  quit := </span></span></span><span data-slate-object="text" data-key="6835"><span data-slate-leaf="true" data-offset-key="6835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="6836"><span data-slate-leaf="true" data-offset-key="6836:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6837"><span data-slate-leaf="true" data-offset-key="6837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">chan</span></span></span></span><span data-slate-object="text" data-key="6838"><span data-slate-leaf="true" data-offset-key="6838:0" data-first-offset="true"><span data-slate-string="true"> os.Signal, </span></span></span><span data-slate-object="text" data-key="6839"><span data-slate-leaf="true" data-offset-key="6839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="6840"><span data-slate-leaf="true" data-offset-key="6840:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6841"><span data-slate-object="text" data-key="6842"><span data-slate-leaf="true" data-offset-key="6842:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6843"><span data-slate-leaf="true" data-offset-key="6843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// kill (no param) default send syscall.SIGTERM</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6844"><span data-slate-object="text" data-key="6845"><span data-slate-leaf="true" data-offset-key="6845:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6846"><span data-slate-leaf="true" data-offset-key="6846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// kill -2 is syscall.SIGINT</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6847"><span data-slate-object="text" data-key="6848"><span data-slate-leaf="true" data-offset-key="6848:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6849"><span data-slate-leaf="true" data-offset-key="6849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// kill -9 is syscall.SIGKILL but can't be catch, so don't need add it</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6850"><span data-slate-object="text" data-key="6851"><span data-slate-leaf="true" data-offset-key="6851:0" data-first-offset="true"><span data-slate-string="true">  signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6852"><span data-slate-object="text" data-key="6853"><span data-slate-leaf="true" data-offset-key="6853:0" data-first-offset="true"><span data-slate-string="true">  &lt;-quit</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6854"><span data-slate-object="text" data-key="6855"><span data-slate-leaf="true" data-offset-key="6855:0" data-first-offset="true"><span data-slate-string="true">  log.Println(</span></span></span><span data-slate-object="text" data-key="6856"><span data-slate-leaf="true" data-offset-key="6856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Shutting down server..."</span></span></span></span><span data-slate-object="text" data-key="6857"><span data-slate-leaf="true" data-offset-key="6857:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6858"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6859"><span data-slate-object="text" data-key="6860"><span data-slate-leaf="true" data-offset-key="6860:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6861"><span data-slate-leaf="true" data-offset-key="6861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// The context is used to inform the server it has 5 seconds to finish</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6862"><span data-slate-object="text" data-key="6863"><span data-slate-leaf="true" data-offset-key="6863:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6864"><span data-slate-leaf="true" data-offset-key="6864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// the request it is currently handling</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6865"><span data-slate-object="text" data-key="6866"><span data-slate-leaf="true" data-offset-key="6866:0" data-first-offset="true"><span data-slate-string="true">  ctx, cancel := context.WithTimeout(context.Background(), </span></span></span><span data-slate-object="text" data-key="6867"><span data-slate-leaf="true" data-offset-key="6867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="6868"><span data-slate-leaf="true" data-offset-key="6868:0" data-first-offset="true"><span data-slate-string="true">*time.Second)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6869"><span data-slate-object="text" data-key="6870"><span data-slate-leaf="true" data-offset-key="6870:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6871"><span data-slate-leaf="true" data-offset-key="6871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="6872"><span data-slate-leaf="true" data-offset-key="6872:0" data-first-offset="true"><span data-slate-string="true"> cancel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6873"><span data-slate-object="text" data-key="6874"><span data-slate-leaf="true" data-offset-key="6874:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6875"><span data-slate-leaf="true" data-offset-key="6875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6876"><span data-slate-leaf="true" data-offset-key="6876:0" data-first-offset="true"><span data-slate-string="true"> err := srv.Shutdown(ctx); err != </span></span></span><span data-slate-object="text" data-key="6877"><span data-slate-leaf="true" data-offset-key="6877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6878"><span data-slate-leaf="true" data-offset-key="6878:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6879"><span data-slate-object="text" data-key="6880"><span data-slate-leaf="true" data-offset-key="6880:0" data-first-offset="true"><span data-slate-string="true">    log.Fatal(</span></span></span><span data-slate-object="text" data-key="6881"><span data-slate-leaf="true" data-offset-key="6881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Server forced to shutdown:"</span></span></span></span><span data-slate-object="text" data-key="6882"><span data-slate-leaf="true" data-offset-key="6882:0" data-first-offset="true"><span data-slate-string="true">, err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6883"><span data-slate-object="text" data-key="6884"><span data-slate-leaf="true" data-offset-key="6884:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6885"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6886"><span data-slate-object="text" data-key="6887"><span data-slate-leaf="true" data-offset-key="6887:0" data-first-offset="true"><span data-slate-string="true">  log.Println(</span></span></span><span data-slate-object="text" data-key="6888"><span data-slate-leaf="true" data-offset-key="6888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Server exiting"</span></span></span></span><span data-slate-object="text" data-key="6889"><span data-slate-leaf="true" data-offset-key="6889:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6890"><span data-slate-object="text" data-key="6891"><span data-slate-leaf="true" data-offset-key="6891:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6892"><span data-slate-object="text" data-key="6893"><span data-slate-leaf="true" data-offset-key="6893:0" data-first-offset="true"><span data-slate-string="true">上面的示例中，需要把 srv.ListenAndServe 放在 goroutine 中执行，这样才不会阻塞到 srv.Shutdown 函数。因为我们把 srv.ListenAndServe 放在了 goroutine 中，所以需要一种可以让整个进程常驻的机制。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6894"><span data-slate-object="text" data-key="6895"><span data-slate-leaf="true" data-offset-key="6895:0" data-first-offset="true"><span data-slate-string="true">这里，</span></span><span data-slate-leaf="true" data-offset-key="6895:1"><span data-slate-object="annotation" data-annotation-key="gkann_542952ea" data-attr-id="28748" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们借助了有缓冲 channel，</span></span></span><span data-slate-leaf="true" data-offset-key="6895:2"><span data-slate-object="annotation" data-annotation-key="gkann_6f2d5553" data-attr-id="31265" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">并且调用 signal.Notify 函数将该 channel 绑定到 SIGINT、SIGTERM 信号上。这样，收到 SIGINT、SIGTERM 信号后，quilt 通道会被写入值，从而结束阻塞状态，程序继续运行，</span></span></span><span data-slate-leaf="true" data-offset-key="6895:3"><span data-slate-string="true">执行 srv.Shutdown (ctx)，优雅关停 HTTP 服务。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6896" id="sr-toc-14"><span data-slate-object="text" data-key="6897"><span data-slate-leaf="true" data-offset-key="6897:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6898"><span data-slate-object="text" data-key="6899"><span data-slate-leaf="true" data-offset-key="6899:0" data-first-offset="true"><span data-slate-string="true">今天我们主要学习了 Web 服务的核心功能，以及如何开发这些功能。在实际的项目开发中， 我们一般会使用基于 net/http 包进行封装的优秀开源 Web 框架。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6900"><span data-slate-object="text" data-key="6901"><span data-slate-leaf="true" data-offset-key="6901:0" data-first-offset="true"><span data-slate-string="true">当前比较火的 Go Web 框架有 Gin、Beego、Echo、Revel、Martini。你可以根据需要进行选择。我比较推荐 Gin，Gin 也是目前比较受欢迎的 Web 框架。Gin Web 框架支持 Web 服务的很多基础功能，例如 HTTP/HTTPS、JSON 格式的数据、路由分组和匹配、一进程多服务等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6902"><span data-slate-object="text" data-key="6903"><span data-slate-leaf="true" data-offset-key="6903:0" data-first-offset="true"><span data-slate-string="true">另外，Gin 还支持 Web 服务的一些高级功能，例如 中间件、认证、RequestID、跨域和优雅关停等。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6904" id="sr-toc-15"><span data-slate-object="text" data-key="6905"><span data-slate-leaf="true" data-offset-key="6905:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="6906"><div data-slate-type="list-line" data-slate-object="block" data-key="6907"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="6908"><span data-slate-leaf="true" data-offset-key="6908:0" data-first-offset="true"><span data-slate-string="true">使用 Gin 框架编写一个简单的 Web 服务，要求该 Web 服务可以解析参数、校验参数，并进行一些简单的业务逻辑处理，最终返回处理结果。欢迎在留言区分享你的成果，或者遇到的问题。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="6909"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="6910"><span data-slate-leaf="true" data-offset-key="6910:0" data-first-offset="true"><span data-slate-string="true">思考下，如何给 iam-apiserver 的 /healthz 接口添加一个限流中间件，用来限制请求 /healthz 的频率。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6911"><span data-slate-object="text" data-key="6912"><span data-slate-leaf="true" data-offset-key="6912:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>15</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-16">精选留言 (14)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erRavHNiaicxIIrTK5JjKyCNaSKN2MhnM2X0IuNpcoDoyn0OUOqYgdEb0brT9QgibAKyjBP3R3x0W3Jw/132"></div></div><div><div><div><span>huntersudo</span></div></div><div>Gin 的示例和代码看了很多，知道这样写，有时候就不知道为啥这样写，老师的文章不少地方给了解释，给力给力！！</div><div><div>2021-07-20</div><div><div><i></i><span></span></div><div><i></i><span>9</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 庖丁解牛</span></div></div><div>老师，没有理解编码实现优雅关闭服务的程序。这段程序和我们期望的：【期望 HTTP 服务可以在处理完所有请求后，正常地关闭这些连接，也就是优雅地关闭服务】有什么关系？</div><div><p>作者回复：有关系的，通过 &lt;-quit 阻塞程序继续执行，当收到关停信号时，会停止阻塞，执行后面的 srv.Shutdown 代码，srv.Shutdown 可以优雅关停 HTTP 服务。</p></div><div><div>2021-09-08</div><div><div><i></i><span>2</span></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM5suA7q5mM40ULTY5OlQpoerPRMQD8NcMbKxDHhNmjQNUCngkSJEzRvMVDibAHw2whGZxAFlibzribOA/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>jxlwqq</span></div></div><div>signal.Notify 需要使用 buffered channel 哦

```go
c := make (chan os.Signal, 1)
```

参考：https://blog.wu-boy.com/2021/03/why-use-buffered-channel-in-signal-notify/</div><div><p>作者回复：感谢反馈，已更新</p></div><div><div>2021-09-02</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/f5/ed/d23daf19.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Neroldy</span></div></div><div>Get handler 函数用 Rlock 会不会更合适？因为好像只有对 product 的读操作而没有写操作。</div><div><p>作者回复：是的，RLock 更好</p></div><div><div>2021-07-26</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/d7/f1/ce10759d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>wei 丶</span></div></div><div>老师想问下 server.key 这个用 cfssl 怎么生成呀？ 我往回翻了下只看到了 cfssl 生成的 .pem 证书文件 🙈</div><div><p>作者回复: cfssl gencert -initca ca-csr.json | cfssljson -bare ca

这个命令生成的 ca-key.pem 其实就是 server.key 了</p></div><div><div>2021-09-24</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/26/bb/e0/29dc8a06.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>LosinGrip</span></div></div><div>curl -XGET http://127.0.0.1:8080/v1/products/iphone12
获取如下 
Client sent an HTTP request to an HTTPS server.
什么原因</div><div><p>作者回复：确认下你代码中：insecureServer.Addr 是否是 8080。</p></div><div><div>2021-09-18</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Sch0ng</span></div></div><div>写 web 服务，就用 Gin 框架。
从需求出发，介绍 Gin 框架的核心功能，即成体系又便于理解。</div><div><div>2021-08-13</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/11/5d/db3c1401.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>tajizhijia</span></div></div><div>在 goroute 里 log.Fatal () 之后程序不就推出了么？</div><div><div>2022-08-26</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>扶幽</span></div></div><div>真像老母亲忙前忙后，把饭喂到嘴边吃。专栏很赞～</div><div><div>2022-06-15</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Bynow</span></div></div><div> c.JSON (http.StatusNotFound, gin.H {"error": fmt.Errorf ("can not found product % s", c.Param ("name"))}) 这行代码是错误的，应该是 Sprintf</div><div><div>2022-05-31</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/58/a5/6b5e1525.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>平常心</span></div></div><div>如何用 curl 来访问 https 的 服务呢？ ca.pem 放到本机的证书库里，运行了一下，还是跑不通 https 的服务呢。</div><div><p>作者回复：有报什么错吗</p></div><div><div>2021-12-19</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
1. web 服务的常见功能：路由匹配（精确匹配和模糊匹配）、路由分组、参数解析；参数校验；逻辑处理；返回结果。
2. 高级功能有：中间件、优雅关停。通过中间件技术，可以实现认证、RequestID、跨域等常见功能。
3. 除了路由匹配和路由分组等基础功能外，Gin 的功能还包括：针对不同位置的 HTTP 参数进行解析；有很多开源的中间件，可以复用。
4. 需要注意 Web 服务的优雅启动和停止。</div><div><div>2021-11-27</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>庖丁解牛</span></div></div><div>「表单参数 form」是否可以和「请求消息体参数 body」合并在一起，因为后者是包含前者的。其请求内容都是在请求体部分，而且格式有多种，比如 application/json、application/xml、text/plain，再比如就是 application/form。</div><div><p>作者回复：还是不能的哈。因为表单和 Body 本就是不同的参数</p></div><div><div>2021-10-16</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/b2/07/7711d239.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>ling.zeng</span></div></div><div>老师您可太赞了。</div><div><div>2021-07-25</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".a"><outline class="toc-level-h1" data-reactid=".a.0" style="width: 175px;"><active data-reactid=".a.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".a.0.1"><span data-reactid=".a.0.1.0"> 24 | Web 服务：Web 服务核心功能有哪些，如何实现？</span></a></outline><outline class="toc-level-h2" data-reactid=".a.1" style="width: 165px;"><active data-reactid=".a.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".a.1.1"><span data-reactid=".a.1.1.0">Web 服务的核心功能</span></a></outline><outline class="toc-level-h2" data-reactid=".a.2" style="width: 165px;"><active data-reactid=".a.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".a.2.1"><span data-reactid=".a.2.1.0">为什么选择 Gin 框架？</span></a></outline><outline class="toc-level-h2" data-reactid=".a.3" style="width: 165px;"><active data-reactid=".a.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".a.3.1"><span data-reactid=".a.3.1.0">Gin 是如何支持 Web 服务基础功能的？</span></a></outline><outline class="toc-level-h3" data-reactid=".a.4" style="width: 155px;"><active data-reactid=".a.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".a.4.1"><span data-reactid=".a.4.1.0">HTTP/HTTPS 支持</span></a></outline><outline class="toc-level-h3" data-reactid=".a.5" style="width: 155px;"><active data-reactid=".a.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".a.5.1"><span data-reactid=".a.5.1.0">JSON 数据格式支持</span></a></outline><outline class="toc-level-h3" data-reactid=".a.6" style="width: 155px;"><active data-reactid=".a.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".a.6.1"><span data-reactid=".a.6.1.0">路由匹配</span></a></outline><outline class="toc-level-h3" data-reactid=".a.7" style="width: 155px;"><active data-reactid=".a.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".a.7.1"><span data-reactid=".a.7.1.0">路由分组</span></a></outline><outline class="toc-level-h3" data-reactid=".a.8" style="width: 155px;"><active data-reactid=".a.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".a.8.1"><span data-reactid=".a.8.1.0">一进程多服务</span></a></outline><outline class="toc-level-h3" data-reactid=".a.9" style="width: 155px;"><active data-reactid=".a.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".a.9.1"><span data-reactid=".a.9.1.0">参数解析、参数校验、逻辑处理、返回结果</span></a></outline><outline class="toc-level-h2" data-reactid=".a.a" style="width: 165px;"><active data-reactid=".a.a.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".a.a.1"><span data-reactid=".a.a.1.0">Gin 是如何支持 Web 服务高级功能的？</span></a></outline><outline class="toc-level-h3" data-reactid=".a.b" style="width: 155px;"><active data-reactid=".a.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".a.b.1"><span data-reactid=".a.b.1.0">中间件</span></a></outline><outline class="toc-level-h3" data-reactid=".a.c" style="width: 155px;"><active data-reactid=".a.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".a.c.1"><span data-reactid=".a.c.1.0">认证、RequestID、跨域</span></a></outline><outline class="toc-level-h3" data-reactid=".a.d" style="width: 155px;"><active data-reactid=".a.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".a.d.1"><span data-reactid=".a.d.1.0">优雅关停</span></a></outline><outline class="toc-level-h2" data-reactid=".a.e" style="width: 165px;"><active data-reactid=".a.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".a.e.1"><span data-reactid=".a.e.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".a.f" style="width: 165px;"><active data-reactid=".a.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".a.f.1"><span data-reactid=".a.f.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".a.g" style="width: 165px;"><active data-reactid=".a.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".a.g.1"><span data-reactid=".a.g.1.0">精选留言 (14)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/397475" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>