
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 11 | 容器安全：如何使用 eBPF 增强容器安全？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>11 | 容器安全：如何使用 eBPF 增强容器安全？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">11 | 容器安全：如何使用 eBPF 增强容器安全？</h1><div><span>倪朋飞</span> <span> 2022-02-09</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/d0/02/d052e8a14551fd64703a4ba46ae33f02.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：山荣</span><span>大小：11.88M</span><span> 时长：13:00</span></div></div><audio title="11 | 容器安全：如何使用 eBPF 增强容器安全？" src="https://res001.geekbang.org/media/audio/f5/ea/f5ebe3154cea5dee99dc51fe1dddc5ea/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="7046" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="7047"><span data-slate-object="text" data-key="7048"><span data-slate-leaf="true" data-offset-key="7048:0" data-first-offset="true"><span data-slate-string="true">你好，我是倪朋飞。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7049"><span data-slate-object="text" data-key="7050"><span data-slate-leaf="true" data-offset-key="7050:0" data-first-offset="true"><span data-slate-string="true">上一讲，我以最常见的网络丢包为例，带你一起梳理了 eBPF 所提供的网络功能特性，并教你使用 bpftrace 开发了一个跟踪内核网络协议栈的 eBPF 程序。虽然 eBPF 起源于网络过滤，并且网络过滤也是 eBPF 应用最为广泛的一个领域，但其实 eBPF 的应用已经远远超出了这一范畴。故障诊断、网络优化、安全控制、性能监控等，都已是 eBPF 的主战场。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7051"><span data-slate-object="text" data-key="7052"><span data-slate-leaf="true" data-offset-key="7052:0" data-first-offset="true"><span data-slate-string="true">随着容器和云原生技术的普及，由于容器天生共享内核的特性，容器的安全和隔离就是所有容器平台头上的 “紧箍咒”。因此，如何快速定位容器安全问题，如何确保容器的隔离，以及如何预防容器安全漏洞等，是每个容器平台都需要解决的头号问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7053"><span data-slate-object="text" data-key="7054"><span data-slate-leaf="true" data-offset-key="7054:0" data-first-offset="true"><span data-slate-string="true">既然容器是共享内核的，这些安全问题的解决自然就可以从内核的角度进行考虑。除了容器自身所强依赖的命名空间、cgroups、Linux 权限控制 Capabilities 之外，可以动态跟踪和扩展内核的 eBPF 就成为了安全监控和安全控制的主要手段之一。 Sysdig、Aqua Security、Datadog 等业内知名的容器安全解决方案，都基于 eBPF 构建了丰富的安全特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7055"><span data-slate-object="text" data-key="7056"><span data-slate-leaf="true" data-offset-key="7056:0" data-first-offset="true"><span data-slate-string="true">那么，到底如何使用 eBPF 来监控容器的安全问题，又如何使用 eBPF 阻止容器中的恶意行为呢？今天，我就带你一起来看看如何借助 eBPF 来增强容器安全。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7057" id="sr-toc-1"><span data-slate-object="text" data-key="7058"><span data-slate-leaf="true" data-offset-key="7058:0" data-first-offset="true"><span data-slate-string="true">eBPF 都有哪些安全能力？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7059"><span data-slate-object="text" data-key="7060"><span data-slate-leaf="true" data-offset-key="7060:0" data-first-offset="true"><span data-slate-string="true">安全这个词通常包含了非常广泛的任务，包括安全问题的分析与诊断、安全事件的检测，以及安全策略的执行等。针对这些任务，eBPF 又提供了哪些安全能力呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7061"><span data-slate-object="text" data-key="7062"><span data-slate-leaf="true" data-offset-key="7062:0" data-first-offset="true"><span data-slate-string="true">首先，对于</span></span></span><span data-slate-object="text" data-key="7063"><span data-slate-leaf="true" data-offset-key="7063:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">安全问题的分析与诊断</span></span></span></span><span data-slate-object="text" data-key="7064"><span data-slate-leaf="true" data-offset-key="7064:0" data-first-offset="true"><span data-slate-string="true">，eBPF 无需修改并重新编译内核和应用就可以动态分析内核及应用的行为。这在很多需要保留安全问题现场的情况下非常有用。特别是在紧急安全事件的处理过程中，eBPF 可以实时探测进程或内核中的可疑行为，进而帮你更快地定位安全问题的根源。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7065"><span data-slate-object="text" data-key="7066"><span data-slate-leaf="true" data-offset-key="7066:0" data-first-offset="true"><span data-slate-string="true">比如，Aqua Security 开源的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7067"><span data-slate-object="text" data-key="7068"><span data-slate-leaf="true" data-offset-key="7068:0" data-first-offset="true"><span data-slate-string="true">Tracee</span></span></span></a><span data-slate-object="text" data-key="7069"><span data-slate-leaf="true" data-offset-key="7069:0" data-first-offset="true"><span data-slate-string="true"> 项目就利用 eBPF，动态跟踪系统和应用的可疑行为模式，再与不断丰富的特征检测库进行匹配，就可以分析出容器应用中的安全问题。下面是 Tracee 的工作原理示意图（图片来自 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7070"><span data-slate-object="text" data-key="7071"><span data-slate-leaf="true" data-offset-key="7071:0" data-first-offset="true"><span data-slate-string="true">Tracee 文档</span></span></span></a><span data-slate-object="text" data-key="7072"><span data-slate-leaf="true" data-offset-key="7072:0" data-first-offset="true"><span data-slate-string="true">）：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7073"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a9/6f/a97a6b3e5077c13fbcb346f217c0a96f.png?wh=1340x853"></div><div>Tracee 原理示意图</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7074"><span data-slate-object="text" data-key="7075"><span data-slate-leaf="true" data-offset-key="7075:0" data-first-offset="true"><span data-slate-string="true">其次，对于</span></span></span><span data-slate-object="text" data-key="7076"><span data-slate-leaf="true" data-offset-key="7076:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">安全事件的监测</span></span></span></span><span data-slate-object="text" data-key="7077"><span data-slate-leaf="true" data-offset-key="7077:0" data-first-offset="true"><span data-slate-string="true">，eBPF 的事件触发机制不仅可以用极低的开销，动态监测内核和应用程序中的各类安全事件，更可以避免其他基于采样或统计机制的安全检测系统中经常发生的安全事件漏检问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7078"><span data-slate-object="text" data-key="7079"><span data-slate-leaf="true" data-offset-key="7079:0" data-first-offset="true"><span data-slate-string="true">如下图（图片来自 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7080"><span data-slate-object="text" data-key="7081"><span data-slate-leaf="true" data-offset-key="7081:0" data-first-offset="true"><span data-slate-string="true">brendangregg.com</span></span></span></a><span data-slate-object="text" data-key="7082"><span data-slate-leaf="true" data-offset-key="7082:0" data-first-offset="true"><span data-slate-string="true">）所示，kprobe、uprobe、tracepoint、USDT 等各类探针已经非常全面地涵盖了从应用到内核中的各类安全问题相关的跟踪点：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7083"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/5e/6e/5e178ebbc7928a0cd2aff7243f24e96e.png?wh=1089x693"></div><div>eBPF 安全跟踪点</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7084"><span data-slate-object="text" data-key="7085"><span data-slate-leaf="true" data-offset-key="7085:0" data-first-offset="true"><span data-slate-string="true">比如，Sysdig 贡献给 CNCF 基金会的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7086"><span data-slate-object="text" data-key="7087"><span data-slate-leaf="true" data-offset-key="7087:0" data-first-offset="true"><span data-slate-string="true">Falco</span></span></span></a><span data-slate-object="text" data-key="7088"><span data-slate-leaf="true" data-offset-key="7088:0" data-first-offset="true"><span data-slate-string="true"> 项目，就利用 eBPF 在运行时监测内核和应用中是否发生了诸如特权提升、SHELL 命令执行、系统文件（比如 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7089"><span data-slate-object="text" data-key="7090"><span data-slate-leaf="true" data-offset-key="7090:0" data-first-offset="true"><span data-slate-string="true">/etc/passwd</span></span></span></span><span data-slate-object="text" data-key="7091"><span data-slate-leaf="true" data-offset-key="7091:0" data-first-offset="true"><span data-slate-string="true">）修改、SSH 登录等异常行为，再通过告警系统实时将这些安全事件及时推送给你。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7092"><span data-slate-object="text" data-key="7093"><span data-slate-leaf="true" data-offset-key="7093:0" data-first-offset="true"><span data-slate-string="true">最后，对于</span></span></span><span data-slate-object="text" data-key="7094"><span data-slate-leaf="true" data-offset-key="7094:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">安全策略的执行</span></span></span></span><span data-slate-object="text" data-key="7095"><span data-slate-leaf="true" data-offset-key="7095:0" data-first-offset="true"><span data-slate-string="true">，安全计算（seccomp）、Linux 安全模块（LSM）等 Linux 已有的安全机制，均可以通过 eBPF 来进行安全审计和决策执行，阻止系统和进程中的非法操作，甚至可以通过辅助函数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7096"><span data-slate-object="text" data-key="7097"><span data-slate-leaf="true" data-offset-key="7097:0" data-first-offset="true"><span data-slate-string="true">bpf_send_signal()</span></span></span></span><span data-slate-object="text" data-key="7098"><span data-slate-leaf="true" data-offset-key="7098:0" data-first-offset="true"><span data-slate-string="true"> 直接把有安全隐患的进程杀死。在网络安全方面，eBPF 不仅可以用来实时探测和跟踪网络请求，更可以在探测到网络攻击等危害行为时直接在网络协议栈之前丢弃数据包，从而实现极高的网络性能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7099"><span data-slate-object="text" data-key="7100"><span data-slate-leaf="true" data-offset-key="7100:0" data-first-offset="true"><span data-slate-string="true">如下图所示（图片来自 KubeArmor </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7101"><span data-slate-object="text" data-key="7102"><span data-slate-leaf="true" data-offset-key="7102:0" data-first-offset="true"><span data-slate-string="true">文档</span></span></span></a><span data-slate-object="text" data-key="7103"><span data-slate-leaf="true" data-offset-key="7103:0" data-first-offset="true"><span data-slate-string="true">），容器运行时安全系统 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7104"><span data-slate-object="text" data-key="7105"><span data-slate-leaf="true" data-offset-key="7105:0" data-first-offset="true"><span data-slate-string="true">KubeArmor</span></span></span></a><span data-slate-object="text" data-key="7106"><span data-slate-leaf="true" data-offset-key="7106:0" data-first-offset="true"><span data-slate-string="true"> 就利用 LSM 和 eBPF，限制容器中进程执行、文件访问、网络连接等各种违反安全策略的操作。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7107"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/49/6d/49bd8dbce937eff08bcc40c12559df6d.png?wh=932x518"></div><div>KubeArmor 工作原理</div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7108" id="sr-toc-2"><span data-slate-object="text" data-key="7109"><span data-slate-leaf="true" data-offset-key="7109:0" data-first-offset="true"><span data-slate-string="true">如何使用 eBPF 分析容器的安全问题？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7110"><span data-slate-object="text" data-key="7111"><span data-slate-leaf="true" data-offset-key="7111:0" data-first-offset="true"><span data-slate-string="true">既然容器还是共享内核的，运行在内核中的 eBPF 程序自然也能够跟踪和分析容器中的应用程序。但由于容器利用 Linux 的 namespace 机制进行了隔离，其跟踪和分析方法又跟直接运行在主机内的进程有些不同。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7112"><span data-slate-object="text" data-key="7113"><span data-slate-leaf="true" data-offset-key="7113:0" data-first-offset="true"><span data-slate-string="true">以跟踪恶意程序的执行为例，为了躲避安全监控，很多恶意程序并不是在容器一开始启动的时候就运行了恶意进程，而是先启动一个正常程序，之后再创建新的恶意进程。这种场景特别容易出现在容器安全漏洞被恶意软件侵入的场景。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7114"><span data-slate-object="text" data-key="7115"><span data-slate-leaf="true" data-offset-key="7115:0" data-first-offset="true"><span data-slate-string="true">那么，如何用 eBPF 来分析这类安全问题呢？我想，你可能已经想起来了，我们课程的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7116"><span data-slate-object="text" data-key="7117"><span data-slate-leaf="true" data-offset-key="7117:0" data-first-offset="true"><span data-slate-string="true">07 讲</span></span></span></a><span data-slate-object="text" data-key="7118"><span data-slate-leaf="true" data-offset-key="7118:0" data-first-offset="true"><span data-slate-string="true"> 其实已经实现了对新进程创建的跟踪程序，即跟踪系统调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7119"><span data-slate-object="text" data-key="7120"><span data-slate-leaf="true" data-offset-key="7120:0" data-first-offset="true"><span data-slate-string="true">execve</span></span></span></span><span data-slate-object="text" data-key="7121"><span data-slate-leaf="true" data-offset-key="7121:0" data-first-offset="true"><span data-slate-string="true">。比如，执行下面的 bpftrace 命令，就可以跟踪新创建的进程：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7122"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7123"><span data-slate-object="text" data-key="7124"><span data-slate-leaf="true" data-offset-key="7124:0" data-first-offset="true"><span data-slate-string="true">sudo bpftrace -e </span></span></span><span data-slate-object="text" data-key="7125"><span data-slate-leaf="true" data-offset-key="7125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'tracepoint:syscalls:sys_enter_execve {printf("%-6d %-8s", pid, comm); join(args-&gt;argv);}'</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7126"><span data-slate-object="text" data-key="7127"><span data-slate-leaf="true" data-offset-key="7127:0" data-first-offset="true"><span data-slate-string="true">打开一个新终端，执行一条 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7128"><span data-slate-object="text" data-key="7129"><span data-slate-leaf="true" data-offset-key="7129:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7130"><span data-slate-leaf="true" data-offset-key="7130:0" data-first-offset="true"><span data-slate-string="true"> 命令，然后你就会看到如下的输出：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="7131"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7132"><span data-slate-object="text" data-key="7133"><span data-slate-leaf="true" data-offset-key="7133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8964</span></span></span></span><span data-slate-object="text" data-key="7134"><span data-slate-leaf="true" data-offset-key="7134:0" data-first-offset="true"><span data-slate-string="true">   bash    ls </span></span></span><span data-slate-object="text" data-key="7135"><span data-slate-leaf="true" data-offset-key="7135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--color=auto</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7136"><span data-slate-object="text" data-key="7137"><span data-slate-leaf="true" data-offset-key="7137:0" data-first-offset="true"><span data-slate-string="true">接下来，参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7138"><span data-slate-object="text" data-key="7139"><span data-slate-leaf="true" data-offset-key="7139:0" data-first-offset="true"><span data-slate-string="true">Docker 官方文档</span></span></span></a><span data-slate-object="text" data-key="7140"><span data-slate-leaf="true" data-offset-key="7140:0" data-first-offset="true"><span data-slate-string="true">安装 Docker 之后，再执行下面的命令，启动一个 Ubuntu 容器：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7141"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7142"><span data-slate-object="text" data-key="7143"><span data-slate-leaf="true" data-offset-key="7143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># -it 表示进入容器终端，--rm 表示终端关闭后自动清理容器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7144"><span data-slate-object="text" data-key="7145"><span data-slate-leaf="true" data-offset-key="7145:0" data-first-offset="true"><span data-slate-string="true">docker run -it --</span></span></span><span data-slate-object="text" data-key="7146"><span data-slate-leaf="true" data-offset-key="7146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">rm</span></span></span></span><span data-slate-object="text" data-key="7147"><span data-slate-leaf="true" data-offset-key="7147:0" data-first-offset="true"><span data-slate-string="true"> --name bash --hostname bash ubuntu:impish</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7148"><span data-slate-object="text" data-key="7149"><span data-slate-leaf="true" data-offset-key="7149:0" data-first-offset="true"><span data-slate-string="true">在容器中执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7150"><span data-slate-object="text" data-key="7151"><span data-slate-leaf="true" data-offset-key="7151:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7152"><span data-slate-leaf="true" data-offset-key="7152:0" data-first-offset="true"><span data-slate-string="true"> 命令，忽略容器启动过程中的进程跟踪信息（Docker 在启动容器过程中也会执行大量的命令），你会看到跟刚才类似的输出：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="7153"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7154"><span data-slate-object="text" data-key="7155"><span data-slate-leaf="true" data-offset-key="7155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9018</span></span></span></span><span data-slate-object="text" data-key="7156"><span data-slate-leaf="true" data-offset-key="7156:0" data-first-offset="true"><span data-slate-string="true">   bash    ls </span></span></span><span data-slate-object="text" data-key="7157"><span data-slate-leaf="true" data-offset-key="7157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--color=auto</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7158"><span data-slate-object="text" data-key="7159"><span data-slate-leaf="true" data-offset-key="7159:0" data-first-offset="true"><span data-slate-string="true">这个输出跟刚才在主机中执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7160"><span data-slate-object="text" data-key="7161"><span data-slate-leaf="true" data-offset-key="7161:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7162"><span data-slate-leaf="true" data-offset-key="7162:0" data-first-offset="true"><span data-slate-string="true"> 后的结果是一样的，只根据这个输出，我们显然没法区分 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7163"><span data-slate-object="text" data-key="7164"><span data-slate-leaf="true" data-offset-key="7164:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7165"><span data-slate-leaf="true" data-offset-key="7165:0" data-first-offset="true"><span data-slate-string="true"> 是不是运行在容器中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7166"><span data-slate-object="text" data-key="7167"><span data-slate-leaf="true" data-offset-key="7167:0" data-first-offset="true"><span data-slate-string="true">实际上，虽然所有容器都是共享内核的，但不同的容器之间还是通过命名空间进行了隔离。你可以使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7168"><span data-slate-object="text" data-key="7169"><span data-slate-leaf="true" data-offset-key="7169:0" data-first-offset="true"><span data-slate-string="true">lsns</span></span></span></span><span data-slate-object="text" data-key="7170"><span data-slate-leaf="true" data-offset-key="7170:0" data-first-offset="true"><span data-slate-string="true"> 命令来查询容器或者主机的命名空间。比如，在刚才的容器终端中执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7171"><span data-slate-object="text" data-key="7172"><span data-slate-leaf="true" data-offset-key="7172:0" data-first-offset="true"><span data-slate-string="true">lsns</span></span></span></span><span data-slate-object="text" data-key="7173"><span data-slate-leaf="true" data-offset-key="7173:0" data-first-offset="true"><span data-slate-string="true"> 命令，就可以看到如下的输出：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="7174"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7175"><span data-slate-object="text" data-key="7176"><span data-slate-leaf="true" data-offset-key="7176:0" data-first-offset="true"><span data-slate-string="true">        NS TYPE   NPROCS PID </span></span></span><span data-slate-object="text" data-key="7177"><span data-slate-leaf="true" data-offset-key="7177:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">USER</span></span></span></span><span data-slate-object="text" data-key="7178"><span data-slate-leaf="true" data-offset-key="7178:0" data-first-offset="true"><span data-slate-string="true"> COMMAND</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7179"><span data-slate-object="text" data-key="7180"><span data-slate-leaf="true" data-offset-key="7180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026531834</span></span></span></span><span data-slate-object="text" data-key="7181"><span data-slate-leaf="true" data-offset-key="7181:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7182"><span data-slate-leaf="true" data-offset-key="7182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">time</span></span></span></span><span data-slate-object="text" data-key="7183"><span data-slate-leaf="true" data-offset-key="7183:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7184"><span data-slate-leaf="true" data-offset-key="7184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7185"><span data-slate-leaf="true" data-offset-key="7185:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7186"><span data-slate-leaf="true" data-offset-key="7186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7187"><span data-slate-leaf="true" data-offset-key="7187:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7188"><span data-slate-object="text" data-key="7189"><span data-slate-leaf="true" data-offset-key="7189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026531835</span></span></span></span><span data-slate-object="text" data-key="7190"><span data-slate-leaf="true" data-offset-key="7190:0" data-first-offset="true"><span data-slate-string="true"> cgroup      </span></span></span><span data-slate-object="text" data-key="7191"><span data-slate-leaf="true" data-offset-key="7191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7192"><span data-slate-leaf="true" data-offset-key="7192:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7193"><span data-slate-leaf="true" data-offset-key="7193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7194"><span data-slate-leaf="true" data-offset-key="7194:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7195"><span data-slate-object="text" data-key="7196"><span data-slate-leaf="true" data-offset-key="7196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026531837</span></span></span></span><span data-slate-object="text" data-key="7197"><span data-slate-leaf="true" data-offset-key="7197:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7198"><span data-slate-leaf="true" data-offset-key="7198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">user</span></span></span></span><span data-slate-object="text" data-key="7199"><span data-slate-leaf="true" data-offset-key="7199:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7200"><span data-slate-leaf="true" data-offset-key="7200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7201"><span data-slate-leaf="true" data-offset-key="7201:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7202"><span data-slate-leaf="true" data-offset-key="7202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7203"><span data-slate-leaf="true" data-offset-key="7203:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7204"><span data-slate-object="text" data-key="7205"><span data-slate-leaf="true" data-offset-key="7205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026532530</span></span></span></span><span data-slate-object="text" data-key="7206"><span data-slate-leaf="true" data-offset-key="7206:0" data-first-offset="true"><span data-slate-string="true"> mnt         </span></span></span><span data-slate-object="text" data-key="7207"><span data-slate-leaf="true" data-offset-key="7207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7208"><span data-slate-leaf="true" data-offset-key="7208:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7209"><span data-slate-leaf="true" data-offset-key="7209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7210"><span data-slate-leaf="true" data-offset-key="7210:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7211"><span data-slate-object="text" data-key="7212"><span data-slate-leaf="true" data-offset-key="7212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026532531</span></span></span></span><span data-slate-object="text" data-key="7213"><span data-slate-leaf="true" data-offset-key="7213:0" data-first-offset="true"><span data-slate-string="true"> uts         </span></span></span><span data-slate-object="text" data-key="7214"><span data-slate-leaf="true" data-offset-key="7214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7215"><span data-slate-leaf="true" data-offset-key="7215:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7216"><span data-slate-leaf="true" data-offset-key="7216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7217"><span data-slate-leaf="true" data-offset-key="7217:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7218"><span data-slate-object="text" data-key="7219"><span data-slate-leaf="true" data-offset-key="7219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026532532</span></span></span></span><span data-slate-object="text" data-key="7220"><span data-slate-leaf="true" data-offset-key="7220:0" data-first-offset="true"><span data-slate-string="true"> ipc         </span></span></span><span data-slate-object="text" data-key="7221"><span data-slate-leaf="true" data-offset-key="7221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7222"><span data-slate-leaf="true" data-offset-key="7222:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7223"><span data-slate-leaf="true" data-offset-key="7223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7224"><span data-slate-leaf="true" data-offset-key="7224:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7225"><span data-slate-object="text" data-key="7226"><span data-slate-leaf="true" data-offset-key="7226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026532533</span></span></span></span><span data-slate-object="text" data-key="7227"><span data-slate-leaf="true" data-offset-key="7227:0" data-first-offset="true"><span data-slate-string="true"> pid         </span></span></span><span data-slate-object="text" data-key="7228"><span data-slate-leaf="true" data-offset-key="7228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7229"><span data-slate-leaf="true" data-offset-key="7229:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7230"><span data-slate-leaf="true" data-offset-key="7230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7231"><span data-slate-leaf="true" data-offset-key="7231:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7232"><span data-slate-object="text" data-key="7233"><span data-slate-leaf="true" data-offset-key="7233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4026532535</span></span></span></span><span data-slate-object="text" data-key="7234"><span data-slate-leaf="true" data-offset-key="7234:0" data-first-offset="true"><span data-slate-string="true"> net         </span></span></span><span data-slate-object="text" data-key="7235"><span data-slate-leaf="true" data-offset-key="7235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7236"><span data-slate-leaf="true" data-offset-key="7236:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7237"><span data-slate-leaf="true" data-offset-key="7237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7238"><span data-slate-leaf="true" data-offset-key="7238:0" data-first-offset="true"><span data-slate-string="true"> root bash</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7239"><span data-slate-object="text" data-key="7240"><span data-slate-leaf="true" data-offset-key="7240:0" data-first-offset="true"><span data-slate-string="true">关于这些命名空间的含义，如果你还不了解，可以参考</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7241"><span data-slate-object="text" data-key="7242"><span data-slate-leaf="true" data-offset-key="7242:0" data-first-offset="true"><span data-slate-string="true">这里</span></span></span></a><span data-slate-object="text" data-key="7243"><span data-slate-leaf="true" data-offset-key="7243:0" data-first-offset="true"><span data-slate-string="true">的 Linux 手册。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7244"><span data-slate-object="text" data-key="7245"><span data-slate-leaf="true" data-offset-key="7245:0" data-first-offset="true"><span data-slate-string="true">在内核中，进程的基本信息都保存在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7246"><span data-slate-object="text" data-key="7247"><span data-slate-leaf="true" data-offset-key="7247:0" data-first-offset="true"><span data-slate-string="true">task_struct</span></span></span></a><span data-slate-object="text" data-key="7248"><span data-slate-leaf="true" data-offset-key="7248:0" data-first-offset="true"><span data-slate-string="true"> 结构体中，其中也包括了包含命名空间信息的  </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7249"><span data-slate-object="text" data-key="7250"><span data-slate-leaf="true" data-offset-key="7250:0" data-first-offset="true"><span data-slate-string="true">nsproxy</span></span></span></a><span data-slate-object="text" data-key="7251"><span data-slate-leaf="true" data-offset-key="7251:0" data-first-offset="true"><span data-slate-string="true"> 结构体。</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7252"><span data-slate-object="text" data-key="7253"><span data-slate-leaf="true" data-offset-key="7253:0" data-first-offset="true"><span data-slate-string="true">nsproxy</span></span></span></span><span data-slate-object="text" data-key="7254"><span data-slate-leaf="true" data-offset-key="7254:0" data-first-offset="true"><span data-slate-string="true"> 结构体的定义如下所示：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="7255"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7256"><span data-slate-object="text" data-key="7257"><span data-slate-leaf="true" data-offset-key="7257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7258"><span data-slate-leaf="true" data-offset-key="7258:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7259"><span data-slate-leaf="true" data-offset-key="7259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nsproxy</span></span></span></span><span data-slate-object="text" data-key="7260"><span data-slate-leaf="true" data-offset-key="7260:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7261"><span data-slate-object="text" data-key="7262"><span data-slate-leaf="true" data-offset-key="7262:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7263"><span data-slate-leaf="true" data-offset-key="7263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">atomic_t</span></span></span></span><span data-slate-object="text" data-key="7264"><span data-slate-leaf="true" data-offset-key="7264:0" data-first-offset="true"><span data-slate-string="true"> count;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7265"><span data-slate-object="text" data-key="7266"><span data-slate-leaf="true" data-offset-key="7266:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7267"><span data-slate-leaf="true" data-offset-key="7267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7268"><span data-slate-leaf="true" data-offset-key="7268:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7269"><span data-slate-leaf="true" data-offset-key="7269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uts_namespace</span></span></span></span><span data-slate-object="text" data-key="7270"><span data-slate-leaf="true" data-offset-key="7270:0" data-first-offset="true"><span data-slate-string="true"> *uts_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7271"><span data-slate-object="text" data-key="7272"><span data-slate-leaf="true" data-offset-key="7272:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7273"><span data-slate-leaf="true" data-offset-key="7273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7274"><span data-slate-leaf="true" data-offset-key="7274:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7275"><span data-slate-leaf="true" data-offset-key="7275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ipc_namespace</span></span></span></span><span data-slate-object="text" data-key="7276"><span data-slate-leaf="true" data-offset-key="7276:0" data-first-offset="true"><span data-slate-string="true"> *ipc_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7277"><span data-slate-object="text" data-key="7278"><span data-slate-leaf="true" data-offset-key="7278:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7279"><span data-slate-leaf="true" data-offset-key="7279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7280"><span data-slate-leaf="true" data-offset-key="7280:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7281"><span data-slate-leaf="true" data-offset-key="7281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mnt_namespace</span></span></span></span><span data-slate-object="text" data-key="7282"><span data-slate-leaf="true" data-offset-key="7282:0" data-first-offset="true"><span data-slate-string="true"> *mnt_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7283"><span data-slate-object="text" data-key="7284"><span data-slate-leaf="true" data-offset-key="7284:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7285"><span data-slate-leaf="true" data-offset-key="7285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7286"><span data-slate-leaf="true" data-offset-key="7286:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7287"><span data-slate-leaf="true" data-offset-key="7287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">pid_namespace</span></span></span></span><span data-slate-object="text" data-key="7288"><span data-slate-leaf="true" data-offset-key="7288:0" data-first-offset="true"><span data-slate-string="true"> *pid_ns_for_children;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7289"><span data-slate-object="text" data-key="7290"><span data-slate-leaf="true" data-offset-key="7290:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7291"><span data-slate-leaf="true" data-offset-key="7291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7292"><span data-slate-leaf="true" data-offset-key="7292:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7293"><span data-slate-leaf="true" data-offset-key="7293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">net</span></span></span></span><span data-slate-object="text" data-key="7294"><span data-slate-leaf="true" data-offset-key="7294:0" data-first-offset="true"><span data-slate-string="true">        *net_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7295"><span data-slate-object="text" data-key="7296"><span data-slate-leaf="true" data-offset-key="7296:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7297"><span data-slate-leaf="true" data-offset-key="7297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7298"><span data-slate-leaf="true" data-offset-key="7298:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7299"><span data-slate-leaf="true" data-offset-key="7299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">time_namespace</span></span></span></span><span data-slate-object="text" data-key="7300"><span data-slate-leaf="true" data-offset-key="7300:0" data-first-offset="true"><span data-slate-string="true"> *time_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7301"><span data-slate-object="text" data-key="7302"><span data-slate-leaf="true" data-offset-key="7302:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7303"><span data-slate-leaf="true" data-offset-key="7303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7304"><span data-slate-leaf="true" data-offset-key="7304:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7305"><span data-slate-leaf="true" data-offset-key="7305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">time_namespace</span></span></span></span><span data-slate-object="text" data-key="7306"><span data-slate-leaf="true" data-offset-key="7306:0" data-first-offset="true"><span data-slate-string="true"> *time_ns_for_children;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7307"><span data-slate-object="text" data-key="7308"><span data-slate-leaf="true" data-offset-key="7308:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7309"><span data-slate-leaf="true" data-offset-key="7309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7310"><span data-slate-leaf="true" data-offset-key="7310:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7311"><span data-slate-leaf="true" data-offset-key="7311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cgroup_namespace</span></span></span></span><span data-slate-object="text" data-key="7312"><span data-slate-leaf="true" data-offset-key="7312:0" data-first-offset="true"><span data-slate-string="true"> *cgroup_ns;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7313"><span data-slate-object="text" data-key="7314"><span data-slate-leaf="true" data-offset-key="7314:0" data-first-offset="true"><span data-slate-string="true">};</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7315"><span data-slate-object="text" data-key="7316"><span data-slate-leaf="true" data-offset-key="7316:0" data-first-offset="true"><span data-slate-string="true">为了区分一个进程是属于容器还是主机，我们可以在跟踪结果中输出 PID 命名空间和 UTS 命名空间中的主机名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7317"><span data-slate-object="text" data-key="7318"><span data-slate-leaf="true" data-offset-key="7318:0" data-first-offset="true"><span data-slate-string="true">bpftrace 内置了表示进程结构体的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7319"><span data-slate-object="text" data-key="7320"><span data-slate-leaf="true" data-offset-key="7320:0" data-first-offset="true"><span data-slate-string="true">curtask</span></span></span></a><span data-slate-object="text" data-key="7321"><span data-slate-leaf="true" data-offset-key="7321:0" data-first-offset="true"><span data-slate-string="true">，因而对前面的 bpftrace 脚本，我们可以进行下面的改进：</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="7322"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7323"><span data-slate-object="text" data-key="7324"><span data-slate-leaf="true" data-offset-key="7324:0" data-first-offset="true"><span data-slate-string="true">tracepoint:syscalls:sys_enter_execve {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7325"><span data-slate-object="text" data-key="7326"><span data-slate-leaf="true" data-offset-key="7326:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7327"><span data-slate-leaf="true" data-offset-key="7327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* 1. 获取 task_struct 结构体 */</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7328"><span data-slate-object="text" data-key="7329"><span data-slate-leaf="true" data-offset-key="7329:0" data-first-offset="true"><span data-slate-string="true">  $task = (</span></span></span><span data-slate-object="text" data-key="7330"><span data-slate-leaf="true" data-offset-key="7330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="7331"><span data-slate-leaf="true" data-offset-key="7331:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7332"><span data-slate-leaf="true" data-offset-key="7332:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">task_struct</span></span></span></span><span data-slate-object="text" data-key="7333"><span data-slate-leaf="true" data-offset-key="7333:0" data-first-offset="true"><span data-slate-string="true"> *)curtask;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7334"><span data-slate-object="text" data-key="7335"><span data-slate-leaf="true" data-offset-key="7335:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7336"><span data-slate-leaf="true" data-offset-key="7336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* 2. 获取 PID 命名空间 */</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7337"><span data-slate-object="text" data-key="7338"><span data-slate-leaf="true" data-offset-key="7338:0" data-first-offset="true"><span data-slate-string="true">  $pidns = $task</span></span></span><span data-slate-object="text" data-key="7339"><span data-slate-leaf="true" data-offset-key="7339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7340"><span data-slate-leaf="true" data-offset-key="7340:0" data-first-offset="true"><span data-slate-string="true">nsproxy</span></span></span><span data-slate-object="text" data-key="7341"><span data-slate-leaf="true" data-offset-key="7341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7342"><span data-slate-leaf="true" data-offset-key="7342:0" data-first-offset="true"><span data-slate-string="true">pid_ns_for_children</span></span></span><span data-slate-object="text" data-key="7343"><span data-slate-leaf="true" data-offset-key="7343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7344"><span data-slate-leaf="true" data-offset-key="7344:0" data-first-offset="true"><span data-slate-string="true">ns.inum;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7345"><span data-slate-object="text" data-key="7346"><span data-slate-leaf="true" data-offset-key="7346:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7347"><span data-slate-leaf="true" data-offset-key="7347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* 3. 获取主机名 */</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7348"><span data-slate-object="text" data-key="7349"><span data-slate-leaf="true" data-offset-key="7349:0" data-first-offset="true"><span data-slate-string="true">  $cname = $task</span></span></span><span data-slate-object="text" data-key="7350"><span data-slate-leaf="true" data-offset-key="7350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7351"><span data-slate-leaf="true" data-offset-key="7351:0" data-first-offset="true"><span data-slate-string="true">nsproxy</span></span></span><span data-slate-object="text" data-key="7352"><span data-slate-leaf="true" data-offset-key="7352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7353"><span data-slate-leaf="true" data-offset-key="7353:0" data-first-offset="true"><span data-slate-string="true">uts_ns</span></span></span><span data-slate-object="text" data-key="7354"><span data-slate-leaf="true" data-offset-key="7354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7355"><span data-slate-leaf="true" data-offset-key="7355:0" data-first-offset="true"><span data-slate-string="true">name.nodename;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7356"><span data-slate-object="text" data-key="7357"><span data-slate-leaf="true" data-offset-key="7357:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7358"><span data-slate-leaf="true" data-offset-key="7358:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/* 4. 输出 PID 命名空间、主机名和进程基本信息 */</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7359"><span data-slate-object="text" data-key="7360"><span data-slate-leaf="true" data-offset-key="7360:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7361"><span data-slate-leaf="true" data-offset-key="7361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">printf</span></span></span></span><span data-slate-object="text" data-key="7362"><span data-slate-leaf="true" data-offset-key="7362:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7363"><span data-slate-leaf="true" data-offset-key="7363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%-12ld %-8s %-6d %-6d %-8s"</span></span></span></span><span data-slate-object="text" data-key="7364"><span data-slate-leaf="true" data-offset-key="7364:0" data-first-offset="true"><span data-slate-string="true">, (uint64)$pidns, $cname, curtask</span></span></span><span data-slate-object="text" data-key="7365"><span data-slate-leaf="true" data-offset-key="7365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7366"><span data-slate-leaf="true" data-offset-key="7366:0" data-first-offset="true"><span data-slate-string="true">parent</span></span></span><span data-slate-object="text" data-key="7367"><span data-slate-leaf="true" data-offset-key="7367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7368"><span data-slate-leaf="true" data-offset-key="7368:0" data-first-offset="true"><span data-slate-string="true">pid, pid, comm); </span></span></span><span data-slate-object="text" data-key="7369"><span data-slate-leaf="true" data-offset-key="7369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">join</span></span></span></span><span data-slate-object="text" data-key="7370"><span data-slate-leaf="true" data-offset-key="7370:0" data-first-offset="true"><span data-slate-string="true">(args</span></span></span><span data-slate-object="text" data-key="7371"><span data-slate-leaf="true" data-offset-key="7371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="7372"><span data-slate-leaf="true" data-offset-key="7372:0" data-first-offset="true"><span data-slate-string="true">argv);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7373"><span data-slate-object="text" data-key="7374"><span data-slate-leaf="true" data-offset-key="7374:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7375"><span data-slate-object="text" data-key="7376"><span data-slate-leaf="true" data-offset-key="7376:0" data-first-offset="true"><span data-slate-string="true">这段代码中的具体内容含义如下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7377"><div data-slate-type="list-line" data-slate-object="block" data-key="7378"><span data-slate-object="text" data-key="7379"><span data-slate-leaf="true" data-offset-key="7379:0" data-first-offset="true"><span data-slate-string="true">第 1 处，把内置变量 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7380"><span data-slate-object="text" data-key="7381"><span data-slate-leaf="true" data-offset-key="7381:0" data-first-offset="true"><span data-slate-string="true">curtask</span></span></span></span><span data-slate-object="text" data-key="7382"><span data-slate-leaf="true" data-offset-key="7382:0" data-first-offset="true"><span data-slate-string="true"> 转换为我们想要的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7383"><span data-slate-object="text" data-key="7384"><span data-slate-leaf="true" data-offset-key="7384:0" data-first-offset="true"><span data-slate-string="true">task_struct</span></span></span></span><span data-slate-object="text" data-key="7385"><span data-slate-leaf="true" data-offset-key="7385:0" data-first-offset="true"><span data-slate-string="true"> 结构体；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7386"><span data-slate-object="text" data-key="7387"><span data-slate-leaf="true" data-offset-key="7387:0" data-first-offset="true"><span data-slate-string="true">第 2 处，从进程信息的 nsproxy 中读取 PID 命名空间编号；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7388"><span data-slate-object="text" data-key="7389"><span data-slate-leaf="true" data-offset-key="7389:0" data-first-offset="true"><span data-slate-string="true">第 3 处，从进程信息的 nsproxy 中读取 UTS 命名空间的主机名（也就是在容器中执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7390"><span data-slate-object="text" data-key="7391"><span data-slate-leaf="true" data-offset-key="7391:0" data-first-offset="true"><span data-slate-string="true">hostname</span></span></span></span><span data-slate-object="text" data-key="7392"><span data-slate-leaf="true" data-offset-key="7392:0" data-first-offset="true"><span data-slate-string="true"> 命令后的输出）；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7393"><span data-slate-object="text" data-key="7394"><span data-slate-leaf="true" data-offset-key="7394:0" data-first-offset="true"><span data-slate-string="true">第 4 处你已经非常熟悉了，就是把刚才获取的信息输出，以便我们观察。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7395"><span data-slate-object="text" data-key="7396"><span data-slate-leaf="true" data-offset-key="7396:0" data-first-offset="true"><span data-slate-string="true">由于这儿用到了很多内核数据结构，在运行之前，还需要给它引入相关数据结构定义的头文件：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="7397"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7398"><span data-slate-object="text" data-key="7399"><span data-slate-leaf="true" data-offset-key="7399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="7400"><span data-slate-leaf="true" data-offset-key="7400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="7401"><span data-slate-leaf="true" data-offset-key="7401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="7402"><span data-slate-leaf="true" data-offset-key="7402:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;linux/sched.h&gt;</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7403"><span data-slate-object="text" data-key="7404"><span data-slate-leaf="true" data-offset-key="7404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="7405"><span data-slate-leaf="true" data-offset-key="7405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="7406"><span data-slate-leaf="true" data-offset-key="7406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="7407"><span data-slate-leaf="true" data-offset-key="7407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;linux/nsproxy.h&gt;</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7408"><span data-slate-object="text" data-key="7409"><span data-slate-leaf="true" data-offset-key="7409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="7410"><span data-slate-leaf="true" data-offset-key="7410:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="7411"><span data-slate-leaf="true" data-offset-key="7411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="7412"><span data-slate-leaf="true" data-offset-key="7412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;linux/utsname.h&gt;</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7413"><span data-slate-object="text" data-key="7414"><span data-slate-leaf="true" data-offset-key="7414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="7415"><span data-slate-leaf="true" data-offset-key="7415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="7416"><span data-slate-leaf="true" data-offset-key="7416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="7417"><span data-slate-leaf="true" data-offset-key="7417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;linux/pid_namespace.h&gt;</span></span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7418"><span data-slate-object="text" data-key="7419"><span data-slate-leaf="true" data-offset-key="7419:0" data-first-offset="true"><span data-slate-string="true">同时，由于输出的内容比较多，为了便于理解，你还可以在脚本运行开始的时候输出一个表头，表示每个输出的含义：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="7420"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7421"><span data-slate-object="text" data-key="7422"><span data-slate-leaf="true" data-offset-key="7422:0" data-first-offset="true"><span data-slate-string="true">BEGIN {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7423"><span data-slate-object="text" data-key="7424"><span data-slate-leaf="true" data-offset-key="7424:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7425"><span data-slate-leaf="true" data-offset-key="7425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">printf</span></span></span></span><span data-slate-object="text" data-key="7426"><span data-slate-leaf="true" data-offset-key="7426:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7427"><span data-slate-leaf="true" data-offset-key="7427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%-12s %-8s %-6s %-6s %-8s %s\n"</span></span></span></span><span data-slate-object="text" data-key="7428"><span data-slate-leaf="true" data-offset-key="7428:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7429"><span data-slate-leaf="true" data-offset-key="7429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"PIDNS"</span></span></span></span><span data-slate-object="text" data-key="7430"><span data-slate-leaf="true" data-offset-key="7430:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7431"><span data-slate-leaf="true" data-offset-key="7431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"CONTAINER"</span></span></span></span><span data-slate-object="text" data-key="7432"><span data-slate-leaf="true" data-offset-key="7432:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7433"><span data-slate-leaf="true" data-offset-key="7433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"PPID"</span></span></span></span><span data-slate-object="text" data-key="7434"><span data-slate-leaf="true" data-offset-key="7434:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7435"><span data-slate-leaf="true" data-offset-key="7435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"PID"</span></span></span></span><span data-slate-object="text" data-key="7436"><span data-slate-leaf="true" data-offset-key="7436:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7437"><span data-slate-leaf="true" data-offset-key="7437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"COMM"</span></span></span></span><span data-slate-object="text" data-key="7438"><span data-slate-leaf="true" data-offset-key="7438:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7439"><span data-slate-leaf="true" data-offset-key="7439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"ARGS"</span></span></span></span><span data-slate-object="text" data-key="7440"><span data-slate-leaf="true" data-offset-key="7440:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7441"><span data-slate-object="text" data-key="7442"><span data-slate-leaf="true" data-offset-key="7442:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7443"><span data-slate-object="text" data-key="7444"><span data-slate-leaf="true" data-offset-key="7444:0" data-first-offset="true"><span data-slate-string="true">把头文件引入和改进后的 bpftrace 脚本保存到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7445"><span data-slate-object="text" data-key="7446"><span data-slate-leaf="true" data-offset-key="7446:0" data-first-offset="true"><span data-slate-string="true">execsnoop-container.bt</span></span></span></span><span data-slate-object="text" data-key="7447"><span data-slate-leaf="true" data-offset-key="7447:0" data-first-offset="true"><span data-slate-string="true"> 文件中（你也可以在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7448"><span data-slate-object="text" data-key="7449"><span data-slate-leaf="true" data-offset-key="7449:0" data-first-offset="true"><span data-slate-string="true">GitHub</span></span></span></a><span data-slate-object="text" data-key="7450"><span data-slate-leaf="true" data-offset-key="7450:0" data-first-offset="true"><span data-slate-string="true"> 上找到完整代码），然后打开一个新终端，运行下面的命令来执行：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7451"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7452"><span data-slate-object="text" data-key="7453"><span data-slate-leaf="true" data-offset-key="7453:0" data-first-offset="true"><span data-slate-string="true">sudo bpftrace execsnoop-container.bt</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7454"><span data-slate-object="text" data-key="7455"><span data-slate-leaf="true" data-offset-key="7455:0" data-first-offset="true"><span data-slate-string="true">接下来，分别在容器终端和主机终端中执行一个 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7456"><span data-slate-object="text" data-key="7457"><span data-slate-leaf="true" data-offset-key="7457:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7458"><span data-slate-leaf="true" data-offset-key="7458:0" data-first-offset="true"><span data-slate-string="true"> 命令，就可以得到如下的输出：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7459"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7460"><span data-slate-object="text" data-key="7461"><span data-slate-leaf="true" data-offset-key="7461:0" data-first-offset="true"><span data-slate-string="true">PIDNS        CONTAINER PPID   PID    COMM     ARGS</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7462"><span data-slate-object="text" data-key="7463"><span data-slate-leaf="true" data-offset-key="7463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 容器 ls 命令跟踪结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7464"><span data-slate-object="text" data-key="7465"><span data-slate-leaf="true" data-offset-key="7465:0" data-first-offset="true"><span data-slate-string="true">4026532533   bash     41046  41335  bash    </span></span></span><span data-slate-object="text" data-key="7466"><span data-slate-leaf="true" data-offset-key="7466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7467"><span data-slate-leaf="true" data-offset-key="7467:0" data-first-offset="true"><span data-slate-string="true"> --color=auto</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7468"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7469"><span data-slate-object="text" data-key="7470"><span data-slate-leaf="true" data-offset-key="7470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 主机 ls 命令跟踪结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7471"><span data-slate-object="text" data-key="7472"><span data-slate-leaf="true" data-offset-key="7472:0" data-first-offset="true"><span data-slate-string="true">4026531836   ubuntu.localdomain 40958  41356  bash    </span></span></span><span data-slate-object="text" data-key="7473"><span data-slate-leaf="true" data-offset-key="7473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7474"><span data-slate-leaf="true" data-offset-key="7474:0" data-first-offset="true"><span data-slate-string="true"> --color=auto</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7475"><span data-slate-object="text" data-key="7476"><span data-slate-leaf="true" data-offset-key="7476:0" data-first-offset="true"><span data-slate-string="true">在输出中，容器 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7477"><span data-slate-object="text" data-key="7478"><span data-slate-leaf="true" data-offset-key="7478:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7479"><span data-slate-leaf="true" data-offset-key="7479:0" data-first-offset="true"><span data-slate-string="true"> 命令跟踪结果中的 PID 命名空间 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7480"><span data-slate-object="text" data-key="7481"><span data-slate-leaf="true" data-offset-key="7481:0" data-first-offset="true"><span data-slate-string="true">4026532533</span></span></span></span><span data-slate-object="text" data-key="7482"><span data-slate-leaf="true" data-offset-key="7482:0" data-first-offset="true"><span data-slate-string="true"> 跟上述容器中 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7483"><span data-slate-object="text" data-key="7484"><span data-slate-leaf="true" data-offset-key="7484:0" data-first-offset="true"><span data-slate-string="true">lsns</span></span></span></span><span data-slate-object="text" data-key="7485"><span data-slate-leaf="true" data-offset-key="7485:0" data-first-offset="true"><span data-slate-string="true"> 结果是一致的，而主机名 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7486"><span data-slate-object="text" data-key="7487"><span data-slate-leaf="true" data-offset-key="7487:0" data-first-offset="true"><span data-slate-string="true">bash</span></span></span></span><span data-slate-object="text" data-key="7488"><span data-slate-leaf="true" data-offset-key="7488:0" data-first-offset="true"><span data-slate-string="true"> 也跟运行容器时设置的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7489"><span data-slate-object="text" data-key="7490"><span data-slate-leaf="true" data-offset-key="7490:0" data-first-offset="true"><span data-slate-string="true">--hostname name</span></span></span></span><span data-slate-object="text" data-key="7491"><span data-slate-leaf="true" data-offset-key="7491:0" data-first-offset="true"><span data-slate-string="true"> 一致，因而我们很容易区分这条 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7492"><span data-slate-object="text" data-key="7493"><span data-slate-leaf="true" data-offset-key="7493:0" data-first-offset="true"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7494"><span data-slate-leaf="true" data-offset-key="7494:0" data-first-offset="true"><span data-slate-string="true"> 命令的来源。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7495"><span data-slate-object="text" data-key="7496"><span data-slate-leaf="true" data-offset-key="7496:0" data-first-offset="true"><span data-slate-string="true">你可以发现，</span></span></span><span data-slate-object="text" data-key="7497"><span data-slate-leaf="true" data-offset-key="7497:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">只要理解了容器的基本原理，在跟踪过程中加入容器的基本信息，容器内外进程的跟踪和分析并没有本质的区别</span></span></span></span><span data-slate-object="text" data-key="7498"><span data-slate-leaf="true" data-offset-key="7498:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7499"><span data-slate-object="text" data-key="7500"><span data-slate-leaf="true" data-offset-key="7500:0" data-first-offset="true"><span data-slate-string="true">也许看到这里你会有疑问：这儿讲到的是内核态的跟踪，容器内外没有区别很正常。但如果是用户态的进程跟踪呢？你可以先思考一下，再继续下面的内容。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7501"><span data-slate-object="text" data-key="7502"><span data-slate-leaf="true" data-offset-key="7502:0" data-first-offset="true"><span data-slate-string="true">实际上，用户态进程的跟踪也是一样的，唯一需要注意的就是找到容器内二进制文件的正确路径。虽然容器文件系统在不同的 mount 命令空间中，但对于每个进程来说，Linux 都在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7503"><span data-slate-object="text" data-key="7504"><span data-slate-leaf="true" data-offset-key="7504:0" data-first-offset="true"><span data-slate-string="true">/proc/[pid]/root</span></span></span></span><span data-slate-object="text" data-key="7505"><span data-slate-leaf="true" data-offset-key="7505:0" data-first-offset="true"><span data-slate-string="true"> 处创建了一个链接（详细信息请参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7506"><span data-slate-object="text" data-key="7507"><span data-slate-leaf="true" data-offset-key="7507:0" data-first-offset="true"><span data-slate-string="true">proc 文件系统手册</span></span></span></a><span data-slate-object="text" data-key="7508"><span data-slate-leaf="true" data-offset-key="7508:0" data-first-offset="true"><span data-slate-string="true">）。因而，容器内的文件就可以通过 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7509"><span data-slate-object="text" data-key="7510"><span data-slate-leaf="true" data-offset-key="7510:0" data-first-offset="true"><span data-slate-string="true">/proc/[pid]/root</span></span></span></span><span data-slate-object="text" data-key="7511"><span data-slate-leaf="true" data-offset-key="7511:0" data-first-offset="true"><span data-slate-string="true"> 在主机中访问。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7512"><span data-slate-object="text" data-key="7513"><span data-slate-leaf="true" data-offset-key="7513:0" data-first-offset="true"><span data-slate-string="true">你可以执行下面的命令，查询容器的 PID，进而再查询 bash 的 uprobe 列表：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7514"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7515"><span data-slate-object="text" data-key="7516"><span data-slate-leaf="true" data-offset-key="7516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 查询容器进程在主机命名空间中的 PID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7517"><span data-slate-object="text" data-key="7518"><span data-slate-leaf="true" data-offset-key="7518:0" data-first-offset="true"><span data-slate-string="true">PID=$(docker inspect -f </span></span></span><span data-slate-object="text" data-key="7519"><span data-slate-leaf="true" data-offset-key="7519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'{{.State.Pid}}'</span></span></span></span><span data-slate-object="text" data-key="7520"><span data-slate-leaf="true" data-offset-key="7520:0" data-first-offset="true"><span data-slate-string="true"> bash)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7521"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7522"><span data-slate-object="text" data-key="7523"><span data-slate-leaf="true" data-offset-key="7523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 查询 uprobe</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7524"><span data-slate-object="text" data-key="7525"><span data-slate-leaf="true" data-offset-key="7525:0" data-first-offset="true"><span data-slate-string="true">sudo bpftrace -l </span></span></span><span data-slate-object="text" data-key="7526"><span data-slate-leaf="true" data-offset-key="7526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"uprobe:/proc/</span></span></span></span><span data-slate-object="text" data-key="7527"><span data-slate-leaf="true" data-offset-key="7527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$PID</span></span></span></span></span><span data-slate-object="text" data-key="7528"><span data-slate-leaf="true" data-offset-key="7528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/root/usr/bin/bash:*"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7529"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7530"><span data-slate-object="text" data-key="7531"><span data-slate-leaf="true" data-offset-key="7531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 跟踪 bash:readline 的结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7532"><span data-slate-object="text" data-key="7533"><span data-slate-leaf="true" data-offset-key="7533:0" data-first-offset="true"><span data-slate-string="true">sudo bpftrace -e </span></span></span><span data-slate-object="text" data-key="7534"><span data-slate-leaf="true" data-offset-key="7534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"uretprobe:/proc/</span></span></span></span><span data-slate-object="text" data-key="7535"><span data-slate-leaf="true" data-offset-key="7535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$PID</span></span></span></span></span><span data-slate-object="text" data-key="7536"><span data-slate-leaf="true" data-offset-key="7536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/root/usr/bin/bash:readline {printf(\"User %d executed %s in container\n\", uid, str(retval)); }"</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7537" id="sr-toc-3"><span data-slate-object="text" data-key="7538"><span data-slate-leaf="true" data-offset-key="7538:0" data-first-offset="true"><span data-slate-string="true">如何使用 eBPF 阻止容器的异常行为？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7539"><span data-slate-object="text" data-key="7540"><span data-slate-leaf="true" data-offset-key="7540:0" data-first-offset="true"><span data-slate-string="true">了解了如何分析容器中的安全问题之后，我们再来看看如何阻止容器中的异常行为。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7541"><span data-slate-object="text" data-key="7542"><span data-slate-leaf="true" data-offset-key="7542:0" data-first-offset="true"><span data-slate-string="true">在 eBPF 之前，其实已经有很多的机制来阻止容器的异常行为，比如 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7543"><span data-slate-object="text" data-key="7544"><span data-slate-leaf="true" data-offset-key="7544:0" data-first-offset="true"><span data-slate-string="true">AppArmor</span></span></span></a><span data-slate-object="text" data-key="7545"><span data-slate-leaf="true" data-offset-key="7545:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7546"><span data-slate-object="text" data-key="7547"><span data-slate-leaf="true" data-offset-key="7547:0" data-first-offset="true"><span data-slate-string="true">Seccomp</span></span></span></a><span data-slate-object="text" data-key="7548"><span data-slate-leaf="true" data-offset-key="7548:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7549"><span data-slate-object="text" data-key="7550"><span data-slate-leaf="true" data-offset-key="7550:0" data-first-offset="true"><span data-slate-string="true">Capabilities</span></span></span></a><span data-slate-object="text" data-key="7551"><span data-slate-leaf="true" data-offset-key="7551:0" data-first-offset="true"><span data-slate-string="true"> 等。这些机制虽然好用，但它们的缺点也很明显，那就是它们都需要预先配置好相关的安全策略。在检测到安全隐患之后，更新策略到策略生效中间总有一定的延迟。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7552"><span data-slate-object="text" data-key="7553"><span data-slate-leaf="true" data-offset-key="7553:0" data-first-offset="true"><span data-slate-string="true">而 eBPF 则可以在检测到安全隐患时，实时去触发安全策略的执行。比如，Linux 5.3 版本中新增的辅助函数 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7554"><span data-slate-object="text" data-key="7555"><span data-slate-leaf="true" data-offset-key="7555:0" data-first-offset="true"><span data-slate-string="true">bpf_send_signal()</span></span></span></span><span data-slate-object="text" data-key="7556"><span data-slate-leaf="true" data-offset-key="7556:0" data-first-offset="true"><span data-slate-string="true"> 可以直接把有安全隐患的进程杀死，而 Linux 5.7 新增的 LSM 插桩则可以扩展 Linux 安全模块的审计和策略执行（想了解 LSM 钩子的详细信息，你可以参考内核头文件 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7557"><span data-slate-object="text" data-key="7558"><span data-slate-leaf="true" data-offset-key="7558:0" data-first-offset="true"><span data-slate-string="true">include/linux/lsm_hooks.h</span></span></span></a><span data-slate-object="text" data-key="7559"><span data-slate-leaf="true" data-offset-key="7559:0" data-first-offset="true"><span data-slate-string="true">）。在网络安全方面，XDP 程序还可以在网络协议栈之前丢弃数据包，减少非法网络请求对系统资源的消耗。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7560"><span data-slate-object="text" data-key="7561"><span data-slate-leaf="true" data-offset-key="7561:0" data-first-offset="true"><span data-slate-string="true">以上一小节的二进制命令执行为例，你可以在 bpftrace 中调用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7562"><span data-slate-object="text" data-key="7563"><span data-slate-leaf="true" data-offset-key="7563:0" data-first-offset="true"><span data-slate-string="true">signal()</span></span></span></span><span data-slate-object="text" data-key="7564"><span data-slate-leaf="true" data-offset-key="7564:0" data-first-offset="true"><span data-slate-string="true"> 函数，给当前进程发送特定信号：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7565"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7566"><span data-slate-object="text" data-key="7567"><span data-slate-leaf="true" data-offset-key="7567:0" data-first-offset="true"><span data-slate-string="true">tracepoint:syscalls:sys_enter_execve</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7568"><span data-slate-object="text" data-key="7569"><span data-slate-leaf="true" data-offset-key="7569:0" data-first-offset="true"><span data-slate-string="true">/comm == </span></span></span><span data-slate-object="text" data-key="7570"><span data-slate-leaf="true" data-offset-key="7570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bash"</span></span></span></span><span data-slate-object="text" data-key="7571"><span data-slate-leaf="true" data-offset-key="7571:0" data-first-offset="true"><span data-slate-string="true">/ {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7572"><span data-slate-object="text" data-key="7573"><span data-slate-leaf="true" data-offset-key="7573:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7574"><span data-slate-leaf="true" data-offset-key="7574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$task</span></span></span></span><span data-slate-object="text" data-key="7575"><span data-slate-leaf="true" data-offset-key="7575:0" data-first-offset="true"><span data-slate-string="true"> = (struct task_struct *)curtask;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7576"><span data-slate-object="text" data-key="7577"><span data-slate-leaf="true" data-offset-key="7577:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7578"><span data-slate-leaf="true" data-offset-key="7578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$cname</span></span></span></span><span data-slate-object="text" data-key="7579"><span data-slate-leaf="true" data-offset-key="7579:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="7580"><span data-slate-leaf="true" data-offset-key="7580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$task</span></span></span></span><span data-slate-object="text" data-key="7581"><span data-slate-leaf="true" data-offset-key="7581:0" data-first-offset="true"><span data-slate-string="true">-&gt;nsproxy-&gt;uts_ns-&gt;name.nodename;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7582"><span data-slate-object="text" data-key="7583"><span data-slate-leaf="true" data-offset-key="7583:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7584"><span data-slate-leaf="true" data-offset-key="7584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">printf</span></span></span></span><span data-slate-object="text" data-key="7585"><span data-slate-leaf="true" data-offset-key="7585:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7586"><span data-slate-leaf="true" data-offset-key="7586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Killing shell command in container %s: %s"</span></span></span></span><span data-slate-object="text" data-key="7587"><span data-slate-leaf="true" data-offset-key="7587:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7588"><span data-slate-leaf="true" data-offset-key="7588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$cname</span></span></span></span><span data-slate-object="text" data-key="7589"><span data-slate-leaf="true" data-offset-key="7589:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7590"><span data-slate-leaf="true" data-offset-key="7590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$pidns</span></span></span></span><span data-slate-object="text" data-key="7591"><span data-slate-leaf="true" data-offset-key="7591:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7592"><span data-slate-leaf="true" data-offset-key="7592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">comm</span></span></span></span><span data-slate-object="text" data-key="7593"><span data-slate-leaf="true" data-offset-key="7593:0" data-first-offset="true"><span data-slate-string="true">); </span></span></span><span data-slate-object="text" data-key="7594"><span data-slate-leaf="true" data-offset-key="7594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">join</span></span></span></span><span data-slate-object="text" data-key="7595"><span data-slate-leaf="true" data-offset-key="7595:0" data-first-offset="true"><span data-slate-string="true">(args-&gt;argv);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7596"><span data-slate-object="text" data-key="7597"><span data-slate-leaf="true" data-offset-key="7597:0" data-first-offset="true"><span data-slate-string="true"> signal(9); /* SIGKILL */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7598"><span data-slate-object="text" data-key="7599"><span data-slate-leaf="true" data-offset-key="7599:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7600"><span data-slate-object="text" data-key="7601"><span data-slate-leaf="true" data-offset-key="7601:0" data-first-offset="true"><span data-slate-string="true">这段代码中的具体内容含义如下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7602"><div data-slate-type="list-line" data-slate-object="block" data-key="7603"><span data-slate-type="code" data-slate-object="inline" data-key="7604"><span data-slate-object="text" data-key="7605"><span data-slate-leaf="true" data-offset-key="7605:0" data-first-offset="true"><span data-slate-string="true">/comm == "bash"/</span></span></span></span><span data-slate-object="text" data-key="7606"><span data-slate-leaf="true" data-offset-key="7606:0" data-first-offset="true"><span data-slate-string="true"> 表示对进程名称进行过滤，只处理 Bash 进程；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7607"><span data-slate-type="code" data-slate-object="inline" data-key="7608"><span data-slate-object="text" data-key="7609"><span data-slate-leaf="true" data-offset-key="7609:0" data-first-offset="true"><span data-slate-string="true">signal(9)</span></span></span></span><span data-slate-object="text" data-key="7610"><span data-slate-leaf="true" data-offset-key="7610:0" data-first-offset="true"><span data-slate-string="true"> 表示向进程发送 SIGKILL 信号，即杀死进程。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7611"><span data-slate-object="text" data-key="7612"><span data-slate-leaf="true" data-offset-key="7612:0" data-first-offset="true"><span data-slate-string="true">加入与上一小节中相同的头文件，然后把它保存到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7613"><span data-slate-object="text" data-key="7614"><span data-slate-leaf="true" data-offset-key="7614:0" data-first-offset="true"><span data-slate-string="true">block-container-shell.bt</span></span></span></span><span data-slate-object="text" data-key="7615"><span data-slate-leaf="true" data-offset-key="7615:0" data-first-offset="true"><span data-slate-string="true"> 文件（你也可以在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7616"><span data-slate-object="text" data-key="7617"><span data-slate-leaf="true" data-offset-key="7617:0" data-first-offset="true"><span data-slate-string="true">GitHub</span></span></span></a><span data-slate-object="text" data-key="7618"><span data-slate-leaf="true" data-offset-key="7618:0" data-first-offset="true"><span data-slate-string="true"> 上找到完整代码）中，然后运行下面的命令来执行：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7619"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7620"><span data-slate-object="text" data-key="7621"><span data-slate-leaf="true" data-offset-key="7621:0" data-first-offset="true"><span data-slate-string="true">sudo bpftrace --unsafe block-container-shell.bt</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7622"><span data-slate-object="text" data-key="7623"><span data-slate-leaf="true" data-offset-key="7623:0" data-first-offset="true"><span data-slate-string="true">接着，回到容器终端，执行任意命令都会失败，并且失败信息都是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7624"><span data-slate-object="text" data-key="7625"><span data-slate-leaf="true" data-offset-key="7625:0" data-first-offset="true"><span data-slate-string="true">Killed</span></span></span></span><span data-slate-object="text" data-key="7626"><span data-slate-leaf="true" data-offset-key="7626:0" data-first-offset="true"><span data-slate-string="true"> 。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7627"><span data-slate-object="text" data-key="7628"><span data-slate-leaf="true" data-offset-key="7628:0" data-first-offset="true"><span data-slate-string="true">需要注意，这种直接杀死进程的方法实际上比较危险，如果出现误杀，可能会导致大量进程都无法正常启动。所以 bpftrace 要求你加上 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7629"><span data-slate-object="text" data-key="7630"><span data-slate-leaf="true" data-offset-key="7630:0" data-first-offset="true"><span data-slate-string="true">--unsafe</span></span></span></span><span data-slate-object="text" data-key="7631"><span data-slate-leaf="true" data-offset-key="7631:0" data-first-offset="true"><span data-slate-string="true"> 选项后才可以正常运行。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7632" id="sr-toc-4"><span data-slate-object="text" data-key="7633"><span data-slate-leaf="true" data-offset-key="7633:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7634"><span data-slate-object="text" data-key="7635"><span data-slate-leaf="true" data-offset-key="7635:0" data-first-offset="true"><span data-slate-string="true">今天，我带你一起梳理了 eBPF 的安全能力，并以容器应用为例，带你用 eBPF 分析并阻止了容器中的命令执行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7636"><span data-slate-object="text" data-key="7637"><span data-slate-leaf="true" data-offset-key="7637:0" data-first-offset="true"><span data-slate-string="true">eBPF 所支持的 kprobe、uprobe、tracepoint 等各类探针已经非常全面地涵盖了从应用到内核中的各类安全问题相关的跟踪点，再配合其开销低、实时性好，且不需要修改并重新编译内核和应用等特性，使 eBPF 特别适合用于安全事件的动态监测和实时分析诊断。对于安全策略的执行，eBPF 也已经支持了 LSM 钩子、向进程发送信号、丢弃网络数据包等各类操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7638"><span data-slate-object="text" data-key="7639"><span data-slate-leaf="true" data-offset-key="7639:0" data-first-offset="true"><span data-slate-string="true">在这一讲的最后，我想提醒你：既然 eBPF 提供了这么强大的功能，在用好 eBPF 这些丰富特性的同时，你也要特别留意 eBPF 程序自身的安全性。比如，禁止普通用户和普通容器应用运行 eBPF 程序，而只允许管理员和系统服务运行。对容器来说，你可以利用 Capabilities 禁止普通容器的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7640"><span data-slate-object="text" data-key="7641"><span data-slate-leaf="true" data-offset-key="7641:0" data-first-offset="true"><span data-slate-string="true">CAP_PERFMON</span></span></span></span><span data-slate-object="text" data-key="7642"><span data-slate-leaf="true" data-offset-key="7642:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7643"><span data-slate-object="text" data-key="7644"><span data-slate-leaf="true" data-offset-key="7644:0" data-first-offset="true"><span data-slate-string="true">CAP_BPF</span></span></span></span><span data-slate-object="text" data-key="7645"><span data-slate-leaf="true" data-offset-key="7645:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7646"><span data-slate-object="text" data-key="7647"><span data-slate-leaf="true" data-offset-key="7647:0" data-first-offset="true"><span data-slate-string="true">CAP_SYS_ADMIN</span></span></span></span><span data-slate-object="text" data-key="7648"><span data-slate-leaf="true" data-offset-key="7648:0" data-first-offset="true"><span data-slate-string="true"> 等权限。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7649" id="sr-toc-5"><span data-slate-object="text" data-key="7650"><span data-slate-leaf="true" data-offset-key="7650:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7651"><span data-slate-object="text" data-key="7652"><span data-slate-leaf="true" data-offset-key="7652:0" data-first-offset="true"><span data-slate-string="true">最后，我想邀请你来聊一聊：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7653"><div data-slate-type="list-line" data-slate-object="block" data-key="7654"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7655"><span data-slate-leaf="true" data-offset-key="7655:0" data-first-offset="true"><span data-slate-string="true">在了解 eBPF 之前，你是如何监测、分析和阻止容器的安全问题的？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="7656"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7657"><span data-slate-leaf="true" data-offset-key="7657:0" data-first-offset="true"><span data-slate-string="true">在阻止容器 Bash 命令执行的案例中，除了杀死进程之外，还有哪些其他的方法？</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7658"><span data-slate-object="text" data-key="7659"><span data-slate-leaf="true" data-offset-key="7659:0" data-first-offset="true"><span data-slate-string="true">期待你在留言区和我讨论，也欢迎把这节课分享给你的同事、朋友。让我们一起在实战中演练，在交流中进步。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/c1/9415076c60e63fc6303d9a3bc900b5c1.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-6">精选留言 (5)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>莫名</span></div></div><div>另外分享一个经验，结构体 nsproxy 的 net 字段（代表进程所在的网络命名空间）在追踪网络包在宿主机 -&gt; 容器传递过程时尤其有用，可以比较清楚的看到网络包从宿主机的网络命名空间传递到容器独立的网络命名空间之中，协助更好的理解容器网络模型。（把网络设备名字也打印出来会更好。）

倪老师文中的示例程序 execsnoop-container.bt 使用了结构体 nsproxy 的 pid_ns_for_children 获取 PID 命名空间，稍微改动了一下，换成 NET 命名空间，把具体的 id 打出来。

输出示例（shell1 执行 docker run ... bash, shell2 追踪 execve 事件，可以看到 bash 进程在一个新的网络命名空间下执行。）：

shell 1 # docker exec -ti vibrant_jepsen bash
root@c340ba5cb9de:/#

shell2 # # ./execve.bt
Attaching 3 probes...
NETNS          CONTAINER              PPID     PID     COMM         ARGS
4026531993   VM-56-211-centos   799603 181059 bash            docker exec -ti vibrant_jepsen bash
...
4026532351   c340ba5cb9de         181078   181083 runc:[2:INIT]   bash

具体源码：
======================================

#!/usr/bin/env bpftrace

#include &lt;linux/sched.h&gt;
#include &lt;linux/nsproxy.h&gt;
#include &lt;linux/utsname.h&gt;
//#include &lt;linux/pid_namespace.h&gt;
#include &lt;net/net_namespace.h&gt;

BEGIN 
{
  printf ("%-12s %-18s %-6s %-6s %-16s % s\n", "NETNS", "CONTAINER", "PPID", "PID", "COMM", "ARGS");
}

tracepoint:syscalls:sys_enter_execve,
tracepoint:syscalls:sys_enter_execveat
{
  $task = (struct task_struct *) curtask;
  $netns = $task-&gt;nsproxy-&gt;net_ns-&gt;ns.inum;
  //$pidns = $task-&gt;nsproxy-&gt;pid_ns_for_children-&gt;ns.inum;
  $cname = $task-&gt;nsproxy-&gt;uts_ns-&gt;name.nodename;
  printf ("%-12ld %-18s %-6d %-6d %-16s", (uint64)$netns, $cname, curtask-&gt;parent-&gt;pid, pid, comm);
  join (args-&gt;argv);
}</div><div><p>作者回复：非常棒的示例，谢谢分享👍</p></div><div><div>2022-02-10</div><div><div><i></i></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 莫名</span></div></div><div>1、曾使用过 sysdig，老版本通过插入内核模块的方式进行安全审计。后来 sysdig 支持了 eBPF driver，主要通过追踪系统调用分析可能的安全隐患。sysdig eBPF driver 实现比较简单，一共十几个 program，统一放在 probe.c 源文件，里面的思路借鉴下还是不错的。
2、觉得需要在 bash 自身上做手脚，比如把 bash 软链接到一个脚本文件，记录下 bash 执行记录，然后 直接 exit。或者修改 bash 配置文件 .bashrc，文件末尾直接 exit。两种方法都有局限性，如果被识破可以很容易绕过去。</div><div><p>作者回复: 1. 谢谢分享 sysdig 的使用经验！
2. 嗯嗯，这是一种不错的方法。或者考虑极端一些，完全禁止掉 Bash（比如所有进程都跑在容器中，容器内不允许安装任何 SHELL）。</p></div><div><div>2022-02-10</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 写点啥呢</span></div></div><div>本节课是关于 eBPF 在安全方面的使用，微博上看到有人发的这个 rookit：https://weibo.com/tv/show/1034:4718242451882158?from=old_pc_videoshow，因此我对 eBPF 如何保证自身安全性很好奇，想请教下老师对于系统来说 eBPF 是一个两面利器，它自身设计与实现，还有在使用中该如何注意避免引入安全问题呢？

另外像 bpf_send_signal 辅助函数能够通过信号杀死进程，这是不是一种类似变成语言的 unsafe 方法，应该在实际中谨慎使用呢？

谢谢老师。</div><div><p>作者回复：你说的非常正确，eBPF 如果被恶意应用利用，也同样会带来不可预料的损失。所以，在系统维护中，还是需要对进程的权限有所限制。比如，不要用 root 用户运行进程、不要给容器特权或者 ADMIN capability 等等。</p></div><div><div>2022-02-09</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 郑海成</span></div></div><div>https://elixir.bootlin.com/linux/v5.13/source/include/linux/sched.h#L657 老师，bootlin 这个网站是有什么要求吗？为什么我所有的代码 link 都显示 "This file does not exist." 呢？</div><div><div>2022-04-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIsEia7TcYPiaO53QIydh4tPonwnpktgrhLeJqg4sNa8s11XNVTVajrI9jKibHs0FYn0EW8d8t3EM8ibQ/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Geek_89541f</span></div></div><div>请问我在阿里云的虚拟机（centos 系统，内核版本 4.18) 中使用 ip link 加载 xdp 程序，若指定 xdpdrv 模式会报错，xdpgeneric 可以。这是为啥？虚拟网卡只能使用 generic 模式吗？这样性能不能满足生产需求。</div><div><p>作者回复: xdpdrv 模式需要网卡驱动的支持的，具体的驱动支持情况可以参考 https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md#xdp</p></div><div><div>2022-02-09</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".z"><outline class="toc-level-h1" data-reactid=".z.0" style="width: 175px;"><active data-reactid=".z.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".z.0.1"><span data-reactid=".z.0.1.0">11 | 容器安全：如何使用 eBPF 增强容器安全？</span></a></outline><outline class="toc-level-h2" data-reactid=".z.1" style="width: 165px;"><active data-reactid=".z.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".z.1.1"><span data-reactid=".z.1.1.0">eBPF 都有哪些安全能力？</span></a></outline><outline class="toc-level-h2" data-reactid=".z.2" style="width: 165px;"><active data-reactid=".z.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".z.2.1"><span data-reactid=".z.2.1.0">如何使用 eBPF 分析容器的安全问题？</span></a></outline><outline class="toc-level-h2" data-reactid=".z.3" style="width: 165px;"><active data-reactid=".z.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".z.3.1"><span data-reactid=".z.3.1.0">如何使用 eBPF 阻止容器的异常行为？</span></a></outline><outline class="toc-level-h2" data-reactid=".z.4" style="width: 165px;"><active data-reactid=".z.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".z.4.1"><span data-reactid=".z.4.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".z.5" style="width: 165px;"><active data-reactid=".z.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".z.5.1"><span data-reactid=".z.5.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".z.6" style="width: 165px;"><active data-reactid=".z.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".z.6.1"><span data-reactid=".z.6.1.0">精选留言 (5)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/485101" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>