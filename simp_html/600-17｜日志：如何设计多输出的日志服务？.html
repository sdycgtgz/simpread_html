
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 17｜日志：如何设计多输出的日志服务？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>17｜日志：如何设计多输出的日志服务？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">细节和生态是 Gin 如此成功核心原因。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">17｜日志：如何设计多输出的日志服务？</h1><div><span>叶剑峰</span> <span> 2021-10-25</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ae/f5/ae1ff8c643531f08b0322a9d846db3f5.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：叶剑峰</span><span>大小：16.12M</span><span> 时长：17:39</span></div></div><audio title="17｜日志：如何设计多输出的日志服务？" src="https://res001.geekbang.org/media/audio/48/e8/482c65267a584f8fbae47df745f5f7e8/ld/ld.m3u8" __idm_id__="704524"></audio></div><div><div><div><div data-slate-editor="true" data-key="9194" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="9195"><span data-slate-object="text" data-key="9196"><span data-slate-leaf="true" data-offset-key="9196:0" data-first-offset="true"><span data-slate-string="true">你好，我是轩脉刃。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9197"><span data-slate-object="text" data-key="9198"><span data-slate-leaf="true" data-offset-key="9198:0" data-first-offset="true"><span data-slate-string="true">上面两节课，我们将环境变量和配置服务作为一个服务注册到容器中了。这样，在业务中就能很方便获取环境变量和配置了。不知道你有没有逐渐体会到这种 “一切皆服务” 思想的好处。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9199"><span data-slate-object="text" data-key="9200"><span data-slate-leaf="true" data-offset-key="9200:0" data-first-offset="true"><span data-slate-string="true">就像堆积积木，只要想好了一个服务的接口，我们逐步实现服务之后，这一个服务就是一块积木，之后可以用相同的思路实现各种服务的积木块，用它们来拼出我们需要的业务逻辑。这节课，我们就来实现另一个框架最核心的积木：日志服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9201"><span data-slate-object="text" data-key="9202"><span data-slate-leaf="true" data-offset-key="9202:0" data-first-offset="true"><span data-slate-string="true">实现一个框架的服务，我们习惯了要创建三个文件：接口协议文件 framework/contract/log.go、服务提供者 framework/provider/log/provider.go、接口实例 framework/provider/log/service.go。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9203" id="sr-toc-1"><span data-slate-object="text" data-key="9204"><span data-slate-leaf="true" data-offset-key="9204:0" data-first-offset="true"><span data-slate-string="true">日志接口协议</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9205"><span data-slate-object="text" data-key="9206"><span data-slate-leaf="true" data-offset-key="9206:0" data-first-offset="true"><span data-slate-string="true">说到日志服务，最先冒出来的一定是三个问题：什么样的日志需要输出？日志输出哪些内容？日志输出到哪里？一个个来分析。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="9207" id="sr-toc-2"><span data-slate-object="text" data-key="9208"><span data-slate-leaf="true" data-offset-key="9208:0" data-first-offset="true"><span data-slate-string="true">日志级别</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="9209"><span data-slate-object="text" data-key="9210"><span data-slate-leaf="true" data-offset-key="9210:0" data-first-offset="true"><span data-slate-string="true">什么样的日志需要输出，这是个关于日志级别的问题。我们想要把日志分为几个级别？每个级别代表什么？这个日志级别其实在不同系统中有不同划分，比如 Linux 的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9211"><span data-slate-object="text" data-key="9212"><span data-slate-leaf="true" data-offset-key="9212:0" data-first-offset="true"><span data-slate-string="true">syslog</span></span></span></a><span data-slate-object="text" data-key="9213"><span data-slate-leaf="true" data-offset-key="9213:0" data-first-offset="true"><span data-slate-string="true"> 中将系统划分为以下八种日志级别：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9214"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f5/ea/f5382bc685494efb2c024f31f25aa2ea.png?wh=912x438"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9215"><span data-slate-object="text" data-key="9216"><span data-slate-leaf="true" data-offset-key="9216:0" data-first-offset="true"><span data-slate-string="true">而 Java 的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9217"><span data-slate-object="text" data-key="9218"><span data-slate-leaf="true" data-offset-key="9218:0" data-first-offset="true"><span data-slate-string="true">log4j</span></span></span></a><span data-slate-object="text" data-key="9219"><span data-slate-leaf="true" data-offset-key="9219:0" data-first-offset="true"><span data-slate-string="true"> 将日志分为以下七种日志级别：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="9220"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e0/78/e07a0aefb9039788d17921e192394f78.jpg?wh=1920x1080"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9221"><span data-slate-object="text" data-key="9222"><span data-slate-leaf="true" data-offset-key="9222:0" data-first-offset="true"><span data-slate-string="true">其实仔细看，它们的日志级别差别都不大。比如都同意用 Error 级别代表运行时的错误情况，而 Warn 级别代表运行时可以弥补的错误、Info 级别代表运行时信息、debug 代表调试的时候需要打印的信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9223"><span data-slate-object="text" data-key="9224"><span data-slate-leaf="true" data-offset-key="9224:0" data-first-offset="true"><span data-slate-string="true">不同点就在是否有 trace 级别以及 Error 级别往上的级别定义。syslog 没有 trace 级别，而在 Error 级别往上分别定义了 Emergency 级别、Alert 级别、Critical 级别。而 log4j 在 ERROR 上定义了两个级别 FATAL 和 OFF，也同时保留了 Trace 级别。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9225"><span data-slate-object="text" data-key="9226"><span data-slate-leaf="true" data-offset-key="9226:0" data-first-offset="true"><span data-slate-string="true">在我看来，syslog 和 log4j 的日志区分主要是由于场景不同。syslog 比较偏向于</span></span></span><span data-slate-object="text" data-key="9227"><span data-slate-leaf="true" data-offset-key="9227:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">操作系统的使用场景</span></span></span></span><span data-slate-object="text" data-key="9228"><span data-slate-leaf="true" data-offset-key="9228:0" data-first-offset="true"><span data-slate-string="true">，它的分级语义更多是告诉我们系统的情况，比如 Alert 这个级别表示 “系统有问题，需要立即采取行动”；而 log4j 的日志级别定义是</span></span></span><span data-slate-object="text" data-key="9229"><span data-slate-leaf="true" data-offset-key="9229:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">从一个应用出发的</span></span></span></span><span data-slate-object="text" data-key="9230"><span data-slate-leaf="true" data-offset-key="9230:0" data-first-offset="true"><span data-slate-string="true">，它的影响范围理论上会小一些，所以它很难定义比如像 “需要立即采取行动” 这样的级别。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9231"><span data-slate-object="text" data-key="9232"><span data-slate-leaf="true" data-offset-key="9232:0" data-first-offset="true"><span data-slate-string="true">所以，这里我们主要参考 log4j 的日志级别方法，并做了一些小调整，归并为下列七种日志级别：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9233"><div data-slate-type="list-line" data-slate-object="block" data-key="9234"><span data-slate-object="text" data-key="9235"><span data-slate-leaf="true" data-offset-key="9235:0" data-first-offset="true"><span data-slate-string="true">panic，表示会导致整个程序出现崩溃的日志信息</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9236"><span data-slate-object="text" data-key="9237"><span data-slate-leaf="true" data-offset-key="9237:0" data-first-offset="true"><span data-slate-string="true">fatal，表示会导致当前这个请求出现提前终止的错误信息</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9238"><span data-slate-object="text" data-key="9239"><span data-slate-leaf="true" data-offset-key="9239:0" data-first-offset="true"><span data-slate-string="true">error，表示出现错误，但是不一定影响后续请求逻辑的错误信息</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9240"><span data-slate-object="text" data-key="9241"><span data-slate-leaf="true" data-offset-key="9241:0" data-first-offset="true"><span data-slate-string="true">warn，表示出现错误，但是一定不影响后续请求逻辑的报警信息</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9242"><span data-slate-object="text" data-key="9243"><span data-slate-leaf="true" data-offset-key="9243:0" data-first-offset="true"><span data-slate-string="true">info，表示正常的日志信息输出</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9244"><span data-slate-object="text" data-key="9245"><span data-slate-leaf="true" data-offset-key="9245:0" data-first-offset="true"><span data-slate-string="true">debug，表示在调试状态下打印出来的日志信息</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9246"><span data-slate-object="text" data-key="9247"><span data-slate-leaf="true" data-offset-key="9247:0" data-first-offset="true"><span data-slate-string="true">trace，表示最详细的信息，一般信息量比较大，可能包含调用堆栈等信息</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9248"><span data-slate-object="text" data-key="9249"><span data-slate-leaf="true" data-offset-key="9249:0" data-first-offset="true"><span data-slate-string="true">在 error 级别之上，我们把导致程序崩溃和导致请求结束的错误拆分出来，分为 panic 和 fatal 两个类型来定义级别。而其他的 error、warn、info、debug 都和其他的日志系统一致。另外也增加一个 trace 级别，当需要打印调用堆栈等这些比较详细的信息的时候，可以使用这种日志级别。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9250"><span data-slate-object="text" data-key="9251"><span data-slate-leaf="true" data-offset-key="9251:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">日志级别是按照严重顺序从下往上排列的</span></span></span></span><span data-slate-object="text" data-key="9252"><span data-slate-leaf="true" data-offset-key="9252:0" data-first-offset="true"><span data-slate-string="true">。也就是说，如果我们设置了日志输出级别为 info，那么 info 级别的日志及 info 级别往上，日志级别更高的 warn、error、fatal、panic 的日志，也需要被打印出来。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9253"><span data-slate-object="text" data-key="9254"><span data-slate-leaf="true" data-offset-key="9254:0" data-first-offset="true"><span data-slate-string="true">按照这个思路，我们在 framework/contract/log.go 中定义的接口协议如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9255"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9256"><span data-slate-object="text" data-key="9257"><span data-slate-leaf="true" data-offset-key="9257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="9258"><span data-slate-leaf="true" data-offset-key="9258:0" data-first-offset="true"><span data-slate-string="true"> contract</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9259"><span data-slate-object="text" data-key="9260"><span data-slate-leaf="true" data-offset-key="9260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="9261"><span data-slate-leaf="true" data-offset-key="9261:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9262"><span data-slate-object="text" data-key="9263"><span data-slate-leaf="true" data-offset-key="9263:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9264"><span data-slate-leaf="true" data-offset-key="9264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"context"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9265"><span data-slate-object="text" data-key="9266"><span data-slate-leaf="true" data-offset-key="9266:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9267"><span data-slate-leaf="true" data-offset-key="9267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"io"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9268"><span data-slate-object="text" data-key="9269"><span data-slate-leaf="true" data-offset-key="9269:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9270"><span data-slate-leaf="true" data-offset-key="9270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"time"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9271"><span data-slate-object="text" data-key="9272"><span data-slate-leaf="true" data-offset-key="9272:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9273"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9274"><span data-slate-object="text" data-key="9275"><span data-slate-leaf="true" data-offset-key="9275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 协议关键字</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9276"><span data-slate-object="text" data-key="9277"><span data-slate-leaf="true" data-offset-key="9277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="9278"><span data-slate-leaf="true" data-offset-key="9278:0" data-first-offset="true"><span data-slate-string="true"> LogKey = </span></span></span><span data-slate-object="text" data-key="9279"><span data-slate-leaf="true" data-offset-key="9279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hade:log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9280"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9281"><span data-slate-object="text" data-key="9282"><span data-slate-leaf="true" data-offset-key="9282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9283"><span data-slate-leaf="true" data-offset-key="9283:0" data-first-offset="true"><span data-slate-string="true"> LogLevel </span></span></span><span data-slate-object="text" data-key="9284"><span data-slate-leaf="true" data-offset-key="9284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint32</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9285"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9286"><span data-slate-object="text" data-key="9287"><span data-slate-leaf="true" data-offset-key="9287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="9288"><span data-slate-leaf="true" data-offset-key="9288:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9289"><span data-slate-object="text" data-key="9290"><span data-slate-leaf="true" data-offset-key="9290:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9291"><span data-slate-leaf="true" data-offset-key="9291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// UnknownLevel 表示未知的日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9292"><span data-slate-object="text" data-key="9293"><span data-slate-leaf="true" data-offset-key="9293:0" data-first-offset="true"><span data-slate-string="true">   UnknownLevel LogLevel = </span></span></span><span data-slate-object="text" data-key="9294"><span data-slate-leaf="true" data-offset-key="9294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iota</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9295"><span data-slate-object="text" data-key="9296"><span data-slate-leaf="true" data-offset-key="9296:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9297"><span data-slate-leaf="true" data-offset-key="9297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// PanicLevel level, panic 表示会导致整个程序出现崩溃的日志信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9298"><span data-slate-object="text" data-key="9299"><span data-slate-leaf="true" data-offset-key="9299:0" data-first-offset="true"><span data-slate-string="true">   PanicLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9300"><span data-slate-object="text" data-key="9301"><span data-slate-leaf="true" data-offset-key="9301:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9302"><span data-slate-leaf="true" data-offset-key="9302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// FatalLevel level. fatal 表示会导致当前这个请求出现提前终止的错误信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9303"><span data-slate-object="text" data-key="9304"><span data-slate-leaf="true" data-offset-key="9304:0" data-first-offset="true"><span data-slate-string="true">   FatalLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9305"><span data-slate-object="text" data-key="9306"><span data-slate-leaf="true" data-offset-key="9306:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9307"><span data-slate-leaf="true" data-offset-key="9307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ErrorLevel level. error 表示出现错误，但是不一定影响后续请求逻辑的错误信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9308"><span data-slate-object="text" data-key="9309"><span data-slate-leaf="true" data-offset-key="9309:0" data-first-offset="true"><span data-slate-string="true">   ErrorLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9310"><span data-slate-object="text" data-key="9311"><span data-slate-leaf="true" data-offset-key="9311:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9312"><span data-slate-leaf="true" data-offset-key="9312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// WarnLevel level. warn 表示出现错误，但是一定不影响后续请求逻辑的报警信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9313"><span data-slate-object="text" data-key="9314"><span data-slate-leaf="true" data-offset-key="9314:0" data-first-offset="true"><span data-slate-string="true">   WarnLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9315"><span data-slate-object="text" data-key="9316"><span data-slate-leaf="true" data-offset-key="9316:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9317"><span data-slate-leaf="true" data-offset-key="9317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// InfoLevel level. info 表示正常的日志信息输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9318"><span data-slate-object="text" data-key="9319"><span data-slate-leaf="true" data-offset-key="9319:0" data-first-offset="true"><span data-slate-string="true">   InfoLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9320"><span data-slate-object="text" data-key="9321"><span data-slate-leaf="true" data-offset-key="9321:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9322"><span data-slate-leaf="true" data-offset-key="9322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// DebugLevel level. debug 表示在调试状态下打印出来的日志信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9323"><span data-slate-object="text" data-key="9324"><span data-slate-leaf="true" data-offset-key="9324:0" data-first-offset="true"><span data-slate-string="true">   DebugLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9325"><span data-slate-object="text" data-key="9326"><span data-slate-leaf="true" data-offset-key="9326:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9327"><span data-slate-leaf="true" data-offset-key="9327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// TraceLevel level. trace 表示最详细的信息，一般信息量比较大，可能包含调用堆栈等信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9328"><span data-slate-object="text" data-key="9329"><span data-slate-leaf="true" data-offset-key="9329:0" data-first-offset="true"><span data-slate-string="true">   TraceLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9330"><span data-slate-object="text" data-key="9331"><span data-slate-leaf="true" data-offset-key="9331:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9332"><span data-slate-object="text" data-key="9333"><span data-slate-leaf="true" data-offset-key="9333:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9334"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9335"><span data-slate-object="text" data-key="9336"><span data-slate-leaf="true" data-offset-key="9336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Log define interface for log</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9337"><span data-slate-object="text" data-key="9338"><span data-slate-leaf="true" data-offset-key="9338:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9339"><span data-slate-leaf="true" data-offset-key="9339:0" data-first-offset="true"><span data-slate-string="true"> Log </span></span></span><span data-slate-object="text" data-key="9340"><span data-slate-leaf="true" data-offset-key="9340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9341"><span data-slate-leaf="true" data-offset-key="9341:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9342"><span data-slate-object="text" data-key="9343"><span data-slate-leaf="true" data-offset-key="9343:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9344"><span data-slate-leaf="true" data-offset-key="9344:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Panic 表示会导致整个程序出现崩溃的日志信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9345"><span data-slate-object="text" data-key="9346"><span data-slate-leaf="true" data-offset-key="9346:0" data-first-offset="true"><span data-slate-string="true">   Panic(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9347"><span data-slate-leaf="true" data-offset-key="9347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9348"><span data-slate-leaf="true" data-offset-key="9348:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9349"><span data-slate-leaf="true" data-offset-key="9349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9350"><span data-slate-leaf="true" data-offset-key="9350:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9351"><span data-slate-leaf="true" data-offset-key="9351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9352"><span data-slate-leaf="true" data-offset-key="9352:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9353"><span data-slate-leaf="true" data-offset-key="9353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9354"><span data-slate-leaf="true" data-offset-key="9354:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9355"><span data-slate-object="text" data-key="9356"><span data-slate-leaf="true" data-offset-key="9356:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9357"><span data-slate-leaf="true" data-offset-key="9357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Fatal 表示会导致当前这个请求出现提前终止的错误信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9358"><span data-slate-object="text" data-key="9359"><span data-slate-leaf="true" data-offset-key="9359:0" data-first-offset="true"><span data-slate-string="true">   Fatal(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9360"><span data-slate-leaf="true" data-offset-key="9360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9361"><span data-slate-leaf="true" data-offset-key="9361:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9362"><span data-slate-leaf="true" data-offset-key="9362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9363"><span data-slate-leaf="true" data-offset-key="9363:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9364"><span data-slate-leaf="true" data-offset-key="9364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9365"><span data-slate-leaf="true" data-offset-key="9365:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9366"><span data-slate-leaf="true" data-offset-key="9366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9367"><span data-slate-leaf="true" data-offset-key="9367:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9368"><span data-slate-object="text" data-key="9369"><span data-slate-leaf="true" data-offset-key="9369:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9370"><span data-slate-leaf="true" data-offset-key="9370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Error 表示出现错误，但是不一定影响后续请求逻辑的错误信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9371"><span data-slate-object="text" data-key="9372"><span data-slate-leaf="true" data-offset-key="9372:0" data-first-offset="true"><span data-slate-string="true">   Error(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9373"><span data-slate-leaf="true" data-offset-key="9373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9374"><span data-slate-leaf="true" data-offset-key="9374:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9375"><span data-slate-leaf="true" data-offset-key="9375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9376"><span data-slate-leaf="true" data-offset-key="9376:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9377"><span data-slate-leaf="true" data-offset-key="9377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9378"><span data-slate-leaf="true" data-offset-key="9378:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9379"><span data-slate-leaf="true" data-offset-key="9379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9380"><span data-slate-leaf="true" data-offset-key="9380:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9381"><span data-slate-object="text" data-key="9382"><span data-slate-leaf="true" data-offset-key="9382:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9383"><span data-slate-leaf="true" data-offset-key="9383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Warn 表示出现错误，但是一定不影响后续请求逻辑的报警信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9384"><span data-slate-object="text" data-key="9385"><span data-slate-leaf="true" data-offset-key="9385:0" data-first-offset="true"><span data-slate-string="true">   Warn(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9386"><span data-slate-leaf="true" data-offset-key="9386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9387"><span data-slate-leaf="true" data-offset-key="9387:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9388"><span data-slate-leaf="true" data-offset-key="9388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9389"><span data-slate-leaf="true" data-offset-key="9389:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9390"><span data-slate-leaf="true" data-offset-key="9390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9391"><span data-slate-leaf="true" data-offset-key="9391:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9392"><span data-slate-leaf="true" data-offset-key="9392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9393"><span data-slate-leaf="true" data-offset-key="9393:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9394"><span data-slate-object="text" data-key="9395"><span data-slate-leaf="true" data-offset-key="9395:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9396"><span data-slate-leaf="true" data-offset-key="9396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Info 表示正常的日志信息输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9397"><span data-slate-object="text" data-key="9398"><span data-slate-leaf="true" data-offset-key="9398:0" data-first-offset="true"><span data-slate-string="true">   Info(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9399"><span data-slate-leaf="true" data-offset-key="9399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9400"><span data-slate-leaf="true" data-offset-key="9400:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9401"><span data-slate-leaf="true" data-offset-key="9401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9402"><span data-slate-leaf="true" data-offset-key="9402:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9403"><span data-slate-leaf="true" data-offset-key="9403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9404"><span data-slate-leaf="true" data-offset-key="9404:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9405"><span data-slate-leaf="true" data-offset-key="9405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9406"><span data-slate-leaf="true" data-offset-key="9406:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9407"><span data-slate-object="text" data-key="9408"><span data-slate-leaf="true" data-offset-key="9408:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9409"><span data-slate-leaf="true" data-offset-key="9409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Debug 表示在调试状态下打印出来的日志信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9410"><span data-slate-object="text" data-key="9411"><span data-slate-leaf="true" data-offset-key="9411:0" data-first-offset="true"><span data-slate-string="true">   Debug(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9412"><span data-slate-leaf="true" data-offset-key="9412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9413"><span data-slate-leaf="true" data-offset-key="9413:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9414"><span data-slate-leaf="true" data-offset-key="9414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9415"><span data-slate-leaf="true" data-offset-key="9415:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9416"><span data-slate-leaf="true" data-offset-key="9416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9417"><span data-slate-leaf="true" data-offset-key="9417:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9418"><span data-slate-leaf="true" data-offset-key="9418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9419"><span data-slate-leaf="true" data-offset-key="9419:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9420"><span data-slate-object="text" data-key="9421"><span data-slate-leaf="true" data-offset-key="9421:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9422"><span data-slate-leaf="true" data-offset-key="9422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Trace 表示最详细的信息，一般信息量比较大，可能包含调用堆栈等信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9423"><span data-slate-object="text" data-key="9424"><span data-slate-leaf="true" data-offset-key="9424:0" data-first-offset="true"><span data-slate-string="true">   Trace(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="9425"><span data-slate-leaf="true" data-offset-key="9425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9426"><span data-slate-leaf="true" data-offset-key="9426:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="9427"><span data-slate-leaf="true" data-offset-key="9427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9428"><span data-slate-leaf="true" data-offset-key="9428:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9429"><span data-slate-leaf="true" data-offset-key="9429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9430"><span data-slate-leaf="true" data-offset-key="9430:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9431"><span data-slate-leaf="true" data-offset-key="9431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9432"><span data-slate-leaf="true" data-offset-key="9432:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9433"><span data-slate-object="text" data-key="9434"><span data-slate-leaf="true" data-offset-key="9434:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9435"><span data-slate-leaf="true" data-offset-key="9435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetLevel 设置日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9436"><span data-slate-object="text" data-key="9437"><span data-slate-leaf="true" data-offset-key="9437:0" data-first-offset="true"><span data-slate-string="true">   SetLevel(level LogLevel)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9438"><span data-slate-object="text" data-key="9439"><span data-slate-leaf="true" data-offset-key="9439:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9440"><span data-slate-object="text" data-key="9441"><span data-slate-leaf="true" data-offset-key="9441:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9442"><span data-slate-object="text" data-key="9443"><span data-slate-leaf="true" data-offset-key="9443:0" data-first-offset="true"><span data-slate-string="true">在接口中，我们针对七种日志级别设置了七个不同的方法，并且提供 SetLevel 方法，来设置当前这个日志服务需要输出的日志级别。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="9444" id="sr-toc-3"><span data-slate-object="text" data-key="9445"><span data-slate-leaf="true" data-offset-key="9445:0" data-first-offset="true"><span data-slate-string="true">日志格式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="9446"><span data-slate-object="text" data-key="9447"><span data-slate-leaf="true" data-offset-key="9447:0" data-first-offset="true"><span data-slate-string="true">定义好了日志级别，下面该定义日志格式了。日志格式包括输出哪些内容、如何输出？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9448"><span data-slate-object="text" data-key="9449"><span data-slate-leaf="true" data-offset-key="9449:0" data-first-offset="true"><span data-slate-string="true">首先明确下需要输出的日志信息，不外乎有下面四个部分：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9450"><div data-slate-type="list-line" data-slate-object="block" data-key="9451"><span data-slate-object="text" data-key="9452"><span data-slate-leaf="true" data-offset-key="9452:0" data-first-offset="true"><span data-slate-string="true">日志级别，输出当前日志的级别信息。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9453"><span data-slate-object="text" data-key="9454"><span data-slate-leaf="true" data-offset-key="9454:0" data-first-offset="true"><span data-slate-string="true">日志时间，输出当前日志的打印时间。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9455"><span data-slate-object="text" data-key="9456"><span data-slate-leaf="true" data-offset-key="9456:0" data-first-offset="true"><span data-slate-string="true">日志简要信息，输出当前日志的简要描述信息，一句话说明日志错误。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9457"><span data-slate-object="text" data-key="9458"><span data-slate-leaf="true" data-offset-key="9458:0" data-first-offset="true"><span data-slate-string="true">日志上下文字段，输出当前日志的附带信息。这些字段代表日志打印的上下文。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9459"><span data-slate-object="text" data-key="9460"><span data-slate-leaf="true" data-offset-key="9460:0" data-first-offset="true"><span data-slate-string="true">比如这就是一个完整的日志信息：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9461"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9462"><span data-slate-object="text" data-key="9463"><span data-slate-leaf="true" data-offset-key="9463:0" data-first-offset="true"><span data-slate-string="true">[Info]  </span></span></span><span data-slate-object="text" data-key="9464"><span data-slate-leaf="true" data-offset-key="9464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2021</span></span></span></span><span data-slate-object="text" data-key="9465"><span data-slate-leaf="true" data-offset-key="9465:0" data-first-offset="true"><span data-slate-string="true">-09-22T00:04:</span></span></span><span data-slate-object="text" data-key="9466"><span data-slate-leaf="true" data-offset-key="9466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">21</span></span></span></span><span data-slate-object="text" data-key="9467"><span data-slate-leaf="true" data-offset-key="9467:0" data-first-offset="true"><span data-slate-string="true">+08:</span></span></span><span data-slate-object="text" data-key="9468"><span data-slate-leaf="true" data-offset-key="9468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="9469"><span data-slate-leaf="true" data-offset-key="9469:0" data-first-offset="true"><span data-slate-string="true">       </span></span></span><span data-slate-object="text" data-key="9470"><span data-slate-leaf="true" data-offset-key="9470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo test error"</span></span></span></span><span data-slate-object="text" data-key="9471"><span data-slate-leaf="true" data-offset-key="9471:0" data-first-offset="true"><span data-slate-string="true">       </span></span></span><span data-slate-object="text" data-key="9472"><span data-slate-leaf="true" data-offset-key="9472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9473"><span data-slate-leaf="true" data-offset-key="9473:0" data-first-offset="true"><span data-slate-string="true">[api:demo/demo cspan_id: parent_id: span_id:c55051d94815vbl56i2g trace_id:c55051d94815vbl56i20 user:jianfengye]</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9474"><span data-slate-object="text" data-key="9475"><span data-slate-leaf="true" data-offset-key="9475:0" data-first-offset="true"><span data-slate-string="true">上面那条日志，日志级别为 Info，时间为 2021-09-21 年 15:40:03，时区为 +08:00。简要信息 demo test error 表示这个日志希望打印的信息，剩下的 map 表示的 key、value 为补充的日志上下文字段。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9476"><span data-slate-object="text" data-key="9477"><span data-slate-leaf="true" data-offset-key="9477:0" data-first-offset="true"><span data-slate-string="true">它对应的调用函数如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9478"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9479"><span data-slate-object="text" data-key="9480"><span data-slate-leaf="true" data-offset-key="9480:0" data-first-offset="true"><span data-slate-string="true">logger.Info(c, </span></span></span><span data-slate-object="text" data-key="9481"><span data-slate-leaf="true" data-offset-key="9481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo test error"</span></span></span></span><span data-slate-object="text" data-key="9482"><span data-slate-leaf="true" data-offset-key="9482:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9483"><span data-slate-leaf="true" data-offset-key="9483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9484"><span data-slate-leaf="true" data-offset-key="9484:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9485"><span data-slate-leaf="true" data-offset-key="9485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9486"><span data-slate-leaf="true" data-offset-key="9486:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9487"><span data-slate-leaf="true" data-offset-key="9487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9488"><span data-slate-leaf="true" data-offset-key="9488:0" data-first-offset="true"><span data-slate-string="true">{}{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9489"><span data-slate-object="text" data-key="9490"><span data-slate-leaf="true" data-offset-key="9490:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9491"><span data-slate-leaf="true" data-offset-key="9491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"api"</span></span></span></span><span data-slate-object="text" data-key="9492"><span data-slate-leaf="true" data-offset-key="9492:0" data-first-offset="true"><span data-slate-string="true">:  </span></span></span><span data-slate-object="text" data-key="9493"><span data-slate-leaf="true" data-offset-key="9493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo/demo"</span></span></span></span><span data-slate-object="text" data-key="9494"><span data-slate-leaf="true" data-offset-key="9494:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9495"><span data-slate-object="text" data-key="9496"><span data-slate-leaf="true" data-offset-key="9496:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9497"><span data-slate-leaf="true" data-offset-key="9497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user"</span></span></span></span><span data-slate-object="text" data-key="9498"><span data-slate-leaf="true" data-offset-key="9498:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="9499"><span data-slate-leaf="true" data-offset-key="9499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jianfengye"</span></span></span></span><span data-slate-object="text" data-key="9500"><span data-slate-leaf="true" data-offset-key="9500:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9501"><span data-slate-object="text" data-key="9502"><span data-slate-leaf="true" data-offset-key="9502:0" data-first-offset="true"><span data-slate-string="true">})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9503"><span data-slate-object="text" data-key="9504"><span data-slate-leaf="true" data-offset-key="9504:0" data-first-offset="true"><span data-slate-string="true">这里我额外说一下日志上下文字段。它是一个 map 值，来源可能有两个：一个是用户在打印日志的时候传递的 map，比如上面代码中的 api 和 user；而另外一部分数据是可能来自 context，因为在具体业务开发中，我们很有可能把一些通用信息，比如 trace_id 等放在 context 里，这一部分信息也会希望取出放在日志的上下文字段中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9505"><span data-slate-object="text" data-key="9506"><span data-slate-leaf="true" data-offset-key="9506:0" data-first-offset="true"><span data-slate-string="true">所以这里有一个从 context 中获取日志上下文字段的方法。在 framework/contract/log.go 中定义其为 CtxFielder。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9507"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9508"><span data-slate-object="text" data-key="9509"><span data-slate-leaf="true" data-offset-key="9509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// CtxFielder 定义了从 context 中获取信息的方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9510"><span data-slate-object="text" data-key="9511"><span data-slate-leaf="true" data-offset-key="9511:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9512"><span data-slate-leaf="true" data-offset-key="9512:0" data-first-offset="true"><span data-slate-string="true"> CtxFielder </span></span></span><span data-slate-object="text" data-key="9513"><span data-slate-leaf="true" data-offset-key="9513:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="9514"><span data-slate-leaf="true" data-offset-key="9514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx context.Context)</span></span></span></span></span><span data-slate-object="text" data-key="9515"><span data-slate-leaf="true" data-offset-key="9515:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9516"><span data-slate-leaf="true" data-offset-key="9516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9517"><span data-slate-leaf="true" data-offset-key="9517:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="9518"><span data-slate-leaf="true" data-offset-key="9518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="9519"><span data-slate-leaf="true" data-offset-key="9519:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="9520"><span data-slate-leaf="true" data-offset-key="9520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9521"><span data-slate-leaf="true" data-offset-key="9521:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9522"><span data-slate-object="text" data-key="9523"><span data-slate-leaf="true" data-offset-key="9523:0" data-first-offset="true"><span data-slate-string="true">明确了打印哪些信息，更要明确这些信息按照什么输出格式输出。这个输出格式也是一个通用方法 Fomatter，它的传入参数就是刚才的四个日志信息。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9524"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9525"><span data-slate-object="text" data-key="9526"><span data-slate-leaf="true" data-offset-key="9526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Formatter 定义了将日志信息组织成字符串的通用方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9527"><span data-slate-object="text" data-key="9528"><span data-slate-leaf="true" data-offset-key="9528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9529"><span data-slate-leaf="true" data-offset-key="9529:0" data-first-offset="true"><span data-slate-string="true"> Formatter </span></span></span><span data-slate-object="text" data-key="9530"><span data-slate-leaf="true" data-offset-key="9530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="9531"><span data-slate-leaf="true" data-offset-key="9531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(level LogLevel, t time.Time, msg </span></span></span></span></span><span data-slate-object="text" data-key="9532"><span data-slate-leaf="true" data-offset-key="9532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="9533"><span data-slate-leaf="true" data-offset-key="9533:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, fields </span></span></span></span></span><span data-slate-object="text" data-key="9534"><span data-slate-leaf="true" data-offset-key="9534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span></span></span><span data-slate-object="text" data-key="9535"><span data-slate-leaf="true" data-offset-key="9535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">[</span></span></span></span></span><span data-slate-object="text" data-key="9536"><span data-slate-leaf="true" data-offset-key="9536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="9537"><span data-slate-leaf="true" data-offset-key="9537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">]</span></span></span></span></span><span data-slate-object="text" data-key="9538"><span data-slate-leaf="true" data-offset-key="9538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="9539"><span data-slate-leaf="true" data-offset-key="9539:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="9540"><span data-slate-leaf="true" data-offset-key="9540:0" data-first-offset="true"><span data-slate-string="true"> ([]</span></span></span><span data-slate-object="text" data-key="9541"><span data-slate-leaf="true" data-offset-key="9541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="9542"><span data-slate-leaf="true" data-offset-key="9542:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9543"><span data-slate-leaf="true" data-offset-key="9543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="9544"><span data-slate-leaf="true" data-offset-key="9544:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9545"><span data-slate-object="text" data-key="9546"><span data-slate-leaf="true" data-offset-key="9546:0" data-first-offset="true"><span data-slate-string="true">同时在 log 服务协议中增加了 SetFormatter 和 SetCtxFielder 的方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9547"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9548"><span data-slate-object="text" data-key="9549"><span data-slate-leaf="true" data-offset-key="9549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Log 定义了日志服务协议</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9550"><span data-slate-object="text" data-key="9551"><span data-slate-leaf="true" data-offset-key="9551:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9552"><span data-slate-leaf="true" data-offset-key="9552:0" data-first-offset="true"><span data-slate-string="true"> Log </span></span></span><span data-slate-object="text" data-key="9553"><span data-slate-leaf="true" data-offset-key="9553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9554"><span data-slate-leaf="true" data-offset-key="9554:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9555"><span data-slate-object="text" data-key="9556"><span data-slate-leaf="true" data-offset-key="9556:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9557"><span data-slate-object="text" data-key="9558"><span data-slate-leaf="true" data-offset-key="9558:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9559"><span data-slate-leaf="true" data-offset-key="9559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetCtxFielder 从 context 中获取上下文字段 field</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9560"><span data-slate-object="text" data-key="9561"><span data-slate-leaf="true" data-offset-key="9561:0" data-first-offset="true"><span data-slate-string="true">   SetCtxFielder(handler CtxFielder)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9562"><span data-slate-object="text" data-key="9563"><span data-slate-leaf="true" data-offset-key="9563:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9564"><span data-slate-leaf="true" data-offset-key="9564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetFormatter 设置输出格式</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9565"><span data-slate-object="text" data-key="9566"><span data-slate-leaf="true" data-offset-key="9566:0" data-first-offset="true"><span data-slate-string="true">   SetFormatter(formatter Formatter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9567"><span data-slate-object="text" data-key="9568"><span data-slate-leaf="true" data-offset-key="9568:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9569"><span data-slate-object="text" data-key="9570"><span data-slate-leaf="true" data-offset-key="9570:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="9571" id="sr-toc-4"><span data-slate-object="text" data-key="9572"><span data-slate-leaf="true" data-offset-key="9572:0" data-first-offset="true"><span data-slate-string="true">日志输出</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="9573"><span data-slate-object="text" data-key="9574"><span data-slate-leaf="true" data-offset-key="9574:0" data-first-offset="true"><span data-slate-string="true">已经解决了前两个问题，明确了日志的级别和输出格式，那日志可以输出在哪些地方？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9575"><span data-slate-object="text" data-key="9576"><span data-slate-leaf="true" data-offset-key="9576:0" data-first-offset="true"><span data-slate-string="true">其实我们在定义接口的时候，并不知道它会输出到哪里。但是只需要知道一定会输出到某个输出管道就可以了，之后在每个应用中使用的时候，我们再根据每个应用的配置，来确认具体的输出管道实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9577"><span data-slate-object="text" data-key="9578"><span data-slate-leaf="true" data-offset-key="9578:0" data-first-offset="true"><span data-slate-string="true">目前这个输出管道我们使用 io.Writer 来进行设置：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9579"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9580"><span data-slate-object="text" data-key="9581"><span data-slate-leaf="true" data-offset-key="9581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Log 定义了日志服务协议</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9582"><span data-slate-object="text" data-key="9583"><span data-slate-leaf="true" data-offset-key="9583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9584"><span data-slate-leaf="true" data-offset-key="9584:0" data-first-offset="true"><span data-slate-string="true"> Log </span></span></span><span data-slate-object="text" data-key="9585"><span data-slate-leaf="true" data-offset-key="9585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9586"><span data-slate-leaf="true" data-offset-key="9586:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9587"><span data-slate-object="text" data-key="9588"><span data-slate-leaf="true" data-offset-key="9588:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9589"><span data-slate-object="text" data-key="9590"><span data-slate-leaf="true" data-offset-key="9590:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9591"><span data-slate-leaf="true" data-offset-key="9591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// SetOutput 设置输出管道</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9592"><span data-slate-object="text" data-key="9593"><span data-slate-leaf="true" data-offset-key="9593:0" data-first-offset="true"><span data-slate-string="true">   SetOutput(out io.Writer)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9594"><span data-slate-object="text" data-key="9595"><span data-slate-leaf="true" data-offset-key="9595:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9596" id="sr-toc-5"><span data-slate-object="text" data-key="9597"><span data-slate-leaf="true" data-offset-key="9597:0" data-first-offset="true"><span data-slate-string="true">日志服务提供者</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9598"><span data-slate-object="text" data-key="9599"><span data-slate-leaf="true" data-offset-key="9599:0" data-first-offset="true"><span data-slate-string="true">日志接口协议文件就完成了，下面来实现日志的服务提供者，在 framework/provider/log/provider.go 中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9600"><span data-slate-object="text" data-key="9601"><span data-slate-leaf="true" data-offset-key="9601:0" data-first-offset="true"><span data-slate-string="true">在编写服务提供者的时候，我们需要先明确最终会提供哪些服务。对于日志服务，按照我们平时的使用情况，可以分为四类：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9602"><div data-slate-type="list-line" data-slate-object="block" data-key="9603"><span data-slate-object="text" data-key="9604"><span data-slate-leaf="true" data-offset-key="9604:0" data-first-offset="true"><span data-slate-string="true">控制台输出</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9605"><span data-slate-object="text" data-key="9606"><span data-slate-leaf="true" data-offset-key="9606:0" data-first-offset="true"><span data-slate-string="true">本地单个日志文件输出</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9607"><span data-slate-object="text" data-key="9608"><span data-slate-leaf="true" data-offset-key="9608:0" data-first-offset="true"><span data-slate-string="true">本地单个日志文件，自动进行切割输出</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9609"><span data-slate-object="text" data-key="9610"><span data-slate-leaf="true" data-offset-key="9610:0" data-first-offset="true"><span data-slate-string="true">自定义输出</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9611"><span data-slate-object="text" data-key="9612"><span data-slate-leaf="true" data-offset-key="9612:0" data-first-offset="true"><span data-slate-string="true">这四种输出我们都各自定义一个服务，分别放在 framework/provider/log/service/ 目录下的四个文件里：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="9613"><div data-slate-type="list-line" data-slate-object="block" data-key="9614"><span data-slate-object="text" data-key="9615"><span data-slate-leaf="true" data-offset-key="9615:0" data-first-offset="true"><span data-slate-string="true">console.go 表示控制台输出，定义初始化实例方法 NewHadeConsoleLog；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9616"><span data-slate-object="text" data-key="9617"><span data-slate-leaf="true" data-offset-key="9617:0" data-first-offset="true"><span data-slate-string="true">single.go 表述单个日志文件输出，定义初始化实例方法 NewHadeSingleLog；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9618"><span data-slate-object="text" data-key="9619"><span data-slate-leaf="true" data-offset-key="9619:0" data-first-offset="true"><span data-slate-string="true">rotate.go 表示单个文件输出，但是自动进行切割，定义初始化实例方法 NewHadeRotateLog；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="9620"><span data-slate-object="text" data-key="9621"><span data-slate-leaf="true" data-offset-key="9621:0" data-first-offset="true"><span data-slate-string="true">custom.go 表示自定义输出，定义实例化方法 NewHadeCustomLog。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9622"><span data-slate-object="text" data-key="9623"><span data-slate-leaf="true" data-offset-key="9623:0" data-first-offset="true"><span data-slate-string="true">那在服务提供者的 Register 注册服务实例方法中，我们设计成根据配置项 “log.driver” ，来选择不同的实例化方法，默认为 NewHadeConsoleLog 方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9624"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9625"><span data-slate-object="text" data-key="9626"><span data-slate-leaf="true" data-offset-key="9626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Register 注册一个服务实例</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9627"><span data-slate-object="text" data-key="9628"><span data-slate-leaf="true" data-offset-key="9628:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="9629"><span data-slate-leaf="true" data-offset-key="9629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="9630"><span data-slate-leaf="true" data-offset-key="9630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(l *HadeLogServiceProvider)</span></span></span></span></span><span data-slate-object="text" data-key="9631"><span data-slate-leaf="true" data-offset-key="9631:0" data-first-offset="true"><span data-slate-string="true"> Register(c framework.Container) framework.NewInstance {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9632"><span data-slate-object="text" data-key="9633"><span data-slate-leaf="true" data-offset-key="9633:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9634"><span data-slate-leaf="true" data-offset-key="9634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9635"><span data-slate-leaf="true" data-offset-key="9635:0" data-first-offset="true"><span data-slate-string="true"> l.Driver == </span></span></span><span data-slate-object="text" data-key="9636"><span data-slate-leaf="true" data-offset-key="9636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="9637"><span data-slate-leaf="true" data-offset-key="9637:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9638"><span data-slate-object="text" data-key="9639"><span data-slate-leaf="true" data-offset-key="9639:0" data-first-offset="true"><span data-slate-string="true">      tcs, err := c.Make(contract.ConfigKey)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9640"><span data-slate-object="text" data-key="9641"><span data-slate-leaf="true" data-offset-key="9641:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9642"><span data-slate-leaf="true" data-offset-key="9642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9643"><span data-slate-leaf="true" data-offset-key="9643:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="9644"><span data-slate-leaf="true" data-offset-key="9644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="9645"><span data-slate-leaf="true" data-offset-key="9645:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9646"><span data-slate-object="text" data-key="9647"><span data-slate-leaf="true" data-offset-key="9647:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="9648"><span data-slate-leaf="true" data-offset-key="9648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 默认使用 console</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9649"><span data-slate-object="text" data-key="9650"><span data-slate-leaf="true" data-offset-key="9650:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="9651"><span data-slate-leaf="true" data-offset-key="9651:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9652"><span data-slate-leaf="true" data-offset-key="9652:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeConsoleLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9653"><span data-slate-object="text" data-key="9654"><span data-slate-leaf="true" data-offset-key="9654:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9655"><span data-slate-object="text" data-key="9656"><span data-slate-leaf="true" data-offset-key="9656:0" data-first-offset="true"><span data-slate-string="true">      cs := tcs.(contract.Config)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9657"><span data-slate-object="text" data-key="9658"><span data-slate-leaf="true" data-offset-key="9658:0" data-first-offset="true"><span data-slate-string="true">      l.Driver = strings.ToLower(cs.GetString(</span></span></span><span data-slate-object="text" data-key="9659"><span data-slate-leaf="true" data-offset-key="9659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.Driver"</span></span></span></span><span data-slate-object="text" data-key="9660"><span data-slate-leaf="true" data-offset-key="9660:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9661"><span data-slate-object="text" data-key="9662"><span data-slate-leaf="true" data-offset-key="9662:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9663"><span data-slate-object="text" data-key="9664"><span data-slate-leaf="true" data-offset-key="9664:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9665"><span data-slate-leaf="true" data-offset-key="9665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 根据 driver 的配置项确定</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9666"><span data-slate-object="text" data-key="9667"><span data-slate-leaf="true" data-offset-key="9667:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9668"><span data-slate-leaf="true" data-offset-key="9668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">switch</span></span></span></span><span data-slate-object="text" data-key="9669"><span data-slate-leaf="true" data-offset-key="9669:0" data-first-offset="true"><span data-slate-string="true"> l.Driver {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9670"><span data-slate-object="text" data-key="9671"><span data-slate-leaf="true" data-offset-key="9671:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9672"><span data-slate-leaf="true" data-offset-key="9672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="9673"><span data-slate-leaf="true" data-offset-key="9673:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9674"><span data-slate-leaf="true" data-offset-key="9674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"single"</span></span></span></span><span data-slate-object="text" data-key="9675"><span data-slate-leaf="true" data-offset-key="9675:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9676"><span data-slate-object="text" data-key="9677"><span data-slate-leaf="true" data-offset-key="9677:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9678"><span data-slate-leaf="true" data-offset-key="9678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9679"><span data-slate-leaf="true" data-offset-key="9679:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeSingleLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9680"><span data-slate-object="text" data-key="9681"><span data-slate-leaf="true" data-offset-key="9681:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9682"><span data-slate-leaf="true" data-offset-key="9682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="9683"><span data-slate-leaf="true" data-offset-key="9683:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9684"><span data-slate-leaf="true" data-offset-key="9684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"rotate"</span></span></span></span><span data-slate-object="text" data-key="9685"><span data-slate-leaf="true" data-offset-key="9685:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9686"><span data-slate-object="text" data-key="9687"><span data-slate-leaf="true" data-offset-key="9687:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9688"><span data-slate-leaf="true" data-offset-key="9688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9689"><span data-slate-leaf="true" data-offset-key="9689:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeRotateLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9690"><span data-slate-object="text" data-key="9691"><span data-slate-leaf="true" data-offset-key="9691:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9692"><span data-slate-leaf="true" data-offset-key="9692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="9693"><span data-slate-leaf="true" data-offset-key="9693:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9694"><span data-slate-leaf="true" data-offset-key="9694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"console"</span></span></span></span><span data-slate-object="text" data-key="9695"><span data-slate-leaf="true" data-offset-key="9695:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9696"><span data-slate-object="text" data-key="9697"><span data-slate-leaf="true" data-offset-key="9697:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9698"><span data-slate-leaf="true" data-offset-key="9698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9699"><span data-slate-leaf="true" data-offset-key="9699:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeConsoleLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9700"><span data-slate-object="text" data-key="9701"><span data-slate-leaf="true" data-offset-key="9701:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9702"><span data-slate-leaf="true" data-offset-key="9702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="9703"><span data-slate-leaf="true" data-offset-key="9703:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9704"><span data-slate-leaf="true" data-offset-key="9704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"custom"</span></span></span></span><span data-slate-object="text" data-key="9705"><span data-slate-leaf="true" data-offset-key="9705:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9706"><span data-slate-object="text" data-key="9707"><span data-slate-leaf="true" data-offset-key="9707:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9708"><span data-slate-leaf="true" data-offset-key="9708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9709"><span data-slate-leaf="true" data-offset-key="9709:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeCustomLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9710"><span data-slate-object="text" data-key="9711"><span data-slate-leaf="true" data-offset-key="9711:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9712"><span data-slate-leaf="true" data-offset-key="9712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">default</span></span></span></span><span data-slate-object="text" data-key="9713"><span data-slate-leaf="true" data-offset-key="9713:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9714"><span data-slate-object="text" data-key="9715"><span data-slate-leaf="true" data-offset-key="9715:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9716"><span data-slate-leaf="true" data-offset-key="9716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9717"><span data-slate-leaf="true" data-offset-key="9717:0" data-first-offset="true"><span data-slate-string="true"> services.NewHadeConsoleLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9718"><span data-slate-object="text" data-key="9719"><span data-slate-leaf="true" data-offset-key="9719:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9720"><span data-slate-object="text" data-key="9721"><span data-slate-leaf="true" data-offset-key="9721:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9722"><span data-slate-object="text" data-key="9723"><span data-slate-leaf="true" data-offset-key="9723:0" data-first-offset="true"><span data-slate-string="true">而上一节里面分析的，日志的几个配置：日志级别、输出格式方法、context 内容获取方法、输出方法，都以服务提供者 provider.go 中参数的方式提供。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9724"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9725"><span data-slate-object="text" data-key="9726"><span data-slate-leaf="true" data-offset-key="9726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HadeLogServiceProvider 服务提供者</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9727"><span data-slate-object="text" data-key="9728"><span data-slate-leaf="true" data-offset-key="9728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="9729"><span data-slate-leaf="true" data-offset-key="9729:0" data-first-offset="true"><span data-slate-string="true"> HadeLogServiceProvider </span></span></span><span data-slate-object="text" data-key="9730"><span data-slate-leaf="true" data-offset-key="9730:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="9731"><span data-slate-leaf="true" data-offset-key="9731:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9732"><span data-slate-object="text" data-key="9733"><span data-slate-leaf="true" data-offset-key="9733:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9734"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9735"><span data-slate-object="text" data-key="9736"><span data-slate-leaf="true" data-offset-key="9736:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9737"><span data-slate-leaf="true" data-offset-key="9737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9738"><span data-slate-object="text" data-key="9739"><span data-slate-leaf="true" data-offset-key="9739:0" data-first-offset="true"><span data-slate-string="true">   Level contract.LogLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9740"><span data-slate-object="text" data-key="9741"><span data-slate-leaf="true" data-offset-key="9741:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9742"><span data-slate-leaf="true" data-offset-key="9742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志输出格式方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9743"><span data-slate-object="text" data-key="9744"><span data-slate-leaf="true" data-offset-key="9744:0" data-first-offset="true"><span data-slate-string="true">   Formatter contract.Formatter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9745"><span data-slate-object="text" data-key="9746"><span data-slate-leaf="true" data-offset-key="9746:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9747"><span data-slate-leaf="true" data-offset-key="9747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志 context 上下文信息获取函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9748"><span data-slate-object="text" data-key="9749"><span data-slate-leaf="true" data-offset-key="9749:0" data-first-offset="true"><span data-slate-string="true">   CtxFielder contract.CtxFielder</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9750"><span data-slate-object="text" data-key="9751"><span data-slate-leaf="true" data-offset-key="9751:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9752"><span data-slate-leaf="true" data-offset-key="9752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志输出信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9753"><span data-slate-object="text" data-key="9754"><span data-slate-leaf="true" data-offset-key="9754:0" data-first-offset="true"><span data-slate-string="true">   Output io.Writer</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9755"><span data-slate-object="text" data-key="9756"><span data-slate-leaf="true" data-offset-key="9756:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9757"><span data-slate-object="text" data-key="9758"><span data-slate-leaf="true" data-offset-key="9758:0" data-first-offset="true"><span data-slate-string="true">默认提供两种输出格式，一种是文本输出形式，比如上面举的那个例子，</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9759"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9760"><span data-slate-object="text" data-key="9761"><span data-slate-leaf="true" data-offset-key="9761:0" data-first-offset="true"><span data-slate-string="true">[Info]  </span></span></span><span data-slate-object="text" data-key="9762"><span data-slate-leaf="true" data-offset-key="9762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2021</span></span></span></span><span data-slate-object="text" data-key="9763"><span data-slate-leaf="true" data-offset-key="9763:0" data-first-offset="true"><span data-slate-string="true">-09-22T00:04:</span></span></span><span data-slate-object="text" data-key="9764"><span data-slate-leaf="true" data-offset-key="9764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">21</span></span></span></span><span data-slate-object="text" data-key="9765"><span data-slate-leaf="true" data-offset-key="9765:0" data-first-offset="true"><span data-slate-string="true">+08:</span></span></span><span data-slate-object="text" data-key="9766"><span data-slate-leaf="true" data-offset-key="9766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="9767"><span data-slate-leaf="true" data-offset-key="9767:0" data-first-offset="true"><span data-slate-string="true">       </span></span></span><span data-slate-object="text" data-key="9768"><span data-slate-leaf="true" data-offset-key="9768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo test error"</span></span></span></span><span data-slate-object="text" data-key="9769"><span data-slate-leaf="true" data-offset-key="9769:0" data-first-offset="true"><span data-slate-string="true">       </span></span></span><span data-slate-object="text" data-key="9770"><span data-slate-leaf="true" data-offset-key="9770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="9771"><span data-slate-leaf="true" data-offset-key="9771:0" data-first-offset="true"><span data-slate-string="true">[api:demo/demo cspan_id: parent_id: span_id:c55051d94815vbl56i2g trace_id:c55051d94815vbl56i20 user:jianfengye]</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9772"><span data-slate-object="text" data-key="9773"><span data-slate-leaf="true" data-offset-key="9773:0" data-first-offset="true"><span data-slate-string="true">另外一种是 JSON 输出形式，如下：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="9774"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9775"><span data-slate-object="text" data-key="9776"><span data-slate-leaf="true" data-offset-key="9776:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="9777"><span data-slate-leaf="true" data-offset-key="9777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"api"</span></span></span></span><span data-slate-object="text" data-key="9778"><span data-slate-leaf="true" data-offset-key="9778:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9779"><span data-slate-leaf="true" data-offset-key="9779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo/demo"</span></span></span></span><span data-slate-object="text" data-key="9780"><span data-slate-leaf="true" data-offset-key="9780:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9781"><span data-slate-leaf="true" data-offset-key="9781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"cspan_id"</span></span></span></span><span data-slate-object="text" data-key="9782"><span data-slate-leaf="true" data-offset-key="9782:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9783"><span data-slate-leaf="true" data-offset-key="9783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="9784"><span data-slate-leaf="true" data-offset-key="9784:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9785"><span data-slate-leaf="true" data-offset-key="9785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"level"</span></span></span></span><span data-slate-object="text" data-key="9786"><span data-slate-leaf="true" data-offset-key="9786:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9787"><span data-slate-leaf="true" data-offset-key="9787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="9788"><span data-slate-leaf="true" data-offset-key="9788:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9789"><span data-slate-leaf="true" data-offset-key="9789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"msg"</span></span></span></span><span data-slate-object="text" data-key="9790"><span data-slate-leaf="true" data-offset-key="9790:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9791"><span data-slate-leaf="true" data-offset-key="9791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"demo1"</span></span></span></span><span data-slate-object="text" data-key="9792"><span data-slate-leaf="true" data-offset-key="9792:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9793"><span data-slate-leaf="true" data-offset-key="9793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"parent_id"</span></span></span></span><span data-slate-object="text" data-key="9794"><span data-slate-leaf="true" data-offset-key="9794:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9795"><span data-slate-leaf="true" data-offset-key="9795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="9796"><span data-slate-leaf="true" data-offset-key="9796:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9797"><span data-slate-leaf="true" data-offset-key="9797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"span_id"</span></span></span></span><span data-slate-object="text" data-key="9798"><span data-slate-leaf="true" data-offset-key="9798:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9799"><span data-slate-leaf="true" data-offset-key="9799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"c54v0tt9481537jasreg"</span></span></span></span><span data-slate-object="text" data-key="9800"><span data-slate-leaf="true" data-offset-key="9800:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9801"><span data-slate-leaf="true" data-offset-key="9801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"timestamp"</span></span></span></span><span data-slate-object="text" data-key="9802"><span data-slate-leaf="true" data-offset-key="9802:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9803"><span data-slate-leaf="true" data-offset-key="9803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"2021-09-21T22:47:19+08:00"</span></span></span></span><span data-slate-object="text" data-key="9804"><span data-slate-leaf="true" data-offset-key="9804:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9805"><span data-slate-leaf="true" data-offset-key="9805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"trace_id"</span></span></span></span><span data-slate-object="text" data-key="9806"><span data-slate-leaf="true" data-offset-key="9806:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9807"><span data-slate-leaf="true" data-offset-key="9807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"c54v0tt9481537jasre0"</span></span></span></span><span data-slate-object="text" data-key="9808"><span data-slate-leaf="true" data-offset-key="9808:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9809"><span data-slate-leaf="true" data-offset-key="9809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"user"</span></span></span></span><span data-slate-object="text" data-key="9810"><span data-slate-leaf="true" data-offset-key="9810:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="9811"><span data-slate-leaf="true" data-offset-key="9811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"jianfengye"</span></span></span></span><span data-slate-object="text" data-key="9812"><span data-slate-leaf="true" data-offset-key="9812:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9813"><span data-slate-object="text" data-key="9814"><span data-slate-leaf="true" data-offset-key="9814:0" data-first-offset="true"><span data-slate-string="true">这两种输出除了格式不同，其中的内容应该是相同的。具体使用起来，文本输出更便于我们阅读，而 JSON 输出更便于机器或者程序阅读。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9815"><span data-slate-object="text" data-key="9816"><span data-slate-leaf="true" data-offset-key="9816:0" data-first-offset="true"><span data-slate-string="true">在实现文件夹 framework/provider/log/formatter/ 里，我们增加两个文件 json.go 和 text.go 表示两种格式输出，对应的 TextFormatter 和 JsonFormatter 是对应的文本格式输出方法，</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9817"><span data-slate-object="text" data-key="9818"><span data-slate-leaf="true" data-offset-key="9818:0" data-first-offset="true"><span data-slate-string="true">这里就贴出 text.go 的具体实现，很简单，其他的差别不大，可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="9819"><span data-slate-object="text" data-key="9820"><span data-slate-leaf="true" data-offset-key="9820:0" data-first-offset="true"><span data-slate-string="true">G</span></span></span></a><a data-slate-type="link" data-slate-object="inline" data-key="9821"><span data-slate-object="text" data-key="9822"><span data-slate-leaf="true" data-offset-key="9822:0" data-first-offset="true"><span data-slate-string="true">it</span></span></span></a><a data-slate-type="link" data-slate-object="inline" data-key="9823"><span data-slate-object="text" data-key="9824"><span data-slate-leaf="true" data-offset-key="9824:0" data-first-offset="true"><span data-slate-string="true">H</span></span></span></a><a data-slate-type="link" data-slate-object="inline" data-key="9825"><span data-slate-object="text" data-key="9826"><span data-slate-leaf="true" data-offset-key="9826:0" data-first-offset="true"><span data-slate-string="true">ub</span></span></span></a><span data-slate-object="text" data-key="9827"><span data-slate-leaf="true" data-offset-key="9827:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9828"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9829"><span data-slate-object="text" data-key="9830"><span data-slate-leaf="true" data-offset-key="9830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// TextFormatter 表示文本格式输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9831"><span data-slate-object="text" data-key="9832"><span data-slate-leaf="true" data-offset-key="9832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="9833"><span data-slate-leaf="true" data-offset-key="9833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="9834"><span data-slate-leaf="true" data-offset-key="9834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TextFormatter</span></span></span></span></span><span data-slate-object="text" data-key="9835"><span data-slate-leaf="true" data-offset-key="9835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(level contract.LogLevel, t time.Time, msg </span></span></span></span></span><span data-slate-object="text" data-key="9836"><span data-slate-leaf="true" data-offset-key="9836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="9837"><span data-slate-leaf="true" data-offset-key="9837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, fields </span></span></span></span></span><span data-slate-object="text" data-key="9838"><span data-slate-leaf="true" data-offset-key="9838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span></span></span><span data-slate-object="text" data-key="9839"><span data-slate-leaf="true" data-offset-key="9839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">[</span></span></span></span></span><span data-slate-object="text" data-key="9840"><span data-slate-leaf="true" data-offset-key="9840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="9841"><span data-slate-leaf="true" data-offset-key="9841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">]</span></span></span></span></span><span data-slate-object="text" data-key="9842"><span data-slate-leaf="true" data-offset-key="9842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="9843"><span data-slate-leaf="true" data-offset-key="9843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="9844"><span data-slate-leaf="true" data-offset-key="9844:0" data-first-offset="true"><span data-slate-string="true"> ([]</span></span></span><span data-slate-object="text" data-key="9845"><span data-slate-leaf="true" data-offset-key="9845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="9846"><span data-slate-leaf="true" data-offset-key="9846:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9847"><span data-slate-leaf="true" data-offset-key="9847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="9848"><span data-slate-leaf="true" data-offset-key="9848:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9849"><span data-slate-object="text" data-key="9850"><span data-slate-leaf="true" data-offset-key="9850:0" data-first-offset="true"><span data-slate-string="true">   bf := bytes.NewBuffer([]</span></span></span><span data-slate-object="text" data-key="9851"><span data-slate-leaf="true" data-offset-key="9851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="9852"><span data-slate-leaf="true" data-offset-key="9852:0" data-first-offset="true"><span data-slate-string="true">{})</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9853"><span data-slate-object="text" data-key="9854"><span data-slate-leaf="true" data-offset-key="9854:0" data-first-offset="true"><span data-slate-string="true">   Separator := </span></span></span><span data-slate-object="text" data-key="9855"><span data-slate-leaf="true" data-offset-key="9855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\t"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9856"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9857"><span data-slate-object="text" data-key="9858"><span data-slate-leaf="true" data-offset-key="9858:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9859"><span data-slate-leaf="true" data-offset-key="9859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 先输出日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9860"><span data-slate-object="text" data-key="9861"><span data-slate-leaf="true" data-offset-key="9861:0" data-first-offset="true"><span data-slate-string="true">   prefix := Prefix(level)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9862"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9863"><span data-slate-object="text" data-key="9864"><span data-slate-leaf="true" data-offset-key="9864:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(prefix)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9865"><span data-slate-object="text" data-key="9866"><span data-slate-leaf="true" data-offset-key="9866:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(Separator)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9867"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9868"><span data-slate-object="text" data-key="9869"><span data-slate-leaf="true" data-offset-key="9869:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9870"><span data-slate-leaf="true" data-offset-key="9870:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出时间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9871"><span data-slate-object="text" data-key="9872"><span data-slate-leaf="true" data-offset-key="9872:0" data-first-offset="true"><span data-slate-string="true">   ts := t.Format(time.RFC3339)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9873"><span data-slate-object="text" data-key="9874"><span data-slate-leaf="true" data-offset-key="9874:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(ts)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9875"><span data-slate-object="text" data-key="9876"><span data-slate-leaf="true" data-offset-key="9876:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(Separator)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9877"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9878"><span data-slate-object="text" data-key="9879"><span data-slate-leaf="true" data-offset-key="9879:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9880"><span data-slate-leaf="true" data-offset-key="9880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出 msg</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9881"><span data-slate-object="text" data-key="9882"><span data-slate-leaf="true" data-offset-key="9882:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(</span></span></span><span data-slate-object="text" data-key="9883"><span data-slate-leaf="true" data-offset-key="9883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\""</span></span></span></span><span data-slate-object="text" data-key="9884"><span data-slate-leaf="true" data-offset-key="9884:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9885"><span data-slate-object="text" data-key="9886"><span data-slate-leaf="true" data-offset-key="9886:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(msg)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9887"><span data-slate-object="text" data-key="9888"><span data-slate-leaf="true" data-offset-key="9888:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(</span></span></span><span data-slate-object="text" data-key="9889"><span data-slate-leaf="true" data-offset-key="9889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\""</span></span></span></span><span data-slate-object="text" data-key="9890"><span data-slate-leaf="true" data-offset-key="9890:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9891"><span data-slate-object="text" data-key="9892"><span data-slate-leaf="true" data-offset-key="9892:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(Separator)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9893"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9894"><span data-slate-object="text" data-key="9895"><span data-slate-leaf="true" data-offset-key="9895:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9896"><span data-slate-leaf="true" data-offset-key="9896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出 map</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9897"><span data-slate-object="text" data-key="9898"><span data-slate-leaf="true" data-offset-key="9898:0" data-first-offset="true"><span data-slate-string="true">   bf.WriteString(fmt.Sprint(fields))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9899"><span data-slate-object="text" data-key="9900"><span data-slate-leaf="true" data-offset-key="9900:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9901"><span data-slate-leaf="true" data-offset-key="9901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9902"><span data-slate-leaf="true" data-offset-key="9902:0" data-first-offset="true"><span data-slate-string="true"> bf.Bytes(), </span></span></span><span data-slate-object="text" data-key="9903"><span data-slate-leaf="true" data-offset-key="9903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9904"><span data-slate-object="text" data-key="9905"><span data-slate-leaf="true" data-offset-key="9905:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9906"><span data-slate-object="text" data-key="9907"><span data-slate-leaf="true" data-offset-key="9907:0" data-first-offset="true"><span data-slate-string="true">再回到 framework/provider/log/provider.go，定义服务提供者的 Params 方法。比如获取格式化方法 Formatter，我们就设定成，先判断在初始化的时候，是否定义了服务提供者；如果没有，再判断配置项 log.formatter 是否指定了格式化方法 json/text，设置最终的 Formatter，并且传递实例化的方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="9908"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9909"><span data-slate-object="text" data-key="9910"><span data-slate-leaf="true" data-offset-key="9910:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Params 定义要传递给实例化方法的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9911"><span data-slate-object="text" data-key="9912"><span data-slate-leaf="true" data-offset-key="9912:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="9913"><span data-slate-leaf="true" data-offset-key="9913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="9914"><span data-slate-leaf="true" data-offset-key="9914:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(l *HadeLogServiceProvider)</span></span></span></span></span><span data-slate-object="text" data-key="9915"><span data-slate-leaf="true" data-offset-key="9915:0" data-first-offset="true"><span data-slate-string="true"> Params(c framework.Container) []</span></span></span><span data-slate-object="text" data-key="9916"><span data-slate-leaf="true" data-offset-key="9916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9917"><span data-slate-leaf="true" data-offset-key="9917:0" data-first-offset="true"><span data-slate-string="true">{} {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9918"><span data-slate-object="text" data-key="9919"><span data-slate-leaf="true" data-offset-key="9919:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9920"><span data-slate-leaf="true" data-offset-key="9920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 configService</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9921"><span data-slate-object="text" data-key="9922"><span data-slate-leaf="true" data-offset-key="9922:0" data-first-offset="true"><span data-slate-string="true">   configService := c.MustMake(contract.ConfigKey).(contract.Config)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9923"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9924"><span data-slate-object="text" data-key="9925"><span data-slate-leaf="true" data-offset-key="9925:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9926"><span data-slate-leaf="true" data-offset-key="9926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置参数 formatter</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9927"><span data-slate-object="text" data-key="9928"><span data-slate-leaf="true" data-offset-key="9928:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9929"><span data-slate-leaf="true" data-offset-key="9929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9930"><span data-slate-leaf="true" data-offset-key="9930:0" data-first-offset="true"><span data-slate-string="true"> l.Formatter == </span></span></span><span data-slate-object="text" data-key="9931"><span data-slate-leaf="true" data-offset-key="9931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="9932"><span data-slate-leaf="true" data-offset-key="9932:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9933"><span data-slate-object="text" data-key="9934"><span data-slate-leaf="true" data-offset-key="9934:0" data-first-offset="true"><span data-slate-string="true">      l.Formatter = formatter.TextFormatter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9935"><span data-slate-object="text" data-key="9936"><span data-slate-leaf="true" data-offset-key="9936:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9937"><span data-slate-leaf="true" data-offset-key="9937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9938"><span data-slate-leaf="true" data-offset-key="9938:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="9939"><span data-slate-leaf="true" data-offset-key="9939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.formatter"</span></span></span></span><span data-slate-object="text" data-key="9940"><span data-slate-leaf="true" data-offset-key="9940:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9941"><span data-slate-object="text" data-key="9942"><span data-slate-leaf="true" data-offset-key="9942:0" data-first-offset="true"><span data-slate-string="true">         v := configService.GetString(</span></span></span><span data-slate-object="text" data-key="9943"><span data-slate-leaf="true" data-offset-key="9943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.formatter"</span></span></span></span><span data-slate-object="text" data-key="9944"><span data-slate-leaf="true" data-offset-key="9944:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9945"><span data-slate-object="text" data-key="9946"><span data-slate-leaf="true" data-offset-key="9946:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="9947"><span data-slate-leaf="true" data-offset-key="9947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9948"><span data-slate-leaf="true" data-offset-key="9948:0" data-first-offset="true"><span data-slate-string="true"> v == </span></span></span><span data-slate-object="text" data-key="9949"><span data-slate-leaf="true" data-offset-key="9949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"json"</span></span></span></span><span data-slate-object="text" data-key="9950"><span data-slate-leaf="true" data-offset-key="9950:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9951"><span data-slate-object="text" data-key="9952"><span data-slate-leaf="true" data-offset-key="9952:0" data-first-offset="true"><span data-slate-string="true">            l.Formatter = formatter.JsonFormatter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9953"><span data-slate-object="text" data-key="9954"><span data-slate-leaf="true" data-offset-key="9954:0" data-first-offset="true"><span data-slate-string="true">         } </span></span></span><span data-slate-object="text" data-key="9955"><span data-slate-leaf="true" data-offset-key="9955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="9956"><span data-slate-leaf="true" data-offset-key="9956:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9957"><span data-slate-leaf="true" data-offset-key="9957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9958"><span data-slate-leaf="true" data-offset-key="9958:0" data-first-offset="true"><span data-slate-string="true"> v == </span></span></span><span data-slate-object="text" data-key="9959"><span data-slate-leaf="true" data-offset-key="9959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"text"</span></span></span></span><span data-slate-object="text" data-key="9960"><span data-slate-leaf="true" data-offset-key="9960:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9961"><span data-slate-object="text" data-key="9962"><span data-slate-leaf="true" data-offset-key="9962:0" data-first-offset="true"><span data-slate-string="true">            l.Formatter = formatter.TextFormatter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9963"><span data-slate-object="text" data-key="9964"><span data-slate-leaf="true" data-offset-key="9964:0" data-first-offset="true"><span data-slate-string="true">         }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9965"><span data-slate-object="text" data-key="9966"><span data-slate-leaf="true" data-offset-key="9966:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9967"><span data-slate-object="text" data-key="9968"><span data-slate-leaf="true" data-offset-key="9968:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9969"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9970"><span data-slate-object="text" data-key="9971"><span data-slate-leaf="true" data-offset-key="9971:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9972"><span data-slate-leaf="true" data-offset-key="9972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9973"><span data-slate-leaf="true" data-offset-key="9973:0" data-first-offset="true"><span data-slate-string="true"> l.Level == contract.UnknownLevel {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9974"><span data-slate-object="text" data-key="9975"><span data-slate-leaf="true" data-offset-key="9975:0" data-first-offset="true"><span data-slate-string="true">      l.Level = contract.InfoLevel</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9976"><span data-slate-object="text" data-key="9977"><span data-slate-leaf="true" data-offset-key="9977:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="9978"><span data-slate-leaf="true" data-offset-key="9978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="9979"><span data-slate-leaf="true" data-offset-key="9979:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="9980"><span data-slate-leaf="true" data-offset-key="9980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.level"</span></span></span></span><span data-slate-object="text" data-key="9981"><span data-slate-leaf="true" data-offset-key="9981:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9982"><span data-slate-object="text" data-key="9983"><span data-slate-leaf="true" data-offset-key="9983:0" data-first-offset="true"><span data-slate-string="true">         l.Level = logLevel(configService.GetString(</span></span></span><span data-slate-object="text" data-key="9984"><span data-slate-leaf="true" data-offset-key="9984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.level"</span></span></span></span><span data-slate-object="text" data-key="9985"><span data-slate-leaf="true" data-offset-key="9985:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9986"><span data-slate-object="text" data-key="9987"><span data-slate-leaf="true" data-offset-key="9987:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9988"><span data-slate-object="text" data-key="9989"><span data-slate-leaf="true" data-offset-key="9989:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9990"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9991"><span data-slate-object="text" data-key="9992"><span data-slate-leaf="true" data-offset-key="9992:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9993"><span data-slate-leaf="true" data-offset-key="9993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 定义 5 个参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9994"><span data-slate-object="text" data-key="9995"><span data-slate-leaf="true" data-offset-key="9995:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="9996"><span data-slate-leaf="true" data-offset-key="9996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9997"><span data-slate-leaf="true" data-offset-key="9997:0" data-first-offset="true"><span data-slate-string="true"> []</span></span></span><span data-slate-object="text" data-key="9998"><span data-slate-leaf="true" data-offset-key="9998:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="9999"><span data-slate-leaf="true" data-offset-key="9999:0" data-first-offset="true"><span data-slate-string="true">{}{c, l.Level, l.CtxFielder, l.Formatter, l.Output}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10000"><span data-slate-object="text" data-key="10001"><span data-slate-leaf="true" data-offset-key="10001:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10002"><span data-slate-object="text" data-key="10003"><span data-slate-leaf="true" data-offset-key="10003:0" data-first-offset="true"><span data-slate-string="true">至于日志服务提供者的其他几个方法（Register、Boot、IsDefer、Name），就不在这里说明了，可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10004"><span data-slate-object="text" data-key="10005"><span data-slate-leaf="true" data-offset-key="10005:0" data-first-offset="true"><span data-slate-string="true">GitHub</span></span></span></a><span data-slate-object="text" data-key="10006"><span data-slate-leaf="true" data-offset-key="10006:0" data-first-offset="true"><span data-slate-string="true"> 上的代码。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10007" id="sr-toc-6"><span data-slate-object="text" data-key="10008"><span data-slate-leaf="true" data-offset-key="10008:0" data-first-offset="true"><span data-slate-string="true">日志服务的具体实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10009"><span data-slate-object="text" data-key="10010"><span data-slate-leaf="true" data-offset-key="10010:0" data-first-offset="true"><span data-slate-string="true">最后就到具体的日志服务的实现了。上面我们说，针对四种不同的输出方式，定义了四个不同的服务实例，</span></span></span><span data-slate-object="text" data-key="10011"><span data-slate-leaf="true" data-offset-key="10011:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这四个不同的服务实例都需要实现前面定义的日志服务协议。如果每个实例都实现一遍，还是非常麻烦的。这里可以使用一个技巧：类型嵌套</span></span></span></span><span data-slate-object="text" data-key="10012"><span data-slate-leaf="true" data-offset-key="10012:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10013"><span data-slate-object="text" data-key="10014"><span data-slate-leaf="true" data-offset-key="10014:0" data-first-offset="true"><span data-slate-string="true">我们先创建一个通用的服务实例 HadeLog，在 HadeLog 中存放通用的字段，比如上述日志服务提供者传递的五个参数：container、level、ctxFielder、formatter、output。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10015"><span data-slate-object="text" data-key="10016"><span data-slate-leaf="true" data-offset-key="10016:0" data-first-offset="true"><span data-slate-string="true">在 provider/log/services/log.go 中定义这个结构：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10017"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10018"><span data-slate-object="text" data-key="10019"><span data-slate-leaf="true" data-offset-key="10019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HadeLog 的通用实例</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10020"><span data-slate-object="text" data-key="10021"><span data-slate-leaf="true" data-offset-key="10021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="10022"><span data-slate-leaf="true" data-offset-key="10022:0" data-first-offset="true"><span data-slate-string="true"> HadeLog </span></span></span><span data-slate-object="text" data-key="10023"><span data-slate-leaf="true" data-offset-key="10023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="10024"><span data-slate-leaf="true" data-offset-key="10024:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10025"><span data-slate-object="text" data-key="10026"><span data-slate-leaf="true" data-offset-key="10026:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10027"><span data-slate-leaf="true" data-offset-key="10027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 五个必要参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10028"><span data-slate-object="text" data-key="10029"><span data-slate-leaf="true" data-offset-key="10029:0" data-first-offset="true"><span data-slate-string="true">   level      contract.LogLevel   </span></span></span><span data-slate-object="text" data-key="10030"><span data-slate-leaf="true" data-offset-key="10030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10031"><span data-slate-object="text" data-key="10032"><span data-slate-leaf="true" data-offset-key="10032:0" data-first-offset="true"><span data-slate-string="true">   formatter  contract.Formatter  </span></span></span><span data-slate-object="text" data-key="10033"><span data-slate-leaf="true" data-offset-key="10033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志格式化方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10034"><span data-slate-object="text" data-key="10035"><span data-slate-leaf="true" data-offset-key="10035:0" data-first-offset="true"><span data-slate-string="true">   ctxFielder contract.CtxFielder </span></span></span><span data-slate-object="text" data-key="10036"><span data-slate-leaf="true" data-offset-key="10036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//ctx 获取上下文字段</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10037"><span data-slate-object="text" data-key="10038"><span data-slate-leaf="true" data-offset-key="10038:0" data-first-offset="true"><span data-slate-string="true">   output     io.Writer           </span></span></span><span data-slate-object="text" data-key="10039"><span data-slate-leaf="true" data-offset-key="10039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10040"><span data-slate-object="text" data-key="10041"><span data-slate-leaf="true" data-offset-key="10041:0" data-first-offset="true"><span data-slate-string="true">   c          framework.Container </span></span></span><span data-slate-object="text" data-key="10042"><span data-slate-leaf="true" data-offset-key="10042:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 容器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10043"><span data-slate-object="text" data-key="10044"><span data-slate-leaf="true" data-offset-key="10044:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10045"><span data-slate-object="text" data-key="10046"><span data-slate-leaf="true" data-offset-key="10046:0" data-first-offset="true"><span data-slate-string="true">接着在通用实例中，使用这几个必要的参数，就能实现日志协议的所有接口了，这里展示了 Info 方法是怎么打印信息的：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10047"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10048"><span data-slate-object="text" data-key="10049"><span data-slate-leaf="true" data-offset-key="10049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Info 会打印出普通的日志信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10050"><span data-slate-object="text" data-key="10051"><span data-slate-leaf="true" data-offset-key="10051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="10052"><span data-slate-leaf="true" data-offset-key="10052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="10053"><span data-slate-leaf="true" data-offset-key="10053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(log *HadeLog)</span></span></span></span></span><span data-slate-object="text" data-key="10054"><span data-slate-leaf="true" data-offset-key="10054:0" data-first-offset="true"><span data-slate-string="true"> Info(ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="10055"><span data-slate-leaf="true" data-offset-key="10055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="10056"><span data-slate-leaf="true" data-offset-key="10056:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="10057"><span data-slate-leaf="true" data-offset-key="10057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="10058"><span data-slate-leaf="true" data-offset-key="10058:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="10059"><span data-slate-leaf="true" data-offset-key="10059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="10060"><span data-slate-leaf="true" data-offset-key="10060:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="10061"><span data-slate-leaf="true" data-offset-key="10061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="10062"><span data-slate-leaf="true" data-offset-key="10062:0" data-first-offset="true"><span data-slate-string="true">{}) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10063"><span data-slate-object="text" data-key="10064"><span data-slate-leaf="true" data-offset-key="10064:0" data-first-offset="true"><span data-slate-string="true">   log.logf(contract.InfoLevel, ctx, msg, fields)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10065"><span data-slate-object="text" data-key="10066"><span data-slate-leaf="true" data-offset-key="10066:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10067"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10068"><span data-slate-object="text" data-key="10069"><span data-slate-leaf="true" data-offset-key="10069:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//logf 为打印日志的核心函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10070"><span data-slate-object="text" data-key="10071"><span data-slate-leaf="true" data-offset-key="10071:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="10072"><span data-slate-leaf="true" data-offset-key="10072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="10073"><span data-slate-leaf="true" data-offset-key="10073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(log *HadeLog)</span></span></span></span></span><span data-slate-object="text" data-key="10074"><span data-slate-leaf="true" data-offset-key="10074:0" data-first-offset="true"><span data-slate-string="true"> logf(level contract.LogLevel, ctx context.Context, msg </span></span></span><span data-slate-object="text" data-key="10075"><span data-slate-leaf="true" data-offset-key="10075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="10076"><span data-slate-leaf="true" data-offset-key="10076:0" data-first-offset="true"><span data-slate-string="true">, fields </span></span></span><span data-slate-object="text" data-key="10077"><span data-slate-leaf="true" data-offset-key="10077:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="10078"><span data-slate-leaf="true" data-offset-key="10078:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="10079"><span data-slate-leaf="true" data-offset-key="10079:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="10080"><span data-slate-leaf="true" data-offset-key="10080:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="10081"><span data-slate-leaf="true" data-offset-key="10081:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="10082"><span data-slate-leaf="true" data-offset-key="10082:0" data-first-offset="true"><span data-slate-string="true">{}) </span></span></span><span data-slate-object="text" data-key="10083"><span data-slate-leaf="true" data-offset-key="10083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="10084"><span data-slate-leaf="true" data-offset-key="10084:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10085"><span data-slate-object="text" data-key="10086"><span data-slate-leaf="true" data-offset-key="10086:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10087"><span data-slate-leaf="true" data-offset-key="10087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 先判断日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10088"><span data-slate-object="text" data-key="10089"><span data-slate-leaf="true" data-offset-key="10089:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10090"><span data-slate-leaf="true" data-offset-key="10090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10091"><span data-slate-leaf="true" data-offset-key="10091:0" data-first-offset="true"><span data-slate-string="true"> !log.IsLevelEnable(level) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10092"><span data-slate-object="text" data-key="10093"><span data-slate-leaf="true" data-offset-key="10093:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10094"><span data-slate-leaf="true" data-offset-key="10094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10095"><span data-slate-leaf="true" data-offset-key="10095:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10096"><span data-slate-leaf="true" data-offset-key="10096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10097"><span data-slate-object="text" data-key="10098"><span data-slate-leaf="true" data-offset-key="10098:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10099"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10100"><span data-slate-object="text" data-key="10101"><span data-slate-leaf="true" data-offset-key="10101:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10102"><span data-slate-leaf="true" data-offset-key="10102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用 ctxFielder 获取 context 中的信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10103"><span data-slate-object="text" data-key="10104"><span data-slate-leaf="true" data-offset-key="10104:0" data-first-offset="true"><span data-slate-string="true">   fs := fields</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10105"><span data-slate-object="text" data-key="10106"><span data-slate-leaf="true" data-offset-key="10106:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10107"><span data-slate-leaf="true" data-offset-key="10107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10108"><span data-slate-leaf="true" data-offset-key="10108:0" data-first-offset="true"><span data-slate-string="true"> log.ctxFielder != </span></span></span><span data-slate-object="text" data-key="10109"><span data-slate-leaf="true" data-offset-key="10109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10110"><span data-slate-leaf="true" data-offset-key="10110:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10111"><span data-slate-object="text" data-key="10112"><span data-slate-leaf="true" data-offset-key="10112:0" data-first-offset="true"><span data-slate-string="true">      t := log.ctxFielder(ctx)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10113"><span data-slate-object="text" data-key="10114"><span data-slate-leaf="true" data-offset-key="10114:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10115"><span data-slate-leaf="true" data-offset-key="10115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10116"><span data-slate-leaf="true" data-offset-key="10116:0" data-first-offset="true"><span data-slate-string="true"> t != </span></span></span><span data-slate-object="text" data-key="10117"><span data-slate-leaf="true" data-offset-key="10117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10118"><span data-slate-leaf="true" data-offset-key="10118:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10119"><span data-slate-object="text" data-key="10120"><span data-slate-leaf="true" data-offset-key="10120:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="10121"><span data-slate-leaf="true" data-offset-key="10121:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="10122"><span data-slate-leaf="true" data-offset-key="10122:0" data-first-offset="true"><span data-slate-string="true"> k, v := </span></span></span><span data-slate-object="text" data-key="10123"><span data-slate-leaf="true" data-offset-key="10123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="10124"><span data-slate-leaf="true" data-offset-key="10124:0" data-first-offset="true"><span data-slate-string="true"> t {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10125"><span data-slate-object="text" data-key="10126"><span data-slate-leaf="true" data-offset-key="10126:0" data-first-offset="true"><span data-slate-string="true">            fs[k] = v</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10127"><span data-slate-object="text" data-key="10128"><span data-slate-leaf="true" data-offset-key="10128:0" data-first-offset="true"><span data-slate-string="true">         }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10129"><span data-slate-object="text" data-key="10130"><span data-slate-leaf="true" data-offset-key="10130:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10131"><span data-slate-object="text" data-key="10132"><span data-slate-leaf="true" data-offset-key="10132:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10133"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10134"><span data-slate-object="text" data-key="10135"><span data-slate-leaf="true" data-offset-key="10135:0" data-first-offset="true"><span data-slate-string="true">   ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10136"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10137"><span data-slate-object="text" data-key="10138"><span data-slate-leaf="true" data-offset-key="10138:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10139"><span data-slate-leaf="true" data-offset-key="10139:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将日志信息按照 formatter 序列化为字符串</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10140"><span data-slate-object="text" data-key="10141"><span data-slate-leaf="true" data-offset-key="10141:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10142"><span data-slate-leaf="true" data-offset-key="10142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10143"><span data-slate-leaf="true" data-offset-key="10143:0" data-first-offset="true"><span data-slate-string="true"> log.formatter == </span></span></span><span data-slate-object="text" data-key="10144"><span data-slate-leaf="true" data-offset-key="10144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10145"><span data-slate-leaf="true" data-offset-key="10145:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10146"><span data-slate-object="text" data-key="10147"><span data-slate-leaf="true" data-offset-key="10147:0" data-first-offset="true"><span data-slate-string="true">      log.formatter = formatter.TextFormatter</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10148"><span data-slate-object="text" data-key="10149"><span data-slate-leaf="true" data-offset-key="10149:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10150"><span data-slate-object="text" data-key="10151"><span data-slate-leaf="true" data-offset-key="10151:0" data-first-offset="true"><span data-slate-string="true">   ct, err := log.formatter(level, time.Now(), msg, fs)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10152"><span data-slate-object="text" data-key="10153"><span data-slate-leaf="true" data-offset-key="10153:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10154"><span data-slate-leaf="true" data-offset-key="10154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10155"><span data-slate-leaf="true" data-offset-key="10155:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="10156"><span data-slate-leaf="true" data-offset-key="10156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10157"><span data-slate-leaf="true" data-offset-key="10157:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10158"><span data-slate-object="text" data-key="10159"><span data-slate-leaf="true" data-offset-key="10159:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10160"><span data-slate-leaf="true" data-offset-key="10160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10161"><span data-slate-leaf="true" data-offset-key="10161:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10162"><span data-slate-object="text" data-key="10163"><span data-slate-leaf="true" data-offset-key="10163:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10164"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10165"><span data-slate-object="text" data-key="10166"><span data-slate-leaf="true" data-offset-key="10166:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10167"><span data-slate-leaf="true" data-offset-key="10167:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果是 panic 级别，则使用 log 进行 panic</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10168"><span data-slate-object="text" data-key="10169"><span data-slate-leaf="true" data-offset-key="10169:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10170"><span data-slate-leaf="true" data-offset-key="10170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10171"><span data-slate-leaf="true" data-offset-key="10171:0" data-first-offset="true"><span data-slate-string="true"> level == contract.PanicLevel {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10172"><span data-slate-object="text" data-key="10173"><span data-slate-leaf="true" data-offset-key="10173:0" data-first-offset="true"><span data-slate-string="true">      pkgLog.Panicln(</span></span></span><span data-slate-object="text" data-key="10174"><span data-slate-leaf="true" data-offset-key="10174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="10175"><span data-slate-leaf="true" data-offset-key="10175:0" data-first-offset="true"><span data-slate-string="true">(ct))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10176"><span data-slate-object="text" data-key="10177"><span data-slate-leaf="true" data-offset-key="10177:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10178"><span data-slate-leaf="true" data-offset-key="10178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10179"><span data-slate-leaf="true" data-offset-key="10179:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10180"><span data-slate-leaf="true" data-offset-key="10180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10181"><span data-slate-object="text" data-key="10182"><span data-slate-leaf="true" data-offset-key="10182:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10183"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10184"><span data-slate-object="text" data-key="10185"><span data-slate-leaf="true" data-offset-key="10185:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10186"><span data-slate-leaf="true" data-offset-key="10186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 通过 output 进行输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10187"><span data-slate-object="text" data-key="10188"><span data-slate-leaf="true" data-offset-key="10188:0" data-first-offset="true"><span data-slate-string="true">   log.output.Write(ct)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10189"><span data-slate-object="text" data-key="10190"><span data-slate-leaf="true" data-offset-key="10190:0" data-first-offset="true"><span data-slate-string="true">   log.output.Write([]</span></span></span><span data-slate-object="text" data-key="10191"><span data-slate-leaf="true" data-offset-key="10191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="10192"><span data-slate-leaf="true" data-offset-key="10192:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="10193"><span data-slate-leaf="true" data-offset-key="10193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"\r\n"</span></span></span></span><span data-slate-object="text" data-key="10194"><span data-slate-leaf="true" data-offset-key="10194:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10195"><span data-slate-object="text" data-key="10196"><span data-slate-leaf="true" data-offset-key="10196:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10197"><span data-slate-leaf="true" data-offset-key="10197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10198"><span data-slate-leaf="true" data-offset-key="10198:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10199"><span data-slate-leaf="true" data-offset-key="10199:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10200"><span data-slate-object="text" data-key="10201"><span data-slate-leaf="true" data-offset-key="10201:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10202"><span data-slate-object="text" data-key="10203"><span data-slate-leaf="true" data-offset-key="10203:0" data-first-offset="true"><span data-slate-string="true">可以看到，Info 打印最终调用 logf 方法，而 logf 方法的实现步骤也很清晰，简单梳理一下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10204"><div data-slate-type="list-line" data-slate-object="block" data-key="10205"><span data-slate-object="text" data-key="10206"><span data-slate-leaf="true" data-offset-key="10206:0" data-first-offset="true"><span data-slate-string="true">先判断日志级别是否符合要求，如果不符合要求，则直接返回，不进行打印；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10207"><span data-slate-object="text" data-key="10208"><span data-slate-leaf="true" data-offset-key="10208:0" data-first-offset="true"><span data-slate-string="true">再使用 ctxFielder，从 context 中获取信息放在上下文字段中；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10209"><span data-slate-object="text" data-key="10210"><span data-slate-leaf="true" data-offset-key="10210:0" data-first-offset="true"><span data-slate-string="true">接着将日志信息按照 formatter 序列化为字符串；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10211"><span data-slate-object="text" data-key="10212"><span data-slate-leaf="true" data-offset-key="10212:0" data-first-offset="true"><span data-slate-string="true">最后通过 output 进行输出。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10213"><span data-slate-object="text" data-key="10214"><span data-slate-leaf="true" data-offset-key="10214:0" data-first-offset="true"><span data-slate-string="true">HadeLog 其他方法的实现和 Info 大同小异，这里就不展示所有代码了。实现了基础的 HadeLog 实例，接下来，就实现对应的四个不同输出类型的实例 HadeConsoleLog、HadeSingleLog、HadeRotateLog、HadeCustomLog。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10215"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f2/a5/f2a9c4d54dyy468f00ce97f8888049a5.jpg?wh=1920x1080"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10216"><span data-slate-object="text" data-key="10217"><span data-slate-leaf="true" data-offset-key="10217:0" data-first-offset="true"><span data-slate-string="true">这里四个具体实例使用类型嵌套的方式，就能自动拥有 HadeLog 已经实现了的那些方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10218"><span data-slate-object="text" data-key="10219"><span data-slate-leaf="true" data-offset-key="10219:0" data-first-offset="true"><span data-slate-string="true">比如在 framework/provider/log/service/console.log 中，使用类型嵌套实现 HadeConsoleLog：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10220"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10221"><span data-slate-object="text" data-key="10222"><span data-slate-leaf="true" data-offset-key="10222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HadeConsoleLog 代表控制台输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10223"><span data-slate-object="text" data-key="10224"><span data-slate-leaf="true" data-offset-key="10224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="10225"><span data-slate-leaf="true" data-offset-key="10225:0" data-first-offset="true"><span data-slate-string="true"> HadeConsoleLog </span></span></span><span data-slate-object="text" data-key="10226"><span data-slate-leaf="true" data-offset-key="10226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="10227"><span data-slate-leaf="true" data-offset-key="10227:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10228"><span data-slate-object="text" data-key="10229"><span data-slate-leaf="true" data-offset-key="10229:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10230"><span data-slate-leaf="true" data-offset-key="10230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 类型嵌套 HadeLog</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10231"><span data-slate-object="text" data-key="10232"><span data-slate-leaf="true" data-offset-key="10232:0" data-first-offset="true"><span data-slate-string="true">   HadeLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10233"><span data-slate-object="text" data-key="10234"><span data-slate-leaf="true" data-offset-key="10234:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10235"><span data-slate-object="text" data-key="10236"><span data-slate-leaf="true" data-offset-key="10236:0" data-first-offset="true"><span data-slate-string="true">相当于 HadeConsoleLog 就已经实现了日志服务协议了。我们唯一要做的就是在实例化 HadeConosoleLog 的时候，将基础 HadeLog 中的通用字段进行填充。比如 HadeConsoleLog 最重要就是将输出类型 output 设置为控制台 os.stdout：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10237"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10238"><span data-slate-object="text" data-key="10239"><span data-slate-leaf="true" data-offset-key="10239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// NewHadeConsoleLog 实例化 HadeConsoleLog</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10240"><span data-slate-object="text" data-key="10241"><span data-slate-leaf="true" data-offset-key="10241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="10242"><span data-slate-leaf="true" data-offset-key="10242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="10243"><span data-slate-leaf="true" data-offset-key="10243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewHadeConsoleLog</span></span></span></span></span><span data-slate-object="text" data-key="10244"><span data-slate-leaf="true" data-offset-key="10244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(params ...</span></span></span></span></span><span data-slate-object="text" data-key="10245"><span data-slate-leaf="true" data-offset-key="10245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="10246"><span data-slate-leaf="true" data-offset-key="10246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="10247"><span data-slate-leaf="true" data-offset-key="10247:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="10248"><span data-slate-leaf="true" data-offset-key="10248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="10249"><span data-slate-leaf="true" data-offset-key="10249:0" data-first-offset="true"><span data-slate-string="true">{}, </span></span></span><span data-slate-object="text" data-key="10250"><span data-slate-leaf="true" data-offset-key="10250:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="10251"><span data-slate-leaf="true" data-offset-key="10251:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10252"><span data-slate-object="text" data-key="10253"><span data-slate-leaf="true" data-offset-key="10253:0" data-first-offset="true"><span data-slate-string="true">   c := params[</span></span></span><span data-slate-object="text" data-key="10254"><span data-slate-leaf="true" data-offset-key="10254:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="10255"><span data-slate-leaf="true" data-offset-key="10255:0" data-first-offset="true"><span data-slate-string="true">].(framework.Container)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10256"><span data-slate-object="text" data-key="10257"><span data-slate-leaf="true" data-offset-key="10257:0" data-first-offset="true"><span data-slate-string="true">   level := params[</span></span></span><span data-slate-object="text" data-key="10258"><span data-slate-leaf="true" data-offset-key="10258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="10259"><span data-slate-leaf="true" data-offset-key="10259:0" data-first-offset="true"><span data-slate-string="true">].(contract.LogLevel)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10260"><span data-slate-object="text" data-key="10261"><span data-slate-leaf="true" data-offset-key="10261:0" data-first-offset="true"><span data-slate-string="true">   ctxFielder := params[</span></span></span><span data-slate-object="text" data-key="10262"><span data-slate-leaf="true" data-offset-key="10262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="10263"><span data-slate-leaf="true" data-offset-key="10263:0" data-first-offset="true"><span data-slate-string="true">].(contract.CtxFielder)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10264"><span data-slate-object="text" data-key="10265"><span data-slate-leaf="true" data-offset-key="10265:0" data-first-offset="true"><span data-slate-string="true">   formatter := params[</span></span></span><span data-slate-object="text" data-key="10266"><span data-slate-leaf="true" data-offset-key="10266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="10267"><span data-slate-leaf="true" data-offset-key="10267:0" data-first-offset="true"><span data-slate-string="true">].(contract.Formatter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10268"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10269"><span data-slate-object="text" data-key="10270"><span data-slate-leaf="true" data-offset-key="10270:0" data-first-offset="true"><span data-slate-string="true">   log := &amp;HadeConsoleLog{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10271"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10272"><span data-slate-object="text" data-key="10273"><span data-slate-leaf="true" data-offset-key="10273:0" data-first-offset="true"><span data-slate-string="true">   log.SetLevel(level)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10274"><span data-slate-object="text" data-key="10275"><span data-slate-leaf="true" data-offset-key="10275:0" data-first-offset="true"><span data-slate-string="true">   log.SetCtxFielder(ctxFielder)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10276"><span data-slate-object="text" data-key="10277"><span data-slate-leaf="true" data-offset-key="10277:0" data-first-offset="true"><span data-slate-string="true">   log.SetFormatter(formatter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10278"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10279"><span data-slate-object="text" data-key="10280"><span data-slate-leaf="true" data-offset-key="10280:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10281"><span data-slate-leaf="true" data-offset-key="10281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 最重要的将内容输出到控制台</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10282"><span data-slate-object="text" data-key="10283"><span data-slate-leaf="true" data-offset-key="10283:0" data-first-offset="true"><span data-slate-string="true">   log.SetOutput(os.Stdout)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10284"><span data-slate-object="text" data-key="10285"><span data-slate-leaf="true" data-offset-key="10285:0" data-first-offset="true"><span data-slate-string="true">   log.c = c</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10286"><span data-slate-object="text" data-key="10287"><span data-slate-leaf="true" data-offset-key="10287:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10288"><span data-slate-leaf="true" data-offset-key="10288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10289"><span data-slate-leaf="true" data-offset-key="10289:0" data-first-offset="true"><span data-slate-string="true"> log, </span></span></span><span data-slate-object="text" data-key="10290"><span data-slate-leaf="true" data-offset-key="10290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10291"><span data-slate-object="text" data-key="10292"><span data-slate-leaf="true" data-offset-key="10292:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10293"><span data-slate-object="text" data-key="10294"><span data-slate-leaf="true" data-offset-key="10294:0" data-first-offset="true"><span data-slate-string="true">四种输出文件其实都大同小异，这里就挑选一个最复杂的带有日志切割的 HadeRotateLog 来讲解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10295"><span data-slate-object="text" data-key="10296"><span data-slate-leaf="true" data-offset-key="10296:0" data-first-offset="true"><span data-slate-string="true">Golang 中日志切割有个非常好用的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10297"><span data-slate-object="text" data-key="10298"><span data-slate-leaf="true" data-offset-key="10298:0" data-first-offset="true"><span data-slate-string="true">file-rotatelogs</span></span></span></a><span data-slate-object="text" data-key="10299"><span data-slate-leaf="true" data-offset-key="10299:0" data-first-offset="true"><span data-slate-string="true">，这个库的使用方法也不复杂，最核心的就是一个初始化操作 New：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10300"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10301"><span data-slate-object="text" data-key="10302"><span data-slate-leaf="true" data-offset-key="10302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="10303"><span data-slate-leaf="true" data-offset-key="10303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="10304"><span data-slate-leaf="true" data-offset-key="10304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">New</span></span></span></span></span><span data-slate-object="text" data-key="10305"><span data-slate-leaf="true" data-offset-key="10305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(p </span></span></span></span></span><span data-slate-object="text" data-key="10306"><span data-slate-leaf="true" data-offset-key="10306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="10307"><span data-slate-leaf="true" data-offset-key="10307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, options ...Option)</span></span></span></span></span><span data-slate-object="text" data-key="10308"><span data-slate-leaf="true" data-offset-key="10308:0" data-first-offset="true"><span data-slate-string="true"> (*RotateLogs, </span></span></span><span data-slate-object="text" data-key="10309"><span data-slate-leaf="true" data-offset-key="10309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="10310"><span data-slate-leaf="true" data-offset-key="10310:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10311"><span data-slate-object="text" data-key="10312"><span data-slate-leaf="true" data-offset-key="10312:0" data-first-offset="true"><span data-slate-string="true">它有两个参数，第一个参数 p 是带目录的日志地址，可以允许有通配符代表日期的日志文件名。这里的通配符符合 Linux 的 strftime 的定义，具体哪个通配符代表日期、小时、分钟等可以参考 strftime 的</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10313"><span data-slate-object="text" data-key="10314"><span data-slate-leaf="true" data-offset-key="10314:0" data-first-offset="true"><span data-slate-string="true">文档说明</span></span></span></a><span data-slate-object="text" data-key="10315"><span data-slate-leaf="true" data-offset-key="10315:0" data-first-offset="true"><span data-slate-string="true">。而第二个参数是 Option 数组，表示这个切割日志的一些配置，比如多久切割一次日志文件、切割后的日志文件保存多少天等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10316"><span data-slate-object="text" data-key="10317"><span data-slate-leaf="true" data-offset-key="10317:0" data-first-offset="true"><span data-slate-string="true">使用很简单，直接看我们对 HadeRotateLog 的具体实现。大致思路就是</span></span></span><span data-slate-object="text" data-key="10318"><span data-slate-leaf="true" data-offset-key="10318:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">先定义结构，再实现初始化方法，在初始化方法中，我们实例化 file-rotatelogs 的初始化操作 New</span></span></span></span><span data-slate-object="text" data-key="10319"><span data-slate-leaf="true" data-offset-key="10319:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10320"><span data-slate-object="text" data-key="10321"><span data-slate-leaf="true" data-offset-key="10321:0" data-first-offset="true"><span data-slate-string="true">首先定义了 HadeRotateLog 的结构，其中嵌套了基础实例结构 HadeLog，同时有这个结构特定的字段 folder 和 file：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10322"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10323"><span data-slate-object="text" data-key="10324"><span data-slate-leaf="true" data-offset-key="10324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// HadeRotateLog 代表会进行切割的日志文件存储</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10325"><span data-slate-object="text" data-key="10326"><span data-slate-leaf="true" data-offset-key="10326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="10327"><span data-slate-leaf="true" data-offset-key="10327:0" data-first-offset="true"><span data-slate-string="true"> HadeRotateLog </span></span></span><span data-slate-object="text" data-key="10328"><span data-slate-leaf="true" data-offset-key="10328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="10329"><span data-slate-leaf="true" data-offset-key="10329:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10330"><span data-slate-object="text" data-key="10331"><span data-slate-leaf="true" data-offset-key="10331:0" data-first-offset="true"><span data-slate-string="true">   HadeLog</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10332"><span data-slate-object="text" data-key="10333"><span data-slate-leaf="true" data-offset-key="10333:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10334"><span data-slate-leaf="true" data-offset-key="10334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志文件存储目录</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10335"><span data-slate-object="text" data-key="10336"><span data-slate-leaf="true" data-offset-key="10336:0" data-first-offset="true"><span data-slate-string="true">   folder </span></span></span><span data-slate-object="text" data-key="10337"><span data-slate-leaf="true" data-offset-key="10337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10338"><span data-slate-object="text" data-key="10339"><span data-slate-leaf="true" data-offset-key="10339:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10340"><span data-slate-leaf="true" data-offset-key="10340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 日志文件名</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10341"><span data-slate-object="text" data-key="10342"><span data-slate-leaf="true" data-offset-key="10342:0" data-first-offset="true"><span data-slate-string="true">   file </span></span></span><span data-slate-object="text" data-key="10343"><span data-slate-leaf="true" data-offset-key="10343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10344"><span data-slate-object="text" data-key="10345"><span data-slate-leaf="true" data-offset-key="10345:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10346"><span data-slate-object="text" data-key="10347"><span data-slate-leaf="true" data-offset-key="10347:0" data-first-offset="true"><span data-slate-string="true">实例化的 NewHadeRotateLog 先获取参数，然后从配置文件中获取参数属性 folder、file、date_format、rotate_count、rotate_size、max_age、rotate_time，这些属性都和 file-rotatelogs 库实例化的 Option 参数一一对应。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10348"><span data-slate-object="text" data-key="10349"><span data-slate-leaf="true" data-offset-key="10349:0" data-first-offset="true"><span data-slate-string="true">所以这里也展示一下我们的 log.yaml 配置文件可配置的 rotate：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="10350"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10351"><span data-slate-object="text" data-key="10352"><span data-slate-leaf="true" data-offset-key="10352:0" data-first-offset="true"><span data-slate-string="true">driver: rotate </span></span></span><span data-slate-object="text" data-key="10353"><span data-slate-leaf="true" data-offset-key="10353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 切割日志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10354"><span data-slate-object="text" data-key="10355"><span data-slate-leaf="true" data-offset-key="10355:0" data-first-offset="true"><span data-slate-string="true">level: trace </span></span></span><span data-slate-object="text" data-key="10356"><span data-slate-leaf="true" data-offset-key="10356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 日志级别</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10357"><span data-slate-object="text" data-key="10358"><span data-slate-leaf="true" data-offset-key="10358:0" data-first-offset="true"><span data-slate-string="true">file: coredemo.log </span></span></span><span data-slate-object="text" data-key="10359"><span data-slate-leaf="true" data-offset-key="10359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 保存的日志文件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10360"><span data-slate-object="text" data-key="10361"><span data-slate-leaf="true" data-offset-key="10361:0" data-first-offset="true"><span data-slate-string="true">rotate_count: </span></span></span><span data-slate-object="text" data-key="10362"><span data-slate-leaf="true" data-offset-key="10362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="10363"><span data-slate-leaf="true" data-offset-key="10363:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="10364"><span data-slate-leaf="true" data-offset-key="10364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 最多日志文件个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10365"><span data-slate-object="text" data-key="10366"><span data-slate-leaf="true" data-offset-key="10366:0" data-first-offset="true"><span data-slate-string="true">rotate_size: </span></span></span><span data-slate-object="text" data-key="10367"><span data-slate-leaf="true" data-offset-key="10367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">120000</span></span></span></span><span data-slate-object="text" data-key="10368"><span data-slate-leaf="true" data-offset-key="10368:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10369"><span data-slate-leaf="true" data-offset-key="10369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 每个日志大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10370"><span data-slate-object="text" data-key="10371"><span data-slate-leaf="true" data-offset-key="10371:0" data-first-offset="true"><span data-slate-string="true">rotate_time: </span></span></span><span data-slate-object="text" data-key="10372"><span data-slate-leaf="true" data-offset-key="10372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1m"</span></span></span></span><span data-slate-object="text" data-key="10373"><span data-slate-leaf="true" data-offset-key="10373:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10374"><span data-slate-leaf="true" data-offset-key="10374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 切割时间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10375"><span data-slate-object="text" data-key="10376"><span data-slate-leaf="true" data-offset-key="10376:0" data-first-offset="true"><span data-slate-string="true">max_age: </span></span></span><span data-slate-object="text" data-key="10377"><span data-slate-leaf="true" data-offset-key="10377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"10d"</span></span></span></span><span data-slate-object="text" data-key="10378"><span data-slate-leaf="true" data-offset-key="10378:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10379"><span data-slate-leaf="true" data-offset-key="10379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 文件保存时间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10380"><span data-slate-object="text" data-key="10381"><span data-slate-leaf="true" data-offset-key="10381:0" data-first-offset="true"><span data-slate-string="true">date_format: </span></span></span><span data-slate-object="text" data-key="10382"><span data-slate-leaf="true" data-offset-key="10382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%Y-%m-%d-%H-%M"</span></span></span></span><span data-slate-object="text" data-key="10383"><span data-slate-leaf="true" data-offset-key="10383:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10384"><span data-slate-leaf="true" data-offset-key="10384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 文件后缀格式</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10385"><span data-slate-object="text" data-key="10386"><span data-slate-leaf="true" data-offset-key="10386:0" data-first-offset="true"><span data-slate-string="true">再回到 NewHadeRotateLog，设置了这些配置属性之后，我们实例化 file-rotatelogs，得到了一个符合 io.Writer 的输出，将这个输出使用 SetOutput 设置到嵌套的 HadeLog 中即可。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="10387"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10388"><span data-slate-object="text" data-key="10389"><span data-slate-leaf="true" data-offset-key="10389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// NewHadeRotateLog 实例化 HadeRotateLog</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10390"><span data-slate-object="text" data-key="10391"><span data-slate-leaf="true" data-offset-key="10391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="10392"><span data-slate-leaf="true" data-offset-key="10392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="10393"><span data-slate-leaf="true" data-offset-key="10393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewHadeRotateLog</span></span></span></span></span><span data-slate-object="text" data-key="10394"><span data-slate-leaf="true" data-offset-key="10394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(params ...</span></span></span></span></span><span data-slate-object="text" data-key="10395"><span data-slate-leaf="true" data-offset-key="10395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="10396"><span data-slate-leaf="true" data-offset-key="10396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="10397"><span data-slate-leaf="true" data-offset-key="10397:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="10398"><span data-slate-leaf="true" data-offset-key="10398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="10399"><span data-slate-leaf="true" data-offset-key="10399:0" data-first-offset="true"><span data-slate-string="true">{}, </span></span></span><span data-slate-object="text" data-key="10400"><span data-slate-leaf="true" data-offset-key="10400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="10401"><span data-slate-leaf="true" data-offset-key="10401:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10402"><span data-slate-object="text" data-key="10403"><span data-slate-leaf="true" data-offset-key="10403:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10404"><span data-slate-leaf="true" data-offset-key="10404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 参数解析</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10405"><span data-slate-object="text" data-key="10406"><span data-slate-leaf="true" data-offset-key="10406:0" data-first-offset="true"><span data-slate-string="true">   c := params[</span></span></span><span data-slate-object="text" data-key="10407"><span data-slate-leaf="true" data-offset-key="10407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="10408"><span data-slate-leaf="true" data-offset-key="10408:0" data-first-offset="true"><span data-slate-string="true">].(framework.Container)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10409"><span data-slate-object="text" data-key="10410"><span data-slate-leaf="true" data-offset-key="10410:0" data-first-offset="true"><span data-slate-string="true">   level := params[</span></span></span><span data-slate-object="text" data-key="10411"><span data-slate-leaf="true" data-offset-key="10411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="10412"><span data-slate-leaf="true" data-offset-key="10412:0" data-first-offset="true"><span data-slate-string="true">].(contract.LogLevel)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10413"><span data-slate-object="text" data-key="10414"><span data-slate-leaf="true" data-offset-key="10414:0" data-first-offset="true"><span data-slate-string="true">   ctxFielder := params[</span></span></span><span data-slate-object="text" data-key="10415"><span data-slate-leaf="true" data-offset-key="10415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="10416"><span data-slate-leaf="true" data-offset-key="10416:0" data-first-offset="true"><span data-slate-string="true">].(contract.CtxFielder)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10417"><span data-slate-object="text" data-key="10418"><span data-slate-leaf="true" data-offset-key="10418:0" data-first-offset="true"><span data-slate-string="true">   formatter := params[</span></span></span><span data-slate-object="text" data-key="10419"><span data-slate-leaf="true" data-offset-key="10419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="10420"><span data-slate-leaf="true" data-offset-key="10420:0" data-first-offset="true"><span data-slate-string="true">].(contract.Formatter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10421"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10422"><span data-slate-object="text" data-key="10423"><span data-slate-leaf="true" data-offset-key="10423:0" data-first-offset="true"><span data-slate-string="true">   appService := c.MustMake(contract.AppKey).(contract.App)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10424"><span data-slate-object="text" data-key="10425"><span data-slate-leaf="true" data-offset-key="10425:0" data-first-offset="true"><span data-slate-string="true">   configService := c.MustMake(contract.ConfigKey).(contract.Config)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10426"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10427"><span data-slate-object="text" data-key="10428"><span data-slate-leaf="true" data-offset-key="10428:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10429"><span data-slate-leaf="true" data-offset-key="10429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件中获取 folder 信息，否则使用默认的 LogFolder 文件夹</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10430"><span data-slate-object="text" data-key="10431"><span data-slate-leaf="true" data-offset-key="10431:0" data-first-offset="true"><span data-slate-string="true">   folder := appService.LogFolder()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10432"><span data-slate-object="text" data-key="10433"><span data-slate-leaf="true" data-offset-key="10433:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10434"><span data-slate-leaf="true" data-offset-key="10434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10435"><span data-slate-leaf="true" data-offset-key="10435:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10436"><span data-slate-leaf="true" data-offset-key="10436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.folder"</span></span></span></span><span data-slate-object="text" data-key="10437"><span data-slate-leaf="true" data-offset-key="10437:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10438"><span data-slate-object="text" data-key="10439"><span data-slate-leaf="true" data-offset-key="10439:0" data-first-offset="true"><span data-slate-string="true">      folder = configService.GetString(</span></span></span><span data-slate-object="text" data-key="10440"><span data-slate-leaf="true" data-offset-key="10440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.folder"</span></span></span></span><span data-slate-object="text" data-key="10441"><span data-slate-leaf="true" data-offset-key="10441:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10442"><span data-slate-object="text" data-key="10443"><span data-slate-leaf="true" data-offset-key="10443:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10444"><span data-slate-object="text" data-key="10445"><span data-slate-leaf="true" data-offset-key="10445:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10446"><span data-slate-leaf="true" data-offset-key="10446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果 folder 不存在，则创建</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10447"><span data-slate-object="text" data-key="10448"><span data-slate-leaf="true" data-offset-key="10448:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10449"><span data-slate-leaf="true" data-offset-key="10449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10450"><span data-slate-leaf="true" data-offset-key="10450:0" data-first-offset="true"><span data-slate-string="true"> !util.Exists(folder) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10451"><span data-slate-object="text" data-key="10452"><span data-slate-leaf="true" data-offset-key="10452:0" data-first-offset="true"><span data-slate-string="true">      os.MkdirAll(folder, os.ModePerm)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10453"><span data-slate-object="text" data-key="10454"><span data-slate-leaf="true" data-offset-key="10454:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10455"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10456"><span data-slate-object="text" data-key="10457"><span data-slate-leaf="true" data-offset-key="10457:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10458"><span data-slate-leaf="true" data-offset-key="10458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件中获取 file 信息，否则使用默认的 hade.log</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10459"><span data-slate-object="text" data-key="10460"><span data-slate-leaf="true" data-offset-key="10460:0" data-first-offset="true"><span data-slate-string="true">   file := </span></span></span><span data-slate-object="text" data-key="10461"><span data-slate-leaf="true" data-offset-key="10461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hade.log"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10462"><span data-slate-object="text" data-key="10463"><span data-slate-leaf="true" data-offset-key="10463:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10464"><span data-slate-leaf="true" data-offset-key="10464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10465"><span data-slate-leaf="true" data-offset-key="10465:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10466"><span data-slate-leaf="true" data-offset-key="10466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.file"</span></span></span></span><span data-slate-object="text" data-key="10467"><span data-slate-leaf="true" data-offset-key="10467:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10468"><span data-slate-object="text" data-key="10469"><span data-slate-leaf="true" data-offset-key="10469:0" data-first-offset="true"><span data-slate-string="true">      file = configService.GetString(</span></span></span><span data-slate-object="text" data-key="10470"><span data-slate-leaf="true" data-offset-key="10470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.file"</span></span></span></span><span data-slate-object="text" data-key="10471"><span data-slate-leaf="true" data-offset-key="10471:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10472"><span data-slate-object="text" data-key="10473"><span data-slate-leaf="true" data-offset-key="10473:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10474"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10475"><span data-slate-object="text" data-key="10476"><span data-slate-leaf="true" data-offset-key="10476:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10477"><span data-slate-leaf="true" data-offset-key="10477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件获取 date_format 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10478"><span data-slate-object="text" data-key="10479"><span data-slate-leaf="true" data-offset-key="10479:0" data-first-offset="true"><span data-slate-string="true">   dateFormat := </span></span></span><span data-slate-object="text" data-key="10480"><span data-slate-leaf="true" data-offset-key="10480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%Y%m%d%H"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10481"><span data-slate-object="text" data-key="10482"><span data-slate-leaf="true" data-offset-key="10482:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10483"><span data-slate-leaf="true" data-offset-key="10483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10484"><span data-slate-leaf="true" data-offset-key="10484:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10485"><span data-slate-leaf="true" data-offset-key="10485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.date_format"</span></span></span></span><span data-slate-object="text" data-key="10486"><span data-slate-leaf="true" data-offset-key="10486:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10487"><span data-slate-object="text" data-key="10488"><span data-slate-leaf="true" data-offset-key="10488:0" data-first-offset="true"><span data-slate-string="true">      dateFormat = configService.GetString(</span></span></span><span data-slate-object="text" data-key="10489"><span data-slate-leaf="true" data-offset-key="10489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.date_format"</span></span></span></span><span data-slate-object="text" data-key="10490"><span data-slate-leaf="true" data-offset-key="10490:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10491"><span data-slate-object="text" data-key="10492"><span data-slate-leaf="true" data-offset-key="10492:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10493"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10494"><span data-slate-object="text" data-key="10495"><span data-slate-leaf="true" data-offset-key="10495:0" data-first-offset="true"><span data-slate-string="true">   linkName := rotatelogs.WithLinkName(filepath.Join(folder, file))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10496"><span data-slate-object="text" data-key="10497"><span data-slate-leaf="true" data-offset-key="10497:0" data-first-offset="true"><span data-slate-string="true">   options := []rotatelogs.Option{linkName}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10498"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10499"><span data-slate-object="text" data-key="10500"><span data-slate-leaf="true" data-offset-key="10500:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10501"><span data-slate-leaf="true" data-offset-key="10501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件获取 rotate_count 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10502"><span data-slate-object="text" data-key="10503"><span data-slate-leaf="true" data-offset-key="10503:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10504"><span data-slate-leaf="true" data-offset-key="10504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10505"><span data-slate-leaf="true" data-offset-key="10505:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10506"><span data-slate-leaf="true" data-offset-key="10506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_count"</span></span></span></span><span data-slate-object="text" data-key="10507"><span data-slate-leaf="true" data-offset-key="10507:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10508"><span data-slate-object="text" data-key="10509"><span data-slate-leaf="true" data-offset-key="10509:0" data-first-offset="true"><span data-slate-string="true">      rotateCount := configService.GetInt(</span></span></span><span data-slate-object="text" data-key="10510"><span data-slate-leaf="true" data-offset-key="10510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_count"</span></span></span></span><span data-slate-object="text" data-key="10511"><span data-slate-leaf="true" data-offset-key="10511:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10512"><span data-slate-object="text" data-key="10513"><span data-slate-leaf="true" data-offset-key="10513:0" data-first-offset="true"><span data-slate-string="true">      options = </span></span></span><span data-slate-object="text" data-key="10514"><span data-slate-leaf="true" data-offset-key="10514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="10515"><span data-slate-leaf="true" data-offset-key="10515:0" data-first-offset="true"><span data-slate-string="true">(options, rotatelogs.WithRotationCount(</span></span></span><span data-slate-object="text" data-key="10516"><span data-slate-leaf="true" data-offset-key="10516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span><span data-slate-object="text" data-key="10517"><span data-slate-leaf="true" data-offset-key="10517:0" data-first-offset="true"><span data-slate-string="true">(rotateCount)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10518"><span data-slate-object="text" data-key="10519"><span data-slate-leaf="true" data-offset-key="10519:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10520"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10521"><span data-slate-object="text" data-key="10522"><span data-slate-leaf="true" data-offset-key="10522:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10523"><span data-slate-leaf="true" data-offset-key="10523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件获取 rotate_size 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10524"><span data-slate-object="text" data-key="10525"><span data-slate-leaf="true" data-offset-key="10525:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10526"><span data-slate-leaf="true" data-offset-key="10526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10527"><span data-slate-leaf="true" data-offset-key="10527:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10528"><span data-slate-leaf="true" data-offset-key="10528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_size"</span></span></span></span><span data-slate-object="text" data-key="10529"><span data-slate-leaf="true" data-offset-key="10529:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10530"><span data-slate-object="text" data-key="10531"><span data-slate-leaf="true" data-offset-key="10531:0" data-first-offset="true"><span data-slate-string="true">      rotateSize := configService.GetInt(</span></span></span><span data-slate-object="text" data-key="10532"><span data-slate-leaf="true" data-offset-key="10532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_size"</span></span></span></span><span data-slate-object="text" data-key="10533"><span data-slate-leaf="true" data-offset-key="10533:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10534"><span data-slate-object="text" data-key="10535"><span data-slate-leaf="true" data-offset-key="10535:0" data-first-offset="true"><span data-slate-string="true">      options = </span></span></span><span data-slate-object="text" data-key="10536"><span data-slate-leaf="true" data-offset-key="10536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="10537"><span data-slate-leaf="true" data-offset-key="10537:0" data-first-offset="true"><span data-slate-string="true">(options, rotatelogs.WithRotationSize(</span></span></span><span data-slate-object="text" data-key="10538"><span data-slate-leaf="true" data-offset-key="10538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="10539"><span data-slate-leaf="true" data-offset-key="10539:0" data-first-offset="true"><span data-slate-string="true">(rotateSize)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10540"><span data-slate-object="text" data-key="10541"><span data-slate-leaf="true" data-offset-key="10541:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10542"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10543"><span data-slate-object="text" data-key="10544"><span data-slate-leaf="true" data-offset-key="10544:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10545"><span data-slate-leaf="true" data-offset-key="10545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件获取 max_age 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10546"><span data-slate-object="text" data-key="10547"><span data-slate-leaf="true" data-offset-key="10547:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10548"><span data-slate-leaf="true" data-offset-key="10548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10549"><span data-slate-leaf="true" data-offset-key="10549:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10550"><span data-slate-leaf="true" data-offset-key="10550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.max_age"</span></span></span></span><span data-slate-object="text" data-key="10551"><span data-slate-leaf="true" data-offset-key="10551:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10552"><span data-slate-object="text" data-key="10553"><span data-slate-leaf="true" data-offset-key="10553:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10554"><span data-slate-leaf="true" data-offset-key="10554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10555"><span data-slate-leaf="true" data-offset-key="10555:0" data-first-offset="true"><span data-slate-string="true"> maxAgeParse, err := time.ParseDuration(configService.GetString(</span></span></span><span data-slate-object="text" data-key="10556"><span data-slate-leaf="true" data-offset-key="10556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.max_age"</span></span></span></span><span data-slate-object="text" data-key="10557"><span data-slate-leaf="true" data-offset-key="10557:0" data-first-offset="true"><span data-slate-string="true">)); err == </span></span></span><span data-slate-object="text" data-key="10558"><span data-slate-leaf="true" data-offset-key="10558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10559"><span data-slate-leaf="true" data-offset-key="10559:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10560"><span data-slate-object="text" data-key="10561"><span data-slate-leaf="true" data-offset-key="10561:0" data-first-offset="true"><span data-slate-string="true">         options = </span></span></span><span data-slate-object="text" data-key="10562"><span data-slate-leaf="true" data-offset-key="10562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="10563"><span data-slate-leaf="true" data-offset-key="10563:0" data-first-offset="true"><span data-slate-string="true">(options, rotatelogs.WithMaxAge(maxAgeParse))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10564"><span data-slate-object="text" data-key="10565"><span data-slate-leaf="true" data-offset-key="10565:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10566"><span data-slate-object="text" data-key="10567"><span data-slate-leaf="true" data-offset-key="10567:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10568"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10569"><span data-slate-object="text" data-key="10570"><span data-slate-leaf="true" data-offset-key="10570:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10571"><span data-slate-leaf="true" data-offset-key="10571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从配置文件获取 rotate_time 信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10572"><span data-slate-object="text" data-key="10573"><span data-slate-leaf="true" data-offset-key="10573:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10574"><span data-slate-leaf="true" data-offset-key="10574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10575"><span data-slate-leaf="true" data-offset-key="10575:0" data-first-offset="true"><span data-slate-string="true"> configService.IsExist(</span></span></span><span data-slate-object="text" data-key="10576"><span data-slate-leaf="true" data-offset-key="10576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_time"</span></span></span></span><span data-slate-object="text" data-key="10577"><span data-slate-leaf="true" data-offset-key="10577:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10578"><span data-slate-object="text" data-key="10579"><span data-slate-leaf="true" data-offset-key="10579:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10580"><span data-slate-leaf="true" data-offset-key="10580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10581"><span data-slate-leaf="true" data-offset-key="10581:0" data-first-offset="true"><span data-slate-string="true"> rotateTimeParse, err := time.ParseDuration(configService.GetString(</span></span></span><span data-slate-object="text" data-key="10582"><span data-slate-leaf="true" data-offset-key="10582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"log.rotate_time"</span></span></span></span><span data-slate-object="text" data-key="10583"><span data-slate-leaf="true" data-offset-key="10583:0" data-first-offset="true"><span data-slate-string="true">)); err == </span></span></span><span data-slate-object="text" data-key="10584"><span data-slate-leaf="true" data-offset-key="10584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10585"><span data-slate-leaf="true" data-offset-key="10585:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10586"><span data-slate-object="text" data-key="10587"><span data-slate-leaf="true" data-offset-key="10587:0" data-first-offset="true"><span data-slate-string="true">         options = </span></span></span><span data-slate-object="text" data-key="10588"><span data-slate-leaf="true" data-offset-key="10588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="10589"><span data-slate-leaf="true" data-offset-key="10589:0" data-first-offset="true"><span data-slate-string="true">(options, rotatelogs.WithRotationTime(rotateTimeParse))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10590"><span data-slate-object="text" data-key="10591"><span data-slate-leaf="true" data-offset-key="10591:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10592"><span data-slate-object="text" data-key="10593"><span data-slate-leaf="true" data-offset-key="10593:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10594"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10595"><span data-slate-object="text" data-key="10596"><span data-slate-leaf="true" data-offset-key="10596:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10597"><span data-slate-leaf="true" data-offset-key="10597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置基础信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10598"><span data-slate-object="text" data-key="10599"><span data-slate-leaf="true" data-offset-key="10599:0" data-first-offset="true"><span data-slate-string="true">   log := &amp;HadeRotateLog{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10600"><span data-slate-object="text" data-key="10601"><span data-slate-leaf="true" data-offset-key="10601:0" data-first-offset="true"><span data-slate-string="true">   log.SetLevel(level)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10602"><span data-slate-object="text" data-key="10603"><span data-slate-leaf="true" data-offset-key="10603:0" data-first-offset="true"><span data-slate-string="true">   log.SetCtxFielder(ctxFielder)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10604"><span data-slate-object="text" data-key="10605"><span data-slate-leaf="true" data-offset-key="10605:0" data-first-offset="true"><span data-slate-string="true">   log.SetFormatter(formatter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10606"><span data-slate-object="text" data-key="10607"><span data-slate-leaf="true" data-offset-key="10607:0" data-first-offset="true"><span data-slate-string="true">   log.folder = folder</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10608"><span data-slate-object="text" data-key="10609"><span data-slate-leaf="true" data-offset-key="10609:0" data-first-offset="true"><span data-slate-string="true">   log.file = file</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10610"></div><div data-slate-type="code-line" data-slate-object="block" data-key="10611"><span data-slate-object="text" data-key="10612"><span data-slate-leaf="true" data-offset-key="10612:0" data-first-offset="true"><span data-slate-string="true">   w, err := rotatelogs.New(fmt.Sprintf(</span></span></span><span data-slate-object="text" data-key="10613"><span data-slate-leaf="true" data-offset-key="10613:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%s.%s"</span></span></span></span><span data-slate-object="text" data-key="10614"><span data-slate-leaf="true" data-offset-key="10614:0" data-first-offset="true"><span data-slate-string="true">, filepath.Join(log.folder, log.file), dateFormat), options...)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10615"><span data-slate-object="text" data-key="10616"><span data-slate-leaf="true" data-offset-key="10616:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10617"><span data-slate-leaf="true" data-offset-key="10617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="10618"><span data-slate-leaf="true" data-offset-key="10618:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="10619"><span data-slate-leaf="true" data-offset-key="10619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10620"><span data-slate-leaf="true" data-offset-key="10620:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10621"><span data-slate-object="text" data-key="10622"><span data-slate-leaf="true" data-offset-key="10622:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="10623"><span data-slate-leaf="true" data-offset-key="10623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10624"><span data-slate-leaf="true" data-offset-key="10624:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10625"><span data-slate-leaf="true" data-offset-key="10625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="10626"><span data-slate-leaf="true" data-offset-key="10626:0" data-first-offset="true"><span data-slate-string="true">, errors.Wrap(err, </span></span></span><span data-slate-object="text" data-key="10627"><span data-slate-leaf="true" data-offset-key="10627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"new rotatelogs error"</span></span></span></span><span data-slate-object="text" data-key="10628"><span data-slate-leaf="true" data-offset-key="10628:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10629"><span data-slate-object="text" data-key="10630"><span data-slate-leaf="true" data-offset-key="10630:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10631"><span data-slate-object="text" data-key="10632"><span data-slate-leaf="true" data-offset-key="10632:0" data-first-offset="true"><span data-slate-string="true">   log.SetOutput(w)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10633"><span data-slate-object="text" data-key="10634"><span data-slate-leaf="true" data-offset-key="10634:0" data-first-offset="true"><span data-slate-string="true">   log.c = c</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10635"><span data-slate-object="text" data-key="10636"><span data-slate-leaf="true" data-offset-key="10636:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="10637"><span data-slate-leaf="true" data-offset-key="10637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="10638"><span data-slate-leaf="true" data-offset-key="10638:0" data-first-offset="true"><span data-slate-string="true"> log, </span></span></span><span data-slate-object="text" data-key="10639"><span data-slate-leaf="true" data-offset-key="10639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10640"><span data-slate-object="text" data-key="10641"><span data-slate-leaf="true" data-offset-key="10641:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10642"><span data-slate-object="text" data-key="10643"><span data-slate-leaf="true" data-offset-key="10643:0" data-first-offset="true"><span data-slate-string="true">本节课我们只是修改了框架目录中的日志服务相关的文件。文件目录：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10644"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/8c/a8/8c305493bba44f8787efecdf1a8694a8.png?wh=404x512"></div></div><div data-slate-type="image" data-slate-object="block" data-key="10645"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/e7/2e/e78a3a67060e989616fa0440bd792d2e.png?wh=630x1122" style="width: auto;"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10646"><span data-slate-object="text" data-key="10647"><span data-slate-leaf="true" data-offset-key="10647:0" data-first-offset="true"><span data-slate-string="true">所有代码都放在 GitHub 上的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10648"><span data-slate-object="text" data-key="10649"><span data-slate-leaf="true" data-offset-key="10649:0" data-first-offset="true"><span data-slate-string="true">geekbang/17</span></span></span></a><span data-slate-object="text" data-key="10650"><span data-slate-leaf="true" data-offset-key="10650:0" data-first-offset="true"><span data-slate-string="true"> 分支，欢迎比对查看。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10651" id="sr-toc-7"><span data-slate-object="text" data-key="10652"><span data-slate-leaf="true" data-offset-key="10652:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10653"><span data-slate-object="text" data-key="10654"><span data-slate-leaf="true" data-offset-key="10654:0" data-first-offset="true"><span data-slate-string="true">我们这节课通过定义了日志级别、日志格式、日志输出，来实现了日志的级别，并且使用类型嵌套方法实现了四种本地日志输出方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10655"><span data-slate-object="text" data-key="10656"><span data-slate-leaf="true" data-offset-key="10656:0" data-first-offset="true"><span data-slate-string="true">回顾今天实现的日志服务，你会发现和其他服务的实现思路是差不多的。我们</span></span></span><span data-slate-object="text" data-key="10657"><span data-slate-leaf="true" data-offset-key="10657:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在一个服务中，实现了多个实现类，但是所有的实现类都实现了同样的服务接口</span></span></span></span><span data-slate-object="text" data-key="10658"><span data-slate-leaf="true" data-offset-key="10658:0" data-first-offset="true"><span data-slate-string="true">，最后能让我们根据配置来决定这个服务使用哪个实现类，其中还使用了嵌套方式，能节省大量重复性的代码。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10659"><span data-slate-object="text" data-key="10660"><span data-slate-leaf="true" data-offset-key="10660:0" data-first-offset="true"><span data-slate-string="true">希望你能熟练掌握这种实现方式，因为我们的服务会越来越多，越上层的服务，比如数据库、缓存，它的具体实现就越是多种多样，到时候我们都可以用同样的套路来进行。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10661" id="sr-toc-8"><span data-slate-object="text" data-key="10662"><span data-slate-leaf="true" data-offset-key="10662:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10663"><span data-slate-object="text" data-key="10664"><span data-slate-leaf="true" data-offset-key="10664:0" data-first-offset="true"><span data-slate-string="true">在微服务盛行的今天，全链路日志是非常重要的一个需求。全链路日志的需求本质就是在日志中增加 trace_id、span_id 这样的链路字段。具体实现有三点：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10665"><div data-slate-type="list-line" data-slate-object="block" data-key="10666"><span data-slate-object="text" data-key="10667"><span data-slate-leaf="true" data-offset-key="10667:0" data-first-offset="true"><span data-slate-string="true">在接收请求的时候，从请求 request 中解析全链路字段，存放进入 context 中</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10668"><span data-slate-object="text" data-key="10669"><span data-slate-leaf="true" data-offset-key="10669:0" data-first-offset="true"><span data-slate-string="true">在打印日志的时候从 context 中获取全链路字段序列化进入日志</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10670"><span data-slate-object="text" data-key="10671"><span data-slate-leaf="true" data-offset-key="10671:0" data-first-offset="true"><span data-slate-string="true">在发送请求的时候将全链路字段加入到 request 中</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10672"><span data-slate-object="text" data-key="10673"><span data-slate-leaf="true" data-offset-key="10673:0" data-first-offset="true"><span data-slate-string="true">你可以思考下这个功能应该怎么实现？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10674"><span data-slate-object="text" data-key="10675"><span data-slate-leaf="true" data-offset-key="10675:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区分享你的思考。感谢你的收听，如果觉得有收获，也欢迎把今天的内容分享给你身边的朋友，邀他一起学习。我们下节课见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-9">精选留言 (5)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>qinsi</span></div></div><div>接收下游请求和返回响应时打印日志可以在中间件中解决，向上游发送请求时打印日志可能需要框架提供一种方法截获请求并向其中注入 trace 信息，或者是自行封装一个 http 请求服务</div><div><p>作者回复：是的，一般是在中间件中解决</p></div><div><div>2021-10-25</div><div><div><i></i><span>3</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/0d/06/970cc957.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Charles</span></div></div><div>日志输出的原理讲的很细，受益匪浅。用作者的源码切换日志输出类型咋没有效果</div><div><div>2022-04-10</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo0z990grziaq7U71fqERjUBGPYVxns2yTCVicYClEK2BicmZYVnQ3w8iaAiaYHacLZtSpibrRfjQy0ZsQg/132"></div></div><div><div><div><span>Geek_78dacc</span></div></div><div>将 log.SetOutput 设置为文件，程序中正常的 info，debug 日志都可以记录至该文件中。但是当程序出现 panic 时，却不能记录 panic 日志。请问这个是为什么呀？除了在每次 go func（）时，手动捕捉 panic 并显式打印日志外，还有什么更加优雅的解决方案吗？</div><div><div>2022-02-24</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/e2/c0/e7a59706.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>chongsheng</span></div></div><div>这块貌似没有实现配置热更新。常见的需求是日志级别的热更新</div><div><div>2022-02-22</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/cb/07/482b7155.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>牛玉富</span></div></div><div>定制化的日志功能就得像这样，把每个细节都展开梳理清了才能动手。对日志感触挺深的是调用了个第三方类库修改麻烦至极。索性最后自己实现了。</div><div><div>2022-01-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".y"><outline class="toc-level-h1" data-reactid=".y.0" style="width: 175px;"><active data-reactid=".y.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".y.0.1"><span data-reactid=".y.0.1.0">17｜日志：如何设计多输出的日志服务？</span></a></outline><outline class="toc-level-h2" data-reactid=".y.1" style="width: 165px;"><active data-reactid=".y.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".y.1.1"><span data-reactid=".y.1.1.0">日志接口协议</span></a></outline><outline class="toc-level-h3" data-reactid=".y.2" style="width: 155px;"><active data-reactid=".y.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".y.2.1"><span data-reactid=".y.2.1.0">日志级别</span></a></outline><outline class="toc-level-h3" data-reactid=".y.3" style="width: 155px;"><active data-reactid=".y.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".y.3.1"><span data-reactid=".y.3.1.0">日志格式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.4" style="width: 155px;"><active data-reactid=".y.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".y.4.1"><span data-reactid=".y.4.1.0">日志输出</span></a></outline><outline class="toc-level-h2" data-reactid=".y.5" style="width: 165px;"><active data-reactid=".y.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".y.5.1"><span data-reactid=".y.5.1.0">日志服务提供者</span></a></outline><outline class="toc-level-h2" data-reactid=".y.6" style="width: 165px;"><active data-reactid=".y.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".y.6.1"><span data-reactid=".y.6.1.0">日志服务的具体实现</span></a></outline><outline class="toc-level-h2" data-reactid=".y.7" style="width: 165px;"><active data-reactid=".y.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".y.7.1"><span data-reactid=".y.7.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".y.8" style="width: 165px;"><active data-reactid=".y.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".y.8.1"><span data-reactid=".y.8.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".y.9" style="width: 165px;"><active data-reactid=".y.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".y.9.1"><span data-reactid=".y.9.1.0">精选留言 (5)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/429685" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>