
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 10 | 如何使用异步设计提升系统性能？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>10 | 如何使用异步设计提升系统性能？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">带着问题去读源码，最好是带着问题的答案去读源码。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">10 | 如何使用异步设计提升系统性能？</h1><div><span>李玥</span> <span> 2019-08-13</span></div><div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/6b/4a/6b47e013291135c443cc7b62b30f0a4a.jpg" style="width: auto;"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：李玥</span><span>大小：11.55M</span><span> 时长：12:37</span></div></div><audio title="10 | 如何使用异步设计提升系统性能？" src="https://res001.geekbang.org//media/audio/c8/88/c811b40c9ad58aa9cd0b73ad07cc8888/ld/ld.m3u8" __idm_id__="1646606"></audio></div><div><div><div><div data-slate-editor="true" data-key="2487" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="2488"><span data-slate-object="text" data-key="2489"><span data-slate-leaf="true" data-offset-key="2489:0" data-first-offset="true"><span data-slate-string="true">你好，我是李玥，这一讲我们来聊一聊异步。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2490"><span data-slate-object="text" data-key="2491"><span data-slate-leaf="true" data-offset-key="2491:0" data-first-offset="true"><span data-slate-string="true">对于开发者来说，异步是一种程序设计的思想，使用异步模式设计的程序可以显著减少线程等待，从而在高吞吐量的场景中，极大提升系统的整体性能，显著降低时延。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2492"><span data-slate-object="text" data-key="2493"><span data-slate-leaf="true" data-offset-key="2493:0" data-first-offset="true"><span data-slate-string="true">因此，像消息队列这种需要超高吞吐量和超低时延的中间件系统，在其核心流程中，一定会大量采用异步的设计思想。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2494"><span data-slate-object="text" data-key="2495"><span data-slate-leaf="true" data-offset-key="2495:0" data-first-offset="true"><span data-slate-string="true">接下来，我们一起来通过一个非常简单的例子学习一下，使用异步设计是如何提升系统性能的。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2496" id="sr-toc-1"><span data-slate-object="text" data-key="2497"><span data-slate-leaf="true" data-offset-key="2497:0" data-first-offset="true"><span data-slate-string="true">异步设计如何提升系统性能？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2498"><span data-slate-object="text" data-key="2499"><span data-slate-leaf="true" data-offset-key="2499:0" data-first-offset="true"><span data-slate-string="true">假设我们要实现一个转账的微服务 Transfer (accountFrom, accountTo, amount)，这个服务有三个参数：分别是转出账户、转入账户和转账金额。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2500"><span data-slate-object="text" data-key="2501"><span data-slate-leaf="true" data-offset-key="2501:0" data-first-offset="true"><span data-slate-string="true">实现过程也比较简单，我们要从账户 A 中转账 100 元到账户 B 中：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="2502"><div data-slate-type="list-line" data-slate-object="block" data-key="2503"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="2504"><span data-slate-leaf="true" data-offset-key="2504:0" data-first-offset="true"><span data-slate-string="true">先从 A 的账户中减去 100 元；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="2505"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="2506"><span data-slate-leaf="true" data-offset-key="2506:0" data-first-offset="true"><span data-slate-string="true">再给 B 的账户加上 100 元，转账完成。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2507"><span data-slate-object="text" data-key="2508"><span data-slate-leaf="true" data-offset-key="2508:0" data-first-offset="true"><span data-slate-string="true">对应的时序图是这样的：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="2509"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/3f/58/3f7faf335a9e6c3009902d85b71d3058.jpg?wh=3665*1790"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2510"><span data-slate-object="text" data-key="2511"><span data-slate-leaf="true" data-offset-key="2511:0" data-first-offset="true"><span data-slate-string="true">在这个例子的实现过程中，我们调用了另外一个微服务 Add (account, amount)，它的功能是给账户 account 增加金额 amount，当 amount 为负值的时候，就是扣减响应的金额。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2512"><span data-slate-object="text" data-key="2513"><span data-slate-leaf="true" data-offset-key="2513:0" data-first-offset="true"><span data-slate-string="true">需要特别说明的是，在这段代码中，我为了使问题简化以便我们能专注于异步和性能优化，省略了错误处理和事务相关的代码，你在实际的开发中不要这样做。</span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="2514" id="sr-toc-2"><span data-slate-object="text" data-key="2515"><span data-slate-leaf="true" data-offset-key="2515:0" data-first-offset="true"><span data-slate-string="true">1. 同步实现的性能瓶颈</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="2516"><span data-slate-object="text" data-key="2517"><span data-slate-leaf="true" data-offset-key="2517:0" data-first-offset="true"><span data-slate-string="true">首先我们来看一下同步实现，对应的伪代码如下：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="2518"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2519"><span data-slate-object="text" data-key="2520"><span data-slate-leaf="true" data-offset-key="2520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Transfer</span></span></span></span><span data-slate-object="text" data-key="2521"><span data-slate-leaf="true" data-offset-key="2521:0" data-first-offset="true"><span data-slate-string="true">(accountFrom, accountTo, amount) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2522"><span data-slate-object="text" data-key="2523"><span data-slate-leaf="true" data-offset-key="2523:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2524"><span data-slate-leaf="true" data-offset-key="2524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 先从 accountFrom 的账户中减去相应的钱数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2525"><span data-slate-object="text" data-key="2526"><span data-slate-leaf="true" data-offset-key="2526:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2527"><span data-slate-leaf="true" data-offset-key="2527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Add</span></span></span></span><span data-slate-object="text" data-key="2528"><span data-slate-leaf="true" data-offset-key="2528:0" data-first-offset="true"><span data-slate-string="true">(accountFrom, -</span></span></span><span data-slate-object="text" data-key="2529"><span data-slate-leaf="true" data-offset-key="2529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2530"><span data-slate-leaf="true" data-offset-key="2530:0" data-first-offset="true"><span data-slate-string="true"> * amount)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2531"><span data-slate-object="text" data-key="2532"><span data-slate-leaf="true" data-offset-key="2532:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2533"><span data-slate-leaf="true" data-offset-key="2533:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 再把减去的钱数加到 accountTo 的账户中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2534"><span data-slate-object="text" data-key="2535"><span data-slate-leaf="true" data-offset-key="2535:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2536"><span data-slate-leaf="true" data-offset-key="2536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Add</span></span></span></span><span data-slate-object="text" data-key="2537"><span data-slate-leaf="true" data-offset-key="2537:0" data-first-offset="true"><span data-slate-string="true">(accountTo, amount)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2538"><span data-slate-object="text" data-key="2539"><span data-slate-leaf="true" data-offset-key="2539:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2540"><span data-slate-leaf="true" data-offset-key="2540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2541"><span data-slate-leaf="true" data-offset-key="2541:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2542"><span data-slate-leaf="true" data-offset-key="2542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OK</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2543"><span data-slate-object="text" data-key="2544"><span data-slate-leaf="true" data-offset-key="2544:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2545"><span data-slate-object="text" data-key="2546"><span data-slate-leaf="true" data-offset-key="2546:0" data-first-offset="true"><span data-slate-string="true">上面的伪代码首先从 accountFrom 的账户中减去相应的钱数，再把减去的钱数加到 accountTo 的账户中，这种同步实现是一种很自然方式，简单直接。那么性能表现如何呢？接下来我们就来一起分析一下性能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2547"><span data-slate-object="text" data-key="2548"><span data-slate-leaf="true" data-offset-key="2548:0" data-first-offset="true"><span data-slate-string="true">假设微服务 Add 的平均响应时延是 50ms，那么很容易计算出我们实现的微服务 Transfer 的平均响应时延大约等于执行 2 次 Add 的时延，也就是 100ms。那随着调用 Transfer 服务的请求越来越多，会出现什么情况呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2549"><span data-slate-object="text" data-key="2550"><span data-slate-leaf="true" data-offset-key="2550:0" data-first-offset="true"><span data-slate-string="true">在这种实现中，每处理一个请求需要耗时 100ms，并在这 100ms 过程中是需要独占一个线程的，那么可以得出这样一个结论：每个线程每秒钟最多可以处理 10 个请求。我们知道，每台计算机上的线程资源并不是无限的，假设我们使用的服务器同时打开的线程数量上限是 10,000，</span></span><span data-slate-leaf="true" data-offset-key="2550:1"><span data-slate-object="annotation" data-annotation-key="gkann_6448bccc" data-attr-id="10064" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">可以计算出这台服务器每秒钟可以处理的请求上限是： 10,000 （个线程）* 10（次请求每秒） = 100,000 次每秒。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2551"><span data-slate-object="text" data-key="2552"><span data-slate-leaf="true" data-offset-key="2552:0" data-first-offset="true"><span data-slate-string="true">如果请求速度超过这个值，那么请求就不能被马上处理，只能阻塞或者排队，这时候 Transfer 服务的响应时延由 100ms 延长到了：排队的等待时延 + 处理时延 (100ms)。也就是说，在大量请求的情况下，我们的微服务的平均响应时延变长了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2553"><span data-slate-object="text" data-key="2554"><span data-slate-leaf="true" data-offset-key="2554:0" data-first-offset="true"><span data-slate-string="true">这是不是已经到了这台服务器所能承受的极限了呢？其实远远没有，如果我们监测一下服务器的各项指标，会发现无论是 CPU、内存，还是网卡流量或者是磁盘的 IO 都空闲的很，那我们 Transfer 服务中的那 10,000 个线程在干什么呢？对，绝大部分线程都在等待 Add 服务返回结果。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2555"><span data-slate-object="text" data-key="2556"><span data-slate-leaf="true" data-offset-key="2556:0" data-first-offset="true"><span data-slate-string="true">也就是说，</span></span></span><span data-slate-object="text" data-key="2557"><span data-slate-leaf="true" data-offset-key="2557:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_a0dedc82" data-attr-id="26533" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">采用同步实现的方式，整个服务器的所有线程大部分时间都没有在工作，而是都在等待。</span></span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2558"><span data-slate-object="text" data-key="2559"><span data-slate-leaf="true" data-offset-key="2559:0" data-first-offset="true"><span data-slate-string="true">如果我们能减少或者避免这种无意义的等待，就可以大幅提升服务的吞吐能力，从而提升服务的总体性能。</span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="2560" id="sr-toc-3"><span data-slate-object="text" data-key="2561"><span data-slate-leaf="true" data-offset-key="2561:0" data-first-offset="true"><span data-slate-string="true">2. 采用异步实现解决等待问题</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="2562"><span data-slate-object="text" data-key="2563"><span data-slate-leaf="true" data-offset-key="2563:0" data-first-offset="true"><span data-slate-string="true">接下来我们看一下，如何用异步的思想来解决这个问题，实现同样的业务逻辑。</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="2564"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2565"><span data-slate-object="text" data-key="2566"><span data-slate-leaf="true" data-offset-key="2566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TransferAsync</span></span></span></span><span data-slate-object="text" data-key="2567"><span data-slate-leaf="true" data-offset-key="2567:0" data-first-offset="true"><span data-slate-string="true">(accountFrom, accountTo, amount, </span></span></span><span data-slate-object="text" data-key="2568"><span data-slate-leaf="true" data-offset-key="2568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2569"><span data-slate-leaf="true" data-offset-key="2569:0" data-first-offset="true"><span data-slate-string="true">()) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2570"><span data-slate-object="text" data-key="2571"><span data-slate-leaf="true" data-offset-key="2571:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2572"><span data-slate-leaf="true" data-offset-key="2572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 异步从 accountFrom 的账户中减去相应的钱数，然后调用 OnDebit 方法。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2573"><span data-slate-object="text" data-key="2574"><span data-slate-leaf="true" data-offset-key="2574:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2575"><span data-slate-leaf="true" data-offset-key="2575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AddAsync</span></span></span></span><span data-slate-object="text" data-key="2576"><span data-slate-leaf="true" data-offset-key="2576:0" data-first-offset="true"><span data-slate-string="true">(accountFrom, -</span></span></span><span data-slate-object="text" data-key="2577"><span data-slate-leaf="true" data-offset-key="2577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2578"><span data-slate-leaf="true" data-offset-key="2578:0" data-first-offset="true"><span data-slate-string="true"> * amount, </span></span></span><span data-slate-object="text" data-key="2579"><span data-slate-leaf="true" data-offset-key="2579:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnDebit</span></span></span></span><span data-slate-object="text" data-key="2580"><span data-slate-leaf="true" data-offset-key="2580:0" data-first-offset="true"><span data-slate-string="true">(accountTo, amount, </span></span></span><span data-slate-object="text" data-key="2581"><span data-slate-leaf="true" data-offset-key="2581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnAllDone</span></span></span></span><span data-slate-object="text" data-key="2582"><span data-slate-leaf="true" data-offset-key="2582:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2583"><span data-slate-leaf="true" data-offset-key="2583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2584"><span data-slate-leaf="true" data-offset-key="2584:0" data-first-offset="true"><span data-slate-string="true">())))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2585"><span data-slate-object="text" data-key="2586"><span data-slate-leaf="true" data-offset-key="2586:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2587"><span data-slate-object="text" data-key="2588"><span data-slate-leaf="true" data-offset-key="2588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 扣减账户 accountFrom 完成后调用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2589"><span data-slate-object="text" data-key="2590"><span data-slate-leaf="true" data-offset-key="2590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnDebit</span></span></span></span><span data-slate-object="text" data-key="2591"><span data-slate-leaf="true" data-offset-key="2591:0" data-first-offset="true"><span data-slate-string="true">(accountTo, amount, </span></span></span><span data-slate-object="text" data-key="2592"><span data-slate-leaf="true" data-offset-key="2592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnAllDone</span></span></span></span><span data-slate-object="text" data-key="2593"><span data-slate-leaf="true" data-offset-key="2593:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2594"><span data-slate-leaf="true" data-offset-key="2594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2595"><span data-slate-leaf="true" data-offset-key="2595:0" data-first-offset="true"><span data-slate-string="true">())) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2596"><span data-slate-object="text" data-key="2597"><span data-slate-leaf="true" data-offset-key="2597:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2598"><span data-slate-leaf="true" data-offset-key="2598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//  再异步把减去的钱数加到 accountTo 的账户中，然后执行 OnAllDone 方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2599"><span data-slate-object="text" data-key="2600"><span data-slate-leaf="true" data-offset-key="2600:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2601"><span data-slate-leaf="true" data-offset-key="2601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AddAsync</span></span></span></span><span data-slate-object="text" data-key="2602"><span data-slate-leaf="true" data-offset-key="2602:0" data-first-offset="true"><span data-slate-string="true">(accountTo, amount, </span></span></span><span data-slate-object="text" data-key="2603"><span data-slate-leaf="true" data-offset-key="2603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnAllDone</span></span></span></span><span data-slate-object="text" data-key="2604"><span data-slate-leaf="true" data-offset-key="2604:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2605"><span data-slate-leaf="true" data-offset-key="2605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2606"><span data-slate-leaf="true" data-offset-key="2606:0" data-first-offset="true"><span data-slate-string="true">()))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2607"><span data-slate-object="text" data-key="2608"><span data-slate-leaf="true" data-offset-key="2608:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2609"><span data-slate-object="text" data-key="2610"><span data-slate-leaf="true" data-offset-key="2610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 转入账户 accountTo 完成后调用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2611"><span data-slate-object="text" data-key="2612"><span data-slate-leaf="true" data-offset-key="2612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnAllDone</span></span></span></span><span data-slate-object="text" data-key="2613"><span data-slate-leaf="true" data-offset-key="2613:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2614"><span data-slate-leaf="true" data-offset-key="2614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2615"><span data-slate-leaf="true" data-offset-key="2615:0" data-first-offset="true"><span data-slate-string="true">()) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2616"><span data-slate-object="text" data-key="2617"><span data-slate-leaf="true" data-offset-key="2617:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2618"><span data-slate-leaf="true" data-offset-key="2618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">OnComplete</span></span></span></span><span data-slate-object="text" data-key="2619"><span data-slate-leaf="true" data-offset-key="2619:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2620"><span data-slate-object="text" data-key="2621"><span data-slate-leaf="true" data-offset-key="2621:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2622"><span data-slate-object="text" data-key="2623"><span data-slate-leaf="true" data-offset-key="2623:0" data-first-offset="true"><span data-slate-string="true">细心的你可能已经注意到了，TransferAsync 服务比 Transfer 多了一个参数，</span></span><span data-slate-leaf="true" data-offset-key="2623:1"><span data-slate-object="annotation" data-annotation-key="gkann_2d872e1d" data-attr-id="27210" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">并且这个参数传入的是一个回调方法 OnComplete ()（虽然 Java 语言并不支持将方法作为方法参数传递，</span></span></span><span data-slate-leaf="true" data-offset-key="2623:2"><span data-slate-string="true">但像 JavaScript 等很多语言都具有这样的特性，在 Java 语言中，也可以通过传入一个回调类的实例来变相实现类似的功能）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2624"><span data-slate-object="text" data-key="2625"><span data-slate-leaf="true" data-offset-key="2625:0" data-first-offset="true"><span data-slate-string="true">这个 TransferAsync () 方法的语义是：请帮我执行转账操作，当转账完成后，请调用 OnComplete () 方法。</span></span><span data-slate-leaf="true" data-offset-key="2625:1"><span data-slate-object="annotation" data-annotation-key="gkann_de9edbc6" data-attr-id="28259" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">调用 TransferAsync 的线程不必等待转账完成就可以立即返回了，</span></span></span><span data-slate-leaf="true" data-offset-key="2625:2"><span data-slate-string="true">待转账结束后，TransferService 自然会调用 OnComplete () 方法来执行转账后续的工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2626"><span data-slate-object="text" data-key="2627"><span data-slate-leaf="true" data-offset-key="2627:0" data-first-offset="true"><span data-slate-string="true">异步的实现过程相对于同步来说，稍微有些复杂。我们先定义 2 个回调方法：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="2628"><div data-slate-type="list-line" data-slate-object="block" data-key="2629"><span data-slate-object="text" data-key="2630"><span data-slate-leaf="true" data-offset-key="2630:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">OnDebit()</span></span></span></span><span data-slate-object="text" data-key="2631"><span data-slate-leaf="true" data-offset-key="2631:0" data-first-offset="true"><span data-slate-string="true">：扣减账户 accountFrom 完成后调用的回调方法；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="2632"><span data-slate-object="text" data-key="2633"><span data-slate-leaf="true" data-offset-key="2633:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">OnAllDone()</span></span></span></span><span data-slate-object="text" data-key="2634"><span data-slate-leaf="true" data-offset-key="2634:0" data-first-offset="true"><span data-slate-string="true">：转入账户 accountTo 完成后调用的回调方法。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2635"><span data-slate-object="text" data-key="2636"><span data-slate-leaf="true" data-offset-key="2636:0" data-first-offset="true"><span data-slate-string="true">整个异步实现的语义相当于：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="2637"><div data-slate-type="list-line" data-slate-object="block" data-key="2638"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="2639"><span data-slate-leaf="true" data-offset-key="2639:0" data-first-offset="true"><span data-slate-string="true">异步从 accountFrom 的账户中减去相应的钱数，然后调用 OnDebit 方法；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="2640"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="2641"><span data-slate-leaf="true" data-offset-key="2641:0" data-first-offset="true"><span data-slate-string="true">在 OnDebit 方法中，异步把减去的钱数加到 accountTo 的账户中，然后执行 OnAllDone 方法；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="2642"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="2643"><span data-slate-leaf="true" data-offset-key="2643:0" data-first-offset="true"><span data-slate-string="true">在 OnAllDone 方法中，调用 OnComplete 方法。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2644"><span data-slate-object="text" data-key="2645"><span data-slate-leaf="true" data-offset-key="2645:0" data-first-offset="true"><span data-slate-string="true">绘制成时序图是这样的：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="2646"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/38/0d/38ab8de8fbfaf4cd4b34fbd9ddd3360d.jpg?wh=3610*1831"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2647"><span data-slate-object="text" data-key="2648"><span data-slate-leaf="true" data-offset-key="2648:0" data-first-offset="true"><span data-slate-string="true">你会发现，异步化实现后，整个流程的时序和同步实现是完全一样的，</span></span></span><span data-slate-object="text" data-key="2649"><span data-slate-leaf="true" data-offset-key="2649:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">区别只是在线程模型上由同步顺序调用改为了异步调用和回调的机制。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2650"><span data-slate-object="text" data-key="2651"><span data-slate-leaf="true" data-offset-key="2651:0" data-first-offset="true"><span data-slate-string="true">接下来我们分析一下异步实现的性能，由于流程的时序和同步实现是一样，在低请求数量的场景下，平均响应时延一样是 100ms。</span></span><span data-slate-leaf="true" data-offset-key="2651:1"><span data-slate-object="annotation" data-annotation-key="gkann_315defa8" data-attr-id="4149" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">在超高请求数量场景下，异步的实现不再需要线程等待执行结果，只需要个位数量的线程，即可实现同步场景大量线程一样的吞吐量。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2652"><span data-slate-object="text" data-key="2653"><span data-slate-leaf="true" data-offset-key="2653:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_a6480d7a" data-attr-id="25779" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">由于没有了线程的数量的限制，总体吞吐量上限会大大超过同步实现，并且在服务器 CPU、网络带宽资源达到极限之前，响应时延不会随着请求数量增加而显著升高，几乎可以一直保持约 100ms 的平均响应时延。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2654"><span data-slate-object="text" data-key="2655"><span data-slate-leaf="true" data-offset-key="2655:0" data-first-offset="true"><span data-slate-string="true">看，这就是异步的魔力。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2656" id="sr-toc-4"><span data-slate-object="text" data-key="2657"><span data-slate-leaf="true" data-offset-key="2657:0" data-first-offset="true"><span data-slate-string="true">简单实用的异步框架: CompletableFuture</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2658"><span data-slate-object="text" data-key="2659"><span data-slate-leaf="true" data-offset-key="2659:0" data-first-offset="true"><span data-slate-string="true">在实际开发时，我们可以使用异步框架和响应式框架，来解决一些通用的异步编程问题，简化开发。Java 中比较常用的异步框架有 Java8 内置的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="2660"><span data-slate-object="text" data-key="2661"><span data-slate-leaf="true" data-offset-key="2661:0" data-first-offset="true"><span data-slate-string="true">CompletableFuture</span></span></span></a><span data-slate-object="text" data-key="2662"><span data-slate-leaf="true" data-offset-key="2662:0" data-first-offset="true"><span data-slate-string="true"> 和 ReactiveX 的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="2663"><span data-slate-object="text" data-key="2664"><span data-slate-leaf="true" data-offset-key="2664:0" data-first-offset="true"><span data-slate-string="true">RxJava</span></span></span></a><span data-slate-object="text" data-key="2665"><span data-slate-leaf="true" data-offset-key="2665:0" data-first-offset="true"><span data-slate-string="true">，我个人比较喜欢简单实用易于理解的 CompletableFuture，但是 RxJava 的功能更加强大。有兴趣的同学可以深入了解一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2666"><span data-slate-object="text" data-key="2667"><span data-slate-leaf="true" data-offset-key="2667:0" data-first-offset="true"><span data-slate-string="true">Java 8 中新增了一个非常强大的用于异步编程的类：CompletableFuture，几乎囊获了我们在开发异步程序的大部分功能，使用 CompletableFuture 很容易编写出优雅且易于维护的异步代码。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2668"><span data-slate-object="text" data-key="2669"><span data-slate-leaf="true" data-offset-key="2669:0" data-first-offset="true"><span data-slate-string="true">接下来，我们来看下，如何用 CompletableFuture 实现的转账服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2670"><span data-slate-object="text" data-key="2671"><span data-slate-leaf="true" data-offset-key="2671:0" data-first-offset="true"><span data-slate-string="true">首先，我们用 CompletableFuture 定义 2 个微服务的接口：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2672"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2673"><span data-slate-object="text" data-key="2674"><span data-slate-leaf="true" data-offset-key="2674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2675"><span data-slate-object="text" data-key="2676"><span data-slate-leaf="true" data-offset-key="2676:0" data-first-offset="true"><span data-slate-string="true"> * 账户服务</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2677"><span data-slate-object="text" data-key="2678"><span data-slate-leaf="true" data-offset-key="2678:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2679"><span data-slate-object="text" data-key="2680"><span data-slate-leaf="true" data-offset-key="2680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2681"><span data-slate-leaf="true" data-offset-key="2681:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2682"><span data-slate-leaf="true" data-offset-key="2682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="2683"><span data-slate-leaf="true" data-offset-key="2683:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2684"><span data-slate-leaf="true" data-offset-key="2684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">AccountService</span></span></span></span><span data-slate-object="text" data-key="2685"><span data-slate-leaf="true" data-offset-key="2685:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2686"><span data-slate-object="text" data-key="2687"><span data-slate-leaf="true" data-offset-key="2687:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2688"><span data-slate-leaf="true" data-offset-key="2688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2689"><span data-slate-object="text" data-key="2690"><span data-slate-leaf="true" data-offset-key="2690:0" data-first-offset="true"><span data-slate-string="true">     * 变更账户金额</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2691"><span data-slate-object="text" data-key="2692"><span data-slate-leaf="true" data-offset-key="2692:0" data-first-offset="true"><span data-slate-string="true">     * </span></span></span><span data-slate-object="text" data-key="2693"><span data-slate-leaf="true" data-offset-key="2693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="2694"><span data-slate-leaf="true" data-offset-key="2694:0" data-first-offset="true"><span data-slate-string="true"> account 账户 ID</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2695"><span data-slate-object="text" data-key="2696"><span data-slate-leaf="true" data-offset-key="2696:0" data-first-offset="true"><span data-slate-string="true">     * </span></span></span><span data-slate-object="text" data-key="2697"><span data-slate-leaf="true" data-offset-key="2697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="2698"><span data-slate-leaf="true" data-offset-key="2698:0" data-first-offset="true"><span data-slate-string="true"> amount 增加的金额，负值为减少</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2699"><span data-slate-object="text" data-key="2700"><span data-slate-leaf="true" data-offset-key="2700:0" data-first-offset="true"><span data-slate-string="true">     */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2701"><span data-slate-object="text" data-key="2702"><span data-slate-leaf="true" data-offset-key="2702:0" data-first-offset="true"><span data-slate-string="true">    CompletableFuture&lt;Void&gt; </span></span></span><span data-slate-object="text" data-key="2703"><span data-slate-leaf="true" data-offset-key="2703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">add</span></span></span></span><span data-slate-object="text" data-key="2704"><span data-slate-leaf="true" data-offset-key="2704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="2705"><span data-slate-leaf="true" data-offset-key="2705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2706"><span data-slate-leaf="true" data-offset-key="2706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> account, </span></span></span></span><span data-slate-object="text" data-key="2707"><span data-slate-leaf="true" data-offset-key="2707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2708"><span data-slate-leaf="true" data-offset-key="2708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> amount)</span></span></span></span><span data-slate-object="text" data-key="2709"><span data-slate-leaf="true" data-offset-key="2709:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2710"><span data-slate-object="text" data-key="2711"><span data-slate-leaf="true" data-offset-key="2711:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2712"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2713"><span data-slate-object="text" data-key="2714"><span data-slate-leaf="true" data-offset-key="2714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2715"><span data-slate-object="text" data-key="2716"><span data-slate-leaf="true" data-offset-key="2716:0" data-first-offset="true"><span data-slate-string="true"> * 转账服务</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2717"><span data-slate-object="text" data-key="2718"><span data-slate-leaf="true" data-offset-key="2718:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2719"><span data-slate-object="text" data-key="2720"><span data-slate-leaf="true" data-offset-key="2720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2721"><span data-slate-leaf="true" data-offset-key="2721:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2722"><span data-slate-leaf="true" data-offset-key="2722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="2723"><span data-slate-leaf="true" data-offset-key="2723:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2724"><span data-slate-leaf="true" data-offset-key="2724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TransferService</span></span></span></span><span data-slate-object="text" data-key="2725"><span data-slate-leaf="true" data-offset-key="2725:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2726"><span data-slate-object="text" data-key="2727"><span data-slate-leaf="true" data-offset-key="2727:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2728"><span data-slate-leaf="true" data-offset-key="2728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2729"><span data-slate-object="text" data-key="2730"><span data-slate-leaf="true" data-offset-key="2730:0" data-first-offset="true"><span data-slate-string="true">     * 异步转账服务</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2731"><span data-slate-object="text" data-key="2732"><span data-slate-leaf="true" data-offset-key="2732:0" data-first-offset="true"><span data-slate-string="true">     * </span></span></span><span data-slate-object="text" data-key="2733"><span data-slate-leaf="true" data-offset-key="2733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="2734"><span data-slate-leaf="true" data-offset-key="2734:0" data-first-offset="true"><span data-slate-string="true"> fromAccount 转出账户</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2735"><span data-slate-object="text" data-key="2736"><span data-slate-leaf="true" data-offset-key="2736:0" data-first-offset="true"><span data-slate-string="true">     * </span></span></span><span data-slate-object="text" data-key="2737"><span data-slate-leaf="true" data-offset-key="2737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="2738"><span data-slate-leaf="true" data-offset-key="2738:0" data-first-offset="true"><span data-slate-string="true"> toAccount 转入账户</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2739"><span data-slate-object="text" data-key="2740"><span data-slate-leaf="true" data-offset-key="2740:0" data-first-offset="true"><span data-slate-string="true">     * </span></span></span><span data-slate-object="text" data-key="2741"><span data-slate-leaf="true" data-offset-key="2741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@param</span></span></span></span><span data-slate-object="text" data-key="2742"><span data-slate-leaf="true" data-offset-key="2742:0" data-first-offset="true"><span data-slate-string="true"> amount 转账金额，单位分</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2743"><span data-slate-object="text" data-key="2744"><span data-slate-leaf="true" data-offset-key="2744:0" data-first-offset="true"><span data-slate-string="true">     */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2745"><span data-slate-object="text" data-key="2746"><span data-slate-leaf="true" data-offset-key="2746:0" data-first-offset="true"><span data-slate-string="true">    CompletableFuture&lt;Void&gt; </span></span></span><span data-slate-object="text" data-key="2747"><span data-slate-leaf="true" data-offset-key="2747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">transfer</span></span></span></span><span data-slate-object="text" data-key="2748"><span data-slate-leaf="true" data-offset-key="2748:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="2749"><span data-slate-leaf="true" data-offset-key="2749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2750"><span data-slate-leaf="true" data-offset-key="2750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fromAccount, </span></span></span></span><span data-slate-object="text" data-key="2751"><span data-slate-leaf="true" data-offset-key="2751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2752"><span data-slate-leaf="true" data-offset-key="2752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> toAccount, </span></span></span></span><span data-slate-object="text" data-key="2753"><span data-slate-leaf="true" data-offset-key="2753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2754"><span data-slate-leaf="true" data-offset-key="2754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> amount)</span></span></span></span><span data-slate-object="text" data-key="2755"><span data-slate-leaf="true" data-offset-key="2755:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2756"><span data-slate-object="text" data-key="2757"><span data-slate-leaf="true" data-offset-key="2757:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2758"><span data-slate-object="text" data-key="2759"><span data-slate-leaf="true" data-offset-key="2759:0" data-first-offset="true"><span data-slate-string="true">可以看到这两个接口中定义的方法的返回类型都是一个带泛型的 CompletableFuture，尖括号中的泛型类型就是真正方法需要返回数据的类型，我们这两个服务不需要返回数据，所以直接用 Void 类型就可以。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2760"><span data-slate-object="text" data-key="2761"><span data-slate-leaf="true" data-offset-key="2761:0" data-first-offset="true"><span data-slate-string="true">然后我们来实现转账服务：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2762"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2763"><span data-slate-object="text" data-key="2764"><span data-slate-leaf="true" data-offset-key="2764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2765"><span data-slate-object="text" data-key="2766"><span data-slate-leaf="true" data-offset-key="2766:0" data-first-offset="true"><span data-slate-string="true"> * 转账服务的实现</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2767"><span data-slate-object="text" data-key="2768"><span data-slate-leaf="true" data-offset-key="2768:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2769"><span data-slate-object="text" data-key="2770"><span data-slate-leaf="true" data-offset-key="2770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2771"><span data-slate-leaf="true" data-offset-key="2771:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2772"><span data-slate-leaf="true" data-offset-key="2772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="2773"><span data-slate-leaf="true" data-offset-key="2773:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2774"><span data-slate-leaf="true" data-offset-key="2774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TransferServiceImpl</span></span></span></span><span data-slate-object="text" data-key="2775"><span data-slate-leaf="true" data-offset-key="2775:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2776"><span data-slate-leaf="true" data-offset-key="2776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">implements</span></span></span></span><span data-slate-object="text" data-key="2777"><span data-slate-leaf="true" data-offset-key="2777:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2778"><span data-slate-leaf="true" data-offset-key="2778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TransferService</span></span></span></span><span data-slate-object="text" data-key="2779"><span data-slate-leaf="true" data-offset-key="2779:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2780"><span data-slate-object="text" data-key="2781"><span data-slate-leaf="true" data-offset-key="2781:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2782"><span data-slate-leaf="true" data-offset-key="2782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Inject</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2783"><span data-slate-object="text" data-key="2784"><span data-slate-leaf="true" data-offset-key="2784:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2785"><span data-slate-leaf="true" data-offset-key="2785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="2786"><span data-slate-leaf="true" data-offset-key="2786:0" data-first-offset="true"><span data-slate-string="true">  AccountService accountService; </span></span></span><span data-slate-object="text" data-key="2787"><span data-slate-leaf="true" data-offset-key="2787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用依赖注入获取账户服务的实例</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2788"><span data-slate-object="text" data-key="2789"><span data-slate-leaf="true" data-offset-key="2789:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2790"><span data-slate-leaf="true" data-offset-key="2790:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2791"><span data-slate-object="text" data-key="2792"><span data-slate-leaf="true" data-offset-key="2792:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2793"><span data-slate-leaf="true" data-offset-key="2793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2794"><span data-slate-leaf="true" data-offset-key="2794:0" data-first-offset="true"><span data-slate-string="true"> CompletableFuture&lt;Void&gt; </span></span></span><span data-slate-object="text" data-key="2795"><span data-slate-leaf="true" data-offset-key="2795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">transfer</span></span></span></span><span data-slate-object="text" data-key="2796"><span data-slate-leaf="true" data-offset-key="2796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="2797"><span data-slate-leaf="true" data-offset-key="2797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2798"><span data-slate-leaf="true" data-offset-key="2798:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fromAccount, </span></span></span></span><span data-slate-object="text" data-key="2799"><span data-slate-leaf="true" data-offset-key="2799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2800"><span data-slate-leaf="true" data-offset-key="2800:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> toAccount, </span></span></span></span><span data-slate-object="text" data-key="2801"><span data-slate-leaf="true" data-offset-key="2801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="2802"><span data-slate-leaf="true" data-offset-key="2802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> amount)</span></span></span></span><span data-slate-object="text" data-key="2803"><span data-slate-leaf="true" data-offset-key="2803:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2804"><span data-slate-object="text" data-key="2805"><span data-slate-leaf="true" data-offset-key="2805:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="2806"><span data-slate-leaf="true" data-offset-key="2806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 异步调用 add 方法从 fromAccount 扣减相应金额</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2807"><span data-slate-object="text" data-key="2808"><span data-slate-leaf="true" data-offset-key="2808:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="2809"><span data-slate-leaf="true" data-offset-key="2809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2810"><span data-slate-leaf="true" data-offset-key="2810:0" data-first-offset="true"><span data-slate-string="true"> accountService.add(fromAccount, -</span></span></span><span data-slate-object="text" data-key="2811"><span data-slate-leaf="true" data-offset-key="2811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2812"><span data-slate-leaf="true" data-offset-key="2812:0" data-first-offset="true"><span data-slate-string="true"> * amount)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2813"><span data-slate-object="text" data-key="2814"><span data-slate-leaf="true" data-offset-key="2814:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="2815"><span data-slate-leaf="true" data-offset-key="2815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 然后调用 add 方法给 toAccount 增加相应金额</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2816"><span data-slate-object="text" data-key="2817"><span data-slate-leaf="true" data-offset-key="2817:0" data-first-offset="true"><span data-slate-string="true">      .thenCompose(v -&gt; accountService.add(toAccount, amount));    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2818"><span data-slate-object="text" data-key="2819"><span data-slate-leaf="true" data-offset-key="2819:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2820"><span data-slate-object="text" data-key="2821"><span data-slate-leaf="true" data-offset-key="2821:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2822"><span data-slate-object="text" data-key="2823"><span data-slate-leaf="true" data-offset-key="2823:0" data-first-offset="true"><span data-slate-string="true">在转账服务的实现类 TransferServiceImpl 里面，先定义一个 AccountService 实例，这个实例从外部注入进来，至于怎么注入不是我们关心的问题，就假设这个实例是可用的就好了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2824"><span data-slate-object="text" data-key="2825"><span data-slate-leaf="true" data-offset-key="2825:0" data-first-offset="true"><span data-slate-string="true">然后我们看实现 transfer () 方法的实现，我们先调用一次账户服务 accountService.add () 方法从 fromAccount 扣减响应的金额，因为 add () 方法返回的就是一个 CompletableFuture 对象，可以用 CompletableFuture 的 thenCompose () 方法将下一次调用 accountService.add () 串联起来，实现异步依次调用两次账户服务完整转账。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2826"><span data-slate-object="text" data-key="2827"><span data-slate-leaf="true" data-offset-key="2827:0" data-first-offset="true"><span data-slate-string="true">客户端使用 CompletableFuture 也非常灵活，既可以同步调用，也可以异步调用。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2828"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2829"><span data-slate-object="text" data-key="2830"><span data-slate-leaf="true" data-offset-key="2830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2831"><span data-slate-leaf="true" data-offset-key="2831:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2832"><span data-slate-leaf="true" data-offset-key="2832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="2833"><span data-slate-leaf="true" data-offset-key="2833:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2834"><span data-slate-leaf="true" data-offset-key="2834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Client</span></span></span></span><span data-slate-object="text" data-key="2835"><span data-slate-leaf="true" data-offset-key="2835:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2836"><span data-slate-object="text" data-key="2837"><span data-slate-leaf="true" data-offset-key="2837:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2838"><span data-slate-leaf="true" data-offset-key="2838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Inject</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2839"><span data-slate-object="text" data-key="2840"><span data-slate-leaf="true" data-offset-key="2840:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2841"><span data-slate-leaf="true" data-offset-key="2841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="2842"><span data-slate-leaf="true" data-offset-key="2842:0" data-first-offset="true"><span data-slate-string="true"> TransferService transferService; </span></span></span><span data-slate-object="text" data-key="2843"><span data-slate-leaf="true" data-offset-key="2843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用依赖注入获取转账服务的实例</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2844"><span data-slate-object="text" data-key="2845"><span data-slate-leaf="true" data-offset-key="2845:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2846"><span data-slate-leaf="true" data-offset-key="2846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="2847"><span data-slate-leaf="true" data-offset-key="2847:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2848"><span data-slate-leaf="true" data-offset-key="2848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="2849"><span data-slate-leaf="true" data-offset-key="2849:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2850"><span data-slate-leaf="true" data-offset-key="2850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="2851"><span data-slate-leaf="true" data-offset-key="2851:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2852"><span data-slate-leaf="true" data-offset-key="2852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="2853"><span data-slate-leaf="true" data-offset-key="2853:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2854"><span data-slate-leaf="true" data-offset-key="2854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">A</span></span></span></span><span data-slate-object="text" data-key="2855"><span data-slate-leaf="true" data-offset-key="2855:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2856"><span data-slate-leaf="true" data-offset-key="2856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="2857"><span data-slate-leaf="true" data-offset-key="2857:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2858"><span data-slate-leaf="true" data-offset-key="2858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1000</span></span></span></span><span data-slate-object="text" data-key="2859"><span data-slate-leaf="true" data-offset-key="2859:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2860"><span data-slate-object="text" data-key="2861"><span data-slate-leaf="true" data-offset-key="2861:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2862"><span data-slate-leaf="true" data-offset-key="2862:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="2863"><span data-slate-leaf="true" data-offset-key="2863:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2864"><span data-slate-leaf="true" data-offset-key="2864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="2865"><span data-slate-leaf="true" data-offset-key="2865:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2866"><span data-slate-leaf="true" data-offset-key="2866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="2867"><span data-slate-leaf="true" data-offset-key="2867:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2868"><span data-slate-leaf="true" data-offset-key="2868:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="2869"><span data-slate-leaf="true" data-offset-key="2869:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2870"><span data-slate-leaf="true" data-offset-key="2870:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">B</span></span></span></span><span data-slate-object="text" data-key="2871"><span data-slate-leaf="true" data-offset-key="2871:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2872"><span data-slate-leaf="true" data-offset-key="2872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="2873"><span data-slate-leaf="true" data-offset-key="2873:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2874"><span data-slate-leaf="true" data-offset-key="2874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1001</span></span></span></span><span data-slate-object="text" data-key="2875"><span data-slate-leaf="true" data-offset-key="2875:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2876"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2877"><span data-slate-object="text" data-key="2878"><span data-slate-leaf="true" data-offset-key="2878:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2879"><span data-slate-leaf="true" data-offset-key="2879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2880"><span data-slate-leaf="true" data-offset-key="2880:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2881"><span data-slate-leaf="true" data-offset-key="2881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2882"><span data-slate-leaf="true" data-offset-key="2882:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2883"><span data-slate-leaf="true" data-offset-key="2883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">syncInvoke</span></span></span></span><span data-slate-object="text" data-key="2884"><span data-slate-leaf="true" data-offset-key="2884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="2885"><span data-slate-leaf="true" data-offset-key="2885:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2886"><span data-slate-leaf="true" data-offset-key="2886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throws</span></span></span></span><span data-slate-object="text" data-key="2887"><span data-slate-leaf="true" data-offset-key="2887:0" data-first-offset="true"><span data-slate-string="true"> ExecutionException, InterruptedException {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2888"><span data-slate-object="text" data-key="2889"><span data-slate-leaf="true" data-offset-key="2889:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2890"><span data-slate-leaf="true" data-offset-key="2890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 同步调用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2891"><span data-slate-object="text" data-key="2892"><span data-slate-leaf="true" data-offset-key="2892:0" data-first-offset="true"><span data-slate-string="true">        transferService.transfer(A, B, </span></span></span><span data-slate-object="text" data-key="2893"><span data-slate-leaf="true" data-offset-key="2893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="2894"><span data-slate-leaf="true" data-offset-key="2894:0" data-first-offset="true"><span data-slate-string="true">).get();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2895"><span data-slate-object="text" data-key="2896"><span data-slate-leaf="true" data-offset-key="2896:0" data-first-offset="true"><span data-slate-string="true">        System.out.println(</span></span></span><span data-slate-object="text" data-key="2897"><span data-slate-leaf="true" data-offset-key="2897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"转账完成！"</span></span></span></span><span data-slate-object="text" data-key="2898"><span data-slate-leaf="true" data-offset-key="2898:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2899"><span data-slate-object="text" data-key="2900"><span data-slate-leaf="true" data-offset-key="2900:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2901"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2902"><span data-slate-object="text" data-key="2903"><span data-slate-leaf="true" data-offset-key="2903:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2904"><span data-slate-leaf="true" data-offset-key="2904:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2905"><span data-slate-leaf="true" data-offset-key="2905:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2906"><span data-slate-leaf="true" data-offset-key="2906:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2907"><span data-slate-leaf="true" data-offset-key="2907:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2908"><span data-slate-leaf="true" data-offset-key="2908:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asyncInvoke</span></span></span></span><span data-slate-object="text" data-key="2909"><span data-slate-leaf="true" data-offset-key="2909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="2910"><span data-slate-leaf="true" data-offset-key="2910:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2911"><span data-slate-object="text" data-key="2912"><span data-slate-leaf="true" data-offset-key="2912:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2913"><span data-slate-leaf="true" data-offset-key="2913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 异步调用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2914"><span data-slate-object="text" data-key="2915"><span data-slate-leaf="true" data-offset-key="2915:0" data-first-offset="true"><span data-slate-string="true">        transferService.transfer(A, B, </span></span></span><span data-slate-object="text" data-key="2916"><span data-slate-leaf="true" data-offset-key="2916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="2917"><span data-slate-leaf="true" data-offset-key="2917:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2918"><span data-slate-object="text" data-key="2919"><span data-slate-leaf="true" data-offset-key="2919:0" data-first-offset="true"><span data-slate-string="true">                .thenRun(() -&gt; System.out.println(</span></span></span><span data-slate-object="text" data-key="2920"><span data-slate-leaf="true" data-offset-key="2920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"转账完成！"</span></span></span></span><span data-slate-object="text" data-key="2921"><span data-slate-leaf="true" data-offset-key="2921:0" data-first-offset="true"><span data-slate-string="true">));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2922"><span data-slate-object="text" data-key="2923"><span data-slate-leaf="true" data-offset-key="2923:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2924"><span data-slate-object="text" data-key="2925"><span data-slate-leaf="true" data-offset-key="2925:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2926"><span data-slate-object="text" data-key="2927"><span data-slate-leaf="true" data-offset-key="2927:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0b1366e9" data-attr-id="18363" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">在调用异步方法获得返回值 CompletableFuture 对象后，既可以调用 CompletableFuture 的 get 方法，像调用同步方法那样等待调用的方法执行结束并获得返回值，也可以像异步回调的方式一样，调用 CompletableFuture 那些以 then 开头的一系列方法，为 CompletableFuture 定义异步方法结束之后的后续操作。比如像上面这个例子中，我们调用 thenRun () 方法，参数就是将转账完成打印在控台上这个操作，这样就可以实现在转账完成后，在控制台打印 “转账完成！” 了。</span></span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2928" id="sr-toc-5"><span data-slate-object="text" data-key="2929"><span data-slate-leaf="true" data-offset-key="2929:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2930"><span data-slate-object="text" data-key="2931"><span data-slate-leaf="true" data-offset-key="2931:0" data-first-offset="true"><span data-slate-string="true">简单的说，异步思想就是，</span></span></span><span data-slate-object="text" data-key="2932"><span data-slate-leaf="true" data-offset-key="2932:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e1669d06" data-attr-id="14749" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">当我们要执行一项比较耗时的操作时，不去等待操作结束，而是给这个操作一个命令：“当操作完成后，接下来去执行什么。”</span></span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2933"><span data-slate-object="text" data-key="2934"><span data-slate-leaf="true" data-offset-key="2934:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_2a6a623e" data-attr-id="15013" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">使用异步编程模型，虽然并不能加快程序本身的速度，但可以减少或者避免线程等待，只用很少的线程就可以达到超高的吞吐能力。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2935"><span data-slate-object="text" data-key="2936"><span data-slate-leaf="true" data-offset-key="2936:0" data-first-offset="true"><span data-slate-string="true">同时我们也需要注意到异步模型的问题：相比于同步实现，异步实现的复杂度要大很多，代码的可读性和可维护性都会显著的下降。虽然使用一些异步编程框架会在一定程度上简化异步开发，但是并不能解决异步模型高复杂度的问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2937"><span data-slate-object="text" data-key="2938"><span data-slate-leaf="true" data-offset-key="2938:0" data-first-offset="true"><span data-slate-string="true">异步性能虽好，但一定不要滥用，只有类似在像消息队列这种业务逻辑简单并且需要超高吞吐量的场景下，</span></span><span data-slate-leaf="true" data-offset-key="2938:1"><span data-slate-object="annotation" data-annotation-key="gkann_33c6136c" data-attr-id="28072" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">或者必须长时间等待资源的地方，才考虑使用异步模型。</span></span></span><span data-slate-leaf="true" data-offset-key="2938:2"><span data-slate-string="true">如果系统的业务逻辑比较复杂，在性能足够满足业务需求的情况下，采用符合人类自然的思路且易于开发和维护的同步模型是更加明智的选择。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2939" id="sr-toc-6"><span data-slate-object="text" data-key="2940"><span data-slate-leaf="true" data-offset-key="2940:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2941"><span data-slate-object="text" data-key="2942"><span data-slate-leaf="true" data-offset-key="2942:0" data-first-offset="true"><span data-slate-string="true">课后给你留 2 个思考题：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2943"><span data-slate-object="text" data-key="2944"><span data-slate-leaf="true" data-offset-key="2944:0" data-first-offset="true"><span data-slate-string="true">第一个思考题是，我们实现转账服务时，并没有考虑处理失败的情况。你回去可以想一下，在异步实现中，如果调用账户服务失败时，如何将错误报告给客户端？在两次调用账户服务的 Add 方法时，如果某一次调用失败了，该如何处理才能保证账户数据是平的？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2945"><span data-slate-object="text" data-key="2946"><span data-slate-leaf="true" data-offset-key="2946:0" data-first-offset="true"><span data-slate-string="true">第二个思考题是，在异步实现中，回调方法 OnComplete () 是在什么线程中运行的？我们是否能控制回调方法的执行线程数？该如何做？欢迎在留言区写下你的想法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2947"><span data-slate-object="text" data-key="2948"><span data-slate-leaf="true" data-offset-key="2948:0" data-first-offset="true"><span data-slate-string="true">感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给你的朋友。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>24</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png" style="width: auto;"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-7">精选留言 (64)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>小伟</span></div><span>置顶</span></div><div>个人的一点想法：
异步回调机制的本质是通过减少线程等待时占用的 CPU 时间片，来提供 CPU 时间片的利用率。
具体做法是用少数线程响应业务请求，但处理时这些线程并不真正调用业务逻辑代码，而是简单的把业务处理逻辑扔到另一个专门执行业务逻辑代码的线程后就返回了，故不会有任何等待 (CPU 时间片浪费)。专门执行业务逻辑的线程可能会由于 IO 慢导致上下文切换而浪费一些 CPU 时间片，但这已经不影响业务请求的响应了，而业务逻辑执行完毕后会把回调处理逻辑再扔到专门执行回调业务逻辑的线程中，这时的执行业务逻辑线程的使命已完成，线程返回，然后会去找下一个需要执行的业务逻辑，这里也没有任何等待。回调业务处理线程也是同理。
以上于《摩登时代》里的卓别林很像，每个人只做自己的那点事 (卓别林只拧螺丝)。有的线程只负责响应请求 (放螺丝)，有的线程只负责执行业务逻辑 (拧螺丝)，有的线程只负责执行回调代码 (敲螺丝)，完成后就返回并继续执行下一个相同任务 (拧完这个螺丝再找下一个需要拧的螺丝)，没有相互依赖的等待 (放螺丝的不等螺丝拧好就直接放下一个螺丝)。
有利就有弊，分开后是不用等别人了，但想知道之前的步骤是否已经做好了就难了。比如螺丝没有拧紧就开始敲，会导致固定不住。如果发现螺丝没拧好，敲螺丝的人就要和工头说这块板要返工，螺丝取下，重新放，重新拧，之后才能敲。
个人感觉把关联性强且无需长时间等待的操作 (如大量磁盘或网络 IO) 打包成同步，其他用异步，这样可以在规避 CPU 时间片浪费的同时兼顾了一致性，降低了补偿的频率和开销。
</div><div><p>作者回复：人工置顶🔝</p></div><div><div>2019-08-22</div><div><div><i></i><span>23</span></div><div><i></i><span>121</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep3DicN9rHZiblia3zNpKJ3hEegicBFZqzZBS7l0oSENZicnqw340TnHVQsfNL33OtGyxEVQuS8DmqhPDQ/132"></div></div><div><div><div><span> 笑傲流云</span></div></div><div>个人的思路，欢迎老师点评下哈。
1，调用账户失败，可以在异步 callBack 里执行通知客户端的逻辑；
2，如果是第一次失败，那后面的那一步就不用执行了，所以转账失败；如果是第一次成功但是第二次失败，首先考虑重试，如果转账服务是幂等的，可以考虑一定次数的重试，如果不能重试，可以考虑采用补偿机制，undo 第一次的转账操作。
3，CompletableFuture 默认是在 ForkjoinPool commonpool 里执行的，也可以指定一个 Executor 线程池执行，借鉴 guava 的 ListenableFuture 的时间，回调可以指定线程池执行，这样就能控制这个线程池的线程数目了。</div><div><p>作者回复: 👍👍👍</p></div><div><div>2019-08-13</div><div><div><i></i><span>11</span></div><div><i></i><span>89</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erTlRJ6skf7iawAeqNfIT1PPgjD7swUdRIRkX1iczjj97GNrxnsnn3QuOhkVbCLgFYAm7sMZficNTSbA/132"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>senekis</span></div></div><div>老师，我一直有一个困惑，就是想不明白为何异步可以节省线程。每次发起一个异步调用不都会创建一个新的线程吗？我理解了好几次，感觉只是异步处理线程在等待时可以让出时间片给其他线程运行啊？一直想不明白这个问题，困扰了好久，求老师解惑。</div><div><p>作者回复：太多的线程会造成频繁的 cpu 上下文切换，你可以想象一下，假设你的小公司只有 8 台电脑，你雇 8 个程序员一直不停的工作显然是效率最高的。考虑到程序员要休息不可能连轴转，雇佣 24 个人，每天三班倒，效率也还行。

但是，你要雇佣 10000 个人，他们还是只能用这 8 台电脑，大部分时间不都浪费在换人、交接工作上了吗？</p></div><div><div>2019-08-13</div><div><div><i></i><span>26</span></div><div><i></i><span>64</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/a9/18/393a841d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 付永强</span></div></div><div>老师可能里面过多提到线程这两个字，所以很多人把异步设计理解成节约线程，其实李玥老师这里想说明的是异步是用来提高 cup 的利用率，而不是节省线程。
异步编程是通过分工的方式，是为了减少了 cpu 因线程等待的可能，让 CPU 一直处于工作状态。换句话说，如果我们能想办法减少 CPU 空闲时间，我们的计算机就可以支持更多的线程。
其实线程是一个抽象概念，我们从物理层面理解，就是单位时间内把每毫核分配处理不同的任务，从而提高单位时间内 CPU 的利用率。</div><div><p>作者回复: 👍👍👍
线程就是为了能自动分配 CPU 时间片而生的。</p></div><div><div>2019-08-13</div><div><div><i></i><span>6</span></div><div><i></i><span>56</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/08/b4/c5118ad4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 我丢了一只小凳子</span></div></div><div>老师，有一点不太懂，异步转账时，假如专门几个线程（Threads_quest）处理转账请求，其他的线程处理账户增减金额逻辑，虽然大量请求来的时候，Threads_quest 这几个线程可以接受请求之后扔给其他线程处理增减金额，但是由于请求量过大，不也会导致其他线程处理变慢吗，导致完整的处理也变慢</div><div><p>作者回复：首先，你要理解，为什么请求多了程序会变慢这个事儿。

计算的资源，比如说 CPU、磁盘 IO，它的处理能力是恒定的，都不会因为请求量大而 “变慢”。

比如说 CPU 执行一次加法，任何情况下耗时都是差不多的。

我们所看到的请求量大 “系统变慢” 的现象，一定是因为某一种资源忙，达到了瓶颈。比如说，一个单核 CPU，每做一次加法需要 0.1 秒，那它每秒最多做 10 次加法。

一下子 100 个程序同时都来请求 CPU 做一次加法，这个 CPU 就需要 10 秒才能算完。对于这个 CPU，它并没变慢，仍然是每秒做 10 次加法。

但是对于某一个请求 CPU 的程序来说，它看到的现象是，我让 CPU 做了一次加法，它八秒才做完，看起来就是 “变慢” 了。

所以，程序变慢一定是因为某一个资源忙，遇到了瓶颈。同步程序因为线程数量的限制，它的瓶颈往往是线程数量。并不能发挥服务器的全部处理能力。异步程序不需要那么多线程，所以可以发挥出服务器的全部处理能力，直到把 CPU 或者磁盘 IO 打满，所以要快得多。</p></div><div><div>2020-02-19</div><div><div><i></i></div><div><i></i><span>46</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/7f/a8/d103904b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>mark</span></div></div><div>go 语言的本质就是 用同步的方式，写出异步的代码。

每个用户过来直接启动一个 go routine ，可以同时启动上百万的协程
go processConn ()

而 go 的内部 只启动少量线程，io 的等待全部做了异步处理。</div><div><div>2019-09-20</div><div><div><i></i><span></span></div><div><i></i><span>21</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>linqw</span></div></div><div>尝试回答课后习题，老师有空帮忙看下哦
思考题一、如果在异步实现中，如果调用账户服务失败，可以以账单的形式将转账失败的记录下来，比如客户在转账一段时间后
查看账单就可以知道转账是否成功，只要保证转账失败，客户的钱没有少就可以。两次调用账户服务，感觉可以这样写
/**
     * 转账服务的实现
     */
    public class TransferServiceImpl implements TransferService {
        @Inject
        private  AccountService accountService; // 使用依赖注入获取账户服务的实例
        @Override
        public CompletableFuture&lt;Void&gt; transfer (int fromAccount, int toAccount, int amount) {
            // 异步调用 add 方法从 fromAccount 扣减相应金额
            return accountService.add (fromAccount, -1 * amount).exceptionally (add (fromAccount, amount))
                    // 然后调用 add 方法给 toAccount 增加相应金额
                    .thenCompose (v -&gt; accountService.add (toAccount, amount)).exceptionally (add (toAccount, -1 * amount));
        }
    }
思考题二、在异步实现中，回调方法 OnComplete () 可以在另一个线程池执行，比如 rocketmq 中异步实现，
再异步发送消息时，会将封装一个 ResponseFuture 包含回调方法、通道、请求消息 id，将其请求 id 做为 key，ResponseFuture 做为 value 放入 map 中
等响应返回时，根据请求 id 从 map 中获取 ResponseFuture，然后将 ResponseFuture 中的回调方法封装成任务放入到线程池中执行。然后执行
特定的回调方法。CompletableFuture 有点需要注意的是，在不同的业务中需创建各自的线程池，否则都是共用 ForkJoinPool。
写下对异步的理解，如果同步一个请求线程需要等待处理结果完，才可以处理其他请求，这样的话会导致如果请求多，创建很多线程
但是这些线程大部分都是等待处理结果，如果有后续的请求，没有其他线程及时处理会导致延迟（等待线程时间 + 处理时间），
会出现机器的 cpu、磁盘、内存都不高（因为等待的线程是不占 CPU 的）很多请求超时之类的情况。异步的话，就是让线程调用处理接口就直接返回
不用等待处理结果，后续的处理结果可以用回调的形式来处理。如果对那些不需要实时拿到结果的业务就很适合，可以提高整个系统的吞吐率
</div><div><p>作者回复：总结的非常好！

有一点需要改进一下，转账服务的实现中，异常处理的部分，还是需要先检查再补偿，否则有可能出现重复补偿的情况。</p></div><div><div>2019-08-13</div><div><div><i></i><span>2</span></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Better me</span></div></div><div>对于思考题:
1、应该可以通过编程式事物来保证数据的完整性。如何将错误结果返回给客户端，感觉这边和老师上次答疑网关如何接收服务端秒杀结果有点类似，通过方法回调，在回调方法中保存下转账成功或失败
2、在异步实现中，回调方法 OnComplete () 在执行 OnAllDone () 回调方法的那个线程，可以通过一个异步线程池去控制回调方法的线程数，如 Spring 中的 async 就是通过结合线程池来实现异步调用
看了两遍才稍微有点思路，老师有空看看</div><div><p>作者回复: 👍👍👍</p></div><div><div>2019-08-13</div><div><div><i></i></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/30/5b/ed3b2211.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 沧浪之水</span></div></div><div>一直有个困惑：异步可以解决 io 等待的问题，我感觉只是把等待的线程从业务线程转到异步框架线程了。最后的结果是，总有一个线程在 io 等待。 不是业务线程就是异步线程。 从整个机器来考虑，都是在消耗线程资源。  那怎么理解使用异步能够提升吞吐量呢，因为业务总是要有返回数据的。 数据在异步线程中等待，并不节约时间。 吞吐量的卡点还是 io 时间。 </div><div><div>2020-04-28</div><div><div><i></i><span></span></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/4e/cf/21bea6bb.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 王建坤</span></div></div><div>老师你好，CompletableFuture 这种回调底层还是 forkjoin 框架，forkjoin 对于 io 这种操作还是会阻塞线程，而且 CompletableFuture 默认线程数是与 cpu 核数一样的。在现在容器化的场景下，Cpu 核数都不会很多（一般都是个位数），那么使用 CompletableFuture 是执行 io 操作是不是会更早的无响应？因为个位数的线程很快就都被阻塞了。</div><div><p>作者回复：这里说一下我的理解：

CompletableFuture 还不能等完全同于 ForkJoin。
可以简单的理解为

CompletableFuture.then () 等于 Fork
CompletableFuture.get () 等于 Join

但不是所有场景下，CompletableFuture 都需要用 get () 结束的。也就是说，有时候是不需要调用阻塞的 get () 方法的。

另外，虽然 CompletableFuture 默认使用 ForkJoinPool，但你完全可以给它提供一个自定义的执行器。</p></div><div><div>2020-07-07</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>xfan</span></div></div><div>这一篇写的有点歧义，我觉得举的例子主要是网络 IO 方面的情况，其实发送请求本身就是串行的，不论是回调还是阻塞发送，其实都是串行的，不同的是：同步等待这种情况是利用了当前线程栈，而异步发送时创建了新线程发送，而抛弃了原有线程。从 CPU 时间片利用效率来说，这两者没有区别，而且异步可能会更消耗 CPU 时间片，因为创建线程需要。再者网络 IO 时间也不会减少，吞吐量也不会增加，还是走了两趟。如果真的需要减少时间增加吞吐，那需要计算好结果发送给 ADD，比如 - 100 +80 =-20 最后发送直接发 - 20 即可。</div><div><div>2019-10-31</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/36/4c/46c43cce.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小祺</span></div></div><div>老师，你用 CompletableFuture 这种方式跟我自己用一个固定大小的线程池去 submit, 然后返回 Future 再 get 有什么本质的区别吗？吞吐量上呢？</div><div><p>作者回复：性能上没有区别。
区别是代码结构更清晰简单，易于维护。</p></div><div><div>2019-09-06</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/11/ed/4c/8674b6ad.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>timmy21</span></div></div><div>我有一个困惑，客户端发起一个请求转账服务，此时转账服务会启动一个线程 A 处理该请求，然后转账再使用线程池异步调用账户服务。但是线程 A 还是存在，并等待处理结果的。我的问题来了，如果有 10 万个转账请求，转账服务还是最少开启 10 万个线程 A 的吧？</div><div><p>作者回复：线程 A 在异步调用完账户服务后就可以结束了，不需要等待，响应可以由其他的线程负责返回给调用者，由于这个过程中不涉及任何具体的业务逻辑，是非常快的，可以认为瞬间就结束了。所以并不需要很多的线程。</p></div><div><div>2019-08-21</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 业余草</span></div></div><div>异步虽好，但使用场景有限！</div><div><div>2019-08-13</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/d5/fc/00af6446.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 团子</span></div></div><div>老师，即使转账和账户服务都是异步，但是只是在我们代码端的异步，如果 add 方法设计到 io 传输，那 completeablefuture 中线程还是要 block 的把</div><div><p>作者回复：结合 Netty 或者 NIO，是可以做到全异步的，不需要线程在阻塞等待响应。</p></div><div><div>2020-04-21</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 长期规划</span></div></div><div>同步会有等待，导致线程没活干，CPU 利用率低，但创建的大量线程占着内存等资源。如果换成异步，将一个任务切成多个片段，切点是 IO 阻塞的地方。维护一个线程池，当执行每一个片段时，从线程池取线程。这样，同样多任务，用更少线程数就可以，线程少了，线程等待时间少，利用率提高了。</div><div><div>2019-09-23</div><div><div><i></i><span>1</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/36/4c/46c43cce.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小祺</span></div></div><div>老师，我理解异步是可以解决请求超时的问题，但是像文中举例这种转账操作，转出转入两个操作是前后依赖的没法并行，那么这种前后依赖的任务使用异步跟同步又有什么区别呢？
另外，当 10 万请求过来之后，虽然用了异步可以瞬间返回，但是其实几万个请求对象在 CompletableFuture 内部线程池内部还是排队啊，所以最后来的请求还是要等很久才能被执行到。那么既然同步 or 异步都需要排队，异步究竟快在哪里了呢？</div><div><p>作者回复：第一个问题，转入转出这两个操作不需要串行，是可以并行的。甚至执行顺序都没什么要求。我们唯一要保证的是这两个操作在一个事务中执行， “要么都成功，要么都失败”，就可以了。

你这个场景是在调用方（转账服务）异步，而服务提供方（账户服务）还是同步服务的情况下，才会出现。

你仔细看一下我们的异步设计，服务提供方提供的也是异步服务，那调用账户服务也是一瞬间就完成了，这样就不会出现你说的 “几万个请求对象在 CompletableFuture 内部线程池内部还是排队” 的情况了。

</p></div><div><div>2019-09-06</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/53/19/dec74631.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 谢清</span></div></div><div>学习了，一点思路，欢迎老师点评
第一个问题：
两次 add 方法保持最终一致性，第一次 add 失败不在调用第二次，告知客户转账失败；第一次成功调第二次失败，告知用户：转账进行中，转账对象收款中；可设置补偿策略，还是失败的话，转账后台人工介入补偿，还是不行则人工还原账户金额并告知用户：转账失败
第二个问题：
笑傲流云的答案不错。结合前面课程，用流量控制也可实现</div><div><div>2019-08-13</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/05/06/f5979d65.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 亚洲舞王。尼古拉斯赵四</span></div></div><div>1. 老师，能否解释一下为什么 “使用异步编程模型之后，在少量请求之下，时延依旧是 100ms，但是在大量请求之下，异步的实现不需要等待线程的执行结果”？少量请求不也不需要等待吗
2. 如果使用异步方式实现，我的 onComplete () 方法在另一个线程里执行，我怎么通知我的客户端我执行成功还是失败呢？</div><div><p>作者回复: A1：是的，异步方式下少量和大量请求都不需要等待执行结果。

A2： 在 onComplete () 方法中通知。</p></div><div><div>2019-08-13</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1f/27/be/b666abb4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>tongZi</span></div></div><div>看到评论区大家的评论，发表一下自己的一些小观点，望指正
1、client 调用 transfer service，transfer 然后异步调用 account service；
transfer 和 client 保持连接的线程大大减少了。
由于使用异步调用，达到线程上线时，减少了线程的创建等待，但是真正占用 cpu 时间片，的线程可以更多了；
像文中老师说的 “服务器 CPU、网络带宽资源达到极限之前”，可以处理更多的任务，提高了 cpu 使用率</div><div><div>2020-07-16</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".x"><outline class="toc-level-h1" data-reactid=".x.0" style="width: 175px;"><active data-reactid=".x.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".x.0.1"><span data-reactid=".x.0.1.0">10 | 如何使用异步设计提升系统性能？</span></a></outline><outline class="toc-level-h2" data-reactid=".x.1" style="width: 165px;"><active data-reactid=".x.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".x.1.1"><span data-reactid=".x.1.1.0">异步设计如何提升系统性能？</span></a></outline><outline class="toc-level-h4" data-reactid=".x.2" style="width: 145px;"><active data-reactid=".x.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".x.2.1"><span data-reactid=".x.2.1.0">1. 同步实现的性能瓶颈</span></a></outline><outline class="toc-level-h4" data-reactid=".x.3" style="width: 145px;"><active data-reactid=".x.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".x.3.1"><span data-reactid=".x.3.1.0">2. 采用异步实现解决等待问题</span></a></outline><outline class="toc-level-h2" data-reactid=".x.4" style="width: 165px;"><active data-reactid=".x.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".x.4.1"><span data-reactid=".x.4.1.0">简单实用的异步框架: CompletableFuture</span></a></outline><outline class="toc-level-h2" data-reactid=".x.5" style="width: 165px;"><active data-reactid=".x.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".x.5.1"><span data-reactid=".x.5.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".x.6" style="width: 165px;"><active data-reactid=".x.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".x.6.1"><span data-reactid=".x.6.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".x.7" style="width: 165px;"><active data-reactid=".x.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".x.7.1"><span data-reactid=".x.7.1.0">精选留言 (64)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/117272" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>