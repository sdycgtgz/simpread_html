
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 42 | 软件部署实战（下）：IAM 系统安全加固、水平扩缩容实战</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>42 | 软件部署实战（下）：IAM 系统安全加固、水平扩缩容实战</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">每种语言通常都有自己的测试包 / 模块，Go 语言也不例外。在 Go 中，我们可以通过 testing 包对代码进行单元测试和性能测试。今天，我会用一些示</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 42 | 软件部署实战（下）：IAM 系统安全加固、水平扩缩容实战</h1><div><span>孔令飞</span> <span> 2021-08-31</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/2c/09/2ca168968b7a2a28e56c2f99298e1309.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：14.73M</span><span> 时长：16:07</span></div></div><audio title="42 | 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战" src="https://res001.geekbang.org/media/audio/e0/71/e094d0f7b38e22cbcf705d6aea635871/ld/ld.m3u8" __idm_id__="327687"></audio></div><div><div><div><div data-slate-editor="true" data-key="7559" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="7560"><span data-slate-object="text" data-key="7561"><span data-slate-leaf="true" data-offset-key="7561:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7562"><span data-slate-object="text" data-key="7563"><span data-slate-leaf="true" data-offset-key="7563:0" data-first-offset="true"><span data-slate-string="true">这一讲和前面两讲，都是介绍如何基于物理机 / 虚拟机来部署 IAM 的。在前面两讲，我们了解了如何部署一个高可用的 IAM 应用，今天就再来看看 IAM 应用安全和弹性伸缩能力的构建方式。在这一讲中，我会带你加固 IAM 应用的安全性，并介绍如何具体执行扩缩容步骤。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7564"><span data-slate-object="text" data-key="7565"><span data-slate-leaf="true" data-offset-key="7565:0" data-first-offset="true"><span data-slate-string="true">接下来，我们先来看下如何加固 IAM 应用的安全性。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7566" id="sr-toc-1"><span data-slate-object="text" data-key="7567"><span data-slate-leaf="true" data-offset-key="7567:0" data-first-offset="true"><span data-slate-string="true">IAM 应用安全性加固</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7568"><span data-slate-object="text" data-key="7569"><span data-slate-leaf="true" data-offset-key="7569:0" data-first-offset="true"><span data-slate-string="true">iam-apiserver、iam-authz-server、MariaDB、Redis 和 MongoDB 这些服务，都提供了绑定监听网卡的功能。我们可以将这些服务绑定到内网网卡上，从而只接收来自于内网的请求，通过这种方式，可以加固我们的系统。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7570"><span data-slate-object="text" data-key="7571"><span data-slate-leaf="true" data-offset-key="7571:0" data-first-offset="true"><span data-slate-string="true">我们也可以通过 iptables 来实现类似的功能，通过将安全问题统一收敛到 iptables 规则，可以使我们更容易地维护安全类设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7572"><span data-slate-object="text" data-key="7573"><span data-slate-leaf="true" data-offset-key="7573:0" data-first-offset="true"><span data-slate-string="true">这门课通过 iptables 来加固系统，使系统变得更加安全。下面，我先来对 iptables 工具进行一些简单的介绍。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7574" id="sr-toc-2"><span data-slate-object="text" data-key="7575"><span data-slate-leaf="true" data-offset-key="7575:0" data-first-offset="true"><span data-slate-string="true">iptables 简介</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7576"><span data-slate-object="text" data-key="7577"><span data-slate-leaf="true" data-offset-key="7577:0" data-first-offset="true"><span data-slate-string="true">iptables 是 Linux 下最优秀的防火墙工具，也是 Linux 内核中 netfilter 网络子系统用户态的工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7578"><span data-slate-object="text" data-key="7579"><span data-slate-leaf="true" data-offset-key="7579:0" data-first-offset="true"><span data-slate-string="true">netfilter 提供了一系列的接口，在一个到达本机的数据包，或者经本机转发的数据包流程中添加了一些可供用户操作的点，这些点被称为 HOOK 点。通过在 HOOK 点注册数据包处理函数，可以实现数据包转发、数据包过滤、地址转换等功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7580"><span data-slate-object="text" data-key="7581"><span data-slate-leaf="true" data-offset-key="7581:0" data-first-offset="true"><span data-slate-string="true">用户通过 iptables 工具定义各种规则，这些规则通过 iptables 传给内核中的 netfilter。最终，netfilter 会根据规则对网络包进行过滤。Linux 系统一般会默认安装 iptables 软件。防火墙根据 iptables 里的规则，对收到的网络数据包进行处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7582"><span data-slate-object="text" data-key="7583"><span data-slate-leaf="true" data-offset-key="7583:0" data-first-offset="true"><span data-slate-string="true">iptables 里的数据组织结构分为表、链、规则。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7584"><div data-slate-type="list-line" data-slate-object="block" data-key="7585"><span data-slate-object="text" data-key="7586"><span data-slate-leaf="true" data-offset-key="7586:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">表（tables）:</span></span></span></span><span data-slate-object="text" data-key="7587"><span data-slate-leaf="true" data-offset-key="7587:0" data-first-offset="true"><span data-slate-string="true"> 表可以提供特定的功能，每个表里包含多个链。iptables 里面一共有 5 个表，分别是 filter、nat、mangle、raw、security。这些表，分别用来实现包过滤、网络地址转换、包重构、数据追踪处理和 SELinux 标记设置。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7588"><span data-slate-object="text" data-key="7589"><span data-slate-leaf="true" data-offset-key="7589:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">链（chains）:</span></span></span></span><span data-slate-object="text" data-key="7590"><span data-slate-leaf="true" data-offset-key="7590:0" data-first-offset="true"><span data-slate-string="true"> 链是数据包传播的路径，每一条链中可以有一个或多个规则。当一个数据包到达一个链时，iptables 会从链中第一条规则开始，检查该数据包是否满足规则所定义的条件。如果满足，就会根据该条规则所定义的方法，处理该数据包。否则，就继续检查下一条规则。如果该数据包不符合链中任一条规则，iptables 就会根据该链预先定义的默认策略来处理数据包。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7591"><span data-slate-object="text" data-key="7592"><span data-slate-leaf="true" data-offset-key="7592:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">规则（rules）：</span></span></span></span><span data-slate-object="text" data-key="7593"><span data-slate-leaf="true" data-offset-key="7593:0" data-first-offset="true"><span data-slate-string="true">规则存储在内核空间的信息包过滤表中，用来描述 “如果数据包满足所描述的条件，就按照要求处理这个数据包，如果不满足，就判断下一条规则”。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7594"><span data-slate-object="text" data-key="7595"><span data-slate-leaf="true" data-offset-key="7595:0" data-first-offset="true"><span data-slate-string="true">其中，iptables 中表和链的种类及其功能，如下表所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7596"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/11/0f/112df7eb9a1258dd61e3bd0e0b6b210f.png?wh=2248x1941"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7597"><span data-slate-object="text" data-key="7598"><span data-slate-leaf="true" data-offset-key="7598:0" data-first-offset="true"><span data-slate-string="true">上面的表格中，五张表的处理是有顺序的。当数据包到达某一条链时，会按照 RAW、MANGLE、NAT、FILTER、SECURITY 的顺序进行处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7599"><span data-slate-object="text" data-key="7600"><span data-slate-leaf="true" data-offset-key="7600:0" data-first-offset="true"><span data-slate-string="true">到这里，我介绍了关于 iptables 的一些基础知识，但这还远远不够。要想使用 iptables 来加固你的系统，你还需要掌握 iptables 工具的使用方法。接下来，我先来介绍下 iptables 是如何处理网络数据包的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7601" id="sr-toc-3"><span data-slate-object="text" data-key="7602"><span data-slate-leaf="true" data-offset-key="7602:0" data-first-offset="true"><span data-slate-string="true">网络数据包处理流程</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7603"><span data-slate-object="text" data-key="7604"><span data-slate-leaf="true" data-offset-key="7604:0" data-first-offset="true"><span data-slate-string="true">网络数据包的处理流程如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7605"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9e/bb/9ece7f3001c022790f1fd1a0yy1246bb.jpg?wh=2248x1414"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7606"><span data-slate-object="text" data-key="7607"><span data-slate-leaf="true" data-offset-key="7607:0" data-first-offset="true"><span data-slate-string="true">具体可以分为两个步骤。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7608"><span data-slate-object="text" data-key="7609"><span data-slate-leaf="true" data-offset-key="7609:0" data-first-offset="true"><span data-slate-string="true">第一步，</span></span><span data-slate-leaf="true" data-offset-key="7609:1"><span data-slate-object="annotation" data-annotation-key="gkann_7e8ea745" data-attr-id="43154" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">当数据包进入网卡后，它首先进入 PREROUTING 链，根据目的 IP 判断是否转发出去。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7610"><span data-slate-object="text" data-key="7611"><span data-slate-leaf="true" data-offset-key="7611:0" data-first-offset="true"><span data-slate-string="true">第二步分为两种情况：如果数据包目的地是本机，它会到达 INPUT 链。到达后，任何进程都会收到它。本机上的程序可以发送数据包，这些数据包会经过 OUTPUT 链，然后经 POSTROUTING 链输出；如果数据包是要转发出去，并且内核允许转发，那么数据包会经过 FORWARD 链，最后从 POSTROUTING 链输出。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7612" id="sr-toc-4"><span data-slate-object="text" data-key="7613"><span data-slate-leaf="true" data-offset-key="7613:0" data-first-offset="true"><span data-slate-string="true">iptables 工具使用方式介绍</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7614"><span data-slate-object="text" data-key="7615"><span data-slate-leaf="true" data-offset-key="7615:0" data-first-offset="true"><span data-slate-string="true">iptables 的功能强大，所以使用方法也非常多样。这里，我来介绍下 iptables 工具的使用方式，并给出一些使用示例。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7616"><div data-slate-type="list-line" data-slate-object="block" data-key="7617"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7618"><span data-slate-leaf="true" data-offset-key="7618:0" data-first-offset="true"><span data-slate-string="true">命令格式</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7619"><span data-slate-object="text" data-key="7620"><span data-slate-leaf="true" data-offset-key="7620:0" data-first-offset="true"><span data-slate-string="true">iptables 的语法格式为：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7621"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7622"><span data-slate-object="text" data-key="7623"><span data-slate-leaf="true" data-offset-key="7623:0" data-first-offset="true"><span data-slate-string="true">iptables [-t 表名] 命令选项 [链名] [条件匹配] [-j 目标动作或跳转]</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7624"><span data-slate-object="text" data-key="7625"><span data-slate-leaf="true" data-offset-key="7625:0" data-first-offset="true"><span data-slate-string="true">下面是一个 iptables 的使用示例：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7626"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7627"><span data-slate-object="text" data-key="7628"><span data-slate-leaf="true" data-offset-key="7628:0" data-first-offset="true"><span data-slate-string="true">iptables -t nat -I PREROUTING -p tcp --dport 8080 -j DNAT --to 10.0.4.88</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7629"><span data-slate-object="text" data-key="7630"><span data-slate-leaf="true" data-offset-key="7630:0" data-first-offset="true"><span data-slate-string="true">这里对上面涉及到的一些参数进行说明。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7631"><div data-slate-type="list-line" data-slate-object="block" data-key="7632"><span data-slate-object="text" data-key="7633"><span data-slate-leaf="true" data-offset-key="7633:0" data-first-offset="true"><span data-slate-string="true">表名 / 链名：指定 iptables 命令所操作的表 / 链。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7634"><span data-slate-object="text" data-key="7635"><span data-slate-leaf="true" data-offset-key="7635:0" data-first-offset="true"><span data-slate-string="true">命令选项：指定处理 iptables 规则的方式，例如插入、增加、删除、查看等。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7636"><span data-slate-object="text" data-key="7637"><span data-slate-leaf="true" data-offset-key="7637:0" data-first-offset="true"><span data-slate-string="true">条件匹配：指定对符合条件的数据包进行处理。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7638"><span data-slate-object="text" data-key="7639"><span data-slate-leaf="true" data-offset-key="7639:0" data-first-offset="true"><span data-slate-string="true">目标动作或跳转：防火墙处理数据包的方式。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7640"><span data-slate-object="text" data-key="7641"><span data-slate-leaf="true" data-offset-key="7641:0" data-first-offset="true"><span data-slate-string="true">iptables 的命令选项又分为管理控制选项和通用选项。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7642"><span data-slate-object="text" data-key="7643"><span data-slate-leaf="true" data-offset-key="7643:0" data-first-offset="true"><span data-slate-string="true">管理控制选项如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7644"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/6d/b2/6d37f77b4cee31eea694cc588ayy3cb2.png?wh=2248x2323"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7645"><span data-slate-object="text" data-key="7646"><span data-slate-leaf="true" data-offset-key="7646:0" data-first-offset="true"><span data-slate-string="true">通用选项如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7647"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/0b/ae/0b38f3ba2d722ccf3274a0ae0a5f79ae.png?wh=2248x1498"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7648"><span data-slate-object="text" data-key="7649"><span data-slate-leaf="true" data-offset-key="7649:0" data-first-offset="true"><span data-slate-string="true">处理数据包的方式（目标动作或跳转）有多种，具体如下表所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7650"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/f7/dc/f796fc7905c88cf0461f4464cec8cddc.png?wh=2248x1625"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7651"><span data-slate-object="text" data-key="7652"><span data-slate-leaf="true" data-offset-key="7652:0" data-first-offset="true"><span data-slate-string="true">上面，我介绍了 iptables 工具的使用方式。因为内容有点多，你可能仍然不知道如何使用 iptables 工具。没关系，接下来你可以结合我举的一些例子来看下。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7653"><div data-slate-type="list-line" data-slate-object="block" data-key="7654"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7655"><span data-slate-leaf="true" data-offset-key="7655:0" data-first-offset="true"><span data-slate-string="true">命令示例</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7656"><span data-slate-object="text" data-key="7657"><span data-slate-leaf="true" data-offset-key="7657:0" data-first-offset="true"><span data-slate-string="true">下面的命令示例，默认使用了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7658"><span data-slate-object="text" data-key="7659"><span data-slate-leaf="true" data-offset-key="7659:0" data-first-offset="true"><span data-slate-string="true">FILTER</span></span></span></span><span data-slate-object="text" data-key="7660"><span data-slate-leaf="true" data-offset-key="7660:0" data-first-offset="true"><span data-slate-string="true"> 表，也即规则存放在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7661"><span data-slate-object="text" data-key="7662"><span data-slate-leaf="true" data-offset-key="7662:0" data-first-offset="true"><span data-slate-string="true">FILTER</span></span></span></span><span data-slate-object="text" data-key="7663"><span data-slate-leaf="true" data-offset-key="7663:0" data-first-offset="true"><span data-slate-string="true">  表中，相当于每一条 iptables 命令都添加了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7664"><span data-slate-object="text" data-key="7665"><span data-slate-leaf="true" data-offset-key="7665:0" data-first-offset="true"><span data-slate-string="true"> -t filter</span></span></span></span><span data-slate-object="text" data-key="7666"><span data-slate-leaf="true" data-offset-key="7666:0" data-first-offset="true"><span data-slate-string="true"> 参数。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7667"><div data-slate-type="list-line" data-slate-object="block" data-key="7668"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7669"><span data-slate-leaf="true" data-offset-key="7669:0" data-first-offset="true"><span data-slate-string="true">拒绝进入防火墙的所有 ICMP 协议数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7670"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7671"><span data-slate-object="text" data-key="7672"><span data-slate-leaf="true" data-offset-key="7672:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p icmp -j REJECT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7673"><div data-slate-type="list-line" data-slate-object="block" data-key="7674"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7675"><span data-slate-leaf="true" data-offset-key="7675:0" data-first-offset="true"><span data-slate-string="true">允许防火墙转发除 ICMP 协议以外的所有数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7676"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7677"><span data-slate-object="text" data-key="7678"><span data-slate-leaf="true" data-offset-key="7678:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -p ! icmp -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7679"><div data-slate-type="list-line" data-slate-object="block" data-key="7680"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="7681"><span data-slate-leaf="true" data-offset-key="7681:0" data-first-offset="true"><span data-slate-string="true">拒绝转发来自 192.168.1.10 主机的数据，允许转发来自 192.168.0.0/24 网段的数据：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7682"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7683"><span data-slate-object="text" data-key="7684"><span data-slate-leaf="true" data-offset-key="7684:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -s 192.168.1.11 -j REJECT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7685"><span data-slate-object="text" data-key="7686"><span data-slate-leaf="true" data-offset-key="7686:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7687"><div data-slate-type="list-line" data-slate-object="block" data-key="7688"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="7689"><span data-slate-leaf="true" data-offset-key="7689:0" data-first-offset="true"><span data-slate-string="true">丢弃从外网接口（eth1）进入防火墙本机的源地址为私网地址的数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7690"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7691"><span data-slate-object="text" data-key="7692"><span data-slate-leaf="true" data-offset-key="7692:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7693"><span data-slate-object="text" data-key="7694"><span data-slate-leaf="true" data-offset-key="7694:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -i eth1 -s 172.16.0.0/12 -j DROP</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7695"><span data-slate-object="text" data-key="7696"><span data-slate-leaf="true" data-offset-key="7696:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7697"><div data-slate-type="list-line" data-slate-object="block" data-key="7698"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="7699"><span data-slate-leaf="true" data-offset-key="7699:0" data-first-offset="true"><span data-slate-string="true">只允许管理员从 202.13.0.0/16 网段使用 SSH 远程登录防火墙主机：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7700"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7701"><span data-slate-object="text" data-key="7702"><span data-slate-leaf="true" data-offset-key="7702:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp --dport 22 -s 202.13.0.0/16 -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7703"><span data-slate-object="text" data-key="7704"><span data-slate-leaf="true" data-offset-key="7704:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp --dport 22 -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7705"><div data-slate-type="list-line" data-slate-object="block" data-key="7706"><div data-code-line-number="6"></div><div><span data-slate-object="text" data-key="7707"><span data-slate-leaf="true" data-offset-key="7707:0" data-first-offset="true"><span data-slate-string="true">允许本机开放从 TCP 端口 20-1024 提供的应用服务：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7708"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7709"><span data-slate-object="text" data-key="7710"><span data-slate-leaf="true" data-offset-key="7710:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp --dport 20:1024 -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7711"><span data-slate-object="text" data-key="7712"><span data-slate-leaf="true" data-offset-key="7712:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A OUTPUT -p tcp --sport 20:1024 -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7713"><div data-slate-type="list-line" data-slate-object="block" data-key="7714"><div data-code-line-number="7"></div><div><span data-slate-object="text" data-key="7715"><span data-slate-leaf="true" data-offset-key="7715:0" data-first-offset="true"><span data-slate-string="true">允许转发来自 192.168.0.0/24 局域网段的 DNS 解析请求数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7716"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7717"><span data-slate-object="text" data-key="7718"><span data-slate-leaf="true" data-offset-key="7718:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -s 192.168.0.0/24 -p udp --dport 53 -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7719"><span data-slate-object="text" data-key="7720"><span data-slate-leaf="true" data-offset-key="7720:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -d 192.168.0.0/24 -p udp --sport 53 -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7721"><div data-slate-type="list-line" data-slate-object="block" data-key="7722"><div data-code-line-number="8"></div><div><span data-slate-object="text" data-key="7723"><span data-slate-leaf="true" data-offset-key="7723:0" data-first-offset="true"><span data-slate-string="true">禁止其他主机 ping 防火墙主机，但是允许从防火墙上 ping 其他主机：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7724"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7725"><span data-slate-object="text" data-key="7726"><span data-slate-leaf="true" data-offset-key="7726:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p icmp --icmp-type Echo-Request -j DROP</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7727"><span data-slate-object="text" data-key="7728"><span data-slate-leaf="true" data-offset-key="7728:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p icmp --icmp-type Echo-Reply -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7729"><span data-slate-object="text" data-key="7730"><span data-slate-leaf="true" data-offset-key="7730:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p icmp --icmp-type destination-Unreachable -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7731"><div data-slate-type="list-line" data-slate-object="block" data-key="7732"><div data-code-line-number="9"></div><div><span data-slate-object="text" data-key="7733"><span data-slate-leaf="true" data-offset-key="7733:0" data-first-offset="true"><span data-slate-string="true">禁止转发来自 MAC 地址为 00：0C：29：27：55：3F 的数据包和主机的数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7734"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7735"><span data-slate-object="text" data-key="7736"><span data-slate-leaf="true" data-offset-key="7736:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -m mac --mac-source 00:0c:29:27:55:3F -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7737"><div data-slate-type="list-line" data-slate-object="block" data-key="7738"><div data-code-line-number="10"></div><div><span data-slate-object="text" data-key="7739"><span data-slate-leaf="true" data-offset-key="7739:0" data-first-offset="true"><span data-slate-string="true">对外开放 TCP 端口 20、21、25、110，以及被动模式 FTP 端口 1250-1280：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7740"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7741"><span data-slate-object="text" data-key="7742"><span data-slate-leaf="true" data-offset-key="7742:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp -m multiport --dport 20,21,25,110,1250:1280 -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7743"><div data-slate-type="list-line" data-slate-object="block" data-key="7744"><div data-code-line-number="11"></div><div><span data-slate-object="text" data-key="7745"><span data-slate-leaf="true" data-offset-key="7745:0" data-first-offset="true"><span data-slate-string="true">禁止转发源 IP 地址为 192.168.1.20-192.168.1.99 的 TCP 数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7746"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7747"><span data-slate-object="text" data-key="7748"><span data-slate-leaf="true" data-offset-key="7748:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -p tcp -m iprange --src-range 192.168.1.20-192.168.1.99 -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7749"><div data-slate-type="list-line" data-slate-object="block" data-key="7750"><div data-code-line-number="12"></div><div><span data-slate-object="text" data-key="7751"><span data-slate-leaf="true" data-offset-key="7751:0" data-first-offset="true"><span data-slate-string="true">禁止转发与正常 TCP 连接无关的非 syn 请求数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7752"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7753"><span data-slate-object="text" data-key="7754"><span data-slate-leaf="true" data-offset-key="7754:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A FORWARD -m state --state NEW -p tcp ! --syn -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7755"><div data-slate-type="list-line" data-slate-object="block" data-key="7756"><div data-code-line-number="13"></div><div><span data-slate-object="text" data-key="7757"><span data-slate-leaf="true" data-offset-key="7757:0" data-first-offset="true"><span data-slate-string="true">拒绝访问防火墙的新数据包，但允许响应连接或与已有连接相关的数据包：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7758"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7759"><span data-slate-object="text" data-key="7760"><span data-slate-leaf="true" data-offset-key="7760:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp -m state --state NEW -j DROP</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7761"><span data-slate-object="text" data-key="7762"><span data-slate-leaf="true" data-offset-key="7762:0" data-first-offset="true"><span data-slate-string="true">$ iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7763"><div data-slate-type="list-line" data-slate-object="block" data-key="7764"><div data-code-line-number="14"></div><div><span data-slate-object="text" data-key="7765"><span data-slate-leaf="true" data-offset-key="7765:0" data-first-offset="true"><span data-slate-string="true">只开放本机的 web 服务（80）、FTP (20、21、20450-20480)，放行外部主机发往服务器其他端口的应答数据包，将其他入站数据包都进行丢弃处理：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7766"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7767"><span data-slate-object="text" data-key="7768"><span data-slate-leaf="true" data-offset-key="7768:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p tcp -m multiport --dport 20,21,80 -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7769"><span data-slate-object="text" data-key="7770"><span data-slate-leaf="true" data-offset-key="7770:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p tcp --dport 20450:20480 -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7771"><span data-slate-object="text" data-key="7772"><span data-slate-leaf="true" data-offset-key="7772:0" data-first-offset="true"><span data-slate-string="true">$ iptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7773"><span data-slate-object="text" data-key="7774"><span data-slate-leaf="true" data-offset-key="7774:0" data-first-offset="true"><span data-slate-string="true">$ iptables -P INPUT DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7775"><span data-slate-object="text" data-key="7776"><span data-slate-leaf="true" data-offset-key="7776:0" data-first-offset="true"><span data-slate-string="true">到这里，我们已经了解了 iptables 的功能，下面来看看如何使用 iptables 来加固 IAM 应用。我把它分成内网不安全和内网安全两种情况。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7777" id="sr-toc-5"><span data-slate-object="text" data-key="7778"><span data-slate-leaf="true" data-offset-key="7778:0" data-first-offset="true"><span data-slate-string="true">IAM 安全加固（内网不安全）</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7779"><span data-slate-object="text" data-key="7780"><span data-slate-leaf="true" data-offset-key="7780:0" data-first-offset="true"><span data-slate-string="true">在设置 iptables 规则之前，我们需要先梳理系统的访问关系，然后根据这些访问关系设置 iptables 规则。访问关系如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7781"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9a/8d/9a9b8d4283410dc842505f258128d78d.jpg?wh=2248x1386"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7782"><span data-slate-object="text" data-key="7783"><span data-slate-leaf="true" data-offset-key="7783:0" data-first-offset="true"><span data-slate-string="true">你可以看到，IAM 系统服务互访关系分为下面这 4 种：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7784"><div data-slate-type="list-line" data-slate-object="block" data-key="7785"><span data-slate-object="text" data-key="7786"><span data-slate-leaf="true" data-offset-key="7786:0" data-first-offset="true"><span data-slate-string="true">允许公网客户端访问 Nginx 的 80 和 443 端口。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7787"><span data-slate-object="text" data-key="7788"><span data-slate-leaf="true" data-offset-key="7788:0" data-first-offset="true"><span data-slate-string="true">Keepalived 服务之间能够互发 VRRP 协议包。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7789"><span data-slate-object="text" data-key="7790"><span data-slate-leaf="true" data-offset-key="7790:0" data-first-offset="true"><span data-slate-string="true">Nginx 访问各节点上 iam-apiserver、iam-authz-server 和 iam-pump 组件开启的 HTTP/HTTPS/GRPC 服务。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7791"><span data-slate-object="text" data-key="7792"><span data-slate-leaf="true" data-offset-key="7792:0" data-first-offset="true"><span data-slate-string="true">iam 服务可以从各节点访问 Redis、MariaDB、MongoDB 数据库。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7793"><span data-slate-object="text" data-key="7794"><span data-slate-leaf="true" data-offset-key="7794:0" data-first-offset="true"><span data-slate-string="true">这里，我们假定 IAM 系统部署在一个非常大的内网中，该内网部署了很多其他团队的服务，有很多其他团队的研发、测试等人员在内网中执行各种操作。也就是说，我们处在一个不安全的内网中。这时候，如果要加固我们的系统，最安全的方式是屏蔽掉未知的来源 IP。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7795"><span data-slate-object="text" data-key="7796"><span data-slate-leaf="true" data-offset-key="7796:0" data-first-offset="true"><span data-slate-string="true">内网不安全的情况下，加固系统可以分为 3 大步骤，每个步骤中又有一些小步骤。另外，需要新增节点或者删除节点时，也需要进行一些变更操作。下面我们来具体看下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7797"><span data-slate-object="text" data-key="7798"><span data-slate-leaf="true" data-offset-key="7798:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一步，设置防火墙规则。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7799"><span data-slate-object="text" data-key="7800"><span data-slate-leaf="true" data-offset-key="7800:0" data-first-offset="true"><span data-slate-string="true">基于上面说到的几种互访关系，我们可以在各个节点上设置 iptables 规则来加固系统。我将这些规则设置编写成了 go 工具，用来自动生成设置这些规则的 shell 脚本。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7801"><span data-slate-object="text" data-key="7802"><span data-slate-leaf="true" data-offset-key="7802:0" data-first-offset="true"><span data-slate-string="true">具体设置的过程可以分为 5 步。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7803"><div data-slate-type="list-line" data-slate-object="block" data-key="7804"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7805"><span data-slate-leaf="true" data-offset-key="7805:0" data-first-offset="true"><span data-slate-string="true">进入 iam 项目源码根目录。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="7806"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7807"><span data-slate-leaf="true" data-offset-key="7807:0" data-first-offset="true"><span data-slate-string="true">配置 accesss.yaml（工具根据此配置，自动生成 iptables 设置脚本），内容如下（位于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7808"><span data-slate-object="text" data-key="7809"><span data-slate-leaf="true" data-offset-key="7809:0" data-first-offset="true"><span data-slate-string="true">configs/access.yaml</span></span></span></a><span data-slate-object="text" data-key="7810"><span data-slate-leaf="true" data-offset-key="7810:0" data-first-offset="true"><span data-slate-string="true"> 文件）：</span></span></span></div></div></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7811"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7812"><span data-slate-object="text" data-key="7813"><span data-slate-leaf="true" data-offset-key="7813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 允许登录 SSH 节点的来源 IP，可以是固定 IP (例如 10.0.4.2)，也可以是个网段，0.0.0.0/0 代表不限制来源 IP</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7814"><span data-slate-object="text" data-key="7815"><span data-slate-leaf="true" data-offset-key="7815:0" data-first-offset="true"><span data-slate-string="true">ssh-source: </span></span></span><span data-slate-object="text" data-key="7816"><span data-slate-leaf="true" data-offset-key="7816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7817"><span data-slate-leaf="true" data-offset-key="7817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7818"><span data-slate-leaf="true" data-offset-key="7818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="7819"><span data-slate-leaf="true" data-offset-key="7819:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span><span data-slate-object="text" data-key="7820"><span data-slate-leaf="true" data-offset-key="7820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">24</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7821"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7822"><span data-slate-object="text" data-key="7823"><span data-slate-leaf="true" data-offset-key="7823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># IAM 应用节点列表（来源 IP）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7824"><span data-slate-object="text" data-key="7825"><span data-slate-leaf="true" data-offset-key="7825:0" data-first-offset="true"><span data-slate-string="true">hosts:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7826"><span data-slate-object="text" data-key="7827"><span data-slate-leaf="true" data-offset-key="7827:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7828"><span data-slate-leaf="true" data-offset-key="7828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7829"><span data-slate-leaf="true" data-offset-key="7829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7830"><span data-slate-leaf="true" data-offset-key="7830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.20</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7831"><span data-slate-object="text" data-key="7832"><span data-slate-leaf="true" data-offset-key="7832:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7833"><span data-slate-leaf="true" data-offset-key="7833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7834"><span data-slate-leaf="true" data-offset-key="7834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7835"><span data-slate-leaf="true" data-offset-key="7835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.21</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7836"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7837"><span data-slate-object="text" data-key="7838"><span data-slate-leaf="true" data-offset-key="7838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的应用端口列表（iam-apiserver, iam-authz-server, iam-pump 对外暴露的的端口）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7839"><span data-slate-object="text" data-key="7840"><span data-slate-leaf="true" data-offset-key="7840:0" data-first-offset="true"><span data-slate-string="true">ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7841"><span data-slate-object="text" data-key="7842"><span data-slate-leaf="true" data-offset-key="7842:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7843"><span data-slate-leaf="true" data-offset-key="7843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8080</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7844"><span data-slate-object="text" data-key="7845"><span data-slate-leaf="true" data-offset-key="7845:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7846"><span data-slate-leaf="true" data-offset-key="7846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7847"><span data-slate-object="text" data-key="7848"><span data-slate-leaf="true" data-offset-key="7848:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7849"><span data-slate-leaf="true" data-offset-key="7849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9090</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7850"><span data-slate-object="text" data-key="7851"><span data-slate-leaf="true" data-offset-key="7851:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7852"><span data-slate-leaf="true" data-offset-key="7852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7853"><span data-slate-object="text" data-key="7854"><span data-slate-leaf="true" data-offset-key="7854:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7855"><span data-slate-leaf="true" data-offset-key="7855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">7070</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7856"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7857"><span data-slate-object="text" data-key="7858"><span data-slate-leaf="true" data-offset-key="7858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的数据库端口列表（Redis, MariaDB, MongoDB）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7859"><span data-slate-object="text" data-key="7860"><span data-slate-leaf="true" data-offset-key="7860:0" data-first-offset="true"><span data-slate-string="true">dbports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7861"><span data-slate-object="text" data-key="7862"><span data-slate-leaf="true" data-offset-key="7862:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7863"><span data-slate-leaf="true" data-offset-key="7863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3306</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7864"><span data-slate-object="text" data-key="7865"><span data-slate-leaf="true" data-offset-key="7865:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7866"><span data-slate-leaf="true" data-offset-key="7866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6379</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7867"><span data-slate-object="text" data-key="7868"><span data-slate-leaf="true" data-offset-key="7868:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7869"><span data-slate-leaf="true" data-offset-key="7869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">27017</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7870"><span data-slate-object="text" data-key="7871"><span data-slate-leaf="true" data-offset-key="7871:0" data-first-offset="true"><span data-slate-string="true">上面的配置中，我们指定了允许登陆机器的子网、Nginx 需要访问的端口列表和各节点需要访问的数据库端口列表。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7872"><div data-slate-type="list-line" data-slate-object="block" data-key="7873"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="7874"><span data-slate-leaf="true" data-offset-key="7874:0" data-first-offset="true"><span data-slate-string="true">生成 iptables 初始化脚本：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7875"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7876"><span data-slate-object="text" data-key="7877"><span data-slate-leaf="true" data-offset-key="7877:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t app -a -o firewall.sh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7878"><span data-slate-object="text" data-key="7879"><span data-slate-leaf="true" data-offset-key="7879:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="7880"><span data-slate-leaf="true" data-offset-key="7880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="7881"><span data-slate-leaf="true" data-offset-key="7881:0" data-first-offset="true"><span data-slate-string="true"> firewall.sh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7882"><span data-slate-object="text" data-key="7883"><span data-slate-leaf="true" data-offset-key="7883:0" data-first-offset="true"><span data-slate-string="true">firewall.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7884"><span data-slate-object="text" data-key="7885"><span data-slate-leaf="true" data-offset-key="7885:0" data-first-offset="true"><span data-slate-string="true">你可以打开 firewall.sh 文件，查看该脚本设置的规则。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7886"><span data-slate-object="text" data-key="7887"><span data-slate-leaf="true" data-offset-key="7887:0" data-first-offset="true"><span data-slate-string="true">4. 将 firewall.sh 脚本拷贝到 10.0.4.20 和 10.0.4.21 节点执行：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7888"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7889"><span data-slate-object="text" data-key="7890"><span data-slate-leaf="true" data-offset-key="7890:0" data-first-offset="true"><span data-slate-string="true">$ scp firewall.sh root@10.0.4.20:/tmp/</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7891"><span data-slate-object="text" data-key="7892"><span data-slate-leaf="true" data-offset-key="7892:0" data-first-offset="true"><span data-slate-string="true">$ scp firewall.sh root@10.0.4.21:/tmp/</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7893"><span data-slate-object="text" data-key="7894"><span data-slate-leaf="true" data-offset-key="7894:0" data-first-offset="true"><span data-slate-string="true">登陆 10.0.4.20 和 10.0.4.21 机器，执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7895"><span data-slate-object="text" data-key="7896"><span data-slate-leaf="true" data-offset-key="7896:0" data-first-offset="true"><span data-slate-string="true"> /tmp/firewall.sh</span></span></span></span><span data-slate-object="text" data-key="7897"><span data-slate-leaf="true" data-offset-key="7897:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7898"><div data-slate-type="list-line" data-slate-object="block" data-key="7899"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="7900"><span data-slate-leaf="true" data-offset-key="7900:0" data-first-offset="true"><span data-slate-string="true">在 10.0.4.20（数据库节点）节点上，设置 iptables 规则，以允许各节点访问：</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7901"><span data-slate-object="text" data-key="7902"><span data-slate-leaf="true" data-offset-key="7902:0" data-first-offset="true"><span data-slate-string="true">因为数据库节点也位于 10.0.4.20 节点，所以只需要添加新的 rule，并将</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7903"><span data-slate-object="text" data-key="7904"><span data-slate-leaf="true" data-offset-key="7904:0" data-first-offset="true"><span data-slate-string="true"> iptables -A INPUT -j DROP</span></span></span></span><span data-slate-object="text" data-key="7905"><span data-slate-leaf="true" data-offset-key="7905:0" data-first-offset="true"><span data-slate-string="true"> 规则放到最后执行即可。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7906"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7907"><span data-slate-object="text" data-key="7908"><span data-slate-leaf="true" data-offset-key="7908:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t db -o addrules.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7909"><span data-slate-object="text" data-key="7910"><span data-slate-leaf="true" data-offset-key="7910:0" data-first-offset="true"><span data-slate-string="true">然后，将 addrules.sh 脚本拷贝到 10.0.4.20 节点执行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7911"><span data-slate-object="text" data-key="7912"><span data-slate-leaf="true" data-offset-key="7912:0" data-first-offset="true"><span data-slate-string="true">注意，因为 iptables 是按顺序进行规则过滤的，所以需要将</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7913"><span data-slate-object="text" data-key="7914"><span data-slate-leaf="true" data-offset-key="7914:0" data-first-offset="true"><span data-slate-string="true"> iptables -A INPUT -j DROP</span></span></span></span><span data-slate-object="text" data-key="7915"><span data-slate-leaf="true" data-offset-key="7915:0" data-first-offset="true"><span data-slate-string="true"> 规则放在新设置规则的后面，否则执行不到新设置的规则。你可以在设置完 iptables 规则之后，执行下面的命令来将 DROP 放到最后：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7916"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7917"><span data-slate-object="text" data-key="7918"><span data-slate-leaf="true" data-offset-key="7918:0" data-first-offset="true"><span data-slate-string="true">iptables -A INPUT -j LOG --log-level 7 --log-prefix </span></span></span><span data-slate-object="text" data-key="7919"><span data-slate-leaf="true" data-offset-key="7919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Default Deny"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7920"><span data-slate-object="text" data-key="7921"><span data-slate-leaf="true" data-offset-key="7921:0" data-first-offset="true"><span data-slate-string="true">iptables -A INPUT -j DROP</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7922"><span data-slate-object="text" data-key="7923"><span data-slate-leaf="true" data-offset-key="7923:0" data-first-offset="true"><span data-slate-string="true">生成的 addrules.sh 脚本加入以上设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7924"><span data-slate-object="text" data-key="7925"><span data-slate-leaf="true" data-offset-key="7925:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二步，设置重启自动加载 iptables 规则。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7926"><span data-slate-object="text" data-key="7927"><span data-slate-leaf="true" data-offset-key="7927:0" data-first-offset="true"><span data-slate-string="true">前面我们在各个节点设置了 iptables 规则，但是这些规则在系统重启后会丢失。为了使系统重启后自动重新设置这些规则，我们需要将当前的 iptables 规则保存起来，让系统重启时自动加载。需要进行下面两个步骤。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7928"><div data-slate-type="list-line" data-slate-object="block" data-key="7929"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7930"><span data-slate-leaf="true" data-offset-key="7930:0" data-first-offset="true"><span data-slate-string="true">保存现有的规则：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7931"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7932"><span data-slate-object="text" data-key="7933"><span data-slate-leaf="true" data-offset-key="7933:0" data-first-offset="true"><span data-slate-string="true">$ sudo iptables-save &gt; /etc/sysconfig/iptables</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="7934"><div data-slate-type="list-line" data-slate-object="block" data-key="7935"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="7936"><span data-slate-leaf="true" data-offset-key="7936:0" data-first-offset="true"><span data-slate-string="true">添加下面的命令行到 /etc/rc.d/rc.local 文件中：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="7937"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7938"><span data-slate-object="text" data-key="7939"><span data-slate-leaf="true" data-offset-key="7939:0" data-first-offset="true"><span data-slate-string="true">$ iptables-restore &lt; /etc/sysconfig/iptables</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7940"><span data-slate-object="text" data-key="7941"><span data-slate-leaf="true" data-offset-key="7941:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第三步，自动化。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7942"><span data-slate-object="text" data-key="7943"><span data-slate-leaf="true" data-offset-key="7943:0" data-first-offset="true"><span data-slate-string="true">在上面的步骤中，我们自动生成了 iptables 规则，并手动登陆到节点进行设置。你肯定也发现了，整个流程手动操作过多，容易出错，效率还低。你可以参考设置过程，将这些设置工作自动化，比如编写脚本，一键刷新所有节点的 iptables 规则。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7944"><span data-slate-object="text" data-key="7945"><span data-slate-leaf="true" data-offset-key="7945:0" data-first-offset="true"><span data-slate-string="true">另外，我们再来看下在新增节点和删除节点两种场景下，如何设置 iptables 规则。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7946"><span data-slate-object="text" data-key="7947"><span data-slate-leaf="true" data-offset-key="7947:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">场景 1：新增节点</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7948"><span data-slate-object="text" data-key="7949"><span data-slate-leaf="true" data-offset-key="7949:0" data-first-offset="true"><span data-slate-string="true">如果我们要扩容一个节点，也需要在新节点设置防火墙规则，并在数据库节点设置防火墙规则允许来自新节点的访问。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7950"><span data-slate-object="text" data-key="7951"><span data-slate-leaf="true" data-offset-key="7951:0" data-first-offset="true"><span data-slate-string="true">假如我们新增一个 10.0.4.22 节点，这里要设置防火墙规则，需要下面的 4 个步骤。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7952"><div data-slate-type="list-line" data-slate-object="block" data-key="7953"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="7954"><span data-slate-leaf="true" data-offset-key="7954:0" data-first-offset="true"><span data-slate-string="true">编辑 access.yaml，在 hosts 列表下新增 10.0.4.22 节点 IP。编辑后内容如下：</span></span></span></div></div></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7955"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7956"><span data-slate-object="text" data-key="7957"><span data-slate-leaf="true" data-offset-key="7957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 允许登录 SSH 节点的来源 IP，可以是固定 IP (例如 10.0.4.2)，也可以是个网段，0.0.0.0/0 代表不限制来源 IP</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7958"><span data-slate-object="text" data-key="7959"><span data-slate-leaf="true" data-offset-key="7959:0" data-first-offset="true"><span data-slate-string="true">ssh-source: </span></span></span><span data-slate-object="text" data-key="7960"><span data-slate-leaf="true" data-offset-key="7960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7961"><span data-slate-leaf="true" data-offset-key="7961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7962"><span data-slate-leaf="true" data-offset-key="7962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="7963"><span data-slate-leaf="true" data-offset-key="7963:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span><span data-slate-object="text" data-key="7964"><span data-slate-leaf="true" data-offset-key="7964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">24</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7965"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7966"><span data-slate-object="text" data-key="7967"><span data-slate-leaf="true" data-offset-key="7967:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># IAM 应用节点列表（来源 IP）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7968"><span data-slate-object="text" data-key="7969"><span data-slate-leaf="true" data-offset-key="7969:0" data-first-offset="true"><span data-slate-string="true">hosts:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7970"><span data-slate-object="text" data-key="7971"><span data-slate-leaf="true" data-offset-key="7971:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7972"><span data-slate-leaf="true" data-offset-key="7972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7973"><span data-slate-leaf="true" data-offset-key="7973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7974"><span data-slate-leaf="true" data-offset-key="7974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.20</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7975"><span data-slate-object="text" data-key="7976"><span data-slate-leaf="true" data-offset-key="7976:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7977"><span data-slate-leaf="true" data-offset-key="7977:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7978"><span data-slate-leaf="true" data-offset-key="7978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7979"><span data-slate-leaf="true" data-offset-key="7979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.21</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7980"><span data-slate-object="text" data-key="7981"><span data-slate-leaf="true" data-offset-key="7981:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7982"><span data-slate-leaf="true" data-offset-key="7982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="7983"><span data-slate-leaf="true" data-offset-key="7983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="7984"><span data-slate-leaf="true" data-offset-key="7984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.22</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7985"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7986"><span data-slate-object="text" data-key="7987"><span data-slate-leaf="true" data-offset-key="7987:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的应用端口列表（iam-apiserver, iam-authz-server, iam-pump 对外暴露的的端口）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7988"><span data-slate-object="text" data-key="7989"><span data-slate-leaf="true" data-offset-key="7989:0" data-first-offset="true"><span data-slate-string="true">ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7990"><span data-slate-object="text" data-key="7991"><span data-slate-leaf="true" data-offset-key="7991:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7992"><span data-slate-leaf="true" data-offset-key="7992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8080</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7993"><span data-slate-object="text" data-key="7994"><span data-slate-leaf="true" data-offset-key="7994:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7995"><span data-slate-leaf="true" data-offset-key="7995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7996"><span data-slate-object="text" data-key="7997"><span data-slate-leaf="true" data-offset-key="7997:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="7998"><span data-slate-leaf="true" data-offset-key="7998:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9090</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7999"><span data-slate-object="text" data-key="8000"><span data-slate-leaf="true" data-offset-key="8000:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8001"><span data-slate-leaf="true" data-offset-key="8001:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8002"><span data-slate-object="text" data-key="8003"><span data-slate-leaf="true" data-offset-key="8003:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8004"><span data-slate-leaf="true" data-offset-key="8004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">7070</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8005"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8006"><span data-slate-object="text" data-key="8007"><span data-slate-leaf="true" data-offset-key="8007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的数据库端口列表（Redis, MariaDB, MongoDB）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8008"><span data-slate-object="text" data-key="8009"><span data-slate-leaf="true" data-offset-key="8009:0" data-first-offset="true"><span data-slate-string="true">dbports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8010"><span data-slate-object="text" data-key="8011"><span data-slate-leaf="true" data-offset-key="8011:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8012"><span data-slate-leaf="true" data-offset-key="8012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3306</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8013"><span data-slate-object="text" data-key="8014"><span data-slate-leaf="true" data-offset-key="8014:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8015"><span data-slate-leaf="true" data-offset-key="8015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6379</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8016"><span data-slate-object="text" data-key="8017"><span data-slate-leaf="true" data-offset-key="8017:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8018"><span data-slate-leaf="true" data-offset-key="8018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">27017</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="8019"><div data-slate-type="list-line" data-slate-object="block" data-key="8020"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="8021"><span data-slate-leaf="true" data-offset-key="8021:0" data-first-offset="true"><span data-slate-string="true">在 10.0.4.22 节点设置 iptables 规则：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8022"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8023"><span data-slate-object="text" data-key="8024"><span data-slate-leaf="true" data-offset-key="8024:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t app -a -o firewall.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8025"><span data-slate-object="text" data-key="8026"><span data-slate-leaf="true" data-offset-key="8026:0" data-first-offset="true"><span data-slate-string="true">将 firewall.sh 脚本拷贝到 10.0.4.22 节点，并执行。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8027"><div data-slate-type="list-line" data-slate-object="block" data-key="8028"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="8029"><span data-slate-leaf="true" data-offset-key="8029:0" data-first-offset="true"><span data-slate-string="true">在已有节点新增规则，允许来自 10.0.4.22 的 Nginx 服务的访问：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8030"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8031"><span data-slate-object="text" data-key="8032"><span data-slate-leaf="true" data-offset-key="8032:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t app 10.0.4.22 -o addrules.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8033"><span data-slate-object="text" data-key="8034"><span data-slate-leaf="true" data-offset-key="8034:0" data-first-offset="true"><span data-slate-string="true">将 addrules.sh 脚本拷贝到存量节点，并执行。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8035"><div data-slate-type="list-line" data-slate-object="block" data-key="8036"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="8037"><span data-slate-leaf="true" data-offset-key="8037:0" data-first-offset="true"><span data-slate-string="true">在数据库节点新增 iptables 规则，以允许来自新节点的访问：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8038"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8039"><span data-slate-object="text" data-key="8040"><span data-slate-leaf="true" data-offset-key="8040:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t db 10.0.4.22 -o addrules.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8041"><span data-slate-object="text" data-key="8042"><span data-slate-leaf="true" data-offset-key="8042:0" data-first-offset="true"><span data-slate-string="true">将 addrules.sh 脚本拷贝到 10.0.4.20 节点执行即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8043"><span data-slate-object="text" data-key="8044"><span data-slate-leaf="true" data-offset-key="8044:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">场景 2：删除节点。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8045"><span data-slate-object="text" data-key="8046"><span data-slate-leaf="true" data-offset-key="8046:0" data-first-offset="true"><span data-slate-string="true">如果我们要删除一个节点，需要在保留的节点和数据库节点中，将该节点的访问权限删除。假如我们要删除 10.0.4.22 节点，设置防火墙规则需要下面 3 个步骤。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8047"><div data-slate-type="list-line" data-slate-object="block" data-key="8048"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="8049"><span data-slate-leaf="true" data-offset-key="8049:0" data-first-offset="true"><span data-slate-string="true">在保留节点删除 10.0.4.22 节点访问权限：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8050"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8051"><span data-slate-object="text" data-key="8052"><span data-slate-leaf="true" data-offset-key="8052:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t app --delete 10.0.4.22 -o delete.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8053"><span data-slate-object="text" data-key="8054"><span data-slate-leaf="true" data-offset-key="8054:0" data-first-offset="true"><span data-slate-string="true">将 delete.sh 脚本拷贝到保留节点（10.0.4.20，10.0.4.21），并执行。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8055"><div data-slate-type="list-line" data-slate-object="block" data-key="8056"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="8057"><span data-slate-leaf="true" data-offset-key="8057:0" data-first-offset="true"><span data-slate-string="true">在数据库节点删除 10.0.4.22 节点访问权限：</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8058"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8059"><span data-slate-object="text" data-key="8060"><span data-slate-leaf="true" data-offset-key="8060:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t db --delete 10.0.4.22 -o delete.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8061"><span data-slate-object="text" data-key="8062"><span data-slate-leaf="true" data-offset-key="8062:0" data-first-offset="true"><span data-slate-string="true">将 delete.sh 脚本拷贝到 10.0.4.20 节点执行即可。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8063"><div data-slate-type="list-line" data-slate-object="block" data-key="8064"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="8065"><span data-slate-leaf="true" data-offset-key="8065:0" data-first-offset="true"><span data-slate-string="true">将下线的节点从 access.yaml 文件中的 hosts 部分删除。</span></span></span></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="8066" id="sr-toc-6"><span data-slate-object="text" data-key="8067"><span data-slate-leaf="true" data-offset-key="8067:0" data-first-offset="true"><span data-slate-string="true">IAM 安全加固（内网安全）</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="8068"><span data-slate-object="text" data-key="8069"><span data-slate-leaf="true" data-offset-key="8069:0" data-first-offset="true"><span data-slate-string="true">这里，我们来看第二种情况：假定我们系统部署在一个安全的内网环境中，这时候加固系统就会变得异常简单，只需要允许来源 IP 为内网 IP 的客户端访问我们提供的各类端口即可。在我们设置完 iptables 规则之后，后续再新增或者删除节点，就不需要再做变更了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8070"><span data-slate-object="text" data-key="8071"><span data-slate-leaf="true" data-offset-key="8071:0" data-first-offset="true"><span data-slate-string="true">具体可以分为 5 个步骤。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8072"><span data-slate-object="text" data-key="8073"><span data-slate-leaf="true" data-offset-key="8073:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一步，进入 iam 项目源码根目录。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8074"><span data-slate-object="text" data-key="8075"><span data-slate-leaf="true" data-offset-key="8075:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二步，配置 accesss.yaml</span></span></span></span><span data-slate-object="text" data-key="8076"><span data-slate-leaf="true" data-offset-key="8076:0" data-first-offset="true"><span data-slate-string="true">（工具根据此配置，自动生成 iptables 设置脚本），内容如下（</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="8077"><span data-slate-object="text" data-key="8078"><span data-slate-leaf="true" data-offset-key="8078:0" data-first-offset="true"><span data-slate-string="true">configs/access.yaml</span></span></span></a><span data-slate-object="text" data-key="8079"><span data-slate-leaf="true" data-offset-key="8079:0" data-first-offset="true"><span data-slate-string="true"> 文件）：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8080"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8081"><span data-slate-object="text" data-key="8082"><span data-slate-leaf="true" data-offset-key="8082:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 允许登录 SSH 节点的来源 IP，可以是固定 IP (例如 10.0.4.2)，也可以是个网段，0.0.0.0/0 代表不限制来源 IP</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8083"><span data-slate-object="text" data-key="8084"><span data-slate-leaf="true" data-offset-key="8084:0" data-first-offset="true"><span data-slate-string="true">ssh-source: </span></span></span><span data-slate-object="text" data-key="8085"><span data-slate-leaf="true" data-offset-key="8085:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.0</span></span></span></span><span data-slate-object="text" data-key="8086"><span data-slate-leaf="true" data-offset-key="8086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.4</span></span></span></span><span data-slate-object="text" data-key="8087"><span data-slate-leaf="true" data-offset-key="8087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="8088"><span data-slate-leaf="true" data-offset-key="8088:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span><span data-slate-object="text" data-key="8089"><span data-slate-leaf="true" data-offset-key="8089:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">24</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8090"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8091"><span data-slate-object="text" data-key="8092"><span data-slate-leaf="true" data-offset-key="8092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的应用端口列表（iam-apiserver, iam-authz-server, iam-pump 对外暴露的的端口）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8093"><span data-slate-object="text" data-key="8094"><span data-slate-leaf="true" data-offset-key="8094:0" data-first-offset="true"><span data-slate-string="true">ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8095"><span data-slate-object="text" data-key="8096"><span data-slate-leaf="true" data-offset-key="8096:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8097"><span data-slate-leaf="true" data-offset-key="8097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8080</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8098"><span data-slate-object="text" data-key="8099"><span data-slate-leaf="true" data-offset-key="8099:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8100"><span data-slate-leaf="true" data-offset-key="8100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8101"><span data-slate-object="text" data-key="8102"><span data-slate-leaf="true" data-offset-key="8102:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8103"><span data-slate-leaf="true" data-offset-key="8103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9090</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8104"><span data-slate-object="text" data-key="8105"><span data-slate-leaf="true" data-offset-key="8105:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8106"><span data-slate-leaf="true" data-offset-key="8106:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9443</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8107"><span data-slate-object="text" data-key="8108"><span data-slate-leaf="true" data-offset-key="8108:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8109"><span data-slate-leaf="true" data-offset-key="8109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">7070</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8110"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8111"><span data-slate-object="text" data-key="8112"><span data-slate-leaf="true" data-offset-key="8112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 来源 IP 可以访问的数据库端口列表（Redis, MariaDB, MongoDB）</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8113"><span data-slate-object="text" data-key="8114"><span data-slate-leaf="true" data-offset-key="8114:0" data-first-offset="true"><span data-slate-string="true">dbports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8115"><span data-slate-object="text" data-key="8116"><span data-slate-leaf="true" data-offset-key="8116:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8117"><span data-slate-leaf="true" data-offset-key="8117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3306</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8118"><span data-slate-object="text" data-key="8119"><span data-slate-leaf="true" data-offset-key="8119:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8120"><span data-slate-leaf="true" data-offset-key="8120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6379</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8121"><span data-slate-object="text" data-key="8122"><span data-slate-leaf="true" data-offset-key="8122:0" data-first-offset="true"><span data-slate-string="true">  - </span></span></span><span data-slate-object="text" data-key="8123"><span data-slate-leaf="true" data-offset-key="8123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">27017</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8124"><span data-slate-object="text" data-key="8125"><span data-slate-leaf="true" data-offset-key="8125:0" data-first-offset="true"><span data-slate-string="true">上面配置中，我们仅仅指定了 IAM 服务端口和数据库端口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8126"><span data-slate-object="text" data-key="8127"><span data-slate-leaf="true" data-offset-key="8127:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第三步，生成 iptables 初始化脚本：</span></span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8128"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8129"><span data-slate-object="text" data-key="8130"><span data-slate-leaf="true" data-offset-key="8130:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t app --cidr=10.0.4.0/24 -a -o firewall.sh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8131"><span data-slate-object="text" data-key="8132"><span data-slate-leaf="true" data-offset-key="8132:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="8133"><span data-slate-leaf="true" data-offset-key="8133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ls</span></span></span></span><span data-slate-object="text" data-key="8134"><span data-slate-leaf="true" data-offset-key="8134:0" data-first-offset="true"><span data-slate-string="true"> firewall.sh</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8135"><span data-slate-object="text" data-key="8136"><span data-slate-leaf="true" data-offset-key="8136:0" data-first-offset="true"><span data-slate-string="true">firewall.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8137"><span data-slate-object="text" data-key="8138"><span data-slate-leaf="true" data-offset-key="8138:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第四步，将 firewall.sh 脚本拷贝到 10.0.4.20 和 10.0.4.21 节点执行：</span></span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8139"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8140"><span data-slate-object="text" data-key="8141"><span data-slate-leaf="true" data-offset-key="8141:0" data-first-offset="true"><span data-slate-string="true">$ scp firewall.sh root@10.0.4.20:/tmp/</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8142"><span data-slate-object="text" data-key="8143"><span data-slate-leaf="true" data-offset-key="8143:0" data-first-offset="true"><span data-slate-string="true">$ scp firewall.sh root@10.0.4.21:/tmp/</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8144"><span data-slate-object="text" data-key="8145"><span data-slate-leaf="true" data-offset-key="8145:0" data-first-offset="true"><span data-slate-string="true">登陆 10.0.4.20 和 10.0.4.21 机器执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="8146"><span data-slate-object="text" data-key="8147"><span data-slate-leaf="true" data-offset-key="8147:0" data-first-offset="true"><span data-slate-string="true">/tmp/firewall.sh</span></span></span></span><span data-slate-object="text" data-key="8148"><span data-slate-leaf="true" data-offset-key="8148:0" data-first-offset="true"><span data-slate-string="true"> 。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8149"><span data-slate-object="text" data-key="8150"><span data-slate-leaf="true" data-offset-key="8150:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第五步，在 10.0.4.20（数据库节点）节点上，设置 iptables 规则，以允许各节点访问。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8151"><span data-slate-object="text" data-key="8152"><span data-slate-leaf="true" data-offset-key="8152:0" data-first-offset="true"><span data-slate-string="true">因为数据库节点也位于 10.0.4.20 节点，所以只需要添加新的 rule，并将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="8153"><span data-slate-object="text" data-key="8154"><span data-slate-leaf="true" data-offset-key="8154:0" data-first-offset="true"><span data-slate-string="true">iptables -A INPUT -j DROP</span></span></span></span><span data-slate-object="text" data-key="8155"><span data-slate-leaf="true" data-offset-key="8155:0" data-first-offset="true"><span data-slate-string="true"> 规则放到最后执行即可。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="8156"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8157"><span data-slate-object="text" data-key="8158"><span data-slate-leaf="true" data-offset-key="8158:0" data-first-offset="true"><span data-slate-string="true">$ go run tools/geniptables/main.go -c access.yaml -t db --cidr=10.0.4.0/24 -o addrules.sh</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8159"><span data-slate-object="text" data-key="8160"><span data-slate-leaf="true" data-offset-key="8160:0" data-first-offset="true"><span data-slate-string="true">然后，将 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="8161"><span data-slate-object="text" data-key="8162"><span data-slate-leaf="true" data-offset-key="8162:0" data-first-offset="true"><span data-slate-string="true">addrules.sh</span></span></span></span><span data-slate-object="text" data-key="8163"><span data-slate-leaf="true" data-offset-key="8163:0" data-first-offset="true"><span data-slate-string="true"> 脚本拷贝到 10.0.4.20 节点执行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8164"><span data-slate-object="text" data-key="8165"><span data-slate-leaf="true" data-offset-key="8165:0" data-first-offset="true"><span data-slate-string="true">如果要增加节点，你只需要重新执行第三步，生成 firewall.sh 脚本，并将 firewall.sh 脚本拷贝到新节点上执行即可。删除节点，则不需要做任何操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8166"><span data-slate-object="text" data-key="8167"><span data-slate-leaf="true" data-offset-key="8167:0" data-first-offset="true"><span data-slate-string="true">接下来，我们再来看下如何对 IAM 应用进行弹性伸缩操作。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="8168" id="sr-toc-7"><span data-slate-object="text" data-key="8169"><span data-slate-leaf="true" data-offset-key="8169:0" data-first-offset="true"><span data-slate-string="true">弹性伸缩</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="8170"><span data-slate-object="text" data-key="8171"><span data-slate-leaf="true" data-offset-key="8171:0" data-first-offset="true"><span data-slate-string="true">弹性伸缩包括扩容和缩容。扩容是指当业务量越来越大时，能够很容易地增加计算节点，来分散工作负载，从而实现计算等能力的扩展。缩容是指当业务量变小时，能够很容易地减少计算节点，从而减小成本。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8172"><span data-slate-object="text" data-key="8173"><span data-slate-leaf="true" data-offset-key="8173:0" data-first-offset="true"><span data-slate-string="true">在系统上线初期，通常业务量不会很大，但是随着产品的迭代，用户量的增多，系统承载的请求量会越来越多，系统承载的压力也会越来越大。这时，就需要我们的系统架构有能力进行水平扩容，以满足业务需求，同时避免因为系统负载过高造成系统雪崩。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8174"><span data-slate-object="text" data-key="8175"><span data-slate-leaf="true" data-offset-key="8175:0" data-first-offset="true"><span data-slate-string="true">一些电商系统，在双 11 这类促销活动之前会提前扩容计算节点，以应对即将到来的流量高峰。但是活动过后，流量会逐渐下降，这时就需要我们的系统有能力进行缩容，以减少计算节点，从而节省成本。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8176"><span data-slate-object="text" data-key="8177"><span data-slate-leaf="true" data-offset-key="8177:0" data-first-offset="true"><span data-slate-string="true">一个可伸缩的系统架构，是我们在进行系统设计时必须要保证的。如果系统不具有伸缩性，那么当我们后期需要扩缩容时，就需要对代码进行大改，不仅会增加额外的工作量，还会拖累产品的迭代速度。而且你想想，改完之后还要测试，发布之后，还可能因为代码变更引入 Bug。总之，不具伸缩性的系统架构可以说是后患无穷。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8178"><span data-slate-object="text" data-key="8179"><span data-slate-leaf="true" data-offset-key="8179:0" data-first-offset="true"><span data-slate-string="true">IAM 系统在设计之初就考虑到了系统的伸缩能力，我们可以很容易地对系统进行扩缩容。下面，我来分别介绍下如何对系统进行扩容和缩容。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="8180" id="sr-toc-8"><span data-slate-object="text" data-key="8181"><span data-slate-leaf="true" data-offset-key="8181:0" data-first-offset="true"><span data-slate-string="true">系统扩容</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="8182"><span data-slate-object="text" data-key="8183"><span data-slate-leaf="true" data-offset-key="8183:0" data-first-offset="true"><span data-slate-string="true">系统扩容的步骤很简单，你只需要进行下面这 5 步：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8184"><div data-slate-type="list-line" data-slate-object="block" data-key="8185"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="8186"><span data-slate-leaf="true" data-offset-key="8186:0" data-first-offset="true"><span data-slate-string="true">根据需要申请计算节点，如无特殊需求，计算节点的配置、操作系统等要跟已有的节点保持一致。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8187"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="8188"><span data-slate-leaf="true" data-offset-key="8188:0" data-first-offset="true"><span data-slate-string="true">在新的节点上部署 iam-apiserver、iam-authz-server、iam-pump，部署方式跟部署其他节点一样。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8189"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="8190"><span data-slate-leaf="true" data-offset-key="8190:0" data-first-offset="true"><span data-slate-string="true">在新节点部署 Nginx，并将新节点的 IP 加入到已有所有节点的 Nginx upstream 配置中，重启 Nginx。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8191"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="8192"><span data-slate-leaf="true" data-offset-key="8192:0" data-first-offset="true"><span data-slate-string="true">在新节点部署 Keepalived，并将新节点的 IP 加入到已有所有节点的 unicast_peer 配置中，重启 Keepalived。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8193"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="8194"><span data-slate-leaf="true" data-offset-key="8194:0" data-first-offset="true"><span data-slate-string="true">修改 iptables 规则，并刷新所有机器的 iptables。</span></span></span></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="8195" id="sr-toc-9"><span data-slate-object="text" data-key="8196"><span data-slate-leaf="true" data-offset-key="8196:0" data-first-offset="true"><span data-slate-string="true">系统缩容</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="8197"><span data-slate-object="text" data-key="8198"><span data-slate-leaf="true" data-offset-key="8198:0" data-first-offset="true"><span data-slate-string="true">系统缩容是系统扩容的逆向操作，也是 5 个步骤：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="8199"><div data-slate-type="list-line" data-slate-object="block" data-key="8200"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="8201"><span data-slate-leaf="true" data-offset-key="8201:0" data-first-offset="true"><span data-slate-string="true">根据需要，确定要删除的节点。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8202"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="8203"><span data-slate-leaf="true" data-offset-key="8203:0" data-first-offset="true"><span data-slate-string="true">关闭待删除节点的 iam-apiserver、iam-authz-server、iam-pump 服务。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8204"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="8205"><span data-slate-leaf="true" data-offset-key="8205:0" data-first-offset="true"><span data-slate-string="true">从所有保留节点的 Nginx upstream 配置中，删除待删除节点的 IP 地址，重启 Nginx。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8206"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="8207"><span data-slate-leaf="true" data-offset-key="8207:0" data-first-offset="true"><span data-slate-string="true">从所有保留节点的 Keepalived unicast_peer 配置中，删除待删除节点的 IP 地址，重启 Keepalived。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8208"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="8209"><span data-slate-leaf="true" data-offset-key="8209:0" data-first-offset="true"><span data-slate-string="true">修改 iptables 规则，并刷新所有保留机器的 iptables。</span></span></span></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="8210" id="sr-toc-10"><span data-slate-object="text" data-key="8211"><span data-slate-leaf="true" data-offset-key="8211:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="8212"><span data-slate-object="text" data-key="8213"><span data-slate-leaf="true" data-offset-key="8213:0" data-first-offset="true"><span data-slate-string="true">安全对于应用软件来说至关重要，在部署应用时，也一定要评估应用的安全性，并采取一定的措施来保证安全性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8214"><span data-slate-object="text" data-key="8215"><span data-slate-leaf="true" data-offset-key="8215:0" data-first-offset="true"><span data-slate-string="true">在进行软件部署时，保证应用安全性最简单有效的方式是使用 iptables 规则来加固系统。实现思路也很简单，就是使用 iptables 规则，只允许特定来源的 IP 访问特定的端口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8216"><span data-slate-object="text" data-key="8217"><span data-slate-leaf="true" data-offset-key="8217:0" data-first-offset="true"><span data-slate-string="true">在业务正式上线之后，可能会遇到业务高峰期或低峰期。业务高峰期，可能需要添加机器，提高系统的吞吐量，可以在新机器上安装需要扩容的服务组件，并安装和配置好 Nginx 和 Keepalived，之后将该服务器添加到 Nginx 的 upstream 中。在业务低峰期时，可以将服务器从 Nginx 的 upstream 列表中移除，并关停 IAM 应用的服务。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="8218" id="sr-toc-11"><span data-slate-object="text" data-key="8219"><span data-slate-leaf="true" data-offset-key="8219:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="8220"><div data-slate-type="list-line" data-slate-object="block" data-key="8221"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="8222"><span data-slate-leaf="true" data-offset-key="8222:0" data-first-offset="true"><span data-slate-string="true">请根据这一讲学习的内容，再增扩容一台机器。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="8223"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="8224"><span data-slate-leaf="true" data-offset-key="8224:0" data-first-offset="true"><span data-slate-string="true">思考下，你在应用部署时，还有哪些比较好的应用安全加固方法，欢迎在留言区分享。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8225"><span data-slate-object="text" data-key="8226"><span data-slate-leaf="true" data-offset-key="8226:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-12">精选留言 (5)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/64/53/c93b8110.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>daz2yy</span></div></div><div>系统缩容的时候逆向操作应该是从修改 iptables 开始 =&gt; keepalived =&gt; Nginx =&gt; 关闭服务 =&gt; 删除节点；不然先关闭了服务，这时候 nginx 还是会把流量导过来的吧？</div><div><p>作者回复：你这种方法更好，我优化下，强！</p></div><div><div>2021-09-01</div><div><div><i></i><span>3</span></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/4b/46/717d5cb9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 惜心（伟祺）</span></div></div><div>这课值了 整个大工程开发的全套啊</div><div><p>作者回复：哈哈哈，学完，能够完整开发一个 Go 项目了</p></div><div><div>2021-09-03</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/f8/26/a6ffea5b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>hi,guy</span></div></div><div>后面能不能补充下项目的可观测性章节，如此多服务怎么治理，有什么好的方法没有？</div><div><p>作者回复：可观测性、多服务治理这属于云原生了，这个专栏会涉及但不多。</p></div><div><div>2021-08-31</div><div><div><i></i><span>3</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
IAM 系统安全加固，Iptables 是 Linux 系统的防火墙，与 Netfilter 一起工作，对网络包进行过滤、修改、转发等操作。
详情先略过</div><div><div>2021-12-05</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/bf/86/c0cb35f0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>8.13.3.27.30</span></div></div><div>我们的服务是部署在 k8s 上的，防火墙这块要在哪里做？</div><div><p>作者回复：如果是自己维护的 K8s，防火墙是在宿主机这里做。</p></div><div><div>2021-12-01</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".j"><outline class="toc-level-h1" data-reactid=".j.0" style="width: 175px;"><active data-reactid=".j.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".j.0.1"><span data-reactid=".j.0.1.0"> 42 | 软件部署实战（下）：IAM 系统安全加固、水平扩缩容实战</span></a></outline><outline class="toc-level-h2" data-reactid=".j.1" style="width: 165px;"><active data-reactid=".j.1.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".j.1.1"><span data-reactid=".j.1.1.0">IAM 应用安全性加固</span></a></outline><outline class="toc-level-h3" data-reactid=".j.2" style="width: 155px;"><active data-reactid=".j.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".j.2.1"><span data-reactid=".j.2.1.0">iptables 简介</span></a></outline><outline class="toc-level-h3" data-reactid=".j.3" style="width: 155px;"><active data-reactid=".j.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".j.3.1"><span data-reactid=".j.3.1.0">网络数据包处理流程</span></a></outline><outline class="toc-level-h3" data-reactid=".j.4" style="width: 155px;"><active data-reactid=".j.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".j.4.1"><span data-reactid=".j.4.1.0">iptables 工具使用方式介绍</span></a></outline><outline class="toc-level-h3" data-reactid=".j.5" style="width: 155px;"><active data-reactid=".j.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".j.5.1"><span data-reactid=".j.5.1.0">IAM 安全加固（内网不安全）</span></a></outline><outline class="toc-level-h3" data-reactid=".j.6" style="width: 155px;"><active data-reactid=".j.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".j.6.1"><span data-reactid=".j.6.1.0">IAM 安全加固（内网安全）</span></a></outline><outline class="toc-level-h2" data-reactid=".j.7" style="width: 165px;"><active data-reactid=".j.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".j.7.1"><span data-reactid=".j.7.1.0">弹性伸缩</span></a></outline><outline class="toc-level-h3" data-reactid=".j.8" style="width: 155px;"><active data-reactid=".j.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".j.8.1"><span data-reactid=".j.8.1.0">系统扩容</span></a></outline><outline class="toc-level-h3" data-reactid=".j.9" style="width: 155px;"><active data-reactid=".j.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".j.9.1"><span data-reactid=".j.9.1.0">系统缩容</span></a></outline><outline class="toc-level-h2" data-reactid=".j.a" style="width: 165px;"><active data-reactid=".j.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".j.a.1"><span data-reactid=".j.a.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".j.b" style="width: 165px;"><active data-reactid=".j.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".j.b.1"><span data-reactid=".j.b.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".j.c" style="width: 165px;"><active data-reactid=".j.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".j.c.1"><span data-reactid=".j.c.1.0">精选留言 (5)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/413279" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>