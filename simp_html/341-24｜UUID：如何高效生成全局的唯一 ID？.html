
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAA7VBMVEUAAAD///8ZGRnw8PBWVlb4+PgeHh719fVEREQlJSUODg6Ojo7Ly8v9/f1NTU2VlZUFBQV6enrCwsLy8vLh4eE0NDQLCwu8vLyXl5dxcXHa2trAwMCFhYVDQ0OysrKampo7OzssLCwICAioqKjJyckhISHu7u4/Pz9TU1NQUFBLS0tAQED6+vrS0tKRkZFISEgvLy+goKB+fn5vb29nZ2fm5uYbGxvk5OTX19d2dnZaWlre3t5hYWEyMjK5ubkoKCgVFRXQ0NDMzMzFxcW0tLSsrKykpKSMjIzq6urU1NSAgICvr6+cnJyHh4dsbGyfc25QAAAFkElEQVRIx4WXB3faMBCA74wHxgMMGAOh1MyyVyBAmtVmd/3/n1OdDtWstt/Li5JD35MtnU4CMnCIlkLEOpSKuMPhuI4FE444L9+dyv3zciad/rAjfU/yOPpGcjWS1NKSGsk29WTSD1IeYsIPkvsAJF+C5BIZkieYMNjJnsF4+JHk61wOSlVDyOIPqKBgZIxYTrqy/AmNtC1ps7yqlgE6dgYa1WqD5aV9SbKDbe6ZNnCq5A5ILlhGjEASIoawJdmHHo98AZLOnmxzKM9yK9Aht63FoAWBBmEgsEHnkfMgsZU8PJbpbXJd3MIep/Lg/MjbRqMRRuNtQ4Tthga5RiNzfmSWD97ZExQ64HhtgLb3CmbBGyj54vixjyeMsKjnV4AvOAHTwsHphKnH9toXki7Li3jLsgswizskv+c3PHKXe7ZHu5E/YMKcM2yqZIJkAclZTPClbJezivI1yTr4f+TeMib5qXxHsr7XtUFJDIc8pLAHA7Su4JXkd8ySnKZddQXH2NohswIutRu0Qu0jyS46JPugU+gISB1R8NBKWegVUsahTKEjAP9Bm5bKAc3DPlzjKaDvscE7PeEJu63WUg9a82tdA1O/ESupL9Cr6C1cXetjIe9zgQ4kvKLgHi6xC5LcGq9hhmiK0AYgUvLQtzm3n/x0jnum/Vo9j1jxg/pL3/f9W8isMOsv6/Ubf47rvl+u17nnZ1xQ+4iIXa6IpRVeimEEE3pnxO8kIz4CbFDyidVSpooBCCLLsj5noFlqUg2rwK0l+Anmm+VhCzKfrRHtqjGOLANxUKIUiYvFEcuaaZpXANniD5ZzpiBDTSRkuDJfWM6awxGuikUArp7fIOE7RlB6OygGTyhfsMyrtwDNIAkcp1YRhKC9Oh2IHUFQ6UPupnLL3icODaD5zVlUto7zhm1n7kmZ5kDSQBxykfZhD66eaQBoWriEGPcA182C4Crst90Z9NwvHgahDTALw/Ae4D500Pjq3oj/4sjtwcwVrCkkgB01HB8cdM0iIlWSr6IpNqFO+1mDHQFWORtO5EIi08b4jxy6giBsgKDnRnEYYdd9nIYvaLmuhS/h9DF5bEFr/7HTKAjUqWY1oUUBKgYEZdgIP6gJE2xQIWVvLhZBcAWx843kz87PDDi4cgR92s8/1FLpAGNeKiUbGtRQEIPkGb9TM1EF8MpCVEni7pIkkUdDs1ZcI/ZUer6YZg4WxTtqMmYsZJWebbOzEekZV4sCKaNhBaXQQ0NtjL71ZooNE1vWLfyyyFUbw7MsD0fWOFMSqAnbwj1Kuk0Aqp4aJ91MZhhvyS7+oQoMy5v63Jfoz/UYfPSiep2KQb5e4/gt1Ycdc7Se6jNyVbpuQNI08FrICQ6ccKnSXddrKCnqkqWFupJFAewKudSTBVAyBEjrLSXjCYnc5rrdQVl6VaiKqOTToi/kaSrlcW5fpGpgrlJTLvoGVxKDOg7PHzc6NLXOmuUHTZQhTWvS4T7T5ixPqGPz/EHXp/azkMeQoGOqBBOSq1gD4vwRe1culz8W8HlZKQt6Sjbm5XeS9eWizJw73HcsOW8mSpa0eT8zfK1w85LdtWKTf5dWfCPzMg5J+MBdsvvy6Q2QD/d91sfzouRz9zAdBp6HCcUzskccyBdKzjTC9ZE8HT8+JHLxtiE4d33Ud0uleOObvpXZk4E4/9h2sKD9t6oxgaCFxs9AHiI3wYJCndMbIMs9lLi7vEHFLxAUURyciOnTyzrLH6qSJwo+8CWuQIFL2wSoVyvQea/qtk2yvPtb4mekZMhJQkPwyvIzBbJGJD+jX3eGcfIFhWVmxsVAG5FMgSzm9y4wKL8aJdzvyctoTqEgep6K5lckWGM3uuuA5DadFvIhiTzBL1xzVtT0UDEDxd9ldeutcJLoyvUaoPgNdiqckZLamd0AAAAASUVORK5CYII=")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 24｜UUID：如何高效生成全局的唯一 ID？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>24｜UUID：如何高效生成全局的唯一 ID？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">让我们一起来探索工程实战中每天都存在的算法问题吧！</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">24｜UUID：如何高效生成全局的唯一 ID？</h1><div><span>黄清昊</span> <span> 2022-02-15</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/79/1a/79978f19d00e1a32475yyd2c2686e21a.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：代录（老师近期生病）</span><span>大小：12.64M</span><span> 时长：13:50</span></div></div><audio title="24｜UUID：如何高效生成全局的唯一ID？" src="https://res001.geekbang.org/media/audio/c0/73/c07f92fd70503c6e9f6812a900a09973/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="11486" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="11487"><span data-slate-object="text" data-key="11488"><span data-slate-leaf="true" data-offset-key="11488:0" data-first-offset="true"><span data-slate-string="true">你好，我是微扰君。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11489"><span data-slate-object="text" data-key="11490"><span data-slate-leaf="true" data-offset-key="11490:0" data-first-offset="true"><span data-slate-string="true">今天我们来聊一聊在生产环境中非常常用的一个算法 —— 全局唯一 ID 生成算法，也就是我们通常说的 UUID。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11491"><span data-slate-object="text" data-key="11492"><span data-slate-leaf="true" data-offset-key="11492:0" data-first-offset="true"><span data-slate-string="true">就和我们在社会中都有自己的身份证号作为自己的唯一标示一样，在互联网的应用中，很多时候，我们需要能生成一个全局唯一的 ID，去区别不同业务场景下的不同数据，比如消息 ID、用户 ID、微博内容 ID 等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11493"><span data-slate-object="text" data-key="11494"><span data-slate-leaf="true" data-offset-key="11494:0" data-first-offset="true"><span data-slate-string="true">因为我们往往</span></span></span><span data-slate-object="text" data-key="11495"><span data-slate-leaf="true" data-offset-key="11495:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">需要通过这个 ID 去索引某个业务数据，所以一定要保证生成的 ID 在全局范围内是唯一的</span></span></span></span><span data-slate-object="text" data-key="11496"><span data-slate-leaf="true" data-offset-key="11496:0" data-first-offset="true"><span data-slate-string="true">，这也是 identifier 的本意，在部分情况下，冲突概率很小可能也是可以接受的。另外，这个 ID 通常需要按照某种规则有序排列，最常用的就是基于时间进行排序。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11497"><span data-slate-object="text" data-key="11498"><span data-slate-leaf="true" data-offset-key="11498:0" data-first-offset="true"><span data-slate-string="true">所以全局唯一 ID 的两个核心需求就是：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="11499"><div data-slate-type="list-line" data-slate-object="block" data-key="11500"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="11501"><span data-slate-leaf="true" data-offset-key="11501:0" data-first-offset="true"><span data-slate-string="true">全局唯一性</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11502"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="11503"><span data-slate-leaf="true" data-offset-key="11503:0" data-first-offset="true"><span data-slate-string="true">粗略有序性</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11504"><span data-slate-object="text" data-key="11505"><span data-slate-leaf="true" data-offset-key="11505:0" data-first-offset="true"><span data-slate-string="true">那业界是如何生成满足这两大需求的 ID，又有哪些方案呢？我们开始今天的学习。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11506" id="sr-toc-1"><span data-slate-object="text" data-key="11507"><span data-slate-leaf="true" data-offset-key="11507:0" data-first-offset="true"><span data-slate-string="true">单体环境</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11508"><span data-slate-object="text" data-key="11509"><span data-slate-leaf="true" data-offset-key="11509:0" data-first-offset="true"><span data-slate-string="true">在单体的应用中，保证 ID 的全局唯一，其实不是一个很大的问题，我们只需要提供一个在内存中的计数器，就可以完成对 ID 的颁发。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11510"><span data-slate-object="text" data-key="11511"><span data-slate-leaf="true" data-offset-key="11511:0" data-first-offset="true"><span data-slate-string="true">当然这样的 ID 可能会带有明确的含义，并被暴露出去了，比如在票务系统中，如果这样设计，我们能根据电子票 ID 判断出自己买的是第几张票。这对安全性要求更高的业务来说，是不可接受的，但通过一些简单的加密算法混淆，我们就能解决这个问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11512"><span data-slate-object="text" data-key="11513"><span data-slate-leaf="true" data-offset-key="11513:0" data-first-offset="true"><span data-slate-string="true">总的来说，单节点的应用，因为所有产生新业务数据，而需要产生新 ID 的地方，都是同一个地方，复杂性是很可控的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11514" id="sr-toc-2"><span data-slate-object="text" data-key="11515"><span data-slate-leaf="true" data-offset-key="11515:0" data-first-offset="true"><span data-slate-string="true">分布式环境</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11516"><span data-slate-object="text" data-key="11517"><span data-slate-leaf="true" data-offset-key="11517:0" data-first-offset="true"><span data-slate-string="true">但在现在的分布式环境下，每一个简单的问题都变得更复杂了一些，我们来举一个具体的例子。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11518"><span data-slate-object="text" data-key="11519"><span data-slate-leaf="true" data-offset-key="11519:0" data-first-offset="true"><span data-slate-string="true">假设，现在有一个票务系统，每次出票请求的产生，都会产生一个对应的电子票 ID，毫无疑问这个 ID 需要是全局唯一的，否则会出现多个同学的票无法区分的情况。那假设我们的出票服务 TPS 比较高，</span></span></span><span data-slate-object="text" data-key="11520"><span data-slate-leaf="true" data-offset-key="11520:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">为了同时让多台服务器都可以颁发不重复的 ID，我们自然需要一种机制进行多台服务器之间的协调或者分配</span></span></span></span><span data-slate-object="text" data-key="11521"><span data-slate-leaf="true" data-offset-key="11521:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11522"><span data-slate-object="text" data-key="11523"><span data-slate-leaf="true" data-offset-key="11523:0" data-first-offset="true"><span data-slate-string="true">这个问题其实历史已久，解决方法也已经有很多了，我们一起来看看主流的解决方案是如何考虑的。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11524" id="sr-toc-3"><span data-slate-object="text" data-key="11525"><span data-slate-leaf="true" data-offset-key="11525:0" data-first-offset="true"><span data-slate-string="true">引入单点 ID 生成器</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11526"><span data-slate-object="text" data-key="11527"><span data-slate-leaf="true" data-offset-key="11527:0" data-first-offset="true"><span data-slate-string="true">先来看一个最简单的，也非常容易 DIY 的思路 —— 单点 ID 生成器。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11528"><span data-slate-object="text" data-key="11529"><span data-slate-leaf="true" data-offset-key="11529:0" data-first-offset="true"><span data-slate-string="true">通过这个方案，我们可以快速了解这个问题的解决思路，在接下来学习的过程中，你也可以边看边思考，对于这个全局唯一 ID 的生成，你有什么更好的改进主意。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11530"><span data-slate-object="text" data-key="11531"><span data-slate-leaf="true" data-offset-key="11531:0" data-first-offset="true"><span data-slate-string="true">我们在前面说了，单机里生成 ID 不是一个问题，</span></span></span><span data-slate-object="text" data-key="11532"><span data-slate-leaf="true" data-offset-key="11532:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在多节点中，我们仍然可以尝试自己手动打造一个单点的 ID 生成器，通常可以是一个独立部署的服务</span></span></span></span><span data-slate-object="text" data-key="11533"><span data-slate-leaf="true" data-offset-key="11533:0" data-first-offset="true"><span data-slate-string="true">，这样的服务，我们一般也称为 ID generate service。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11534"><span data-slate-object="text" data-key="11535"><span data-slate-leaf="true" data-offset-key="11535:0" data-first-offset="true"><span data-slate-string="true">也就是说，所有其他需要生成 ID 的服务，在需要生成 ID 的时候都不自己生成，而是全部访问这个单点的服务。因为单点的服务只有一台机器，我们很容易通过本地时钟和计数器来保证 ID 的唯一性和有序性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11536"><span data-slate-object="text" data-key="11537"><span data-slate-leaf="true" data-offset-key="11537:0" data-first-offset="true"><span data-slate-string="true">当然这里要重点注意的是，我们必须要能应对时钟回拨，或者服务器异常重启之后计数器不会重复的问题。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11538" id="sr-toc-4"><span data-slate-object="text" data-key="11539"><span data-slate-leaf="true" data-offset-key="11539:0" data-first-offset="true"><span data-slate-string="true">如何解决</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11540"><span data-slate-object="text" data-key="11541"><span data-slate-leaf="true" data-offset-key="11541:0" data-first-offset="true"><span data-slate-string="true">首先看第一个问题：时钟为什么会回拨呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11542"><span data-slate-object="text" data-key="11543"><span data-slate-leaf="true" data-offset-key="11543:0" data-first-offset="true"><span data-slate-string="true">如果你了解计算机如何计时的话就知道，计算机底层的计时主要依靠石英钟，它本身是有一定误差，所以计算机会定期地通过 NTP 服务，来同步更加接近真实时间的时间（仍然有一定的误差），这个时候就可能会产生时钟的一些跳跃。这里我们就不展开讲了，感兴趣的话。你可以自己去搜索一下 NTP 协议了解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11544"><span data-slate-object="text" data-key="11545"><span data-slate-leaf="true" data-offset-key="11545:0" data-first-offset="true"><span data-slate-string="true">真正影响更大的问题其实是第二个，</span></span></span><span data-slate-object="text" data-key="11546"><span data-slate-leaf="true" data-offset-key="11546:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如果计数器只是在内存中保存，一旦发生机器故障或者断电等情况，我们就无法知道之前的 ID 生成到什么位置了</span></span></span></span><span data-slate-object="text" data-key="11547"><span data-slate-leaf="true" data-offset-key="11547:0" data-first-offset="true"><span data-slate-string="true">，怎么办？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11548"><span data-slate-object="text" data-key="11549"><span data-slate-leaf="true" data-offset-key="11549:0" data-first-offset="true"><span data-slate-string="true">我们需要想办法有一定的持久化机制，也需要有一定的容灾备份的机制，要考虑的问题还是不少的。比如，对于单点服务挂了的情况下，首先想到可以用之前讲 Raft 和 MapReduce 的时候也提到过类似的提供一个备用服务的方案，来提高整个服务的高可用性，但这样，备用服务和主服务之间又如何同步状态，又成了新的问题，所以我们往往需要引入数据库等外部组件来解决。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11550"><span data-slate-object="text" data-key="11551"><span data-slate-leaf="true" data-offset-key="11551:0" data-first-offset="true"><span data-slate-string="true">哪怕解决了这两大问题，就这个设计本身来说，单点服务的一大限制是</span></span></span><span data-slate-object="text" data-key="11552"><span data-slate-leaf="true" data-offset-key="11552:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">性能不佳，如果每个请求都需要将状态持久化一下，并发量很容易遇到瓶颈</span></span></span></span><span data-slate-object="text" data-key="11553"><span data-slate-leaf="true" data-offset-key="11553:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11554"><span data-slate-object="text" data-key="11555"><span data-slate-leaf="true" data-offset-key="11555:0" data-first-offset="true"><span data-slate-string="true">所以这种方案在实际生产中并不常用，具体实现就留给你做课后的思考题，你可以想想，不借助任何外部组件，自己如何独立实现一个单点的 ID 生成器服务。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11556" id="sr-toc-5"><span data-slate-object="text" data-key="11557"><span data-slate-leaf="true" data-offset-key="11557:0" data-first-offset="true"><span data-slate-string="true">基于数据库实现 ID 生成器</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11558"><span data-slate-object="text" data-key="11559"><span data-slate-leaf="true" data-offset-key="11559:0" data-first-offset="true"><span data-slate-string="true">好我们继续想，既然直接自己写还是有许多问题需要考虑，那能不能利用现有的组件来实现呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11560"><span data-slate-object="text" data-key="11561"><span data-slate-leaf="true" data-offset-key="11561:0" data-first-offset="true"><span data-slate-string="true">我首先想到的方案就是数据库，还记得数据库中的主键吗，我们往往可以把主键设置成 auto_increment，这样在往数据库里插入一个元素的时候，就不需要我们提供 ID，而是数据库自动给我们生成一个呢？而且有了 auto_increment，我们也自然能保证字段的有序性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11562"><span data-slate-object="text" data-key="11563"><span data-slate-leaf="true" data-offset-key="11563:0" data-first-offset="true"><span data-slate-string="true">其实这正是天然的全局 ID 生成器。利用了外部组件自身的能力，我们基于数据库自增 ID 直接实现的 ID generate 非常简单，既可以保证唯一性，也可以保证有序性，ID 的步长也是可调的；而且数据库本身有非常好的可用性，能解决了我们对服务可靠性的顾虑。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11564"><span data-slate-object="text" data-key="11565"><span data-slate-leaf="true" data-offset-key="11565:0" data-first-offset="true"><span data-slate-string="true">但是同样有一个很大的限制，单点数据库的写入性能可能不是特别好，作为 ID 生成器，可能成为整个系统的性能瓶颈。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11566"><span data-slate-object="text" data-key="11567"><span data-slate-leaf="true" data-offset-key="11567:0" data-first-offset="true"><span data-slate-string="true">如何优化呢？我们一起来想一想。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11568" id="sr-toc-6"><span data-slate-object="text" data-key="11569"><span data-slate-leaf="true" data-offset-key="11569:0" data-first-offset="true"><span data-slate-string="true">水平扩展</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11570"><span data-slate-object="text" data-key="11571"><span data-slate-leaf="true" data-offset-key="11571:0" data-first-offset="true"><span data-slate-string="true">既然单点写性能不高，我们如果扩展多个库，平均分摊流量是不是就可以了呢？这也是非常常用的提高系统吞吐量的办法。接下来的问题就是，多个库之间如何分配 ID 呢？</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11572"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1e/6f/1e0b40c1d730a03ccbf098540c9f3a6f.jpg?wh=1920x1145"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11573"><span data-slate-object="text" data-key="11574"><span data-slate-leaf="true" data-offset-key="11574:0" data-first-offset="true"><span data-slate-string="true">为了让每个库都能有独立的 ID 范围不至于产生冲突，我们可以为它们设置比数据库数量更高的值，作为 auto_increment 的步长，而且每个库采用不同的初始值，这样自然就可以保证每个库所能分配的 ID 是错开的。比如两个数据库，一个持有所有偶数 ID，一个持有所有奇数 ID。其他业务系统只需要轮询两个数据库，就可以得到粗略有序的全局唯一 ID 了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11575"><span data-slate-object="text" data-key="11576"><span data-slate-leaf="true" data-offset-key="11576:0" data-first-offset="true"><span data-slate-string="true">为什么只是粗略有序，因为我们没办法保证所有依赖于此的服务，能按照时序轮流访问多个服务，但随着时间推移，只要负载均衡算法比较合理，整体 ID 还是在递增的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11577"><span data-slate-object="text" data-key="11578"><span data-slate-leaf="true" data-offset-key="11578:0" data-first-offset="true"><span data-slate-string="true">但这样的系统也往往有一个问题：一旦数据库的数量定好了，就不太好再随意增加，必须重新划分每个数据库的初始值和步长。不过通常来说，这个问题也比较好处理，可以一开始就根据业务规模，设置足够多个数据库作为 ID 生成器，来避免扩展的需要。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11579"><span data-slate-object="text" data-key="11580"><span data-slate-leaf="true" data-offset-key="11580:0" data-first-offset="true"><span data-slate-string="true">但是如果直接用数据库来产生序号，会面临数据库写入瓶颈的问题。不过估计你也想到了刚才单点服务的思路，</span></span></span><span data-slate-object="text" data-key="11581"><span data-slate-leaf="true" data-offset-key="11581:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如果我们把生成 ID 的响应服务和存储服务拆开，还是用单点对外提供 ID 发生服务，但是将 ID 状态记录在数据库中呢</span></span></span></span><span data-slate-object="text" data-key="11582"><span data-slate-leaf="true" data-offset-key="11582:0" data-first-offset="true"><span data-slate-string="true">？两者结合应该能获得更好的效果。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11583" id="sr-toc-7"><span data-slate-object="text" data-key="11584"><span data-slate-leaf="true" data-offset-key="11584:0" data-first-offset="true"><span data-slate-string="true">利用单点服务</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11585"><span data-slate-object="text" data-key="11586"><span data-slate-leaf="true" data-offset-key="11586:0" data-first-offset="true"><span data-slate-string="true">具体做法就是在需要产生新的全局 ID 的时候，每次单点服务都向数据库批量申请 n 个 ID，在本地用内存维护这个号段，并把数据库中的 ID 修改为当前值 +n，直到这 n 个 ID 被耗尽；下次需要产生新的全局 ID 的时候，再次到数据库申请一段新的号段。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11587"><span data-slate-object="text" data-key="11588"><span data-slate-leaf="true" data-offset-key="11588:0" data-first-offset="true"><span data-slate-string="true">如果 ID 被耗尽之前，单点服务就挂了，也没关系，我们重启的时候直接向数据库申请下一次批次的 ID 就行，最多也就导致继续生成的 ID 和之前的批次不连续，这在大部分场景中都是可以接受的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11589"><span data-slate-object="text" data-key="11590"><span data-slate-leaf="true" data-offset-key="11590:0" data-first-offset="true"><span data-slate-string="true">这样批量处理的设计，能大大减少数据库写的次数，把压力变成了原来的 1/n，性能大大提升，往往可以承载 10w 级的 QPS。这也是非常常见的减少服务压力的策略。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11591" id="sr-toc-8"><span data-slate-object="text" data-key="11592"><span data-slate-leaf="true" data-offset-key="11592:0" data-first-offset="true"><span data-slate-string="true">UUID</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11593"><span data-slate-object="text" data-key="11594"><span data-slate-leaf="true" data-offset-key="11594:0" data-first-offset="true"><span data-slate-string="true">UUID（universally unique identifier） 这个词我们一开始就提到了，相信你不会很陌生，它本身就可以翻译成全局唯一 ID，但同时它也是一种常见的生成全局唯一 ID 的算法和协议。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11595"><span data-slate-object="text" data-key="11596"><span data-slate-leaf="true" data-offset-key="11596:0" data-first-offset="true"><span data-slate-string="true">和前面我们思考的两种方案不同，</span></span></span><span data-slate-object="text" data-key="11597"><span data-slate-leaf="true" data-offset-key="11597:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这次的 ID 不再需要通过远程调用一个独立的服务产生，而是直接在业务侧的服务本地产生，所以 UUID 通常也被实现为一个库，供业务方直接调用</span></span></span></span><span data-slate-object="text" data-key="11598"><span data-slate-leaf="true" data-offset-key="11598:0" data-first-offset="true"><span data-slate-string="true">。UUID 有很多个不同的版本，网络上不同库的实现也可能会略有区别。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11599"><span data-slate-object="text" data-key="11600"><span data-slate-leaf="true" data-offset-key="11600:0" data-first-offset="true"><span data-slate-string="true">UUID 一共包含 32 位 16 进制数，也就是相当于 128 位二进制数，显示的时候被分为 8-4-4-4-12 几个部分，看一个例子：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="11601"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11602"><span data-slate-object="text" data-key="11603"><span data-slate-leaf="true" data-offset-key="11603:0" data-first-offset="true"><span data-slate-string="true">0725f9ac-8cc1-11ec-a8a3-0242ac120002</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11604"><span data-slate-object="text" data-key="11605"><span data-slate-leaf="true" data-offset-key="11605:0" data-first-offset="true"><span data-slate-string="true">我们就用 JDK 中自带的 UUID，来讲解一下第三和第四个版本的使用和主要思想，背后的逻辑主要是一些复杂的位运算，解释起来比较麻烦，对我们实际业务开发帮助不大，你感兴趣的话可以自己去看看相关的</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11606"><span data-slate-object="text" data-key="11607"><span data-slate-leaf="true" data-offset-key="11607:0" data-first-offset="true"><span data-slate-string="true">源代码</span></span></span></a><span data-slate-object="text" data-key="11608"><span data-slate-leaf="true" data-offset-key="11608:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11609"><span data-slate-object="text" data-key="11610"><span data-slate-leaf="true" data-offset-key="11610:0" data-first-offset="true"><span data-slate-string="true">第三个版本的方法是基于名字计算的，名字由用户传入，它保证了不同空间不同名字下的 UUID 都具有唯一性，而相同空间相同名字下的 UUID 则是相同的：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="11611"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11612"><span data-slate-object="text" data-key="11613"><span data-slate-leaf="true" data-offset-key="11613:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11614"><span data-slate-leaf="true" data-offset-key="11614:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11615"><span data-slate-leaf="true" data-offset-key="11615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11616"><span data-slate-leaf="true" data-offset-key="11616:0" data-first-offset="true"><span data-slate-string="true"> UUID </span></span></span><span data-slate-object="text" data-key="11617"><span data-slate-leaf="true" data-offset-key="11617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nameUUIDFromBytes</span></span></span></span><span data-slate-object="text" data-key="11618"><span data-slate-leaf="true" data-offset-key="11618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="11619"><span data-slate-leaf="true" data-offset-key="11619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span></span><span data-slate-object="text" data-key="11620"><span data-slate-leaf="true" data-offset-key="11620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">[] name)</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11621"><span data-slate-object="text" data-key="11622"><span data-slate-leaf="true" data-offset-key="11622:0" data-first-offset="true"><span data-slate-string="true">name 是用户自行传入的一段二进制，UUID 包会对其进行 MD5 计算以及一些位运算，最终得到一个 UUID。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11623"><span data-slate-object="text" data-key="11624"><span data-slate-leaf="true" data-offset-key="11624:0" data-first-offset="true"><span data-slate-string="true">第四个版本更加常用也更加直接一点，就是直接基于随机性进行计算，因为 UUID 非常长，所以其重复概率可以忽略不计。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="11625"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11626"><span data-slate-object="text" data-key="11627"><span data-slate-leaf="true" data-offset-key="11627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11628"><span data-slate-leaf="true" data-offset-key="11628:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11629"><span data-slate-leaf="true" data-offset-key="11629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11630"><span data-slate-leaf="true" data-offset-key="11630:0" data-first-offset="true"><span data-slate-string="true"> UUID </span></span></span><span data-slate-object="text" data-key="11631"><span data-slate-leaf="true" data-offset-key="11631:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nameUUIDFromBytes</span></span></span></span><span data-slate-object="text" data-key="11632"><span data-slate-leaf="true" data-offset-key="11632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="11633"><span data-slate-leaf="true" data-offset-key="11633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span></span><span data-slate-object="text" data-key="11634"><span data-slate-leaf="true" data-offset-key="11634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">[] name)</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11635"><span data-slate-object="text" data-key="11636"><span data-slate-leaf="true" data-offset-key="11636:0" data-first-offset="true"><span data-slate-string="true">两个版本的使用都很简单：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="11637"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11638"><span data-slate-object="text" data-key="11639"><span data-slate-leaf="true" data-offset-key="11639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">UUID</span></span></span></span><span data-slate-object="text" data-key="11640"><span data-slate-leaf="true" data-offset-key="11640:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11641"><span data-slate-leaf="true" data-offset-key="11641:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uuid</span></span></span></span><span data-slate-object="text" data-key="11642"><span data-slate-leaf="true" data-offset-key="11642:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11643"><span data-slate-leaf="true" data-offset-key="11643:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11644"><span data-slate-leaf="true" data-offset-key="11644:0" data-first-offset="true"><span data-slate-string="true"> UUID.randomUUID(); </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11645"><span data-slate-object="text" data-key="11646"><span data-slate-leaf="true" data-offset-key="11646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">UUID</span></span></span></span><span data-slate-object="text" data-key="11647"><span data-slate-leaf="true" data-offset-key="11647:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11648"><span data-slate-leaf="true" data-offset-key="11648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uuid_</span></span></span></span><span data-slate-object="text" data-key="11649"><span data-slate-leaf="true" data-offset-key="11649:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11650"><span data-slate-leaf="true" data-offset-key="11650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11651"><span data-slate-leaf="true" data-offset-key="11651:0" data-first-offset="true"><span data-slate-string="true"> UUID.nameUUIDFromBytes(nbyte);</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11652"><span data-slate-object="text" data-key="11653"><span data-slate-leaf="true" data-offset-key="11653:0" data-first-offset="true"><span data-slate-string="true">但 UUID 过于冗长，且主流版本完全无序，对数据库存储非常不利，这点我们之后介绍 B+ 树的时候也会展开讨论。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11654" id="sr-toc-9"><span data-slate-object="text" data-key="11655"><span data-slate-leaf="true" data-offset-key="11655:0" data-first-offset="true"><span data-slate-string="true">Snowflake</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11656"><span data-slate-object="text" data-key="11657"><span data-slate-leaf="true" data-offset-key="11657:0" data-first-offset="true"><span data-slate-string="true">除了用户自己传入 name 来计算 UUID，UUID 其他几个版本里也有用到 MAC 地址，利用全球唯一性来标识不同的机器以及利用时间来保证有序性。不过 Mac 地址属于用户隐私，暴露出去不太好，也没有被广泛使用，但是思想还是可以被借鉴的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11658"><span data-slate-object="text" data-key="11659"><span data-slate-leaf="true" data-offset-key="11659:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Snowflake 就是这样一种引入了机器编号和时间信息的分布式 ID 生成算法</span></span></span></span><span data-slate-object="text" data-key="11660"><span data-slate-leaf="true" data-offset-key="11660:0" data-first-offset="true"><span data-slate-string="true">，也是由业务方本地执行，由 twitter 开源，国内的美团和百度也都开源了基于各自业务场景的类似算法，感兴趣的同学可以搜索 leaf 和 UUID-generator，性能都很不错。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11661"><span data-slate-object="text" data-key="11662"><span data-slate-leaf="true" data-offset-key="11662:0" data-first-offset="true"><span data-slate-string="true">整个 Snowflake 生成的 UUID 都是 64 位的长整型，分为四个部分。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11663"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b4/1c/b4e2b2a16d52b41d124f095fddf54a1c.jpg?wh=2312x1379"></div></div><div data-slate-type="list" data-slate-object="block" data-key="11664"><div data-slate-type="list-line" data-slate-object="block" data-key="11665"><span data-slate-object="text" data-key="11666"><span data-slate-leaf="true" data-offset-key="11666:0" data-first-offset="true"><span data-slate-string="true">第一位是位保留位，置 0。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="11667"><span data-slate-object="text" data-key="11668"><span data-slate-leaf="true" data-offset-key="11668:0" data-first-offset="true"><span data-slate-string="true">后面连续 41 位存储时间戳，可到毫秒级精度。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="11669"><span data-slate-object="text" data-key="11670"><span data-slate-leaf="true" data-offset-key="11670:0" data-first-offset="true"><span data-slate-string="true">再后面 10 位代表机器 ID，由用户指定，相当于最多可以支持 1024 台机器。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="11671"><span data-slate-object="text" data-key="11672"><span data-slate-leaf="true" data-offset-key="11672:0" data-first-offset="true"><span data-slate-string="true">最后 12 位表示序列号，是一个自增的序号，在时间相同的情况下，也就是 1ms 内可以支持 4096 个不同的序号，也就是在理论上来说 Snowflake 每秒可以产生 400w+ 个序号，这对于大部分业务场景来说都是绰绰有余的了。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11673"><span data-slate-object="text" data-key="11674"><span data-slate-leaf="true" data-offset-key="11674:0" data-first-offset="true"><span data-slate-string="true">Twitter 官方开源的版本是用 Scala 写的（网上也有人翻译了一个 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11675"><span data-slate-object="text" data-key="11676"><span data-slate-leaf="true" data-offset-key="11676:0" data-first-offset="true"><span data-slate-string="true">Java 版本</span></span></span></a><span data-slate-object="text" data-key="11677"><span data-slate-leaf="true" data-offset-key="11677:0" data-first-offset="true"><span data-slate-string="true">），因为思路其实很简单，所以代码也非常简洁，我这里写了点简单的注释，供你参考：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="11678"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div><div data-code-line-number="99"></div><div data-code-line-number="100"></div><div data-code-line-number="101"></div><div data-code-line-number="102"></div><div data-code-line-number="103"></div><div data-code-line-number="104"></div><div data-code-line-number="105"></div><div data-code-line-number="106"></div><div data-code-line-number="107"></div><div data-code-line-number="108"></div><div data-code-line-number="109"></div><div data-code-line-number="110"></div><div data-code-line-number="111"></div><div data-code-line-number="112"></div><div data-code-line-number="113"></div><div data-code-line-number="114"></div><div data-code-line-number="115"></div><div data-code-line-number="116"></div><div data-code-line-number="117"></div><div data-code-line-number="118"></div><div data-code-line-number="119"></div><div data-code-line-number="120"></div><div data-code-line-number="121"></div><div data-code-line-number="122"></div><div data-code-line-number="123"></div><div data-code-line-number="124"></div><div data-code-line-number="125"></div><div data-code-line-number="126"></div><div data-code-line-number="127"></div><div data-code-line-number="128"></div><div data-code-line-number="129"></div><div data-code-line-number="130"></div><div data-code-line-number="131"></div><div data-code-line-number="132"></div><div data-code-line-number="133"></div><div data-code-line-number="134"></div><div data-code-line-number="135"></div><div data-code-line-number="136"></div><div data-code-line-number="137"></div><div data-code-line-number="138"></div><div data-code-line-number="139"></div><div data-code-line-number="140"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11679"><span data-slate-object="text" data-key="11680"><span data-slate-leaf="true" data-offset-key="11680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="11681"><span data-slate-leaf="true" data-offset-key="11681:0" data-first-offset="true"><span data-slate-string="true"> com.callicoder.snowflake;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11682"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11683"><span data-slate-object="text" data-key="11684"><span data-slate-leaf="true" data-offset-key="11684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="11685"><span data-slate-leaf="true" data-offset-key="11685:0" data-first-offset="true"><span data-slate-string="true"> java.net.NetworkInterface;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11686"><span data-slate-object="text" data-key="11687"><span data-slate-leaf="true" data-offset-key="11687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="11688"><span data-slate-leaf="true" data-offset-key="11688:0" data-first-offset="true"><span data-slate-string="true"> java.security.SecureRandom;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11689"><span data-slate-object="text" data-key="11690"><span data-slate-leaf="true" data-offset-key="11690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="11691"><span data-slate-leaf="true" data-offset-key="11691:0" data-first-offset="true"><span data-slate-string="true"> java.time.Instant;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11692"><span data-slate-object="text" data-key="11693"><span data-slate-leaf="true" data-offset-key="11693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="11694"><span data-slate-leaf="true" data-offset-key="11694:0" data-first-offset="true"><span data-slate-string="true"> java.util.Enumeration;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11695"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11696"><span data-slate-object="text" data-key="11697"><span data-slate-leaf="true" data-offset-key="11697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/**</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11698"><span data-slate-object="text" data-key="11699"><span data-slate-leaf="true" data-offset-key="11699:0" data-first-offset="true"><span data-slate-string="true"> * Distributed Sequence Generator.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11700"><span data-slate-object="text" data-key="11701"><span data-slate-leaf="true" data-offset-key="11701:0" data-first-offset="true"><span data-slate-string="true"> * Inspired by Twitter snowflake: https://github.com/twitter/snowflake/tree/snowflake-2010</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11702"><span data-slate-object="text" data-key="11703"><span data-slate-leaf="true" data-offset-key="11703:0" data-first-offset="true"><span data-slate-string="true"> *</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11704"><span data-slate-object="text" data-key="11705"><span data-slate-leaf="true" data-offset-key="11705:0" data-first-offset="true"><span data-slate-string="true"> * This class should be used as a Singleton.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11706"><span data-slate-object="text" data-key="11707"><span data-slate-leaf="true" data-offset-key="11707:0" data-first-offset="true"><span data-slate-string="true"> * Make sure that you create and reuse a Single instance of Snowflake per node in your distributed system cluster.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11708"><span data-slate-object="text" data-key="11709"><span data-slate-leaf="true" data-offset-key="11709:0" data-first-offset="true"><span data-slate-string="true"> */</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11710"><span data-slate-object="text" data-key="11711"><span data-slate-leaf="true" data-offset-key="11711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11712"><span data-slate-leaf="true" data-offset-key="11712:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11713"><span data-slate-leaf="true" data-offset-key="11713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="11714"><span data-slate-leaf="true" data-offset-key="11714:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11715"><span data-slate-leaf="true" data-offset-key="11715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Snowflake</span></span></span></span><span data-slate-object="text" data-key="11716"><span data-slate-leaf="true" data-offset-key="11716:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11717"><span data-slate-object="text" data-key="11718"><span data-slate-leaf="true" data-offset-key="11718:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11719"><span data-slate-leaf="true" data-offset-key="11719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11720"><span data-slate-leaf="true" data-offset-key="11720:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11721"><span data-slate-leaf="true" data-offset-key="11721:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11722"><span data-slate-leaf="true" data-offset-key="11722:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11723"><span data-slate-leaf="true" data-offset-key="11723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11724"><span data-slate-leaf="true" data-offset-key="11724:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11725"><span data-slate-leaf="true" data-offset-key="11725:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="11726"><span data-slate-leaf="true" data-offset-key="11726:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11727"><span data-slate-leaf="true" data-offset-key="11727:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">UNUSED_BITS</span></span></span></span><span data-slate-object="text" data-key="11728"><span data-slate-leaf="true" data-offset-key="11728:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11729"><span data-slate-leaf="true" data-offset-key="11729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11730"><span data-slate-leaf="true" data-offset-key="11730:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11731"><span data-slate-leaf="true" data-offset-key="11731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="11732"><span data-slate-leaf="true" data-offset-key="11732:0" data-first-offset="true"><span data-slate-string="true">; </span></span></span><span data-slate-object="text" data-key="11733"><span data-slate-leaf="true" data-offset-key="11733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Sign bit, Unused (always set to 0)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11734"><span data-slate-object="text" data-key="11735"><span data-slate-leaf="true" data-offset-key="11735:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11736"><span data-slate-leaf="true" data-offset-key="11736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11737"><span data-slate-leaf="true" data-offset-key="11737:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11738"><span data-slate-leaf="true" data-offset-key="11738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11739"><span data-slate-leaf="true" data-offset-key="11739:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11740"><span data-slate-leaf="true" data-offset-key="11740:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11741"><span data-slate-leaf="true" data-offset-key="11741:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11742"><span data-slate-leaf="true" data-offset-key="11742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="11743"><span data-slate-leaf="true" data-offset-key="11743:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11744"><span data-slate-leaf="true" data-offset-key="11744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">EPOCH_BITS</span></span></span></span><span data-slate-object="text" data-key="11745"><span data-slate-leaf="true" data-offset-key="11745:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11746"><span data-slate-leaf="true" data-offset-key="11746:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11747"><span data-slate-leaf="true" data-offset-key="11747:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11748"><span data-slate-leaf="true" data-offset-key="11748:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">41</span></span></span></span><span data-slate-object="text" data-key="11749"><span data-slate-leaf="true" data-offset-key="11749:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11750"><span data-slate-object="text" data-key="11751"><span data-slate-leaf="true" data-offset-key="11751:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11752"><span data-slate-leaf="true" data-offset-key="11752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11753"><span data-slate-leaf="true" data-offset-key="11753:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11754"><span data-slate-leaf="true" data-offset-key="11754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11755"><span data-slate-leaf="true" data-offset-key="11755:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11756"><span data-slate-leaf="true" data-offset-key="11756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11757"><span data-slate-leaf="true" data-offset-key="11757:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11758"><span data-slate-leaf="true" data-offset-key="11758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="11759"><span data-slate-leaf="true" data-offset-key="11759:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11760"><span data-slate-leaf="true" data-offset-key="11760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NODE_ID_BITS</span></span></span></span><span data-slate-object="text" data-key="11761"><span data-slate-leaf="true" data-offset-key="11761:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11762"><span data-slate-leaf="true" data-offset-key="11762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11763"><span data-slate-leaf="true" data-offset-key="11763:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11764"><span data-slate-leaf="true" data-offset-key="11764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="11765"><span data-slate-leaf="true" data-offset-key="11765:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11766"><span data-slate-object="text" data-key="11767"><span data-slate-leaf="true" data-offset-key="11767:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11768"><span data-slate-leaf="true" data-offset-key="11768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11769"><span data-slate-leaf="true" data-offset-key="11769:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11770"><span data-slate-leaf="true" data-offset-key="11770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11771"><span data-slate-leaf="true" data-offset-key="11771:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11772"><span data-slate-leaf="true" data-offset-key="11772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11773"><span data-slate-leaf="true" data-offset-key="11773:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11774"><span data-slate-leaf="true" data-offset-key="11774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="11775"><span data-slate-leaf="true" data-offset-key="11775:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11776"><span data-slate-leaf="true" data-offset-key="11776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">SEQUENCE_BITS</span></span></span></span><span data-slate-object="text" data-key="11777"><span data-slate-leaf="true" data-offset-key="11777:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11778"><span data-slate-leaf="true" data-offset-key="11778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11779"><span data-slate-leaf="true" data-offset-key="11779:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11780"><span data-slate-leaf="true" data-offset-key="11780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">12</span></span></span></span><span data-slate-object="text" data-key="11781"><span data-slate-leaf="true" data-offset-key="11781:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11782"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11783"><span data-slate-object="text" data-key="11784"><span data-slate-leaf="true" data-offset-key="11784:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11785"><span data-slate-leaf="true" data-offset-key="11785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11786"><span data-slate-leaf="true" data-offset-key="11786:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11787"><span data-slate-leaf="true" data-offset-key="11787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11788"><span data-slate-leaf="true" data-offset-key="11788:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11789"><span data-slate-leaf="true" data-offset-key="11789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11790"><span data-slate-leaf="true" data-offset-key="11790:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11791"><span data-slate-leaf="true" data-offset-key="11791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11792"><span data-slate-leaf="true" data-offset-key="11792:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11793"><span data-slate-leaf="true" data-offset-key="11793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">maxNodeId</span></span></span></span><span data-slate-object="text" data-key="11794"><span data-slate-leaf="true" data-offset-key="11794:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11795"><span data-slate-leaf="true" data-offset-key="11795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11796"><span data-slate-leaf="true" data-offset-key="11796:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="11797"><span data-slate-leaf="true" data-offset-key="11797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1L</span></span></span></span><span data-slate-object="text" data-key="11798"><span data-slate-leaf="true" data-offset-key="11798:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt;NODE_ID_BITS) - </span></span></span><span data-slate-object="text" data-key="11799"><span data-slate-leaf="true" data-offset-key="11799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="11800"><span data-slate-leaf="true" data-offset-key="11800:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11801"><span data-slate-object="text" data-key="11802"><span data-slate-leaf="true" data-offset-key="11802:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11803"><span data-slate-leaf="true" data-offset-key="11803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11804"><span data-slate-leaf="true" data-offset-key="11804:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11805"><span data-slate-leaf="true" data-offset-key="11805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11806"><span data-slate-leaf="true" data-offset-key="11806:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11807"><span data-slate-leaf="true" data-offset-key="11807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11808"><span data-slate-leaf="true" data-offset-key="11808:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11809"><span data-slate-leaf="true" data-offset-key="11809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11810"><span data-slate-leaf="true" data-offset-key="11810:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11811"><span data-slate-leaf="true" data-offset-key="11811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">maxSequence</span></span></span></span><span data-slate-object="text" data-key="11812"><span data-slate-leaf="true" data-offset-key="11812:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11813"><span data-slate-leaf="true" data-offset-key="11813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11814"><span data-slate-leaf="true" data-offset-key="11814:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="11815"><span data-slate-leaf="true" data-offset-key="11815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1L</span></span></span></span><span data-slate-object="text" data-key="11816"><span data-slate-leaf="true" data-offset-key="11816:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt;SEQUENCE_BITS) - </span></span></span><span data-slate-object="text" data-key="11817"><span data-slate-leaf="true" data-offset-key="11817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="11818"><span data-slate-leaf="true" data-offset-key="11818:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11819"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11820"><span data-slate-object="text" data-key="11821"><span data-slate-leaf="true" data-offset-key="11821:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11822"><span data-slate-leaf="true" data-offset-key="11822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Custom Epoch (January 1, 2015 Midnight UTC = 2015-01-01T00:00:00Z)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11823"><span data-slate-object="text" data-key="11824"><span data-slate-leaf="true" data-offset-key="11824:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11825"><span data-slate-leaf="true" data-offset-key="11825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11826"><span data-slate-leaf="true" data-offset-key="11826:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11827"><span data-slate-leaf="true" data-offset-key="11827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="11828"><span data-slate-leaf="true" data-offset-key="11828:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11829"><span data-slate-leaf="true" data-offset-key="11829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11830"><span data-slate-leaf="true" data-offset-key="11830:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11831"><span data-slate-leaf="true" data-offset-key="11831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11832"><span data-slate-leaf="true" data-offset-key="11832:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11833"><span data-slate-leaf="true" data-offset-key="11833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">DEFAULT_CUSTOM_EPOCH</span></span></span></span><span data-slate-object="text" data-key="11834"><span data-slate-leaf="true" data-offset-key="11834:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11835"><span data-slate-leaf="true" data-offset-key="11835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11836"><span data-slate-leaf="true" data-offset-key="11836:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11837"><span data-slate-leaf="true" data-offset-key="11837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1420070400000L</span></span></span></span><span data-slate-object="text" data-key="11838"><span data-slate-leaf="true" data-offset-key="11838:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11839"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11840"><span data-slate-object="text" data-key="11841"><span data-slate-leaf="true" data-offset-key="11841:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11842"><span data-slate-leaf="true" data-offset-key="11842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11843"><span data-slate-leaf="true" data-offset-key="11843:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11844"><span data-slate-leaf="true" data-offset-key="11844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11845"><span data-slate-leaf="true" data-offset-key="11845:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11846"><span data-slate-leaf="true" data-offset-key="11846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11847"><span data-slate-leaf="true" data-offset-key="11847:0" data-first-offset="true"><span data-slate-string="true"> nodeId;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11848"><span data-slate-object="text" data-key="11849"><span data-slate-leaf="true" data-offset-key="11849:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11850"><span data-slate-leaf="true" data-offset-key="11850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11851"><span data-slate-leaf="true" data-offset-key="11851:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11852"><span data-slate-leaf="true" data-offset-key="11852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="11853"><span data-slate-leaf="true" data-offset-key="11853:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11854"><span data-slate-leaf="true" data-offset-key="11854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11855"><span data-slate-leaf="true" data-offset-key="11855:0" data-first-offset="true"><span data-slate-string="true"> customEpoch;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11856"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11857"><span data-slate-object="text" data-key="11858"><span data-slate-leaf="true" data-offset-key="11858:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11859"><span data-slate-leaf="true" data-offset-key="11859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11860"><span data-slate-leaf="true" data-offset-key="11860:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11861"><span data-slate-leaf="true" data-offset-key="11861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">volatile</span></span></span></span><span data-slate-object="text" data-key="11862"><span data-slate-leaf="true" data-offset-key="11862:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11863"><span data-slate-leaf="true" data-offset-key="11863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11864"><span data-slate-leaf="true" data-offset-key="11864:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11865"><span data-slate-leaf="true" data-offset-key="11865:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">lastTimestamp</span></span></span></span><span data-slate-object="text" data-key="11866"><span data-slate-leaf="true" data-offset-key="11866:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11867"><span data-slate-leaf="true" data-offset-key="11867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11868"><span data-slate-leaf="true" data-offset-key="11868:0" data-first-offset="true"><span data-slate-string="true"> -</span></span></span><span data-slate-object="text" data-key="11869"><span data-slate-leaf="true" data-offset-key="11869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1L</span></span></span></span><span data-slate-object="text" data-key="11870"><span data-slate-leaf="true" data-offset-key="11870:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11871"><span data-slate-object="text" data-key="11872"><span data-slate-leaf="true" data-offset-key="11872:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11873"><span data-slate-leaf="true" data-offset-key="11873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="11874"><span data-slate-leaf="true" data-offset-key="11874:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11875"><span data-slate-leaf="true" data-offset-key="11875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">volatile</span></span></span></span><span data-slate-object="text" data-key="11876"><span data-slate-leaf="true" data-offset-key="11876:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11877"><span data-slate-leaf="true" data-offset-key="11877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11878"><span data-slate-leaf="true" data-offset-key="11878:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11879"><span data-slate-leaf="true" data-offset-key="11879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sequence</span></span></span></span><span data-slate-object="text" data-key="11880"><span data-slate-leaf="true" data-offset-key="11880:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11881"><span data-slate-leaf="true" data-offset-key="11881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11882"><span data-slate-leaf="true" data-offset-key="11882:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11883"><span data-slate-leaf="true" data-offset-key="11883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0L</span></span></span></span><span data-slate-object="text" data-key="11884"><span data-slate-leaf="true" data-offset-key="11884:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11885"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11886"><span data-slate-object="text" data-key="11887"><span data-slate-leaf="true" data-offset-key="11887:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11888"><span data-slate-leaf="true" data-offset-key="11888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Create Snowflake with a nodeId and custom epoch</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11889"><span data-slate-object="text" data-key="11890"><span data-slate-leaf="true" data-offset-key="11890:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11891"><span data-slate-leaf="true" data-offset-key="11891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化需要传入节点 ID 和年代</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11892"><span data-slate-object="text" data-key="11893"><span data-slate-leaf="true" data-offset-key="11893:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11894"><span data-slate-leaf="true" data-offset-key="11894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11895"><span data-slate-leaf="true" data-offset-key="11895:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11896"><span data-slate-leaf="true" data-offset-key="11896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Snowflake</span></span></span></span><span data-slate-object="text" data-key="11897"><span data-slate-leaf="true" data-offset-key="11897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="11898"><span data-slate-leaf="true" data-offset-key="11898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span></span><span data-slate-object="text" data-key="11899"><span data-slate-leaf="true" data-offset-key="11899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> nodeId, </span></span></span></span><span data-slate-object="text" data-key="11900"><span data-slate-leaf="true" data-offset-key="11900:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span></span><span data-slate-object="text" data-key="11901"><span data-slate-leaf="true" data-offset-key="11901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> customEpoch)</span></span></span></span><span data-slate-object="text" data-key="11902"><span data-slate-leaf="true" data-offset-key="11902:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11903"><span data-slate-object="text" data-key="11904"><span data-slate-leaf="true" data-offset-key="11904:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11905"><span data-slate-leaf="true" data-offset-key="11905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="11906"><span data-slate-leaf="true" data-offset-key="11906:0" data-first-offset="true"><span data-slate-string="true">(nodeId &lt; </span></span></span><span data-slate-object="text" data-key="11907"><span data-slate-leaf="true" data-offset-key="11907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="11908"><span data-slate-leaf="true" data-offset-key="11908:0" data-first-offset="true"><span data-slate-string="true"> || nodeId &gt; maxNodeId) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11909"><span data-slate-object="text" data-key="11910"><span data-slate-leaf="true" data-offset-key="11910:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="11911"><span data-slate-leaf="true" data-offset-key="11911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="11912"><span data-slate-leaf="true" data-offset-key="11912:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11913"><span data-slate-leaf="true" data-offset-key="11913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="11914"><span data-slate-leaf="true" data-offset-key="11914:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11915"><span data-slate-leaf="true" data-offset-key="11915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">IllegalArgumentException</span></span></span></span><span data-slate-object="text" data-key="11916"><span data-slate-leaf="true" data-offset-key="11916:0" data-first-offset="true"><span data-slate-string="true">(String.format(</span></span></span><span data-slate-object="text" data-key="11917"><span data-slate-leaf="true" data-offset-key="11917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"NodeId must be between %d and %d"</span></span></span></span><span data-slate-object="text" data-key="11918"><span data-slate-leaf="true" data-offset-key="11918:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="11919"><span data-slate-leaf="true" data-offset-key="11919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="11920"><span data-slate-leaf="true" data-offset-key="11920:0" data-first-offset="true"><span data-slate-string="true">, maxNodeId));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11921"><span data-slate-object="text" data-key="11922"><span data-slate-leaf="true" data-offset-key="11922:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11923"><span data-slate-object="text" data-key="11924"><span data-slate-leaf="true" data-offset-key="11924:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11925"><span data-slate-leaf="true" data-offset-key="11925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11926"><span data-slate-leaf="true" data-offset-key="11926:0" data-first-offset="true"><span data-slate-string="true">.nodeId = nodeId;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11927"><span data-slate-object="text" data-key="11928"><span data-slate-leaf="true" data-offset-key="11928:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11929"><span data-slate-leaf="true" data-offset-key="11929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11930"><span data-slate-leaf="true" data-offset-key="11930:0" data-first-offset="true"><span data-slate-string="true">.customEpoch = customEpoch;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11931"><span data-slate-object="text" data-key="11932"><span data-slate-leaf="true" data-offset-key="11932:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11933"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11934"><span data-slate-object="text" data-key="11935"><span data-slate-leaf="true" data-offset-key="11935:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11936"><span data-slate-leaf="true" data-offset-key="11936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Create Snowflake with a nodeId</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11937"><span data-slate-object="text" data-key="11938"><span data-slate-leaf="true" data-offset-key="11938:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11939"><span data-slate-leaf="true" data-offset-key="11939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11940"><span data-slate-leaf="true" data-offset-key="11940:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11941"><span data-slate-leaf="true" data-offset-key="11941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Snowflake</span></span></span></span><span data-slate-object="text" data-key="11942"><span data-slate-leaf="true" data-offset-key="11942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="11943"><span data-slate-leaf="true" data-offset-key="11943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span></span><span data-slate-object="text" data-key="11944"><span data-slate-leaf="true" data-offset-key="11944:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> nodeId)</span></span></span></span><span data-slate-object="text" data-key="11945"><span data-slate-leaf="true" data-offset-key="11945:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11946"><span data-slate-object="text" data-key="11947"><span data-slate-leaf="true" data-offset-key="11947:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11948"><span data-slate-leaf="true" data-offset-key="11948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11949"><span data-slate-leaf="true" data-offset-key="11949:0" data-first-offset="true"><span data-slate-string="true">(nodeId, DEFAULT_CUSTOM_EPOCH);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11950"><span data-slate-object="text" data-key="11951"><span data-slate-leaf="true" data-offset-key="11951:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11952"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11953"><span data-slate-object="text" data-key="11954"><span data-slate-leaf="true" data-offset-key="11954:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11955"><span data-slate-leaf="true" data-offset-key="11955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Let Snowflake generate a nodeId</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11956"><span data-slate-object="text" data-key="11957"><span data-slate-leaf="true" data-offset-key="11957:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11958"><span data-slate-leaf="true" data-offset-key="11958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11959"><span data-slate-leaf="true" data-offset-key="11959:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11960"><span data-slate-leaf="true" data-offset-key="11960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Snowflake</span></span></span></span><span data-slate-object="text" data-key="11961"><span data-slate-leaf="true" data-offset-key="11961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="11962"><span data-slate-leaf="true" data-offset-key="11962:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11963"><span data-slate-object="text" data-key="11964"><span data-slate-leaf="true" data-offset-key="11964:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11965"><span data-slate-leaf="true" data-offset-key="11965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11966"><span data-slate-leaf="true" data-offset-key="11966:0" data-first-offset="true"><span data-slate-string="true">.nodeId = createNodeId();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11967"><span data-slate-object="text" data-key="11968"><span data-slate-leaf="true" data-offset-key="11968:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11969"><span data-slate-leaf="true" data-offset-key="11969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="11970"><span data-slate-leaf="true" data-offset-key="11970:0" data-first-offset="true"><span data-slate-string="true">.customEpoch = DEFAULT_CUSTOM_EPOCH;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11971"><span data-slate-object="text" data-key="11972"><span data-slate-leaf="true" data-offset-key="11972:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11973"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11974"><span data-slate-object="text" data-key="11975"><span data-slate-leaf="true" data-offset-key="11975:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11976"><span data-slate-leaf="true" data-offset-key="11976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 这个函数用于获取下一个 ID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11977"><span data-slate-object="text" data-key="11978"><span data-slate-leaf="true" data-offset-key="11978:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="11979"><span data-slate-leaf="true" data-offset-key="11979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="11980"><span data-slate-leaf="true" data-offset-key="11980:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11981"><span data-slate-leaf="true" data-offset-key="11981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">synchronized</span></span></span></span><span data-slate-object="text" data-key="11982"><span data-slate-leaf="true" data-offset-key="11982:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11983"><span data-slate-leaf="true" data-offset-key="11983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11984"><span data-slate-leaf="true" data-offset-key="11984:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11985"><span data-slate-leaf="true" data-offset-key="11985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nextId</span></span></span></span><span data-slate-object="text" data-key="11986"><span data-slate-leaf="true" data-offset-key="11986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="11987"><span data-slate-leaf="true" data-offset-key="11987:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11988"><span data-slate-object="text" data-key="11989"><span data-slate-leaf="true" data-offset-key="11989:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11990"><span data-slate-leaf="true" data-offset-key="11990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="11991"><span data-slate-leaf="true" data-offset-key="11991:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11992"><span data-slate-leaf="true" data-offset-key="11992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">currentTimestamp</span></span></span></span><span data-slate-object="text" data-key="11993"><span data-slate-leaf="true" data-offset-key="11993:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="11994"><span data-slate-leaf="true" data-offset-key="11994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="11995"><span data-slate-leaf="true" data-offset-key="11995:0" data-first-offset="true"><span data-slate-string="true"> timestamp();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11996"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11997"><span data-slate-object="text" data-key="11998"><span data-slate-leaf="true" data-offset-key="11998:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="11999"><span data-slate-leaf="true" data-offset-key="11999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12000"><span data-slate-leaf="true" data-offset-key="12000:0" data-first-offset="true"><span data-slate-string="true">(currentTimestamp &lt; lastTimestamp) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12001"><span data-slate-object="text" data-key="12002"><span data-slate-leaf="true" data-offset-key="12002:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="12003"><span data-slate-leaf="true" data-offset-key="12003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="12004"><span data-slate-leaf="true" data-offset-key="12004:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12005"><span data-slate-leaf="true" data-offset-key="12005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12006"><span data-slate-leaf="true" data-offset-key="12006:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12007"><span data-slate-leaf="true" data-offset-key="12007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">IllegalStateException</span></span></span></span><span data-slate-object="text" data-key="12008"><span data-slate-leaf="true" data-offset-key="12008:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12009"><span data-slate-leaf="true" data-offset-key="12009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Invalid System Clock!"</span></span></span></span><span data-slate-object="text" data-key="12010"><span data-slate-leaf="true" data-offset-key="12010:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12011"><span data-slate-object="text" data-key="12012"><span data-slate-leaf="true" data-offset-key="12012:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12013"><span data-slate-object="text" data-key="12014"><span data-slate-leaf="true" data-offset-key="12014:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12015"><span data-slate-object="text" data-key="12016"><span data-slate-leaf="true" data-offset-key="12016:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12017"><span data-slate-leaf="true" data-offset-key="12017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 同一个时间戳，我们需要递增序号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12018"><span data-slate-object="text" data-key="12019"><span data-slate-leaf="true" data-offset-key="12019:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12020"><span data-slate-leaf="true" data-offset-key="12020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12021"><span data-slate-leaf="true" data-offset-key="12021:0" data-first-offset="true"><span data-slate-string="true"> (currentTimestamp == lastTimestamp) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12022"><span data-slate-object="text" data-key="12023"><span data-slate-leaf="true" data-offset-key="12023:0" data-first-offset="true"><span data-slate-string="true">            sequence = (sequence + </span></span></span><span data-slate-object="text" data-key="12024"><span data-slate-leaf="true" data-offset-key="12024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12025"><span data-slate-leaf="true" data-offset-key="12025:0" data-first-offset="true"><span data-slate-string="true">) &amp; maxSequence;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12026"><span data-slate-object="text" data-key="12027"><span data-slate-leaf="true" data-offset-key="12027:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="12028"><span data-slate-leaf="true" data-offset-key="12028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12029"><span data-slate-leaf="true" data-offset-key="12029:0" data-first-offset="true"><span data-slate-string="true">(sequence == </span></span></span><span data-slate-object="text" data-key="12030"><span data-slate-leaf="true" data-offset-key="12030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="12031"><span data-slate-leaf="true" data-offset-key="12031:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12032"><span data-slate-object="text" data-key="12033"><span data-slate-leaf="true" data-offset-key="12033:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="12034"><span data-slate-leaf="true" data-offset-key="12034:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果序号耗尽，则需要等待到下一秒继续执行</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12035"><span data-slate-object="text" data-key="12036"><span data-slate-leaf="true" data-offset-key="12036:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="12037"><span data-slate-leaf="true" data-offset-key="12037:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Sequence Exhausted, wait till next millisecond.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12038"><span data-slate-object="text" data-key="12039"><span data-slate-leaf="true" data-offset-key="12039:0" data-first-offset="true"><span data-slate-string="true">                currentTimestamp = waitNextMillis(currentTimestamp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12040"><span data-slate-object="text" data-key="12041"><span data-slate-leaf="true" data-offset-key="12041:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12042"><span data-slate-object="text" data-key="12043"><span data-slate-leaf="true" data-offset-key="12043:0" data-first-offset="true"><span data-slate-string="true">        } </span></span></span><span data-slate-object="text" data-key="12044"><span data-slate-leaf="true" data-offset-key="12044:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="12045"><span data-slate-leaf="true" data-offset-key="12045:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12046"><span data-slate-object="text" data-key="12047"><span data-slate-leaf="true" data-offset-key="12047:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="12048"><span data-slate-leaf="true" data-offset-key="12048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// reset sequence to start with zero for the next millisecond</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12049"><span data-slate-object="text" data-key="12050"><span data-slate-leaf="true" data-offset-key="12050:0" data-first-offset="true"><span data-slate-string="true">            sequence = </span></span></span><span data-slate-object="text" data-key="12051"><span data-slate-leaf="true" data-offset-key="12051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="12052"><span data-slate-leaf="true" data-offset-key="12052:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12053"><span data-slate-object="text" data-key="12054"><span data-slate-leaf="true" data-offset-key="12054:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12055"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12056"><span data-slate-object="text" data-key="12057"><span data-slate-leaf="true" data-offset-key="12057:0" data-first-offset="true"><span data-slate-string="true">        lastTimestamp = currentTimestamp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12058"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12059"><span data-slate-object="text" data-key="12060"><span data-slate-leaf="true" data-offset-key="12060:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12061"><span data-slate-leaf="true" data-offset-key="12061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12062"><span data-slate-leaf="true" data-offset-key="12062:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12063"><span data-slate-leaf="true" data-offset-key="12063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span><span data-slate-object="text" data-key="12064"><span data-slate-leaf="true" data-offset-key="12064:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12065"><span data-slate-leaf="true" data-offset-key="12065:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12066"><span data-slate-leaf="true" data-offset-key="12066:0" data-first-offset="true"><span data-slate-string="true"> currentTimestamp &lt;&lt;(NODE_ID_BITS + SEQUENCE_BITS)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12067"><span data-slate-object="text" data-key="12068"><span data-slate-leaf="true" data-offset-key="12068:0" data-first-offset="true"><span data-slate-string="true">                | (nodeId &lt;&lt; SEQUENCE_BITS)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12069"><span data-slate-object="text" data-key="12070"><span data-slate-leaf="true" data-offset-key="12070:0" data-first-offset="true"><span data-slate-string="true">                | sequence;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12071"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12072"><span data-slate-object="text" data-key="12073"><span data-slate-leaf="true" data-offset-key="12073:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12074"><span data-slate-leaf="true" data-offset-key="12074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12075"><span data-slate-leaf="true" data-offset-key="12075:0" data-first-offset="true"><span data-slate-string="true"> id;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12076"><span data-slate-object="text" data-key="12077"><span data-slate-leaf="true" data-offset-key="12077:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12078"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12079"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12080"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12081"><span data-slate-object="text" data-key="12082"><span data-slate-leaf="true" data-offset-key="12082:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12083"><span data-slate-leaf="true" data-offset-key="12083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get current timestamp in milliseconds, adjust for the custom epoch.</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12084"><span data-slate-object="text" data-key="12085"><span data-slate-leaf="true" data-offset-key="12085:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12086"><span data-slate-leaf="true" data-offset-key="12086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="12087"><span data-slate-leaf="true" data-offset-key="12087:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12088"><span data-slate-leaf="true" data-offset-key="12088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12089"><span data-slate-leaf="true" data-offset-key="12089:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12090"><span data-slate-leaf="true" data-offset-key="12090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">timestamp</span></span></span></span><span data-slate-object="text" data-key="12091"><span data-slate-leaf="true" data-offset-key="12091:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="12092"><span data-slate-leaf="true" data-offset-key="12092:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12093"><span data-slate-object="text" data-key="12094"><span data-slate-leaf="true" data-offset-key="12094:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12095"><span data-slate-leaf="true" data-offset-key="12095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12096"><span data-slate-leaf="true" data-offset-key="12096:0" data-first-offset="true"><span data-slate-string="true"> Instant.now().toEpochMilli() - customEpoch;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12097"><span data-slate-object="text" data-key="12098"><span data-slate-leaf="true" data-offset-key="12098:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12099"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12100"><span data-slate-object="text" data-key="12101"><span data-slate-leaf="true" data-offset-key="12101:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12102"><span data-slate-leaf="true" data-offset-key="12102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 由于这样被耗尽的情况不多，且需要等待的时间也只有 1ms；所以我们选择死循环进行阻塞</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12103"><span data-slate-object="text" data-key="12104"><span data-slate-leaf="true" data-offset-key="12104:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12105"><span data-slate-leaf="true" data-offset-key="12105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Block and wait till next millisecond</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12106"><span data-slate-object="text" data-key="12107"><span data-slate-leaf="true" data-offset-key="12107:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12108"><span data-slate-leaf="true" data-offset-key="12108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="12109"><span data-slate-leaf="true" data-offset-key="12109:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12110"><span data-slate-leaf="true" data-offset-key="12110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12111"><span data-slate-leaf="true" data-offset-key="12111:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12112"><span data-slate-leaf="true" data-offset-key="12112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">waitNextMillis</span></span></span></span><span data-slate-object="text" data-key="12113"><span data-slate-leaf="true" data-offset-key="12113:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="12114"><span data-slate-leaf="true" data-offset-key="12114:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span></span><span data-slate-object="text" data-key="12115"><span data-slate-leaf="true" data-offset-key="12115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> currentTimestamp)</span></span></span></span><span data-slate-object="text" data-key="12116"><span data-slate-leaf="true" data-offset-key="12116:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12117"><span data-slate-object="text" data-key="12118"><span data-slate-leaf="true" data-offset-key="12118:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12119"><span data-slate-leaf="true" data-offset-key="12119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="12120"><span data-slate-leaf="true" data-offset-key="12120:0" data-first-offset="true"><span data-slate-string="true"> (currentTimestamp == lastTimestamp) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12121"><span data-slate-object="text" data-key="12122"><span data-slate-leaf="true" data-offset-key="12122:0" data-first-offset="true"><span data-slate-string="true">            currentTimestamp = timestamp();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12123"><span data-slate-object="text" data-key="12124"><span data-slate-leaf="true" data-offset-key="12124:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12125"><span data-slate-object="text" data-key="12126"><span data-slate-leaf="true" data-offset-key="12126:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12127"><span data-slate-leaf="true" data-offset-key="12127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12128"><span data-slate-leaf="true" data-offset-key="12128:0" data-first-offset="true"><span data-slate-string="true"> currentTimestamp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12129"><span data-slate-object="text" data-key="12130"><span data-slate-leaf="true" data-offset-key="12130:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12131"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12132"><span data-slate-object="text" data-key="12133"><span data-slate-leaf="true" data-offset-key="12133:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12134"><span data-slate-leaf="true" data-offset-key="12134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 默认基于 mac 地址生成节点 ID </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12135"><span data-slate-object="text" data-key="12136"><span data-slate-leaf="true" data-offset-key="12136:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12137"><span data-slate-leaf="true" data-offset-key="12137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">private</span></span></span></span><span data-slate-object="text" data-key="12138"><span data-slate-leaf="true" data-offset-key="12138:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12139"><span data-slate-leaf="true" data-offset-key="12139:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12140"><span data-slate-leaf="true" data-offset-key="12140:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12141"><span data-slate-leaf="true" data-offset-key="12141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">createNodeId</span></span></span></span><span data-slate-object="text" data-key="12142"><span data-slate-leaf="true" data-offset-key="12142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="12143"><span data-slate-leaf="true" data-offset-key="12143:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12144"><span data-slate-object="text" data-key="12145"><span data-slate-leaf="true" data-offset-key="12145:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12146"><span data-slate-leaf="true" data-offset-key="12146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12147"><span data-slate-leaf="true" data-offset-key="12147:0" data-first-offset="true"><span data-slate-string="true"> nodeId;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12148"><span data-slate-object="text" data-key="12149"><span data-slate-leaf="true" data-offset-key="12149:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12150"><span data-slate-leaf="true" data-offset-key="12150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">try</span></span></span></span><span data-slate-object="text" data-key="12151"><span data-slate-leaf="true" data-offset-key="12151:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12152"><span data-slate-object="text" data-key="12153"><span data-slate-leaf="true" data-offset-key="12153:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="12154"><span data-slate-leaf="true" data-offset-key="12154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StringBuilder</span></span></span></span><span data-slate-object="text" data-key="12155"><span data-slate-leaf="true" data-offset-key="12155:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12156"><span data-slate-leaf="true" data-offset-key="12156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sb</span></span></span></span><span data-slate-object="text" data-key="12157"><span data-slate-leaf="true" data-offset-key="12157:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12158"><span data-slate-leaf="true" data-offset-key="12158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12159"><span data-slate-leaf="true" data-offset-key="12159:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12160"><span data-slate-leaf="true" data-offset-key="12160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12161"><span data-slate-leaf="true" data-offset-key="12161:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12162"><span data-slate-leaf="true" data-offset-key="12162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StringBuilder</span></span></span></span><span data-slate-object="text" data-key="12163"><span data-slate-leaf="true" data-offset-key="12163:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12164"><span data-slate-object="text" data-key="12165"><span data-slate-leaf="true" data-offset-key="12165:0" data-first-offset="true"><span data-slate-string="true">            Enumeration&lt;NetworkInterface&gt; networkInterfaces = NetworkInterface.getNetworkInterfaces();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12166"><span data-slate-object="text" data-key="12167"><span data-slate-leaf="true" data-offset-key="12167:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="12168"><span data-slate-leaf="true" data-offset-key="12168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="12169"><span data-slate-leaf="true" data-offset-key="12169:0" data-first-offset="true"><span data-slate-string="true"> (networkInterfaces.hasMoreElements()) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12170"><span data-slate-object="text" data-key="12171"><span data-slate-leaf="true" data-offset-key="12171:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="12172"><span data-slate-leaf="true" data-offset-key="12172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NetworkInterface</span></span></span></span><span data-slate-object="text" data-key="12173"><span data-slate-leaf="true" data-offset-key="12173:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12174"><span data-slate-leaf="true" data-offset-key="12174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">networkInterface</span></span></span></span><span data-slate-object="text" data-key="12175"><span data-slate-leaf="true" data-offset-key="12175:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12176"><span data-slate-leaf="true" data-offset-key="12176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12177"><span data-slate-leaf="true" data-offset-key="12177:0" data-first-offset="true"><span data-slate-string="true"> networkInterfaces.nextElement();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12178"><span data-slate-object="text" data-key="12179"><span data-slate-leaf="true" data-offset-key="12179:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="12180"><span data-slate-leaf="true" data-offset-key="12180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="12181"><span data-slate-leaf="true" data-offset-key="12181:0" data-first-offset="true"><span data-slate-string="true">[] mac = networkInterface.getHardwareAddress();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12182"><span data-slate-object="text" data-key="12183"><span data-slate-leaf="true" data-offset-key="12183:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="12184"><span data-slate-leaf="true" data-offset-key="12184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="12185"><span data-slate-leaf="true" data-offset-key="12185:0" data-first-offset="true"><span data-slate-string="true"> (mac != </span></span></span><span data-slate-object="text" data-key="12186"><span data-slate-leaf="true" data-offset-key="12186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="12187"><span data-slate-leaf="true" data-offset-key="12187:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12188"><span data-slate-object="text" data-key="12189"><span data-slate-leaf="true" data-offset-key="12189:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="12190"><span data-slate-leaf="true" data-offset-key="12190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="12191"><span data-slate-leaf="true" data-offset-key="12191:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12192"><span data-slate-leaf="true" data-offset-key="12192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="12193"><span data-slate-leaf="true" data-offset-key="12193:0" data-first-offset="true"><span data-slate-string="true"> macPort: mac) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12194"><span data-slate-object="text" data-key="12195"><span data-slate-leaf="true" data-offset-key="12195:0" data-first-offset="true"><span data-slate-string="true">                        sb.append(String.format(</span></span></span><span data-slate-object="text" data-key="12196"><span data-slate-leaf="true" data-offset-key="12196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%02X"</span></span></span></span><span data-slate-object="text" data-key="12197"><span data-slate-leaf="true" data-offset-key="12197:0" data-first-offset="true"><span data-slate-string="true">, macPort));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12198"><span data-slate-object="text" data-key="12199"><span data-slate-leaf="true" data-offset-key="12199:0" data-first-offset="true"><span data-slate-string="true">                    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12200"><span data-slate-object="text" data-key="12201"><span data-slate-leaf="true" data-offset-key="12201:0" data-first-offset="true"><span data-slate-string="true">                }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12202"><span data-slate-object="text" data-key="12203"><span data-slate-leaf="true" data-offset-key="12203:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12204"><span data-slate-object="text" data-key="12205"><span data-slate-leaf="true" data-offset-key="12205:0" data-first-offset="true"><span data-slate-string="true">            nodeId = sb.toString().hashCode();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12206"><span data-slate-object="text" data-key="12207"><span data-slate-leaf="true" data-offset-key="12207:0" data-first-offset="true"><span data-slate-string="true">        } </span></span></span><span data-slate-object="text" data-key="12208"><span data-slate-leaf="true" data-offset-key="12208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">catch</span></span></span></span><span data-slate-object="text" data-key="12209"><span data-slate-leaf="true" data-offset-key="12209:0" data-first-offset="true"><span data-slate-string="true"> (Exception ex) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12210"><span data-slate-object="text" data-key="12211"><span data-slate-leaf="true" data-offset-key="12211:0" data-first-offset="true"><span data-slate-string="true">            nodeId = (</span></span></span><span data-slate-object="text" data-key="12212"><span data-slate-leaf="true" data-offset-key="12212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12213"><span data-slate-leaf="true" data-offset-key="12213:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12214"><span data-slate-leaf="true" data-offset-key="12214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">SecureRandom</span></span></span></span><span data-slate-object="text" data-key="12215"><span data-slate-leaf="true" data-offset-key="12215:0" data-first-offset="true"><span data-slate-string="true">().nextInt());</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12216"><span data-slate-object="text" data-key="12217"><span data-slate-leaf="true" data-offset-key="12217:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12218"><span data-slate-object="text" data-key="12219"><span data-slate-leaf="true" data-offset-key="12219:0" data-first-offset="true"><span data-slate-string="true">        nodeId = nodeId &amp; maxNodeId;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12220"><span data-slate-object="text" data-key="12221"><span data-slate-leaf="true" data-offset-key="12221:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12222"><span data-slate-leaf="true" data-offset-key="12222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12223"><span data-slate-leaf="true" data-offset-key="12223:0" data-first-offset="true"><span data-slate-string="true"> nodeId;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12224"><span data-slate-object="text" data-key="12225"><span data-slate-leaf="true" data-offset-key="12225:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12226"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12227"><span data-slate-object="text" data-key="12228"><span data-slate-leaf="true" data-offset-key="12228:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12229"><span data-slate-leaf="true" data-offset-key="12229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="12230"><span data-slate-leaf="true" data-offset-key="12230:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12231"><span data-slate-leaf="true" data-offset-key="12231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12232"><span data-slate-leaf="true" data-offset-key="12232:0" data-first-offset="true"><span data-slate-string="true">[] parse(</span></span></span><span data-slate-object="text" data-key="12233"><span data-slate-leaf="true" data-offset-key="12233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12234"><span data-slate-leaf="true" data-offset-key="12234:0" data-first-offset="true"><span data-slate-string="true"> id) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12235"><span data-slate-object="text" data-key="12236"><span data-slate-leaf="true" data-offset-key="12236:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12237"><span data-slate-leaf="true" data-offset-key="12237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12238"><span data-slate-leaf="true" data-offset-key="12238:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12239"><span data-slate-leaf="true" data-offset-key="12239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">maskNodeId</span></span></span></span><span data-slate-object="text" data-key="12240"><span data-slate-leaf="true" data-offset-key="12240:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12241"><span data-slate-leaf="true" data-offset-key="12241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12242"><span data-slate-leaf="true" data-offset-key="12242:0" data-first-offset="true"><span data-slate-string="true"> ((</span></span></span><span data-slate-object="text" data-key="12243"><span data-slate-leaf="true" data-offset-key="12243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1L</span></span></span></span><span data-slate-object="text" data-key="12244"><span data-slate-leaf="true" data-offset-key="12244:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt;NODE_ID_BITS) - </span></span></span><span data-slate-object="text" data-key="12245"><span data-slate-leaf="true" data-offset-key="12245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12246"><span data-slate-leaf="true" data-offset-key="12246:0" data-first-offset="true"><span data-slate-string="true">) &lt;&lt; SEQUENCE_BITS;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12247"><span data-slate-object="text" data-key="12248"><span data-slate-leaf="true" data-offset-key="12248:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12249"><span data-slate-leaf="true" data-offset-key="12249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12250"><span data-slate-leaf="true" data-offset-key="12250:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12251"><span data-slate-leaf="true" data-offset-key="12251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">maskSequence</span></span></span></span><span data-slate-object="text" data-key="12252"><span data-slate-leaf="true" data-offset-key="12252:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12253"><span data-slate-leaf="true" data-offset-key="12253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12254"><span data-slate-leaf="true" data-offset-key="12254:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="12255"><span data-slate-leaf="true" data-offset-key="12255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1L</span></span></span></span><span data-slate-object="text" data-key="12256"><span data-slate-leaf="true" data-offset-key="12256:0" data-first-offset="true"><span data-slate-string="true"> &lt;&lt;SEQUENCE_BITS) - </span></span></span><span data-slate-object="text" data-key="12257"><span data-slate-leaf="true" data-offset-key="12257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12258"><span data-slate-leaf="true" data-offset-key="12258:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12259"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12260"><span data-slate-object="text" data-key="12261"><span data-slate-leaf="true" data-offset-key="12261:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12262"><span data-slate-leaf="true" data-offset-key="12262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12263"><span data-slate-leaf="true" data-offset-key="12263:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12264"><span data-slate-leaf="true" data-offset-key="12264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">timestamp</span></span></span></span><span data-slate-object="text" data-key="12265"><span data-slate-leaf="true" data-offset-key="12265:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12266"><span data-slate-leaf="true" data-offset-key="12266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12267"><span data-slate-leaf="true" data-offset-key="12267:0" data-first-offset="true"><span data-slate-string="true"> (id&gt;&gt; (NODE_ID_BITS + SEQUENCE_BITS)) + customEpoch;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12268"><span data-slate-object="text" data-key="12269"><span data-slate-leaf="true" data-offset-key="12269:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12270"><span data-slate-leaf="true" data-offset-key="12270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12271"><span data-slate-leaf="true" data-offset-key="12271:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12272"><span data-slate-leaf="true" data-offset-key="12272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nodeId</span></span></span></span><span data-slate-object="text" data-key="12273"><span data-slate-leaf="true" data-offset-key="12273:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12274"><span data-slate-leaf="true" data-offset-key="12274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12275"><span data-slate-leaf="true" data-offset-key="12275:0" data-first-offset="true"><span data-slate-string="true"> (id &amp; maskNodeId) &gt;&gt; SEQUENCE_BITS;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12276"><span data-slate-object="text" data-key="12277"><span data-slate-leaf="true" data-offset-key="12277:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12278"><span data-slate-leaf="true" data-offset-key="12278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12279"><span data-slate-leaf="true" data-offset-key="12279:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12280"><span data-slate-leaf="true" data-offset-key="12280:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sequence</span></span></span></span><span data-slate-object="text" data-key="12281"><span data-slate-leaf="true" data-offset-key="12281:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12282"><span data-slate-leaf="true" data-offset-key="12282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="12283"><span data-slate-leaf="true" data-offset-key="12283:0" data-first-offset="true"><span data-slate-string="true"> id &amp; maskSequence;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12284"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12285"><span data-slate-object="text" data-key="12286"><span data-slate-leaf="true" data-offset-key="12286:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12287"><span data-slate-leaf="true" data-offset-key="12287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12288"><span data-slate-leaf="true" data-offset-key="12288:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12289"><span data-slate-leaf="true" data-offset-key="12289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="12290"><span data-slate-leaf="true" data-offset-key="12290:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12291"><span data-slate-leaf="true" data-offset-key="12291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long</span></span></span></span><span data-slate-object="text" data-key="12292"><span data-slate-leaf="true" data-offset-key="12292:0" data-first-offset="true"><span data-slate-string="true">[]{timestamp, nodeId, sequence};</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12293"><span data-slate-object="text" data-key="12294"><span data-slate-leaf="true" data-offset-key="12294:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12295"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12296"><span data-slate-object="text" data-key="12297"><span data-slate-leaf="true" data-offset-key="12297:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12298"><span data-slate-leaf="true" data-offset-key="12298:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12299"><span data-slate-object="text" data-key="12300"><span data-slate-leaf="true" data-offset-key="12300:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12301"><span data-slate-leaf="true" data-offset-key="12301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="12302"><span data-slate-leaf="true" data-offset-key="12302:0" data-first-offset="true"><span data-slate-string="true"> String </span></span></span><span data-slate-object="text" data-key="12303"><span data-slate-leaf="true" data-offset-key="12303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">toString</span></span></span></span><span data-slate-object="text" data-key="12304"><span data-slate-leaf="true" data-offset-key="12304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="12305"><span data-slate-leaf="true" data-offset-key="12305:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12306"><span data-slate-object="text" data-key="12307"><span data-slate-leaf="true" data-offset-key="12307:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12308"><span data-slate-leaf="true" data-offset-key="12308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12309"><span data-slate-leaf="true" data-offset-key="12309:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12310"><span data-slate-leaf="true" data-offset-key="12310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Snowflake Settings [EPOCH_BITS="</span></span></span></span><span data-slate-object="text" data-key="12311"><span data-slate-leaf="true" data-offset-key="12311:0" data-first-offset="true"><span data-slate-string="true"> + EPOCH_BITS + </span></span></span><span data-slate-object="text" data-key="12312"><span data-slate-leaf="true" data-offset-key="12312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">", NODE_ID_BITS="</span></span></span></span><span data-slate-object="text" data-key="12313"><span data-slate-leaf="true" data-offset-key="12313:0" data-first-offset="true"><span data-slate-string="true"> + NODE_ID_BITS</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12314"><span data-slate-object="text" data-key="12315"><span data-slate-leaf="true" data-offset-key="12315:0" data-first-offset="true"><span data-slate-string="true">                + </span></span></span><span data-slate-object="text" data-key="12316"><span data-slate-leaf="true" data-offset-key="12316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">", SEQUENCE_BITS="</span></span></span></span><span data-slate-object="text" data-key="12317"><span data-slate-leaf="true" data-offset-key="12317:0" data-first-offset="true"><span data-slate-string="true"> + SEQUENCE_BITS + </span></span></span><span data-slate-object="text" data-key="12318"><span data-slate-leaf="true" data-offset-key="12318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">", CUSTOM_EPOCH="</span></span></span></span><span data-slate-object="text" data-key="12319"><span data-slate-leaf="true" data-offset-key="12319:0" data-first-offset="true"><span data-slate-string="true"> + customEpoch</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12320"><span data-slate-object="text" data-key="12321"><span data-slate-leaf="true" data-offset-key="12321:0" data-first-offset="true"><span data-slate-string="true">                + </span></span></span><span data-slate-object="text" data-key="12322"><span data-slate-leaf="true" data-offset-key="12322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">", NodeId="</span></span></span></span><span data-slate-object="text" data-key="12323"><span data-slate-leaf="true" data-offset-key="12323:0" data-first-offset="true"><span data-slate-string="true"> + nodeId + </span></span></span><span data-slate-object="text" data-key="12324"><span data-slate-leaf="true" data-offset-key="12324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"]"</span></span></span></span><span data-slate-object="text" data-key="12325"><span data-slate-leaf="true" data-offset-key="12325:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12326"><span data-slate-object="text" data-key="12327"><span data-slate-leaf="true" data-offset-key="12327:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12328"><span data-slate-object="text" data-key="12329"><span data-slate-leaf="true" data-offset-key="12329:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12330"><span data-slate-object="text" data-key="12331"><span data-slate-leaf="true" data-offset-key="12331:0" data-first-offset="true"><span data-slate-string="true">主要思路就是先根据 name，初始化 Snowflake generator 的实例，开发者需要保证 name 的唯一性；然后在需要生成新的 ID 的时候，用当前时间戳加上当前时间戳内（也就是某一毫秒内）的计数器，拼接得到 UUID，如果某一毫秒内的计数器被耗尽达到上限，会死循环直至这 1ms 过去。代码很简单，你看懂了吗。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12332"><span data-slate-object="text" data-key="12333"><span data-slate-leaf="true" data-offset-key="12333:0" data-first-offset="true"><span data-slate-string="true">再次说明一下，你千万不用太担心源码艰深复杂而不敢看，其实很多项目的源码还是很简单的，推荐你从这种小而美的代码开始看起，其实你看完之后，往往也会信心倍增，觉得自己也能写出来。等你之后看得多了，自然也能更好地掌握背后的编程技巧啦。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12334" id="sr-toc-10"><span data-slate-object="text" data-key="12335"><span data-slate-leaf="true" data-offset-key="12335:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12336"><span data-slate-object="text" data-key="12337"><span data-slate-leaf="true" data-offset-key="12337:0" data-first-offset="true"><span data-slate-string="true">主流的几种生成分布式唯一 ID 的方案我们今天就都学习完了，思路基本上都比较直接，大体分为两种思路：需要引入额外的系统生成 ID、在业务侧本地通过规则约束独立生成 ID。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12338"><span data-slate-object="text" data-key="12339"><span data-slate-leaf="true" data-offset-key="12339:0" data-first-offset="true"><span data-slate-string="true">单点生成器和基于数据库的实现都是第一种，UUID 和 Snowflake 则都是在本地根据规则约束独立生成 ID，一般来说也应用更加广泛。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12340"><span data-slate-object="text" data-key="12341"><span data-slate-leaf="true" data-offset-key="12341:0" data-first-offset="true"><span data-slate-string="true">你可以好好回顾感受学到的几个问题解决思想，备份节点来提高可用性、批量读写来提高系统性能、本地计算来避免性能瓶颈。之后，你自己引入外部数据库或者其他系统的时候，也要多多考虑是否会在引入的系统上发生问题和性能瓶颈。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12342" id="sr-toc-11"><span data-slate-object="text" data-key="12343"><span data-slate-leaf="true" data-offset-key="12343:0" data-first-offset="true"><span data-slate-string="true">课后作业</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12344"><span data-slate-object="text" data-key="12345"><span data-slate-leaf="true" data-offset-key="12345:0" data-first-offset="true"><span data-slate-string="true">今天思考题就是前面说的，如果让你自己不借助外部组件实现一个单点的 ID 发生器，你会怎么做呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12346"><span data-slate-object="text" data-key="12347"><span data-slate-leaf="true" data-offset-key="12347:0" data-first-offset="true"><span data-slate-string="true">欢迎你在评论区留言与我一起讨论，如果觉得本文对你有帮助的话，也欢迎转发给你的朋友一起学习，我们下节课见～</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ae/c9/ae3f84a7816a06b6d618fcca689457c9.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-12">精选留言 (2)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/19/6b/e9/7620ae7e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>雨落～紫竹</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>有问题。人家就 10 毫秒来 10 万个 你这不都有问题了</div><div><div>2022-07-18</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>peter</span></div></div><div>请教老师四个问题：
Q1：重试幂等使用的 ID 用什么方法生成？
Q2：个人电脑，比如我使用的笔记本，我并没有对它进行过时间同步操作，
        请问这个笔记本会自动进行时间同步吗？
Q3：Snowflake 算法的 bit0 为什么不用？maxNodeId 为什么要 1024 减去 1？
        maxSequence 为什么要 4096 减去 1？
Q4：能否举几个分布式 ID 在互联网的典型应用？ 比如 XX 场景下用 XX 方法？</div><div><div>2022-02-15</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".24"><outline class="toc-level-h1" data-reactid=".24.0" style="width: 175px;"><active data-reactid=".24.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".24.0.1"><span data-reactid=".24.0.1.0">24｜UUID：如何高效生成全局的唯一 ID？</span></a></outline><outline class="toc-level-h3" data-reactid=".24.1" style="width: 155px;"><active data-reactid=".24.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".24.1.1"><span data-reactid=".24.1.1.0">单体环境</span></a></outline><outline class="toc-level-h3" data-reactid=".24.2" style="width: 155px;"><active data-reactid=".24.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".24.2.1"><span data-reactid=".24.2.1.0">分布式环境</span></a></outline><outline class="toc-level-h2" data-reactid=".24.3" style="width: 165px;"><active data-reactid=".24.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".24.3.1"><span data-reactid=".24.3.1.0">引入单点 ID 生成器</span></a></outline><outline class="toc-level-h3" data-reactid=".24.4" style="width: 155px;"><active data-reactid=".24.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".24.4.1"><span data-reactid=".24.4.1.0">如何解决</span></a></outline><outline class="toc-level-h2" data-reactid=".24.5" style="width: 165px;"><active data-reactid=".24.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".24.5.1"><span data-reactid=".24.5.1.0">基于数据库实现 ID 生成器</span></a></outline><outline class="toc-level-h3" data-reactid=".24.6" style="width: 155px;"><active data-reactid=".24.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".24.6.1"><span data-reactid=".24.6.1.0">水平扩展</span></a></outline><outline class="toc-level-h3" data-reactid=".24.7" style="width: 155px;"><active data-reactid=".24.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".24.7.1"><span data-reactid=".24.7.1.0">利用单点服务</span></a></outline><outline class="toc-level-h2" data-reactid=".24.8" style="width: 165px;"><active data-reactid=".24.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".24.8.1"><span data-reactid=".24.8.1.0">UUID</span></a></outline><outline class="toc-level-h2" data-reactid=".24.9" style="width: 165px;"><active data-reactid=".24.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".24.9.1"><span data-reactid=".24.9.1.0">Snowflake</span></a></outline><outline class="toc-level-h2" data-reactid=".24.a" style="width: 165px;"><active data-reactid=".24.a.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".24.a.1"><span data-reactid=".24.a.1.0">总结</span></a></outline><outline class="toc-level-h3" data-reactid=".24.b" style="width: 155px;"><active data-reactid=".24.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".24.b.1"><span data-reactid=".24.b.1.0">课后作业</span></a></outline><outline class="toc-level-h2" data-reactid=".24.c" style="width: 165px;"><active data-reactid=".24.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".24.c.1"><span data-reactid=".24.c.1.0">精选留言 (2)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/486454" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>