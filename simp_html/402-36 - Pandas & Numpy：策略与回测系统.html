
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 36 | Pandas & Numpy：策略与回测系统</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>36 | Pandas & Numpy：策略与回测系统</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">好的代码本身就是一份文档。同样功能的一份程序，一个组件，一套系统，让不同的人来写，写出来的代码却是千差万别。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">36 | Pandas &amp; Numpy：策略与回测系统</h1><div><span>景霄</span> <span> 2019-07-31</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f3/7a/f3a290cec1d580997a50eef8f170cf7a.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：冯永吉</span><span>大小：14.65M</span><span> 时长：16:00</span></div></div><audio title="36 | Pandas &amp; Numpy：策略与回测系统" src="https://res001.geekbang.org//media/audio/34/b1/34f231fbb696483eba5c1f1dfa12a2b1/ld/ld.m3u8" __idm_id__="40970"></audio></div><div><div><div><div data-slate-editor="true" data-key="6136" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="6137"><span data-slate-object="text" data-key="6138"><span data-slate-leaf="true" data-offset-key="6138:0" data-first-offset="true"><span data-slate-string="true">大家好，我是景霄。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6139"><span data-slate-object="text" data-key="6140"><span data-slate-leaf="true" data-offset-key="6140:0" data-first-offset="true"><span data-slate-string="true">上节课，我们介绍了交易所的数据抓取，特别是 orderbook 和 tick 数据的抓取。今天这节课，我们考虑的是，怎么在这些历史数据上测试一个交易策略。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6141"><span data-slate-object="text" data-key="6142"><span data-slate-leaf="true" data-offset-key="6142:0" data-first-offset="true"><span data-slate-string="true">首先我们要明确，对于很多策略来说，我们上节课抓取的密集的 orderbook 和 tick 数据，并不能简单地直接使用。因为数据量太密集，包含了太多细节；而且长时间连接时，网络随机出现的不稳定，会导致丢失部分 tick 数据。因此，我们还需要进行合适的清洗、聚合等操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6143"><span data-slate-object="text" data-key="6144"><span data-slate-leaf="true" data-offset-key="6144:0" data-first-offset="true"><span data-slate-string="true">此外，为了进行回测，我们需要一个交易策略，还需要一个测试框架。目前已存在很多成熟的回测框架，但是为了 Python 学习，我决定带你搭建一个简单的回测框架，并且从中简单一窥 Pandas 的优势。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6145" id="sr-toc-1"><span data-slate-object="text" data-key="6146"><span data-slate-leaf="true" data-offset-key="6146:0" data-first-offset="true"><span data-slate-string="true">OHLCV 数据</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6147"><span data-slate-object="text" data-key="6148"><span data-slate-leaf="true" data-offset-key="6148:0" data-first-offset="true"><span data-slate-string="true">了解过一些股票交易的同学，可能知道 K 线这种东西。K 线又称 “蜡烛线”，是一种反映价格走势的图线。它的特色在于，一个线段内记录了多项讯息，相当易读易懂且实用有效，因此被广泛用于股票、期货、贵金属、数字货币等行情的技术分析。下面便是一个 K 线示意图。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6149"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/47/9b/470a68b8eaff3807efd89bc616e5659b.png?wh=730*320"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6150"><span data-slate-object="text" data-key="6151"><span data-slate-leaf="true" data-offset-key="6151:0" data-first-offset="true"><span data-slate-string="true">K 线示意图</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6152"><span data-slate-object="text" data-key="6153"><span data-slate-leaf="true" data-offset-key="6153:0" data-first-offset="true"><span data-slate-string="true">其中，每一个小蜡烛，都代表着当天的开盘价（Open）、最高价（High）、最低价（Low）和收盘价（Close），也就是我画的第二张图表示的这样。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6154"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/58/57/58ce87e32aa4655211da02ce88223757.png?wh=1200*1200"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6155"><span data-slate-object="text" data-key="6156"><span data-slate-leaf="true" data-offset-key="6156:0" data-first-offset="true"><span data-slate-string="true">K 线的 “小蜡烛” -- OHLC</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6157"><span data-slate-object="text" data-key="6158"><span data-slate-leaf="true" data-offset-key="6158:0" data-first-offset="true"><span data-slate-string="true">类似的，除了日 K 线之外，还有周 K 线、小时 K 线、分钟 K 线等等。那么这个 K 线是怎么计算来的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6159"><span data-slate-object="text" data-key="6160"><span data-slate-leaf="true" data-offset-key="6160:0" data-first-offset="true"><span data-slate-string="true">我们以小时 K 线图为例，还记得我们当时抓取的 tick 数据吗？也就是每一笔交易的价格和数量。那么，如果从上午 10:00 开始，我们开始积累 tick 的交易数据，以 10:00 开始的第一个交易作为 Open 数据，11:00 前的最后一笔交易作为 Close 值，并把这一个小时最低和最高的成交价格分别作为 High 和 Low 的值，我们就可以绘制出这一个小时对应的 “小蜡烛” 形状了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6161"><span data-slate-object="text" data-key="6162"><span data-slate-leaf="true" data-offset-key="6162:0" data-first-offset="true"><span data-slate-string="true">如果再加上这一个小时总的成交量（Volumn），就得到了 OHLCV 数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6163"><span data-slate-object="text" data-key="6164"><span data-slate-leaf="true" data-offset-key="6164:0" data-first-offset="true"><span data-slate-string="true">所以，如果我们一直抓取着 tick 底层原始数据，我们就能在上层聚合出 1 分钟 K 线、小时 K 线以及日、周 k 线等等。如果你对这一部分操作有兴趣，可以把此作为今天的课后作业来实践。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6165"><span data-slate-object="text" data-key="6166"><span data-slate-leaf="true" data-offset-key="6166:0" data-first-offset="true"><span data-slate-string="true">接下来，我们将使用 Gemini 从 2015 年到 2019 年 7 月这个时间内，BTC 对 USD 每个小时的 OHLCV 数据，作为策略和回测的输入。你可以在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6167"><span data-slate-object="text" data-key="6168"><span data-slate-leaf="true" data-offset-key="6168:0" data-first-offset="true"><span data-slate-string="true">这里</span></span></span></a><span data-slate-object="text" data-key="6169"><span data-slate-leaf="true" data-offset-key="6169:0" data-first-offset="true"><span data-slate-string="true">下载数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6170"><span data-slate-object="text" data-key="6171"><span data-slate-leaf="true" data-offset-key="6171:0" data-first-offset="true"><span data-slate-string="true">数据下载完成后，我们可以利用 Pandas 读取，比如下面这段代码。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="6172"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6173"><span data-slate-object="text" data-key="6174"><span data-slate-leaf="true" data-offset-key="6174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6175"><span data-slate-leaf="true" data-offset-key="6175:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6176"><span data-slate-leaf="true" data-offset-key="6176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">assert_msg</span></span></span></span><span data-slate-object="text" data-key="6177"><span data-slate-leaf="true" data-offset-key="6177:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6178"><span data-slate-leaf="true" data-offset-key="6178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">condition, msg</span></span></span></span><span data-slate-object="text" data-key="6179"><span data-slate-leaf="true" data-offset-key="6179:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6180"><span data-slate-object="text" data-key="6181"><span data-slate-leaf="true" data-offset-key="6181:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6182"><span data-slate-leaf="true" data-offset-key="6182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6183"><span data-slate-leaf="true" data-offset-key="6183:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6184"><span data-slate-leaf="true" data-offset-key="6184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">not</span></span></span></span><span data-slate-object="text" data-key="6185"><span data-slate-leaf="true" data-offset-key="6185:0" data-first-offset="true"><span data-slate-string="true"> condition:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6186"><span data-slate-object="text" data-key="6187"><span data-slate-leaf="true" data-offset-key="6187:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6188"><span data-slate-leaf="true" data-offset-key="6188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">raise</span></span></span></span><span data-slate-object="text" data-key="6189"><span data-slate-leaf="true" data-offset-key="6189:0" data-first-offset="true"><span data-slate-string="true"> Exception(msg)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6190"><span data-slate-object="text" data-key="6191"><span data-slate-leaf="true" data-offset-key="6191:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6192"><span data-slate-object="text" data-key="6193"><span data-slate-leaf="true" data-offset-key="6193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6194"><span data-slate-leaf="true" data-offset-key="6194:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6195"><span data-slate-leaf="true" data-offset-key="6195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">read_file</span></span></span></span><span data-slate-object="text" data-key="6196"><span data-slate-leaf="true" data-offset-key="6196:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6197"><span data-slate-leaf="true" data-offset-key="6197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filename</span></span></span></span><span data-slate-object="text" data-key="6198"><span data-slate-leaf="true" data-offset-key="6198:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6199"><span data-slate-object="text" data-key="6200"><span data-slate-leaf="true" data-offset-key="6200:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6201"><span data-slate-leaf="true" data-offset-key="6201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 获得文件绝对路径</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6202"><span data-slate-object="text" data-key="6203"><span data-slate-leaf="true" data-offset-key="6203:0" data-first-offset="true"><span data-slate-string="true">    filepath = path.join(path.dirname(__file__), filename)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6204"><span data-slate-object="text" data-key="6205"><span data-slate-leaf="true" data-offset-key="6205:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6206"><span data-slate-object="text" data-key="6207"><span data-slate-leaf="true" data-offset-key="6207:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6208"><span data-slate-leaf="true" data-offset-key="6208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 判定文件是否存在</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6209"><span data-slate-object="text" data-key="6210"><span data-slate-leaf="true" data-offset-key="6210:0" data-first-offset="true"><span data-slate-string="true">    assert_msg(path.exists(filepath), </span></span></span><span data-slate-object="text" data-key="6211"><span data-slate-leaf="true" data-offset-key="6211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"文件不存在"</span></span></span></span><span data-slate-object="text" data-key="6212"><span data-slate-leaf="true" data-offset-key="6212:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6213"><span data-slate-object="text" data-key="6214"><span data-slate-leaf="true" data-offset-key="6214:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6215"><span data-slate-object="text" data-key="6216"><span data-slate-leaf="true" data-offset-key="6216:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6217"><span data-slate-leaf="true" data-offset-key="6217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 读取 CSV 文件并返回</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6218"><span data-slate-object="text" data-key="6219"><span data-slate-leaf="true" data-offset-key="6219:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6220"><span data-slate-leaf="true" data-offset-key="6220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6221"><span data-slate-leaf="true" data-offset-key="6221:0" data-first-offset="true"><span data-slate-string="true"> pd.read_csv(filepath,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6222"><span data-slate-object="text" data-key="6223"><span data-slate-leaf="true" data-offset-key="6223:0" data-first-offset="true"><span data-slate-string="true">                       index_col=</span></span></span><span data-slate-object="text" data-key="6224"><span data-slate-leaf="true" data-offset-key="6224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="6225"><span data-slate-leaf="true" data-offset-key="6225:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6226"><span data-slate-object="text" data-key="6227"><span data-slate-leaf="true" data-offset-key="6227:0" data-first-offset="true"><span data-slate-string="true">                       parse_dates=</span></span></span><span data-slate-object="text" data-key="6228"><span data-slate-leaf="true" data-offset-key="6228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="6229"><span data-slate-leaf="true" data-offset-key="6229:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6230"><span data-slate-object="text" data-key="6231"><span data-slate-leaf="true" data-offset-key="6231:0" data-first-offset="true"><span data-slate-string="true">                       infer_datetime_format=</span></span></span><span data-slate-object="text" data-key="6232"><span data-slate-leaf="true" data-offset-key="6232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="6233"><span data-slate-leaf="true" data-offset-key="6233:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6234"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6235"><span data-slate-object="text" data-key="6236"><span data-slate-leaf="true" data-offset-key="6236:0" data-first-offset="true"><span data-slate-string="true">BTCUSD = read_file(</span></span></span><span data-slate-object="text" data-key="6237"><span data-slate-leaf="true" data-offset-key="6237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'BTCUSD_GEMINI.csv'</span></span></span></span><span data-slate-object="text" data-key="6238"><span data-slate-leaf="true" data-offset-key="6238:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6239"><span data-slate-object="text" data-key="6240"><span data-slate-leaf="true" data-offset-key="6240:0" data-first-offset="true"><span data-slate-string="true">assert_msg(BTCUSD.__len__() &gt; </span></span></span><span data-slate-object="text" data-key="6241"><span data-slate-leaf="true" data-offset-key="6241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="6242"><span data-slate-leaf="true" data-offset-key="6242:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6243"><span data-slate-leaf="true" data-offset-key="6243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'读取失败'</span></span></span></span><span data-slate-object="text" data-key="6244"><span data-slate-leaf="true" data-offset-key="6244:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6245"><span data-slate-object="text" data-key="6246"><span data-slate-leaf="true" data-offset-key="6246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="6247"><span data-slate-leaf="true" data-offset-key="6247:0" data-first-offset="true"><span data-slate-string="true">(BTCUSD.head())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6248"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6249"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6250"><span data-slate-object="text" data-key="6251"><span data-slate-leaf="true" data-offset-key="6251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6252"><span data-slate-object="text" data-key="6253"><span data-slate-leaf="true" data-offset-key="6253:0" data-first-offset="true"><span data-slate-string="true">Time                 Symbol      Open      High       Low     Close     Volume</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6254"><span data-slate-object="text" data-key="6255"><span data-slate-leaf="true" data-offset-key="6255:0" data-first-offset="true"><span data-slate-string="true">Date                                                                          </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6256"><span data-slate-object="text" data-key="6257"><span data-slate-leaf="true" data-offset-key="6257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2019</span></span></span></span><span data-slate-object="text" data-key="6258"><span data-slate-leaf="true" data-offset-key="6258:0" data-first-offset="true"><span data-slate-string="true">-07-08 </span></span></span><span data-slate-object="text" data-key="6259"><span data-slate-leaf="true" data-offset-key="6259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6260"><span data-slate-leaf="true" data-offset-key="6260:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6261"><span data-slate-leaf="true" data-offset-key="6261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6262"><span data-slate-leaf="true" data-offset-key="6262:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6263"><span data-slate-leaf="true" data-offset-key="6263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6264"><span data-slate-leaf="true" data-offset-key="6264:0" data-first-offset="true"><span data-slate-string="true">  BTCUSD  </span></span></span><span data-slate-object="text" data-key="6265"><span data-slate-leaf="true" data-offset-key="6265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11475.07</span></span></span></span><span data-slate-object="text" data-key="6266"><span data-slate-leaf="true" data-offset-key="6266:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6267"><span data-slate-leaf="true" data-offset-key="6267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11540.33</span></span></span></span><span data-slate-object="text" data-key="6268"><span data-slate-leaf="true" data-offset-key="6268:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6269"><span data-slate-leaf="true" data-offset-key="6269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11469.53</span></span></span></span><span data-slate-object="text" data-key="6270"><span data-slate-leaf="true" data-offset-key="6270:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6271"><span data-slate-leaf="true" data-offset-key="6271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11506.43</span></span></span></span><span data-slate-object="text" data-key="6272"><span data-slate-leaf="true" data-offset-key="6272:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6273"><span data-slate-leaf="true" data-offset-key="6273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.770731</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6274"><span data-slate-object="text" data-key="6275"><span data-slate-leaf="true" data-offset-key="6275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2019</span></span></span></span><span data-slate-object="text" data-key="6276"><span data-slate-leaf="true" data-offset-key="6276:0" data-first-offset="true"><span data-slate-string="true">-07-07 </span></span></span><span data-slate-object="text" data-key="6277"><span data-slate-leaf="true" data-offset-key="6277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">23</span></span></span></span><span data-slate-object="text" data-key="6278"><span data-slate-leaf="true" data-offset-key="6278:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6279"><span data-slate-leaf="true" data-offset-key="6279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6280"><span data-slate-leaf="true" data-offset-key="6280:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6281"><span data-slate-leaf="true" data-offset-key="6281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6282"><span data-slate-leaf="true" data-offset-key="6282:0" data-first-offset="true"><span data-slate-string="true">  BTCUSD  </span></span></span><span data-slate-object="text" data-key="6283"><span data-slate-leaf="true" data-offset-key="6283:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11423.00</span></span></span></span><span data-slate-object="text" data-key="6284"><span data-slate-leaf="true" data-offset-key="6284:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6285"><span data-slate-leaf="true" data-offset-key="6285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11482.72</span></span></span></span><span data-slate-object="text" data-key="6286"><span data-slate-leaf="true" data-offset-key="6286:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6287"><span data-slate-leaf="true" data-offset-key="6287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11423.00</span></span></span></span><span data-slate-object="text" data-key="6288"><span data-slate-leaf="true" data-offset-key="6288:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6289"><span data-slate-leaf="true" data-offset-key="6289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11475.07</span></span></span></span><span data-slate-object="text" data-key="6290"><span data-slate-leaf="true" data-offset-key="6290:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6291"><span data-slate-leaf="true" data-offset-key="6291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">32.996559</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6292"><span data-slate-object="text" data-key="6293"><span data-slate-leaf="true" data-offset-key="6293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2019</span></span></span></span><span data-slate-object="text" data-key="6294"><span data-slate-leaf="true" data-offset-key="6294:0" data-first-offset="true"><span data-slate-string="true">-07-07 </span></span></span><span data-slate-object="text" data-key="6295"><span data-slate-leaf="true" data-offset-key="6295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">22</span></span></span></span><span data-slate-object="text" data-key="6296"><span data-slate-leaf="true" data-offset-key="6296:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6297"><span data-slate-leaf="true" data-offset-key="6297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6298"><span data-slate-leaf="true" data-offset-key="6298:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6299"><span data-slate-leaf="true" data-offset-key="6299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6300"><span data-slate-leaf="true" data-offset-key="6300:0" data-first-offset="true"><span data-slate-string="true">  BTCUSD  </span></span></span><span data-slate-object="text" data-key="6301"><span data-slate-leaf="true" data-offset-key="6301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11526.25</span></span></span></span><span data-slate-object="text" data-key="6302"><span data-slate-leaf="true" data-offset-key="6302:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6303"><span data-slate-leaf="true" data-offset-key="6303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11572.74</span></span></span></span><span data-slate-object="text" data-key="6304"><span data-slate-leaf="true" data-offset-key="6304:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6305"><span data-slate-leaf="true" data-offset-key="6305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11333.59</span></span></span></span><span data-slate-object="text" data-key="6306"><span data-slate-leaf="true" data-offset-key="6306:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6307"><span data-slate-leaf="true" data-offset-key="6307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11423.00</span></span></span></span><span data-slate-object="text" data-key="6308"><span data-slate-leaf="true" data-offset-key="6308:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6309"><span data-slate-leaf="true" data-offset-key="6309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">48.937730</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6310"><span data-slate-object="text" data-key="6311"><span data-slate-leaf="true" data-offset-key="6311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2019</span></span></span></span><span data-slate-object="text" data-key="6312"><span data-slate-leaf="true" data-offset-key="6312:0" data-first-offset="true"><span data-slate-string="true">-07-07 </span></span></span><span data-slate-object="text" data-key="6313"><span data-slate-leaf="true" data-offset-key="6313:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">21</span></span></span></span><span data-slate-object="text" data-key="6314"><span data-slate-leaf="true" data-offset-key="6314:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6315"><span data-slate-leaf="true" data-offset-key="6315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6316"><span data-slate-leaf="true" data-offset-key="6316:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6317"><span data-slate-leaf="true" data-offset-key="6317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6318"><span data-slate-leaf="true" data-offset-key="6318:0" data-first-offset="true"><span data-slate-string="true">  BTCUSD  </span></span></span><span data-slate-object="text" data-key="6319"><span data-slate-leaf="true" data-offset-key="6319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11515.80</span></span></span></span><span data-slate-object="text" data-key="6320"><span data-slate-leaf="true" data-offset-key="6320:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6321"><span data-slate-leaf="true" data-offset-key="6321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11562.65</span></span></span></span><span data-slate-object="text" data-key="6322"><span data-slate-leaf="true" data-offset-key="6322:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6323"><span data-slate-leaf="true" data-offset-key="6323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11478.20</span></span></span></span><span data-slate-object="text" data-key="6324"><span data-slate-leaf="true" data-offset-key="6324:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6325"><span data-slate-leaf="true" data-offset-key="6325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11526.25</span></span></span></span><span data-slate-object="text" data-key="6326"><span data-slate-leaf="true" data-offset-key="6326:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6327"><span data-slate-leaf="true" data-offset-key="6327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">25.323908</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6328"><span data-slate-object="text" data-key="6329"><span data-slate-leaf="true" data-offset-key="6329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2019</span></span></span></span><span data-slate-object="text" data-key="6330"><span data-slate-leaf="true" data-offset-key="6330:0" data-first-offset="true"><span data-slate-string="true">-07-07 </span></span></span><span data-slate-object="text" data-key="6331"><span data-slate-leaf="true" data-offset-key="6331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">20</span></span></span></span><span data-slate-object="text" data-key="6332"><span data-slate-leaf="true" data-offset-key="6332:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6333"><span data-slate-leaf="true" data-offset-key="6333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6334"><span data-slate-leaf="true" data-offset-key="6334:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6335"><span data-slate-leaf="true" data-offset-key="6335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">00</span></span></span></span><span data-slate-object="text" data-key="6336"><span data-slate-leaf="true" data-offset-key="6336:0" data-first-offset="true"><span data-slate-string="true">  BTCUSD  </span></span></span><span data-slate-object="text" data-key="6337"><span data-slate-leaf="true" data-offset-key="6337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11547.98</span></span></span></span><span data-slate-object="text" data-key="6338"><span data-slate-leaf="true" data-offset-key="6338:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6339"><span data-slate-leaf="true" data-offset-key="6339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11624.88</span></span></span></span><span data-slate-object="text" data-key="6340"><span data-slate-leaf="true" data-offset-key="6340:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6341"><span data-slate-leaf="true" data-offset-key="6341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11423.94</span></span></span></span><span data-slate-object="text" data-key="6342"><span data-slate-leaf="true" data-offset-key="6342:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6343"><span data-slate-leaf="true" data-offset-key="6343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11515.80</span></span></span></span><span data-slate-object="text" data-key="6344"><span data-slate-leaf="true" data-offset-key="6344:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6345"><span data-slate-leaf="true" data-offset-key="6345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">63.211972</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6346"><span data-slate-object="text" data-key="6347"><span data-slate-leaf="true" data-offset-key="6347:0" data-first-offset="true"><span data-slate-string="true">这段代码提供了两个工具函数。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6348"><div data-slate-type="list-line" data-slate-object="block" data-key="6349"><span data-slate-object="text" data-key="6350"><span data-slate-leaf="true" data-offset-key="6350:0" data-first-offset="true"><span data-slate-string="true">一个是 read_file，它的作用是，用 pandas 读取 csv 文件。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6351"><span data-slate-object="text" data-key="6352"><span data-slate-leaf="true" data-offset-key="6352:0" data-first-offset="true"><span data-slate-string="true">另一个是 assert_msg，它的作用类似于 assert，如果传入的条件（contidtion）为否，就会抛出异常。不过，你需要提供一个参数，用于指定要抛出的异常信息。</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6353" id="sr-toc-2"><span data-slate-object="text" data-key="6354"><span data-slate-leaf="true" data-offset-key="6354:0" data-first-offset="true"><span data-slate-string="true">回测框架</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6355"><span data-slate-object="text" data-key="6356"><span data-slate-leaf="true" data-offset-key="6356:0" data-first-offset="true"><span data-slate-string="true">说完了数据，我们接着来看回测数据。常见的回测框架有两类。一类是向量化回测框架，它通常基于 Pandas+Numpy 来自己搭建计算核心；后端则是用 MySQL 或者 MongoDB 作为源。这种框架通过 Pandas+Numpy 对 OHLC 数组进行向量运算，可以在较长的历史数据上进行回测。不过，因为这类框架一般只用 OHLC，所以模拟会比较粗糙。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6357"><span data-slate-object="text" data-key="6358"><span data-slate-leaf="true" data-offset-key="6358:0" data-first-offset="true"><span data-slate-string="true">另一类则是事件驱动型回测框架。这类框架，本质上是针对每一个 tick 的变动或者 orderbook 的变动生成事件；然后，再把一个个事件交给策略进行执行。因此，虽然它的拓展性很强，可以允许更加灵活的策略，但回测速度是很慢的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6359"><span data-slate-object="text" data-key="6360"><span data-slate-leaf="true" data-offset-key="6360:0" data-first-offset="true"><span data-slate-string="true">我们想要学习量化交易，使用大型成熟的回测框架，自然是第一选择。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6361"><div data-slate-type="list-line" data-slate-object="block" data-key="6362"><span data-slate-object="text" data-key="6363"><span data-slate-leaf="true" data-offset-key="6363:0" data-first-offset="true"><span data-slate-string="true">比如 Zipline，就是一个热门的事件驱动型回测框架，背后有大型社区和文档的支持。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6364"><span data-slate-object="text" data-key="6365"><span data-slate-leaf="true" data-offset-key="6365:0" data-first-offset="true"><span data-slate-string="true">PyAlgoTrade 也是事件驱动的回测框架，文档相对完整，整合了知名的技术分析（Techique Analysis）库 TA-Lib。在速度和灵活方面，它比 Zipline 强。不过，它的一大硬伤是不支持 Pandas 的模块和对象。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6366"><span data-slate-object="text" data-key="6367"><span data-slate-leaf="true" data-offset-key="6367:0" data-first-offset="true"><span data-slate-string="true">显然，对于我们 Python 学习者来说，第一类也就是向量型回测框架，才是最适合我们练手的项目了。那么，我们就开始吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6368"><span data-slate-object="text" data-key="6369"><span data-slate-leaf="true" data-offset-key="6369:0" data-first-offset="true"><span data-slate-string="true">首先，我先为你梳理下回测流程，也就是下面五步：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6370"><div data-slate-type="list-line" data-slate-object="block" data-key="6371"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="6372"><span data-slate-leaf="true" data-offset-key="6372:0" data-first-offset="true"><span data-slate-string="true">读取 OHLC 数据；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="6373"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="6374"><span data-slate-leaf="true" data-offset-key="6374:0" data-first-offset="true"><span data-slate-string="true">对 OHLC 进行指标运算；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="6375"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="6376"><span data-slate-leaf="true" data-offset-key="6376:0" data-first-offset="true"><span data-slate-string="true">策略根据指标向量决定买卖；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="6377"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="6378"><span data-slate-leaf="true" data-offset-key="6378:0" data-first-offset="true"><span data-slate-string="true">发给模拟的” 交易所 “进行交易；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="6379"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="6380"><span data-slate-leaf="true" data-offset-key="6380:0" data-first-offset="true"><span data-slate-string="true">最后，统计结果。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6381"><span data-slate-object="text" data-key="6382"><span data-slate-leaf="true" data-offset-key="6382:0" data-first-offset="true"><span data-slate-string="true">对此，使用之前学到的面向对象思维方式，我们可以大致抽取三个类：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6383"><div data-slate-type="list-line" data-slate-object="block" data-key="6384"><span data-slate-object="text" data-key="6385"><span data-slate-leaf="true" data-offset-key="6385:0" data-first-offset="true"><span data-slate-string="true">交易所类（ ExchangeAPI）：负责维护账户的资金和仓位，以及进行模拟的买卖；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6386"><span data-slate-object="text" data-key="6387"><span data-slate-leaf="true" data-offset-key="6387:0" data-first-offset="true"><span data-slate-string="true">策略类（Strategy）：负责根据市场信息生成指标，根据指标决定买卖；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6388"><span data-slate-object="text" data-key="6389"><span data-slate-leaf="true" data-offset-key="6389:0" data-first-offset="true"><span data-slate-string="true">回测类框架（Backtest）：包含一个策略类和一个交易所类，负责迭代地对每个数据点调用策略执行。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6390"><span data-slate-object="text" data-key="6391"><span data-slate-leaf="true" data-offset-key="6391:0" data-first-offset="true"><span data-slate-string="true">接下来，我们先从最外层的大框架开始。这样的好处在于，我们是从上到下、从外往内地思考，虽然还没有开始设计依赖项（Backtest 的依赖项是 ExchangeAPI 和 Strategy），但我们可以推测出它们应有的接口形式。推测接口的本质，其实就是推测程序的输入。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6392"><span data-slate-object="text" data-key="6393"><span data-slate-leaf="true" data-offset-key="6393:0" data-first-offset="true"><span data-slate-string="true">这也是我在一开始提到过的，对于程序这个 “黑箱”，你在一开始设计的时候，就要想好输入和输出。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6394"><span data-slate-object="text" data-key="6395"><span data-slate-leaf="true" data-offset-key="6395:0" data-first-offset="true"><span data-slate-string="true">回到最外层 Backtest 类。我们需要知道，输出是最后的收益，那么显然，输入应该是初始输入的资金数量（cash）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6396"><span data-slate-object="text" data-key="6397"><span data-slate-leaf="true" data-offset-key="6397:0" data-first-offset="true"><span data-slate-string="true">此外，为了模拟得更加真实，我们还要考虑交易所的手续费（commission）。手续费的多少取决于券商（broker）或者交易所，比如我们买卖股票的券商手续费可能是万七，那么就是 0.0007。但是在比特币交易领域，手续费通常会稍微高一点，可能是千分之二左右。当然，无论怎么多，一般也不会超过 5 %。否则我们大家交易几次就破产了，也就不会有人去交易了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6398"><span data-slate-object="text" data-key="6399"><span data-slate-leaf="true" data-offset-key="6399:0" data-first-offset="true"><span data-slate-string="true">这里说一句题外话，不知道你有没有发现，无论数字货币的价格是涨还是跌，总有一方永远不亏，那就是交易所。因为只要有人交易，他们就有白花花的银子进账。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6400"><span data-slate-object="text" data-key="6401"><span data-slate-leaf="true" data-offset-key="6401:0" data-first-offset="true"><span data-slate-string="true">回到正题，至此，我们就确定了 Backtest 的输入和输出。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6402"><span data-slate-object="text" data-key="6403"><span data-slate-leaf="true" data-offset-key="6403:0" data-first-offset="true"><span data-slate-string="true">它的输入是：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6404"><div data-slate-type="list-line" data-slate-object="block" data-key="6405"><span data-slate-object="text" data-key="6406"><span data-slate-leaf="true" data-offset-key="6406:0" data-first-offset="true"><span data-slate-string="true">OHLC 数据；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6407"><span data-slate-object="text" data-key="6408"><span data-slate-leaf="true" data-offset-key="6408:0" data-first-offset="true"><span data-slate-string="true">初始资金；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6409"><span data-slate-object="text" data-key="6410"><span data-slate-leaf="true" data-offset-key="6410:0" data-first-offset="true"><span data-slate-string="true">手续费率；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6411"><span data-slate-object="text" data-key="6412"><span data-slate-leaf="true" data-offset-key="6412:0" data-first-offset="true"><span data-slate-string="true">交易所类；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6413"><span data-slate-object="text" data-key="6414"><span data-slate-leaf="true" data-offset-key="6414:0" data-first-offset="true"><span data-slate-string="true">策略类。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6415"><span data-slate-object="text" data-key="6416"><span data-slate-leaf="true" data-offset-key="6416:0" data-first-offset="true"><span data-slate-string="true">输出则是：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6417"><div data-slate-type="list-line" data-slate-object="block" data-key="6418"><span data-slate-object="text" data-key="6419"><span data-slate-leaf="true" data-offset-key="6419:0" data-first-offset="true"><span data-slate-string="true">最后剩余市值。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6420"><span data-slate-object="text" data-key="6421"><span data-slate-leaf="true" data-offset-key="6421:0" data-first-offset="true"><span data-slate-string="true">对此，你可以参考下面这段代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="6422"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6423"><span data-slate-object="text" data-key="6424"><span data-slate-leaf="true" data-offset-key="6424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="6425"><span data-slate-leaf="true" data-offset-key="6425:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6426"><span data-slate-leaf="true" data-offset-key="6426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Backtest</span></span></span></span><span data-slate-object="text" data-key="6427"><span data-slate-leaf="true" data-offset-key="6427:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6428"><span data-slate-object="text" data-key="6429"><span data-slate-leaf="true" data-offset-key="6429:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6430"><span data-slate-leaf="true" data-offset-key="6430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6431"><span data-slate-object="text" data-key="6432"><span data-slate-leaf="true" data-offset-key="6432:0" data-first-offset="true"><span data-slate-string="true">    Backtest 回测类，用于读取历史行情数据、执行策略、模拟交易并估计</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6433"><span data-slate-object="text" data-key="6434"><span data-slate-leaf="true" data-offset-key="6434:0" data-first-offset="true"><span data-slate-string="true">    收益。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6435"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6436"><span data-slate-object="text" data-key="6437"><span data-slate-leaf="true" data-offset-key="6437:0" data-first-offset="true"><span data-slate-string="true">    初始化的时候调用 Backtest.run 来时回测</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6438"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6439"><span data-slate-object="text" data-key="6440"><span data-slate-leaf="true" data-offset-key="6440:0" data-first-offset="true"><span data-slate-string="true">    instance, or `backtesting.backtesting.Backtest.optimize` to</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6441"><span data-slate-object="text" data-key="6442"><span data-slate-leaf="true" data-offset-key="6442:0" data-first-offset="true"><span data-slate-string="true">    optimize it.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6443"><span data-slate-object="text" data-key="6444"><span data-slate-leaf="true" data-offset-key="6444:0" data-first-offset="true"><span data-slate-string="true">    """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6445"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6446"><span data-slate-object="text" data-key="6447"><span data-slate-leaf="true" data-offset-key="6447:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6448"><span data-slate-leaf="true" data-offset-key="6448:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6449"><span data-slate-leaf="true" data-offset-key="6449:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6450"><span data-slate-leaf="true" data-offset-key="6450:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="6451"><span data-slate-leaf="true" data-offset-key="6451:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6452"><span data-slate-leaf="true" data-offset-key="6452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self,</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6453"><span data-slate-object="text" data-key="6454"><span data-slate-leaf="true" data-offset-key="6454:0" data-first-offset="true"><span data-slate-string="true">                 data: pd.DataFrame,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6455"><span data-slate-object="text" data-key="6456"><span data-slate-leaf="true" data-offset-key="6456:0" data-first-offset="true"><span data-slate-string="true">                 strategy_type: </span></span></span><span data-slate-object="text" data-key="6457"><span data-slate-leaf="true" data-offset-key="6457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="6458"><span data-slate-leaf="true" data-offset-key="6458:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6459"><span data-slate-leaf="true" data-offset-key="6459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Strategy</span></span></span></span><span data-slate-object="text" data-key="6460"><span data-slate-leaf="true" data-offset-key="6460:0" data-first-offset="true"><span data-slate-string="true">),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6461"><span data-slate-object="text" data-key="6462"><span data-slate-leaf="true" data-offset-key="6462:0" data-first-offset="true"><span data-slate-string="true">                 broker_type: </span></span></span><span data-slate-object="text" data-key="6463"><span data-slate-leaf="true" data-offset-key="6463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="6464"><span data-slate-leaf="true" data-offset-key="6464:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6465"><span data-slate-leaf="true" data-offset-key="6465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ExchangeAPI</span></span></span></span><span data-slate-object="text" data-key="6466"><span data-slate-leaf="true" data-offset-key="6466:0" data-first-offset="true"><span data-slate-string="true">),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6467"><span data-slate-object="text" data-key="6468"><span data-slate-leaf="true" data-offset-key="6468:0" data-first-offset="true"><span data-slate-string="true">                 cash: </span></span></span><span data-slate-object="text" data-key="6469"><span data-slate-leaf="true" data-offset-key="6469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float</span></span></span></span><span data-slate-object="text" data-key="6470"><span data-slate-leaf="true" data-offset-key="6470:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="6471"><span data-slate-leaf="true" data-offset-key="6471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10000</span></span></span></span><span data-slate-object="text" data-key="6472"><span data-slate-leaf="true" data-offset-key="6472:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6473"><span data-slate-object="text" data-key="6474"><span data-slate-leaf="true" data-offset-key="6474:0" data-first-offset="true"><span data-slate-string="true">                 commission: </span></span></span><span data-slate-object="text" data-key="6475"><span data-slate-leaf="true" data-offset-key="6475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float</span></span></span></span><span data-slate-object="text" data-key="6476"><span data-slate-leaf="true" data-offset-key="6476:0" data-first-offset="true"><span data-slate-string="true"> = </span></span></span><span data-slate-object="text" data-key="6477"><span data-slate-leaf="true" data-offset-key="6477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="6478"><span data-slate-leaf="true" data-offset-key="6478:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6479"><span data-slate-object="text" data-key="6480"><span data-slate-leaf="true" data-offset-key="6480:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6481"><span data-slate-leaf="true" data-offset-key="6481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6482"><span data-slate-object="text" data-key="6483"><span data-slate-leaf="true" data-offset-key="6483:0" data-first-offset="true"><span data-slate-string="true">        构造回测对象。需要的参数包括：历史数据，策略对象，初始资金数量，手续费率等。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6484"><span data-slate-object="text" data-key="6485"><span data-slate-leaf="true" data-offset-key="6485:0" data-first-offset="true"><span data-slate-string="true">        初始化过程包括检测输入类型，填充数据空值等。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6486"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6487"><span data-slate-object="text" data-key="6488"><span data-slate-leaf="true" data-offset-key="6488:0" data-first-offset="true"><span data-slate-string="true">        参数：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6489"><span data-slate-object="text" data-key="6490"><span data-slate-leaf="true" data-offset-key="6490:0" data-first-offset="true"><span data-slate-string="true">        :param data:            pd.DataFrame        pandas Dataframe 格式的历史 OHLCV 数据</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6491"><span data-slate-object="text" data-key="6492"><span data-slate-leaf="true" data-offset-key="6492:0" data-first-offset="true"><span data-slate-string="true">        :param broker_type:     type (ExchangeAPI)   交易所 API 类型，负责执行买卖操作以及账户状态的维护</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6493"><span data-slate-object="text" data-key="6494"><span data-slate-leaf="true" data-offset-key="6494:0" data-first-offset="true"><span data-slate-string="true">        :param strategy_type:   type (Strategy)      策略类型</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6495"><span data-slate-object="text" data-key="6496"><span data-slate-leaf="true" data-offset-key="6496:0" data-first-offset="true"><span data-slate-string="true">        :param cash:            float               初始资金数量</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6497"><span data-slate-object="text" data-key="6498"><span data-slate-leaf="true" data-offset-key="6498:0" data-first-offset="true"><span data-slate-string="true">        :param commission:       float               每次交易手续费率。如 2% 的手续费此处为 0.02</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6499"><span data-slate-object="text" data-key="6500"><span data-slate-leaf="true" data-offset-key="6500:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6501"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6502"><span data-slate-object="text" data-key="6503"><span data-slate-leaf="true" data-offset-key="6503:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="6504"><span data-slate-leaf="true" data-offset-key="6504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">issubclass</span></span></span></span><span data-slate-object="text" data-key="6505"><span data-slate-leaf="true" data-offset-key="6505:0" data-first-offset="true"><span data-slate-string="true">(strategy_type, Strategy), </span></span></span><span data-slate-object="text" data-key="6506"><span data-slate-leaf="true" data-offset-key="6506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'strategy_type 不是一个 Strategy 类型'</span></span></span></span><span data-slate-object="text" data-key="6507"><span data-slate-leaf="true" data-offset-key="6507:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6508"><span data-slate-object="text" data-key="6509"><span data-slate-leaf="true" data-offset-key="6509:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="6510"><span data-slate-leaf="true" data-offset-key="6510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">issubclass</span></span></span></span><span data-slate-object="text" data-key="6511"><span data-slate-leaf="true" data-offset-key="6511:0" data-first-offset="true"><span data-slate-string="true">(broker_type, ExchangeAPI), </span></span></span><span data-slate-object="text" data-key="6512"><span data-slate-leaf="true" data-offset-key="6512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'strategy_type 不是一个 Strategy 类型'</span></span></span></span><span data-slate-object="text" data-key="6513"><span data-slate-leaf="true" data-offset-key="6513:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6514"><span data-slate-object="text" data-key="6515"><span data-slate-leaf="true" data-offset-key="6515:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="6516"><span data-slate-leaf="true" data-offset-key="6516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">isinstance</span></span></span></span><span data-slate-object="text" data-key="6517"><span data-slate-leaf="true" data-offset-key="6517:0" data-first-offset="true"><span data-slate-string="true">(commission, Number), </span></span></span><span data-slate-object="text" data-key="6518"><span data-slate-leaf="true" data-offset-key="6518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'commission 不是浮点数值类型'</span></span></span></span><span data-slate-object="text" data-key="6519"><span data-slate-leaf="true" data-offset-key="6519:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6520"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6521"><span data-slate-object="text" data-key="6522"><span data-slate-leaf="true" data-offset-key="6522:0" data-first-offset="true"><span data-slate-string="true">        data = data.copy(</span></span></span><span data-slate-object="text" data-key="6523"><span data-slate-leaf="true" data-offset-key="6523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="6524"><span data-slate-leaf="true" data-offset-key="6524:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6525"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6526"><span data-slate-object="text" data-key="6527"><span data-slate-leaf="true" data-offset-key="6527:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6528"><span data-slate-leaf="true" data-offset-key="6528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果没有 Volumn 列，填充 NaN</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6529"><span data-slate-object="text" data-key="6530"><span data-slate-leaf="true" data-offset-key="6530:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6531"><span data-slate-leaf="true" data-offset-key="6531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6532"><span data-slate-leaf="true" data-offset-key="6532:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6533"><span data-slate-leaf="true" data-offset-key="6533:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Volume'</span></span></span></span><span data-slate-object="text" data-key="6534"><span data-slate-leaf="true" data-offset-key="6534:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6535"><span data-slate-leaf="true" data-offset-key="6535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">not</span></span></span></span><span data-slate-object="text" data-key="6536"><span data-slate-leaf="true" data-offset-key="6536:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6537"><span data-slate-leaf="true" data-offset-key="6537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="6538"><span data-slate-leaf="true" data-offset-key="6538:0" data-first-offset="true"><span data-slate-string="true"> data:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6539"><span data-slate-object="text" data-key="6540"><span data-slate-leaf="true" data-offset-key="6540:0" data-first-offset="true"><span data-slate-string="true">            data[</span></span></span><span data-slate-object="text" data-key="6541"><span data-slate-leaf="true" data-offset-key="6541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Volume'</span></span></span></span><span data-slate-object="text" data-key="6542"><span data-slate-leaf="true" data-offset-key="6542:0" data-first-offset="true"><span data-slate-string="true">] = np.nan</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6543"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6544"><span data-slate-object="text" data-key="6545"><span data-slate-leaf="true" data-offset-key="6545:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6546"><span data-slate-leaf="true" data-offset-key="6546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 验证 OHLC 数据格式</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6547"><span data-slate-object="text" data-key="6548"><span data-slate-leaf="true" data-offset-key="6548:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="6549"><span data-slate-leaf="true" data-offset-key="6549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="6550"><span data-slate-leaf="true" data-offset-key="6550:0" data-first-offset="true"><span data-slate-string="true">(data.columns &amp; {</span></span></span><span data-slate-object="text" data-key="6551"><span data-slate-leaf="true" data-offset-key="6551:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Open'</span></span></span></span><span data-slate-object="text" data-key="6552"><span data-slate-leaf="true" data-offset-key="6552:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6553"><span data-slate-leaf="true" data-offset-key="6553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'High'</span></span></span></span><span data-slate-object="text" data-key="6554"><span data-slate-leaf="true" data-offset-key="6554:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6555"><span data-slate-leaf="true" data-offset-key="6555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Low'</span></span></span></span><span data-slate-object="text" data-key="6556"><span data-slate-leaf="true" data-offset-key="6556:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6557"><span data-slate-leaf="true" data-offset-key="6557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Close'</span></span></span></span><span data-slate-object="text" data-key="6558"><span data-slate-leaf="true" data-offset-key="6558:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6559"><span data-slate-leaf="true" data-offset-key="6559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Volume'</span></span></span></span><span data-slate-object="text" data-key="6560"><span data-slate-leaf="true" data-offset-key="6560:0" data-first-offset="true"><span data-slate-string="true">}) == </span></span></span><span data-slate-object="text" data-key="6561"><span data-slate-leaf="true" data-offset-key="6561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="6562"><span data-slate-leaf="true" data-offset-key="6562:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6563"><span data-slate-object="text" data-key="6564"><span data-slate-leaf="true" data-offset-key="6564:0" data-first-offset="true"><span data-slate-string="true">                   (</span></span></span><span data-slate-object="text" data-key="6565"><span data-slate-leaf="true" data-offset-key="6565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"输入的 `data` 格式不正确，至少需要包含这些列："</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6566"><span data-slate-object="text" data-key="6567"><span data-slate-leaf="true" data-offset-key="6567:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="6568"><span data-slate-leaf="true" data-offset-key="6568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"'Open', 'High', 'Low', 'Close'"</span></span></span></span><span data-slate-object="text" data-key="6569"><span data-slate-leaf="true" data-offset-key="6569:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6570"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6571"><span data-slate-object="text" data-key="6572"><span data-slate-leaf="true" data-offset-key="6572:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6573"><span data-slate-leaf="true" data-offset-key="6573:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 检查缺失值</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6574"><span data-slate-object="text" data-key="6575"><span data-slate-leaf="true" data-offset-key="6575:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="6576"><span data-slate-leaf="true" data-offset-key="6576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">not</span></span></span></span><span data-slate-object="text" data-key="6577"><span data-slate-leaf="true" data-offset-key="6577:0" data-first-offset="true"><span data-slate-string="true"> data[[</span></span></span><span data-slate-object="text" data-key="6578"><span data-slate-leaf="true" data-offset-key="6578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Open'</span></span></span></span><span data-slate-object="text" data-key="6579"><span data-slate-leaf="true" data-offset-key="6579:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6580"><span data-slate-leaf="true" data-offset-key="6580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'High'</span></span></span></span><span data-slate-object="text" data-key="6581"><span data-slate-leaf="true" data-offset-key="6581:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6582"><span data-slate-leaf="true" data-offset-key="6582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Low'</span></span></span></span><span data-slate-object="text" data-key="6583"><span data-slate-leaf="true" data-offset-key="6583:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6584"><span data-slate-leaf="true" data-offset-key="6584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Close'</span></span></span></span><span data-slate-object="text" data-key="6585"><span data-slate-leaf="true" data-offset-key="6585:0" data-first-offset="true"><span data-slate-string="true">]].</span></span></span><span data-slate-object="text" data-key="6586"><span data-slate-leaf="true" data-offset-key="6586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">max</span></span></span></span><span data-slate-object="text" data-key="6587"><span data-slate-leaf="true" data-offset-key="6587:0" data-first-offset="true"><span data-slate-string="true">().isnull().</span></span></span><span data-slate-object="text" data-key="6588"><span data-slate-leaf="true" data-offset-key="6588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">any</span></span></span></span><span data-slate-object="text" data-key="6589"><span data-slate-leaf="true" data-offset-key="6589:0" data-first-offset="true"><span data-slate-string="true">(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6590"><span data-slate-object="text" data-key="6591"><span data-slate-leaf="true" data-offset-key="6591:0" data-first-offset="true"><span data-slate-string="true">            (</span></span></span><span data-slate-object="text" data-key="6592"><span data-slate-leaf="true" data-offset-key="6592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'部分 OHLC 包含缺失值，请去掉那些行或者通过差值填充.'</span></span></span></span><span data-slate-object="text" data-key="6593"><span data-slate-leaf="true" data-offset-key="6593:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6594"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6595"><span data-slate-object="text" data-key="6596"><span data-slate-leaf="true" data-offset-key="6596:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6597"><span data-slate-leaf="true" data-offset-key="6597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果行情数据没有按照时间排序，重新排序一下</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6598"><span data-slate-object="text" data-key="6599"><span data-slate-leaf="true" data-offset-key="6599:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6600"><span data-slate-leaf="true" data-offset-key="6600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6601"><span data-slate-leaf="true" data-offset-key="6601:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6602"><span data-slate-leaf="true" data-offset-key="6602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">not</span></span></span></span><span data-slate-object="text" data-key="6603"><span data-slate-leaf="true" data-offset-key="6603:0" data-first-offset="true"><span data-slate-string="true"> data.index.is_monotonic_increasing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6604"><span data-slate-object="text" data-key="6605"><span data-slate-leaf="true" data-offset-key="6605:0" data-first-offset="true"><span data-slate-string="true">            data = data.sort_index()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6606"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6607"><span data-slate-object="text" data-key="6608"><span data-slate-leaf="true" data-offset-key="6608:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6609"><span data-slate-leaf="true" data-offset-key="6609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 利用数据，初始化交易所对象和策略对象。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6610"><span data-slate-object="text" data-key="6611"><span data-slate-leaf="true" data-offset-key="6611:0" data-first-offset="true"><span data-slate-string="true">        self._data = data  </span></span></span><span data-slate-object="text" data-key="6612"><span data-slate-leaf="true" data-offset-key="6612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># type: pd.DataFrame</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6613"><span data-slate-object="text" data-key="6614"><span data-slate-leaf="true" data-offset-key="6614:0" data-first-offset="true"><span data-slate-string="true">        self._broker = broker_type(data, cash, commission)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6615"><span data-slate-object="text" data-key="6616"><span data-slate-leaf="true" data-offset-key="6616:0" data-first-offset="true"><span data-slate-string="true">        self._strategy = strategy_type(self._broker, self._data)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6617"><span data-slate-object="text" data-key="6618"><span data-slate-leaf="true" data-offset-key="6618:0" data-first-offset="true"><span data-slate-string="true">        self._results = </span></span></span><span data-slate-object="text" data-key="6619"><span data-slate-leaf="true" data-offset-key="6619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">None</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6620"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6621"><span data-slate-object="text" data-key="6622"><span data-slate-leaf="true" data-offset-key="6622:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6623"><span data-slate-leaf="true" data-offset-key="6623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6624"><span data-slate-leaf="true" data-offset-key="6624:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6625"><span data-slate-leaf="true" data-offset-key="6625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">run</span></span></span></span><span data-slate-object="text" data-key="6626"><span data-slate-leaf="true" data-offset-key="6626:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6627"><span data-slate-leaf="true" data-offset-key="6627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6628"><span data-slate-leaf="true" data-offset-key="6628:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6629"><span data-slate-object="text" data-key="6630"><span data-slate-leaf="true" data-offset-key="6630:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6631"><span data-slate-leaf="true" data-offset-key="6631:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6632"><span data-slate-object="text" data-key="6633"><span data-slate-leaf="true" data-offset-key="6633:0" data-first-offset="true"><span data-slate-string="true">        运行回测，迭代历史数据，执行模拟交易并返回回测结果。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6634"><span data-slate-object="text" data-key="6635"><span data-slate-leaf="true" data-offset-key="6635:0" data-first-offset="true"><span data-slate-string="true">        Run the backtest. Returns `pd.Series` with results and statistics.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6636"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6637"><span data-slate-object="text" data-key="6638"><span data-slate-leaf="true" data-offset-key="6638:0" data-first-offset="true"><span data-slate-string="true">        Keyword arguments are interpreted as strategy parameters.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6639"><span data-slate-object="text" data-key="6640"><span data-slate-leaf="true" data-offset-key="6640:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6641"><span data-slate-object="text" data-key="6642"><span data-slate-leaf="true" data-offset-key="6642:0" data-first-offset="true"><span data-slate-string="true">        strategy = self._strategy</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6643"><span data-slate-object="text" data-key="6644"><span data-slate-leaf="true" data-offset-key="6644:0" data-first-offset="true"><span data-slate-string="true">        broker = self._broker</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6645"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6646"><span data-slate-object="text" data-key="6647"><span data-slate-leaf="true" data-offset-key="6647:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6648"><span data-slate-leaf="true" data-offset-key="6648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 策略初始化</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6649"><span data-slate-object="text" data-key="6650"><span data-slate-leaf="true" data-offset-key="6650:0" data-first-offset="true"><span data-slate-string="true">        strategy.init()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6651"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6652"><span data-slate-object="text" data-key="6653"><span data-slate-leaf="true" data-offset-key="6653:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6654"><span data-slate-leaf="true" data-offset-key="6654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 设定回测开始和结束位置</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6655"><span data-slate-object="text" data-key="6656"><span data-slate-leaf="true" data-offset-key="6656:0" data-first-offset="true"><span data-slate-string="true">        start = </span></span></span><span data-slate-object="text" data-key="6657"><span data-slate-leaf="true" data-offset-key="6657:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6658"><span data-slate-object="text" data-key="6659"><span data-slate-leaf="true" data-offset-key="6659:0" data-first-offset="true"><span data-slate-string="true">        end = </span></span></span><span data-slate-object="text" data-key="6660"><span data-slate-leaf="true" data-offset-key="6660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="6661"><span data-slate-leaf="true" data-offset-key="6661:0" data-first-offset="true"><span data-slate-string="true">(self._data)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6662"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6663"><span data-slate-object="text" data-key="6664"><span data-slate-leaf="true" data-offset-key="6664:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6665"><span data-slate-leaf="true" data-offset-key="6665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 回测主循环，更新市场状态，然后执行策略</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6666"><span data-slate-object="text" data-key="6667"><span data-slate-leaf="true" data-offset-key="6667:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6668"><span data-slate-leaf="true" data-offset-key="6668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="6669"><span data-slate-leaf="true" data-offset-key="6669:0" data-first-offset="true"><span data-slate-string="true"> i </span></span></span><span data-slate-object="text" data-key="6670"><span data-slate-leaf="true" data-offset-key="6670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="6671"><span data-slate-leaf="true" data-offset-key="6671:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6672"><span data-slate-leaf="true" data-offset-key="6672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="6673"><span data-slate-leaf="true" data-offset-key="6673:0" data-first-offset="true"><span data-slate-string="true">(start, end):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6674"><span data-slate-object="text" data-key="6675"><span data-slate-leaf="true" data-offset-key="6675:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="6676"><span data-slate-leaf="true" data-offset-key="6676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 注意要先把市场状态移动到第 i 时刻，然后再执行策略。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6677"><span data-slate-object="text" data-key="6678"><span data-slate-leaf="true" data-offset-key="6678:0" data-first-offset="true"><span data-slate-string="true">            broker.</span></span></span><span data-slate-object="text" data-key="6679"><span data-slate-leaf="true" data-offset-key="6679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="6680"><span data-slate-leaf="true" data-offset-key="6680:0" data-first-offset="true"><span data-slate-string="true">(i)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6681"><span data-slate-object="text" data-key="6682"><span data-slate-leaf="true" data-offset-key="6682:0" data-first-offset="true"><span data-slate-string="true">            strategy.</span></span></span><span data-slate-object="text" data-key="6683"><span data-slate-leaf="true" data-offset-key="6683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="6684"><span data-slate-leaf="true" data-offset-key="6684:0" data-first-offset="true"><span data-slate-string="true">(i)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6685"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6686"><span data-slate-object="text" data-key="6687"><span data-slate-leaf="true" data-offset-key="6687:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6688"><span data-slate-leaf="true" data-offset-key="6688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 完成策略执行之后，计算结果并返回</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6689"><span data-slate-object="text" data-key="6690"><span data-slate-leaf="true" data-offset-key="6690:0" data-first-offset="true"><span data-slate-string="true">        self._results = self._compute_result(broker)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6691"><span data-slate-object="text" data-key="6692"><span data-slate-leaf="true" data-offset-key="6692:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6693"><span data-slate-leaf="true" data-offset-key="6693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6694"><span data-slate-leaf="true" data-offset-key="6694:0" data-first-offset="true"><span data-slate-string="true"> self._results</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6695"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6696"><span data-slate-object="text" data-key="6697"><span data-slate-leaf="true" data-offset-key="6697:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6698"><span data-slate-leaf="true" data-offset-key="6698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6699"><span data-slate-leaf="true" data-offset-key="6699:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6700"><span data-slate-leaf="true" data-offset-key="6700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">_compute_result</span></span></span></span><span data-slate-object="text" data-key="6701"><span data-slate-leaf="true" data-offset-key="6701:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6702"><span data-slate-leaf="true" data-offset-key="6702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, broker</span></span></span></span><span data-slate-object="text" data-key="6703"><span data-slate-leaf="true" data-offset-key="6703:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6704"><span data-slate-object="text" data-key="6705"><span data-slate-leaf="true" data-offset-key="6705:0" data-first-offset="true"><span data-slate-string="true">        s = pd.Series()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6706"><span data-slate-object="text" data-key="6707"><span data-slate-leaf="true" data-offset-key="6707:0" data-first-offset="true"><span data-slate-string="true">        s[</span></span></span><span data-slate-object="text" data-key="6708"><span data-slate-leaf="true" data-offset-key="6708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'初始市值'</span></span></span></span><span data-slate-object="text" data-key="6709"><span data-slate-leaf="true" data-offset-key="6709:0" data-first-offset="true"><span data-slate-string="true">] = broker.initial_cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6710"><span data-slate-object="text" data-key="6711"><span data-slate-leaf="true" data-offset-key="6711:0" data-first-offset="true"><span data-slate-string="true">        s[</span></span></span><span data-slate-object="text" data-key="6712"><span data-slate-leaf="true" data-offset-key="6712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'结束市值'</span></span></span></span><span data-slate-object="text" data-key="6713"><span data-slate-leaf="true" data-offset-key="6713:0" data-first-offset="true"><span data-slate-string="true">] = broker.market_value</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6714"><span data-slate-object="text" data-key="6715"><span data-slate-leaf="true" data-offset-key="6715:0" data-first-offset="true"><span data-slate-string="true">        s[</span></span></span><span data-slate-object="text" data-key="6716"><span data-slate-leaf="true" data-offset-key="6716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'收益'</span></span></span></span><span data-slate-object="text" data-key="6717"><span data-slate-leaf="true" data-offset-key="6717:0" data-first-offset="true"><span data-slate-string="true">] = broker.market_value - broker.initial_cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6718"><span data-slate-object="text" data-key="6719"><span data-slate-leaf="true" data-offset-key="6719:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6720"><span data-slate-leaf="true" data-offset-key="6720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6721"><span data-slate-leaf="true" data-offset-key="6721:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6722"><span data-slate-object="text" data-key="6723"><span data-slate-leaf="true" data-offset-key="6723:0" data-first-offset="true"><span data-slate-string="true">这段代码有点长，但是核心其实就两部分。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6724"><div data-slate-type="list-line" data-slate-object="block" data-key="6725"><span data-slate-object="text" data-key="6726"><span data-slate-leaf="true" data-offset-key="6726:0" data-first-offset="true"><span data-slate-string="true">初始化函数（</span></span></span><span data-slate-object="text" data-key="6727"><span data-slate-leaf="true" data-offset-key="6727:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">init</span></span></span></span><span data-slate-object="text" data-key="6728"><span data-slate-leaf="true" data-offset-key="6728:0" data-first-offset="true"><span data-slate-string="true">）：传入必要参数，对 OHLC 数据进行简单清洗、排序和验证。我们从不同地方下载的数据，可能格式不一样；而排序的方式也可能是从前往后。所以，这里我们把数据统一设置为按照时间从之前往现在的排序。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6729"><span data-slate-object="text" data-key="6730"><span data-slate-leaf="true" data-offset-key="6730:0" data-first-offset="true"><span data-slate-string="true">执行函数（run）：这是回测框架的主要循环部分，核心是更新市场还有更新策略的时间。迭代完成所有的历史数据后，它会计算收益并返回。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6731"><span data-slate-object="text" data-key="6732"><span data-slate-leaf="true" data-offset-key="6732:0" data-first-offset="true"><span data-slate-string="true">你应该注意到了，此时，我们还没有定义策略和交易所 API 的结构。不过，通过回测的执行函数，我们可以确定这两个类的接口形式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6733"><span data-slate-object="text" data-key="6734"><span data-slate-leaf="true" data-offset-key="6734:0" data-first-offset="true"><span data-slate-string="true">策略类（Strategy）的接口形式为：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6735"><div data-slate-type="list-line" data-slate-object="block" data-key="6736"><span data-slate-object="text" data-key="6737"><span data-slate-leaf="true" data-offset-key="6737:0" data-first-offset="true"><span data-slate-string="true">初始化函数 init ()，根据历史数据进行指标（Indicator）计算。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6738"><span data-slate-object="text" data-key="6739"><span data-slate-leaf="true" data-offset-key="6739:0" data-first-offset="true"><span data-slate-string="true">步进函数 next ()，根据当前时间和指标，决定买卖操作，并发给交易所类执行。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6740"><span data-slate-object="text" data-key="6741"><span data-slate-leaf="true" data-offset-key="6741:0" data-first-offset="true"><span data-slate-string="true">交易所类（ExchangeAPI）的接口形式为：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6742"><div data-slate-type="list-line" data-slate-object="block" data-key="6743"><span data-slate-object="text" data-key="6744"><span data-slate-leaf="true" data-offset-key="6744:0" data-first-offset="true"><span data-slate-string="true">步进函数 next ()，根据当前时间，更新最新的价格；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6745"><span data-slate-object="text" data-key="6746"><span data-slate-leaf="true" data-offset-key="6746:0" data-first-offset="true"><span data-slate-string="true">买入操作 buy ()，买入资产；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6747"><span data-slate-object="text" data-key="6748"><span data-slate-leaf="true" data-offset-key="6748:0" data-first-offset="true"><span data-slate-string="true">卖出操作 sell ()，卖出资产。</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6749" id="sr-toc-3"><span data-slate-object="text" data-key="6750"><span data-slate-leaf="true" data-offset-key="6750:0" data-first-offset="true"><span data-slate-string="true">交易策略</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6751"><span data-slate-object="text" data-key="6752"><span data-slate-leaf="true" data-offset-key="6752:0" data-first-offset="true"><span data-slate-string="true">接下来我们来看交易策略。交易策略的开发是一个非常复杂的学问。为了达到学习的目的，我们来想一个简单的策略 —— 移动均值交叉策略。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6753"><span data-slate-object="text" data-key="6754"><span data-slate-leaf="true" data-offset-key="6754:0" data-first-offset="true"><span data-slate-string="true">为了了解这个策略，我们先了解一下，什么叫做简单移动均值（Simple Moving Average，简称为 SMA，以下皆用 SMA 表示简单移动均值）。我们知道，N 个数的序列  x [0]、x [1] .……  x [N]  的均值，就是这 N 个数的和除以 N。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6755"><span data-slate-object="text" data-key="6756"><span data-slate-leaf="true" data-offset-key="6756:0" data-first-offset="true"><span data-slate-string="true">现在，我假设一个比较小的数 K，比 N 小很多。我们用一个 K 大小的滑动窗口，在原始的数组上滑动。通过对每次框住的 K 个元素求均值，我们就可以得到，原始数组的窗口大小为 K 的 SMA 了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6757"><span data-slate-object="text" data-key="6758"><span data-slate-leaf="true" data-offset-key="6758:0" data-first-offset="true"><span data-slate-string="true">SMA，实质上就是对原始数组进行了一个简单平滑处理。比如，某支股票的价格波动很大，那么，我们用 SMA 平滑之后，就会得到下面这张图的效果。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6759"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/b5/0f/b543927903fbbaa33980a2046651530f.png?wh=1204*706"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6760"><span data-slate-object="text" data-key="6761"><span data-slate-leaf="true" data-offset-key="6761:0" data-first-offset="true"><span data-slate-string="true">某个投资品价格的 SMA，窗口大小为 50</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6762"><span data-slate-object="text" data-key="6763"><span data-slate-leaf="true" data-offset-key="6763:0" data-first-offset="true"><span data-slate-string="true">你可以看出，如果窗口大小越大，那么 SMA 应该越平滑，变化越慢；反之，如果 SMA 比较小，那么短期的变化也会越快地反映在 SMA 上。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6764"><span data-slate-object="text" data-key="6765"><span data-slate-leaf="true" data-offset-key="6765:0" data-first-offset="true"><span data-slate-string="true">于是，我们想到，能不能对投资品的价格设置两个指标呢？这俩指标，一个是小窗口的 SMA，一个是大窗口的 SMA。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="6766"><div data-slate-type="list-line" data-slate-object="block" data-key="6767"><span data-slate-object="text" data-key="6768"><span data-slate-leaf="true" data-offset-key="6768:0" data-first-offset="true"><span data-slate-string="true">如果小窗口的 SMA 曲线从下面刺破或者穿过大窗口 SMA，那么说明，这个投资品的价格在短期内快速上涨，同时这个趋势很强烈，可能是一个买入的信号；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="6769"><span data-slate-object="text" data-key="6770"><span data-slate-leaf="true" data-offset-key="6770:0" data-first-offset="true"><span data-slate-string="true">反之，如果大窗口的 SMA 从下方突破小窗口 SMA，那么说明，投资品的价格在短期内快速下跌，我们应该考虑卖出。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6771"><span data-slate-object="text" data-key="6772"><span data-slate-leaf="true" data-offset-key="6772:0" data-first-offset="true"><span data-slate-string="true">下面这幅图，就展示了这两种情况。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6773"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/40/66/408ff342683f6ac1af798ba3d488c266.png?wh=1161*841"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6774"><span data-slate-object="text" data-key="6775"><span data-slate-leaf="true" data-offset-key="6775:0" data-first-offset="true"><span data-slate-string="true">明白了这里的概念和原理后，接下来的操作就不难了。利用 Pandas，我们可以非常简单地计算 SMA 和 SMA 交叉。比如，你可以引入下面两个工具函数：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="6776"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6777"><span data-slate-object="text" data-key="6778"><span data-slate-leaf="true" data-offset-key="6778:0" data-first-offset="true"><span data-slate-string="true">def SMA(</span></span></span><span data-slate-object="text" data-key="6779"><span data-slate-leaf="true" data-offset-key="6779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">values</span></span></span></span><span data-slate-object="text" data-key="6780"><span data-slate-leaf="true" data-offset-key="6780:0" data-first-offset="true"><span data-slate-string="true">, n):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6781"><span data-slate-object="text" data-key="6782"><span data-slate-leaf="true" data-offset-key="6782:0" data-first-offset="true"><span data-slate-string="true">    """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6783"><span data-slate-object="text" data-key="6784"><span data-slate-leaf="true" data-offset-key="6784:0" data-first-offset="true"><span data-slate-string="true">    返回简单滑动平均</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6785"><span data-slate-object="text" data-key="6786"><span data-slate-leaf="true" data-offset-key="6786:0" data-first-offset="true"><span data-slate-string="true">    """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6787"><span data-slate-object="text" data-key="6788"><span data-slate-leaf="true" data-offset-key="6788:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6789"><span data-slate-leaf="true" data-offset-key="6789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6790"><span data-slate-leaf="true" data-offset-key="6790:0" data-first-offset="true"><span data-slate-string="true"> pd.Series(</span></span></span><span data-slate-object="text" data-key="6791"><span data-slate-leaf="true" data-offset-key="6791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">values</span></span></span></span><span data-slate-object="text" data-key="6792"><span data-slate-leaf="true" data-offset-key="6792:0" data-first-offset="true"><span data-slate-string="true">).rolling(n).mean()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6793"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6794"><span data-slate-object="text" data-key="6795"><span data-slate-leaf="true" data-offset-key="6795:0" data-first-offset="true"><span data-slate-string="true">def crossover(series1, series2) </span></span></span><span data-slate-object="text" data-key="6796"><span data-slate-leaf="true" data-offset-key="6796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="6797"><span data-slate-leaf="true" data-offset-key="6797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span><span data-slate-object="text" data-key="6798"><span data-slate-leaf="true" data-offset-key="6798:0" data-first-offset="true"><span data-slate-string="true"> bool:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6799"><span data-slate-object="text" data-key="6800"><span data-slate-leaf="true" data-offset-key="6800:0" data-first-offset="true"><span data-slate-string="true">    """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6801"><span data-slate-object="text" data-key="6802"><span data-slate-leaf="true" data-offset-key="6802:0" data-first-offset="true"><span data-slate-string="true">    检查两个序列是否在结尾交叉</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6803"><span data-slate-object="text" data-key="6804"><span data-slate-leaf="true" data-offset-key="6804:0" data-first-offset="true"><span data-slate-string="true">    :param series1:  序列 1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6805"><span data-slate-object="text" data-key="6806"><span data-slate-leaf="true" data-offset-key="6806:0" data-first-offset="true"><span data-slate-string="true">    :param series2:  序列 2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6807"><span data-slate-object="text" data-key="6808"><span data-slate-leaf="true" data-offset-key="6808:0" data-first-offset="true"><span data-slate-string="true">    :return:         如果交叉返回 True，反之 False</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6809"><span data-slate-object="text" data-key="6810"><span data-slate-leaf="true" data-offset-key="6810:0" data-first-offset="true"><span data-slate-string="true">    """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6811"><span data-slate-object="text" data-key="6812"><span data-slate-leaf="true" data-offset-key="6812:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6813"><span data-slate-leaf="true" data-offset-key="6813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6814"><span data-slate-leaf="true" data-offset-key="6814:0" data-first-offset="true"><span data-slate-string="true"> series1[</span></span></span><span data-slate-object="text" data-key="6815"><span data-slate-leaf="true" data-offset-key="6815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-2</span></span></span></span><span data-slate-object="text" data-key="6816"><span data-slate-leaf="true" data-offset-key="6816:0" data-first-offset="true"><span data-slate-string="true">] </span></span></span><span data-slate-object="text" data-key="6817"><span data-slate-leaf="true" data-offset-key="6817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6818"><span data-slate-leaf="true" data-offset-key="6818:0" data-first-offset="true"><span data-slate-string="true"> series2[</span></span></span><span data-slate-object="text" data-key="6819"><span data-slate-leaf="true" data-offset-key="6819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-2</span></span></span></span><span data-slate-object="text" data-key="6820"><span data-slate-leaf="true" data-offset-key="6820:0" data-first-offset="true"><span data-slate-string="true">] </span></span></span><span data-slate-object="text" data-key="6821"><span data-slate-leaf="true" data-offset-key="6821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">and</span></span></span></span><span data-slate-object="text" data-key="6822"><span data-slate-leaf="true" data-offset-key="6822:0" data-first-offset="true"><span data-slate-string="true"> series1[</span></span></span><span data-slate-object="text" data-key="6823"><span data-slate-leaf="true" data-offset-key="6823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="6824"><span data-slate-leaf="true" data-offset-key="6824:0" data-first-offset="true"><span data-slate-string="true">] </span></span></span><span data-slate-object="text" data-key="6825"><span data-slate-leaf="true" data-offset-key="6825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span><span data-slate-object="text" data-key="6826"><span data-slate-leaf="true" data-offset-key="6826:0" data-first-offset="true"><span data-slate-string="true"> series2[</span></span></span><span data-slate-object="text" data-key="6827"><span data-slate-leaf="true" data-offset-key="6827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="6828"><span data-slate-leaf="true" data-offset-key="6828:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6829"><span data-slate-object="text" data-key="6830"><span data-slate-leaf="true" data-offset-key="6830:0" data-first-offset="true"><span data-slate-string="true">如代码所示，对于输入的一个数组，Pandas 的 rolling (k) 函数，可以方便地计算窗内口大小为 K 的 SMA 数组；而想要检查某个时刻两个 SMA 是否交叉，你只需要查看两个数组末尾的两个元素即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6831"><span data-slate-object="text" data-key="6832"><span data-slate-leaf="true" data-offset-key="6832:0" data-first-offset="true"><span data-slate-string="true">那么，基于此，我们就可以开发出一个简单的策略了。下面这段代码表示策略的核心思想，我做了详细的注释，你理解起来应该没有问题：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="6833"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6834"><span data-slate-object="text" data-key="6835"><span data-slate-leaf="true" data-offset-key="6835:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6836"><span data-slate-leaf="true" data-offset-key="6836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="6837"><span data-slate-leaf="true" data-offset-key="6837:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6838"><span data-slate-leaf="true" data-offset-key="6838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="6839"><span data-slate-leaf="true" data-offset-key="6839:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6840"><span data-slate-leaf="true" data-offset-key="6840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, tick</span></span></span></span><span data-slate-object="text" data-key="6841"><span data-slate-leaf="true" data-offset-key="6841:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6842"><span data-slate-object="text" data-key="6843"><span data-slate-leaf="true" data-offset-key="6843:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6844"><span data-slate-leaf="true" data-offset-key="6844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果此时快线刚好越过慢线，买入全部</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6845"><span data-slate-object="text" data-key="6846"><span data-slate-leaf="true" data-offset-key="6846:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6847"><span data-slate-leaf="true" data-offset-key="6847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6848"><span data-slate-leaf="true" data-offset-key="6848:0" data-first-offset="true"><span data-slate-string="true"> crossover(self.sma1[:tick], self.sma2[:tick]):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6849"><span data-slate-object="text" data-key="6850"><span data-slate-leaf="true" data-offset-key="6850:0" data-first-offset="true"><span data-slate-string="true">            self.buy()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6851"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6852"><span data-slate-object="text" data-key="6853"><span data-slate-leaf="true" data-offset-key="6853:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6854"><span data-slate-leaf="true" data-offset-key="6854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果是慢线刚好越过快线，卖出全部</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6855"><span data-slate-object="text" data-key="6856"><span data-slate-leaf="true" data-offset-key="6856:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6857"><span data-slate-leaf="true" data-offset-key="6857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">elif</span></span></span></span><span data-slate-object="text" data-key="6858"><span data-slate-leaf="true" data-offset-key="6858:0" data-first-offset="true"><span data-slate-string="true"> crossover(self.sma2[:tick], self.sma1[:tick]):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6859"><span data-slate-object="text" data-key="6860"><span data-slate-leaf="true" data-offset-key="6860:0" data-first-offset="true"><span data-slate-string="true">            self.sell()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6861"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6862"><span data-slate-object="text" data-key="6863"><span data-slate-leaf="true" data-offset-key="6863:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6864"><span data-slate-leaf="true" data-offset-key="6864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 否则，这个时刻不执行任何操作。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6865"><span data-slate-object="text" data-key="6866"><span data-slate-leaf="true" data-offset-key="6866:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6867"><span data-slate-leaf="true" data-offset-key="6867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="6868"><span data-slate-leaf="true" data-offset-key="6868:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6869"><span data-slate-object="text" data-key="6870"><span data-slate-leaf="true" data-offset-key="6870:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="6871"><span data-slate-leaf="true" data-offset-key="6871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">pass</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6872"><span data-slate-object="text" data-key="6873"><span data-slate-leaf="true" data-offset-key="6873:0" data-first-offset="true"><span data-slate-string="true">说完策略的核心思想，我们开始搭建策略类的框子。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6874"><span data-slate-object="text" data-key="6875"><span data-slate-leaf="true" data-offset-key="6875:0" data-first-offset="true"><span data-slate-string="true">首先，我们要考虑到，策略类 Strategy 应该是一个可以被继承的类，同时应该包含一些固定的接口。这样，回测器才能方便地调用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6876"><span data-slate-object="text" data-key="6877"><span data-slate-leaf="true" data-offset-key="6877:0" data-first-offset="true"><span data-slate-string="true">于是，我们可以定义一个 Strategy 抽象类，包含两个接口方法 init 和 next，分别对应我们前面说的指标计算和步进函数。不过注意，抽象类是不能被实例化的。所以，我们必须定义一个具体的子类，同时实现了 init 和 next 方法才可以。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6878"><span data-slate-object="text" data-key="6879"><span data-slate-leaf="true" data-offset-key="6879:0" data-first-offset="true"><span data-slate-string="true">这个类的定义，你可以参考下面代码的实现：</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="6880"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6881"><span data-slate-object="text" data-key="6882"><span data-slate-leaf="true" data-offset-key="6882:0" data-first-offset="true"><span data-slate-string="true">import abc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6883"><span data-slate-object="text" data-key="6884"><span data-slate-leaf="true" data-offset-key="6884:0" data-first-offset="true"><span data-slate-string="true">import numpy </span></span></span><span data-slate-object="text" data-key="6885"><span data-slate-leaf="true" data-offset-key="6885:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="6886"><span data-slate-leaf="true" data-offset-key="6886:0" data-first-offset="true"><span data-slate-string="true"> np</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6887"><span data-slate-object="text" data-key="6888"><span data-slate-leaf="true" data-offset-key="6888:0" data-first-offset="true"><span data-slate-string="true">from typing import Callable</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6889"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6890"><span data-slate-object="text" data-key="6891"><span data-slate-leaf="true" data-offset-key="6891:0" data-first-offset="true"><span data-slate-string="true">class </span></span></span><span data-slate-object="text" data-key="6892"><span data-slate-leaf="true" data-offset-key="6892:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Strategy</span></span></span></span><span data-slate-object="text" data-key="6893"><span data-slate-leaf="true" data-offset-key="6893:0" data-first-offset="true"><span data-slate-string="true">(metaclass=abc.ABCMeta):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6894"><span data-slate-object="text" data-key="6895"><span data-slate-leaf="true" data-offset-key="6895:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6896"><span data-slate-leaf="true" data-offset-key="6896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6897"><span data-slate-leaf="true" data-offset-key="6897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6898"><span data-slate-object="text" data-key="6899"><span data-slate-leaf="true" data-offset-key="6899:0" data-first-offset="true"><span data-slate-string="true">    抽象策略类，用于定义交易策略。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6900"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6901"><span data-slate-object="text" data-key="6902"><span data-slate-leaf="true" data-offset-key="6902:0" data-first-offset="true"><span data-slate-string="true">    如果要定义自己的策略类，需要继承这个基类，并实现两个抽象方法：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6903"><span data-slate-object="text" data-key="6904"><span data-slate-leaf="true" data-offset-key="6904:0" data-first-offset="true"><span data-slate-string="true">    Strategy.init</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6905"><span data-slate-object="text" data-key="6906"><span data-slate-leaf="true" data-offset-key="6906:0" data-first-offset="true"><span data-slate-string="true">    Strategy.next</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6907"><span data-slate-object="text" data-key="6908"><span data-slate-leaf="true" data-offset-key="6908:0" data-first-offset="true"><span data-slate-string="true">    "</span></span></span><span data-slate-object="text" data-key="6909"><span data-slate-leaf="true" data-offset-key="6909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6910"><span data-slate-object="text" data-key="6911"><span data-slate-leaf="true" data-offset-key="6911:0" data-first-offset="true"><span data-slate-string="true">    def __init__(</span></span></span><span data-slate-object="text" data-key="6912"><span data-slate-leaf="true" data-offset-key="6912:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6913"><span data-slate-leaf="true" data-offset-key="6913:0" data-first-offset="true"><span data-slate-string="true">, broker, data):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6914"><span data-slate-object="text" data-key="6915"><span data-slate-leaf="true" data-offset-key="6915:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6916"><span data-slate-leaf="true" data-offset-key="6916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6917"><span data-slate-leaf="true" data-offset-key="6917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6918"><span data-slate-object="text" data-key="6919"><span data-slate-leaf="true" data-offset-key="6919:0" data-first-offset="true"><span data-slate-string="true">        构造策略对象。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6920"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6921"><span data-slate-object="text" data-key="6922"><span data-slate-leaf="true" data-offset-key="6922:0" data-first-offset="true"><span data-slate-string="true">        @params broker:  ExchangeAPI    交易 API 接口，用于模拟交易</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6923"><span data-slate-object="text" data-key="6924"><span data-slate-leaf="true" data-offset-key="6924:0" data-first-offset="true"><span data-slate-string="true">        @params data:    list           行情数据数据</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6925"><span data-slate-object="text" data-key="6926"><span data-slate-leaf="true" data-offset-key="6926:0" data-first-offset="true"><span data-slate-string="true">        "</span></span></span><span data-slate-object="text" data-key="6927"><span data-slate-leaf="true" data-offset-key="6927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6928"><span data-slate-object="text" data-key="6929"><span data-slate-leaf="true" data-offset-key="6929:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6930"><span data-slate-leaf="true" data-offset-key="6930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6931"><span data-slate-leaf="true" data-offset-key="6931:0" data-first-offset="true"><span data-slate-string="true">._indicators = []</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6932"><span data-slate-object="text" data-key="6933"><span data-slate-leaf="true" data-offset-key="6933:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6934"><span data-slate-leaf="true" data-offset-key="6934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6935"><span data-slate-leaf="true" data-offset-key="6935:0" data-first-offset="true"><span data-slate-string="true">._broker = broker  # </span></span></span><span data-slate-object="text" data-key="6936"><span data-slate-leaf="true" data-offset-key="6936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="6937"><span data-slate-leaf="true" data-offset-key="6937:0" data-first-offset="true"><span data-slate-string="true">: _Broker</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6938"><span data-slate-object="text" data-key="6939"><span data-slate-leaf="true" data-offset-key="6939:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6940"><span data-slate-leaf="true" data-offset-key="6940:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6941"><span data-slate-leaf="true" data-offset-key="6941:0" data-first-offset="true"><span data-slate-string="true">._data = data  # </span></span></span><span data-slate-object="text" data-key="6942"><span data-slate-leaf="true" data-offset-key="6942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="6943"><span data-slate-leaf="true" data-offset-key="6943:0" data-first-offset="true"><span data-slate-string="true">: _Data</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6944"><span data-slate-object="text" data-key="6945"><span data-slate-leaf="true" data-offset-key="6945:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6946"><span data-slate-leaf="true" data-offset-key="6946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6947"><span data-slate-leaf="true" data-offset-key="6947:0" data-first-offset="true"><span data-slate-string="true">._tick = </span></span></span><span data-slate-object="text" data-key="6948"><span data-slate-leaf="true" data-offset-key="6948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6949"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6950"><span data-slate-object="text" data-key="6951"><span data-slate-leaf="true" data-offset-key="6951:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="6952"><span data-slate-leaf="true" data-offset-key="6952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">I</span></span></span></span><span data-slate-object="text" data-key="6953"><span data-slate-leaf="true" data-offset-key="6953:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6954"><span data-slate-leaf="true" data-offset-key="6954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6955"><span data-slate-leaf="true" data-offset-key="6955:0" data-first-offset="true"><span data-slate-string="true">, func: Callable, *args) </span></span></span><span data-slate-object="text" data-key="6956"><span data-slate-leaf="true" data-offset-key="6956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="6957"><span data-slate-leaf="true" data-offset-key="6957:0" data-first-offset="true"><span data-slate-string="true"> np.ndarray:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6958"><span data-slate-object="text" data-key="6959"><span data-slate-leaf="true" data-offset-key="6959:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6960"><span data-slate-leaf="true" data-offset-key="6960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6961"><span data-slate-leaf="true" data-offset-key="6961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6962"><span data-slate-object="text" data-key="6963"><span data-slate-leaf="true" data-offset-key="6963:0" data-first-offset="true"><span data-slate-string="true">        计算买卖指标向量。买卖指标向量是一个数组，长度和历史数据对应；</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6964"><span data-slate-object="text" data-key="6965"><span data-slate-leaf="true" data-offset-key="6965:0" data-first-offset="true"><span data-slate-string="true">        用于判定这个时间点上需要进行 " 买</span></span></span><span data-slate-object="text" data-key="6966"><span data-slate-leaf="true" data-offset-key="6966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> "还是"</span></span></span></span><span data-slate-object="text" data-key="6967"><span data-slate-leaf="true" data-offset-key="6967:0" data-first-offset="true"><span data-slate-string="true"> 卖</span></span></span><span data-slate-object="text" data-key="6968"><span data-slate-leaf="true" data-offset-key="6968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> "。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6969"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6970"><span data-slate-object="text" data-key="6971"><span data-slate-leaf="true" data-offset-key="6971:0" data-first-offset="true"><span data-slate-string="true">        例如计算滑动平均：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6972"><span data-slate-object="text" data-key="6973"><span data-slate-leaf="true" data-offset-key="6973:0" data-first-offset="true"><span data-slate-string="true">        def init():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6974"><span data-slate-object="text" data-key="6975"><span data-slate-leaf="true" data-offset-key="6975:0" data-first-offset="true"><span data-slate-string="true">            self.sma = self.I(utils.SMA, self.data.Close, N)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6976"><span data-slate-object="text" data-key="6977"><span data-slate-leaf="true" data-offset-key="6977:0" data-first-offset="true"><span data-slate-string="true">        "</span></span></span><span data-slate-object="text" data-key="6978"><span data-slate-leaf="true" data-offset-key="6978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6979"><span data-slate-object="text" data-key="6980"><span data-slate-leaf="true" data-offset-key="6980:0" data-first-offset="true"><span data-slate-string="true">        value = </span></span></span><span data-slate-object="text" data-key="6981"><span data-slate-leaf="true" data-offset-key="6981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span><span data-slate-object="text" data-key="6982"><span data-slate-leaf="true" data-offset-key="6982:0" data-first-offset="true"><span data-slate-string="true">(*args)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6983"><span data-slate-object="text" data-key="6984"><span data-slate-leaf="true" data-offset-key="6984:0" data-first-offset="true"><span data-slate-string="true">        value = np.</span></span></span><span data-slate-object="text" data-key="6985"><span data-slate-leaf="true" data-offset-key="6985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asarray</span></span></span></span><span data-slate-object="text" data-key="6986"><span data-slate-leaf="true" data-offset-key="6986:0" data-first-offset="true"><span data-slate-string="true">(value)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6987"><span data-slate-object="text" data-key="6988"><span data-slate-leaf="true" data-offset-key="6988:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="6989"><span data-slate-leaf="true" data-offset-key="6989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">assert_msg</span></span></span></span><span data-slate-object="text" data-key="6990"><span data-slate-leaf="true" data-offset-key="6990:0" data-first-offset="true"><span data-slate-string="true">(value.shape[-</span></span></span><span data-slate-object="text" data-key="6991"><span data-slate-leaf="true" data-offset-key="6991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="6992"><span data-slate-leaf="true" data-offset-key="6992:0" data-first-offset="true"><span data-slate-string="true">] == </span></span></span><span data-slate-object="text" data-key="6993"><span data-slate-leaf="true" data-offset-key="6993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="6994"><span data-slate-leaf="true" data-offset-key="6994:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6995"><span data-slate-leaf="true" data-offset-key="6995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="6996"><span data-slate-leaf="true" data-offset-key="6996:0" data-first-offset="true"><span data-slate-string="true">._data.Close), '指示器长度必须和 data 长度相同')</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6997"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6998"><span data-slate-object="text" data-key="6999"><span data-slate-leaf="true" data-offset-key="6999:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7000"><span data-slate-leaf="true" data-offset-key="7000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7001"><span data-slate-leaf="true" data-offset-key="7001:0" data-first-offset="true"><span data-slate-string="true">._indicators.</span></span></span><span data-slate-object="text" data-key="7002"><span data-slate-leaf="true" data-offset-key="7002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="7003"><span data-slate-leaf="true" data-offset-key="7003:0" data-first-offset="true"><span data-slate-string="true">(value)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7004"><span data-slate-object="text" data-key="7005"><span data-slate-leaf="true" data-offset-key="7005:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7006"><span data-slate-leaf="true" data-offset-key="7006:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7007"><span data-slate-leaf="true" data-offset-key="7007:0" data-first-offset="true"><span data-slate-string="true"> value</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7008"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7009"><span data-slate-object="text" data-key="7010"><span data-slate-leaf="true" data-offset-key="7010:0" data-first-offset="true"><span data-slate-string="true">    @property</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7011"><span data-slate-object="text" data-key="7012"><span data-slate-leaf="true" data-offset-key="7012:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7013"><span data-slate-leaf="true" data-offset-key="7013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">tick</span></span></span></span><span data-slate-object="text" data-key="7014"><span data-slate-leaf="true" data-offset-key="7014:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7015"><span data-slate-leaf="true" data-offset-key="7015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7016"><span data-slate-leaf="true" data-offset-key="7016:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7017"><span data-slate-object="text" data-key="7018"><span data-slate-leaf="true" data-offset-key="7018:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7019"><span data-slate-leaf="true" data-offset-key="7019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7020"><span data-slate-leaf="true" data-offset-key="7020:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7021"><span data-slate-leaf="true" data-offset-key="7021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7022"><span data-slate-leaf="true" data-offset-key="7022:0" data-first-offset="true"><span data-slate-string="true">._tick</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7023"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7024"><span data-slate-object="text" data-key="7025"><span data-slate-leaf="true" data-offset-key="7025:0" data-first-offset="true"><span data-slate-string="true">    @abc.abstractmethod</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7026"><span data-slate-object="text" data-key="7027"><span data-slate-leaf="true" data-offset-key="7027:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7028"><span data-slate-leaf="true" data-offset-key="7028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init</span></span></span></span><span data-slate-object="text" data-key="7029"><span data-slate-leaf="true" data-offset-key="7029:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7030"><span data-slate-leaf="true" data-offset-key="7030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7031"><span data-slate-leaf="true" data-offset-key="7031:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7032"><span data-slate-object="text" data-key="7033"><span data-slate-leaf="true" data-offset-key="7033:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7034"><span data-slate-leaf="true" data-offset-key="7034:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="7035"><span data-slate-leaf="true" data-offset-key="7035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7036"><span data-slate-object="text" data-key="7037"><span data-slate-leaf="true" data-offset-key="7037:0" data-first-offset="true"><span data-slate-string="true">        初始化策略。在策略回测 / 执行过程中调用一次，用于初始化策略内部状态。</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7038"><span data-slate-object="text" data-key="7039"><span data-slate-leaf="true" data-offset-key="7039:0" data-first-offset="true"><span data-slate-string="true">        这里也可以预计算策略的辅助参数。比如根据历史行情数据：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7040"><span data-slate-object="text" data-key="7041"><span data-slate-leaf="true" data-offset-key="7041:0" data-first-offset="true"><span data-slate-string="true">        计算买卖的指示器向量；</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7042"><span data-slate-object="text" data-key="7043"><span data-slate-leaf="true" data-offset-key="7043:0" data-first-offset="true"><span data-slate-string="true">        训练模型 / 初始化模型参数</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7044"><span data-slate-object="text" data-key="7045"><span data-slate-leaf="true" data-offset-key="7045:0" data-first-offset="true"><span data-slate-string="true">        "</span></span></span><span data-slate-object="text" data-key="7046"><span data-slate-leaf="true" data-offset-key="7046:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7047"><span data-slate-object="text" data-key="7048"><span data-slate-leaf="true" data-offset-key="7048:0" data-first-offset="true"><span data-slate-string="true">        pass</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7049"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7050"><span data-slate-object="text" data-key="7051"><span data-slate-leaf="true" data-offset-key="7051:0" data-first-offset="true"><span data-slate-string="true">    @abc.abstractmethod</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7052"><span data-slate-object="text" data-key="7053"><span data-slate-leaf="true" data-offset-key="7053:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7054"><span data-slate-leaf="true" data-offset-key="7054:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="7055"><span data-slate-leaf="true" data-offset-key="7055:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7056"><span data-slate-leaf="true" data-offset-key="7056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7057"><span data-slate-leaf="true" data-offset-key="7057:0" data-first-offset="true"><span data-slate-string="true">, tick):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7058"><span data-slate-object="text" data-key="7059"><span data-slate-leaf="true" data-offset-key="7059:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7060"><span data-slate-leaf="true" data-offset-key="7060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="7061"><span data-slate-leaf="true" data-offset-key="7061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7062"><span data-slate-object="text" data-key="7063"><span data-slate-leaf="true" data-offset-key="7063:0" data-first-offset="true"><span data-slate-string="true">        步进函数，执行第 tick 步的策略。tick 代表当前的 " 时间</span></span></span><span data-slate-object="text" data-key="7064"><span data-slate-leaf="true" data-offset-key="7064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> "。比如 data [tick] 用于访问当前的市场价格。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7065"><span data-slate-object="text" data-key="7066"><span data-slate-leaf="true" data-offset-key="7066:0" data-first-offset="true"><span data-slate-string="true">        "</span></span></span><span data-slate-object="text" data-key="7067"><span data-slate-leaf="true" data-offset-key="7067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7068"><span data-slate-object="text" data-key="7069"><span data-slate-leaf="true" data-offset-key="7069:0" data-first-offset="true"><span data-slate-string="true">        pass</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7070"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7071"><span data-slate-object="text" data-key="7072"><span data-slate-leaf="true" data-offset-key="7072:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7073"><span data-slate-leaf="true" data-offset-key="7073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">buy</span></span></span></span><span data-slate-object="text" data-key="7074"><span data-slate-leaf="true" data-offset-key="7074:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7075"><span data-slate-leaf="true" data-offset-key="7075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7076"><span data-slate-leaf="true" data-offset-key="7076:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7077"><span data-slate-object="text" data-key="7078"><span data-slate-leaf="true" data-offset-key="7078:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7079"><span data-slate-leaf="true" data-offset-key="7079:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7080"><span data-slate-leaf="true" data-offset-key="7080:0" data-first-offset="true"><span data-slate-string="true">._broker.</span></span></span><span data-slate-object="text" data-key="7081"><span data-slate-leaf="true" data-offset-key="7081:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">buy</span></span></span></span><span data-slate-object="text" data-key="7082"><span data-slate-leaf="true" data-offset-key="7082:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7083"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7084"><span data-slate-object="text" data-key="7085"><span data-slate-leaf="true" data-offset-key="7085:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7086"><span data-slate-leaf="true" data-offset-key="7086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sell</span></span></span></span><span data-slate-object="text" data-key="7087"><span data-slate-leaf="true" data-offset-key="7087:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7088"><span data-slate-leaf="true" data-offset-key="7088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7089"><span data-slate-leaf="true" data-offset-key="7089:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7090"><span data-slate-object="text" data-key="7091"><span data-slate-leaf="true" data-offset-key="7091:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7092"><span data-slate-leaf="true" data-offset-key="7092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7093"><span data-slate-leaf="true" data-offset-key="7093:0" data-first-offset="true"><span data-slate-string="true">._broker.</span></span></span><span data-slate-object="text" data-key="7094"><span data-slate-leaf="true" data-offset-key="7094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sell</span></span></span></span><span data-slate-object="text" data-key="7095"><span data-slate-leaf="true" data-offset-key="7095:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7096"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7097"><span data-slate-object="text" data-key="7098"><span data-slate-leaf="true" data-offset-key="7098:0" data-first-offset="true"><span data-slate-string="true">    @property</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7099"><span data-slate-object="text" data-key="7100"><span data-slate-leaf="true" data-offset-key="7100:0" data-first-offset="true"><span data-slate-string="true">    def </span></span></span><span data-slate-object="text" data-key="7101"><span data-slate-leaf="true" data-offset-key="7101:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">data</span></span></span></span><span data-slate-object="text" data-key="7102"><span data-slate-leaf="true" data-offset-key="7102:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7103"><span data-slate-leaf="true" data-offset-key="7103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7104"><span data-slate-leaf="true" data-offset-key="7104:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7105"><span data-slate-object="text" data-key="7106"><span data-slate-leaf="true" data-offset-key="7106:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7107"><span data-slate-leaf="true" data-offset-key="7107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7108"><span data-slate-leaf="true" data-offset-key="7108:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7109"><span data-slate-leaf="true" data-offset-key="7109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7110"><span data-slate-leaf="true" data-offset-key="7110:0" data-first-offset="true"><span data-slate-string="true">._data</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7111"><span data-slate-object="text" data-key="7112"><span data-slate-leaf="true" data-offset-key="7112:0" data-first-offset="true"><span data-slate-string="true">为了方便访问成员，我们还定义了一些 Python property。同时，我们的买卖请求是由策略类发出、由交易所 API 来执行的，所以我们的策略类里依赖于 ExchangeAPI 类。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7113"><span data-slate-object="text" data-key="7114"><span data-slate-leaf="true" data-offset-key="7114:0" data-first-offset="true"><span data-slate-string="true">现在，有了这个框架，我们实现移动均线交叉策略就很简单了。你只需要在 init 函数中，定义计算大小窗口 SMA 的逻辑；同时，在 next 函数中完成交叉检测和买卖调用就行了。具体实现，你可以参考下面这段代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7115"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7116"><span data-slate-object="text" data-key="7117"><span data-slate-leaf="true" data-offset-key="7117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="7118"><span data-slate-leaf="true" data-offset-key="7118:0" data-first-offset="true"><span data-slate-string="true"> utils </span></span></span><span data-slate-object="text" data-key="7119"><span data-slate-leaf="true" data-offset-key="7119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7120"><span data-slate-leaf="true" data-offset-key="7120:0" data-first-offset="true"><span data-slate-string="true"> assert_msg, crossover, SMA</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7121"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7122"><span data-slate-object="text" data-key="7123"><span data-slate-leaf="true" data-offset-key="7123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="7124"><span data-slate-leaf="true" data-offset-key="7124:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7125"><span data-slate-leaf="true" data-offset-key="7125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">SmaCross</span></span></span></span><span data-slate-object="text" data-key="7126"><span data-slate-leaf="true" data-offset-key="7126:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7127"><span data-slate-leaf="true" data-offset-key="7127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Strategy</span></span></span></span><span data-slate-object="text" data-key="7128"><span data-slate-leaf="true" data-offset-key="7128:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7129"><span data-slate-object="text" data-key="7130"><span data-slate-leaf="true" data-offset-key="7130:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7131"><span data-slate-leaf="true" data-offset-key="7131:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 小窗口 SMA 的窗口大小，用于计算 SMA 快线</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7132"><span data-slate-object="text" data-key="7133"><span data-slate-leaf="true" data-offset-key="7133:0" data-first-offset="true"><span data-slate-string="true">    fast = </span></span></span><span data-slate-object="text" data-key="7134"><span data-slate-leaf="true" data-offset-key="7134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7135"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7136"><span data-slate-object="text" data-key="7137"><span data-slate-leaf="true" data-offset-key="7137:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7138"><span data-slate-leaf="true" data-offset-key="7138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 大窗口 SMA 的窗口大小，用于计算 SMA 慢线</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7139"><span data-slate-object="text" data-key="7140"><span data-slate-leaf="true" data-offset-key="7140:0" data-first-offset="true"><span data-slate-string="true">    slow = </span></span></span><span data-slate-object="text" data-key="7141"><span data-slate-leaf="true" data-offset-key="7141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">20</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7142"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7143"><span data-slate-object="text" data-key="7144"><span data-slate-leaf="true" data-offset-key="7144:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7145"><span data-slate-leaf="true" data-offset-key="7145:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7146"><span data-slate-leaf="true" data-offset-key="7146:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7147"><span data-slate-leaf="true" data-offset-key="7147:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init</span></span></span></span><span data-slate-object="text" data-key="7148"><span data-slate-leaf="true" data-offset-key="7148:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7149"><span data-slate-leaf="true" data-offset-key="7149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7150"><span data-slate-leaf="true" data-offset-key="7150:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7151"><span data-slate-object="text" data-key="7152"><span data-slate-leaf="true" data-offset-key="7152:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7153"><span data-slate-leaf="true" data-offset-key="7153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 计算历史上每个时刻的快线和慢线</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7154"><span data-slate-object="text" data-key="7155"><span data-slate-leaf="true" data-offset-key="7155:0" data-first-offset="true"><span data-slate-string="true">        self.sma1 = self.I(SMA, self.data.Close, self.fast)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7156"><span data-slate-object="text" data-key="7157"><span data-slate-leaf="true" data-offset-key="7157:0" data-first-offset="true"><span data-slate-string="true">        self.sma2 = self.I(SMA, self.data.Close, self.slow)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7158"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7159"><span data-slate-object="text" data-key="7160"><span data-slate-leaf="true" data-offset-key="7160:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7161"><span data-slate-leaf="true" data-offset-key="7161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7162"><span data-slate-leaf="true" data-offset-key="7162:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7163"><span data-slate-leaf="true" data-offset-key="7163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="7164"><span data-slate-leaf="true" data-offset-key="7164:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7165"><span data-slate-leaf="true" data-offset-key="7165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, tick</span></span></span></span><span data-slate-object="text" data-key="7166"><span data-slate-leaf="true" data-offset-key="7166:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7167"><span data-slate-object="text" data-key="7168"><span data-slate-leaf="true" data-offset-key="7168:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7169"><span data-slate-leaf="true" data-offset-key="7169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果此时快线刚好越过慢线，买入全部</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7170"><span data-slate-object="text" data-key="7171"><span data-slate-leaf="true" data-offset-key="7171:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7172"><span data-slate-leaf="true" data-offset-key="7172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7173"><span data-slate-leaf="true" data-offset-key="7173:0" data-first-offset="true"><span data-slate-string="true"> crossover(self.sma1[:tick], self.sma2[:tick]):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7174"><span data-slate-object="text" data-key="7175"><span data-slate-leaf="true" data-offset-key="7175:0" data-first-offset="true"><span data-slate-string="true">            self.buy()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7176"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7177"><span data-slate-object="text" data-key="7178"><span data-slate-leaf="true" data-offset-key="7178:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7179"><span data-slate-leaf="true" data-offset-key="7179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 如果是慢线刚好越过快线，卖出全部</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7180"><span data-slate-object="text" data-key="7181"><span data-slate-leaf="true" data-offset-key="7181:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7182"><span data-slate-leaf="true" data-offset-key="7182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">elif</span></span></span></span><span data-slate-object="text" data-key="7183"><span data-slate-leaf="true" data-offset-key="7183:0" data-first-offset="true"><span data-slate-string="true"> crossover(self.sma2[:tick], self.sma1[:tick]):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7184"><span data-slate-object="text" data-key="7185"><span data-slate-leaf="true" data-offset-key="7185:0" data-first-offset="true"><span data-slate-string="true">            self.sell()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7186"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7187"><span data-slate-object="text" data-key="7188"><span data-slate-leaf="true" data-offset-key="7188:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7189"><span data-slate-leaf="true" data-offset-key="7189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 否则，这个时刻不执行任何操作。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7190"><span data-slate-object="text" data-key="7191"><span data-slate-leaf="true" data-offset-key="7191:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7192"><span data-slate-leaf="true" data-offset-key="7192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="7193"><span data-slate-leaf="true" data-offset-key="7193:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7194"><span data-slate-object="text" data-key="7195"><span data-slate-leaf="true" data-offset-key="7195:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="7196"><span data-slate-leaf="true" data-offset-key="7196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">pass</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7197" id="sr-toc-4"><span data-slate-object="text" data-key="7198"><span data-slate-leaf="true" data-offset-key="7198:0" data-first-offset="true"><span data-slate-string="true">模拟交易</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7199"><span data-slate-object="text" data-key="7200"><span data-slate-leaf="true" data-offset-key="7200:0" data-first-offset="true"><span data-slate-string="true">到这里，我们的回测就只差最后一块儿了。胜利就在眼前，我们继续加油。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7201"><span data-slate-object="text" data-key="7202"><span data-slate-leaf="true" data-offset-key="7202:0" data-first-offset="true"><span data-slate-string="true">我们前面提到过，交易所类负责模拟交易，而模拟的基础，就是需要当前市场的价格。这里，我们可以用 OHLC 中的 Close，作为那个时刻的价格。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7203"><span data-slate-object="text" data-key="7204"><span data-slate-leaf="true" data-offset-key="7204:0" data-first-offset="true"><span data-slate-string="true">此外，为了简化设计，我们假设买卖操作都利用的是当前账户的所有资金、仓位，且市场容量足够大。这样，我们的下单请求就能够马上完全执行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7205"><span data-slate-object="text" data-key="7206"><span data-slate-leaf="true" data-offset-key="7206:0" data-first-offset="true"><span data-slate-string="true">也别忘了手续费这个大头。考虑到有手续费的情况，此时，我们最核心的买卖函数应该怎么来写呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7207"><span data-slate-object="text" data-key="7208"><span data-slate-leaf="true" data-offset-key="7208:0" data-first-offset="true"><span data-slate-string="true">我们一起来想这个问题。假设，我们现在有 1000.0 元，此时 BTC 的价格是 100.00 元（当然没有这么好的事情啊，这里只是假设），并且交易手续费为 1%。那么，我们能买到多少 BTC 呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7209"><span data-slate-object="text" data-key="7210"><span data-slate-leaf="true" data-offset-key="7210:0" data-first-offset="true"><span data-slate-string="true">我们可以采用这种算法：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="7211"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7212"><span data-slate-object="text" data-key="7213"><span data-slate-leaf="true" data-offset-key="7213:0" data-first-offset="true"><span data-slate-string="true">买到的数量 = 投入的资金 * (1.0 - 手续费) / 价格</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7214"><span data-slate-object="text" data-key="7215"><span data-slate-leaf="true" data-offset-key="7215:0" data-first-offset="true"><span data-slate-string="true">那么此时，你就能收到 9.9 个 BTC。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7216"><span data-slate-object="text" data-key="7217"><span data-slate-leaf="true" data-offset-key="7217:0" data-first-offset="true"><span data-slate-string="true">类似的，卖出的时候结算方式如下，也不难理解：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="7218"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7219"><span data-slate-object="text" data-key="7220"><span data-slate-leaf="true" data-offset-key="7220:0" data-first-offset="true"><span data-slate-string="true">卖出的收益 = 持有的数量 * 价格 *  (1.0 - 手续费)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7221"><span data-slate-object="text" data-key="7222"><span data-slate-leaf="true" data-offset-key="7222:0" data-first-offset="true"><span data-slate-string="true">所以，最终模拟交易所类的实现，你可以参考下面这段代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7223"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7224"><span data-slate-object="text" data-key="7225"><span data-slate-leaf="true" data-offset-key="7225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="7226"><span data-slate-leaf="true" data-offset-key="7226:0" data-first-offset="true"><span data-slate-string="true"> utils </span></span></span><span data-slate-object="text" data-key="7227"><span data-slate-leaf="true" data-offset-key="7227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7228"><span data-slate-leaf="true" data-offset-key="7228:0" data-first-offset="true"><span data-slate-string="true"> read_file, assert_msg, crossover, SMA</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7229"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7230"><span data-slate-object="text" data-key="7231"><span data-slate-leaf="true" data-offset-key="7231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="7232"><span data-slate-leaf="true" data-offset-key="7232:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7233"><span data-slate-leaf="true" data-offset-key="7233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ExchangeAPI</span></span></span></span><span data-slate-object="text" data-key="7234"><span data-slate-leaf="true" data-offset-key="7234:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7235"><span data-slate-object="text" data-key="7236"><span data-slate-leaf="true" data-offset-key="7236:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7237"><span data-slate-leaf="true" data-offset-key="7237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7238"><span data-slate-leaf="true" data-offset-key="7238:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7239"><span data-slate-leaf="true" data-offset-key="7239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="7240"><span data-slate-leaf="true" data-offset-key="7240:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7241"><span data-slate-leaf="true" data-offset-key="7241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, data, cash, commission</span></span></span></span><span data-slate-object="text" data-key="7242"><span data-slate-leaf="true" data-offset-key="7242:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7243"><span data-slate-object="text" data-key="7244"><span data-slate-leaf="true" data-offset-key="7244:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="7245"><span data-slate-leaf="true" data-offset-key="7245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7246"><span data-slate-leaf="true" data-offset-key="7246:0" data-first-offset="true"><span data-slate-string="true"> &lt; cash, </span></span></span><span data-slate-object="text" data-key="7247"><span data-slate-leaf="true" data-offset-key="7247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"初始现金数量大于 0，输入的现金数量：{}"</span></span></span></span><span data-slate-object="text" data-key="7248"><span data-slate-leaf="true" data-offset-key="7248:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="7249"><span data-slate-leaf="true" data-offset-key="7249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="7250"><span data-slate-leaf="true" data-offset-key="7250:0" data-first-offset="true"><span data-slate-string="true">(cash))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7251"><span data-slate-object="text" data-key="7252"><span data-slate-leaf="true" data-offset-key="7252:0" data-first-offset="true"><span data-slate-string="true">        assert_msg(</span></span></span><span data-slate-object="text" data-key="7253"><span data-slate-leaf="true" data-offset-key="7253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7254"><span data-slate-leaf="true" data-offset-key="7254:0" data-first-offset="true"><span data-slate-string="true"> &lt;= commission &lt;= </span></span></span><span data-slate-object="text" data-key="7255"><span data-slate-leaf="true" data-offset-key="7255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.05</span></span></span></span><span data-slate-object="text" data-key="7256"><span data-slate-leaf="true" data-offset-key="7256:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7257"><span data-slate-leaf="true" data-offset-key="7257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"合理的手续费率一般不会超过 5%，输入的费率：{}"</span></span></span></span><span data-slate-object="text" data-key="7258"><span data-slate-leaf="true" data-offset-key="7258:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="7259"><span data-slate-leaf="true" data-offset-key="7259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="7260"><span data-slate-leaf="true" data-offset-key="7260:0" data-first-offset="true"><span data-slate-string="true">(commission))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7261"><span data-slate-object="text" data-key="7262"><span data-slate-leaf="true" data-offset-key="7262:0" data-first-offset="true"><span data-slate-string="true">        self._inital_cash = cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7263"><span data-slate-object="text" data-key="7264"><span data-slate-leaf="true" data-offset-key="7264:0" data-first-offset="true"><span data-slate-string="true">        self._data = data</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7265"><span data-slate-object="text" data-key="7266"><span data-slate-leaf="true" data-offset-key="7266:0" data-first-offset="true"><span data-slate-string="true">        self._commission = commission</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7267"><span data-slate-object="text" data-key="7268"><span data-slate-leaf="true" data-offset-key="7268:0" data-first-offset="true"><span data-slate-string="true">        self._position = </span></span></span><span data-slate-object="text" data-key="7269"><span data-slate-leaf="true" data-offset-key="7269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7270"><span data-slate-object="text" data-key="7271"><span data-slate-leaf="true" data-offset-key="7271:0" data-first-offset="true"><span data-slate-string="true">        self._cash = cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7272"><span data-slate-object="text" data-key="7273"><span data-slate-leaf="true" data-offset-key="7273:0" data-first-offset="true"><span data-slate-string="true">        self._i = </span></span></span><span data-slate-object="text" data-key="7274"><span data-slate-leaf="true" data-offset-key="7274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7275"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7276"><span data-slate-object="text" data-key="7277"><span data-slate-leaf="true" data-offset-key="7277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">    @property</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7278"><span data-slate-object="text" data-key="7279"><span data-slate-leaf="true" data-offset-key="7279:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7280"><span data-slate-leaf="true" data-offset-key="7280:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7281"><span data-slate-leaf="true" data-offset-key="7281:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7282"><span data-slate-leaf="true" data-offset-key="7282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cash</span></span></span></span><span data-slate-object="text" data-key="7283"><span data-slate-leaf="true" data-offset-key="7283:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7284"><span data-slate-leaf="true" data-offset-key="7284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7285"><span data-slate-leaf="true" data-offset-key="7285:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7286"><span data-slate-object="text" data-key="7287"><span data-slate-leaf="true" data-offset-key="7287:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7288"><span data-slate-leaf="true" data-offset-key="7288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7289"><span data-slate-object="text" data-key="7290"><span data-slate-leaf="true" data-offset-key="7290:0" data-first-offset="true"><span data-slate-string="true">        :return: 返回当前账户现金数量</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7291"><span data-slate-object="text" data-key="7292"><span data-slate-leaf="true" data-offset-key="7292:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7293"><span data-slate-object="text" data-key="7294"><span data-slate-leaf="true" data-offset-key="7294:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7295"><span data-slate-leaf="true" data-offset-key="7295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7296"><span data-slate-leaf="true" data-offset-key="7296:0" data-first-offset="true"><span data-slate-string="true"> self._cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7297"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7298"><span data-slate-object="text" data-key="7299"><span data-slate-leaf="true" data-offset-key="7299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">    @property</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7300"><span data-slate-object="text" data-key="7301"><span data-slate-leaf="true" data-offset-key="7301:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7302"><span data-slate-leaf="true" data-offset-key="7302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7303"><span data-slate-leaf="true" data-offset-key="7303:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7304"><span data-slate-leaf="true" data-offset-key="7304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">position</span></span></span></span><span data-slate-object="text" data-key="7305"><span data-slate-leaf="true" data-offset-key="7305:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7306"><span data-slate-leaf="true" data-offset-key="7306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7307"><span data-slate-leaf="true" data-offset-key="7307:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7308"><span data-slate-object="text" data-key="7309"><span data-slate-leaf="true" data-offset-key="7309:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7310"><span data-slate-leaf="true" data-offset-key="7310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7311"><span data-slate-object="text" data-key="7312"><span data-slate-leaf="true" data-offset-key="7312:0" data-first-offset="true"><span data-slate-string="true">        :return: 返回当前账户仓位</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7313"><span data-slate-object="text" data-key="7314"><span data-slate-leaf="true" data-offset-key="7314:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7315"><span data-slate-object="text" data-key="7316"><span data-slate-leaf="true" data-offset-key="7316:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7317"><span data-slate-leaf="true" data-offset-key="7317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7318"><span data-slate-leaf="true" data-offset-key="7318:0" data-first-offset="true"><span data-slate-string="true"> self._position</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7319"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7320"><span data-slate-object="text" data-key="7321"><span data-slate-leaf="true" data-offset-key="7321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">    @property</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7322"><span data-slate-object="text" data-key="7323"><span data-slate-leaf="true" data-offset-key="7323:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7324"><span data-slate-leaf="true" data-offset-key="7324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7325"><span data-slate-leaf="true" data-offset-key="7325:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7326"><span data-slate-leaf="true" data-offset-key="7326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">initial_cash</span></span></span></span><span data-slate-object="text" data-key="7327"><span data-slate-leaf="true" data-offset-key="7327:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7328"><span data-slate-leaf="true" data-offset-key="7328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7329"><span data-slate-leaf="true" data-offset-key="7329:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7330"><span data-slate-object="text" data-key="7331"><span data-slate-leaf="true" data-offset-key="7331:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7332"><span data-slate-leaf="true" data-offset-key="7332:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7333"><span data-slate-object="text" data-key="7334"><span data-slate-leaf="true" data-offset-key="7334:0" data-first-offset="true"><span data-slate-string="true">        :return: 返回初始现金数量</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7335"><span data-slate-object="text" data-key="7336"><span data-slate-leaf="true" data-offset-key="7336:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7337"><span data-slate-object="text" data-key="7338"><span data-slate-leaf="true" data-offset-key="7338:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7339"><span data-slate-leaf="true" data-offset-key="7339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7340"><span data-slate-leaf="true" data-offset-key="7340:0" data-first-offset="true"><span data-slate-string="true"> self._inital_cash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7341"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7342"><span data-slate-object="text" data-key="7343"><span data-slate-leaf="true" data-offset-key="7343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">    @property</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7344"><span data-slate-object="text" data-key="7345"><span data-slate-leaf="true" data-offset-key="7345:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7346"><span data-slate-leaf="true" data-offset-key="7346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7347"><span data-slate-leaf="true" data-offset-key="7347:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7348"><span data-slate-leaf="true" data-offset-key="7348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">market_value</span></span></span></span><span data-slate-object="text" data-key="7349"><span data-slate-leaf="true" data-offset-key="7349:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7350"><span data-slate-leaf="true" data-offset-key="7350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7351"><span data-slate-leaf="true" data-offset-key="7351:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7352"><span data-slate-object="text" data-key="7353"><span data-slate-leaf="true" data-offset-key="7353:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7354"><span data-slate-leaf="true" data-offset-key="7354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7355"><span data-slate-object="text" data-key="7356"><span data-slate-leaf="true" data-offset-key="7356:0" data-first-offset="true"><span data-slate-string="true">        :return: 返回当前市值</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7357"><span data-slate-object="text" data-key="7358"><span data-slate-leaf="true" data-offset-key="7358:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7359"><span data-slate-object="text" data-key="7360"><span data-slate-leaf="true" data-offset-key="7360:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7361"><span data-slate-leaf="true" data-offset-key="7361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7362"><span data-slate-leaf="true" data-offset-key="7362:0" data-first-offset="true"><span data-slate-string="true"> self._cash + self._position * self.current_price</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7363"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7364"><span data-slate-object="text" data-key="7365"><span data-slate-leaf="true" data-offset-key="7365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">    @property</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7366"><span data-slate-object="text" data-key="7367"><span data-slate-leaf="true" data-offset-key="7367:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7368"><span data-slate-leaf="true" data-offset-key="7368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7369"><span data-slate-leaf="true" data-offset-key="7369:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7370"><span data-slate-leaf="true" data-offset-key="7370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">current_price</span></span></span></span><span data-slate-object="text" data-key="7371"><span data-slate-leaf="true" data-offset-key="7371:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7372"><span data-slate-leaf="true" data-offset-key="7372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7373"><span data-slate-leaf="true" data-offset-key="7373:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7374"><span data-slate-object="text" data-key="7375"><span data-slate-leaf="true" data-offset-key="7375:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7376"><span data-slate-leaf="true" data-offset-key="7376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7377"><span data-slate-object="text" data-key="7378"><span data-slate-leaf="true" data-offset-key="7378:0" data-first-offset="true"><span data-slate-string="true">        :return: 返回当前市场价格</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7379"><span data-slate-object="text" data-key="7380"><span data-slate-leaf="true" data-offset-key="7380:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7381"><span data-slate-object="text" data-key="7382"><span data-slate-leaf="true" data-offset-key="7382:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7383"><span data-slate-leaf="true" data-offset-key="7383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7384"><span data-slate-leaf="true" data-offset-key="7384:0" data-first-offset="true"><span data-slate-string="true"> self._data.Close[self._i]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7385"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7386"><span data-slate-object="text" data-key="7387"><span data-slate-leaf="true" data-offset-key="7387:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7388"><span data-slate-leaf="true" data-offset-key="7388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7389"><span data-slate-leaf="true" data-offset-key="7389:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7390"><span data-slate-leaf="true" data-offset-key="7390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">buy</span></span></span></span><span data-slate-object="text" data-key="7391"><span data-slate-leaf="true" data-offset-key="7391:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7392"><span data-slate-leaf="true" data-offset-key="7392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7393"><span data-slate-leaf="true" data-offset-key="7393:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7394"><span data-slate-object="text" data-key="7395"><span data-slate-leaf="true" data-offset-key="7395:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7396"><span data-slate-leaf="true" data-offset-key="7396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7397"><span data-slate-object="text" data-key="7398"><span data-slate-leaf="true" data-offset-key="7398:0" data-first-offset="true"><span data-slate-string="true">        用当前账户剩余资金，按照市场价格全部买入</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7399"><span data-slate-object="text" data-key="7400"><span data-slate-leaf="true" data-offset-key="7400:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7401"><span data-slate-object="text" data-key="7402"><span data-slate-leaf="true" data-offset-key="7402:0" data-first-offset="true"><span data-slate-string="true">        self._position = </span></span></span><span data-slate-object="text" data-key="7403"><span data-slate-leaf="true" data-offset-key="7403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float</span></span></span></span><span data-slate-object="text" data-key="7404"><span data-slate-leaf="true" data-offset-key="7404:0" data-first-offset="true"><span data-slate-string="true">(self._cash / (self.current_price * (</span></span></span><span data-slate-object="text" data-key="7405"><span data-slate-leaf="true" data-offset-key="7405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7406"><span data-slate-leaf="true" data-offset-key="7406:0" data-first-offset="true"><span data-slate-string="true"> + self._commission)))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7407"><span data-slate-object="text" data-key="7408"><span data-slate-leaf="true" data-offset-key="7408:0" data-first-offset="true"><span data-slate-string="true">        self._cash = </span></span></span><span data-slate-object="text" data-key="7409"><span data-slate-leaf="true" data-offset-key="7409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7410"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7411"><span data-slate-object="text" data-key="7412"><span data-slate-leaf="true" data-offset-key="7412:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7413"><span data-slate-leaf="true" data-offset-key="7413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7414"><span data-slate-leaf="true" data-offset-key="7414:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7415"><span data-slate-leaf="true" data-offset-key="7415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sell</span></span></span></span><span data-slate-object="text" data-key="7416"><span data-slate-leaf="true" data-offset-key="7416:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7417"><span data-slate-leaf="true" data-offset-key="7417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7418"><span data-slate-leaf="true" data-offset-key="7418:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7419"><span data-slate-object="text" data-key="7420"><span data-slate-leaf="true" data-offset-key="7420:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="7421"><span data-slate-leaf="true" data-offset-key="7421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7422"><span data-slate-object="text" data-key="7423"><span data-slate-leaf="true" data-offset-key="7423:0" data-first-offset="true"><span data-slate-string="true">        卖出当前账户剩余持仓</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7424"><span data-slate-object="text" data-key="7425"><span data-slate-leaf="true" data-offset-key="7425:0" data-first-offset="true"><span data-slate-string="true">        """</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7426"><span data-slate-object="text" data-key="7427"><span data-slate-leaf="true" data-offset-key="7427:0" data-first-offset="true"><span data-slate-string="true">        self._cash += </span></span></span><span data-slate-object="text" data-key="7428"><span data-slate-leaf="true" data-offset-key="7428:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float</span></span></span></span><span data-slate-object="text" data-key="7429"><span data-slate-leaf="true" data-offset-key="7429:0" data-first-offset="true"><span data-slate-string="true">(self._position * self.current_price * (</span></span></span><span data-slate-object="text" data-key="7430"><span data-slate-leaf="true" data-offset-key="7430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7431"><span data-slate-leaf="true" data-offset-key="7431:0" data-first-offset="true"><span data-slate-string="true"> - self._commission))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7432"><span data-slate-object="text" data-key="7433"><span data-slate-leaf="true" data-offset-key="7433:0" data-first-offset="true"><span data-slate-string="true">        self._position = </span></span></span><span data-slate-object="text" data-key="7434"><span data-slate-leaf="true" data-offset-key="7434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7435"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7436"><span data-slate-object="text" data-key="7437"><span data-slate-leaf="true" data-offset-key="7437:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7438"><span data-slate-leaf="true" data-offset-key="7438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7439"><span data-slate-leaf="true" data-offset-key="7439:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7440"><span data-slate-leaf="true" data-offset-key="7440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="7441"><span data-slate-leaf="true" data-offset-key="7441:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7442"><span data-slate-leaf="true" data-offset-key="7442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, tick</span></span></span></span><span data-slate-object="text" data-key="7443"><span data-slate-leaf="true" data-offset-key="7443:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7444"><span data-slate-object="text" data-key="7445"><span data-slate-leaf="true" data-offset-key="7445:0" data-first-offset="true"><span data-slate-string="true">        self._i = tick</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7446"><span data-slate-object="text" data-key="7447"><span data-slate-leaf="true" data-offset-key="7447:0" data-first-offset="true"><span data-slate-string="true">其中的 current_price（当前价格），可以方便地获得模拟交易所当前时刻的商品价格；而 market_value，则可以获得当前总市值。在初始化函数的时候，我们检查手续费率和输入的现金数量，是不是在一个合理的范围。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7448"><span data-slate-object="text" data-key="7449"><span data-slate-leaf="true" data-offset-key="7449:0" data-first-offset="true"><span data-slate-string="true">有了所有的这些部分，我们就可以来模拟回测啦！</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7450"><span data-slate-object="text" data-key="7451"><span data-slate-leaf="true" data-offset-key="7451:0" data-first-offset="true"><span data-slate-string="true">首先，我们设置初始资金量为 10000.00 美元，交易所手续费率为 0。这里你可以猜一下，如果我们从 2015 年到现在，都按照 SMA 来买卖，现在应该有多少钱呢？</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="7452"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7453"><span data-slate-object="text" data-key="7454"><span data-slate-leaf="true" data-offset-key="7454:0" data-first-offset="true"><span data-slate-string="true">def </span></span></span><span data-slate-object="text" data-key="7455"><span data-slate-leaf="true" data-offset-key="7455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="7456"><span data-slate-leaf="true" data-offset-key="7456:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7457"><span data-slate-object="text" data-key="7458"><span data-slate-leaf="true" data-offset-key="7458:0" data-first-offset="true"><span data-slate-string="true">    BTCUSD = </span></span></span><span data-slate-object="text" data-key="7459"><span data-slate-leaf="true" data-offset-key="7459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">read_file</span></span></span></span><span data-slate-object="text" data-key="7460"><span data-slate-leaf="true" data-offset-key="7460:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7461"><span data-slate-leaf="true" data-offset-key="7461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'BTCUSD_GEMINI.csv'</span></span></span></span><span data-slate-object="text" data-key="7462"><span data-slate-leaf="true" data-offset-key="7462:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7463"><span data-slate-object="text" data-key="7464"><span data-slate-leaf="true" data-offset-key="7464:0" data-first-offset="true"><span data-slate-string="true">    ret = </span></span></span><span data-slate-object="text" data-key="7465"><span data-slate-leaf="true" data-offset-key="7465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Backtest</span></span></span></span><span data-slate-object="text" data-key="7466"><span data-slate-leaf="true" data-offset-key="7466:0" data-first-offset="true"><span data-slate-string="true">(BTCUSD, SmaCross, ExchangeAPI, </span></span></span><span data-slate-object="text" data-key="7467"><span data-slate-leaf="true" data-offset-key="7467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10000.0</span></span></span></span><span data-slate-object="text" data-key="7468"><span data-slate-leaf="true" data-offset-key="7468:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7469"><span data-slate-leaf="true" data-offset-key="7469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.00</span></span></span></span><span data-slate-object="text" data-key="7470"><span data-slate-leaf="true" data-offset-key="7470:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="7471"><span data-slate-leaf="true" data-offset-key="7471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">run</span></span></span></span><span data-slate-object="text" data-key="7472"><span data-slate-leaf="true" data-offset-key="7472:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7473"><span data-slate-object="text" data-key="7474"><span data-slate-leaf="true" data-offset-key="7474:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7475"><span data-slate-leaf="true" data-offset-key="7475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="7476"><span data-slate-leaf="true" data-offset-key="7476:0" data-first-offset="true"><span data-slate-string="true">(ret)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7477"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7478"><span data-slate-object="text" data-key="7479"><span data-slate-leaf="true" data-offset-key="7479:0" data-first-offset="true"><span data-slate-string="true">if __name__ == </span></span></span><span data-slate-object="text" data-key="7480"><span data-slate-leaf="true" data-offset-key="7480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'__main__'</span></span></span></span><span data-slate-object="text" data-key="7481"><span data-slate-leaf="true" data-offset-key="7481:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7482"><span data-slate-object="text" data-key="7483"><span data-slate-leaf="true" data-offset-key="7483:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7484"><span data-slate-leaf="true" data-offset-key="7484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="7485"><span data-slate-leaf="true" data-offset-key="7485:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7486"><span data-slate-object="text" data-key="7487"><span data-slate-leaf="true" data-offset-key="7487:0" data-first-offset="true"><span data-slate-string="true">铛铛铛，答案揭晓，程序将输出：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="7488"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7489"><span data-slate-object="text" data-key="7490"><span data-slate-leaf="true" data-offset-key="7490:0" data-first-offset="true"><span data-slate-string="true">初始市值     10000.000000</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7491"><span data-slate-object="text" data-key="7492"><span data-slate-leaf="true" data-offset-key="7492:0" data-first-offset="true"><span data-slate-string="true">结束市值     576361.772884</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7493"><span data-slate-object="text" data-key="7494"><span data-slate-leaf="true" data-offset-key="7494:0" data-first-offset="true"><span data-slate-string="true">收益         566361.772884</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7495"><span data-slate-object="text" data-key="7496"><span data-slate-leaf="true" data-offset-key="7496:0" data-first-offset="true"><span data-slate-string="true">哇，结束时，我们将有 57 万美元，翻了整整 57 倍啊！简直不要太爽。不过，等等，这个手续费率为 0，实在是有点碍眼，因为根本不可能啊。我们现在来设一个比较真实的值吧，大概千分之三，然后再来试试：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="7497"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7498"><span data-slate-object="text" data-key="7499"><span data-slate-leaf="true" data-offset-key="7499:0" data-first-offset="true"><span data-slate-string="true">初始市值    10000.000000</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7500"><span data-slate-object="text" data-key="7501"><span data-slate-leaf="true" data-offset-key="7501:0" data-first-offset="true"><span data-slate-string="true">结束市值     2036.562001</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7502"><span data-slate-object="text" data-key="7503"><span data-slate-leaf="true" data-offset-key="7503:0" data-first-offset="true"><span data-slate-string="true">收益      -7963.437999</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7504"><span data-slate-object="text" data-key="7505"><span data-slate-leaf="true" data-offset-key="7505:0" data-first-offset="true"><span data-slate-string="true">什么鬼？我们变成赔钱了，只剩下 2000 美元了！这是真的吗？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7506"><span data-slate-object="text" data-key="7507"><span data-slate-leaf="true" data-offset-key="7507:0" data-first-offset="true"><span data-slate-string="true">这是真的，也是假的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7508"><span data-slate-object="text" data-key="7509"><span data-slate-leaf="true" data-offset-key="7509:0" data-first-offset="true"><span data-slate-string="true">我说的 “真” 是指，如果你真的用 SMA 交叉这种简单的方法去交易，那么手续费摩擦和滑点等因素，确实可能让你的高频策略赔钱。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7510"><span data-slate-object="text" data-key="7511"><span data-slate-leaf="true" data-offset-key="7511:0" data-first-offset="true"><span data-slate-string="true">而我说是 “假” 是指，这种模拟交易的方式非常粗糙。真实的市场情况，并非这么理想 —— 比如买卖请求永远马上执行；再比如，我们在市场中进行交易的同时不会影响市场价格等，这些理想情况都是不可能的。所以，很多时候，回测永远赚钱，但实盘马上赔钱。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7512" id="sr-toc-5"><span data-slate-object="text" data-key="7513"><span data-slate-leaf="true" data-offset-key="7513:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7514"><span data-slate-object="text" data-key="7515"><span data-slate-leaf="true" data-offset-key="7515:0" data-first-offset="true"><span data-slate-string="true">这节课，我们继承上一节，介绍了回测框架的分类、数据的格式，并且带你从头开始写了一个简单的回测系统。你可以把今天的代码片段 “拼” 起来，这样就会得到一个简化的回测系统样例。同时，我们实现了一个简单的交易策略，并且在真实的历史数据上运行了回测结果。我们观察到，在加入手续费后，策略的收益情况发生了显著的变化。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7516" id="sr-toc-6"><span data-slate-object="text" data-key="7517"><span data-slate-leaf="true" data-offset-key="7517:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7518"><span data-slate-object="text" data-key="7519"><span data-slate-leaf="true" data-offset-key="7519:0" data-first-offset="true"><span data-slate-string="true">最后，给你留一个思考题。之前我们介绍了如何抓取 tick 数据，你可以根据抓取的 tick 数据，生成 5 分钟、每小时和每天的 OHLCV 数据吗？欢迎在留言区写下你的答案和问题，也欢迎你把这篇文章分享出去。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>12</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-7">精选留言 (19)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132"></div></div><div><div><div><span>Jingxiao</span></div><span>置顶</span></div><div>整理后的代码在这里：https://github.com/Eyelidstl/GeekTimePythonClass</div><div><div>2019-08-01</div><div><div><i></i><span></span></div><div><i></i><span>41</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/3d/e7/e4b4afcc.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 方向</span></div></div><div>有没有整理后的源代码，想统一查看</div><div><div>2019-07-31</div><div><div><i></i><span></span></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/jsMMDDzhbsTzhicsGZiaeV0PWSnAS0fBlb1r6CsuB32vr3hRwV9UubmfHQx45v7jtaXajPlQ8kQ17b3zpQzHmqVw/132"></div></div><div><div><div><span>fy</span></div></div><div>老师，可以用 git 管理每次分析的代码么？</div><div><div>2019-07-31</div><div><div><i></i><span></span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/18/b6/f3f68a39.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 马建华</span></div></div><div>    def buy (self):
        """
        用当前账户剩余资金，按照市场价格全部买入
        :return:
        """
        self._position = float (self._cash/ (self.current_price * (1 + self._commission)))
        self._cash = 0.0

老师，这里应该是：self._position = float (self._cash * (1-self._commission) / (self.current_price)) 吧？</div><div><div>2020-08-11</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/18/b6/f3f68a39.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 马建华</span></div></div><div>assert_msg (isinstance (commission, Number), 'commission 不是浮点数值类型') 为何不是用 float 而是 number</div><div><div>2020-08-10</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Geek_kuntena</span></div></div><div>pandas 的 resample 函数方便的进行合成大周期的 k 线数据</div><div><div>2020-03-17</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z"></div></div><div><div><div><span> 宋强</span></div></div><div>按照代码逻辑实现了一遍，发现即便是交易经手费是 0，最后的收益也很大取决于数据本身。策略并不一定能盈利</div><div><div>2020-02-11</div><div><div><i></i><span>1</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 自由民</span></div></div><div>这章比较难了，照着课程敲代码，调了半天可以运行了，结果却不对。把老师的代码下载回来仔细研究，终于清楚一些了。</div><div><p>作者回复：加油</p></div><div><div>2019-11-01</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小侠龙旋风</span></div></div><div>SMA 函数只做了一件事：pd.Series (values).rolling (n).mean ()
将传入的 values 转成一位数组以 n 个数据为单位滚动切分取平均值，返回一个均值数组
SMA 的调用位置：
SmaCross 在继承 Strategy 后必须要重写的抽象方法 init 中：
self.sma1 = self.I (SMA, self.data.Close, self.fast)  # 用收盘价计算的 10 日均线
self.sma2 = self.I (SMA, self.data.Close, self.slow)  # 用收盘价计算的 20 日均线

提议：数据可视化更能直观表达实现策略的方案。</div><div><div>2019-09-01</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小侠龙旋风</span></div></div><div>30 日均线、10 日均线、5 日均线、小时、分钟...
大窗口 SMA -&gt; 小窗口 SMA
策略：小窗口 SMA 从下穿过大窗口 SMA，买入。大窗口 SMA 从下方突破小窗口 SMA，卖出。
这要先看看股市的简单策略分析才能明白。刚开始看，完全不懂。。。</div><div><div>2019-09-01</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/97/fb/7cfc315e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 长青</span></div></div><div>老师 iself._indicators.append (value) 这一步有有什么意义呢   没大看明白。还有
buy 和 sell 是不是应该在下一根 K 线执行才对？比如我指标计算时用的 15 分钟 K 线   在 10:15 分出现买卖信号后，应该在 10:30 执行操作 ，因为指标时根据收盘价计算的

</div><div><div>2019-08-12</div><div><div><i></i><span>1</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 杨宇</span></div></div><div>def __init__(self, data: pd.DataFrame, ...)
def crossover (series1, series2) -&gt; bool: ...
—— 方法参数、返回值，怎么带类型了，之前的课没教过这种写法吧？</div><div><div>2021-12-05</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>rock feng</span></div></div><div>这堂课，看得我迷糊，第一次接触量化交易，太多知识点....</div><div><div>2021-09-08</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/23/e5/f1/880994da.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>忧伤的胡萝卜</span></div></div><div>assert_msg (not data [['Open', 'High', 'Low', 'Close']].max ().isnull ().any (), ('部分 OHLC 包含缺失值，请去掉那些行或者通过差值填充.')) 请问这里为什么要用. max ().isnull ().any () 来进行判空？</div><div><div>2021-05-11</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/42/78/212d3762.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>啟俊</span></div></div><div>老师可以讲一下 pandas 中 apply 的应用，有什么方法可以替代，优化提升运行效率</div><div><div>2019-08-07</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>瞳梦</span></div></div><div>assert_msg (not data [['Open', 'High', 'Low', 'Close']].max (skipna=False).isnull ().any () 这一行 max () 方法应该要加一个参数: skipna=False</div><div><div>2019-08-02</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/42/d7/1f1634af.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>无才不肖生</span></div></div><div>而想要检查某个时刻两个 SMA 是否交叉，你只需要查看两个数...
这个我理解的有问题吗，只拿最后两人数作比较不能确定吧，窗口设置 10 个数时，可能在 1 到 8 个数时相等，不是判断不准确？</div><div><div>2019-08-02</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>TKbook</span></div></div><div>    def buy (self):
        """用当前账户剩余资金，按照市场价格全部买入"""
        self._position = float (self._cash/ (self.current_price * (1 + self._commission)))
        self._cash = 0.0

老师，你这里手续费的计算方式有问题吧？ 手续费是针对每次交易来算，不是针对每个比特币来算的吧</div><div><div>2019-07-31</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>许童童</span></div></div><div>看了老师的文章，对金融又感兴趣了。</div><div><div>2019-07-31</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".s"><outline class="toc-level-h1" data-reactid=".s.0" style="width: 175px;"><active data-reactid=".s.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".s.0.1"><span data-reactid=".s.0.1.0">36 | Pandas &amp; Numpy：策略与回测系统</span></a></outline><outline class="toc-level-h2" data-reactid=".s.1" style="width: 165px;"><active data-reactid=".s.1.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".s.1.1"><span data-reactid=".s.1.1.0">OHLCV 数据</span></a></outline><outline class="toc-level-h2" data-reactid=".s.2" style="width: 165px;"><active data-reactid=".s.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".s.2.1"><span data-reactid=".s.2.1.0">回测框架</span></a></outline><outline class="toc-level-h2" data-reactid=".s.3" style="width: 165px;"><active data-reactid=".s.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".s.3.1"><span data-reactid=".s.3.1.0">交易策略</span></a></outline><outline class="toc-level-h2" data-reactid=".s.4" style="width: 165px;"><active data-reactid=".s.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".s.4.1"><span data-reactid=".s.4.1.0">模拟交易</span></a></outline><outline class="toc-level-h2" data-reactid=".s.5" style="width: 165px;"><active data-reactid=".s.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".s.5.1"><span data-reactid=".s.5.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".s.6" style="width: 165px;"><active data-reactid=".s.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".s.6.1"><span data-reactid=".s.6.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".s.7" style="width: 165px;"><active data-reactid=".s.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".s.7.1"><span data-reactid=".s.7.1.0">精选留言 (19)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/111296" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>