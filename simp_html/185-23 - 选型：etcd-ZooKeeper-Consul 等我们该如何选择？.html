
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 23 | 选型：etcd/ZooKeeper/Consul 等我们该如何选择？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>23 | 选型：etcd/ZooKeeper/Consul 等我们该如何选择？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">我希望你能够用最低的学习成本，掌握 etcd 核心原理和最佳实践，让 etcd 为你所用。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">23 | 选型：etcd/ZooKeeper/Consul 等我们该如何选择？</h1><div><span>唐聪</span> <span> 2021-03-15</span></div><div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/85/22/854977f8b4a824ec87yy77f7b9640822.jpg" style="width: auto;"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：王超凡</span><span>大小：15.20M</span><span> 时长：16:38</span></div></div><audio title="23 | 选型：etcd/ZooKeeper/Consul等我们该如何选择？" src="https://res001.geekbang.org/media/audio/bb/f1/bb96b3a33d18db1d5dca53e4f477d6f1/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="10281" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="10282"><span data-slate-object="text" data-key="10283"><span data-slate-leaf="true" data-offset-key="10283:0" data-first-offset="true"><span data-slate-string="true">你好，我是唐聪。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10284"><span data-slate-object="text" data-key="10285"><span data-slate-leaf="true" data-offset-key="10285:0" data-first-offset="true"><span data-slate-string="true">在软件开发过程中，当我们需要解决配置、服务发现、分布式锁等业务痛点，在面对 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10286"><span data-slate-object="text" data-key="10287"><span data-slate-leaf="true" data-offset-key="10287:0" data-first-offset="true"><span data-slate-string="true">etcd</span></span></span></a><span data-slate-object="text" data-key="10288"><span data-slate-leaf="true" data-offset-key="10288:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10289"><span data-slate-object="text" data-key="10290"><span data-slate-leaf="true" data-offset-key="10290:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper</span></span></span></a><span data-slate-object="text" data-key="10291"><span data-slate-leaf="true" data-offset-key="10291:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10292"><span data-slate-object="text" data-key="10293"><span data-slate-leaf="true" data-offset-key="10293:0" data-first-offset="true"><span data-slate-string="true">Consul</span></span></span></a><span data-slate-object="text" data-key="10294"><span data-slate-leaf="true" data-offset-key="10294:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10295"><span data-slate-object="text" data-key="10296"><span data-slate-leaf="true" data-offset-key="10296:0" data-first-offset="true"><span data-slate-string="true">Nacos</span></span></span></a><span data-slate-object="text" data-key="10297"><span data-slate-leaf="true" data-offset-key="10297:0" data-first-offset="true"><span data-slate-string="true"> 等一系列候选开源项目时，我们应该如何结合自己的业务场景，选择合适的分布式协调服务呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10298"><span data-slate-object="text" data-key="10299"><span data-slate-leaf="true" data-offset-key="10299:0" data-first-offset="true"><span data-slate-string="true">今天，我就和你聊聊主要分布式协调服务的对比。我将从基本架构、共识算法、数据模型、重点特性、容灾能力等维度出发，带你了解主要分布式协调服务的基本原理和彼此之间的差异性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10300"><span data-slate-object="text" data-key="10301"><span data-slate-leaf="true" data-offset-key="10301:0" data-first-offset="true"><span data-slate-string="true">希望通过这节课，让你对 etcd、ZooKeeper、Consul 原理和特性有一定的理解，帮助你选型适合业务场景的配置系统、服务发现组件。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10302" id="sr-toc-1"><span data-slate-object="text" data-key="10303"><span data-slate-leaf="true" data-offset-key="10303:0" data-first-offset="true"><span data-slate-string="true">基本架构及原理</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10304"><span data-slate-object="text" data-key="10305"><span data-slate-leaf="true" data-offset-key="10305:0" data-first-offset="true"><span data-slate-string="true">在详细和你介绍对比 etcd、ZooKeeper、Consul 特性之前，我们先从整体架构上来了解一下各开源项目的核心架构及原理。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10306" id="sr-toc-2"><span data-slate-object="text" data-key="10307"><span data-slate-leaf="true" data-offset-key="10307:0" data-first-offset="true"><span data-slate-string="true">etcd 架构及原理</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10308"><span data-slate-object="text" data-key="10309"><span data-slate-leaf="true" data-offset-key="10309:0" data-first-offset="true"><span data-slate-string="true">首先是 etcd，etcd 我们知道它是基于复制状态机实现的分布式协调服务。如下图所示，由 Raft 共识模块、日志模块、基于 boltdb 持久化存储的状态机组成。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10310"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/5c/4f/5c7a3079032f90120a6b309ee401fc4f.png?wh=605*319"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10311"><span data-slate-object="text" data-key="10312"><span data-slate-leaf="true" data-offset-key="10312:0" data-first-offset="true"><span data-slate-string="true">以下是 etcd 基于复制状态机模型的写请求流程：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10313"><div data-slate-type="list-line" data-slate-object="block" data-key="10314"><span data-slate-object="text" data-key="10315"><span data-slate-leaf="true" data-offset-key="10315:0" data-first-offset="true"><span data-slate-string="true">client 发起一个写请求（put x = 3）；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10316"><span data-slate-object="text" data-key="10317"><span data-slate-leaf="true" data-offset-key="10317:0" data-first-offset="true"><span data-slate-string="true">etcdserver 模块向 Raft 共识模块提交请求，共识模块生成一个写提案日志条目。若 server 是 Leader，则把日志条目广播给其他节点，并持久化日志条目到 WAL 中；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10318"><span data-slate-object="text" data-key="10319"><span data-slate-leaf="true" data-offset-key="10319:0" data-first-offset="true"><span data-slate-string="true">当一半以上节点持久化日志条目后，Leader 的共识模块将此日志条目标记为已提交（committed），并通知其他节点提交；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10320"><span data-slate-object="text" data-key="10321"><span data-slate-leaf="true" data-offset-key="10321:0" data-first-offset="true"><span data-slate-string="true">etcdserver 模块从 Raft 共识模块获取已经提交的日志条目，异步应用到 boltdb 状态机存储中，然后返回给 client。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10322"><span data-slate-object="text" data-key="10323"><span data-slate-leaf="true" data-offset-key="10323:0" data-first-offset="true"><span data-slate-string="true">更详细的原理我就不再重复描述，你可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10324"><span data-slate-object="text" data-key="10325"><span data-slate-leaf="true" data-offset-key="10325:0" data-first-offset="true"><span data-slate-string="true">02</span></span></span></a><span data-slate-object="text" data-key="10326"><span data-slate-leaf="true" data-offset-key="10326:0" data-first-offset="true"><span data-slate-string="true"> 读和 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10327"><span data-slate-object="text" data-key="10328"><span data-slate-leaf="true" data-offset-key="10328:0" data-first-offset="true"><span data-slate-string="true">03</span></span></span></a><span data-slate-object="text" data-key="10329"><span data-slate-leaf="true" data-offset-key="10329:0" data-first-offset="true"><span data-slate-string="true"> 写两节原理介绍。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10330" id="sr-toc-3"><span data-slate-object="text" data-key="10331"><span data-slate-leaf="true" data-offset-key="10331:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 架构及原理</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10332"><span data-slate-object="text" data-key="10333"><span data-slate-leaf="true" data-offset-key="10333:0" data-first-offset="true"><span data-slate-string="true">接下来我和你简要介绍下 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10334"><span data-slate-object="text" data-key="10335"><span data-slate-leaf="true" data-offset-key="10335:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper</span></span></span></a><span data-slate-object="text" data-key="10336"><span data-slate-leaf="true" data-offset-key="10336:0" data-first-offset="true"><span data-slate-string="true"> 原理，下图是它的架构图。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10337"><span data-slate-object="text" data-key="10338"><span data-slate-leaf="true" data-offset-key="10338:0" data-first-offset="true"><span data-slate-string="true">如下面架构图所示，你可以看到 ZooKeeper 中的节点与 etcd 类似，也划分为 Leader 节点、Follower 节点、Observer 节点（对应的 Raft 协议的 Learner 节点）。同时，写请求统一由 Leader 处理，读请求各个节点都能处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10339"><span data-slate-object="text" data-key="10340"><span data-slate-leaf="true" data-offset-key="10340:0" data-first-offset="true"><span data-slate-string="true">不一样的是它们的读行为和共识算法。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10341"><div data-slate-type="list-line" data-slate-object="block" data-key="10342"><span data-slate-object="text" data-key="10343"><span data-slate-leaf="true" data-offset-key="10343:0" data-first-offset="true"><span data-slate-string="true">在读行为上，ZooKeeper 默认读可能会返回 stale data，而 etcd 使用的线性读，能确保读取到反应集群共识的最新数据。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10344"><span data-slate-object="text" data-key="10345"><span data-slate-leaf="true" data-offset-key="10345:0" data-first-offset="true"><span data-slate-string="true">共识算法上，etcd 使用的是 Raft，ZooKeeper 使用的是 Zab。</span></span></span></div></div><div data-slate-type="image" data-slate-object="block" data-key="10346"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/7a/d3/7a84bcaef9e53ba19d7d88e6ed6504d3.png?wh=1920*1013"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10347"><span data-slate-object="text" data-key="10348"><span data-slate-leaf="true" data-offset-key="10348:0" data-first-offset="true"><span data-slate-string="true">那什么是 Zab 协议呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10349"><span data-slate-object="text" data-key="10350"><span data-slate-leaf="true" data-offset-key="10350:0" data-first-offset="true"><span data-slate-string="true">Zab 协议可以分为以下阶段：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10351"><div data-slate-type="list-line" data-slate-object="block" data-key="10352"><span data-slate-object="text" data-key="10353"><span data-slate-leaf="true" data-offset-key="10353:0" data-first-offset="true"><span data-slate-string="true">Phase 0，Leader 选举（Leader Election)。一个节点只要求获得半数以上投票，就可以当选为准 Leader；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10354"><span data-slate-object="text" data-key="10355"><span data-slate-leaf="true" data-offset-key="10355:0" data-first-offset="true"><span data-slate-string="true">Phase 1，发现（Discovery）。准 Leader 收集其他节点的数据信息，并将最新的数据复制到自身；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10356"><span data-slate-object="text" data-key="10357"><span data-slate-leaf="true" data-offset-key="10357:0" data-first-offset="true"><span data-slate-string="true">Phase 2，同步（Synchronization）。准 Leader 将自身最新数据复制给其他落后的节点，并告知其他节点自己正式当选为 Leader；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10358"><span data-slate-object="text" data-key="10359"><span data-slate-leaf="true" data-offset-key="10359:0" data-first-offset="true"><span data-slate-string="true">Phase 3，广播（Broadcast）。Leader 正式对外服务，处理客户端写请求，对消息进行广播。当收到一个写请求后，它会生成 Proposal 广播给各个 Follower 节点，一半以上 Follower 节点应答之后，Leader 再发送 Commit 命令给各个 Follower，告知它们提交相关提案；</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10360"><span data-slate-object="text" data-key="10361"><span data-slate-leaf="true" data-offset-key="10361:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 是如何实现的 Zab 协议的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10362"><span data-slate-object="text" data-key="10363"><span data-slate-leaf="true" data-offset-key="10363:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 在实现中并未严格按</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10364"><span data-slate-object="text" data-key="10365"><span data-slate-leaf="true" data-offset-key="10365:0" data-first-offset="true"><span data-slate-string="true">论文</span></span></span></a><span data-slate-object="text" data-key="10366"><span data-slate-leaf="true" data-offset-key="10366:0" data-first-offset="true"><span data-slate-string="true">定义的分阶段实现，而是对部分阶段进行了整合，分别如下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10367"><div data-slate-type="list-line" data-slate-object="block" data-key="10368"><span data-slate-object="text" data-key="10369"><span data-slate-leaf="true" data-offset-key="10369:0" data-first-offset="true"><span data-slate-string="true">Fast Leader Election。首先 ZooKeeper 使用了一个名为 Fast Leader Election 的选举算法，通过 Leader 选举安全规则限制，确保选举出来的 Leader 就含有最新数据， 避免了 Zab 协议的 Phase 1 阶段准 Leader 收集各个节点数据信息并复制到自身，也就是将 Phase 0 和 Phase 1 进行了合并。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10370"><span data-slate-object="text" data-key="10371"><span data-slate-leaf="true" data-offset-key="10371:0" data-first-offset="true"><span data-slate-string="true">Recovery Phase。各个 Follower 发送自己的最新数据信息给 Leader，Leader 根据差异情况，选择发送 SNAP、DIFF 差异数据、Truncate 指令删除冲突数据等，确保 Follower 追赶上 Leader 数据进度并保持一致。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10372"><span data-slate-object="text" data-key="10373"><span data-slate-leaf="true" data-offset-key="10373:0" data-first-offset="true"><span data-slate-string="true">Broadcast Phase。与 Zab 论文 Broadcast Phase 一致。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10374"><span data-slate-object="text" data-key="10375"><span data-slate-leaf="true" data-offset-key="10375:0" data-first-offset="true"><span data-slate-string="true">总体而言，从分布式系统 CAP 维度来看，ZooKeeper 与 etcd 类似的是，它也是一个 CP 系统，在出现网络分区等错误时，它优先保障的数据一致性，牺牲的是 A 可用性。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10376" id="sr-toc-4"><span data-slate-object="text" data-key="10377"><span data-slate-leaf="true" data-offset-key="10377:0" data-first-offset="true"><span data-slate-string="true">Consul 架构及原理</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10378"><span data-slate-object="text" data-key="10379"><span data-slate-leaf="true" data-offset-key="10379:0" data-first-offset="true"><span data-slate-string="true">了解完 ZooKeeper 架构及原理后，我们再看看 Consul，它的架构和原理是怎样的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10380"><span data-slate-object="text" data-key="10381"><span data-slate-leaf="true" data-offset-key="10381:0" data-first-offset="true"><span data-slate-string="true">下图是 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10382"><span data-slate-object="text" data-key="10383"><span data-slate-leaf="true" data-offset-key="10383:0" data-first-offset="true"><span data-slate-string="true">Consul 架构图</span></span></span></a><span data-slate-object="text" data-key="10384"><span data-slate-leaf="true" data-offset-key="10384:0" data-first-offset="true"><span data-slate-string="true">（引用自 HashiCorp 官方文档）。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10385"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/c4/90/c4feaebbdbe19d3f4e09899f8cd52190.png?wh=1920*1990"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10386"><span data-slate-object="text" data-key="10387"><span data-slate-leaf="true" data-offset-key="10387:0" data-first-offset="true"><span data-slate-string="true">从图中你可以看到，它由 Client、Server、Gossip 协议、Raft 共识算法、两个数据中心组成。每个数据中心内的 Server 基于 Raft 共识算法复制日志，Server 节点分为 Leader、Follower 等角色。Client 通过 Gossip 协议发现 Server 地址、分布式探测节点健康状态等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10388"><span data-slate-object="text" data-key="10389"><span data-slate-leaf="true" data-offset-key="10389:0" data-first-offset="true"><span data-slate-string="true">那什么是 Gossip 协议呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10390"><span data-slate-object="text" data-key="10391"><span data-slate-leaf="true" data-offset-key="10391:0" data-first-offset="true"><span data-slate-string="true">Gossip 中文名称叫流言协议，它是一种消息传播协议。它的核心思想其实源自我们生活中的八卦、闲聊。我们在日常生活中所看到的劲爆消息其实源于两类，一类是权威机构如国家新闻媒体发布的消息，另一类则是大家通过微信等社交聊天软件相互八卦，一传十，十传百的结果。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10392"><span data-slate-object="text" data-key="10393"><span data-slate-leaf="true" data-offset-key="10393:0" data-first-offset="true"><span data-slate-string="true">Gossip 协议的基本工作原理与我们八卦类似，在 Gossip 协议中，如下图所示，各个节点会周期性地选择一定数量节点，然后将消息同步给这些节点。收到消息后的节点同样做出类似的动作，随机的选择节点，继续扩散给其他节点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10394"><span data-slate-object="text" data-key="10395"><span data-slate-leaf="true" data-offset-key="10395:0" data-first-offset="true"><span data-slate-string="true">最终经过一定次数的扩散、传播，整个集群的各个节点都能感知到此消息，各个节点的数据趋于一致。Gossip 协议被广泛应用在多个知名项目中，比如 Redis Cluster 集群版，Apache Cassandra，AWS Dynamo。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10396"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/84/4d/847ae4bcb531065c2797f1c91d4f464d.png?wh=1920*989"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10397"><span data-slate-object="text" data-key="10398"><span data-slate-leaf="true" data-offset-key="10398:0" data-first-offset="true"><span data-slate-string="true">了解完 Gossip 协议，我们再看看架构图中的多数据中心，Consul 支持数据跨数据中心自动同步吗？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10399"><span data-slate-object="text" data-key="10400"><span data-slate-leaf="true" data-offset-key="10400:0" data-first-offset="true"><span data-slate-string="true">你需要注意的是，虽然 Consul 天然支持多数据中心，但是多数据中心内的服务数据并不会跨数据中心同步，各个数据中心的 Server 集群是独立的。不过，Consul 提供了 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10401"><span data-slate-object="text" data-key="10402"><span data-slate-leaf="true" data-offset-key="10402:0" data-first-offset="true"><span data-slate-string="true">Prepared Query</span></span></span></a><span data-slate-object="text" data-key="10403"><span data-slate-leaf="true" data-offset-key="10403:0" data-first-offset="true"><span data-slate-string="true"> 功能，它支持根据一定的策略返回多数据中心下的最佳的服务实例地址，使你的服务具备跨数据中心容灾。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10404"><span data-slate-object="text" data-key="10405"><span data-slate-leaf="true" data-offset-key="10405:0" data-first-offset="true"><span data-slate-string="true">比如当你的 API 网关收到用户请求查询 A 服务，API 网关服务优先从缓存中查找 A 服务对应的最佳实例。若无缓存则向 Consul 发起一个 Prepared Query 请求查询 A 服务实例，Consul 收到请求后，优先返回本数据中心下的服务实例。如果本数据中心没有或异常则根据数据中心间 RTT 由近到远查询其它数据中心数据，最终网关可将用户请求转发给最佳的数据中心下的实例地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10406"><span data-slate-object="text" data-key="10407"><span data-slate-leaf="true" data-offset-key="10407:0" data-first-offset="true"><span data-slate-string="true">了解完 Consul 的 Gossip 协议、多数据中心支持，我们再看看 Consul 是如何处理读请求的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10408"><span data-slate-object="text" data-key="10409"><span data-slate-leaf="true" data-offset-key="10409:0" data-first-offset="true"><span data-slate-string="true">Consul 支持以下三种模式的读请求：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10410"><div data-slate-type="list-line" data-slate-object="block" data-key="10411"><span data-slate-object="text" data-key="10412"><span data-slate-leaf="true" data-offset-key="10412:0" data-first-offset="true"><span data-slate-string="true">默认（default）。默认是此模式，绝大部分场景下它能保证数据的强一致性。但在老的 Leader 出现网络分区被隔离、新的 Leader 被选举出来的一个极小时间窗口内，可能会导致 stale read。这是因为 Consul 为了提高读性能，使用的是基于 Lease 机制来维持 Leader 身份，避免了与其他节点进行交互确认的开销。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10413"><span data-slate-object="text" data-key="10414"><span data-slate-leaf="true" data-offset-key="10414:0" data-first-offset="true"><span data-slate-string="true">强一致性（consistent）。强一致性读与 etcd 默认线性读模式一样，每次请求需要集群多数节点确认 Leader 身份，因此相比 default 模式读，性能会有所下降。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10415"><span data-slate-object="text" data-key="10416"><span data-slate-leaf="true" data-offset-key="10416:0" data-first-offset="true"><span data-slate-string="true">弱一致性（stale)。任何节点都可以读，无论它是否 Leader。可能读取到陈旧的数据，类似 etcd 的串行读。这种读模式不要求集群有 Leader，因此当集群不可用时，只要有节点存活，它依然可以响应读请求。</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10417" id="sr-toc-5"><span data-slate-object="text" data-key="10418"><span data-slate-leaf="true" data-offset-key="10418:0" data-first-offset="true"><span data-slate-string="true">重点特性比较</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10419"><span data-slate-object="text" data-key="10420"><span data-slate-leaf="true" data-offset-key="10420:0" data-first-offset="true"><span data-slate-string="true">初步了解完 etcd、ZooKeeper、Consul 架构及原理后，你可以看到，他们都是基于共识算法实现的强一致的分布式存储系统，并都提供了多种模式的读机制。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10421"><span data-slate-object="text" data-key="10422"><span data-slate-leaf="true" data-offset-key="10422:0" data-first-offset="true"><span data-slate-string="true">除了以上共性，那么它们之间有哪些差异呢？ 下表是 etcd 开源社区总结的一个</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10423"><span data-slate-object="text" data-key="10424"><span data-slate-leaf="true" data-offset-key="10424:0" data-first-offset="true"><span data-slate-string="true">详细对比项</span></span></span></a><span data-slate-object="text" data-key="10425"><span data-slate-leaf="true" data-offset-key="10425:0" data-first-offset="true"><span data-slate-string="true">，我们就从并发原语、健康检查及服务发现、数据模型、Watch 特性等功能上详细比较下它们功能和区别。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10426"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/4d/50/4d0d9a05790f8ee9b66daf66ea741a50.jpg?wh=622*1147"></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10427" id="sr-toc-6"><span data-slate-object="text" data-key="10428"><span data-slate-leaf="true" data-offset-key="10428:0" data-first-offset="true"><span data-slate-string="true">并发原语</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10429"><span data-slate-object="text" data-key="10430"><span data-slate-leaf="true" data-offset-key="10430:0" data-first-offset="true"><span data-slate-string="true">etcd 和 ZooKeeper、Consul 的典型应用场景都是分布式锁、Leader 选举，以上场景就涉及到并发原语控制。然而 etcd 和 ZooKeeper 并未提供原生的分布式锁、Leader 选举支持，只提供了核心的基本数据读写、并发控制 API，由应用上层去封装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10431"><span data-slate-object="text" data-key="10432"><span data-slate-leaf="true" data-offset-key="10432:0" data-first-offset="true"><span data-slate-string="true">为了帮助开发者更加轻松的使用 etcd 去解决分布式锁、Leader 选举等问题，etcd 社区提供了 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10433"><span data-slate-object="text" data-key="10434"><span data-slate-leaf="true" data-offset-key="10434:0" data-first-offset="true"><span data-slate-string="true">concurrency 包</span></span></span></a><span data-slate-object="text" data-key="10435"><span data-slate-leaf="true" data-offset-key="10435:0" data-first-offset="true"><span data-slate-string="true">来实现以上功能。同时，在 etcdserver 中内置了 Lock 和 Election 服务，不过其也是基于 concurrency 包做了一层封装而已，clientv3 并未提供 Lock 和 Election 服务 API 给 Client 使用。 ZooKeeper 所属的 Apache 社区提供了 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10436"><span data-slate-object="text" data-key="10437"><span data-slate-leaf="true" data-offset-key="10437:0" data-first-offset="true"><span data-slate-string="true">Apache Curator Recipes</span></span></span></a><span data-slate-object="text" data-key="10438"><span data-slate-leaf="true" data-offset-key="10438:0" data-first-offset="true"><span data-slate-string="true"> 库来帮助大家快速使用分布式锁、Leader 选举功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10439"><span data-slate-object="text" data-key="10440"><span data-slate-leaf="true" data-offset-key="10440:0" data-first-offset="true"><span data-slate-string="true">相比 etcd、ZooKeeper 依赖应用层基于 API 上层封装，Consul 对分布式锁就提供了</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10441"><span data-slate-object="text" data-key="10442"><span data-slate-leaf="true" data-offset-key="10442:0" data-first-offset="true"><span data-slate-string="true">原生的支持</span></span></span></a><span data-slate-object="text" data-key="10443"><span data-slate-leaf="true" data-offset-key="10443:0" data-first-offset="true"><span data-slate-string="true">，可直接通过命令行使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10444"><span data-slate-object="text" data-key="10445"><span data-slate-leaf="true" data-offset-key="10445:0" data-first-offset="true"><span data-slate-string="true">总体而言，etcd、ZooKeeper、Consul 都能解决分布式锁、Leader 选举的痛点，在选型时，你可能会重点考虑其提供的 API 语言是否与业务服务所使用的语言一致。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10446" id="sr-toc-7"><span data-slate-object="text" data-key="10447"><span data-slate-leaf="true" data-offset-key="10447:0" data-first-offset="true"><span data-slate-string="true">健康检查、服务发现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10448"><span data-slate-object="text" data-key="10449"><span data-slate-leaf="true" data-offset-key="10449:0" data-first-offset="true"><span data-slate-string="true">分布式协调服务的另外一个核心应用场景是服务发现、健康检查。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10450"><span data-slate-object="text" data-key="10451"><span data-slate-leaf="true" data-offset-key="10451:0" data-first-offset="true"><span data-slate-string="true">与并发原语类似，etcd 和 ZooKeeper 并未提供原生的服务发现支持。相反，Consul 在服务发现方面做了很多解放用户双手的工作，提供了服务发现的框架，帮助你的业务快速接入，并提供了 HTTP 和 DNS 两种获取服务方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10452"><span data-slate-object="text" data-key="10453"><span data-slate-leaf="true" data-offset-key="10453:0" data-first-offset="true"><span data-slate-string="true">比如下面就是通过 DNS 的方式获取服务地址：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="10454"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10455"><span data-slate-object="text" data-key="10456"><span data-slate-leaf="true" data-offset-key="10456:0" data-first-offset="true"><span data-slate-string="true">$ dig </span></span></span><span data-slate-object="text" data-key="10457"><span data-slate-leaf="true" data-offset-key="10457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@127</span></span></span></span><span data-slate-object="text" data-key="10458"><span data-slate-leaf="true" data-offset-key="10458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="10459"><span data-slate-leaf="true" data-offset-key="10459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.0</span></span></span></span><span data-slate-object="text" data-key="10460"><span data-slate-leaf="true" data-offset-key="10460:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">.1</span></span></span></span><span data-slate-object="text" data-key="10461"><span data-slate-leaf="true" data-offset-key="10461:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="10462"><span data-slate-leaf="true" data-offset-key="10462:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="10463"><span data-slate-leaf="true" data-offset-key="10463:0" data-first-offset="true"><span data-slate-string="true">p </span></span></span><span data-slate-object="text" data-key="10464"><span data-slate-leaf="true" data-offset-key="10464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8600</span></span></span></span><span data-slate-object="text" data-key="10465"><span data-slate-leaf="true" data-offset-key="10465:0" data-first-offset="true"><span data-slate-string="true"> redis.service.dc1.consul. </span></span></span><span data-slate-object="text" data-key="10466"><span data-slate-leaf="true" data-offset-key="10466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ANY</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10467"><span data-slate-object="text" data-key="10468"><span data-slate-leaf="true" data-offset-key="10468:0" data-first-offset="true"><span data-slate-string="true">最重要的是它还集成了分布式的健康检查机制。与 etcd 和 ZooKeeper 健康检查不一样的是，它是一种基于 client、Gossip 协议、分布式的健康检查机制，具备低延时、可扩展的特点。业务可通过 Consul 的健康检查机制，实现 HTTP 接口返回码、内存乃至磁盘空间的检测。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10469"><span data-slate-object="text" data-key="10470"><span data-slate-leaf="true" data-offset-key="10470:0" data-first-offset="true"><span data-slate-string="true">Consul 提供了</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10471"><span data-slate-object="text" data-key="10472"><span data-slate-leaf="true" data-offset-key="10472:0" data-first-offset="true"><span data-slate-string="true">多种机制给你注册健康检查</span></span></span></a><span data-slate-object="text" data-key="10473"><span data-slate-leaf="true" data-offset-key="10473:0" data-first-offset="true"><span data-slate-string="true">，如脚本、HTTP、TCP 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10474"><span data-slate-object="text" data-key="10475"><span data-slate-leaf="true" data-offset-key="10475:0" data-first-offset="true"><span data-slate-string="true">脚本是怎么工作的呢？介绍 Consul 架构时，我们提到过的 Agent 角色的任务之一就是执行分布式的健康检查。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10476"><span data-slate-object="text" data-key="10477"><span data-slate-leaf="true" data-offset-key="10477:0" data-first-offset="true"><span data-slate-string="true">比如你将如下脚本放在 Agent 相应目录下，当 Linux 机器内存使用率超过 70% 的时候，它会返回告警状态。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="10478"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="10479"><span data-slate-object="text" data-key="10480"><span data-slate-leaf="true" data-offset-key="10480:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10481"><span data-slate-object="text" data-key="10482"><span data-slate-leaf="true" data-offset-key="10482:0" data-first-offset="true"><span data-slate-string="true">  ​</span></span></span><span data-slate-object="text" data-key="10483"><span data-slate-leaf="true" data-offset-key="10483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"check"</span></span></span></span><span data-slate-object="text" data-key="10484"><span data-slate-leaf="true" data-offset-key="10484:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10485"><span data-slate-object="text" data-key="10486"><span data-slate-leaf="true" data-offset-key="10486:0" data-first-offset="true"><span data-slate-string="true">    ​</span></span></span><span data-slate-object="text" data-key="10487"><span data-slate-leaf="true" data-offset-key="10487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"id"</span></span></span></span><span data-slate-object="text" data-key="10488"><span data-slate-leaf="true" data-offset-key="10488:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="10489"><span data-slate-leaf="true" data-offset-key="10489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"mem-util"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10490"><span data-slate-object="text" data-key="10491"><span data-slate-leaf="true" data-offset-key="10491:0" data-first-offset="true"><span data-slate-string="true">    ​</span></span></span><span data-slate-object="text" data-key="10492"><span data-slate-leaf="true" data-offset-key="10492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="10493"><span data-slate-leaf="true" data-offset-key="10493:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="10494"><span data-slate-leaf="true" data-offset-key="10494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Memory utilization"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10495"><span data-slate-object="text" data-key="10496"><span data-slate-leaf="true" data-offset-key="10496:0" data-first-offset="true"><span data-slate-string="true">    ​</span></span></span><span data-slate-object="text" data-key="10497"><span data-slate-leaf="true" data-offset-key="10497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"args"</span></span></span></span><span data-slate-object="text" data-key="10498"><span data-slate-leaf="true" data-offset-key="10498:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10499"><span data-slate-object="text" data-key="10500"><span data-slate-leaf="true" data-offset-key="10500:0" data-first-offset="true"><span data-slate-string="true">      ​</span></span></span><span data-slate-object="text" data-key="10501"><span data-slate-leaf="true" data-offset-key="10501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/bin/sh"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10502"><span data-slate-object="text" data-key="10503"><span data-slate-leaf="true" data-offset-key="10503:0" data-first-offset="true"><span data-slate-string="true">      ​</span></span></span><span data-slate-object="text" data-key="10504"><span data-slate-leaf="true" data-offset-key="10504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"-c"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10505"><span data-slate-object="text" data-key="10506"><span data-slate-leaf="true" data-offset-key="10506:0" data-first-offset="true"><span data-slate-string="true">      ​</span></span></span><span data-slate-object="text" data-key="10507"><span data-slate-leaf="true" data-offset-key="10507:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/usr/bin/free | awk'/Mem/{printf(</span></span></span></span><span data-slate-object="text" data-key="10508"><span data-slate-leaf="true" data-offset-key="10508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$3</span></span></span></span></span><span data-slate-object="text" data-key="10509"><span data-slate-leaf="true" data-offset-key="10509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/</span></span></span></span><span data-slate-object="text" data-key="10510"><span data-slate-leaf="true" data-offset-key="10510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$2</span></span></span></span></span><span data-slate-object="text" data-key="10511"><span data-slate-leaf="true" data-offset-key="10511:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">*100)}'| awk'{ print(</span></span></span></span><span data-slate-object="text" data-key="10512"><span data-slate-leaf="true" data-offset-key="10512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$0</span></span></span></span></span><span data-slate-object="text" data-key="10513"><span data-slate-leaf="true" data-offset-key="10513:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">); if(</span></span></span></span><span data-slate-object="text" data-key="10514"><span data-slate-leaf="true" data-offset-key="10514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$1</span></span></span></span></span><span data-slate-object="text" data-key="10515"><span data-slate-leaf="true" data-offset-key="10515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> &gt; 70) exit 1;}'</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10516"><span data-slate-object="text" data-key="10517"><span data-slate-leaf="true" data-offset-key="10517:0" data-first-offset="true"><span data-slate-string="true">    ​]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10518"><span data-slate-object="text" data-key="10519"><span data-slate-leaf="true" data-offset-key="10519:0" data-first-offset="true"><span data-slate-string="true">    ​"interval</span></span></span><span data-slate-object="text" data-key="10520"><span data-slate-leaf="true" data-offset-key="10520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":"</span></span></span></span><span data-slate-object="text" data-key="10521"><span data-slate-leaf="true" data-offset-key="10521:0" data-first-offset="true"><span data-slate-string="true">10s</span></span></span><span data-slate-object="text" data-key="10522"><span data-slate-leaf="true" data-offset-key="10522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10523"><span data-slate-object="text" data-key="10524"><span data-slate-leaf="true" data-offset-key="10524:0" data-first-offset="true"><span data-slate-string="true">    ​"</span></span></span><span data-slate-object="text" data-key="10525"><span data-slate-leaf="true" data-offset-key="10525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">timeout</span></span></span></span><span data-slate-object="text" data-key="10526"><span data-slate-leaf="true" data-offset-key="10526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":"</span></span></span></span><span data-slate-object="text" data-key="10527"><span data-slate-leaf="true" data-offset-key="10527:0" data-first-offset="true"><span data-slate-string="true">1s</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10528"><span data-slate-object="text" data-key="10529"><span data-slate-leaf="true" data-offset-key="10529:0" data-first-offset="true"><span data-slate-string="true">  }​</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="10530"><span data-slate-object="text" data-key="10531"><span data-slate-leaf="true" data-offset-key="10531:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10532"><span data-slate-object="text" data-key="10533"><span data-slate-leaf="true" data-offset-key="10533:0" data-first-offset="true"><span data-slate-string="true">相比 Consul，etcd、ZooKeeper 它们提供的健康检查机制和能力就非常有限了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10534"><span data-slate-object="text" data-key="10535"><span data-slate-leaf="true" data-offset-key="10535:0" data-first-offset="true"><span data-slate-string="true">etcd 提供了 Lease 机制来实现活性检测。它是一种中心化的健康检查，依赖用户不断地发送心跳续租、更新 TTL。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10536"><span data-slate-object="text" data-key="10537"><span data-slate-leaf="true" data-offset-key="10537:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 使用的是一种名为临时节点的状态来实现健康检查。当 client 与 ZooKeeper 节点连接断掉时，ZooKeeper 就会删除此临时节点的 key-value 数据。它比基于心跳机制更复杂，也给 client 带去了更多的复杂性，所有 client 必须维持与 ZooKeeper server 的活跃连接并保持存活。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10538" id="sr-toc-8"><span data-slate-object="text" data-key="10539"><span data-slate-leaf="true" data-offset-key="10539:0" data-first-offset="true"><span data-slate-string="true">数据模型比较</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10540"><span data-slate-object="text" data-key="10541"><span data-slate-leaf="true" data-offset-key="10541:0" data-first-offset="true"><span data-slate-string="true">从并发原语、健康检查、服务发现等维度了解完 etcd、ZooKeeper、Consul 的实现区别之后，我们再从数据模型上对比下三者。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10542"><span data-slate-object="text" data-key="10543"><span data-slate-leaf="true" data-offset-key="10543:0" data-first-offset="true"><span data-slate-string="true">首先 etcd 正如我们在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10544"><span data-slate-object="text" data-key="10545"><span data-slate-leaf="true" data-offset-key="10545:0" data-first-offset="true"><span data-slate-string="true">07</span></span></span></a><span data-slate-object="text" data-key="10546"><span data-slate-leaf="true" data-offset-key="10546:0" data-first-offset="true"><span data-slate-string="true"> 节 MVCC 和 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10547"><span data-slate-object="text" data-key="10548"><span data-slate-leaf="true" data-offset-key="10548:0" data-first-offset="true"><span data-slate-string="true">10</span></span></span></a><span data-slate-object="text" data-key="10549"><span data-slate-leaf="true" data-offset-key="10549:0" data-first-offset="true"><span data-slate-string="true"> 节 boltdb 所介绍的，它是个扁平的 key-value 模型，内存索引通过 B-tree 实现，数据持久化存储基于 B+ tree 的 boltdb，支持范围查询、适合读多写少，可容纳数 G 的数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10550"><a data-slate-type="link" data-slate-object="inline" data-key="10551"><span data-slate-object="text" data-key="10552"><span data-slate-leaf="true" data-offset-key="10552:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 的数据模型</span></span></span></a><span data-slate-object="text" data-key="10553"><span data-slate-leaf="true" data-offset-key="10553:0" data-first-offset="true"><span data-slate-string="true">如下。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="10554"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/93/fb/93edd0575e5a5a1080dac40415b779fb.png?wh=1012*588"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10555"><span data-slate-object="text" data-key="10556"><span data-slate-leaf="true" data-offset-key="10556:0" data-first-offset="true"><span data-slate-string="true">如上图所示，它是一种层次模型，你可能已经发现，etcd v2 的内存数据模型与它是一样的。ZooKeeper 作为分布式协调服务的祖师爷，早期 etcd v2 的确就是参考它而设计的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10557"><span data-slate-object="text" data-key="10558"><span data-slate-leaf="true" data-offset-key="10558:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 的层次模型中的每个节点叫 Znode，它分为持久性和临时型两种。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10559"><div data-slate-type="list-line" data-slate-object="block" data-key="10560"><span data-slate-object="text" data-key="10561"><span data-slate-leaf="true" data-offset-key="10561:0" data-first-offset="true"><span data-slate-string="true">持久性顾名思义，除非你通过 API 删除它，否则它将永远存在。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10562"><span data-slate-object="text" data-key="10563"><span data-slate-leaf="true" data-offset-key="10563:0" data-first-offset="true"><span data-slate-string="true">临时型是指它与客户端会话绑定，若客户端会话结束或出现异常中断等，它都将被 ZooKeeper server 自动删除，被广泛应用于活性检测。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10564"><span data-slate-object="text" data-key="10565"><span data-slate-leaf="true" data-offset-key="10565:0" data-first-offset="true"><span data-slate-string="true">同时你创建节点的时候，还可以指定一个顺序标识，这样节点名创建出来后就具有顺序性，一般应用于分布式选举等场景中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10566"><span data-slate-object="text" data-key="10567"><span data-slate-leaf="true" data-offset-key="10567:0" data-first-offset="true"><span data-slate-string="true">那 ZooKeeper 是如何实现以上层次模型的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10568"><span data-slate-object="text" data-key="10569"><span data-slate-leaf="true" data-offset-key="10569:0" data-first-offset="true"><span data-slate-string="true">ZooKeeper 使用的是内存 ConcurrentHashMap 来实现此数据结构，因此具有良好的读性能。但是受限于内存的瓶颈，一般 ZooKeeper 的数据库文件大小是几百 M 左右。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10570"><span data-slate-object="text" data-key="10571"><span data-slate-leaf="true" data-offset-key="10571:0" data-first-offset="true"><span data-slate-string="true">Consul 的数据模型及存储是怎样的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10572"><span data-slate-object="text" data-key="10573"><span data-slate-leaf="true" data-offset-key="10573:0" data-first-offset="true"><span data-slate-string="true">它也提供了常用 key-value 操作，它的存储引擎是基于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10574"><span data-slate-object="text" data-key="10575"><span data-slate-leaf="true" data-offset-key="10575:0" data-first-offset="true"><span data-slate-string="true">Radix Tree</span></span></span></a><span data-slate-object="text" data-key="10576"><span data-slate-leaf="true" data-offset-key="10576:0" data-first-offset="true"><span data-slate-string="true"> 实现的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10577"><span data-slate-object="text" data-key="10578"><span data-slate-leaf="true" data-offset-key="10578:0" data-first-offset="true"><span data-slate-string="true">go-memdb</span></span></span></a><span data-slate-object="text" data-key="10579"><span data-slate-leaf="true" data-offset-key="10579:0" data-first-offset="true"><span data-slate-string="true">，要求 value 大小不能超过 512 个字节，数据库文件大小一般也是几百 M 左右。与 boltdb 类似，它也支持事务、MVCC。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10580" id="sr-toc-9"><span data-slate-object="text" data-key="10581"><span data-slate-leaf="true" data-offset-key="10581:0" data-first-offset="true"><span data-slate-string="true">Watch 特性比较</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10582"><span data-slate-object="text" data-key="10583"><span data-slate-leaf="true" data-offset-key="10583:0" data-first-offset="true"><span data-slate-string="true">接下来我们再看看 Watch 特性的比较。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10584"><span data-slate-object="text" data-key="10585"><span data-slate-leaf="true" data-offset-key="10585:0" data-first-offset="true"><span data-slate-string="true">正在我在 08 节 Watch 特性中所介绍的，etcd v3 的 Watch 是基于 MVCC 机制实现的，而 Consul 是采用滑动窗口实现的。Consul 存储引擎是基于 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10586"><span data-slate-object="text" data-key="10587"><span data-slate-leaf="true" data-offset-key="10587:0" data-first-offset="true"><span data-slate-string="true">Radix Tree</span></span></span></a><span data-slate-object="text" data-key="10588"><span data-slate-leaf="true" data-offset-key="10588:0" data-first-offset="true"><span data-slate-string="true"> 实现的，因此它不支持范围查询和监听，只支持前缀查询和监听，而 etcd 都支持。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10589"><span data-slate-object="text" data-key="10590"><span data-slate-leaf="true" data-offset-key="10590:0" data-first-offset="true"><span data-slate-string="true">相比 etcd、Consul，ZooKeeper 的 Watch 特性有更多的局限性，它是个一次性触发器。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10591"><span data-slate-object="text" data-key="10592"><span data-slate-leaf="true" data-offset-key="10592:0" data-first-offset="true"><span data-slate-string="true">在 ZooKeeper 中，client 对 Znode 设置了 Watch 时，如果 Znode 内容发生改变，那么 client 就会获得 Watch 事件。然而此 Znode 再次发生变化，那 client 是无法收到 Watch 事件的，除非 client 设置了新的 Watch。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="10593" id="sr-toc-10"><span data-slate-object="text" data-key="10594"><span data-slate-leaf="true" data-offset-key="10594:0" data-first-offset="true"><span data-slate-string="true">其他比较</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="10595"><span data-slate-object="text" data-key="10596"><span data-slate-leaf="true" data-offset-key="10596:0" data-first-offset="true"><span data-slate-string="true">最后我们再从其他方面做些比较。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="10597"><div data-slate-type="list-line" data-slate-object="block" data-key="10598"><span data-slate-object="text" data-key="10599"><span data-slate-leaf="true" data-offset-key="10599:0" data-first-offset="true"><span data-slate-string="true">线性读。etcd 和 Consul 都支持线性读，而 ZooKeeper 并不具备。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10600"><span data-slate-object="text" data-key="10601"><span data-slate-leaf="true" data-offset-key="10601:0" data-first-offset="true"><span data-slate-string="true">权限机制比较。etcd 实现了 RBAC 的权限校验，而 ZooKeeper 和 Consul 实现的 ACL。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10602"><span data-slate-object="text" data-key="10603"><span data-slate-leaf="true" data-offset-key="10603:0" data-first-offset="true"><span data-slate-string="true">事务比较。etcd 和 Consul 都提供了简易的事务能力，支持对字段进行比较，而 ZooKeeper 只提供了版本号检查能力，功能较弱。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="10604"><span data-slate-object="text" data-key="10605"><span data-slate-leaf="true" data-offset-key="10605:0" data-first-offset="true"><span data-slate-string="true">多数据中心。在多数据中心支持上，只有 Consul 是天然支持的，虽然它本身不支持数据自动跨数据中心同步，但是它提供的服务发现机制、</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="10606"><span data-slate-object="text" data-key="10607"><span data-slate-leaf="true" data-offset-key="10607:0" data-first-offset="true"><span data-slate-string="true">Prepared Query</span></span></span></a><span data-slate-object="text" data-key="10608"><span data-slate-leaf="true" data-offset-key="10608:0" data-first-offset="true"><span data-slate-string="true"> 功能，赋予了业务在一个可用区后端实例故障时，可将请求转发到最近的数据中心实例。而 etcd 和 ZooKeeper 并不支持。</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10609" id="sr-toc-11"><span data-slate-object="text" data-key="10610"><span data-slate-leaf="true" data-offset-key="10610:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10611"><span data-slate-object="text" data-key="10612"><span data-slate-leaf="true" data-offset-key="10612:0" data-first-offset="true"><span data-slate-string="true">最后我们来小结下今天的内容。首先我和你从顶层视角介绍了 etcd、ZooKeeper、Consul 基本架构及核心原理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10613"><span data-slate-object="text" data-key="10614"><span data-slate-leaf="true" data-offset-key="10614:0" data-first-offset="true"><span data-slate-string="true">从共识算法角度上看，etcd、Consul 是基于 Raft 算法实现的数据复制，ZooKeeper 则是基于 Zab 算法实现的。Raft 算法由 Leader 选举、日志同步、安全性组成，而 Zab 协议则由 Leader 选举、发现、同步、广播组成。无论 Leader 选举还是日志复制，它们都需要集群多数节点存活、确认才能继续工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10615"><span data-slate-object="text" data-key="10616"><span data-slate-leaf="true" data-offset-key="10616:0" data-first-offset="true"><span data-slate-string="true">从 CAP 角度上看，在发生网络分区时，etcd、Consul、ZooKeeper 都是一个 CP 系统，无法写入新数据。同时，etcd、Consul、ZooKeeper 提供了各种模式的读机制，总体上可分为强一致性读、非强一致性读。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10617"><span data-slate-object="text" data-key="10618"><span data-slate-leaf="true" data-offset-key="10618:0" data-first-offset="true"><span data-slate-string="true">其中 etcd 和 Consul 则提供了线性读，ZooKeeper 默认是非强一致性读，不过业务可以通过 sync () 接口，等待 Follower 数据追赶上 Leader 进度，以读取最新值。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10619"><span data-slate-object="text" data-key="10620"><span data-slate-leaf="true" data-offset-key="10620:0" data-first-offset="true"><span data-slate-string="true">接下来我从并发原语、健康检查、服务发现、数据模型、Watch 特性、多数据中心比较等方面和你重点介绍了三者的实现与区别。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10621"><span data-slate-object="text" data-key="10622"><span data-slate-leaf="true" data-offset-key="10622:0" data-first-offset="true"><span data-slate-string="true">其中 Consul 提供了原生的分布式锁、健康检查、服务发现机制支持，让业务可以更省心，不过 etcd 和 ZooKeeper 也都有相应的库，帮助你降低工作量。Consul 最大的亮点则是对多数据中心的支持。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10623"><span data-slate-object="text" data-key="10624"><span data-slate-leaf="true" data-offset-key="10624:0" data-first-offset="true"><span data-slate-string="true">最后如果业务使用 Go 语言编写的，国内一般使用 etcd 较多，文档、书籍、最佳实践案例丰富。Consul 在国外应用比较多，中文文档及实践案例相比 etcd 较少。ZooKeeper 一般是 Java 业务使用较多，广泛应用在大数据领域。另外 Nacos 也是个非常优秀的开源项目，支持服务发现、配置管理等，是 Java 业务的热门选择。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="10625" id="sr-toc-12"><span data-slate-object="text" data-key="10626"><span data-slate-leaf="true" data-offset-key="10626:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="10627"><span data-slate-object="text" data-key="10628"><span data-slate-leaf="true" data-offset-key="10628:0" data-first-offset="true"><span data-slate-string="true">好了，这节课到这里也就结束了，最后我给你留了一个思考题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10629"><span data-slate-object="text" data-key="10630"><span data-slate-leaf="true" data-offset-key="10630:0" data-first-offset="true"><span data-slate-string="true">越来越多的业务要求跨可用区乃至地区级的容灾，如果你是核心系统开发者，你会如何选型合适的分布式协调服务，设计跨可用区、地区的容灾方案呢？ 如果选用 etcd，又该怎么做呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="10631"><span data-slate-object="text" data-key="10632"><span data-slate-leaf="true" data-offset-key="10632:0" data-first-offset="true"><span data-slate-string="true">感谢你阅读，也欢迎你把这篇文章分享给更多的朋友一起阅读。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png" style="width: auto;"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-13">精选留言 (8)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/b2/e0/bf56878a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>kkxue</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/8a/95/8ac15yy848f71919ef784a1c9065e495.png"></div></span></div></div><div>我觉得 pingcap 的这个方案可行：
https://github.com/etcd-io/etcd/issues/11357
https://pingcap.com/blog-cn/geographic-data-distribution-traffic-and-latency-halved/
"这里我们引入了一个新概念 Group，每一个 Raft 节点都有一个对应的 Group ID，拥有相同 Group ID 的节点即在同一个数据中心中。既然有了每个 Raft 节点的 Group 信息，Leader 就可以在广播消息时在每一个 Group 中选择一个代理人节点（我们称为 Follower  Delegate），将整个 Group 成员所需要的信息发给这个代理人，代理人负责将数据同步给 Group 内的其他成员"</div><div><div>2021-03-15</div><div><div><i></i><span></span></div><div><i></i><span>10</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/66/2e/527b73c9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 骑着🚀看银河</span></div></div><div>按照这个比较 ETCD 并没有胜出啊，反而 Consul 是最佳选择，哈哈哈
</div><div><div>2022-03-17</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/b2/e0/bf56878a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>kkxue</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/8a/95/8ac15yy848f71919ef784a1c9065e495.png"></div></span></div></div><div>还有这个方案就是直接将不同数据中心的延时降低！如同 local datacenter, 传闻 google 做到了</div><div><div>2021-03-15</div><div><div><i></i><span>2</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/18/ac/4d68ba46.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 金时</span></div></div><div>线性读和强一致读有什么区别？</div><div><p>作者回复：没区别，强一致性也叫线性一致性</p></div><div><div>2021-09-01</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132"></div></div><div><div><div><span> 残天噬魂</span></div></div><div>额，老师这么一比较，我感觉除了语言契合度之外，consul 就应该是第一选择啊，哈哈</div><div><div>2021-12-31</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/1a/1f/17/f2a69e62.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fis.</span></div></div><div>3AZ 的或者 3 地域的直接跨区域部署就行了，就是时延需要考虑及优化，双 AZ 的比较复杂。
方案 1：etcd 集群 2+1 部署，引入全局仲裁服务，自己做一个 agent，根据仲裁服务的信息，管理 etcd 节点升主或降备，破坏了原有 raft 协议
方案 2：两个 etcd 集群，开发专门的数据同步工具或者开源 make mirror，主备集群模式。两个集群 revision 无法一致
方案 3：区域 1 主集群，区域 2 部署 3 个 learner，故障时区域 2 升主。
上面几种方案那种更好呢？还有其他好的方案吗？</div><div><div>2021-12-24</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/e9/91/4219d305.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>初学者</span></div></div><div>关于同城双 az 高可用，有一些问题想和老师探讨一下: 
如果我想采用 2+2 部署方案，也就一个集群 4 个节点平均部署到两个机房，这样的好处是一个 az 跪了，能保证另一个 az 肯定有节点上的数据是完整的，坏处是任何一个 az 挂了，服务就立即不可用，要有一个手动恢复的流程，我这里想请教一下老师，当前 etcd 只发现一种通过 force-new-cluster 的参数也通过某一个节点的数据恢复集群，有什么优雅的方式知道正常的 az 中两个节点中哪个节点数据最新？
像 zk 这种，我完全可以在正常 az 中新扩容一个新节点，修改集群 member 配置信息，然后在正常的 az 中恢复出一个 3 节点的集群，而且也只能新扩容的节点需要复制集群数据，etcd 好像不支持这种玩法。
</div><div><div>2021-12-09</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/46/0f/f6cfc659.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>mckee</span></div></div><div>etcd 一般可以采用同一个 region 下跨可用区部署，最好每个可用区部署一台</div><div><div>2021-11-17</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1y"><outline class="toc-level-h1" data-reactid=".1y.0" style="width: 175px;"><active data-reactid=".1y.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1y.0.1"><span data-reactid=".1y.0.1.0">23 | 选型：etcd/ZooKeeper/Consul 等我们该如何选择？</span></a></outline><outline class="toc-level-h2" data-reactid=".1y.1" style="width: 165px;"><active data-reactid=".1y.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1y.1.1"><span data-reactid=".1y.1.1.0">基本架构及原理</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.2" style="width: 155px;"><active data-reactid=".1y.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1y.2.1"><span data-reactid=".1y.2.1.0">etcd 架构及原理</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.3" style="width: 155px;"><active data-reactid=".1y.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1y.3.1"><span data-reactid=".1y.3.1.0">ZooKeeper 架构及原理</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.4" style="width: 155px;"><active data-reactid=".1y.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1y.4.1"><span data-reactid=".1y.4.1.0">Consul 架构及原理</span></a></outline><outline class="toc-level-h2" data-reactid=".1y.5" style="width: 165px;"><active data-reactid=".1y.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1y.5.1"><span data-reactid=".1y.5.1.0">重点特性比较</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.6" style="width: 155px;"><active data-reactid=".1y.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1y.6.1"><span data-reactid=".1y.6.1.0">并发原语</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.7" style="width: 155px;"><active data-reactid=".1y.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1y.7.1"><span data-reactid=".1y.7.1.0">健康检查、服务发现</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.8" style="width: 155px;"><active data-reactid=".1y.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1y.8.1"><span data-reactid=".1y.8.1.0">数据模型比较</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.9" style="width: 155px;"><active data-reactid=".1y.9.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1y.9.1"><span data-reactid=".1y.9.1.0">Watch 特性比较</span></a></outline><outline class="toc-level-h3" data-reactid=".1y.a" style="width: 155px;"><active data-reactid=".1y.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".1y.a.1"><span data-reactid=".1y.a.1.0">其他比较</span></a></outline><outline class="toc-level-h2" data-reactid=".1y.b" style="width: 165px;"><active data-reactid=".1y.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".1y.b.1"><span data-reactid=".1y.b.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".1y.c" style="width: 165px;"><active data-reactid=".1y.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".1y.c.1"><span data-reactid=".1y.c.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".1y.d" style="width: 165px;"><active data-reactid=".1y.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".1y.d.1"><span data-reactid=".1y.d.1.0">精选留言 (8)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/351898" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>