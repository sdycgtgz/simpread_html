
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 26｜StatefulSet：怎么管理有状态的应用？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>26｜StatefulSet：怎么管理有状态的应用？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">26｜StatefulSet：怎么管理有状态的应用？</h1><div><span>Chrono</span> <span>2022-08-22</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/46/10/4687967fcaf3abf00537c911fa75f610.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：Chrono</span><span> 大小：12.75M</span><span> 时长：13:57</span></div></div><audio title="26｜StatefulSet：怎么管理有状态的应用？" src="https://res001.geekbang.org/media/audio/a1/cb/a1d41d97c379f2c690b9b1a2b56252cb/ld/ld.m3u8" __idm_id__="884764"></audio></div><div><div><div><div data-slate-editor="true" data-key="13460" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="13461"><span data-slate-object="text" data-key="13462"><span data-slate-leaf="true" data-offset-key="13462:0" data-first-offset="true"><span data-slate-string="true">你好，我是 Chrono。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13463"><span data-slate-object="text" data-key="13464"><span data-slate-leaf="true" data-offset-key="13464:0" data-first-offset="true"><span data-slate-string="true">在中级篇里，我们学习了 Deployment 和 DaemonSet 两种 API 对象，它们是在 Kubernetes 集群里部署应用的重要工具，不过它们也有一个缺点，只能管理 “无状态应用”（Stateless Application），不能管理 “有状态应用”（Stateful Application）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13465"><span data-slate-object="text" data-key="13466"><span data-slate-leaf="true" data-offset-key="13466:0" data-first-offset="true"><span data-slate-string="true">“有状态应用” 的处理比较复杂，要考虑的事情很多，但是这些问题我们其实可以通过组合之前学过的 Deployment、Service、PersistentVolume 等对象来解决。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13467"><span data-slate-object="text" data-key="13468"><span data-slate-leaf="true" data-offset-key="13468:0" data-first-offset="true"><span data-slate-string="true">今天我们就来研究一下什么是 “有状态应用”，然后看看 Kubernetes 为什么会设计一个新对象 ——StatefulSet 来专门管理 “有状态应用”。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13469" id="sr-toc-1"><span data-slate-object="text" data-key="13470"><span data-slate-leaf="true" data-offset-key="13470:0" data-first-offset="true"><span data-slate-string="true">什么是有状态的应用</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13471"><span data-slate-object="text" data-key="13472"><span data-slate-leaf="true" data-offset-key="13472:0" data-first-offset="true"><span data-slate-string="true">我们先从 PersistentVolume 谈起，它为 Kubernetes 带来了持久化存储的功能，能够让应用把数据存放在本地或者远程的磁盘上。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13473"><span data-slate-object="text" data-key="13474"><span data-slate-leaf="true" data-offset-key="13474:0" data-first-offset="true"><span data-slate-string="true">那么你有没有想过，持久化存储，对应用来说，究竟意味着什么呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13475"><span data-slate-object="text" data-key="13476"><span data-slate-leaf="true" data-offset-key="13476:0" data-first-offset="true"><span data-slate-string="true">有了持久化存储，应用就可以把一些运行时的关键数据落盘，相当于有了一份 “保险”，如果 Pod 发生意外崩溃，也只不过像是按下了暂停键，等重启后挂载 Volume，再加载原数据就能够满血复活，恢复之前的 “状态” 继续运行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13477"><span data-slate-object="text" data-key="13478"><span data-slate-leaf="true" data-offset-key="13478:0" data-first-offset="true"><span data-slate-string="true">注意到了吗？这里有一个关键词 ——“</span></span></span><span data-slate-object="text" data-key="13479"><span data-slate-leaf="true" data-offset-key="13479:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">状态</span></span></span></span><span data-slate-object="text" data-key="13480"><span data-slate-leaf="true" data-offset-key="13480:0" data-first-offset="true"><span data-slate-string="true">”，应用保存的数据，实际上就是它某个时刻的 “运行状态”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13481"><span data-slate-object="text" data-key="13482"><span data-slate-leaf="true" data-offset-key="13482:0" data-first-offset="true"><span data-slate-string="true">所以从这个角度来说，理论上任何应用都是有状态的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13483"><span data-slate-object="text" data-key="13484"><span data-slate-leaf="true" data-offset-key="13484:0" data-first-offset="true"><span data-slate-string="true">只是有的应用的状态信息不是很重要，即使不恢复状态也能够正常运行，这就是我们常说的 “</span></span></span><span data-slate-object="text" data-key="13485"><span data-slate-leaf="true" data-offset-key="13485:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">无状态应用</span></span></span></span><span data-slate-object="text" data-key="13486"><span data-slate-leaf="true" data-offset-key="13486:0" data-first-offset="true"><span data-slate-string="true">”。“无状态应用” 典型的例子就是 Nginx 这样的 Web 服务器，它只是处理 HTTP 请求，本身不生产数据（日志除外），不需要特意保存状态，无论以什么状态重启都能很好地对外提供服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13487"><span data-slate-object="text" data-key="13488"><span data-slate-leaf="true" data-offset-key="13488:0" data-first-offset="true"><span data-slate-string="true">还有一些应用，运行状态信息就很重要了，如果因为重启而丢失了状态是绝对无法接受的，这样的应用就是 “</span></span></span><span data-slate-object="text" data-key="13489"><span data-slate-leaf="true" data-offset-key="13489:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">有状态应用</span></span></span></span><span data-slate-object="text" data-key="13490"><span data-slate-leaf="true" data-offset-key="13490:0" data-first-offset="true"><span data-slate-string="true">”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13491"><span data-slate-object="text" data-key="13492"><span data-slate-leaf="true" data-offset-key="13492:0" data-first-offset="true"><span data-slate-string="true">“有状态应用” 的例子也有很多，比如 Redis、MySQL 这样的数据库，它们的 “状态” 就是在内存或者磁盘上产生的数据，是应用的核心价值所在，如果不能够把这些数据及时保存再恢复，那绝对会是灾难性的后果。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13493"><span data-slate-object="text" data-key="13494"><span data-slate-leaf="true" data-offset-key="13494:0" data-first-offset="true"><span data-slate-string="true">理解了这一点，我们结合目前学到的知识思考一下：</span></span></span><span data-slate-object="text" data-key="13495"><span data-slate-leaf="true" data-offset-key="13495:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Deployment 加上 PersistentVolume，在 Kubernetes 里是不是可以轻松管理有状态的应用了呢？</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13496"><span data-slate-object="text" data-key="13497"><span data-slate-leaf="true" data-offset-key="13497:0" data-first-offset="true"><span data-slate-string="true">的确，用 Deployment 来保证高可用，用 PersistentVolume 来存储数据，确实可以部分达到管理 “有状态应用” 的目的（你可以自己试着编写这样的 YAML）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13498"><span data-slate-object="text" data-key="13499"><span data-slate-leaf="true" data-offset-key="13499:0" data-first-offset="true"><span data-slate-string="true">但是 Kubernetes 的眼光则更加全面和长远，它认为 “状态” 不仅仅是数据持久化，在集群化、分布式的场景里，还有多实例的依赖关系、启动顺序和网络标识等问题需要解决，而这些问题恰恰是 Deployment 力所不及的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13500"><span data-slate-object="text" data-key="13501"><span data-slate-leaf="true" data-offset-key="13501:0" data-first-offset="true"><span data-slate-string="true">因为只使用 Deployment，多个实例之间是无关的，启动的顺序不固定，Pod 的名字、IP 地址、域名也都是完全随机的，这正是 “无状态应用” 的特点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13502"><span data-slate-object="text" data-key="13503"><span data-slate-leaf="true" data-offset-key="13503:0" data-first-offset="true"><span data-slate-string="true">但对于 “有状态应用”，多个实例之间可能存在依赖关系，比如 master/slave、active/passive，需要依次启动才能保证应用正常运行，外界的客户端也可能要使用固定的网络标识来访问实例，而且这些信息还必须要保证在 Pod 重启后不变。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13504"><span data-slate-object="text" data-key="13505"><span data-slate-leaf="true" data-offset-key="13505:0" data-first-offset="true"><span data-slate-string="true">所以，Kubernetes 就在 Deployment 的基础之上定义了一个新的 API 对象，名字也很好理解，就叫 StatefulSet，专门用来管理有状态的应用。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13506" id="sr-toc-2"><span data-slate-object="text" data-key="13507"><span data-slate-leaf="true" data-offset-key="13507:0" data-first-offset="true"><span data-slate-string="true">如何使用 YAML 描述 StatefulSet</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13508"><span data-slate-object="text" data-key="13509"><span data-slate-leaf="true" data-offset-key="13509:0" data-first-offset="true"><span data-slate-string="true">首先我们还是用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13510"><span data-slate-object="text" data-key="13511"><span data-slate-leaf="true" data-offset-key="13511:0" data-first-offset="true"><span data-slate-string="true">kubectl api-resources</span></span></span></span><span data-slate-object="text" data-key="13512"><span data-slate-leaf="true" data-offset-key="13512:0" data-first-offset="true"><span data-slate-string="true"> 来查看 StatefulSet 的基本信息，可以知道它的简称是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13513"><span data-slate-object="text" data-key="13514"><span data-slate-leaf="true" data-offset-key="13514:0" data-first-offset="true"><span data-slate-string="true">sts</span></span></span></span><span data-slate-object="text" data-key="13515"><span data-slate-leaf="true" data-offset-key="13515:0" data-first-offset="true"><span data-slate-string="true">，YAML 文件头信息是：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="13516"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13517"><span data-slate-object="text" data-key="13518"><span data-slate-leaf="true" data-offset-key="13518:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13519"><span data-slate-object="text" data-key="13520"><span data-slate-leaf="true" data-offset-key="13520:0" data-first-offset="true"><span data-slate-string="true">kind: StatefulSet</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13521"><span data-slate-object="text" data-key="13522"><span data-slate-leaf="true" data-offset-key="13522:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13523"><span data-slate-object="text" data-key="13524"><span data-slate-leaf="true" data-offset-key="13524:0" data-first-offset="true"><span data-slate-string="true">  name: xxx-sts</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13525"><span data-slate-object="text" data-key="13526"><span data-slate-leaf="true" data-offset-key="13526:0" data-first-offset="true"><span data-slate-string="true">和 DaemonSet 类似，StatefulSet 也可以看做是 Deployment 的一个特例，它也不能直接用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13527"><span data-slate-object="text" data-key="13528"><span data-slate-leaf="true" data-offset-key="13528:0" data-first-offset="true"><span data-slate-string="true">kubectl create</span></span></span></span><span data-slate-object="text" data-key="13529"><span data-slate-leaf="true" data-offset-key="13529:0" data-first-offset="true"><span data-slate-string="true"> 创建样板文件，但它的对象描述和 Deployment 差不多，你同样可以把 Deployment 适当修改一下，就变成了 StatefulSet 对象。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13530"><span data-slate-object="text" data-key="13531"><span data-slate-leaf="true" data-offset-key="13531:0" data-first-offset="true"><span data-slate-string="true">这里我给出了一个使用 Redis 的 StatefulSet，你来看看它与 Deployment 有什么差异：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="13532"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13533"><span data-slate-object="text" data-key="13534"><span data-slate-leaf="true" data-offset-key="13534:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13535"><span data-slate-object="text" data-key="13536"><span data-slate-leaf="true" data-offset-key="13536:0" data-first-offset="true"><span data-slate-string="true">kind: StatefulSet</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13537"><span data-slate-object="text" data-key="13538"><span data-slate-leaf="true" data-offset-key="13538:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13539"><span data-slate-object="text" data-key="13540"><span data-slate-leaf="true" data-offset-key="13540:0" data-first-offset="true"><span data-slate-string="true">  name: redis-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13541"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13542"><span data-slate-object="text" data-key="13543"><span data-slate-leaf="true" data-offset-key="13543:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13544"><span data-slate-object="text" data-key="13545"><span data-slate-leaf="true" data-offset-key="13545:0" data-first-offset="true"><span data-slate-string="true">  serviceName: redis-svc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13546"><span data-slate-object="text" data-key="13547"><span data-slate-leaf="true" data-offset-key="13547:0" data-first-offset="true"><span data-slate-string="true">  replicas: </span></span></span><span data-slate-object="text" data-key="13548"><span data-slate-leaf="true" data-offset-key="13548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13549"><span data-slate-object="text" data-key="13550"><span data-slate-leaf="true" data-offset-key="13550:0" data-first-offset="true"><span data-slate-string="true">  selector:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13551"><span data-slate-object="text" data-key="13552"><span data-slate-leaf="true" data-offset-key="13552:0" data-first-offset="true"><span data-slate-string="true">    matchLabels:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13553"><span data-slate-object="text" data-key="13554"><span data-slate-leaf="true" data-offset-key="13554:0" data-first-offset="true"><span data-slate-string="true">      app: redis-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13555"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13556"><span data-slate-object="text" data-key="13557"><span data-slate-leaf="true" data-offset-key="13557:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="13558"><span data-slate-leaf="true" data-offset-key="13558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="13559"><span data-slate-leaf="true" data-offset-key="13559:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13560"><span data-slate-object="text" data-key="13561"><span data-slate-leaf="true" data-offset-key="13561:0" data-first-offset="true"><span data-slate-string="true">    metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13562"><span data-slate-object="text" data-key="13563"><span data-slate-leaf="true" data-offset-key="13563:0" data-first-offset="true"><span data-slate-string="true">      labels:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13564"><span data-slate-object="text" data-key="13565"><span data-slate-leaf="true" data-offset-key="13565:0" data-first-offset="true"><span data-slate-string="true">        app: redis-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13566"><span data-slate-object="text" data-key="13567"><span data-slate-leaf="true" data-offset-key="13567:0" data-first-offset="true"><span data-slate-string="true">    spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13568"><span data-slate-object="text" data-key="13569"><span data-slate-leaf="true" data-offset-key="13569:0" data-first-offset="true"><span data-slate-string="true">      containers:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13570"><span data-slate-object="text" data-key="13571"><span data-slate-leaf="true" data-offset-key="13571:0" data-first-offset="true"><span data-slate-string="true">      - image: redis:</span></span></span><span data-slate-object="text" data-key="13572"><span data-slate-leaf="true" data-offset-key="13572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="13573"><span data-slate-leaf="true" data-offset-key="13573:0" data-first-offset="true"><span data-slate-string="true">-alpine</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13574"><span data-slate-object="text" data-key="13575"><span data-slate-leaf="true" data-offset-key="13575:0" data-first-offset="true"><span data-slate-string="true">        name: redis</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13576"><span data-slate-object="text" data-key="13577"><span data-slate-leaf="true" data-offset-key="13577:0" data-first-offset="true"><span data-slate-string="true">        ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13578"><span data-slate-object="text" data-key="13579"><span data-slate-leaf="true" data-offset-key="13579:0" data-first-offset="true"><span data-slate-string="true">        - containerPort: </span></span></span><span data-slate-object="text" data-key="13580"><span data-slate-leaf="true" data-offset-key="13580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6379</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13581"><span data-slate-object="text" data-key="13582"><span data-slate-leaf="true" data-offset-key="13582:0" data-first-offset="true"><span data-slate-string="true">我们会发现，YAML 文件里除了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13583"><span data-slate-object="text" data-key="13584"><span data-slate-leaf="true" data-offset-key="13584:0" data-first-offset="true"><span data-slate-string="true">kind</span></span></span></span><span data-slate-object="text" data-key="13585"><span data-slate-leaf="true" data-offset-key="13585:0" data-first-offset="true"><span data-slate-string="true"> 必须是 “</span></span></span><span data-slate-object="text" data-key="13586"><span data-slate-leaf="true" data-offset-key="13586:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">StatefulSet</span></span></span></span><span data-slate-object="text" data-key="13587"><span data-slate-leaf="true" data-offset-key="13587:0" data-first-offset="true"><span data-slate-string="true">”，在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13588"><span data-slate-object="text" data-key="13589"><span data-slate-leaf="true" data-offset-key="13589:0" data-first-offset="true"><span data-slate-string="true">spec</span></span></span></span><span data-slate-object="text" data-key="13590"><span data-slate-leaf="true" data-offset-key="13590:0" data-first-offset="true"><span data-slate-string="true"> 里还多出了一个 “</span></span></span><span data-slate-object="text" data-key="13591"><span data-slate-leaf="true" data-offset-key="13591:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">serviceName</span></span></span></span><span data-slate-object="text" data-key="13592"><span data-slate-leaf="true" data-offset-key="13592:0" data-first-offset="true"><span data-slate-string="true">” 字段，其余的部分和 Deployment 是一模一样的，比如 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13593"><span data-slate-object="text" data-key="13594"><span data-slate-leaf="true" data-offset-key="13594:0" data-first-offset="true"><span data-slate-string="true">replicas</span></span></span></span><span data-slate-object="text" data-key="13595"><span data-slate-leaf="true" data-offset-key="13595:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13596"><span data-slate-object="text" data-key="13597"><span data-slate-leaf="true" data-offset-key="13597:0" data-first-offset="true"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="13598"><span data-slate-leaf="true" data-offset-key="13598:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13599"><span data-slate-object="text" data-key="13600"><span data-slate-leaf="true" data-offset-key="13600:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="13601"><span data-slate-leaf="true" data-offset-key="13601:0" data-first-offset="true"><span data-slate-string="true"> 等等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13602"><span data-slate-object="text" data-key="13603"><span data-slate-leaf="true" data-offset-key="13603:0" data-first-offset="true"><span data-slate-string="true">这两个不同之处其实就是 StatefulSet 与 Deployment 的关键区别。想要真正理解这一点，我们得结合 StatefulSet 在 Kubernetes 里的使用方法来分析。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13604" id="sr-toc-3"><span data-slate-object="text" data-key="13605"><span data-slate-leaf="true" data-offset-key="13605:0" data-first-offset="true"><span data-slate-string="true">如何在 Kubernetes 里使用 StatefulSet</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13606"><span data-slate-object="text" data-key="13607"><span data-slate-leaf="true" data-offset-key="13607:0" data-first-offset="true"><span data-slate-string="true">让我们用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13608"><span data-slate-object="text" data-key="13609"><span data-slate-leaf="true" data-offset-key="13609:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="13610"><span data-slate-leaf="true" data-offset-key="13610:0" data-first-offset="true"><span data-slate-string="true"> 创建 StatefulSet 对象，用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13611"><span data-slate-object="text" data-key="13612"><span data-slate-leaf="true" data-offset-key="13612:0" data-first-offset="true"><span data-slate-string="true">kubectl get</span></span></span></span><span data-slate-object="text" data-key="13613"><span data-slate-leaf="true" data-offset-key="13613:0" data-first-offset="true"><span data-slate-string="true"> 先看看它是什么样的：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="13614"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13615"><span data-slate-object="text" data-key="13616"><span data-slate-leaf="true" data-offset-key="13616:0" data-first-offset="true"><span data-slate-string="true">kubectl apply </span></span></span><span data-slate-object="text" data-key="13617"><span data-slate-leaf="true" data-offset-key="13617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13618"><span data-slate-leaf="true" data-offset-key="13618:0" data-first-offset="true"><span data-slate-string="true">f redis</span></span></span><span data-slate-object="text" data-key="13619"><span data-slate-leaf="true" data-offset-key="13619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13620"><span data-slate-leaf="true" data-offset-key="13620:0" data-first-offset="true"><span data-slate-string="true">sts.yml</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13621"><span data-slate-object="text" data-key="13622"><span data-slate-leaf="true" data-offset-key="13622:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13623"><span data-slate-leaf="true" data-offset-key="13623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="13624"><span data-slate-leaf="true" data-offset-key="13624:0" data-first-offset="true"><span data-slate-string="true"> sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13625"><span data-slate-object="text" data-key="13626"><span data-slate-leaf="true" data-offset-key="13626:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13627"><span data-slate-leaf="true" data-offset-key="13627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="13628"><span data-slate-leaf="true" data-offset-key="13628:0" data-first-offset="true"><span data-slate-string="true"> pod</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="13629"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/71/88/71b485401dca6946fe4788fa97e3fd88.png?wh=1268x414"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13630"><span data-slate-object="text" data-key="13631"><span data-slate-leaf="true" data-offset-key="13631:0" data-first-offset="true"><span data-slate-string="true">从截图里，你应该能够看到，StatefulSet 所管理的 Pod 不再是随机的名字了，而是有了顺序编号，从 0 开始分别被命名为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13632"><span data-slate-object="text" data-key="13633"><span data-slate-leaf="true" data-offset-key="13633:0" data-first-offset="true"><span data-slate-string="true">redis-sts-0</span></span></span></span><span data-slate-object="text" data-key="13634"><span data-slate-leaf="true" data-offset-key="13634:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13635"><span data-slate-object="text" data-key="13636"><span data-slate-leaf="true" data-offset-key="13636:0" data-first-offset="true"><span data-slate-string="true">redis-sts-1</span></span></span></span><span data-slate-object="text" data-key="13637"><span data-slate-leaf="true" data-offset-key="13637:0" data-first-offset="true"><span data-slate-string="true">，Kubernetes 也会按照这个顺序依次创建（0 号比 1 号的 AGE 要长一点），这就解决了</span></span></span><span data-slate-object="text" data-key="13638"><span data-slate-leaf="true" data-offset-key="13638:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> “有状态应用” 的第一个问题：启动顺序</span></span></span></span><span data-slate-object="text" data-key="13639"><span data-slate-leaf="true" data-offset-key="13639:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13640"><span data-slate-object="text" data-key="13641"><span data-slate-leaf="true" data-offset-key="13641:0" data-first-offset="true"><span data-slate-string="true">有了启动的先后顺序，应用该怎么知道自己的身份，进而确定互相之间的依赖关系呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13642"><span data-slate-object="text" data-key="13643"><span data-slate-leaf="true" data-offset-key="13643:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 给出的方法是</span></span></span><span data-slate-object="text" data-key="13644"><span data-slate-leaf="true" data-offset-key="13644:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">使用 hostname</span></span></span></span><span data-slate-object="text" data-key="13645"><span data-slate-leaf="true" data-offset-key="13645:0" data-first-offset="true"><span data-slate-string="true">，也就是每个 Pod 里的主机名，让我们再用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13646"><span data-slate-object="text" data-key="13647"><span data-slate-leaf="true" data-offset-key="13647:0" data-first-offset="true"><span data-slate-string="true">kubectl exec</span></span></span></span><span data-slate-object="text" data-key="13648"><span data-slate-leaf="true" data-offset-key="13648:0" data-first-offset="true"><span data-slate-string="true"> 登录 Pod 内部看看：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="13649"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13650"><span data-slate-object="text" data-key="13651"><span data-slate-leaf="true" data-offset-key="13651:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13652"><span data-slate-leaf="true" data-offset-key="13652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="13653"><span data-slate-leaf="true" data-offset-key="13653:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13654"><span data-slate-leaf="true" data-offset-key="13654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13655"><span data-slate-leaf="true" data-offset-key="13655:0" data-first-offset="true"><span data-slate-string="true">it redis</span></span></span><span data-slate-object="text" data-key="13656"><span data-slate-leaf="true" data-offset-key="13656:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13657"><span data-slate-leaf="true" data-offset-key="13657:0" data-first-offset="true"><span data-slate-string="true">sts</span></span></span><span data-slate-object="text" data-key="13658"><span data-slate-leaf="true" data-offset-key="13658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-0</span></span></span></span><span data-slate-object="text" data-key="13659"><span data-slate-leaf="true" data-offset-key="13659:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13660"><span data-slate-leaf="true" data-offset-key="13660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-- sh</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="13661"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/be/39/be44f94eaf07f3591c7a2a8b9cdd1739.png?wh=1308x468"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13662"><span data-slate-object="text" data-key="13663"><span data-slate-leaf="true" data-offset-key="13663:0" data-first-offset="true"><span data-slate-string="true">在 Pod 里查看环境变量 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13664"><span data-slate-object="text" data-key="13665"><span data-slate-leaf="true" data-offset-key="13665:0" data-first-offset="true"><span data-slate-string="true">$HOSTNAME</span></span></span></span><span data-slate-object="text" data-key="13666"><span data-slate-leaf="true" data-offset-key="13666:0" data-first-offset="true"><span data-slate-string="true"> 或者是执行命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13667"><span data-slate-object="text" data-key="13668"><span data-slate-leaf="true" data-offset-key="13668:0" data-first-offset="true"><span data-slate-string="true">hostname</span></span></span></span><span data-slate-object="text" data-key="13669"><span data-slate-leaf="true" data-offset-key="13669:0" data-first-offset="true"><span data-slate-string="true">，都可以得到这个 Pod 的名字 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13670"><span data-slate-object="text" data-key="13671"><span data-slate-leaf="true" data-offset-key="13671:0" data-first-offset="true"><span data-slate-string="true">redis-sts-0</span></span></span></span><span data-slate-object="text" data-key="13672"><span data-slate-leaf="true" data-offset-key="13672:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13673"><span data-slate-object="text" data-key="13674"><span data-slate-leaf="true" data-offset-key="13674:0" data-first-offset="true"><span data-slate-string="true">有了这个唯一的名字，应用就可以自行决定依赖关系了，比如在这个 Redis 例子里，就可以让先启动的 0 号 Pod 是主实例，后启动的 1 号 Pod 是从实例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13675"><span data-slate-object="text" data-key="13676"><span data-slate-leaf="true" data-offset-key="13676:0" data-first-offset="true"><span data-slate-string="true">解决了启动顺序和依赖关系，还剩下</span></span></span><span data-slate-object="text" data-key="13677"><span data-slate-leaf="true" data-offset-key="13677:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第三个问题：网络标识，这就需要用到 Service 对象</span></span></span></span><span data-slate-object="text" data-key="13678"><span data-slate-leaf="true" data-offset-key="13678:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13679"><span data-slate-object="text" data-key="13680"><span data-slate-leaf="true" data-offset-key="13680:0" data-first-offset="true"><span data-slate-string="true">不过这里又有一点奇怪的地方，我们不能用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13681"><span data-slate-object="text" data-key="13682"><span data-slate-leaf="true" data-offset-key="13682:0" data-first-offset="true"><span data-slate-string="true">kubectl expose</span></span></span></span><span data-slate-object="text" data-key="13683"><span data-slate-leaf="true" data-offset-key="13683:0" data-first-offset="true"><span data-slate-string="true"> 直接为 StatefulSet 生成 Service，只能手动编写 YAML。但是这肯定难不倒你，经过了这么多练习，现在你应该能很轻松地写出一个 Service 对象。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13684"><span data-slate-object="text" data-key="13685"><span data-slate-leaf="true" data-offset-key="13685:0" data-first-offset="true"><span data-slate-string="true">因为不能自动生成，你在写 Service 对象的时候要小心一些，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13686"><span data-slate-object="text" data-key="13687"><span data-slate-leaf="true" data-offset-key="13687:0" data-first-offset="true"><span data-slate-string="true">metadata.name</span></span></span></span><span data-slate-object="text" data-key="13688"><span data-slate-leaf="true" data-offset-key="13688:0" data-first-offset="true"><span data-slate-string="true"> 必须和 StatefulSet 里的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13689"><span data-slate-object="text" data-key="13690"><span data-slate-leaf="true" data-offset-key="13690:0" data-first-offset="true"><span data-slate-string="true">serviceName</span></span></span></span><span data-slate-object="text" data-key="13691"><span data-slate-leaf="true" data-offset-key="13691:0" data-first-offset="true"><span data-slate-string="true"> 相同，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13692"><span data-slate-object="text" data-key="13693"><span data-slate-leaf="true" data-offset-key="13693:0" data-first-offset="true"><span data-slate-string="true">selector</span></span></span></span><span data-slate-object="text" data-key="13694"><span data-slate-leaf="true" data-offset-key="13694:0" data-first-offset="true"><span data-slate-string="true"> 里的标签也必须和 StatefulSet 里的一致：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="13695"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13696"><span data-slate-object="text" data-key="13697"><span data-slate-leaf="true" data-offset-key="13697:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13698"><span data-slate-object="text" data-key="13699"><span data-slate-leaf="true" data-offset-key="13699:0" data-first-offset="true"><span data-slate-string="true">kind: Service</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13700"><span data-slate-object="text" data-key="13701"><span data-slate-leaf="true" data-offset-key="13701:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13702"><span data-slate-object="text" data-key="13703"><span data-slate-leaf="true" data-offset-key="13703:0" data-first-offset="true"><span data-slate-string="true">  name: redis-svc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13704"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13705"><span data-slate-object="text" data-key="13706"><span data-slate-leaf="true" data-offset-key="13706:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13707"><span data-slate-object="text" data-key="13708"><span data-slate-leaf="true" data-offset-key="13708:0" data-first-offset="true"><span data-slate-string="true">  selector:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13709"><span data-slate-object="text" data-key="13710"><span data-slate-leaf="true" data-offset-key="13710:0" data-first-offset="true"><span data-slate-string="true">    app: redis-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13711"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13712"><span data-slate-object="text" data-key="13713"><span data-slate-leaf="true" data-offset-key="13713:0" data-first-offset="true"><span data-slate-string="true">  ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13714"><span data-slate-object="text" data-key="13715"><span data-slate-leaf="true" data-offset-key="13715:0" data-first-offset="true"><span data-slate-string="true">  - port: 6379</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13716"><span data-slate-object="text" data-key="13717"><span data-slate-leaf="true" data-offset-key="13717:0" data-first-offset="true"><span data-slate-string="true">    protocol: TCP</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13718"><span data-slate-object="text" data-key="13719"><span data-slate-leaf="true" data-offset-key="13719:0" data-first-offset="true"><span data-slate-string="true">    targetPort: 6379</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13720"><span data-slate-object="text" data-key="13721"><span data-slate-leaf="true" data-offset-key="13721:0" data-first-offset="true"><span data-slate-string="true">写好 Service 之后，还是用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13722"><span data-slate-object="text" data-key="13723"><span data-slate-leaf="true" data-offset-key="13723:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="13724"><span data-slate-leaf="true" data-offset-key="13724:0" data-first-offset="true"><span data-slate-string="true"> 创建这个对象：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13725"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/5f/c8/5f8e4dbedaa563801bb6bbe09c441dc8.png?wh=1584x1056"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13726"><span data-slate-object="text" data-key="13727"><span data-slate-leaf="true" data-offset-key="13727:0" data-first-offset="true"><span data-slate-string="true">可以看到这个 Service 并没有什么特殊的地方，也是用标签选择器找到 StatefulSet 管理的两个 Pod，然后找到它们的 IP 地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13728"><span data-slate-object="text" data-key="13729"><span data-slate-leaf="true" data-offset-key="13729:0" data-first-offset="true"><span data-slate-string="true">不过，StatefulSet 的奥秘就在它的域名上。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13730"><span data-slate-object="text" data-key="13731"><span data-slate-leaf="true" data-offset-key="13731:0" data-first-offset="true"><span data-slate-string="true">还记得在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13732"><span data-slate-object="text" data-key="13733"><span data-slate-leaf="true" data-offset-key="13733:0" data-first-offset="true"><span data-slate-string="true">第 20 讲</span></span></span></a><span data-slate-object="text" data-key="13734"><span data-slate-leaf="true" data-offset-key="13734:0" data-first-offset="true"><span data-slate-string="true">里我们说过的 Service 的域名用法吗？Service 自己会有一个域名，格式是 “</span></span></span><span data-slate-object="text" data-key="13735"><span data-slate-leaf="true" data-offset-key="13735:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对象名。名字空间</span></span></span></span><span data-slate-object="text" data-key="13736"><span data-slate-leaf="true" data-offset-key="13736:0" data-first-offset="true"><span data-slate-string="true">”，每个 Pod 也会有一个域名，形式是 “</span></span></span><span data-slate-object="text" data-key="13737"><span data-slate-leaf="true" data-offset-key="13737:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">IP 地址。名字空间</span></span></span></span><span data-slate-object="text" data-key="13738"><span data-slate-leaf="true" data-offset-key="13738:0" data-first-offset="true"><span data-slate-string="true">”。但因为 IP 地址不稳定，所以 Pod 的域名并不实用，一般我们会使用稳定的 Service 域名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13739"><span data-slate-object="text" data-key="13740"><span data-slate-leaf="true" data-offset-key="13740:0" data-first-offset="true"><span data-slate-string="true">当我们把 Service 对象应用于 StatefulSet 的时候，情况就不一样了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13741"><span data-slate-object="text" data-key="13742"><span data-slate-leaf="true" data-offset-key="13742:0" data-first-offset="true"><span data-slate-string="true">Service 发现这些 Pod 不是一般的应用，而是有状态应用，需要有稳定的网络标识，所以就会为 Pod 再多创建出一个新的域名，格式是 “</span></span></span><span data-slate-object="text" data-key="13743"><span data-slate-leaf="true" data-offset-key="13743:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Pod 名。服务名。名字空间. svc.cluster.local</span></span></span></span><span data-slate-object="text" data-key="13744"><span data-slate-leaf="true" data-offset-key="13744:0" data-first-offset="true"><span data-slate-string="true">”。当然，这个域名也可以简写成 “</span></span></span><span data-slate-object="text" data-key="13745"><span data-slate-leaf="true" data-offset-key="13745:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Pod 名。服务名</span></span></span></span><span data-slate-object="text" data-key="13746"><span data-slate-leaf="true" data-offset-key="13746:0" data-first-offset="true"><span data-slate-string="true">”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13747"><span data-slate-object="text" data-key="13748"><span data-slate-leaf="true" data-offset-key="13748:0" data-first-offset="true"><span data-slate-string="true">我们还是用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13749"><span data-slate-object="text" data-key="13750"><span data-slate-leaf="true" data-offset-key="13750:0" data-first-offset="true"><span data-slate-string="true">kubectl exec</span></span></span></span><span data-slate-object="text" data-key="13751"><span data-slate-leaf="true" data-offset-key="13751:0" data-first-offset="true"><span data-slate-string="true"> 进入 Pod 内部，用 ping 命令来验证一下：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="13752"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13753"><span data-slate-object="text" data-key="13754"><span data-slate-leaf="true" data-offset-key="13754:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13755"><span data-slate-leaf="true" data-offset-key="13755:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="13756"><span data-slate-leaf="true" data-offset-key="13756:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13757"><span data-slate-leaf="true" data-offset-key="13757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13758"><span data-slate-leaf="true" data-offset-key="13758:0" data-first-offset="true"><span data-slate-string="true">it redis</span></span></span><span data-slate-object="text" data-key="13759"><span data-slate-leaf="true" data-offset-key="13759:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13760"><span data-slate-leaf="true" data-offset-key="13760:0" data-first-offset="true"><span data-slate-string="true">sts</span></span></span><span data-slate-object="text" data-key="13761"><span data-slate-leaf="true" data-offset-key="13761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-0</span></span></span></span><span data-slate-object="text" data-key="13762"><span data-slate-leaf="true" data-offset-key="13762:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13763"><span data-slate-leaf="true" data-offset-key="13763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-- sh</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="13764"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f1/39/f1b058b5fb3e5218c638ca0534b92439.png?wh=1524x1338"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13765"><span data-slate-object="text" data-key="13766"><span data-slate-leaf="true" data-offset-key="13766:0" data-first-offset="true"><span data-slate-string="true">显然，在 StatefulSet 里的这两个 Pod 都有了各自的域名，也就是稳定的网络标识。那么接下来，外部的客户端只要知道了 StatefulSet 对象，就可以用固定的编号去访问某个具体的实例了，虽然 Pod 的 IP 地址可能会变，但这个有编号的域名由 Service 对象维护，是稳定不变的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13767"><span data-slate-object="text" data-key="13768"><span data-slate-leaf="true" data-offset-key="13768:0" data-first-offset="true"><span data-slate-string="true">到这里，通过 StatefulSet 和 Service 的联合使用，Kubernetes 就解决了 “有状态应用” 的依赖关系、启动顺序和网络标识这三个问题，剩下的多实例之间内部沟通协调等事情就需要应用自己去想办法处理了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13769"><span data-slate-object="text" data-key="13770"><span data-slate-leaf="true" data-offset-key="13770:0" data-first-offset="true"><span data-slate-string="true">关于 Service，有一点值得再多提一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13771"><span data-slate-object="text" data-key="13772"><span data-slate-leaf="true" data-offset-key="13772:0" data-first-offset="true"><span data-slate-string="true">Service 原本的目的是负载均衡，应该由它在 Pod 前面来转发流量，但是对 StatefulSet 来说，这项功能反而是不必要的，因为 Pod 已经有了稳定的域名，外界访问服务就不应该再通过 Service 这一层了。所以，从安全和节约系统资源的角度考虑，</span></span></span><span data-slate-object="text" data-key="13773"><span data-slate-leaf="true" data-offset-key="13773:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">我们可以在 Service 里添加一个字段 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13774"><span data-slate-object="text" data-key="13775"><span data-slate-leaf="true" data-offset-key="13775:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">clusterIP: None</span></span></span></span></span><span data-slate-object="text" data-key="13776"><span data-slate-leaf="true" data-offset-key="13776:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> ，告诉 Kubernetes 不必再为这个对象分配 IP 地址</span></span></span></span><span data-slate-object="text" data-key="13777"><span data-slate-leaf="true" data-offset-key="13777:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13778"><span data-slate-object="text" data-key="13779"><span data-slate-leaf="true" data-offset-key="13779:0" data-first-offset="true"><span data-slate-string="true">我画了一张图展示 StatefulSet 与 Service 对象的关系，你可以参考一下它们字段之间的互相引用：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13780"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/49/22/490d814cf0f25db56537a20f3af57e22.jpg?wh=1920x1094"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13781" id="sr-toc-4"><span data-slate-object="text" data-key="13782"><span data-slate-leaf="true" data-offset-key="13782:0" data-first-offset="true"><span data-slate-string="true">如何实现 StatefulSet 的数据持久化</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13783"><span data-slate-object="text" data-key="13784"><span data-slate-leaf="true" data-offset-key="13784:0" data-first-offset="true"><span data-slate-string="true">现在 StatefulSet 已经有了固定的名字、启动顺序和网络标识，只要再给它加上数据持久化功能，我们就可以实现对 “有状态应用” 的管理了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13785"><span data-slate-object="text" data-key="13786"><span data-slate-leaf="true" data-offset-key="13786:0" data-first-offset="true"><span data-slate-string="true">这里就能用到上一节课里学的 PersistentVolume 和 NFS 的知识，我们可以很容易地定义 StorageClass，然后编写 PVC，再给 Pod 挂载 Volume。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13787"><span data-slate-object="text" data-key="13788"><span data-slate-leaf="true" data-offset-key="13788:0" data-first-offset="true"><span data-slate-string="true">不过，为了强调持久化存储与 StatefulSet 的一对一绑定关系，Kubernetes 为 StatefulSet 专门定义了一个字段 “</span></span></span><span data-slate-object="text" data-key="13789"><span data-slate-leaf="true" data-offset-key="13789:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">volumeClaimTemplates</span></span></span></span><span data-slate-object="text" data-key="13790"><span data-slate-leaf="true" data-offset-key="13790:0" data-first-offset="true"><span data-slate-string="true">”，直接把 PVC 定义嵌入 StatefulSet 的 YAML 文件里。这样能保证创建 StatefulSet 的同时，就会为每个 Pod 自动创建 PVC，让 StatefulSet 的可用性更高。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13791"><span data-slate-object="text" data-key="13792"><span data-slate-leaf="true" data-offset-key="13792:0" data-first-offset="true"><span data-slate-string="true">“</span></span></span><span data-slate-object="text" data-key="13793"><span data-slate-leaf="true" data-offset-key="13793:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">volumeClaimTemplates</span></span></span></span><span data-slate-object="text" data-key="13794"><span data-slate-leaf="true" data-offset-key="13794:0" data-first-offset="true"><span data-slate-string="true">” 这个字段好像有点难以理解，你可以把它和 Pod 的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13795"><span data-slate-object="text" data-key="13796"><span data-slate-leaf="true" data-offset-key="13796:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="13797"><span data-slate-leaf="true" data-offset-key="13797:0" data-first-offset="true"><span data-slate-string="true">、Job 的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13798"><span data-slate-object="text" data-key="13799"><span data-slate-leaf="true" data-offset-key="13799:0" data-first-offset="true"><span data-slate-string="true">jobTemplate</span></span></span></span><span data-slate-object="text" data-key="13800"><span data-slate-leaf="true" data-offset-key="13800:0" data-first-offset="true"><span data-slate-string="true"> 对比起来学习，它其实也是一个 “套娃” 的对象组合结构，里面就是应用了 StorageClass 的普通 PVC 而已。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13801"><span data-slate-object="text" data-key="13802"><span data-slate-leaf="true" data-offset-key="13802:0" data-first-offset="true"><span data-slate-string="true">让我们把刚才的 Redis StatefulSet 对象稍微改造一下，加上持久化存储功能：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="13803"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13804"><span data-slate-object="text" data-key="13805"><span data-slate-leaf="true" data-offset-key="13805:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13806"><span data-slate-object="text" data-key="13807"><span data-slate-leaf="true" data-offset-key="13807:0" data-first-offset="true"><span data-slate-string="true">kind: StatefulSet</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13808"><span data-slate-object="text" data-key="13809"><span data-slate-leaf="true" data-offset-key="13809:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13810"><span data-slate-object="text" data-key="13811"><span data-slate-leaf="true" data-offset-key="13811:0" data-first-offset="true"><span data-slate-string="true">  name: redis-pv-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13812"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13813"><span data-slate-object="text" data-key="13814"><span data-slate-leaf="true" data-offset-key="13814:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13815"><span data-slate-object="text" data-key="13816"><span data-slate-leaf="true" data-offset-key="13816:0" data-first-offset="true"><span data-slate-string="true">  serviceName: redis-pv-svc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13817"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13818"><span data-slate-object="text" data-key="13819"><span data-slate-leaf="true" data-offset-key="13819:0" data-first-offset="true"><span data-slate-string="true">  volumeClaimTemplates:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13820"><span data-slate-object="text" data-key="13821"><span data-slate-leaf="true" data-offset-key="13821:0" data-first-offset="true"><span data-slate-string="true">  - metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13822"><span data-slate-object="text" data-key="13823"><span data-slate-leaf="true" data-offset-key="13823:0" data-first-offset="true"><span data-slate-string="true">      name: redis-100m-pvc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13824"><span data-slate-object="text" data-key="13825"><span data-slate-leaf="true" data-offset-key="13825:0" data-first-offset="true"><span data-slate-string="true">    spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13826"><span data-slate-object="text" data-key="13827"><span data-slate-leaf="true" data-offset-key="13827:0" data-first-offset="true"><span data-slate-string="true">      storageClassName: nfs-client</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13828"><span data-slate-object="text" data-key="13829"><span data-slate-leaf="true" data-offset-key="13829:0" data-first-offset="true"><span data-slate-string="true">      accessModes:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13830"><span data-slate-object="text" data-key="13831"><span data-slate-leaf="true" data-offset-key="13831:0" data-first-offset="true"><span data-slate-string="true">        - ReadWriteMany</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13832"><span data-slate-object="text" data-key="13833"><span data-slate-leaf="true" data-offset-key="13833:0" data-first-offset="true"><span data-slate-string="true">      resources:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13834"><span data-slate-object="text" data-key="13835"><span data-slate-leaf="true" data-offset-key="13835:0" data-first-offset="true"><span data-slate-string="true">        requests:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13836"><span data-slate-object="text" data-key="13837"><span data-slate-leaf="true" data-offset-key="13837:0" data-first-offset="true"><span data-slate-string="true">          storage: 100Mi</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13838"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13839"><span data-slate-object="text" data-key="13840"><span data-slate-leaf="true" data-offset-key="13840:0" data-first-offset="true"><span data-slate-string="true">  replicas: 2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13841"><span data-slate-object="text" data-key="13842"><span data-slate-leaf="true" data-offset-key="13842:0" data-first-offset="true"><span data-slate-string="true">  selector:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13843"><span data-slate-object="text" data-key="13844"><span data-slate-leaf="true" data-offset-key="13844:0" data-first-offset="true"><span data-slate-string="true">    matchLabels:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13845"><span data-slate-object="text" data-key="13846"><span data-slate-leaf="true" data-offset-key="13846:0" data-first-offset="true"><span data-slate-string="true">      app: redis-pv-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13847"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13848"><span data-slate-object="text" data-key="13849"><span data-slate-leaf="true" data-offset-key="13849:0" data-first-offset="true"><span data-slate-string="true">  template:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13850"><span data-slate-object="text" data-key="13851"><span data-slate-leaf="true" data-offset-key="13851:0" data-first-offset="true"><span data-slate-string="true">    metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13852"><span data-slate-object="text" data-key="13853"><span data-slate-leaf="true" data-offset-key="13853:0" data-first-offset="true"><span data-slate-string="true">      labels:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13854"><span data-slate-object="text" data-key="13855"><span data-slate-leaf="true" data-offset-key="13855:0" data-first-offset="true"><span data-slate-string="true">        app: redis-pv-sts</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13856"><span data-slate-object="text" data-key="13857"><span data-slate-leaf="true" data-offset-key="13857:0" data-first-offset="true"><span data-slate-string="true">    spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13858"><span data-slate-object="text" data-key="13859"><span data-slate-leaf="true" data-offset-key="13859:0" data-first-offset="true"><span data-slate-string="true">      containers:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13860"><span data-slate-object="text" data-key="13861"><span data-slate-leaf="true" data-offset-key="13861:0" data-first-offset="true"><span data-slate-string="true">      - image: redis:5-alpine</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13862"><span data-slate-object="text" data-key="13863"><span data-slate-leaf="true" data-offset-key="13863:0" data-first-offset="true"><span data-slate-string="true">        name: redis</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13864"><span data-slate-object="text" data-key="13865"><span data-slate-leaf="true" data-offset-key="13865:0" data-first-offset="true"><span data-slate-string="true">        ports:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13866"><span data-slate-object="text" data-key="13867"><span data-slate-leaf="true" data-offset-key="13867:0" data-first-offset="true"><span data-slate-string="true">        - containerPort: 6379</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13868"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13869"><span data-slate-object="text" data-key="13870"><span data-slate-leaf="true" data-offset-key="13870:0" data-first-offset="true"><span data-slate-string="true">        volumeMounts:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13871"><span data-slate-object="text" data-key="13872"><span data-slate-leaf="true" data-offset-key="13872:0" data-first-offset="true"><span data-slate-string="true">        - name: redis-100m-pvc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13873"><span data-slate-object="text" data-key="13874"><span data-slate-leaf="true" data-offset-key="13874:0" data-first-offset="true"><span data-slate-string="true">          mountPath: /data</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13875"><span data-slate-object="text" data-key="13876"><span data-slate-leaf="true" data-offset-key="13876:0" data-first-offset="true"><span data-slate-string="true">这个 YAML 文件比较长，内容比较多，不过你只要有点耐心，分功能模块逐个去看也能很快看明白。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13877"><span data-slate-object="text" data-key="13878"><span data-slate-leaf="true" data-offset-key="13878:0" data-first-offset="true"><span data-slate-string="true">首先 StatefulSet 对象的名字是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13879"><span data-slate-object="text" data-key="13880"><span data-slate-leaf="true" data-offset-key="13880:0" data-first-offset="true"><span data-slate-string="true">redis-pv-sts</span></span></span></span><span data-slate-object="text" data-key="13881"><span data-slate-leaf="true" data-offset-key="13881:0" data-first-offset="true"><span data-slate-string="true">，表示它使用了 PV 存储。然后 “volumeClaimTemplates” 里定义了一个 PVC，名字是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13882"><span data-slate-object="text" data-key="13883"><span data-slate-leaf="true" data-offset-key="13883:0" data-first-offset="true"><span data-slate-string="true">redis-100m-pvc</span></span></span></span><span data-slate-object="text" data-key="13884"><span data-slate-leaf="true" data-offset-key="13884:0" data-first-offset="true"><span data-slate-string="true">，申请了 100MB 的 NFS 存储。在 Pod 模板里用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13885"><span data-slate-object="text" data-key="13886"><span data-slate-leaf="true" data-offset-key="13886:0" data-first-offset="true"><span data-slate-string="true">volumeMounts</span></span></span></span><span data-slate-object="text" data-key="13887"><span data-slate-leaf="true" data-offset-key="13887:0" data-first-offset="true"><span data-slate-string="true"> 引用了这个 PVC，把网盘挂载到了 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13888"><span data-slate-object="text" data-key="13889"><span data-slate-leaf="true" data-offset-key="13889:0" data-first-offset="true"><span data-slate-string="true">/data</span></span></span></span><span data-slate-object="text" data-key="13890"><span data-slate-leaf="true" data-offset-key="13890:0" data-first-offset="true"><span data-slate-string="true"> 目录，也就是 Redis 的数据目录。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13891"><span data-slate-object="text" data-key="13892"><span data-slate-leaf="true" data-offset-key="13892:0" data-first-offset="true"><span data-slate-string="true">下面的这张图就是这个 StatefulSet 对象完整的关系图：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13893"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1a/0f/1a06987c87f3db948b591883a81bac0f.jpg?wh=4000x2946"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13894"><span data-slate-object="text" data-key="13895"><span data-slate-leaf="true" data-offset-key="13895:0" data-first-offset="true"><span data-slate-string="true">最后使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13896"><span data-slate-object="text" data-key="13897"><span data-slate-leaf="true" data-offset-key="13897:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="13898"><span data-slate-leaf="true" data-offset-key="13898:0" data-first-offset="true"><span data-slate-string="true"> 创建这些对象，一个带持久化功能的 “有状态应用” 就算是运行起来了：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="13899"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13900"><span data-slate-object="text" data-key="13901"><span data-slate-leaf="true" data-offset-key="13901:0" data-first-offset="true"><span data-slate-string="true">kubectl apply -f redis-pv-sts.yml</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13902"><span data-slate-object="text" data-key="13903"><span data-slate-leaf="true" data-offset-key="13903:0" data-first-offset="true"><span data-slate-string="true">你可以使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13904"><span data-slate-object="text" data-key="13905"><span data-slate-leaf="true" data-offset-key="13905:0" data-first-offset="true"><span data-slate-string="true">kubectl get pvc</span></span></span></span><span data-slate-object="text" data-key="13906"><span data-slate-leaf="true" data-offset-key="13906:0" data-first-offset="true"><span data-slate-string="true"> 来查看 StatefulSet 关联的存储卷状态：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13907"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/33/f5/33eee3c5a5033e4bf73f5003669c4ff5.png?wh=1920x189"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13908"><span data-slate-object="text" data-key="13909"><span data-slate-leaf="true" data-offset-key="13909:0" data-first-offset="true"><span data-slate-string="true">看这两个 PVC 的命名，不是随机的，是有规律的，用的是 PVC 名字加上 StatefulSet 的名字组合而成，所以即使 Pod 被销毁，因为它的名字不变，还能够找到这个 PVC，再次绑定使用之前存储的数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13910"><span data-slate-object="text" data-key="13911"><span data-slate-leaf="true" data-offset-key="13911:0" data-first-offset="true"><span data-slate-string="true">那我们就来实地验证一下吧，用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13912"><span data-slate-object="text" data-key="13913"><span data-slate-leaf="true" data-offset-key="13913:0" data-first-offset="true"><span data-slate-string="true">kubectl exec</span></span></span></span><span data-slate-object="text" data-key="13914"><span data-slate-leaf="true" data-offset-key="13914:0" data-first-offset="true"><span data-slate-string="true"> 运行 Redis 的客户端，在里面添加一些 KV 数据：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="13915"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13916"><span data-slate-object="text" data-key="13917"><span data-slate-leaf="true" data-offset-key="13917:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13918"><span data-slate-leaf="true" data-offset-key="13918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="13919"><span data-slate-leaf="true" data-offset-key="13919:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13920"><span data-slate-leaf="true" data-offset-key="13920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13921"><span data-slate-leaf="true" data-offset-key="13921:0" data-first-offset="true"><span data-slate-string="true">it redis</span></span></span><span data-slate-object="text" data-key="13922"><span data-slate-leaf="true" data-offset-key="13922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13923"><span data-slate-leaf="true" data-offset-key="13923:0" data-first-offset="true"><span data-slate-string="true">pv</span></span></span><span data-slate-object="text" data-key="13924"><span data-slate-leaf="true" data-offset-key="13924:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13925"><span data-slate-leaf="true" data-offset-key="13925:0" data-first-offset="true"><span data-slate-string="true">sts</span></span></span><span data-slate-object="text" data-key="13926"><span data-slate-leaf="true" data-offset-key="13926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-0</span></span></span></span><span data-slate-object="text" data-key="13927"><span data-slate-leaf="true" data-offset-key="13927:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13928"><span data-slate-leaf="true" data-offset-key="13928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-- redis-cli</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="13929"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/b7/94a96b1b8a000dcd852d2ea11yy8ddb7.png?wh=1562x530"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13930"><span data-slate-object="text" data-key="13931"><span data-slate-leaf="true" data-offset-key="13931:0" data-first-offset="true"><span data-slate-string="true">这里我设置了两个值，分别是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13932"><span data-slate-object="text" data-key="13933"><span data-slate-leaf="true" data-offset-key="13933:0" data-first-offset="true"><span data-slate-string="true">a=111</span></span></span></span><span data-slate-object="text" data-key="13934"><span data-slate-leaf="true" data-offset-key="13934:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13935"><span data-slate-object="text" data-key="13936"><span data-slate-leaf="true" data-offset-key="13936:0" data-first-offset="true"><span data-slate-string="true">b=222</span></span></span></span><span data-slate-object="text" data-key="13937"><span data-slate-leaf="true" data-offset-key="13937:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13938"><span data-slate-object="text" data-key="13939"><span data-slate-leaf="true" data-offset-key="13939:0" data-first-offset="true"><span data-slate-string="true">现在我们模拟意外事故，删除这个 Pod：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="13940"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13941"><span data-slate-object="text" data-key="13942"><span data-slate-leaf="true" data-offset-key="13942:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13943"><span data-slate-leaf="true" data-offset-key="13943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">delete</span></span></span></span><span data-slate-object="text" data-key="13944"><span data-slate-leaf="true" data-offset-key="13944:0" data-first-offset="true"><span data-slate-string="true"> pod redis-pv-sts-</span></span></span><span data-slate-object="text" data-key="13945"><span data-slate-leaf="true" data-offset-key="13945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13946"><span data-slate-object="text" data-key="13947"><span data-slate-leaf="true" data-offset-key="13947:0" data-first-offset="true"><span data-slate-string="true">由于 StatefulSet 和 Deployment 一样会监控 Pod 的实例，发现 Pod 数量少了就会很快创建出新的 Pod，并且名字、网络标识也都会和之前的 Pod 一模一样：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13948"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/52/23/52e2f02a1d80d8bba2a42c8258cda923.png?wh=1300x236"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13949"><span data-slate-object="text" data-key="13950"><span data-slate-leaf="true" data-offset-key="13950:0" data-first-offset="true"><span data-slate-string="true">那 Redis 里存储的数据怎么样了呢？是不是真的用到了持久化存储，也完全恢复了呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13951"><span data-slate-object="text" data-key="13952"><span data-slate-leaf="true" data-offset-key="13952:0" data-first-offset="true"><span data-slate-string="true">你可以再用 Redis 客户端登录去检查一下：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="13953"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13954"><span data-slate-object="text" data-key="13955"><span data-slate-leaf="true" data-offset-key="13955:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="13956"><span data-slate-leaf="true" data-offset-key="13956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="13957"><span data-slate-leaf="true" data-offset-key="13957:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13958"><span data-slate-leaf="true" data-offset-key="13958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13959"><span data-slate-leaf="true" data-offset-key="13959:0" data-first-offset="true"><span data-slate-string="true">it redis</span></span></span><span data-slate-object="text" data-key="13960"><span data-slate-leaf="true" data-offset-key="13960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13961"><span data-slate-leaf="true" data-offset-key="13961:0" data-first-offset="true"><span data-slate-string="true">pv</span></span></span><span data-slate-object="text" data-key="13962"><span data-slate-leaf="true" data-offset-key="13962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="13963"><span data-slate-leaf="true" data-offset-key="13963:0" data-first-offset="true"><span data-slate-string="true">sts</span></span></span><span data-slate-object="text" data-key="13964"><span data-slate-leaf="true" data-offset-key="13964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-0</span></span></span></span><span data-slate-object="text" data-key="13965"><span data-slate-leaf="true" data-offset-key="13965:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13966"><span data-slate-leaf="true" data-offset-key="13966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-- redis-cli</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="13967"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/c7/08/c78ca845ee20459dd2d8bayy3db71808.png?wh=1544x530"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13968"><span data-slate-object="text" data-key="13969"><span data-slate-leaf="true" data-offset-key="13969:0" data-first-offset="true"><span data-slate-string="true">因为我们把 NFS 网络存储挂载到了 Pod 的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13970"><span data-slate-object="text" data-key="13971"><span data-slate-leaf="true" data-offset-key="13971:0" data-first-offset="true"><span data-slate-string="true">/data</span></span></span></span><span data-slate-object="text" data-key="13972"><span data-slate-leaf="true" data-offset-key="13972:0" data-first-offset="true"><span data-slate-string="true"> 目录，Redis 就会定期把数据落盘保存，所以新创建的 Pod 再次挂载目录的时候会从备份文件里恢复数据，内存里的数据就恢复原状了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13973" id="sr-toc-5"><span data-slate-object="text" data-key="13974"><span data-slate-leaf="true" data-offset-key="13974:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13975"><span data-slate-object="text" data-key="13976"><span data-slate-leaf="true" data-offset-key="13976:0" data-first-offset="true"><span data-slate-string="true">好了，今天我们学习了专门部署 “有状态应用” 的 API 对象 StatefulSet，它与 Deployment 非常相似，区别是由它管理的 Pod 会有固定的名字、启动顺序和网络标识，这些特性对于在集群里实施有主从、主备等关系的应用非常重要。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13977"><span data-slate-object="text" data-key="13978"><span data-slate-leaf="true" data-offset-key="13978:0" data-first-offset="true"><span data-slate-string="true">我再简单小结一下今天的内容：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13979"><div data-slate-type="list-line" data-slate-object="block" data-key="13980"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="13981"><span data-slate-leaf="true" data-offset-key="13981:0" data-first-offset="true"><span data-slate-string="true">StatefulSet 的 YAML 描述和 Deployment 几乎完全相同，只是多了一个关键字段 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13982"><span data-slate-object="text" data-key="13983"><span data-slate-leaf="true" data-offset-key="13983:0" data-first-offset="true"><span data-slate-string="true">serviceName</span></span></span></span><span data-slate-object="text" data-key="13984"><span data-slate-leaf="true" data-offset-key="13984:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="13985"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="13986"><span data-slate-leaf="true" data-offset-key="13986:0" data-first-offset="true"><span data-slate-string="true">要为 StatefulSet 里的 Pod 生成稳定的域名，需要定义 Service 对象，它的名字必须和 StatefulSet 里的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13987"><span data-slate-object="text" data-key="13988"><span data-slate-leaf="true" data-offset-key="13988:0" data-first-offset="true"><span data-slate-string="true">serviceName</span></span></span></span><span data-slate-object="text" data-key="13989"><span data-slate-leaf="true" data-offset-key="13989:0" data-first-offset="true"><span data-slate-string="true"> 一致。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="13990"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="13991"><span data-slate-leaf="true" data-offset-key="13991:0" data-first-offset="true"><span data-slate-string="true">访问 StatefulSet 应该使用每个 Pod 的单独域名，形式是 “Pod 名。服务名”，不应该使用 Service 的负载均衡功能。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="13992"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="13993"><span data-slate-leaf="true" data-offset-key="13993:0" data-first-offset="true"><span data-slate-string="true">在 StatefulSet 里可以用字段 “volumeClaimTemplates” 直接定义 PVC，让 Pod 实现数据持久化存储。</span></span></span></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13994" id="sr-toc-6"><span data-slate-object="text" data-key="13995"><span data-slate-leaf="true" data-offset-key="13995:0" data-first-offset="true"><span data-slate-string="true">课下作业</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13996"><span data-slate-object="text" data-key="13997"><span data-slate-leaf="true" data-offset-key="13997:0" data-first-offset="true"><span data-slate-string="true">最后是课下作业时间，给你留两个思考题：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13998"><div data-slate-type="list-line" data-slate-object="block" data-key="13999"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14000"><span data-slate-leaf="true" data-offset-key="14000:0" data-first-offset="true"><span data-slate-string="true">有了 StatefulSet 提供的固定名字和启动顺序，应用还需要怎么做才能实现主从等依赖关系呢？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="14001"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14002"><span data-slate-leaf="true" data-offset-key="14002:0" data-first-offset="true"><span data-slate-string="true">是否可以不使用 “volumeClaimTemplates” 内嵌定义 PVC 呢？会有什么样的后果呢？</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14003"><span data-slate-object="text" data-key="14004"><span data-slate-leaf="true" data-offset-key="14004:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区参与讨论，分享你的想法。我们下节课再见。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14005"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/88/e5/884a5c91b82cb515c856ce2ece6a91e5.jpg?wh=1920x1544"></div></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/c1/9415076c60e63fc6303d9a3bc900b5c1.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-7">精选留言 (8)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/65/da/29fe3dde.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>小宝</span></div></div><div>“访问 StatefulSet 应该使用每个 Pod 的单独域名，形式是 “Pod 名。服务名”，不应该使用 Service 的负载均衡功能。”
请教老师，通常会在 StatefulSet 上创建一个 Headless Service 吧，作为 pod 的负载均衡。</div><div><p>作者回复: good</p></div><div><div>2022-08-23</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/23/81/3865297c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 龙之大者</span></div></div><div>执行了 redis-pv-sts.yml，生产 pvc 一直是 pending，然后报错如下

persistentvolume-controller  waiting for a volume to be created, either by external provisioner "k8s-sigs.io/nfs-subdir-external-provisioner" or manually created by system administrator</div><div><p>作者回复：看看 nfs 是否工作正常，然后再看看 Provisioner 的状态。</p></div><div><div>2022-09-02</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/2c/7e/f1efd18b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>摊牌</span></div></div><div>有了 StatefulSet 提供的固定名字和启动顺序，应用还需要怎么做才能实现主从等依赖关系呢？

答：我理解是采用 StatefulSet 对象管理多个（2n+1）有状态 pod 的情形下，应该在有状态应用中基于 pod 的固定名字进行实例通信交互，比如 redis 集群中节点之间通过 Gossip 协议进行广播自身的状态信息，从而完成实例之间依赖关系，保证集群的可用性</div><div><p>作者回复: good</p></div><div><div>2022-09-01</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/2c/7e/f1efd18b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>摊牌</span></div></div><div>老师，既然 statefulSet 对象管理的 pod 可以直接通过域名指定来访问，那可不可以 不给 statefulSet 对象创建 service</div><div><p>作者回复：不行，域名必须通过 Service 对象才能实现，可以自己试试没有 Service 对象会怎么样。</p></div><div><div>2022-09-01</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>peter</span></div></div><div>请教老师几个问题：
Q1：怎么查询一个 POD 是通过什么创建的？
用 “delete -f .” 来删除，发现只有最近的通过 YAML 创建的被删除，比如今天上午通过 YAML 创建了两个 POD，用 “delete -f . ” 只删除了刚创建的这个 sts，但以前通过 deploy YAML 创建的 POD 无法删除。为了删除其它 POD, 需要知道这个 POD 是通过什么创建的，请问：用哪个命令可以查看一个 POD 是通过什么创建的？
Q2：应用怎么控制启动顺序？
执行 “kubectl apply -f redis-sts.yml” 以后，两个 POD 被 K8S 启动了，已经启动了，应用还能控制启动顺序吗？
Q3：什么命令可以列出所有创建的对象？
目的是想查看以前创建的对象，各种类型的对象。是否有一个命令可以列出所有创建过得对象？
Q4：怎么判断 console 上安装的 NFS server 是否在运行，或者说怎么判断其状态？ Nfs version 吗？同样，在 client 上，开机后怎么判断 nfs client 状态？（也许开机后自动运行？）</div><div><p>作者回复: 
1. 这个还真不知道，也许只能加强运维管理了吧。

2. 应用不能控制，需要自己编写脚本，判断 hostname 得知自己是第几个启动的。

3. kubectl get all -A

4. 用 showmount 检查，还有 service 等系统管理命令。</p></div><div><div>2022-08-23</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2c/45/44/8df79d3c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>事已至此开始撤退</span></div></div><div>实践看这个，底层原理看张坤</div><div><p>作者回复: good</p></div><div><div>2022-08-23</div><div><div><i></i><span>3</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>YueShi</span></div></div><div>好奇 redis 的主从，哨兵，cluster 都是怎么在 sts 上实现的，打算抽个时间深入的学习一下。

btw，越学习越能理解到 老师讲的 “云原生” 的概念了</div><div><p>作者回复: Redis 的主从部署直接用 StatefulSet 来实现还是很麻烦的，这个可能用 operator 来做会比较简单。</p></div><div><div>2022-08-22</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5e/1c/6b4e6aa5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>K_Library 争四狂魔</span></div></div><div>老师您好。我理解的话 WordPress 实际上也是有状态的服务，它需要安装插件之后产生. php 文件存放在 PV 里面。如果同一个 WordPress 实例两个节点，其中一个节点安装了 WP 插件，另一个节点也要同时变化（装上插件），这样的控制太复杂，所以我觉得 WordPress 是不适合用 Service 来启动多个实例的。
我觉得应该把 WordPress 应该跟背后的 MySQL 定义为同一组 StatefulSet，一旦一个节点挂了，另一个节点可以读取 MySQL 和 WordPress 的文件启动之后恢复之前的状态。
您觉得有没有更好的 WordPress 部署方式？谢谢。</div><div><p>作者回复：我不是很了解 WordPress，如果是如你所说，那么它应该部署成 StatefulSet。</p></div><div><div>2022-08-22</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".2g"><outline class="toc-level-h1" data-reactid=".2g.0" style="width: 175px;"><active data-reactid=".2g.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".2g.0.1"><span data-reactid=".2g.0.1.0">26｜StatefulSet：怎么管理有状态的应用？</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.1" style="width: 165px;"><active data-reactid=".2g.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".2g.1.1"><span data-reactid=".2g.1.1.0">什么是有状态的应用</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.2" style="width: 165px;"><active data-reactid=".2g.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".2g.2.1"><span data-reactid=".2g.2.1.0">如何使用 YAML 描述 StatefulSet</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.3" style="width: 165px;"><active data-reactid=".2g.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".2g.3.1"><span data-reactid=".2g.3.1.0">如何在 Kubernetes 里使用 StatefulSet</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.4" style="width: 165px;"><active data-reactid=".2g.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".2g.4.1"><span data-reactid=".2g.4.1.0">如何实现 StatefulSet 的数据持久化</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.5" style="width: 165px;"><active data-reactid=".2g.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".2g.5.1"><span data-reactid=".2g.5.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.6" style="width: 165px;"><active data-reactid=".2g.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".2g.6.1"><span data-reactid=".2g.6.1.0">课下作业</span></a></outline><outline class="toc-level-h2" data-reactid=".2g.7" style="width: 165px;"><active data-reactid=".2g.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".2g.7.1"><span data-reactid=".2g.7.1.0">精选留言 (8)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/547750" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>