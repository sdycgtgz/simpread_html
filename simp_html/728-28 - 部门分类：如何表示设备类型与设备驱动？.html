
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 28 | 部门分类：如何表示设备类型与设备驱动？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>28 | 部门分类：如何表示设备类型与设备驱动？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">这节课我会带你实现分配和释放内存页面，达到内存管理的目的。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">28 | 部门分类：如何表示设备类型与设备驱动？</h1><div><span>LMOS</span> <span>2021-07-12</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ca/a0/caa13e7b04605e5aa81c8408943bdda0.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：陈晨</span><span>大小：12.19M</span><span> 时长：13:20</span></div></div><audio title="28 | 部门分类：如何表示设备类型与设备驱动？" src="https://res001.geekbang.org/media/audio/a5/83/a5f80c855b6c45901c1147d11a37b183/ld/ld.m3u8" __idm_id__="950283"></audio></div><div><div><div><div data-slate-editor="true" data-key="17423" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="17424"><span data-slate-object="text" data-key="17425"><span data-slate-leaf="true" data-offset-key="17425:0" data-first-offset="true"><span data-slate-string="true">你好，我是 LMOS。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17426"><span data-slate-object="text" data-key="17427"><span data-slate-leaf="true" data-offset-key="17427:0" data-first-offset="true"><span data-slate-string="true">小到公司，大到国家，都有各种下属部门，比如我们国家现在有教育部、科学技术部、外交部，财政部等，这些部门各自负责完成不同的职能工作，如教育部负责教育事业和语言文字工作，科学技术部负责推动解决经济社会发展的重大科技问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17428"><span data-slate-object="text" data-key="17429"><span data-slate-leaf="true" data-offset-key="17429:0" data-first-offset="true"><span data-slate-string="true">既然大道相通，那我们的 Cosmos 中是否也是类似这样的结构呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17430"><span data-slate-object="text" data-key="17431"><span data-slate-leaf="true" data-offset-key="17431:0" data-first-offset="true"><span data-slate-string="true">答案是肯定的，在前面的课中，我们搞定了内存管理和进程管理，它们是内核不可分隔的，但是计算机中还有各种类型的设备需要管理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17432"><span data-slate-object="text" data-key="17433"><span data-slate-leaf="true" data-offset-key="17433:0" data-first-offset="true"><span data-slate-string="true">我们的 Cosmos 也会 “成立各类部门”，用于管理众多设备，一个部门负责一类设备。具体要怎么管理设备呢？你不妨带着这个问题，正式开始今天的学习！</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17434"><span data-slate-object="text" data-key="17435"><span data-slate-leaf="true" data-offset-key="17435:0" data-first-offset="true"><span data-slate-string="true">这节课的代码，你可以从</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17436"><span data-slate-object="text" data-key="17437"><span data-slate-leaf="true" data-offset-key="17437:0" data-first-offset="true"><span data-slate-string="true">这里</span></span></span></a><span data-slate-object="text" data-key="17438"><span data-slate-leaf="true" data-offset-key="17438:0" data-first-offset="true"><span data-slate-string="true">下载。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17439" id="sr-toc-1"><span data-slate-object="text" data-key="17440"><span data-slate-leaf="true" data-offset-key="17440:0" data-first-offset="true"><span data-slate-string="true">计算机的结构</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17441"><span data-slate-object="text" data-key="17442"><span data-slate-leaf="true" data-offset-key="17442:0" data-first-offset="true"><span data-slate-string="true">不知道你是否和我一样，经常把计算机的机箱打开，看看 CPU，看看内存条，看看显卡，看看主板上的各种芯片。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17443"><span data-slate-object="text" data-key="17444"><span data-slate-leaf="true" data-offset-key="17444:0" data-first-offset="true"><span data-slate-string="true">其实，这些芯片并非独立存在，而是以总线为基础连接在一起的，各自完成自己的工作，又能互相打配合，共同实现用户要求的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17445"><span data-slate-object="text" data-key="17446"><span data-slate-leaf="true" data-offset-key="17446:0" data-first-offset="true"><span data-slate-string="true">为了帮你理清它们的连接关系，我为你画了一幅图，如下所示。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="17447"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/2f/4c/2f7697d94bee25d4c036eb4bca16ee4c.jpg?wh=4400x3305"></div><div>计算机结构示意图</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17448"><span data-slate-object="text" data-key="17449"><span data-slate-leaf="true" data-offset-key="17449:0" data-first-offset="true"><span data-slate-string="true">上图是一个典型的桌面系统，你先不用管是物理上怎么样连接的，逻辑上就是这样的。实际可能比图中有更多或者更少的总线。但是总线有层级关系，各种设备通过总线相连。这里我们只需要记住，计算机中有很多种类的设备，脑中有刚才这幅图就行了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17450" id="sr-toc-2"><span data-slate-object="text" data-key="17451"><span data-slate-leaf="true" data-offset-key="17451:0" data-first-offset="true"><span data-slate-string="true">如何管理设备</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17452"><span data-slate-object="text" data-key="17453"><span data-slate-leaf="true" data-offset-key="17453:0" data-first-offset="true"><span data-slate-string="true">在前面的课程中，我们实现了管理内存和进程，其实进程从正面看它是管理应用程序的，反过来看它也是管理 CPU 的，它能使 CPU 的使用率达到最高。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17454"><span data-slate-object="text" data-key="17455"><span data-slate-leaf="true" data-offset-key="17455:0" data-first-offset="true"><span data-slate-string="true">管理内存和管理 CPU 是操作系统最核心的部分，但是这还不够，因为计算机不止有 CPU，还有各种设备。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17456"><span data-slate-object="text" data-key="17457"><span data-slate-leaf="true" data-offset-key="17457:0" data-first-offset="true"><span data-slate-string="true">如果把计算机内部所有的设备和数据都描述成资源，操作系统内核无疑是这些资源的管理者。既然设备也是一种资源，如何高效管理它们，以便提供给应用进程使用和操作，就是操作系统内核的重要任务。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17458" id="sr-toc-3"><span data-slate-object="text" data-key="17459"><span data-slate-leaf="true" data-offset-key="17459:0" data-first-offset="true"><span data-slate-string="true">分权而治</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17460"><span data-slate-object="text" data-key="17461"><span data-slate-leaf="true" data-offset-key="17461:0" data-first-offset="true"><span data-slate-string="true">一个国家之所以有那么多部门，就是要把管理工作分开，专权专职专责，对于操作系统也是一样。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17462"><span data-slate-object="text" data-key="17463"><span data-slate-leaf="true" data-offset-key="17463:0" data-first-offset="true"><span data-slate-string="true">现代计算机早已不限于只处理计算任务，它还可以呈现图像、音频，和远程计算机通信，储存大量数据，以及和用户交互。所以，计算机内部需要处理图像、音频、网络、储存、交互的设备。这从上面的图中也可以看得出来。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17464"><span data-slate-object="text" data-key="17465"><span data-slate-leaf="true" data-offset-key="17465:0" data-first-offset="true"><span data-slate-string="true">操作系统内核要控制这些设备，就要包含每个设备的控制代码。如果操作系统内核被设计为通用可移植的内核，那是相当可怕的。试想一下，这个世界上有如此多的设备，操作系统内核代码得多庞大，越庞大就越危险，因为其中一行代码有问题，整个操作系统就崩溃了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17466"><span data-slate-object="text" data-key="17467"><span data-slate-leaf="true" data-offset-key="17467:0" data-first-offset="true"><span data-slate-string="true">可是仅仅只有这些问题吗？当然不是，我们还要考虑到后面这几点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17468"><span data-slate-object="text" data-key="17469"><span data-slate-leaf="true" data-offset-key="17469:0" data-first-offset="true"><span data-slate-string="true">1. 操作系统内核开发人员，不可能罗列世界上所有的设备，并为其写一套控制代码。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17470"><span data-slate-object="text" data-key="17471"><span data-slate-leaf="true" data-offset-key="17471:0" data-first-offset="true"><span data-slate-string="true">2. 为了商业目的，有很多设备厂商并不愿意公开设备的编程细节。就算内核开发人员想为其写控制代码，实际也不可行。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17472"><span data-slate-object="text" data-key="17473"><span data-slate-leaf="true" data-offset-key="17473:0" data-first-offset="true"><span data-slate-string="true">3. 如果设备更新换代，就要重写设备的控制代码，然后重新编译操作系统内核，这样的话操作很麻烦，操作系统内核开发人员和用户都可能受不了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17474"><span data-slate-object="text" data-key="17475"><span data-slate-leaf="true" data-offset-key="17475:0" data-first-offset="true"><span data-slate-string="true">以上三点，足于证明这种方案根本不可取。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17476"><span data-slate-object="text" data-key="17477"><span data-slate-leaf="true" data-offset-key="17477:0" data-first-offset="true"><span data-slate-string="true">既然操作系统内核无法包含所有的设备控制代码，那就索性不包含，或者只包含最基本、最通用的设备控制代码。这样操作系统内核就可以非常通用，非常精巧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17478"><span data-slate-object="text" data-key="17479"><span data-slate-leaf="true" data-offset-key="17479:0" data-first-offset="true"><span data-slate-string="true">但是要控制设备就必须要有设备的相关控制代码才行，所以我们要把设备控制代码独立出来，与操作系统内核分开、独立开发，设备控制代码可由设备厂商人员开发。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17480"><span data-slate-object="text" data-key="17481"><span data-slate-leaf="true" data-offset-key="17481:0" data-first-offset="true"><span data-slate-string="true">每个设备对应一个设备控制代码模块，操作系统内核要控制哪个设备，就加载相应的设备代码模块，以后不使用这个设备了，就可以删除对应的设备控制代码模块。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17482"><span data-slate-object="text" data-key="17483"><span data-slate-leaf="true" data-offset-key="17483:0" data-first-offset="true"><span data-slate-string="true">这种方式，给操作系统内核带来了</span></span></span><span data-slate-object="text" data-key="17484"><span data-slate-leaf="true" data-offset-key="17484:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">巨大的灵活性</span></span></span></span><span data-slate-object="text" data-key="17485"><span data-slate-leaf="true" data-offset-key="17485:0" data-first-offset="true"><span data-slate-string="true">。设备厂商在发布新设备时，只要随之发布一个与此相关的设备控制代码模块就行了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17486" id="sr-toc-4"><span data-slate-object="text" data-key="17487"><span data-slate-leaf="true" data-offset-key="17487:0" data-first-offset="true"><span data-slate-string="true">设备分类</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17488"><span data-slate-object="text" data-key="17489"><span data-slate-leaf="true" data-offset-key="17489:0" data-first-offset="true"><span data-slate-string="true">要想管理设备，先要对其分门别类，在开始分类之前，你不妨先思考一个问题：操作系统内核所感知的设备，一定要与物理设备一一对应吗？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17490"><span data-slate-object="text" data-key="17491"><span data-slate-leaf="true" data-offset-key="17491:0" data-first-offset="true"><span data-slate-string="true">举个例子，储存设备，其实不管它是机械硬盘，还是 TF 卡，或者是一个设备控制代码模块，它向操作系统内核表明它是储存设备，但它完全有可能分配一块内存空间来储存数据，不必访问真正的储存设备。</span></span></span><span data-slate-object="text" data-key="17492"><span data-slate-leaf="true" data-offset-key="17492:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">所以，操作系统内核所感知的设备，并不需要和物理设备对应，这取决于设备控制代码自身的行为。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17493"><span data-slate-object="text" data-key="17494"><span data-slate-leaf="true" data-offset-key="17494:0" data-first-offset="true"><span data-slate-string="true">操作系统内核所定义的设备，可称为内核设备或者逻辑设备，其实这只是对物理计算平台中几种类型设备的一种抽象。下面，我们在 cosmos/include/knlinc/krldevice_t.h 文件中对设备进行分类定义，代码如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="17495"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17496"><span data-slate-object="text" data-key="17497"><span data-slate-leaf="true" data-offset-key="17497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17498"><span data-slate-leaf="true" data-offset-key="17498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17499"><span data-slate-leaf="true" data-offset-key="17499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> NOT_DEVICE 0               </span></span></span></span><span data-slate-object="text" data-key="17500"><span data-slate-leaf="true" data-offset-key="17500:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 不表示任何设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17501"><span data-slate-object="text" data-key="17502"><span data-slate-leaf="true" data-offset-key="17502:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17503"><span data-slate-leaf="true" data-offset-key="17503:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17504"><span data-slate-leaf="true" data-offset-key="17504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> BRIDGE_DEVICE 4            </span></span></span></span><span data-slate-object="text" data-key="17505"><span data-slate-leaf="true" data-offset-key="17505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 总线桥接器设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17506"><span data-slate-object="text" data-key="17507"><span data-slate-leaf="true" data-offset-key="17507:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17508"><span data-slate-leaf="true" data-offset-key="17508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17509"><span data-slate-leaf="true" data-offset-key="17509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> CPUCORE_DEVICE 5           </span></span></span></span><span data-slate-object="text" data-key="17510"><span data-slate-leaf="true" data-offset-key="17510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//CPU 设备，CPU 也是设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17511"><span data-slate-object="text" data-key="17512"><span data-slate-leaf="true" data-offset-key="17512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17513"><span data-slate-leaf="true" data-offset-key="17513:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17514"><span data-slate-leaf="true" data-offset-key="17514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> RAMCONTER_DEVICE 6        </span></span></span></span><span data-slate-object="text" data-key="17515"><span data-slate-leaf="true" data-offset-key="17515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存控制器设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17516"><span data-slate-object="text" data-key="17517"><span data-slate-leaf="true" data-offset-key="17517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17518"><span data-slate-leaf="true" data-offset-key="17518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17519"><span data-slate-leaf="true" data-offset-key="17519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> RAM_DEVICE 7              </span></span></span></span><span data-slate-object="text" data-key="17520"><span data-slate-leaf="true" data-offset-key="17520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17521"><span data-slate-object="text" data-key="17522"><span data-slate-leaf="true" data-offset-key="17522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17523"><span data-slate-leaf="true" data-offset-key="17523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17524"><span data-slate-leaf="true" data-offset-key="17524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> USBHOSTCONTER_DEVICE 8    </span></span></span></span><span data-slate-object="text" data-key="17525"><span data-slate-leaf="true" data-offset-key="17525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//USB 主控制设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17526"><span data-slate-object="text" data-key="17527"><span data-slate-leaf="true" data-offset-key="17527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17528"><span data-slate-leaf="true" data-offset-key="17528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17529"><span data-slate-leaf="true" data-offset-key="17529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> INTUPTCONTER_DEVICE 9     </span></span></span></span><span data-slate-object="text" data-key="17530"><span data-slate-leaf="true" data-offset-key="17530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 中断控制器设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17531"><span data-slate-object="text" data-key="17532"><span data-slate-leaf="true" data-offset-key="17532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17533"><span data-slate-leaf="true" data-offset-key="17533:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17534"><span data-slate-leaf="true" data-offset-key="17534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> DMA_DEVICE 10             </span></span></span></span><span data-slate-object="text" data-key="17535"><span data-slate-leaf="true" data-offset-key="17535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//DMA 设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17536"><span data-slate-object="text" data-key="17537"><span data-slate-leaf="true" data-offset-key="17537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17538"><span data-slate-leaf="true" data-offset-key="17538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17539"><span data-slate-leaf="true" data-offset-key="17539:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> CLOCKPOWER_DEVICE 11      </span></span></span></span><span data-slate-object="text" data-key="17540"><span data-slate-leaf="true" data-offset-key="17540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 时钟电源设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17541"><span data-slate-object="text" data-key="17542"><span data-slate-leaf="true" data-offset-key="17542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17543"><span data-slate-leaf="true" data-offset-key="17543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17544"><span data-slate-leaf="true" data-offset-key="17544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> LCDCONTER_DEVICE 12        </span></span></span></span><span data-slate-object="text" data-key="17545"><span data-slate-leaf="true" data-offset-key="17545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//LCD 控制器设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17546"><span data-slate-object="text" data-key="17547"><span data-slate-leaf="true" data-offset-key="17547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17548"><span data-slate-leaf="true" data-offset-key="17548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17549"><span data-slate-leaf="true" data-offset-key="17549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> NANDFLASH_DEVICE 13       </span></span></span></span><span data-slate-object="text" data-key="17550"><span data-slate-leaf="true" data-offset-key="17550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//nandflash 设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17551"><span data-slate-object="text" data-key="17552"><span data-slate-leaf="true" data-offset-key="17552:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17553"><span data-slate-leaf="true" data-offset-key="17553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17554"><span data-slate-leaf="true" data-offset-key="17554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> CAMERA_DEVICE 14          </span></span></span></span><span data-slate-object="text" data-key="17555"><span data-slate-leaf="true" data-offset-key="17555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 摄像头设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17556"><span data-slate-object="text" data-key="17557"><span data-slate-leaf="true" data-offset-key="17557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17558"><span data-slate-leaf="true" data-offset-key="17558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17559"><span data-slate-leaf="true" data-offset-key="17559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> UART_DEVICE 15             </span></span></span></span><span data-slate-object="text" data-key="17560"><span data-slate-leaf="true" data-offset-key="17560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 串口设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17561"><span data-slate-object="text" data-key="17562"><span data-slate-leaf="true" data-offset-key="17562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17563"><span data-slate-leaf="true" data-offset-key="17563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17564"><span data-slate-leaf="true" data-offset-key="17564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> TIMER_DEVICE 16            </span></span></span></span><span data-slate-object="text" data-key="17565"><span data-slate-leaf="true" data-offset-key="17565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 定时器设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17566"><span data-slate-object="text" data-key="17567"><span data-slate-leaf="true" data-offset-key="17567:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17568"><span data-slate-leaf="true" data-offset-key="17568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17569"><span data-slate-leaf="true" data-offset-key="17569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> USB_DEVICE 17              </span></span></span></span><span data-slate-object="text" data-key="17570"><span data-slate-leaf="true" data-offset-key="17570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//USB 设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17571"><span data-slate-object="text" data-key="17572"><span data-slate-leaf="true" data-offset-key="17572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17573"><span data-slate-leaf="true" data-offset-key="17573:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17574"><span data-slate-leaf="true" data-offset-key="17574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> WATCHDOG_DEVICE 18        </span></span></span></span><span data-slate-object="text" data-key="17575"><span data-slate-leaf="true" data-offset-key="17575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 看门狗设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17576"><span data-slate-object="text" data-key="17577"><span data-slate-leaf="true" data-offset-key="17577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17578"><span data-slate-leaf="true" data-offset-key="17578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17579"><span data-slate-leaf="true" data-offset-key="17579:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> RTC_DEVICE 22              </span></span></span></span><span data-slate-object="text" data-key="17580"><span data-slate-leaf="true" data-offset-key="17580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实时时钟设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17581"><span data-slate-object="text" data-key="17582"><span data-slate-leaf="true" data-offset-key="17582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17583"><span data-slate-leaf="true" data-offset-key="17583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17584"><span data-slate-leaf="true" data-offset-key="17584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> SD_DEVICE 25               </span></span></span></span><span data-slate-object="text" data-key="17585"><span data-slate-leaf="true" data-offset-key="17585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//SD 卡设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17586"><span data-slate-object="text" data-key="17587"><span data-slate-leaf="true" data-offset-key="17587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17588"><span data-slate-leaf="true" data-offset-key="17588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17589"><span data-slate-leaf="true" data-offset-key="17589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> AUDIO_DEVICE 26            </span></span></span></span><span data-slate-object="text" data-key="17590"><span data-slate-leaf="true" data-offset-key="17590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 音频设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17591"><span data-slate-object="text" data-key="17592"><span data-slate-leaf="true" data-offset-key="17592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17593"><span data-slate-leaf="true" data-offset-key="17593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17594"><span data-slate-leaf="true" data-offset-key="17594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> TOUCH_DEVICE 27           </span></span></span></span><span data-slate-object="text" data-key="17595"><span data-slate-leaf="true" data-offset-key="17595:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 触控设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17596"><span data-slate-object="text" data-key="17597"><span data-slate-leaf="true" data-offset-key="17597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17598"><span data-slate-leaf="true" data-offset-key="17598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17599"><span data-slate-leaf="true" data-offset-key="17599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> NETWORK_DEVICE 28         </span></span></span></span><span data-slate-object="text" data-key="17600"><span data-slate-leaf="true" data-offset-key="17600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 网络设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17601"><span data-slate-object="text" data-key="17602"><span data-slate-leaf="true" data-offset-key="17602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17603"><span data-slate-leaf="true" data-offset-key="17603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17604"><span data-slate-leaf="true" data-offset-key="17604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> VIR_DEVICE 29               </span></span></span></span><span data-slate-object="text" data-key="17605"><span data-slate-leaf="true" data-offset-key="17605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 虚拟设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17606"><span data-slate-object="text" data-key="17607"><span data-slate-leaf="true" data-offset-key="17607:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17608"><span data-slate-leaf="true" data-offset-key="17608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17609"><span data-slate-leaf="true" data-offset-key="17609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> FILESYS_DEVICE 30            </span></span></span></span><span data-slate-object="text" data-key="17610"><span data-slate-leaf="true" data-offset-key="17610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 文件系统设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17611"><span data-slate-object="text" data-key="17612"><span data-slate-leaf="true" data-offset-key="17612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17613"><span data-slate-leaf="true" data-offset-key="17613:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17614"><span data-slate-leaf="true" data-offset-key="17614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> SYSTICK_DEVICE 31           </span></span></span></span><span data-slate-object="text" data-key="17615"><span data-slate-leaf="true" data-offset-key="17615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 系统 TICK 设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17616"><span data-slate-object="text" data-key="17617"><span data-slate-leaf="true" data-offset-key="17617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17618"><span data-slate-leaf="true" data-offset-key="17618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17619"><span data-slate-leaf="true" data-offset-key="17619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> UNKNOWN_DEVICE 32        </span></span></span></span><span data-slate-object="text" data-key="17620"><span data-slate-leaf="true" data-offset-key="17620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 未知设备，也是设备</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17621"><span data-slate-object="text" data-key="17622"><span data-slate-leaf="true" data-offset-key="17622:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17623"><span data-slate-leaf="true" data-offset-key="17623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17624"><span data-slate-leaf="true" data-offset-key="17624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> HD_DEVICE 33        </span></span></span></span><span data-slate-object="text" data-key="17625"><span data-slate-leaf="true" data-offset-key="17625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 硬盘设备</span></span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17626"><span data-slate-object="text" data-key="17627"><span data-slate-leaf="true" data-offset-key="17627:0" data-first-offset="true"><span data-slate-string="true">上面定义的这些类型的设备，都是 Cosmos 内核抽象出来的逻辑设备，例如 NETWORK_DEVICE 网络设备，不管它是有线网卡还是无线网卡，或者是设备控制代码虚拟出来的虚拟网卡。Cosmos 内核都将认为它是一个网络设备，这就是设备的抽象，这样有利于我们灵活、简便管理设备。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17628" id="sr-toc-5"><span data-slate-object="text" data-key="17629"><span data-slate-leaf="true" data-offset-key="17629:0" data-first-offset="true"><span data-slate-string="true">设备驱动</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17630"><span data-slate-object="text" data-key="17631"><span data-slate-leaf="true" data-offset-key="17631:0" data-first-offset="true"><span data-slate-string="true">刚才我们解决了设备分类，下面我来研究如何实现分权而治，就是把操作每个设备的相关代码独立出来，这种方式在业界有一个更专业的名字 ——</span></span></span><span data-slate-object="text" data-key="17632"><span data-slate-leaf="true" data-offset-key="17632:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 设备驱动程序</span></span></span></span><span data-slate-object="text" data-key="17633"><span data-slate-leaf="true" data-offset-key="17633:0" data-first-offset="true"><span data-slate-string="true">。同时在下面的内容中，我们将不区分设备驱动程序和驱动程序。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17634"><span data-slate-object="text" data-key="17635"><span data-slate-leaf="true" data-offset-key="17635:0" data-first-offset="true"><span data-slate-string="true">这种 “分权而治” 的方式，给操作系统内核带了灵活性、可扩展性…… 可是也带来了新的问题，有哪些问题呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17636"><span data-slate-object="text" data-key="17637"><span data-slate-leaf="true" data-offset-key="17637:0" data-first-offset="true"><span data-slate-string="true">首先是操作系统内核如何表示多个设备与驱动的存在？然后，还有如何组织多个设备和多个驱动程序的问题，最后我们还得考虑应该让驱动程序提供一些什么支持。下面我们分别解决这些问题。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17638" id="sr-toc-6"><span data-slate-object="text" data-key="17639"><span data-slate-leaf="true" data-offset-key="17639:0" data-first-offset="true"><span data-slate-string="true">设备</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17640"><span data-slate-object="text" data-key="17641"><span data-slate-leaf="true" data-offset-key="17641:0" data-first-offset="true"><span data-slate-string="true">你能说说一个设备包含哪些信息吗？无非是设备类型，设备名称，设备状态，设备 id，设备的驱动程序等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17642"><span data-slate-object="text" data-key="17643"><span data-slate-leaf="true" data-offset-key="17643:0" data-first-offset="true"><span data-slate-string="true">我们把这些信息归纳成一个数据结构，在操作系统内核建立这个数据结构的实例变量，这个设备数据结构的实例变量，一旦建立，就表示操作系统内核中存在一个逻辑设备了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17644"><span data-slate-object="text" data-key="17645"><span data-slate-leaf="true" data-offset-key="17645:0" data-first-offset="true"><span data-slate-string="true">我们接下来就一起整理一下设备的信息，然后把它们变成一个数据结构，代码如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="17646"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17647"><span data-slate-object="text" data-key="17648"><span data-slate-leaf="true" data-offset-key="17648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="17649"><span data-slate-leaf="true" data-offset-key="17649:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17650"><span data-slate-leaf="true" data-offset-key="17650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17651"><span data-slate-leaf="true" data-offset-key="17651:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17652"><span data-slate-leaf="true" data-offset-key="17652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DEVID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17653"><span data-slate-object="text" data-key="17654"><span data-slate-leaf="true" data-offset-key="17654:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17655"><span data-slate-object="text" data-key="17656"><span data-slate-leaf="true" data-offset-key="17656:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17657"><span data-slate-leaf="true" data-offset-key="17657:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17658"><span data-slate-leaf="true" data-offset-key="17658:0" data-first-offset="true"><span data-slate-string="true">  dev_mtype;</span></span></span><span data-slate-object="text" data-key="17659"><span data-slate-leaf="true" data-offset-key="17659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备类型号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17660"><span data-slate-object="text" data-key="17661"><span data-slate-leaf="true" data-offset-key="17661:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17662"><span data-slate-leaf="true" data-offset-key="17662:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17663"><span data-slate-leaf="true" data-offset-key="17663:0" data-first-offset="true"><span data-slate-string="true">  dev_stype; </span></span></span><span data-slate-object="text" data-key="17664"><span data-slate-leaf="true" data-offset-key="17664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备子类型号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17665"><span data-slate-object="text" data-key="17666"><span data-slate-leaf="true" data-offset-key="17666:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17667"><span data-slate-leaf="true" data-offset-key="17667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17668"><span data-slate-leaf="true" data-offset-key="17668:0" data-first-offset="true"><span data-slate-string="true">  dev_nr; </span></span></span><span data-slate-object="text" data-key="17669"><span data-slate-leaf="true" data-offset-key="17669:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备序号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17670"><span data-slate-object="text" data-key="17671"><span data-slate-leaf="true" data-offset-key="17671:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="17672"><span data-slate-leaf="true" data-offset-key="17672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devid_t</span></span></span></span><span data-slate-object="text" data-key="17673"><span data-slate-leaf="true" data-offset-key="17673:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17674"><span data-slate-object="text" data-key="17675"><span data-slate-leaf="true" data-offset-key="17675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="17676"><span data-slate-leaf="true" data-offset-key="17676:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17677"><span data-slate-leaf="true" data-offset-key="17677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17678"><span data-slate-leaf="true" data-offset-key="17678:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17679"><span data-slate-leaf="true" data-offset-key="17679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DEVICE</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17680"><span data-slate-object="text" data-key="17681"><span data-slate-leaf="true" data-offset-key="17681:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17682"><span data-slate-object="text" data-key="17683"><span data-slate-leaf="true" data-offset-key="17683:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17684"><span data-slate-leaf="true" data-offset-key="17684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17685"><span data-slate-leaf="true" data-offset-key="17685:0" data-first-offset="true"><span data-slate-string="true">    dev_list;</span></span></span><span data-slate-object="text" data-key="17686"><span data-slate-leaf="true" data-offset-key="17686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17687"><span data-slate-object="text" data-key="17688"><span data-slate-leaf="true" data-offset-key="17688:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17689"><span data-slate-leaf="true" data-offset-key="17689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17690"><span data-slate-leaf="true" data-offset-key="17690:0" data-first-offset="true"><span data-slate-string="true">    dev_indrvlst; </span></span></span><span data-slate-object="text" data-key="17691"><span data-slate-leaf="true" data-offset-key="17691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备在驱动程序数据结构中对应的挂载链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17692"><span data-slate-object="text" data-key="17693"><span data-slate-leaf="true" data-offset-key="17693:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17694"><span data-slate-leaf="true" data-offset-key="17694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17695"><span data-slate-leaf="true" data-offset-key="17695:0" data-first-offset="true"><span data-slate-string="true">    dev_intbllst; </span></span></span><span data-slate-object="text" data-key="17696"><span data-slate-leaf="true" data-offset-key="17696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备在设备表数据结构中对应的挂载链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17697"><span data-slate-object="text" data-key="17698"><span data-slate-leaf="true" data-offset-key="17698:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17699"><span data-slate-leaf="true" data-offset-key="17699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="17700"><span data-slate-leaf="true" data-offset-key="17700:0" data-first-offset="true"><span data-slate-string="true">  dev_lock; </span></span></span><span data-slate-object="text" data-key="17701"><span data-slate-leaf="true" data-offset-key="17701:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17702"><span data-slate-object="text" data-key="17703"><span data-slate-leaf="true" data-offset-key="17703:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17704"><span data-slate-leaf="true" data-offset-key="17704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17705"><span data-slate-leaf="true" data-offset-key="17705:0" data-first-offset="true"><span data-slate-string="true">      dev_count; </span></span></span><span data-slate-object="text" data-key="17706"><span data-slate-leaf="true" data-offset-key="17706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备计数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17707"><span data-slate-object="text" data-key="17708"><span data-slate-leaf="true" data-offset-key="17708:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17709"><span data-slate-leaf="true" data-offset-key="17709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sem_t</span></span></span></span><span data-slate-object="text" data-key="17710"><span data-slate-leaf="true" data-offset-key="17710:0" data-first-offset="true"><span data-slate-string="true">       dev_sem; </span></span></span><span data-slate-object="text" data-key="17711"><span data-slate-leaf="true" data-offset-key="17711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备信号量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17712"><span data-slate-object="text" data-key="17713"><span data-slate-leaf="true" data-offset-key="17713:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17714"><span data-slate-leaf="true" data-offset-key="17714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17715"><span data-slate-leaf="true" data-offset-key="17715:0" data-first-offset="true"><span data-slate-string="true">      dev_stus; </span></span></span><span data-slate-object="text" data-key="17716"><span data-slate-leaf="true" data-offset-key="17716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17717"><span data-slate-object="text" data-key="17718"><span data-slate-leaf="true" data-offset-key="17718:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17719"><span data-slate-leaf="true" data-offset-key="17719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17720"><span data-slate-leaf="true" data-offset-key="17720:0" data-first-offset="true"><span data-slate-string="true">      dev_flgs; </span></span></span><span data-slate-object="text" data-key="17721"><span data-slate-leaf="true" data-offset-key="17721:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备标志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17722"><span data-slate-object="text" data-key="17723"><span data-slate-leaf="true" data-offset-key="17723:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17724"><span data-slate-leaf="true" data-offset-key="17724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devid_t</span></span></span></span><span data-slate-object="text" data-key="17725"><span data-slate-leaf="true" data-offset-key="17725:0" data-first-offset="true"><span data-slate-string="true">      dev_id; </span></span></span><span data-slate-object="text" data-key="17726"><span data-slate-leaf="true" data-offset-key="17726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备 ID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17727"><span data-slate-object="text" data-key="17728"><span data-slate-leaf="true" data-offset-key="17728:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17729"><span data-slate-leaf="true" data-offset-key="17729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17730"><span data-slate-leaf="true" data-offset-key="17730:0" data-first-offset="true"><span data-slate-string="true">      dev_intlnenr; </span></span></span><span data-slate-object="text" data-key="17731"><span data-slate-leaf="true" data-offset-key="17731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备中断服务例程的个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17732"><span data-slate-object="text" data-key="17733"><span data-slate-leaf="true" data-offset-key="17733:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17734"><span data-slate-leaf="true" data-offset-key="17734:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17735"><span data-slate-leaf="true" data-offset-key="17735:0" data-first-offset="true"><span data-slate-string="true">    dev_intserlst; </span></span></span><span data-slate-object="text" data-key="17736"><span data-slate-leaf="true" data-offset-key="17736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备中断服务例程的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17737"><span data-slate-object="text" data-key="17738"><span data-slate-leaf="true" data-offset-key="17738:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17739"><span data-slate-leaf="true" data-offset-key="17739:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17740"><span data-slate-leaf="true" data-offset-key="17740:0" data-first-offset="true"><span data-slate-string="true">    dev_rqlist; </span></span></span><span data-slate-object="text" data-key="17741"><span data-slate-leaf="true" data-offset-key="17741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对设备的请求服务链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17742"><span data-slate-object="text" data-key="17743"><span data-slate-leaf="true" data-offset-key="17743:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17744"><span data-slate-leaf="true" data-offset-key="17744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17745"><span data-slate-leaf="true" data-offset-key="17745:0" data-first-offset="true"><span data-slate-string="true">      dev_rqlnr; </span></span></span><span data-slate-object="text" data-key="17746"><span data-slate-leaf="true" data-offset-key="17746:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对设备的请求服务个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17747"><span data-slate-object="text" data-key="17748"><span data-slate-leaf="true" data-offset-key="17748:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17749"><span data-slate-leaf="true" data-offset-key="17749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sem_t</span></span></span></span><span data-slate-object="text" data-key="17750"><span data-slate-leaf="true" data-offset-key="17750:0" data-first-offset="true"><span data-slate-string="true">       dev_waitints; </span></span></span><span data-slate-object="text" data-key="17751"><span data-slate-leaf="true" data-offset-key="17751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 用于等待设备的信号量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17752"><span data-slate-object="text" data-key="17753"><span data-slate-leaf="true" data-offset-key="17753:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17754"><span data-slate-leaf="true" data-offset-key="17754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17755"><span data-slate-leaf="true" data-offset-key="17755:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17756"><span data-slate-leaf="true" data-offset-key="17756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DRIVER</span></span></span></span><span data-slate-object="text" data-key="17757"><span data-slate-leaf="true" data-offset-key="17757:0" data-first-offset="true"><span data-slate-string="true">* dev_drv; </span></span></span><span data-slate-object="text" data-key="17758"><span data-slate-leaf="true" data-offset-key="17758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备对应的驱动程序数据结构的指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17759"><span data-slate-object="text" data-key="17760"><span data-slate-leaf="true" data-offset-key="17760:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17761"><span data-slate-leaf="true" data-offset-key="17761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17762"><span data-slate-leaf="true" data-offset-key="17762:0" data-first-offset="true"><span data-slate-string="true">* dev_attrb; </span></span></span><span data-slate-object="text" data-key="17763"><span data-slate-leaf="true" data-offset-key="17763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备属性指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17764"><span data-slate-object="text" data-key="17765"><span data-slate-leaf="true" data-offset-key="17765:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17766"><span data-slate-leaf="true" data-offset-key="17766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17767"><span data-slate-leaf="true" data-offset-key="17767:0" data-first-offset="true"><span data-slate-string="true">* dev_privdata; </span></span></span><span data-slate-object="text" data-key="17768"><span data-slate-leaf="true" data-offset-key="17768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备私有数据指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17769"><span data-slate-object="text" data-key="17770"><span data-slate-leaf="true" data-offset-key="17770:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17771"><span data-slate-leaf="true" data-offset-key="17771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17772"><span data-slate-leaf="true" data-offset-key="17772:0" data-first-offset="true"><span data-slate-string="true">* dev_userdata;</span></span></span><span data-slate-object="text" data-key="17773"><span data-slate-leaf="true" data-offset-key="17773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将来扩展所用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17774"><span data-slate-object="text" data-key="17775"><span data-slate-leaf="true" data-offset-key="17775:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17776"><span data-slate-leaf="true" data-offset-key="17776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17777"><span data-slate-leaf="true" data-offset-key="17777:0" data-first-offset="true"><span data-slate-string="true">* dev_extdata;</span></span></span><span data-slate-object="text" data-key="17778"><span data-slate-leaf="true" data-offset-key="17778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将来扩展所用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17779"><span data-slate-object="text" data-key="17780"><span data-slate-leaf="true" data-offset-key="17780:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17781"><span data-slate-leaf="true" data-offset-key="17781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">char_t</span></span></span></span><span data-slate-object="text" data-key="17782"><span data-slate-leaf="true" data-offset-key="17782:0" data-first-offset="true"><span data-slate-string="true">* dev_name; </span></span></span><span data-slate-object="text" data-key="17783"><span data-slate-leaf="true" data-offset-key="17783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备名</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17784"><span data-slate-object="text" data-key="17785"><span data-slate-leaf="true" data-offset-key="17785:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="17786"><span data-slate-leaf="true" data-offset-key="17786:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span><span data-slate-object="text" data-key="17787"><span data-slate-leaf="true" data-offset-key="17787:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17788"><span data-slate-object="text" data-key="17789"><span data-slate-leaf="true" data-offset-key="17789:0" data-first-offset="true"><span data-slate-string="true">设备的信息比较多，大多是用于组织设备的。这里的</span></span></span><span data-slate-object="text" data-key="17790"><span data-slate-leaf="true" data-offset-key="17790:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">设备 ID 结构十分重要</span></span></span></span><span data-slate-object="text" data-key="17791"><span data-slate-leaf="true" data-offset-key="17791:0" data-first-offset="true"><span data-slate-string="true">，它表示设备的类型、设备号，子设备号是为了解决多个相同设备的，还有一个指向设备驱动程序的指针，这是用于访问设备时调用设备驱动程序的，只要有人建立了一个设备结构的实例变量，内核就能感知到一个设备存在了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17792"><span data-slate-object="text" data-key="17793"><span data-slate-leaf="true" data-offset-key="17793:0" data-first-offset="true"><span data-slate-string="true">至于是谁建立了设备结构的实例变量，这个问题我们接着探索。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17794" id="sr-toc-7"><span data-slate-object="text" data-key="17795"><span data-slate-leaf="true" data-offset-key="17795:0" data-first-offset="true"><span data-slate-string="true">驱动</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17796"><span data-slate-object="text" data-key="17797"><span data-slate-leaf="true" data-offset-key="17797:0" data-first-offset="true"><span data-slate-string="true">操作系统内核和应用程序都不会主动建立设备，那么谁来建立设备呢？当然是控制设备的代码，也就是我们常说的</span></span></span><span data-slate-object="text" data-key="17798"><span data-slate-leaf="true" data-offset-key="17798:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">驱动程序</span></span></span></span><span data-slate-object="text" data-key="17799"><span data-slate-leaf="true" data-offset-key="17799:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17800"><span data-slate-object="text" data-key="17801"><span data-slate-leaf="true" data-offset-key="17801:0" data-first-offset="true"><span data-slate-string="true">那么驱动程序如何表示呢，换句话说，操作系统内核是如何感知到一个驱动程序的存在呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17802"><span data-slate-object="text" data-key="17803"><span data-slate-leaf="true" data-offset-key="17803:0" data-first-offset="true"><span data-slate-string="true">根据前面的经验，我们还是要定义一个数据结构来表示一个驱动程序，数据结构中应该包含驱动程序名，驱动程序 ID，驱动程序所管理的设备，最重要的是</span></span></span><span data-slate-object="text" data-key="17804"><span data-slate-leaf="true" data-offset-key="17804:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">完成功能设备相关功能的函数</span></span></span></span><span data-slate-object="text" data-key="17805"><span data-slate-leaf="true" data-offset-key="17805:0" data-first-offset="true"><span data-slate-string="true">，下面我们来定义它，代码如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="17806"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17807"><span data-slate-object="text" data-key="17808"><span data-slate-leaf="true" data-offset-key="17808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="17809"><span data-slate-leaf="true" data-offset-key="17809:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17810"><span data-slate-leaf="true" data-offset-key="17810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17811"><span data-slate-leaf="true" data-offset-key="17811:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17812"><span data-slate-leaf="true" data-offset-key="17812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DRIVER</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17813"><span data-slate-object="text" data-key="17814"><span data-slate-leaf="true" data-offset-key="17814:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17815"><span data-slate-object="text" data-key="17816"><span data-slate-leaf="true" data-offset-key="17816:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17817"><span data-slate-leaf="true" data-offset-key="17817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="17818"><span data-slate-leaf="true" data-offset-key="17818:0" data-first-offset="true"><span data-slate-string="true"> drv_lock; </span></span></span><span data-slate-object="text" data-key="17819"><span data-slate-leaf="true" data-offset-key="17819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 保护驱动程序数据结构的自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17820"><span data-slate-object="text" data-key="17821"><span data-slate-leaf="true" data-offset-key="17821:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17822"><span data-slate-leaf="true" data-offset-key="17822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17823"><span data-slate-leaf="true" data-offset-key="17823:0" data-first-offset="true"><span data-slate-string="true"> drv_list;</span></span></span><span data-slate-object="text" data-key="17824"><span data-slate-leaf="true" data-offset-key="17824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载驱动程序数据结构的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17825"><span data-slate-object="text" data-key="17826"><span data-slate-leaf="true" data-offset-key="17826:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17827"><span data-slate-leaf="true" data-offset-key="17827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17828"><span data-slate-leaf="true" data-offset-key="17828:0" data-first-offset="true"><span data-slate-string="true"> drv_stuts; </span></span></span><span data-slate-object="text" data-key="17829"><span data-slate-leaf="true" data-offset-key="17829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的相关状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17830"><span data-slate-object="text" data-key="17831"><span data-slate-leaf="true" data-offset-key="17831:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17832"><span data-slate-leaf="true" data-offset-key="17832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17833"><span data-slate-leaf="true" data-offset-key="17833:0" data-first-offset="true"><span data-slate-string="true"> drv_flg; </span></span></span><span data-slate-object="text" data-key="17834"><span data-slate-leaf="true" data-offset-key="17834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的相关标志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17835"><span data-slate-object="text" data-key="17836"><span data-slate-leaf="true" data-offset-key="17836:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17837"><span data-slate-leaf="true" data-offset-key="17837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17838"><span data-slate-leaf="true" data-offset-key="17838:0" data-first-offset="true"><span data-slate-string="true"> drv_id; </span></span></span><span data-slate-object="text" data-key="17839"><span data-slate-leaf="true" data-offset-key="17839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序 ID</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17840"><span data-slate-object="text" data-key="17841"><span data-slate-leaf="true" data-offset-key="17841:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17842"><span data-slate-leaf="true" data-offset-key="17842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17843"><span data-slate-leaf="true" data-offset-key="17843:0" data-first-offset="true"><span data-slate-string="true"> drv_count; </span></span></span><span data-slate-object="text" data-key="17844"><span data-slate-leaf="true" data-offset-key="17844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的计数器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17845"><span data-slate-object="text" data-key="17846"><span data-slate-leaf="true" data-offset-key="17846:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17847"><span data-slate-leaf="true" data-offset-key="17847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sem_t</span></span></span></span><span data-slate-object="text" data-key="17848"><span data-slate-leaf="true" data-offset-key="17848:0" data-first-offset="true"><span data-slate-string="true"> drv_sem; </span></span></span><span data-slate-object="text" data-key="17849"><span data-slate-leaf="true" data-offset-key="17849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的信号量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17850"><span data-slate-object="text" data-key="17851"><span data-slate-leaf="true" data-offset-key="17851:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17852"><span data-slate-leaf="true" data-offset-key="17852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17853"><span data-slate-leaf="true" data-offset-key="17853:0" data-first-offset="true"><span data-slate-string="true">* drv_safedsc; </span></span></span><span data-slate-object="text" data-key="17854"><span data-slate-leaf="true" data-offset-key="17854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的安全体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17855"><span data-slate-object="text" data-key="17856"><span data-slate-leaf="true" data-offset-key="17856:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17857"><span data-slate-leaf="true" data-offset-key="17857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17858"><span data-slate-leaf="true" data-offset-key="17858:0" data-first-offset="true"><span data-slate-string="true">* drv_attrb; </span></span></span><span data-slate-object="text" data-key="17859"><span data-slate-leaf="true" data-offset-key="17859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//LMOSEM 内核要求的驱动程序属性体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17860"><span data-slate-object="text" data-key="17861"><span data-slate-leaf="true" data-offset-key="17861:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17862"><span data-slate-leaf="true" data-offset-key="17862:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17863"><span data-slate-leaf="true" data-offset-key="17863:0" data-first-offset="true"><span data-slate-string="true">* drv_privdata; </span></span></span><span data-slate-object="text" data-key="17864"><span data-slate-leaf="true" data-offset-key="17864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序私有数据的指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17865"><span data-slate-object="text" data-key="17866"><span data-slate-leaf="true" data-offset-key="17866:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17867"><span data-slate-leaf="true" data-offset-key="17867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drivcallfun_t</span></span></span></span><span data-slate-object="text" data-key="17868"><span data-slate-leaf="true" data-offset-key="17868:0" data-first-offset="true"><span data-slate-string="true"> drv_dipfun[IOIF_CODE_MAX]; </span></span></span><span data-slate-object="text" data-key="17869"><span data-slate-leaf="true" data-offset-key="17869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序功能派发函数指针数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17870"><span data-slate-object="text" data-key="17871"><span data-slate-leaf="true" data-offset-key="17871:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17872"><span data-slate-leaf="true" data-offset-key="17872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17873"><span data-slate-leaf="true" data-offset-key="17873:0" data-first-offset="true"><span data-slate-string="true"> drv_alldevlist; </span></span></span><span data-slate-object="text" data-key="17874"><span data-slate-leaf="true" data-offset-key="17874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载驱动程序所管理的所有设备的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17875"><span data-slate-object="text" data-key="17876"><span data-slate-leaf="true" data-offset-key="17876:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17877"><span data-slate-leaf="true" data-offset-key="17877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drventyexit_t</span></span></span></span><span data-slate-object="text" data-key="17878"><span data-slate-leaf="true" data-offset-key="17878:0" data-first-offset="true"><span data-slate-string="true"> drv_entry; </span></span></span><span data-slate-object="text" data-key="17879"><span data-slate-leaf="true" data-offset-key="17879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的入口函数指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17880"><span data-slate-object="text" data-key="17881"><span data-slate-leaf="true" data-offset-key="17881:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17882"><span data-slate-leaf="true" data-offset-key="17882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drventyexit_t</span></span></span></span><span data-slate-object="text" data-key="17883"><span data-slate-leaf="true" data-offset-key="17883:0" data-first-offset="true"><span data-slate-string="true"> drv_exit; </span></span></span><span data-slate-object="text" data-key="17884"><span data-slate-leaf="true" data-offset-key="17884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的退出函数指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17885"><span data-slate-object="text" data-key="17886"><span data-slate-leaf="true" data-offset-key="17886:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17887"><span data-slate-leaf="true" data-offset-key="17887:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17888"><span data-slate-leaf="true" data-offset-key="17888:0" data-first-offset="true"><span data-slate-string="true">* drv_userdata;</span></span></span><span data-slate-object="text" data-key="17889"><span data-slate-leaf="true" data-offset-key="17889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 用于将来扩展</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17890"><span data-slate-object="text" data-key="17891"><span data-slate-leaf="true" data-offset-key="17891:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17892"><span data-slate-leaf="true" data-offset-key="17892:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17893"><span data-slate-leaf="true" data-offset-key="17893:0" data-first-offset="true"><span data-slate-string="true">* drv_extdata; </span></span></span><span data-slate-object="text" data-key="17894"><span data-slate-leaf="true" data-offset-key="17894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 用于将来扩展</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17895"><span data-slate-object="text" data-key="17896"><span data-slate-leaf="true" data-offset-key="17896:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17897"><span data-slate-leaf="true" data-offset-key="17897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">char_t</span></span></span></span><span data-slate-object="text" data-key="17898"><span data-slate-leaf="true" data-offset-key="17898:0" data-first-offset="true"><span data-slate-string="true">* drv_name; </span></span></span><span data-slate-object="text" data-key="17899"><span data-slate-leaf="true" data-offset-key="17899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序的名字</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17900"><span data-slate-object="text" data-key="17901"><span data-slate-leaf="true" data-offset-key="17901:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="17902"><span data-slate-leaf="true" data-offset-key="17902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">driver_t</span></span></span></span><span data-slate-object="text" data-key="17903"><span data-slate-leaf="true" data-offset-key="17903:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17904"><span data-slate-object="text" data-key="17905"><span data-slate-leaf="true" data-offset-key="17905:0" data-first-offset="true"><span data-slate-string="true">上述代码，你应该很容易看懂。Cosmos 内核每加载一个驱动程序模块，就会自动分配一个驱动程序数据结构并且将其实例化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17906"><span data-slate-object="text" data-key="17907"><span data-slate-leaf="true" data-offset-key="17907:0" data-first-offset="true"><span data-slate-string="true">而 Cosmos 内核在首次启动驱动程序时，就会调用这个驱动程序的入口点函数，在这个函数中驱动程序会分配一个设备数据结构，并用相关的信息将其实例化，比如填写正确的设备类型、设备 ID 号、设备名称等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17908"><span data-slate-object="text" data-key="17909"><span data-slate-leaf="true" data-offset-key="17909:0" data-first-offset="true"><span data-slate-string="true">Cosmos 内核负责建立驱动数据结构，而驱动程序又建立了设备数据结构，这一来二去，就形成了一个驱动程序与 Cosmos 内核</span></span></span><span data-slate-object="text" data-key="17910"><span data-slate-leaf="true" data-offset-key="17910:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> “握手”</span></span></span></span><span data-slate-object="text" data-key="17911"><span data-slate-leaf="true" data-offset-key="17911:0" data-first-offset="true"><span data-slate-string="true"> 的动作。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17912" id="sr-toc-8"><span data-slate-object="text" data-key="17913"><span data-slate-leaf="true" data-offset-key="17913:0" data-first-offset="true"><span data-slate-string="true">设备驱动的组织</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17914"><span data-slate-object="text" data-key="17915"><span data-slate-leaf="true" data-offset-key="17915:0" data-first-offset="true"><span data-slate-string="true">有了设备、驱动，我们下面探索一下怎么合理的组织好它们。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17916"><span data-slate-object="text" data-key="17917"><span data-slate-leaf="true" data-offset-key="17917:0" data-first-offset="true"><span data-slate-string="true">组织它们要解决的问题，就是在哪里安放驱动。然后我们还要想好怎么找到它们，下面我们用一个叫做</span></span></span><span data-slate-object="text" data-key="17918"><span data-slate-leaf="true" data-offset-key="17918:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">设备表</span></span></span></span><span data-slate-object="text" data-key="17919"><span data-slate-leaf="true" data-offset-key="17919:0" data-first-offset="true"><span data-slate-string="true">的数据结构，来组织这些驱动程序数据结构和设备数据结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17920"><span data-slate-object="text" data-key="17921"><span data-slate-leaf="true" data-offset-key="17921:0" data-first-offset="true"><span data-slate-string="true">这个结构我已经帮你定义好了，如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="17922"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17923"><span data-slate-object="text" data-key="17924"><span data-slate-leaf="true" data-offset-key="17924:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="17925"><span data-slate-leaf="true" data-offset-key="17925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="17926"><span data-slate-leaf="true" data-offset-key="17926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> DEVICE_MAX 34</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17927"><span data-slate-object="text" data-key="17928"><span data-slate-leaf="true" data-offset-key="17928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="17929"><span data-slate-leaf="true" data-offset-key="17929:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17930"><span data-slate-leaf="true" data-offset-key="17930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17931"><span data-slate-leaf="true" data-offset-key="17931:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17932"><span data-slate-leaf="true" data-offset-key="17932:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DEVTLST</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17933"><span data-slate-object="text" data-key="17934"><span data-slate-leaf="true" data-offset-key="17934:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17935"><span data-slate-object="text" data-key="17936"><span data-slate-leaf="true" data-offset-key="17936:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17937"><span data-slate-leaf="true" data-offset-key="17937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17938"><span data-slate-leaf="true" data-offset-key="17938:0" data-first-offset="true"><span data-slate-string="true"> dtl_type;</span></span></span><span data-slate-object="text" data-key="17939"><span data-slate-leaf="true" data-offset-key="17939:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17940"><span data-slate-object="text" data-key="17941"><span data-slate-leaf="true" data-offset-key="17941:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17942"><span data-slate-leaf="true" data-offset-key="17942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17943"><span data-slate-leaf="true" data-offset-key="17943:0" data-first-offset="true"><span data-slate-string="true"> dtl_nr;</span></span></span><span data-slate-object="text" data-key="17944"><span data-slate-leaf="true" data-offset-key="17944:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备计数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17945"><span data-slate-object="text" data-key="17946"><span data-slate-leaf="true" data-offset-key="17946:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17947"><span data-slate-leaf="true" data-offset-key="17947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17948"><span data-slate-leaf="true" data-offset-key="17948:0" data-first-offset="true"><span data-slate-string="true"> dtl_list;</span></span></span><span data-slate-object="text" data-key="17949"><span data-slate-leaf="true" data-offset-key="17949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载设备 device_t 结构的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17950"><span data-slate-object="text" data-key="17951"><span data-slate-leaf="true" data-offset-key="17951:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="17952"><span data-slate-leaf="true" data-offset-key="17952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtlst_t</span></span></span></span><span data-slate-object="text" data-key="17953"><span data-slate-leaf="true" data-offset-key="17953:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17954"><span data-slate-object="text" data-key="17955"><span data-slate-leaf="true" data-offset-key="17955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="17956"><span data-slate-leaf="true" data-offset-key="17956:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17957"><span data-slate-leaf="true" data-offset-key="17957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17958"><span data-slate-leaf="true" data-offset-key="17958:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17959"><span data-slate-leaf="true" data-offset-key="17959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DEVTABLE</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17960"><span data-slate-object="text" data-key="17961"><span data-slate-leaf="true" data-offset-key="17961:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17962"><span data-slate-object="text" data-key="17963"><span data-slate-leaf="true" data-offset-key="17963:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17964"><span data-slate-leaf="true" data-offset-key="17964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17965"><span data-slate-leaf="true" data-offset-key="17965:0" data-first-offset="true"><span data-slate-string="true"> devt_list; </span></span></span><span data-slate-object="text" data-key="17966"><span data-slate-leaf="true" data-offset-key="17966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备表自身的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17967"><span data-slate-object="text" data-key="17968"><span data-slate-leaf="true" data-offset-key="17968:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17969"><span data-slate-leaf="true" data-offset-key="17969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="17970"><span data-slate-leaf="true" data-offset-key="17970:0" data-first-offset="true"><span data-slate-string="true"> devt_lock; </span></span></span><span data-slate-object="text" data-key="17971"><span data-slate-leaf="true" data-offset-key="17971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备表自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17972"><span data-slate-object="text" data-key="17973"><span data-slate-leaf="true" data-offset-key="17973:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17974"><span data-slate-leaf="true" data-offset-key="17974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17975"><span data-slate-leaf="true" data-offset-key="17975:0" data-first-offset="true"><span data-slate-string="true"> devt_devlist; </span></span></span><span data-slate-object="text" data-key="17976"><span data-slate-leaf="true" data-offset-key="17976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 全局设备链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17977"><span data-slate-object="text" data-key="17978"><span data-slate-leaf="true" data-offset-key="17978:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17979"><span data-slate-leaf="true" data-offset-key="17979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="17980"><span data-slate-leaf="true" data-offset-key="17980:0" data-first-offset="true"><span data-slate-string="true"> devt_drvlist; </span></span></span><span data-slate-object="text" data-key="17981"><span data-slate-leaf="true" data-offset-key="17981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 全局驱动程序链表，驱动程序不需要分类，一个链表就行</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17982"><span data-slate-object="text" data-key="17983"><span data-slate-leaf="true" data-offset-key="17983:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17984"><span data-slate-leaf="true" data-offset-key="17984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17985"><span data-slate-leaf="true" data-offset-key="17985:0" data-first-offset="true"><span data-slate-string="true">   devt_devnr; </span></span></span><span data-slate-object="text" data-key="17986"><span data-slate-leaf="true" data-offset-key="17986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 全局设备计数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17987"><span data-slate-object="text" data-key="17988"><span data-slate-leaf="true" data-offset-key="17988:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17989"><span data-slate-leaf="true" data-offset-key="17989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="17990"><span data-slate-leaf="true" data-offset-key="17990:0" data-first-offset="true"><span data-slate-string="true">   devt_drvnr; </span></span></span><span data-slate-object="text" data-key="17991"><span data-slate-leaf="true" data-offset-key="17991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 全局驱动程序计数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17992"><span data-slate-object="text" data-key="17993"><span data-slate-leaf="true" data-offset-key="17993:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17994"><span data-slate-leaf="true" data-offset-key="17994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtlst_t</span></span></span></span><span data-slate-object="text" data-key="17995"><span data-slate-leaf="true" data-offset-key="17995:0" data-first-offset="true"><span data-slate-string="true"> devt_devclsl[DEVICE_MAX]; </span></span></span><span data-slate-object="text" data-key="17996"><span data-slate-leaf="true" data-offset-key="17996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 分类存放设备数据结构的 devtlst_t 结构数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17997"><span data-slate-object="text" data-key="17998"><span data-slate-leaf="true" data-offset-key="17998:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="17999"><span data-slate-leaf="true" data-offset-key="17999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtable_t</span></span></span></span><span data-slate-object="text" data-key="18000"><span data-slate-leaf="true" data-offset-key="18000:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18001"><span data-slate-object="text" data-key="18002"><span data-slate-leaf="true" data-offset-key="18002:0" data-first-offset="true"><span data-slate-string="true">在这段代码的 devtable_t 结构中，devtlst_t 是每个设备类型一个，表示一类设备，但每一类可能有多个设备，所以在 devtlst_t 结构中，有一个设备计数和设备链表。而你可能想到 Cosmos 中肯定要定义一个 devtable_t 结构的全局变量，代码如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="18003"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="18004"><span data-slate-object="text" data-key="18005"><span data-slate-leaf="true" data-offset-key="18005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 在 cosmos/kernel/krlglobal.c 文件中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18006"><span data-slate-object="text" data-key="18007"><span data-slate-leaf="true" data-offset-key="18007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">KRL_DEFGLOB_VARIABLE</span></span></span></span><span data-slate-object="text" data-key="18008"><span data-slate-leaf="true" data-offset-key="18008:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="18009"><span data-slate-leaf="true" data-offset-key="18009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtable_t</span></span></span></span><span data-slate-object="text" data-key="18010"><span data-slate-leaf="true" data-offset-key="18010:0" data-first-offset="true"><span data-slate-string="true">,osdevtable);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18011"><span data-slate-object="text" data-key="18012"><span data-slate-leaf="true" data-offset-key="18012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 在 cosmos/kernel/krldevice.c 文件中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18013"><span data-slate-object="text" data-key="18014"><span data-slate-leaf="true" data-offset-key="18014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="18015"><span data-slate-leaf="true" data-offset-key="18015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18016"><span data-slate-leaf="true" data-offset-key="18016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtlst_t_init</span></span></span></span></span><span data-slate-object="text" data-key="18017"><span data-slate-leaf="true" data-offset-key="18017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18018"><span data-slate-leaf="true" data-offset-key="18018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtlst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18019"><span data-slate-leaf="true" data-offset-key="18019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp, </span></span></span></span></span><span data-slate-object="text" data-key="18020"><span data-slate-leaf="true" data-offset-key="18020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18021"><span data-slate-leaf="true" data-offset-key="18021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> dtype)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18022"><span data-slate-object="text" data-key="18023"><span data-slate-leaf="true" data-offset-key="18023:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18024"><span data-slate-object="text" data-key="18025"><span data-slate-leaf="true" data-offset-key="18025:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;dtl_type = dtype;</span></span></span><span data-slate-object="text" data-key="18026"><span data-slate-leaf="true" data-offset-key="18026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置设备类型    initp-&gt;dtl_nr = 0;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18027"><span data-slate-object="text" data-key="18028"><span data-slate-leaf="true" data-offset-key="18028:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18029"><span data-slate-leaf="true" data-offset-key="18029:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="18030"><span data-slate-leaf="true" data-offset-key="18030:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;dtl_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18031"><span data-slate-object="text" data-key="18032"><span data-slate-leaf="true" data-offset-key="18032:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18033"><span data-slate-leaf="true" data-offset-key="18033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="18034"><span data-slate-leaf="true" data-offset-key="18034:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18035"><span data-slate-object="text" data-key="18036"><span data-slate-leaf="true" data-offset-key="18036:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18037"><span data-slate-object="text" data-key="18038"><span data-slate-leaf="true" data-offset-key="18038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="18039"><span data-slate-leaf="true" data-offset-key="18039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18040"><span data-slate-leaf="true" data-offset-key="18040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtable_t_init</span></span></span></span></span><span data-slate-object="text" data-key="18041"><span data-slate-leaf="true" data-offset-key="18041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18042"><span data-slate-leaf="true" data-offset-key="18042:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtable_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18043"><span data-slate-leaf="true" data-offset-key="18043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18044"><span data-slate-object="text" data-key="18045"><span data-slate-leaf="true" data-offset-key="18045:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18046"><span data-slate-object="text" data-key="18047"><span data-slate-leaf="true" data-offset-key="18047:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18048"><span data-slate-leaf="true" data-offset-key="18048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="18049"><span data-slate-leaf="true" data-offset-key="18049:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;devt_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18050"><span data-slate-object="text" data-key="18051"><span data-slate-leaf="true" data-offset-key="18051:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18052"><span data-slate-leaf="true" data-offset-key="18052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">krlspinlock_init</span></span></span></span><span data-slate-object="text" data-key="18053"><span data-slate-leaf="true" data-offset-key="18053:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;devt_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18054"><span data-slate-object="text" data-key="18055"><span data-slate-leaf="true" data-offset-key="18055:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18056"><span data-slate-leaf="true" data-offset-key="18056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="18057"><span data-slate-leaf="true" data-offset-key="18057:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;devt_devlist);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18058"><span data-slate-object="text" data-key="18059"><span data-slate-leaf="true" data-offset-key="18059:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18060"><span data-slate-leaf="true" data-offset-key="18060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="18061"><span data-slate-leaf="true" data-offset-key="18061:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;devt_drvlist);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18062"><span data-slate-object="text" data-key="18063"><span data-slate-leaf="true" data-offset-key="18063:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;devt_devnr = </span></span></span><span data-slate-object="text" data-key="18064"><span data-slate-leaf="true" data-offset-key="18064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="18065"><span data-slate-leaf="true" data-offset-key="18065:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18066"><span data-slate-object="text" data-key="18067"><span data-slate-leaf="true" data-offset-key="18067:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;devt_drvnr = </span></span></span><span data-slate-object="text" data-key="18068"><span data-slate-leaf="true" data-offset-key="18068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="18069"><span data-slate-leaf="true" data-offset-key="18069:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18070"><span data-slate-object="text" data-key="18071"><span data-slate-leaf="true" data-offset-key="18071:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18072"><span data-slate-leaf="true" data-offset-key="18072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="18073"><span data-slate-leaf="true" data-offset-key="18073:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="18074"><span data-slate-leaf="true" data-offset-key="18074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="18075"><span data-slate-leaf="true" data-offset-key="18075:0" data-first-offset="true"><span data-slate-string="true"> t = </span></span></span><span data-slate-object="text" data-key="18076"><span data-slate-leaf="true" data-offset-key="18076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="18077"><span data-slate-leaf="true" data-offset-key="18077:0" data-first-offset="true"><span data-slate-string="true">; t &lt;DEVICE_MAX; t++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18078"><span data-slate-object="text" data-key="18079"><span data-slate-leaf="true" data-offset-key="18079:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span><span data-slate-object="text" data-key="18080"><span data-slate-leaf="true" data-offset-key="18080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化设备链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18081"><span data-slate-object="text" data-key="18082"><span data-slate-leaf="true" data-offset-key="18082:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="18083"><span data-slate-leaf="true" data-offset-key="18083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtlst_t_init</span></span></span></span><span data-slate-object="text" data-key="18084"><span data-slate-leaf="true" data-offset-key="18084:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;devt_devclsl[t], t);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18085"><span data-slate-object="text" data-key="18086"><span data-slate-leaf="true" data-offset-key="18086:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18087"><span data-slate-object="text" data-key="18088"><span data-slate-leaf="true" data-offset-key="18088:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18089"><span data-slate-leaf="true" data-offset-key="18089:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="18090"><span data-slate-leaf="true" data-offset-key="18090:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18091"><span data-slate-object="text" data-key="18092"><span data-slate-leaf="true" data-offset-key="18092:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18093"><span data-slate-object="text" data-key="18094"><span data-slate-leaf="true" data-offset-key="18094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="18095"><span data-slate-leaf="true" data-offset-key="18095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18096"><span data-slate-leaf="true" data-offset-key="18096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krldevice</span></span></span></span></span><span data-slate-object="text" data-key="18097"><span data-slate-leaf="true" data-offset-key="18097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18098"><span data-slate-object="text" data-key="18099"><span data-slate-leaf="true" data-offset-key="18099:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18100"><span data-slate-object="text" data-key="18101"><span data-slate-leaf="true" data-offset-key="18101:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18102"><span data-slate-leaf="true" data-offset-key="18102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">devtable_t_init</span></span></span></span><span data-slate-object="text" data-key="18103"><span data-slate-leaf="true" data-offset-key="18103:0" data-first-offset="true"><span data-slate-string="true">(&amp;osdevtable);</span></span></span><span data-slate-object="text" data-key="18104"><span data-slate-leaf="true" data-offset-key="18104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化系统全局设备表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18105"><span data-slate-object="text" data-key="18106"><span data-slate-leaf="true" data-offset-key="18106:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18107"><span data-slate-leaf="true" data-offset-key="18107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="18108"><span data-slate-leaf="true" data-offset-key="18108:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18109"><span data-slate-object="text" data-key="18110"><span data-slate-leaf="true" data-offset-key="18110:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18111"><span data-slate-object="text" data-key="18112"><span data-slate-leaf="true" data-offset-key="18112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 在 cosmos/kernel/krlinit.c 文件中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18113"><span data-slate-object="text" data-key="18114"><span data-slate-leaf="true" data-offset-key="18114:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="18115"><span data-slate-leaf="true" data-offset-key="18115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18116"><span data-slate-leaf="true" data-offset-key="18116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krl</span></span></span></span></span><span data-slate-object="text" data-key="18117"><span data-slate-leaf="true" data-offset-key="18117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18118"><span data-slate-object="text" data-key="18119"><span data-slate-leaf="true" data-offset-key="18119:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18120"><span data-slate-object="text" data-key="18121"><span data-slate-leaf="true" data-offset-key="18121:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18122"><span data-slate-leaf="true" data-offset-key="18122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krlmm</span></span></span></span><span data-slate-object="text" data-key="18123"><span data-slate-leaf="true" data-offset-key="18123:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18124"><span data-slate-object="text" data-key="18125"><span data-slate-leaf="true" data-offset-key="18125:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18126"><span data-slate-leaf="true" data-offset-key="18126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krldevice</span></span></span></span><span data-slate-object="text" data-key="18127"><span data-slate-leaf="true" data-offset-key="18127:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18128"><span data-slate-object="text" data-key="18129"><span data-slate-leaf="true" data-offset-key="18129:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18130"><span data-slate-leaf="true" data-offset-key="18130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 记住一定要在初始化调度器之前，初始化设备表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18131"><span data-slate-object="text" data-key="18132"><span data-slate-leaf="true" data-offset-key="18132:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18133"><span data-slate-leaf="true" data-offset-key="18133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krlsched</span></span></span></span><span data-slate-object="text" data-key="18134"><span data-slate-leaf="true" data-offset-key="18134:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18135"><span data-slate-object="text" data-key="18136"><span data-slate-leaf="true" data-offset-key="18136:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18137"><span data-slate-leaf="true" data-offset-key="18137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_krlcpuidle</span></span></span></span><span data-slate-object="text" data-key="18138"><span data-slate-leaf="true" data-offset-key="18138:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18139"><span data-slate-object="text" data-key="18140"><span data-slate-leaf="true" data-offset-key="18140:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18141"><span data-slate-leaf="true" data-offset-key="18141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="18142"><span data-slate-leaf="true" data-offset-key="18142:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18143"><span data-slate-object="text" data-key="18144"><span data-slate-leaf="true" data-offset-key="18144:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18145"><span data-slate-object="text" data-key="18146"><span data-slate-leaf="true" data-offset-key="18146:0" data-first-offset="true"><span data-slate-string="true">上面的设备表的初始化代码已经写好了，如果你大脑中没有设备驱动组织图，可能脑子里还是有点乱，所以我来帮你画一幅图，如下所示。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="18147"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/17/9f/17d232bd17b0c328yyed37bab98baa9f.jpg?wh=5008x4580"></div><div>设备表结构示意图</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18148"><span data-slate-object="text" data-key="18149"><span data-slate-leaf="true" data-offset-key="18149:0" data-first-offset="true"><span data-slate-string="true">上图看似复杂，实则简单，我帮你理一下重点：首先 devtable_t 结构中能找到所有的设备和驱动，然后从设备能找到对应的驱动，从驱动也能找到其管理的所有设备 ，最后就能实现一个驱动管理多个设备。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="18150" id="sr-toc-9"><span data-slate-object="text" data-key="18151"><span data-slate-leaf="true" data-offset-key="18151:0" data-first-offset="true"><span data-slate-string="true">驱动程序功能</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="18152"><span data-slate-object="text" data-key="18153"><span data-slate-leaf="true" data-offset-key="18153:0" data-first-offset="true"><span data-slate-string="true">我们还有一个问题需要解决，那就是驱动程序，究竟要为操作系统内核提供哪些最基本的功能支持？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18154"><span data-slate-object="text" data-key="18155"><span data-slate-leaf="true" data-offset-key="18155:0" data-first-offset="true"><span data-slate-string="true">我们已经知道了，写驱动程序就是为了操控相应的设备，所以这得看大多数设备能完成什么功能了。现代计算机的设备无非就是可以输入数据、处理数据、输出数据，然后完成一些特殊的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18156"><span data-slate-object="text" data-key="18157"><span data-slate-leaf="true" data-offset-key="18157:0" data-first-offset="true"><span data-slate-string="true">当然，现代计算机的设备很多，能耗是个严重的问题，所以操作系统内核应该能控制设备能耗。下面我来帮你归纳一下用来驱动程序的几种主要函数，如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="18158"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="18159"><span data-slate-object="text" data-key="18160"><span data-slate-leaf="true" data-offset-key="18160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序入口和退出函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18161"><span data-slate-object="text" data-key="18162"><span data-slate-leaf="true" data-offset-key="18162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18163"><span data-slate-leaf="true" data-offset-key="18163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18164"><span data-slate-leaf="true" data-offset-key="18164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_entry</span></span></span></span></span><span data-slate-object="text" data-key="18165"><span data-slate-leaf="true" data-offset-key="18165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18166"><span data-slate-leaf="true" data-offset-key="18166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">driver_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18167"><span data-slate-leaf="true" data-offset-key="18167:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* drvp,</span></span></span></span></span><span data-slate-object="text" data-key="18168"><span data-slate-leaf="true" data-offset-key="18168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18169"><span data-slate-leaf="true" data-offset-key="18169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> val,</span></span></span></span></span><span data-slate-object="text" data-key="18170"><span data-slate-leaf="true" data-offset-key="18170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18171"><span data-slate-leaf="true" data-offset-key="18171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* p)</span></span></span></span></span><span data-slate-object="text" data-key="18172"><span data-slate-leaf="true" data-offset-key="18172:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18173"><span data-slate-object="text" data-key="18174"><span data-slate-leaf="true" data-offset-key="18174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18175"><span data-slate-leaf="true" data-offset-key="18175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18176"><span data-slate-leaf="true" data-offset-key="18176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_exit</span></span></span></span></span><span data-slate-object="text" data-key="18177"><span data-slate-leaf="true" data-offset-key="18177:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18178"><span data-slate-leaf="true" data-offset-key="18178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">driver_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18179"><span data-slate-leaf="true" data-offset-key="18179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* drvp,</span></span></span></span></span><span data-slate-object="text" data-key="18180"><span data-slate-leaf="true" data-offset-key="18180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18181"><span data-slate-leaf="true" data-offset-key="18181:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> val,</span></span></span></span></span><span data-slate-object="text" data-key="18182"><span data-slate-leaf="true" data-offset-key="18182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18183"><span data-slate-leaf="true" data-offset-key="18183:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* p)</span></span></span></span></span><span data-slate-object="text" data-key="18184"><span data-slate-leaf="true" data-offset-key="18184:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18185"><span data-slate-object="text" data-key="18186"><span data-slate-leaf="true" data-offset-key="18186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备中断处理函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18187"><span data-slate-object="text" data-key="18188"><span data-slate-leaf="true" data-offset-key="18188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18189"><span data-slate-leaf="true" data-offset-key="18189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18190"><span data-slate-leaf="true" data-offset-key="18190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_handle</span></span></span></span></span><span data-slate-object="text" data-key="18191"><span data-slate-leaf="true" data-offset-key="18191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18192"><span data-slate-leaf="true" data-offset-key="18192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18193"><span data-slate-leaf="true" data-offset-key="18193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> ift_nr,</span></span></span></span></span><span data-slate-object="text" data-key="18194"><span data-slate-leaf="true" data-offset-key="18194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18195"><span data-slate-leaf="true" data-offset-key="18195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18196"><span data-slate-leaf="true" data-offset-key="18196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18197"><span data-slate-leaf="true" data-offset-key="18197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* sframe)</span></span></span></span></span><span data-slate-object="text" data-key="18198"><span data-slate-leaf="true" data-offset-key="18198:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18199"><span data-slate-object="text" data-key="18200"><span data-slate-leaf="true" data-offset-key="18200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 打开、关闭设备函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18201"><span data-slate-object="text" data-key="18202"><span data-slate-leaf="true" data-offset-key="18202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18203"><span data-slate-leaf="true" data-offset-key="18203:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18204"><span data-slate-leaf="true" data-offset-key="18204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_open</span></span></span></span></span><span data-slate-object="text" data-key="18205"><span data-slate-leaf="true" data-offset-key="18205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18206"><span data-slate-leaf="true" data-offset-key="18206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18207"><span data-slate-leaf="true" data-offset-key="18207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18208"><span data-slate-leaf="true" data-offset-key="18208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18209"><span data-slate-leaf="true" data-offset-key="18209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18210"><span data-slate-leaf="true" data-offset-key="18210:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18211"><span data-slate-object="text" data-key="18212"><span data-slate-leaf="true" data-offset-key="18212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18213"><span data-slate-leaf="true" data-offset-key="18213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18214"><span data-slate-leaf="true" data-offset-key="18214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_close</span></span></span></span></span><span data-slate-object="text" data-key="18215"><span data-slate-leaf="true" data-offset-key="18215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18216"><span data-slate-leaf="true" data-offset-key="18216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18217"><span data-slate-leaf="true" data-offset-key="18217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18218"><span data-slate-leaf="true" data-offset-key="18218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18219"><span data-slate-leaf="true" data-offset-key="18219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18220"><span data-slate-leaf="true" data-offset-key="18220:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18221"><span data-slate-object="text" data-key="18222"><span data-slate-leaf="true" data-offset-key="18222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 读、写设备数据函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18223"><span data-slate-object="text" data-key="18224"><span data-slate-leaf="true" data-offset-key="18224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18225"><span data-slate-leaf="true" data-offset-key="18225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18226"><span data-slate-leaf="true" data-offset-key="18226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_read</span></span></span></span></span><span data-slate-object="text" data-key="18227"><span data-slate-leaf="true" data-offset-key="18227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18228"><span data-slate-leaf="true" data-offset-key="18228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18229"><span data-slate-leaf="true" data-offset-key="18229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18230"><span data-slate-leaf="true" data-offset-key="18230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18231"><span data-slate-leaf="true" data-offset-key="18231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18232"><span data-slate-leaf="true" data-offset-key="18232:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18233"><span data-slate-object="text" data-key="18234"><span data-slate-leaf="true" data-offset-key="18234:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18235"><span data-slate-leaf="true" data-offset-key="18235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18236"><span data-slate-leaf="true" data-offset-key="18236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_write</span></span></span></span></span><span data-slate-object="text" data-key="18237"><span data-slate-leaf="true" data-offset-key="18237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18238"><span data-slate-leaf="true" data-offset-key="18238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18239"><span data-slate-leaf="true" data-offset-key="18239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18240"><span data-slate-leaf="true" data-offset-key="18240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18241"><span data-slate-leaf="true" data-offset-key="18241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18242"><span data-slate-leaf="true" data-offset-key="18242:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18243"><span data-slate-object="text" data-key="18244"><span data-slate-leaf="true" data-offset-key="18244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 调整读写设备数据位置函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18245"><span data-slate-object="text" data-key="18246"><span data-slate-leaf="true" data-offset-key="18246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18247"><span data-slate-leaf="true" data-offset-key="18247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18248"><span data-slate-leaf="true" data-offset-key="18248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_lseek</span></span></span></span></span><span data-slate-object="text" data-key="18249"><span data-slate-leaf="true" data-offset-key="18249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18250"><span data-slate-leaf="true" data-offset-key="18250:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18251"><span data-slate-leaf="true" data-offset-key="18251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18252"><span data-slate-leaf="true" data-offset-key="18252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18253"><span data-slate-leaf="true" data-offset-key="18253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18254"><span data-slate-leaf="true" data-offset-key="18254:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18255"><span data-slate-object="text" data-key="18256"><span data-slate-leaf="true" data-offset-key="18256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 控制设备函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18257"><span data-slate-object="text" data-key="18258"><span data-slate-leaf="true" data-offset-key="18258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18259"><span data-slate-leaf="true" data-offset-key="18259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18260"><span data-slate-leaf="true" data-offset-key="18260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_ioctrl</span></span></span></span></span><span data-slate-object="text" data-key="18261"><span data-slate-leaf="true" data-offset-key="18261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18262"><span data-slate-leaf="true" data-offset-key="18262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18263"><span data-slate-leaf="true" data-offset-key="18263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18264"><span data-slate-leaf="true" data-offset-key="18264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18265"><span data-slate-leaf="true" data-offset-key="18265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18266"><span data-slate-leaf="true" data-offset-key="18266:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18267"><span data-slate-object="text" data-key="18268"><span data-slate-leaf="true" data-offset-key="18268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 开启、停止设备函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18269"><span data-slate-object="text" data-key="18270"><span data-slate-leaf="true" data-offset-key="18270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18271"><span data-slate-leaf="true" data-offset-key="18271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18272"><span data-slate-leaf="true" data-offset-key="18272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_dev_start</span></span></span></span></span><span data-slate-object="text" data-key="18273"><span data-slate-leaf="true" data-offset-key="18273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18274"><span data-slate-leaf="true" data-offset-key="18274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18275"><span data-slate-leaf="true" data-offset-key="18275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18276"><span data-slate-leaf="true" data-offset-key="18276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18277"><span data-slate-leaf="true" data-offset-key="18277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18278"><span data-slate-leaf="true" data-offset-key="18278:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18279"><span data-slate-object="text" data-key="18280"><span data-slate-leaf="true" data-offset-key="18280:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18281"><span data-slate-leaf="true" data-offset-key="18281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18282"><span data-slate-leaf="true" data-offset-key="18282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_dev_stop</span></span></span></span></span><span data-slate-object="text" data-key="18283"><span data-slate-leaf="true" data-offset-key="18283:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18284"><span data-slate-leaf="true" data-offset-key="18284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18285"><span data-slate-leaf="true" data-offset-key="18285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18286"><span data-slate-leaf="true" data-offset-key="18286:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18287"><span data-slate-leaf="true" data-offset-key="18287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18288"><span data-slate-leaf="true" data-offset-key="18288:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18289"><span data-slate-object="text" data-key="18290"><span data-slate-leaf="true" data-offset-key="18290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置设备电源函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18291"><span data-slate-object="text" data-key="18292"><span data-slate-leaf="true" data-offset-key="18292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18293"><span data-slate-leaf="true" data-offset-key="18293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18294"><span data-slate-leaf="true" data-offset-key="18294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_set_powerstus</span></span></span></span></span><span data-slate-object="text" data-key="18295"><span data-slate-leaf="true" data-offset-key="18295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18296"><span data-slate-leaf="true" data-offset-key="18296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18297"><span data-slate-leaf="true" data-offset-key="18297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18298"><span data-slate-leaf="true" data-offset-key="18298:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18299"><span data-slate-leaf="true" data-offset-key="18299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18300"><span data-slate-leaf="true" data-offset-key="18300:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18301"><span data-slate-object="text" data-key="18302"><span data-slate-leaf="true" data-offset-key="18302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 枚举设备函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18303"><span data-slate-object="text" data-key="18304"><span data-slate-leaf="true" data-offset-key="18304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18305"><span data-slate-leaf="true" data-offset-key="18305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18306"><span data-slate-leaf="true" data-offset-key="18306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_enum_dev</span></span></span></span></span><span data-slate-object="text" data-key="18307"><span data-slate-leaf="true" data-offset-key="18307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18308"><span data-slate-leaf="true" data-offset-key="18308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18309"><span data-slate-leaf="true" data-offset-key="18309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18310"><span data-slate-leaf="true" data-offset-key="18310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18311"><span data-slate-leaf="true" data-offset-key="18311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18312"><span data-slate-leaf="true" data-offset-key="18312:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18313"><span data-slate-object="text" data-key="18314"><span data-slate-leaf="true" data-offset-key="18314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 刷新设备缓存函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18315"><span data-slate-object="text" data-key="18316"><span data-slate-leaf="true" data-offset-key="18316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18317"><span data-slate-leaf="true" data-offset-key="18317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18318"><span data-slate-leaf="true" data-offset-key="18318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_flush</span></span></span></span></span><span data-slate-object="text" data-key="18319"><span data-slate-leaf="true" data-offset-key="18319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18320"><span data-slate-leaf="true" data-offset-key="18320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18321"><span data-slate-leaf="true" data-offset-key="18321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18322"><span data-slate-leaf="true" data-offset-key="18322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18323"><span data-slate-leaf="true" data-offset-key="18323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18324"><span data-slate-leaf="true" data-offset-key="18324:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18325"><span data-slate-object="text" data-key="18326"><span data-slate-leaf="true" data-offset-key="18326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设备关机函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18327"><span data-slate-object="text" data-key="18328"><span data-slate-leaf="true" data-offset-key="18328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18329"><span data-slate-leaf="true" data-offset-key="18329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18330"><span data-slate-leaf="true" data-offset-key="18330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_shutdown</span></span></span></span></span><span data-slate-object="text" data-key="18331"><span data-slate-leaf="true" data-offset-key="18331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18332"><span data-slate-leaf="true" data-offset-key="18332:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18333"><span data-slate-leaf="true" data-offset-key="18333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* devp,</span></span></span></span></span><span data-slate-object="text" data-key="18334"><span data-slate-leaf="true" data-offset-key="18334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18335"><span data-slate-leaf="true" data-offset-key="18335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">* iopack)</span></span></span></span></span><span data-slate-object="text" data-key="18336"><span data-slate-leaf="true" data-offset-key="18336:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18337"><span data-slate-object="text" data-key="18338"><span data-slate-leaf="true" data-offset-key="18338:0" data-first-offset="true"><span data-slate-string="true">如上所述，我们可以把每一个操作定义成一个函数，让驱动程序实现这些函数。函数名你可以随便写，但是函数的形式却不能改变，这是操作系统内核与驱动程序沟通的桥梁。当然有很多设备本身并不支持这么多操作，例如时钟设备，驱动程序就不必实现相应的操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18339"><span data-slate-object="text" data-key="18340"><span data-slate-leaf="true" data-offset-key="18340:0" data-first-offset="true"><span data-slate-string="true">那么这些函数如何和操作系统内核关联起来呢？还记得 driver_t 结构中那个函数指针数组吗，如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="18341"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="18342"><span data-slate-object="text" data-key="18343"><span data-slate-leaf="true" data-offset-key="18343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18344"><span data-slate-leaf="true" data-offset-key="18344:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18345"><span data-slate-leaf="true" data-offset-key="18345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_OPEN 0 </span></span></span></span><span data-slate-object="text" data-key="18346"><span data-slate-leaf="true" data-offset-key="18346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 open 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18347"><span data-slate-object="text" data-key="18348"><span data-slate-leaf="true" data-offset-key="18348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18349"><span data-slate-leaf="true" data-offset-key="18349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18350"><span data-slate-leaf="true" data-offset-key="18350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_CLOSE 1 </span></span></span></span><span data-slate-object="text" data-key="18351"><span data-slate-leaf="true" data-offset-key="18351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 close 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18352"><span data-slate-object="text" data-key="18353"><span data-slate-leaf="true" data-offset-key="18353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18354"><span data-slate-leaf="true" data-offset-key="18354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18355"><span data-slate-leaf="true" data-offset-key="18355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_READ 2 </span></span></span></span><span data-slate-object="text" data-key="18356"><span data-slate-leaf="true" data-offset-key="18356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 read 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18357"><span data-slate-object="text" data-key="18358"><span data-slate-leaf="true" data-offset-key="18358:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18359"><span data-slate-leaf="true" data-offset-key="18359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18360"><span data-slate-leaf="true" data-offset-key="18360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_WRITE 3 </span></span></span></span><span data-slate-object="text" data-key="18361"><span data-slate-leaf="true" data-offset-key="18361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 write 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18362"><span data-slate-object="text" data-key="18363"><span data-slate-leaf="true" data-offset-key="18363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18364"><span data-slate-leaf="true" data-offset-key="18364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18365"><span data-slate-leaf="true" data-offset-key="18365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_LSEEK 4 </span></span></span></span><span data-slate-object="text" data-key="18366"><span data-slate-leaf="true" data-offset-key="18366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 lseek 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18367"><span data-slate-object="text" data-key="18368"><span data-slate-leaf="true" data-offset-key="18368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18369"><span data-slate-leaf="true" data-offset-key="18369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18370"><span data-slate-leaf="true" data-offset-key="18370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_IOCTRL 5 </span></span></span></span><span data-slate-object="text" data-key="18371"><span data-slate-leaf="true" data-offset-key="18371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 ioctrl 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18372"><span data-slate-object="text" data-key="18373"><span data-slate-leaf="true" data-offset-key="18373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18374"><span data-slate-leaf="true" data-offset-key="18374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18375"><span data-slate-leaf="true" data-offset-key="18375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_DEV_START 6 </span></span></span></span><span data-slate-object="text" data-key="18376"><span data-slate-leaf="true" data-offset-key="18376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 start 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18377"><span data-slate-object="text" data-key="18378"><span data-slate-leaf="true" data-offset-key="18378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18379"><span data-slate-leaf="true" data-offset-key="18379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18380"><span data-slate-leaf="true" data-offset-key="18380:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_DEV_STOP 7 </span></span></span></span><span data-slate-object="text" data-key="18381"><span data-slate-leaf="true" data-offset-key="18381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 stop 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18382"><span data-slate-object="text" data-key="18383"><span data-slate-leaf="true" data-offset-key="18383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18384"><span data-slate-leaf="true" data-offset-key="18384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18385"><span data-slate-leaf="true" data-offset-key="18385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_SET_POWERSTUS 8 </span></span></span></span><span data-slate-object="text" data-key="18386"><span data-slate-leaf="true" data-offset-key="18386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 powerstus 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18387"><span data-slate-object="text" data-key="18388"><span data-slate-leaf="true" data-offset-key="18388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18389"><span data-slate-leaf="true" data-offset-key="18389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18390"><span data-slate-leaf="true" data-offset-key="18390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_ENUM_DEV 9 </span></span></span></span><span data-slate-object="text" data-key="18391"><span data-slate-leaf="true" data-offset-key="18391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 enum 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18392"><span data-slate-object="text" data-key="18393"><span data-slate-leaf="true" data-offset-key="18393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18394"><span data-slate-leaf="true" data-offset-key="18394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18395"><span data-slate-leaf="true" data-offset-key="18395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_FLUSH 10 </span></span></span></span><span data-slate-object="text" data-key="18396"><span data-slate-leaf="true" data-offset-key="18396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 flush 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18397"><span data-slate-object="text" data-key="18398"><span data-slate-leaf="true" data-offset-key="18398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18399"><span data-slate-leaf="true" data-offset-key="18399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18400"><span data-slate-leaf="true" data-offset-key="18400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_SHUTDOWN 11 </span></span></span></span><span data-slate-object="text" data-key="18401"><span data-slate-leaf="true" data-offset-key="18401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对应于 shutdown 操作</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18402"><span data-slate-object="text" data-key="18403"><span data-slate-leaf="true" data-offset-key="18403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="18404"><span data-slate-leaf="true" data-offset-key="18404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="18405"><span data-slate-leaf="true" data-offset-key="18405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> IOIF_CODE_MAX 12 </span></span></span></span><span data-slate-object="text" data-key="18406"><span data-slate-leaf="true" data-offset-key="18406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 最大功能码</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18407"><span data-slate-object="text" data-key="18408"><span data-slate-leaf="true" data-offset-key="18408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序分派函数指针类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18409"><span data-slate-object="text" data-key="18410"><span data-slate-leaf="true" data-offset-key="18410:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span></span><span data-slate-object="text" data-key="18411"><span data-slate-leaf="true" data-offset-key="18411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18412"><span data-slate-leaf="true" data-offset-key="18412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18413"><span data-slate-leaf="true" data-offset-key="18413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18414"><span data-slate-leaf="true" data-offset-key="18414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(*</span></span></span></span></span><span data-slate-object="text" data-key="18415"><span data-slate-leaf="true" data-offset-key="18415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drivcallfun_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18416"><span data-slate-leaf="true" data-offset-key="18416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="18417"><span data-slate-leaf="true" data-offset-key="18417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18418"><span data-slate-leaf="true" data-offset-key="18418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">device_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18419"><span data-slate-leaf="true" data-offset-key="18419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">*,</span></span></span></span></span><span data-slate-object="text" data-key="18420"><span data-slate-leaf="true" data-offset-key="18420:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18421"><span data-slate-leaf="true" data-offset-key="18421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">*)</span></span></span></span></span><span data-slate-object="text" data-key="18422"><span data-slate-leaf="true" data-offset-key="18422:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18423"><span data-slate-object="text" data-key="18424"><span data-slate-leaf="true" data-offset-key="18424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序入口、退出函数指针类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18425"><span data-slate-object="text" data-key="18426"><span data-slate-leaf="true" data-offset-key="18426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span></span><span data-slate-object="text" data-key="18427"><span data-slate-leaf="true" data-offset-key="18427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18428"><span data-slate-leaf="true" data-offset-key="18428:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drvstus_t</span></span></span></span></span><span data-slate-object="text" data-key="18429"><span data-slate-leaf="true" data-offset-key="18429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="18430"><span data-slate-leaf="true" data-offset-key="18430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(*</span></span></span></span></span><span data-slate-object="text" data-key="18431"><span data-slate-leaf="true" data-offset-key="18431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drventyexit_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18432"><span data-slate-leaf="true" data-offset-key="18432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="18433"><span data-slate-leaf="true" data-offset-key="18433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="18434"><span data-slate-leaf="true" data-offset-key="18434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span></span></span><span data-slate-object="text" data-key="18435"><span data-slate-leaf="true" data-offset-key="18435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> s_DRIVER*,</span></span></span></span></span><span data-slate-object="text" data-key="18436"><span data-slate-leaf="true" data-offset-key="18436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="18437"><span data-slate-leaf="true" data-offset-key="18437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">,</span></span></span></span></span><span data-slate-object="text" data-key="18438"><span data-slate-leaf="true" data-offset-key="18438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="18439"><span data-slate-leaf="true" data-offset-key="18439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">*)</span></span></span></span></span><span data-slate-object="text" data-key="18440"><span data-slate-leaf="true" data-offset-key="18440:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18441"><span data-slate-object="text" data-key="18442"><span data-slate-leaf="true" data-offset-key="18442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="18443"><span data-slate-leaf="true" data-offset-key="18443:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="18444"><span data-slate-leaf="true" data-offset-key="18444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="18445"><span data-slate-leaf="true" data-offset-key="18445:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="18446"><span data-slate-leaf="true" data-offset-key="18446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_DRIVER</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18447"><span data-slate-object="text" data-key="18448"><span data-slate-leaf="true" data-offset-key="18448:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18449"><span data-slate-object="text" data-key="18450"><span data-slate-leaf="true" data-offset-key="18450:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18451"><span data-slate-leaf="true" data-offset-key="18451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//……</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18452"><span data-slate-object="text" data-key="18453"><span data-slate-leaf="true" data-offset-key="18453:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18454"><span data-slate-leaf="true" data-offset-key="18454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drivcallfun_t</span></span></span></span><span data-slate-object="text" data-key="18455"><span data-slate-leaf="true" data-offset-key="18455:0" data-first-offset="true"><span data-slate-string="true"> drv_dipfun[IOIF_CODE_MAX];</span></span></span><span data-slate-object="text" data-key="18456"><span data-slate-leaf="true" data-offset-key="18456:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动程序分派函数指针数组。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18457"><span data-slate-object="text" data-key="18458"><span data-slate-leaf="true" data-offset-key="18458:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18459"><span data-slate-leaf="true" data-offset-key="18459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="18460"><span data-slate-leaf="true" data-offset-key="18460:0" data-first-offset="true"><span data-slate-string="true"> drv_alldevlist;</span></span></span><span data-slate-object="text" data-key="18461"><span data-slate-leaf="true" data-offset-key="18461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 驱动所管理的所有设备。</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18462"><span data-slate-object="text" data-key="18463"><span data-slate-leaf="true" data-offset-key="18463:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18464"><span data-slate-leaf="true" data-offset-key="18464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drventyexit_t</span></span></span></span><span data-slate-object="text" data-key="18465"><span data-slate-leaf="true" data-offset-key="18465:0" data-first-offset="true"><span data-slate-string="true"> drv_entry;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18466"><span data-slate-object="text" data-key="18467"><span data-slate-leaf="true" data-offset-key="18467:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18468"><span data-slate-leaf="true" data-offset-key="18468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">drventyexit_t</span></span></span></span><span data-slate-object="text" data-key="18469"><span data-slate-leaf="true" data-offset-key="18469:0" data-first-offset="true"><span data-slate-string="true"> drv_exit;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18470"><span data-slate-object="text" data-key="18471"><span data-slate-leaf="true" data-offset-key="18471:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="18472"><span data-slate-leaf="true" data-offset-key="18472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//……</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="18473"><span data-slate-object="text" data-key="18474"><span data-slate-leaf="true" data-offset-key="18474:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="18475"><span data-slate-leaf="true" data-offset-key="18475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">driver_t</span></span></span></span><span data-slate-object="text" data-key="18476"><span data-slate-leaf="true" data-offset-key="18476:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18477"><span data-slate-object="text" data-key="18478"><span data-slate-leaf="true" data-offset-key="18478:0" data-first-offset="true"><span data-slate-string="true">看到这里，你是不是明白了？driver_t 结构中的 drv_dipfun 函数指针数组，正是存放上述那 12 个驱动程序函数的指针。这样操作系统内核就能通过 driver_t 结构，调用到对应的驱动程序函数操作对应的设备了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="18479" id="sr-toc-10"><span data-slate-object="text" data-key="18480"><span data-slate-leaf="true" data-offset-key="18480:0" data-first-offset="true"><span data-slate-string="true">重点回顾</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="18481"><span data-slate-object="text" data-key="18482"><span data-slate-leaf="true" data-offset-key="18482:0" data-first-offset="true"><span data-slate-string="true">现在，我们搞明白了一个典型计算机的结构，里面有很多设备，需要操作系统合理地管理，而操作系统通过加载驱动程序来管理和使用设备，并为此提供了一系列的机制，这也是我们这节课的重点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18483"><span data-slate-object="text" data-key="18484"><span data-slate-leaf="true" data-offset-key="18484:0" data-first-offset="true"><span data-slate-string="true">1. 计算机结构，我们通过了解一个典型的计算机系统结构，明白了设备的多样性。然后我们对设备做了抽象分类，采用分权而治的方式，让操作系统通过驱动程序来管理设备，同时又能保证操作系统和驱动程序分离，达到操作系统和设备解耦的目的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18485"><span data-slate-object="text" data-key="18486"><span data-slate-leaf="true" data-offset-key="18486:0" data-first-offset="true"><span data-slate-string="true">2. 归纳整理设备和设备驱动的信息，抽象两个对应的数据结构，这两个数据结构在内存中的实例变量就代表一个设备和对应的驱动。然后，我们通过设备表结构组织了驱动和设备的数据结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18487"><span data-slate-object="text" data-key="18488"><span data-slate-leaf="true" data-offset-key="18488:0" data-first-offset="true"><span data-slate-string="true">3. 驱动程序最主要的工作是要操控设备，但这些个操作设备的动作是操作系统调用的，所以对驱动定义了必须要支持的 12 种标准方法，并对应到函数，这些函数的地址保存在驱动程序的数据结构中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18489"><span data-slate-object="text" data-key="18490"><span data-slate-leaf="true" data-offset-key="18490:0" data-first-offset="true"><span data-slate-string="true">你可能在想，我们驱动程序是怎么加载的，设备又是怎么建立的呢？这是正是我们后面课程要解决的。不过你可以先开动脑筋，思考一下，提出你自己的见解，考虑一下这个问题的解决方案。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="18491" id="sr-toc-11"><span data-slate-object="text" data-key="18492"><span data-slate-leaf="true" data-offset-key="18492:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="18493"><span data-slate-object="text" data-key="18494"><span data-slate-leaf="true" data-offset-key="18494:0" data-first-offset="true"><span data-slate-string="true">请你写出一个用来访问设备的接口函数，或者想一下访问一个设备需要什么参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18495"><span data-slate-object="text" data-key="18496"><span data-slate-leaf="true" data-offset-key="18496:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区跟我交流互动，积极输出有助于更高效地理解这节课的内容。也欢迎你把这节课分享给同事、朋友。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="18497"><span data-slate-object="text" data-key="18498"><span data-slate-leaf="true" data-offset-key="18498:0" data-first-offset="true"><span data-slate-string="true">好，我是 LMOS。我们下节课见！</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-12">精选留言 (6)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>neohope</span></div><span>置顶</span></div><div>一、数据结构
有一个全局 devtable_t 结构变量 osdevtable，用于管理全部驱动程序及设备，其中包括：
A、全局驱动程序链表，保存全部驱动【driver_t 结构】
B、全局设备链表，包括各种设备类型的链表【devtlst_t 结构】，每个 devtlst_t 中包括了某一类型的全部设备链表【device_t 结构】

device_t 用于描述一个设备，其中包括：
A、devid_t 用于描述设备 ID【包括设备类型、设备子类型、设备序列号等】
B、driver_t 指针用于指向设备驱动程序，从设备可以找到驱动

driver_t 用于描述一个驱动程序，其中包括：
A、驱动功能函数指针数组 drivcallfun_t []
B、包括使用该驱动程序的全部设备的列表，从驱动可以找到设备

二、驱动程序，函数有三类
设备中断处理函数
驱动入口和退出函数
驱动功能函数

三、初始化
init_krl-&gt;init_krldevice-&gt;devtable_t_init
-&gt; 初始化全局设备列表
-&gt; 初始化全局驱动列表
-&gt; 对于每类设备，初始化 devtlst_t 结构</div><div><p>作者回复：总结的好</p></div><div><div>2021-07-19</div><div><div><i></i></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 青玉白露</span></div></div><div>访问一个设备的接口函数大致如下：
drvstus_t device_getdata (device_t* devp,void* iopack);
其中，device* 指向设备本身的结构体，相当于给这个函数传入了设备的属性值；
而 void* iopack 是一个无属性的内存块，具体需要传入什么参数，根据访问该设备将要实现的功能而定。
彭老师加油！我这两天终于把之前囤的十几节课看完了，等周末写几篇博客总结一下！</div><div><p>作者回复：好的 </p></div><div><div>2021-07-13</div><div><div><i></i><span>2</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/21/1d/97/9a8b2d0c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>🙃</span></div></div><div>叮～先打个卡 上一节进程调度讲的太精彩了，相信这一篇也是宝藏文章</div><div><p>作者回复：哈哈 我努力让大家满意</p></div><div><div>2021-07-12</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>照葫芦画瓢:

// 读设备数据函数
drvstus_t device_read (device_t* devp,void* iopack);</div><div><p>作者回复：可以 可以</p></div><div><div>2021-07-12</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2d/06/30/c26ea06a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 艾恩凝</span></div></div><div>代码看的越来越轻松了，也更容易理解了，进度也加快了，打卡</div><div><p>作者回复：加油</p></div><div><div>2022-05-07</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>coconut</span></div></div><div>接口参数应该包含：设备 id，操作类型，操作数</div><div><p>作者回复：对的</p></div><div><div>2021-11-30</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".v"><outline class="toc-level-h1" data-reactid=".v.0" style="width: 175px;"><active data-reactid=".v.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".v.0.1"><span data-reactid=".v.0.1.0">28 | 部门分类：如何表示设备类型与设备驱动？</span></a></outline><outline class="toc-level-h2" data-reactid=".v.1" style="width: 165px;"><active data-reactid=".v.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".v.1.1"><span data-reactid=".v.1.1.0">计算机的结构</span></a></outline><outline class="toc-level-h2" data-reactid=".v.2" style="width: 165px;"><active data-reactid=".v.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".v.2.1"><span data-reactid=".v.2.1.0">如何管理设备</span></a></outline><outline class="toc-level-h3" data-reactid=".v.3" style="width: 155px;"><active data-reactid=".v.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".v.3.1"><span data-reactid=".v.3.1.0">分权而治</span></a></outline><outline class="toc-level-h3" data-reactid=".v.4" style="width: 155px;"><active data-reactid=".v.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".v.4.1"><span data-reactid=".v.4.1.0">设备分类</span></a></outline><outline class="toc-level-h2" data-reactid=".v.5" style="width: 165px;"><active data-reactid=".v.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".v.5.1"><span data-reactid=".v.5.1.0">设备驱动</span></a></outline><outline class="toc-level-h3" data-reactid=".v.6" style="width: 155px;"><active data-reactid=".v.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".v.6.1"><span data-reactid=".v.6.1.0">设备</span></a></outline><outline class="toc-level-h3" data-reactid=".v.7" style="width: 155px;"><active data-reactid=".v.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".v.7.1"><span data-reactid=".v.7.1.0">驱动</span></a></outline><outline class="toc-level-h3" data-reactid=".v.8" style="width: 155px;"><active data-reactid=".v.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".v.8.1"><span data-reactid=".v.8.1.0">设备驱动的组织</span></a></outline><outline class="toc-level-h3" data-reactid=".v.9" style="width: 155px;"><active data-reactid=".v.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".v.9.1"><span data-reactid=".v.9.1.0">驱动程序功能</span></a></outline><outline class="toc-level-h2" data-reactid=".v.a" style="width: 165px;"><active data-reactid=".v.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".v.a.1"><span data-reactid=".v.a.1.0">重点回顾</span></a></outline><outline class="toc-level-h2" data-reactid=".v.b" style="width: 165px;"><active data-reactid=".v.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".v.b.1"><span data-reactid=".v.b.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".v.c" style="width: 165px;"><active data-reactid=".v.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".v.c.1"><span data-reactid=".v.c.1.0">精选留言 (6)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/394084" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>