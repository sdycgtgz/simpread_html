
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 14 | 构建网络：一站式实现模型搭建与训练</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>14 | 构建网络：一站式实现模型搭建与训练</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">今天这次加餐，我们就一起来看看什么是机器学习，它是怎么分类的，都有哪些常见名词。在补充了这些基础知识之后，我还会和你聊聊模型训练的本质是什么</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 14 | 构建网络：一站式实现模型搭建与训练</h1><div><span>方远</span> <span> 2021-11-12</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/53/51/5332b4c26b1cd678770a0f71974dcf51.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：方远</span><span>大小：14.32M</span><span> 时长：15:40</span></div></div><audio title="14 | 构建网络：一站式实现模型搭建与训练" src="https://res001.geekbang.org/media/audio/83/a4/838e7019bac957ef1d8a760d37f29ea4/ld/ld.m3u8" __idm_id__="81932"></audio></div><div><div><div><div data-slate-editor="true" data-key="7667" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="7668"><span data-slate-object="text" data-key="7669"><span data-slate-leaf="true" data-offset-key="7669:0" data-first-offset="true"><span data-slate-string="true">你好，我是方远。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7670"><span data-slate-object="text" data-key="7671"><span data-slate-leaf="true" data-offset-key="7671:0" data-first-offset="true"><span data-slate-string="true">前面我们花了不少时间，既学习了数据部分的知识，还研究了模型的优化方法、损失函数以及卷积计算。你可能感觉这些知识还有些零零散散，但其实我们不知不觉中，已经拿下了模型训练的必学内容。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7672"><span data-slate-object="text" data-key="7673"><span data-slate-leaf="true" data-offset-key="7673:0" data-first-offset="true"><span data-slate-string="true">今天这节课，也是一个中期小练习，是我们检验自己学习效果的好时机。我会带你使用 PyTorch 构建和训练一个自己的模型。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7674"><span data-slate-object="text" data-key="7675"><span data-slate-leaf="true" data-offset-key="7675:0" data-first-offset="true"><span data-slate-string="true">具体我是这么安排的，首先讲解搭建网络必备的基础模块 ——nn.Module 模块，也就是如何自己构建一个网络，并且训练它，换句话说，就是搞清楚 VGG、Inception 那些网络是怎么训练出来的。然后我们再看看如何借助 Torchvision 的模型作为预训练模型，来训练我们自己的模型。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7676" id="sr-toc-1"><span data-slate-object="text" data-key="7677"><span data-slate-leaf="true" data-offset-key="7677:0" data-first-offset="true"><span data-slate-string="true">构建自己的模型</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7678"><span data-slate-object="text" data-key="7679"><span data-slate-leaf="true" data-offset-key="7679:0" data-first-offset="true"><span data-slate-string="true">让我们直接切入主题，使用 PyTorch，自己构建并训练一个线性回归模型，来拟合出训练集中的走势分布。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7680"><span data-slate-object="text" data-key="7681"><span data-slate-leaf="true" data-offset-key="7681:0" data-first-offset="true"><span data-slate-string="true">我们先随机生成训练集 X 与对应的标签 Y，具体代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7682"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7683"><span data-slate-object="text" data-key="7684"><span data-slate-leaf="true" data-offset-key="7684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7685"><span data-slate-leaf="true" data-offset-key="7685:0" data-first-offset="true"><span data-slate-string="true"> numpy </span></span></span><span data-slate-object="text" data-key="7686"><span data-slate-leaf="true" data-offset-key="7686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="7687"><span data-slate-leaf="true" data-offset-key="7687:0" data-first-offset="true"><span data-slate-string="true"> np</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7688"><span data-slate-object="text" data-key="7689"><span data-slate-leaf="true" data-offset-key="7689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7690"><span data-slate-leaf="true" data-offset-key="7690:0" data-first-offset="true"><span data-slate-string="true"> random</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7691"><span data-slate-object="text" data-key="7692"><span data-slate-leaf="true" data-offset-key="7692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="7693"><span data-slate-leaf="true" data-offset-key="7693:0" data-first-offset="true"><span data-slate-string="true"> matplotlib </span></span></span><span data-slate-object="text" data-key="7694"><span data-slate-leaf="true" data-offset-key="7694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7695"><span data-slate-leaf="true" data-offset-key="7695:0" data-first-offset="true"><span data-slate-string="true"> pyplot </span></span></span><span data-slate-object="text" data-key="7696"><span data-slate-leaf="true" data-offset-key="7696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="7697"><span data-slate-leaf="true" data-offset-key="7697:0" data-first-offset="true"><span data-slate-string="true"> plt</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7698"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7699"><span data-slate-object="text" data-key="7700"><span data-slate-leaf="true" data-offset-key="7700:0" data-first-offset="true"><span data-slate-string="true">w = </span></span></span><span data-slate-object="text" data-key="7701"><span data-slate-leaf="true" data-offset-key="7701:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7702"><span data-slate-object="text" data-key="7703"><span data-slate-leaf="true" data-offset-key="7703:0" data-first-offset="true"><span data-slate-string="true">b = </span></span></span><span data-slate-object="text" data-key="7704"><span data-slate-leaf="true" data-offset-key="7704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7705"><span data-slate-object="text" data-key="7706"><span data-slate-leaf="true" data-offset-key="7706:0" data-first-offset="true"><span data-slate-string="true">xlim = [-</span></span></span><span data-slate-object="text" data-key="7707"><span data-slate-leaf="true" data-offset-key="7707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="7708"><span data-slate-leaf="true" data-offset-key="7708:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7709"><span data-slate-leaf="true" data-offset-key="7709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="7710"><span data-slate-leaf="true" data-offset-key="7710:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7711"><span data-slate-object="text" data-key="7712"><span data-slate-leaf="true" data-offset-key="7712:0" data-first-offset="true"><span data-slate-string="true">x_train = np.random.randint(low=xlim[</span></span></span><span data-slate-object="text" data-key="7713"><span data-slate-leaf="true" data-offset-key="7713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7714"><span data-slate-leaf="true" data-offset-key="7714:0" data-first-offset="true"><span data-slate-string="true">], high=xlim[</span></span></span><span data-slate-object="text" data-key="7715"><span data-slate-leaf="true" data-offset-key="7715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7716"><span data-slate-leaf="true" data-offset-key="7716:0" data-first-offset="true"><span data-slate-string="true">], size=</span></span></span><span data-slate-object="text" data-key="7717"><span data-slate-leaf="true" data-offset-key="7717:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">30</span></span></span></span><span data-slate-object="text" data-key="7718"><span data-slate-leaf="true" data-offset-key="7718:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7719"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7720"><span data-slate-object="text" data-key="7721"><span data-slate-leaf="true" data-offset-key="7721:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">y_train = [w * x + b + random.randint(</span></span></span></span><span data-slate-object="text" data-key="7722"><span data-slate-leaf="true" data-offset-key="7722:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></span><span data-slate-object="text" data-key="7723"><span data-slate-leaf="true" data-offset-key="7723:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">,</span></span></span></span><span data-slate-object="text" data-key="7724"><span data-slate-leaf="true" data-offset-key="7724:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></span><span data-slate-object="text" data-key="7725"><span data-slate-leaf="true" data-offset-key="7725:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">) </span></span></span></span><span data-slate-object="text" data-key="7726"><span data-slate-leaf="true" data-offset-key="7726:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span></span><span data-slate-object="text" data-key="7727"><span data-slate-leaf="true" data-offset-key="7727:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> x </span></span></span></span><span data-slate-object="text" data-key="7728"><span data-slate-leaf="true" data-offset-key="7728:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span></span><span data-slate-object="text" data-key="7729"><span data-slate-leaf="true" data-offset-key="7729:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e8e4e5f2" data-attr-id="44455" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> x_train]</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7730"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7731"><span data-slate-object="text" data-key="7732"><span data-slate-leaf="true" data-offset-key="7732:0" data-first-offset="true"><span data-slate-string="true">plt.plot(x_train, y_train, </span></span></span><span data-slate-object="text" data-key="7733"><span data-slate-leaf="true" data-offset-key="7733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'bo'</span></span></span></span><span data-slate-object="text" data-key="7734"><span data-slate-leaf="true" data-offset-key="7734:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7735"><span data-slate-object="text" data-key="7736"><span data-slate-leaf="true" data-offset-key="7736:0" data-first-offset="true"><span data-slate-string="true">上述代码中生成的数据，整理成散点图以后，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7737"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f2/11/f2d24e9e7ea5737a78032b686282ca11.jpg?wh=900x621" style="width: auto;"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7738"><span data-slate-object="text" data-key="7739"><span data-slate-leaf="true" data-offset-key="7739:0" data-first-offset="true"><span data-slate-string="true">熟悉回归的同学应该知道，我们的回归模型为：</span></span></span><span data-slate-type="inline-katex" data-slate-object="inline" data-key="7740"><span data-slate-leaf="true"><span data-slate-string="true"><span aria-hidden="true"><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>w</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span></span></span></span></span></span><span data-slate-object="text" data-key="7742"><span data-slate-leaf="true" data-offset-key="7742:0" data-first-offset="true"><span data-slate-string="true">。这里的 x 与 y，其实就对应上述代码中的 x_train 与 y_train，而 w 与 b 正是我们要学习的参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7743"><span data-slate-object="text" data-key="7744"><span data-slate-leaf="true" data-offset-key="7744:0" data-first-offset="true"><span data-slate-string="true">好，那么我们看看如何构建这个模型。我们还是先看代码，再具体讲解。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7745"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7746"><span data-slate-object="text" data-key="7747"><span data-slate-leaf="true" data-offset-key="7747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7748"><span data-slate-leaf="true" data-offset-key="7748:0" data-first-offset="true"><span data-slate-string="true"> torch</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7749"><span data-slate-object="text" data-key="7750"><span data-slate-leaf="true" data-offset-key="7750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="7751"><span data-slate-leaf="true" data-offset-key="7751:0" data-first-offset="true"><span data-slate-string="true"> torch </span></span></span><span data-slate-object="text" data-key="7752"><span data-slate-leaf="true" data-offset-key="7752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="7753"><span data-slate-leaf="true" data-offset-key="7753:0" data-first-offset="true"><span data-slate-string="true"> nn</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7754"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7755"><span data-slate-object="text" data-key="7756"><span data-slate-leaf="true" data-offset-key="7756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="7757"><span data-slate-leaf="true" data-offset-key="7757:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7758"><span data-slate-leaf="true" data-offset-key="7758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LinearModel</span></span></span></span><span data-slate-object="text" data-key="7759"><span data-slate-leaf="true" data-offset-key="7759:0" data-first-offset="true"><span data-slate-string="true">(nn.Module):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7760"><span data-slate-object="text" data-key="7761"><span data-slate-leaf="true" data-offset-key="7761:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7762"><span data-slate-leaf="true" data-offset-key="7762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7763"><span data-slate-leaf="true" data-offset-key="7763:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7764"><span data-slate-leaf="true" data-offset-key="7764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="7765"><span data-slate-leaf="true" data-offset-key="7765:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7766"><span data-slate-leaf="true" data-offset-key="7766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7767"><span data-slate-leaf="true" data-offset-key="7767:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7768"><span data-slate-object="text" data-key="7769"><span data-slate-leaf="true" data-offset-key="7769:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7770"><span data-slate-leaf="true" data-offset-key="7770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="7771"><span data-slate-leaf="true" data-offset-key="7771:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7772"><span data-slate-object="text" data-key="7773"><span data-slate-leaf="true" data-offset-key="7773:0" data-first-offset="true"><span data-slate-string="true">    self.weight = nn.Parameter(torch.randn(</span></span></span><span data-slate-object="text" data-key="7774"><span data-slate-leaf="true" data-offset-key="7774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7775"><span data-slate-leaf="true" data-offset-key="7775:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7776"><span data-slate-object="text" data-key="7777"><span data-slate-leaf="true" data-offset-key="7777:0" data-first-offset="true"><span data-slate-string="true">    self.bias = nn.Parameter(torch.randn(</span></span></span><span data-slate-object="text" data-key="7778"><span data-slate-leaf="true" data-offset-key="7778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7779"><span data-slate-leaf="true" data-offset-key="7779:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7780"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7781"><span data-slate-object="text" data-key="7782"><span data-slate-leaf="true" data-offset-key="7782:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7783"><span data-slate-leaf="true" data-offset-key="7783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7784"><span data-slate-leaf="true" data-offset-key="7784:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7785"><span data-slate-leaf="true" data-offset-key="7785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forward</span></span></span></span><span data-slate-object="text" data-key="7786"><span data-slate-leaf="true" data-offset-key="7786:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7787"><span data-slate-leaf="true" data-offset-key="7787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, </span></span></span></span><span data-slate-object="text" data-key="7788"><span data-slate-leaf="true" data-offset-key="7788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span></span><span data-slate-object="text" data-key="7789"><span data-slate-leaf="true" data-offset-key="7789:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7790"><span data-slate-object="text" data-key="7791"><span data-slate-leaf="true" data-offset-key="7791:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7792"><span data-slate-leaf="true" data-offset-key="7792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7793"><span data-slate-leaf="true" data-offset-key="7793:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="7794"><span data-slate-leaf="true" data-offset-key="7794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="7795"><span data-slate-leaf="true" data-offset-key="7795:0" data-first-offset="true"><span data-slate-string="true"> * self.weight) + self.bias</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7796"><span data-slate-object="text" data-key="7797"><span data-slate-leaf="true" data-offset-key="7797:0" data-first-offset="true"><span data-slate-string="true">通过上面这个线性回归模型的例子，我们可以引出构建网络时的重要几个知识点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7798"><span data-slate-object="text" data-key="7799"><span data-slate-leaf="true" data-offset-key="7799:0" data-first-offset="true"><span data-slate-string="true">1.</span></span></span><span data-slate-object="text" data-key="7800"><span data-slate-leaf="true" data-offset-key="7800:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 必须继承 nn.Module 类</span></span></span></span><span data-slate-object="text" data-key="7801"><span data-slate-leaf="true" data-offset-key="7801:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7802"><span data-slate-object="text" data-key="7803"><span data-slate-leaf="true" data-offset-key="7803:0" data-first-offset="true"><span data-slate-string="true">2.</span></span></span><span data-slate-object="text" data-key="7804"><span data-slate-leaf="true" data-offset-key="7804:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 重写 __init__() 方法</span></span></span></span><span data-slate-object="text" data-key="7805"><span data-slate-leaf="true" data-offset-key="7805:0" data-first-offset="true"><span data-slate-string="true">。通常来说要把有需要学习的参数的层放到构造函数中，例如，例子中的 weight 与 bias，还有我们之前学习的卷积层。我们在上述的 __init__() 中使用了 nn.Parameter ()，它主要的作用就是作为 nn.Module 中可训练的参数使用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7806"><span data-slate-object="text" data-key="7807"><span data-slate-leaf="true" data-offset-key="7807:0" data-first-offset="true"><span data-slate-string="true">3.</span></span></span><span data-slate-object="text" data-key="7808"><span data-slate-leaf="true" data-offset-key="7808:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">forward () 是必须重写的方法</span></span></span></span><span data-slate-object="text" data-key="7809"><span data-slate-leaf="true" data-offset-key="7809:0" data-first-offset="true"><span data-slate-string="true">。看函数名也可以知道，它是用来定义这个模型是如何计算输出的，也就是前向传播。对应到我们的例子，就是获得最终输出 y=weight * x+bias 的计算结果。对于一些不需要学习参数的层，一般来说可以放在这里。例如，BN 层，激活函数还有 Dropout。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7810" id="sr-toc-2"><span data-slate-object="text" data-key="7811"><span data-slate-leaf="true" data-offset-key="7811:0" data-first-offset="true"><span data-slate-string="true">nn.Module 模块</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7812"><span data-slate-object="text" data-key="7813"><span data-slate-leaf="true" data-offset-key="7813:0" data-first-offset="true"><span data-slate-string="true">nn.Module 是所有神经网络模块的基类。当我们自己要设计一个网络结构的时候，就要继承该类。也就说，其实 Torchvison 中的那些模型，也都是通过继承 nn.Module 模块来构建网络模型的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7814"><span data-slate-object="text" data-key="7815"><span data-slate-leaf="true" data-offset-key="7815:0" data-first-offset="true"><span data-slate-string="true">需要注意的是，</span></span></span><span data-slate-object="text" data-key="7816"><span data-slate-leaf="true" data-offset-key="7816:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">模块本身是 callable 的，当调用它的时候，就是执行 forward 函数，也就是前向传播</span></span></span></span><span data-slate-object="text" data-key="7817"><span data-slate-leaf="true" data-offset-key="7817:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7818"><span data-slate-object="text" data-key="7819"><span data-slate-leaf="true" data-offset-key="7819:0" data-first-offset="true"><span data-slate-string="true">我们还是结合代码例子直观感受一下。请看下面的代码，先创建一个 LinearModel 的实例 model，然后 model (x) 就相当于调用 LinearModel 中的 forward 方法。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7820"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7821"><span data-slate-object="text" data-key="7822"><span data-slate-leaf="true" data-offset-key="7822:0" data-first-offset="true"><span data-slate-string="true">model = LinearModel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7823"><span data-slate-object="text" data-key="7824"><span data-slate-leaf="true" data-offset-key="7824:0" data-first-offset="true"><span data-slate-string="true">x = torch.tensor(</span></span></span><span data-slate-object="text" data-key="7825"><span data-slate-leaf="true" data-offset-key="7825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7826"><span data-slate-leaf="true" data-offset-key="7826:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7827"><span data-slate-object="text" data-key="7828"><span data-slate-leaf="true" data-offset-key="7828:0" data-first-offset="true"><span data-slate-string="true">y = model(x)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7829"><span data-slate-object="text" data-key="7830"><span data-slate-leaf="true" data-offset-key="7830:0" data-first-offset="true"><span data-slate-string="true">在我们之前的课程里已经讲过，模型是通过前向传播与反向传播来计算梯度，然后更新参数的。我想学到这里，应该没有几个人会愿意去写反向传播和梯度更新之类的代码吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7831"><span data-slate-object="text" data-key="7832"><span data-slate-leaf="true" data-offset-key="7832:0" data-first-offset="true"><span data-slate-string="true">这个时候 PyTorch 的优点就体现出来了，当你训练时，PyTorch 的求导机制会帮你自动完成这些令人头大的计算。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7833"><span data-slate-object="text" data-key="7834"><span data-slate-leaf="true" data-offset-key="7834:0" data-first-offset="true"><span data-slate-string="true">除了刚才讲过的内容，关于初始化方法 __init__，你还需要关注的是，</span></span></span><span data-slate-object="text" data-key="7835"><span data-slate-leaf="true" data-offset-key="7835:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">必须调用父类的构造方法才可以</span></span></span></span><span data-slate-object="text" data-key="7836"><span data-slate-leaf="true" data-offset-key="7836:0" data-first-offset="true"><span data-slate-string="true">，也就是这行代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7837"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7838"><span data-slate-object="text" data-key="7839"><span data-slate-leaf="true" data-offset-key="7839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="7840"><span data-slate-leaf="true" data-offset-key="7840:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7841"><span data-slate-object="text" data-key="7842"><span data-slate-leaf="true" data-offset-key="7842:0" data-first-offset="true"><span data-slate-string="true">因为在 nn.Module 的 __init__() 中，会初始化一些有序的字典与集合。这些集合用来存储一些模型训练过程的中间变量，如果不初始化 nn.Module 中的这些参数的话，模型就会报下面的错误。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7843"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7844"><span data-slate-object="text" data-key="7845"><span data-slate-leaf="true" data-offset-key="7845:0" data-first-offset="true"><span data-slate-string="true">AttributeError: cannot assign parameters before Module.__init__() call</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="7846" id="sr-toc-3"><span data-slate-object="text" data-key="7847"><span data-slate-leaf="true" data-offset-key="7847:0" data-first-offset="true"><span data-slate-string="true">模型的训练</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="7848"><span data-slate-object="text" data-key="7849"><span data-slate-leaf="true" data-offset-key="7849:0" data-first-offset="true"><span data-slate-string="true">我们的模型定义好之后，还没有被训练。要想训练我们的模型，就需要用到损失函数与优化方法，这一部分前面课里（如果你感觉陌生的话，可以回顾 11～13 节课）已经学过了，所以现在我们直接看代码就可以了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7850"><span data-slate-object="text" data-key="7851"><span data-slate-leaf="true" data-offset-key="7851:0" data-first-offset="true"><span data-slate-string="true">这里选择的是 MSE 损失与 SGD 优化方法。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7852"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7853"><span data-slate-object="text" data-key="7854"><span data-slate-leaf="true" data-offset-key="7854:0" data-first-offset="true"><span data-slate-string="true">model = LinearModel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7855"><span data-slate-object="text" data-key="7856"><span data-slate-leaf="true" data-offset-key="7856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 定义优化器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7857"><span data-slate-object="text" data-key="7858"><span data-slate-leaf="true" data-offset-key="7858:0" data-first-offset="true"><span data-slate-string="true">optimizer = torch.optim.SGD(model.parameters(), lr=</span></span></span><span data-slate-object="text" data-key="7859"><span data-slate-leaf="true" data-offset-key="7859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1e-4</span></span></span></span><span data-slate-object="text" data-key="7860"><span data-slate-leaf="true" data-offset-key="7860:0" data-first-offset="true"><span data-slate-string="true">, weight_decay=</span></span></span><span data-slate-object="text" data-key="7861"><span data-slate-leaf="true" data-offset-key="7861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1e-2</span></span></span></span><span data-slate-object="text" data-key="7862"><span data-slate-leaf="true" data-offset-key="7862:0" data-first-offset="true"><span data-slate-string="true">, momentum=</span></span></span><span data-slate-object="text" data-key="7863"><span data-slate-leaf="true" data-offset-key="7863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.9</span></span></span></span><span data-slate-object="text" data-key="7864"><span data-slate-leaf="true" data-offset-key="7864:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7865"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7866"><span data-slate-object="text" data-key="7867"><span data-slate-leaf="true" data-offset-key="7867:0" data-first-offset="true"><span data-slate-string="true">y_train = torch.tensor(y_train, dtype=torch.float32)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7868"><span data-slate-object="text" data-key="7869"><span data-slate-leaf="true" data-offset-key="7869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="7870"><span data-slate-leaf="true" data-offset-key="7870:0" data-first-offset="true"><span data-slate-string="true"> _ </span></span></span><span data-slate-object="text" data-key="7871"><span data-slate-leaf="true" data-offset-key="7871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="7872"><span data-slate-leaf="true" data-offset-key="7872:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7873"><span data-slate-leaf="true" data-offset-key="7873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="7874"><span data-slate-leaf="true" data-offset-key="7874:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7875"><span data-slate-leaf="true" data-offset-key="7875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1000</span></span></span></span><span data-slate-object="text" data-key="7876"><span data-slate-leaf="true" data-offset-key="7876:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7877"><span data-slate-object="text" data-key="7878"><span data-slate-leaf="true" data-offset-key="7878:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7879"><span data-slate-leaf="true" data-offset-key="7879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="7880"><span data-slate-leaf="true" data-offset-key="7880:0" data-first-offset="true"><span data-slate-string="true"> = torch.from_numpy(x_train)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7881"><span data-slate-object="text" data-key="7882"><span data-slate-leaf="true" data-offset-key="7882:0" data-first-offset="true"><span data-slate-string="true">    output = model(</span></span></span><span data-slate-object="text" data-key="7883"><span data-slate-leaf="true" data-offset-key="7883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="7884"><span data-slate-leaf="true" data-offset-key="7884:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7885"><span data-slate-object="text" data-key="7886"><span data-slate-leaf="true" data-offset-key="7886:0" data-first-offset="true"><span data-slate-string="true">    loss = nn.MSELoss()(output, y_train)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7887"><span data-slate-object="text" data-key="7888"><span data-slate-leaf="true" data-offset-key="7888:0" data-first-offset="true"><span data-slate-string="true">    model.zero_grad()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7889"><span data-slate-object="text" data-key="7890"><span data-slate-leaf="true" data-offset-key="7890:0" data-first-offset="true"><span data-slate-string="true">    loss.backward()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7891"><span data-slate-object="text" data-key="7892"><span data-slate-leaf="true" data-offset-key="7892:0" data-first-offset="true"><span data-slate-string="true">    optimizer.step()</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7893"><span data-slate-object="text" data-key="7894"><span data-slate-leaf="true" data-offset-key="7894:0" data-first-offset="true"><span data-slate-string="true">经过 1000 个 Epoch 的训练以后，我们可以打印出模型的 weight 与 bias，看看是多少。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7895"><span data-slate-object="text" data-key="7896"><span data-slate-leaf="true" data-offset-key="7896:0" data-first-offset="true"><span data-slate-string="true">对于一个模型的</span></span></span><span data-slate-object="text" data-key="7897"><span data-slate-leaf="true" data-offset-key="7897:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">可训练</span></span></span></span><span data-slate-object="text" data-key="7898"><span data-slate-leaf="true" data-offset-key="7898:0" data-first-offset="true"><span data-slate-string="true">的参数，我们可以通过 named_parameters () 来查看，请看下面代码。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7899"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7900"><span data-slate-object="text" data-key="7901"><span data-slate-leaf="true" data-offset-key="7901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="7902"><span data-slate-leaf="true" data-offset-key="7902:0" data-first-offset="true"><span data-slate-string="true"> parameter </span></span></span><span data-slate-object="text" data-key="7903"><span data-slate-leaf="true" data-offset-key="7903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="7904"><span data-slate-leaf="true" data-offset-key="7904:0" data-first-offset="true"><span data-slate-string="true"> model.named_parameters():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7905"><span data-slate-object="text" data-key="7906"><span data-slate-leaf="true" data-offset-key="7906:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7907"><span data-slate-leaf="true" data-offset-key="7907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="7908"><span data-slate-leaf="true" data-offset-key="7908:0" data-first-offset="true"><span data-slate-string="true">(parameter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7909"><span data-slate-object="text" data-key="7910"><span data-slate-leaf="true" data-offset-key="7910:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 输出：</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7911"><span data-slate-object="text" data-key="7912"><span data-slate-leaf="true" data-offset-key="7912:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7913"><span data-slate-leaf="true" data-offset-key="7913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'weight'</span></span></span></span><span data-slate-object="text" data-key="7914"><span data-slate-leaf="true" data-offset-key="7914:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7915"><span data-slate-object="text" data-key="7916"><span data-slate-leaf="true" data-offset-key="7916:0" data-first-offset="true"><span data-slate-string="true">tensor([</span></span></span><span data-slate-object="text" data-key="7917"><span data-slate-leaf="true" data-offset-key="7917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2.0071</span></span></span></span><span data-slate-object="text" data-key="7918"><span data-slate-leaf="true" data-offset-key="7918:0" data-first-offset="true"><span data-slate-string="true">], requires_grad=</span></span></span><span data-slate-object="text" data-key="7919"><span data-slate-leaf="true" data-offset-key="7919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="7920"><span data-slate-leaf="true" data-offset-key="7920:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7921"><span data-slate-object="text" data-key="7922"><span data-slate-leaf="true" data-offset-key="7922:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7923"><span data-slate-leaf="true" data-offset-key="7923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'bias'</span></span></span></span><span data-slate-object="text" data-key="7924"><span data-slate-leaf="true" data-offset-key="7924:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7925"><span data-slate-object="text" data-key="7926"><span data-slate-leaf="true" data-offset-key="7926:0" data-first-offset="true"><span data-slate-string="true">tensor([</span></span></span><span data-slate-object="text" data-key="7927"><span data-slate-leaf="true" data-offset-key="7927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3.1690</span></span></span></span><span data-slate-object="text" data-key="7928"><span data-slate-leaf="true" data-offset-key="7928:0" data-first-offset="true"><span data-slate-string="true">], requires_grad=</span></span></span><span data-slate-object="text" data-key="7929"><span data-slate-leaf="true" data-offset-key="7929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="7930"><span data-slate-leaf="true" data-offset-key="7930:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7931"><span data-slate-object="text" data-key="7932"><span data-slate-leaf="true" data-offset-key="7932:0" data-first-offset="true"><span data-slate-string="true">可以看到，weight 是 2.0071，bias 是 3.1690，你再回头对一下我们创建训练数据的 w 与 b，它们是不是一样呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7933"><span data-slate-object="text" data-key="7934"><span data-slate-leaf="true" data-offset-key="7934:0" data-first-offset="true"><span data-slate-string="true">我们刚才说过，继承一个 nn.Module 之后，可以定义自己的网络模型。Module 同样可以作为另外一个 Module 的一部分，被包含在网络中。比如，我们要设计下面这样的一个网络：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7935"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/25/c6/2574b93463fd3dbd0e97661d6a06ffc6.jpg?wh=1372x689"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7936"><span data-slate-object="text" data-key="7937"><span data-slate-leaf="true" data-offset-key="7937:0" data-first-offset="true"><span data-slate-string="true">观察图片很容易就会发现，在这个网络中有大量重复的结构。上图中的 3x3 与 2x2 的卷积组合，按照我们开篇的讲解的话，我们需要把每一层卷积都定义到 __init__()，然后再在 forward 中定义好执行方法就可以了，例如下面的伪代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="7938"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7939"><span data-slate-object="text" data-key="7940"><span data-slate-leaf="true" data-offset-key="7940:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="7941"><span data-slate-leaf="true" data-offset-key="7941:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7942"><span data-slate-leaf="true" data-offset-key="7942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CustomModel</span></span></span></span><span data-slate-object="text" data-key="7943"><span data-slate-leaf="true" data-offset-key="7943:0" data-first-offset="true"><span data-slate-string="true">(nn.Module):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7944"><span data-slate-object="text" data-key="7945"><span data-slate-leaf="true" data-offset-key="7945:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="7946"><span data-slate-leaf="true" data-offset-key="7946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="7947"><span data-slate-leaf="true" data-offset-key="7947:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7948"><span data-slate-leaf="true" data-offset-key="7948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="7949"><span data-slate-leaf="true" data-offset-key="7949:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="7950"><span data-slate-leaf="true" data-offset-key="7950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="7951"><span data-slate-leaf="true" data-offset-key="7951:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7952"><span data-slate-object="text" data-key="7953"><span data-slate-leaf="true" data-offset-key="7953:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="7954"><span data-slate-leaf="true" data-offset-key="7954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="7955"><span data-slate-leaf="true" data-offset-key="7955:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7956"><span data-slate-object="text" data-key="7957"><span data-slate-leaf="true" data-offset-key="7957:0" data-first-offset="true"><span data-slate-string="true">    self.conv1_1 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="7958"><span data-slate-leaf="true" data-offset-key="7958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7959"><span data-slate-leaf="true" data-offset-key="7959:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="7960"><span data-slate-leaf="true" data-offset-key="7960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7961"><span data-slate-leaf="true" data-offset-key="7961:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="7962"><span data-slate-leaf="true" data-offset-key="7962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7963"><span data-slate-leaf="true" data-offset-key="7963:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="7964"><span data-slate-leaf="true" data-offset-key="7964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="7965"><span data-slate-leaf="true" data-offset-key="7965:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7966"><span data-slate-object="text" data-key="7967"><span data-slate-leaf="true" data-offset-key="7967:0" data-first-offset="true"><span data-slate-string="true">    self.conv1_2 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="7968"><span data-slate-leaf="true" data-offset-key="7968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7969"><span data-slate-leaf="true" data-offset-key="7969:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="7970"><span data-slate-leaf="true" data-offset-key="7970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7971"><span data-slate-leaf="true" data-offset-key="7971:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="7972"><span data-slate-leaf="true" data-offset-key="7972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7973"><span data-slate-leaf="true" data-offset-key="7973:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="7974"><span data-slate-leaf="true" data-offset-key="7974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="7975"><span data-slate-leaf="true" data-offset-key="7975:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7976"><span data-slate-object="text" data-key="7977"><span data-slate-leaf="true" data-offset-key="7977:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7978"><span data-slate-object="text" data-key="7979"><span data-slate-leaf="true" data-offset-key="7979:0" data-first-offset="true"><span data-slate-string="true">    self.conv_m_1 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="7980"><span data-slate-leaf="true" data-offset-key="7980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7981"><span data-slate-leaf="true" data-offset-key="7981:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="7982"><span data-slate-leaf="true" data-offset-key="7982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7983"><span data-slate-leaf="true" data-offset-key="7983:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="7984"><span data-slate-leaf="true" data-offset-key="7984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7985"><span data-slate-leaf="true" data-offset-key="7985:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="7986"><span data-slate-leaf="true" data-offset-key="7986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="7987"><span data-slate-leaf="true" data-offset-key="7987:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7988"><span data-slate-object="text" data-key="7989"><span data-slate-leaf="true" data-offset-key="7989:0" data-first-offset="true"><span data-slate-string="true">    self.conv_m_2 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="7990"><span data-slate-leaf="true" data-offset-key="7990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="7991"><span data-slate-leaf="true" data-offset-key="7991:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="7992"><span data-slate-leaf="true" data-offset-key="7992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7993"><span data-slate-leaf="true" data-offset-key="7993:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="7994"><span data-slate-leaf="true" data-offset-key="7994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7995"><span data-slate-leaf="true" data-offset-key="7995:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="7996"><span data-slate-leaf="true" data-offset-key="7996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="7997"><span data-slate-leaf="true" data-offset-key="7997:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7998"><span data-slate-object="text" data-key="7999"><span data-slate-leaf="true" data-offset-key="7999:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8000"><span data-slate-object="text" data-key="8001"><span data-slate-leaf="true" data-offset-key="8001:0" data-first-offset="true"><span data-slate-string="true">    self.conv_n_1 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="8002"><span data-slate-leaf="true" data-offset-key="8002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8003"><span data-slate-leaf="true" data-offset-key="8003:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="8004"><span data-slate-leaf="true" data-offset-key="8004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8005"><span data-slate-leaf="true" data-offset-key="8005:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="8006"><span data-slate-leaf="true" data-offset-key="8006:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8007"><span data-slate-leaf="true" data-offset-key="8007:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8008"><span data-slate-leaf="true" data-offset-key="8008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="8009"><span data-slate-leaf="true" data-offset-key="8009:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8010"><span data-slate-object="text" data-key="8011"><span data-slate-leaf="true" data-offset-key="8011:0" data-first-offset="true"><span data-slate-string="true">    self.conv_n_2 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="8012"><span data-slate-leaf="true" data-offset-key="8012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8013"><span data-slate-leaf="true" data-offset-key="8013:0" data-first-offset="true"><span data-slate-string="true">, out_channels=</span></span></span><span data-slate-object="text" data-key="8014"><span data-slate-leaf="true" data-offset-key="8014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8015"><span data-slate-leaf="true" data-offset-key="8015:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="8016"><span data-slate-leaf="true" data-offset-key="8016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8017"><span data-slate-leaf="true" data-offset-key="8017:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8018"><span data-slate-leaf="true" data-offset-key="8018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="8019"><span data-slate-leaf="true" data-offset-key="8019:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8020"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8021"><span data-slate-object="text" data-key="8022"><span data-slate-leaf="true" data-offset-key="8022:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8023"><span data-slate-leaf="true" data-offset-key="8023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="8024"><span data-slate-leaf="true" data-offset-key="8024:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8025"><span data-slate-leaf="true" data-offset-key="8025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forward</span></span></span></span><span data-slate-object="text" data-key="8026"><span data-slate-leaf="true" data-offset-key="8026:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8027"><span data-slate-leaf="true" data-offset-key="8027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, </span></span></span></span><span data-slate-object="text" data-key="8028"><span data-slate-leaf="true" data-offset-key="8028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span></span><span data-slate-object="text" data-key="8029"><span data-slate-leaf="true" data-offset-key="8029:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8030"><span data-slate-object="text" data-key="8031"><span data-slate-leaf="true" data-offset-key="8031:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv1_1(</span></span></span><span data-slate-object="text" data-key="8032"><span data-slate-leaf="true" data-offset-key="8032:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="8033"><span data-slate-leaf="true" data-offset-key="8033:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8034"><span data-slate-object="text" data-key="8035"><span data-slate-leaf="true" data-offset-key="8035:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv1_2(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8036"><span data-slate-object="text" data-key="8037"><span data-slate-leaf="true" data-offset-key="8037:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8038"><span data-slate-object="text" data-key="8039"><span data-slate-leaf="true" data-offset-key="8039:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv_m_1(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8040"><span data-slate-object="text" data-key="8041"><span data-slate-leaf="true" data-offset-key="8041:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv_m_2(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8042"><span data-slate-object="text" data-key="8043"><span data-slate-leaf="true" data-offset-key="8043:0" data-first-offset="true"><span data-slate-string="true">    ...    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8044"><span data-slate-object="text" data-key="8045"><span data-slate-leaf="true" data-offset-key="8045:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv_n_1(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8046"><span data-slate-object="text" data-key="8047"><span data-slate-leaf="true" data-offset-key="8047:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv_n_2(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8048"><span data-slate-object="text" data-key="8049"><span data-slate-leaf="true" data-offset-key="8049:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8050"><span data-slate-object="text" data-key="8051"><span data-slate-leaf="true" data-offset-key="8051:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="8052"><span data-slate-leaf="true" data-offset-key="8052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="8053"><span data-slate-leaf="true" data-offset-key="8053:0" data-first-offset="true"><span data-slate-string="true"> x</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8054"><span data-slate-object="text" data-key="8055"><span data-slate-leaf="true" data-offset-key="8055:0" data-first-offset="true"><span data-slate-string="true">其实这部分重复的结构完全可以放在一个单独的 module 中，然后，在我们模型中直接调用这部分即可，具体实现你可以参考下面的代码：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8056"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8057"><span data-slate-object="text" data-key="8058"><span data-slate-leaf="true" data-offset-key="8058:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="8059"><span data-slate-leaf="true" data-offset-key="8059:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8060"><span data-slate-leaf="true" data-offset-key="8060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CustomLayer</span></span></span></span><span data-slate-object="text" data-key="8061"><span data-slate-leaf="true" data-offset-key="8061:0" data-first-offset="true"><span data-slate-string="true">(nn.Module):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8062"><span data-slate-object="text" data-key="8063"><span data-slate-leaf="true" data-offset-key="8063:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8064"><span data-slate-leaf="true" data-offset-key="8064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="8065"><span data-slate-leaf="true" data-offset-key="8065:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8066"><span data-slate-leaf="true" data-offset-key="8066:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="8067"><span data-slate-leaf="true" data-offset-key="8067:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8068"><span data-slate-leaf="true" data-offset-key="8068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, input_channels, output_channels</span></span></span></span><span data-slate-object="text" data-key="8069"><span data-slate-leaf="true" data-offset-key="8069:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8070"><span data-slate-object="text" data-key="8071"><span data-slate-leaf="true" data-offset-key="8071:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="8072"><span data-slate-leaf="true" data-offset-key="8072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="8073"><span data-slate-leaf="true" data-offset-key="8073:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8074"><span data-slate-object="text" data-key="8075"><span data-slate-leaf="true" data-offset-key="8075:0" data-first-offset="true"><span data-slate-string="true">    self.conv1_1 = nn.Conv2d(in_channels=input_channels, out_channels=</span></span></span><span data-slate-object="text" data-key="8076"><span data-slate-leaf="true" data-offset-key="8076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8077"><span data-slate-leaf="true" data-offset-key="8077:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="8078"><span data-slate-leaf="true" data-offset-key="8078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8079"><span data-slate-leaf="true" data-offset-key="8079:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8080"><span data-slate-leaf="true" data-offset-key="8080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="8081"><span data-slate-leaf="true" data-offset-key="8081:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8082"><span data-slate-object="text" data-key="8083"><span data-slate-leaf="true" data-offset-key="8083:0" data-first-offset="true"><span data-slate-string="true">    self.conv1_2 = nn.Conv2d(in_channels=</span></span></span><span data-slate-object="text" data-key="8084"><span data-slate-leaf="true" data-offset-key="8084:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8085"><span data-slate-leaf="true" data-offset-key="8085:0" data-first-offset="true"><span data-slate-string="true">, out_channels=output_channels, kernel_size=</span></span></span><span data-slate-object="text" data-key="8086"><span data-slate-leaf="true" data-offset-key="8086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8087"><span data-slate-leaf="true" data-offset-key="8087:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8088"><span data-slate-leaf="true" data-offset-key="8088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'same'</span></span></span></span><span data-slate-object="text" data-key="8089"><span data-slate-leaf="true" data-offset-key="8089:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8090"><span data-slate-object="text" data-key="8091"><span data-slate-leaf="true" data-offset-key="8091:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8092"><span data-slate-object="text" data-key="8093"><span data-slate-leaf="true" data-offset-key="8093:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8094"><span data-slate-leaf="true" data-offset-key="8094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="8095"><span data-slate-leaf="true" data-offset-key="8095:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8096"><span data-slate-leaf="true" data-offset-key="8096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forward</span></span></span></span><span data-slate-object="text" data-key="8097"><span data-slate-leaf="true" data-offset-key="8097:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8098"><span data-slate-leaf="true" data-offset-key="8098:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, </span></span></span></span><span data-slate-object="text" data-key="8099"><span data-slate-leaf="true" data-offset-key="8099:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span></span><span data-slate-object="text" data-key="8100"><span data-slate-leaf="true" data-offset-key="8100:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8101"><span data-slate-object="text" data-key="8102"><span data-slate-leaf="true" data-offset-key="8102:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv1_1(</span></span></span><span data-slate-object="text" data-key="8103"><span data-slate-leaf="true" data-offset-key="8103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="8104"><span data-slate-leaf="true" data-offset-key="8104:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8105"><span data-slate-object="text" data-key="8106"><span data-slate-leaf="true" data-offset-key="8106:0" data-first-offset="true"><span data-slate-string="true">    x = self.conv1_2(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8107"><span data-slate-object="text" data-key="8108"><span data-slate-leaf="true" data-offset-key="8108:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="8109"><span data-slate-leaf="true" data-offset-key="8109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="8110"><span data-slate-leaf="true" data-offset-key="8110:0" data-first-offset="true"><span data-slate-string="true"> x</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8111"><span data-slate-object="text" data-key="8112"><span data-slate-leaf="true" data-offset-key="8112:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8113"><span data-slate-object="text" data-key="8114"><span data-slate-leaf="true" data-offset-key="8114:0" data-first-offset="true"><span data-slate-string="true">然后呢，CustomModel 就变成下面这样了：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8115"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8116"><span data-slate-object="text" data-key="8117"><span data-slate-leaf="true" data-offset-key="8117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="8118"><span data-slate-leaf="true" data-offset-key="8118:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8119"><span data-slate-leaf="true" data-offset-key="8119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CustomModel</span></span></span></span><span data-slate-object="text" data-key="8120"><span data-slate-leaf="true" data-offset-key="8120:0" data-first-offset="true"><span data-slate-string="true">(nn.Module):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8121"><span data-slate-object="text" data-key="8122"><span data-slate-leaf="true" data-offset-key="8122:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8123"><span data-slate-leaf="true" data-offset-key="8123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="8124"><span data-slate-leaf="true" data-offset-key="8124:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8125"><span data-slate-leaf="true" data-offset-key="8125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="8126"><span data-slate-leaf="true" data-offset-key="8126:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8127"><span data-slate-leaf="true" data-offset-key="8127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="8128"><span data-slate-leaf="true" data-offset-key="8128:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8129"><span data-slate-object="text" data-key="8130"><span data-slate-leaf="true" data-offset-key="8130:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="8131"><span data-slate-leaf="true" data-offset-key="8131:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="8132"><span data-slate-leaf="true" data-offset-key="8132:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8133"><span data-slate-object="text" data-key="8134"><span data-slate-leaf="true" data-offset-key="8134:0" data-first-offset="true"><span data-slate-string="true">    self.layer1 = CustomLayer(</span></span></span><span data-slate-object="text" data-key="8135"><span data-slate-leaf="true" data-offset-key="8135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8136"><span data-slate-leaf="true" data-offset-key="8136:0" data-first-offset="true"><span data-slate-string="true">，</span></span></span><span data-slate-object="text" data-key="8137"><span data-slate-leaf="true" data-offset-key="8137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8138"><span data-slate-leaf="true" data-offset-key="8138:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8139"><span data-slate-object="text" data-key="8140"><span data-slate-leaf="true" data-offset-key="8140:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8141"><span data-slate-object="text" data-key="8142"><span data-slate-leaf="true" data-offset-key="8142:0" data-first-offset="true"><span data-slate-string="true">    self.layerm = CustomLayer(</span></span></span><span data-slate-object="text" data-key="8143"><span data-slate-leaf="true" data-offset-key="8143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8144"><span data-slate-leaf="true" data-offset-key="8144:0" data-first-offset="true"><span data-slate-string="true">，</span></span></span><span data-slate-object="text" data-key="8145"><span data-slate-leaf="true" data-offset-key="8145:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8146"><span data-slate-leaf="true" data-offset-key="8146:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8147"><span data-slate-object="text" data-key="8148"><span data-slate-leaf="true" data-offset-key="8148:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8149"><span data-slate-object="text" data-key="8150"><span data-slate-leaf="true" data-offset-key="8150:0" data-first-offset="true"><span data-slate-string="true">    self.layern = CustomLayer(</span></span></span><span data-slate-object="text" data-key="8151"><span data-slate-leaf="true" data-offset-key="8151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8152"><span data-slate-leaf="true" data-offset-key="8152:0" data-first-offset="true"><span data-slate-string="true">，</span></span></span><span data-slate-object="text" data-key="8153"><span data-slate-leaf="true" data-offset-key="8153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8154"><span data-slate-leaf="true" data-offset-key="8154:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8155"><span data-slate-object="text" data-key="8156"><span data-slate-leaf="true" data-offset-key="8156:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8157"><span data-slate-object="text" data-key="8158"><span data-slate-leaf="true" data-offset-key="8158:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8159"><span data-slate-leaf="true" data-offset-key="8159:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="8160"><span data-slate-leaf="true" data-offset-key="8160:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="8161"><span data-slate-leaf="true" data-offset-key="8161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forward</span></span></span></span><span data-slate-object="text" data-key="8162"><span data-slate-leaf="true" data-offset-key="8162:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8163"><span data-slate-leaf="true" data-offset-key="8163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, </span></span></span></span><span data-slate-object="text" data-key="8164"><span data-slate-leaf="true" data-offset-key="8164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span></span><span data-slate-object="text" data-key="8165"><span data-slate-leaf="true" data-offset-key="8165:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8166"><span data-slate-object="text" data-key="8167"><span data-slate-leaf="true" data-offset-key="8167:0" data-first-offset="true"><span data-slate-string="true">    x = self.layer1(</span></span></span><span data-slate-object="text" data-key="8168"><span data-slate-leaf="true" data-offset-key="8168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="8169"><span data-slate-leaf="true" data-offset-key="8169:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8170"><span data-slate-object="text" data-key="8171"><span data-slate-leaf="true" data-offset-key="8171:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8172"><span data-slate-object="text" data-key="8173"><span data-slate-leaf="true" data-offset-key="8173:0" data-first-offset="true"><span data-slate-string="true">    x = self.layerm(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8174"><span data-slate-object="text" data-key="8175"><span data-slate-leaf="true" data-offset-key="8175:0" data-first-offset="true"><span data-slate-string="true">    ...    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8176"><span data-slate-object="text" data-key="8177"><span data-slate-leaf="true" data-offset-key="8177:0" data-first-offset="true"><span data-slate-string="true">    x = self.layern(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8178"><span data-slate-object="text" data-key="8179"><span data-slate-leaf="true" data-offset-key="8179:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8180"><span data-slate-object="text" data-key="8181"><span data-slate-leaf="true" data-offset-key="8181:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="8182"><span data-slate-leaf="true" data-offset-key="8182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="8183"><span data-slate-leaf="true" data-offset-key="8183:0" data-first-offset="true"><span data-slate-string="true"> x</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8184"><span data-slate-object="text" data-key="8185"><span data-slate-leaf="true" data-offset-key="8185:0" data-first-offset="true"><span data-slate-string="true">熟悉深度学习的同学，一定听过残差块、Inception 块这样的多层的一个组合。你没听过也没关系，在图像分类中我还会讲到。这里你只需要知道，这种多层组合的结构是类似的，对于这种组合，我们就可以用上面的代码的方式实现。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="8186" id="sr-toc-4"><span data-slate-object="text" data-key="8187"><span data-slate-leaf="true" data-offset-key="8187:0" data-first-offset="true"><span data-slate-string="true">模型保存与加载</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="8188"><span data-slate-object="text" data-key="8189"><span data-slate-leaf="true" data-offset-key="8189:0" data-first-offset="true"><span data-slate-string="true">我们训练好的模型最终的目的，就是要为其他应用提供服务的，这就涉及到了模型的保存与加载。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8190"><span data-slate-object="text" data-key="8191"><span data-slate-leaf="true" data-offset-key="8191:0" data-first-offset="true"><span data-slate-string="true">模型保存与加载的话有两种方式。PyTorch 模型的后缀名一般是 pt 或 pth，这都没有关系，只是一个后缀名而已。我们接着上面的回归模型继续讲模型的保存与加载。</span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="8192" id="sr-toc-5"><span data-slate-object="text" data-key="8193"><span data-slate-leaf="true" data-offset-key="8193:0" data-first-offset="true"><span data-slate-string="true">方式一：只保存训练好的参数</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="8194"><span data-slate-object="text" data-key="8195"><span data-slate-leaf="true" data-offset-key="8195:0" data-first-offset="true"><span data-slate-string="true">第一种方式就是只保存训练好的参数。然后加载模型的时候，你需要通过代码加载网络结构，然后再将参数赋予网络。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8196"><span data-slate-object="text" data-key="8197"><span data-slate-leaf="true" data-offset-key="8197:0" data-first-offset="true"><span data-slate-string="true">只保存参数的代码如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8198"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8199"><span data-slate-object="text" data-key="8200"><span data-slate-leaf="true" data-offset-key="8200:0" data-first-offset="true"><span data-slate-string="true">torch.save(model.state_dict(), </span></span></span><span data-slate-object="text" data-key="8201"><span data-slate-leaf="true" data-offset-key="8201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./linear_model.pth'</span></span></span></span><span data-slate-object="text" data-key="8202"><span data-slate-leaf="true" data-offset-key="8202:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8203"><span data-slate-object="text" data-key="8204"><span data-slate-leaf="true" data-offset-key="8204:0" data-first-offset="true"><span data-slate-string="true">第一个参数是模型的 state_dict，而第二个参数要保存的位置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8205"><span data-slate-object="text" data-key="8206"><span data-slate-leaf="true" data-offset-key="8206:0" data-first-offset="true"><span data-slate-string="true">代码中的 state_dict 是一个字典，在模型被定义之后会自动生成，存储的是模型</span></span></span><span data-slate-object="text" data-key="8207"><span data-slate-leaf="true" data-offset-key="8207:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">可训练</span></span></span></span><span data-slate-object="text" data-key="8208"><span data-slate-leaf="true" data-offset-key="8208:0" data-first-offset="true"><span data-slate-string="true">的参数。我们可以打印出线性回归模型的 state_dict，如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8209"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8210"><span data-slate-object="text" data-key="8211"><span data-slate-leaf="true" data-offset-key="8211:0" data-first-offset="true"><span data-slate-string="true">model.state_dict()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8212"><span data-slate-object="text" data-key="8213"><span data-slate-leaf="true" data-offset-key="8213:0" data-first-offset="true"><span data-slate-string="true">输出：OrderedDict ([(</span></span></span><span data-slate-object="text" data-key="8214"><span data-slate-leaf="true" data-offset-key="8214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'weight'</span></span></span></span><span data-slate-object="text" data-key="8215"><span data-slate-leaf="true" data-offset-key="8215:0" data-first-offset="true"><span data-slate-string="true">, tensor([[</span></span></span><span data-slate-object="text" data-key="8216"><span data-slate-leaf="true" data-offset-key="8216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2.0071</span></span></span></span><span data-slate-object="text" data-key="8217"><span data-slate-leaf="true" data-offset-key="8217:0" data-first-offset="true"><span data-slate-string="true">]])), (</span></span></span><span data-slate-object="text" data-key="8218"><span data-slate-leaf="true" data-offset-key="8218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'bias'</span></span></span></span><span data-slate-object="text" data-key="8219"><span data-slate-leaf="true" data-offset-key="8219:0" data-first-offset="true"><span data-slate-string="true">, tensor([</span></span></span><span data-slate-object="text" data-key="8220"><span data-slate-leaf="true" data-offset-key="8220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3.1690</span></span></span></span><span data-slate-object="text" data-key="8221"><span data-slate-leaf="true" data-offset-key="8221:0" data-first-offset="true"><span data-slate-string="true">]))])</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8222"><span data-slate-object="text" data-key="8223"><span data-slate-leaf="true" data-offset-key="8223:0" data-first-offset="true"><span data-slate-string="true">加载模型的方式如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8224"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8225"><span data-slate-object="text" data-key="8226"><span data-slate-leaf="true" data-offset-key="8226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 先定义网络结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8227"><span data-slate-object="text" data-key="8228"><span data-slate-leaf="true" data-offset-key="8228:0" data-first-offset="true"><span data-slate-string="true">linear_model = LinearModel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8229"><span data-slate-object="text" data-key="8230"><span data-slate-leaf="true" data-offset-key="8230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 加载保存的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8231"><span data-slate-object="text" data-key="8232"><span data-slate-leaf="true" data-offset-key="8232:0" data-first-offset="true"><span data-slate-string="true">linear_model.load_state_dict(torch.load(</span></span></span><span data-slate-object="text" data-key="8233"><span data-slate-leaf="true" data-offset-key="8233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./linear_model.pth'</span></span></span></span><span data-slate-object="text" data-key="8234"><span data-slate-leaf="true" data-offset-key="8234:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8235"><span data-slate-object="text" data-key="8236"><span data-slate-leaf="true" data-offset-key="8236:0" data-first-offset="true"><span data-slate-string="true">linear_model.</span></span></span><span data-slate-object="text" data-key="8237"><span data-slate-leaf="true" data-offset-key="8237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="8238"><span data-slate-leaf="true" data-offset-key="8238:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8239"><span data-slate-object="text" data-key="8240"><span data-slate-leaf="true" data-offset-key="8240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="8241"><span data-slate-leaf="true" data-offset-key="8241:0" data-first-offset="true"><span data-slate-string="true"> parameter </span></span></span><span data-slate-object="text" data-key="8242"><span data-slate-leaf="true" data-offset-key="8242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="8243"><span data-slate-leaf="true" data-offset-key="8243:0" data-first-offset="true"><span data-slate-string="true"> linear_model.named_parameters():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8244"><span data-slate-object="text" data-key="8245"><span data-slate-leaf="true" data-offset-key="8245:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8246"><span data-slate-leaf="true" data-offset-key="8246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="8247"><span data-slate-leaf="true" data-offset-key="8247:0" data-first-offset="true"><span data-slate-string="true">(parameter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8248"><span data-slate-object="text" data-key="8249"><span data-slate-leaf="true" data-offset-key="8249:0" data-first-offset="true"><span data-slate-string="true">输出：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8250"><span data-slate-object="text" data-key="8251"><span data-slate-leaf="true" data-offset-key="8251:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8252"><span data-slate-leaf="true" data-offset-key="8252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'weight'</span></span></span></span><span data-slate-object="text" data-key="8253"><span data-slate-leaf="true" data-offset-key="8253:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8254"><span data-slate-object="text" data-key="8255"><span data-slate-leaf="true" data-offset-key="8255:0" data-first-offset="true"><span data-slate-string="true">tensor([[</span></span></span><span data-slate-object="text" data-key="8256"><span data-slate-leaf="true" data-offset-key="8256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2.0071</span></span></span></span><span data-slate-object="text" data-key="8257"><span data-slate-leaf="true" data-offset-key="8257:0" data-first-offset="true"><span data-slate-string="true">]], requires_grad=</span></span></span><span data-slate-object="text" data-key="8258"><span data-slate-leaf="true" data-offset-key="8258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8259"><span data-slate-leaf="true" data-offset-key="8259:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8260"><span data-slate-object="text" data-key="8261"><span data-slate-leaf="true" data-offset-key="8261:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8262"><span data-slate-leaf="true" data-offset-key="8262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'bias'</span></span></span></span><span data-slate-object="text" data-key="8263"><span data-slate-leaf="true" data-offset-key="8263:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8264"><span data-slate-object="text" data-key="8265"><span data-slate-leaf="true" data-offset-key="8265:0" data-first-offset="true"><span data-slate-string="true">tensor([</span></span></span><span data-slate-object="text" data-key="8266"><span data-slate-leaf="true" data-offset-key="8266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3.1690</span></span></span></span><span data-slate-object="text" data-key="8267"><span data-slate-leaf="true" data-offset-key="8267:0" data-first-offset="true"><span data-slate-string="true">], requires_grad=</span></span></span><span data-slate-object="text" data-key="8268"><span data-slate-leaf="true" data-offset-key="8268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8269"><span data-slate-leaf="true" data-offset-key="8269:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8270"><span data-slate-object="text" data-key="8271"><span data-slate-leaf="true" data-offset-key="8271:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_bb15459d" data-attr-id="40731" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">这里有个 model.eval () 需要你注意一下，因为有些层（例如，Dropout 与 BN）在训练时与评估时的状态是不一样的，当进入评估时要执行 model.eval ()，</span></span></span><span data-slate-leaf="true" data-offset-key="8271:1"><span data-slate-string="true">模型才能进入评估状态。这里说的评估不光光指代评估模型，也包括模型上线时候时的状态。</span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="8272" id="sr-toc-6"><span data-slate-object="text" data-key="8273"><span data-slate-leaf="true" data-offset-key="8273:0" data-first-offset="true"><span data-slate-string="true">方式二：保存网络结构与参数</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="8274"><span data-slate-object="text" data-key="8275"><span data-slate-leaf="true" data-offset-key="8275:0" data-first-offset="true"><span data-slate-string="true">相比第一种方式，这种方式在加载模型的时候，不需要加载网络结构了。具体代码如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8276"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8277"><span data-slate-object="text" data-key="8278"><span data-slate-leaf="true" data-offset-key="8278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 保存整个模型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8279"><span data-slate-object="text" data-key="8280"><span data-slate-leaf="true" data-offset-key="8280:0" data-first-offset="true"><span data-slate-string="true">torch.save(model, </span></span></span><span data-slate-object="text" data-key="8281"><span data-slate-leaf="true" data-offset-key="8281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./linear_model_with_arc.pth'</span></span></span></span><span data-slate-object="text" data-key="8282"><span data-slate-leaf="true" data-offset-key="8282:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8283"><span data-slate-object="text" data-key="8284"><span data-slate-leaf="true" data-offset-key="8284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 加载模型，不需要创建网络了</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8285"><span data-slate-object="text" data-key="8286"><span data-slate-leaf="true" data-offset-key="8286:0" data-first-offset="true"><span data-slate-string="true">linear_model_2 = torch.load(</span></span></span><span data-slate-object="text" data-key="8287"><span data-slate-leaf="true" data-offset-key="8287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./linear_model_with_arc.pth'</span></span></span></span><span data-slate-object="text" data-key="8288"><span data-slate-leaf="true" data-offset-key="8288:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8289"><span data-slate-object="text" data-key="8290"><span data-slate-leaf="true" data-offset-key="8290:0" data-first-offset="true"><span data-slate-string="true">linear_model_2.</span></span></span><span data-slate-object="text" data-key="8291"><span data-slate-leaf="true" data-offset-key="8291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">eval</span></span></span></span><span data-slate-object="text" data-key="8292"><span data-slate-leaf="true" data-offset-key="8292:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8293"><span data-slate-object="text" data-key="8294"><span data-slate-leaf="true" data-offset-key="8294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="8295"><span data-slate-leaf="true" data-offset-key="8295:0" data-first-offset="true"><span data-slate-string="true"> parameter </span></span></span><span data-slate-object="text" data-key="8296"><span data-slate-leaf="true" data-offset-key="8296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="8297"><span data-slate-leaf="true" data-offset-key="8297:0" data-first-offset="true"><span data-slate-string="true"> linear_model_2.named_parameters():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8298"><span data-slate-object="text" data-key="8299"><span data-slate-leaf="true" data-offset-key="8299:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="8300"><span data-slate-leaf="true" data-offset-key="8300:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="8301"><span data-slate-leaf="true" data-offset-key="8301:0" data-first-offset="true"><span data-slate-string="true">(parameter)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8302"><span data-slate-object="text" data-key="8303"><span data-slate-leaf="true" data-offset-key="8303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 输出：</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8304"><span data-slate-object="text" data-key="8305"><span data-slate-leaf="true" data-offset-key="8305:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8306"><span data-slate-leaf="true" data-offset-key="8306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'weight'</span></span></span></span><span data-slate-object="text" data-key="8307"><span data-slate-leaf="true" data-offset-key="8307:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8308"><span data-slate-object="text" data-key="8309"><span data-slate-leaf="true" data-offset-key="8309:0" data-first-offset="true"><span data-slate-string="true">tensor([[</span></span></span><span data-slate-object="text" data-key="8310"><span data-slate-leaf="true" data-offset-key="8310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2.0071</span></span></span></span><span data-slate-object="text" data-key="8311"><span data-slate-leaf="true" data-offset-key="8311:0" data-first-offset="true"><span data-slate-string="true">]], requires_grad=</span></span></span><span data-slate-object="text" data-key="8312"><span data-slate-leaf="true" data-offset-key="8312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8313"><span data-slate-leaf="true" data-offset-key="8313:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8314"><span data-slate-object="text" data-key="8315"><span data-slate-leaf="true" data-offset-key="8315:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8316"><span data-slate-leaf="true" data-offset-key="8316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'bias'</span></span></span></span><span data-slate-object="text" data-key="8317"><span data-slate-leaf="true" data-offset-key="8317:0" data-first-offset="true"><span data-slate-string="true">, Parameter containing:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8318"><span data-slate-object="text" data-key="8319"><span data-slate-leaf="true" data-offset-key="8319:0" data-first-offset="true"><span data-slate-string="true">tensor([</span></span></span><span data-slate-object="text" data-key="8320"><span data-slate-leaf="true" data-offset-key="8320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3.1690</span></span></span></span><span data-slate-object="text" data-key="8321"><span data-slate-leaf="true" data-offset-key="8321:0" data-first-offset="true"><span data-slate-string="true">], requires_grad=</span></span></span><span data-slate-object="text" data-key="8322"><span data-slate-leaf="true" data-offset-key="8322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8323"><span data-slate-leaf="true" data-offset-key="8323:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8324"><span data-slate-object="text" data-key="8325"><span data-slate-leaf="true" data-offset-key="8325:0" data-first-offset="true"><span data-slate-string="true">这样操作以后，如果你成功输出了相应数值，而且跟之前保存的模型的参数一致，就说明加载对了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="8326" id="sr-toc-7"><span data-slate-object="text" data-key="8327"><span data-slate-leaf="true" data-offset-key="8327:0" data-first-offset="true"><span data-slate-string="true">使用 Torchvison 中的模型进行训练</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="8328"><span data-slate-object="text" data-key="8329"><span data-slate-leaf="true" data-offset-key="8329:0" data-first-offset="true"><span data-slate-string="true">我们前面说过，Torchvision 提供了一些封装好的网络结构，我们可以直接拿过来使用。但是并没有细说如何使用它们在我们的数据集上进行训练。今天，我们就来看看如何使用这些网络结构，在我们自己的数据上训练我们自己的模型。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="8330" id="sr-toc-8"><span data-slate-object="text" data-key="8331"><span data-slate-leaf="true" data-offset-key="8331:0" data-first-offset="true"><span data-slate-string="true">再说微调</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="8332"><span data-slate-object="text" data-key="8333"><span data-slate-leaf="true" data-offset-key="8333:0" data-first-offset="true"><span data-slate-string="true">其实，Torchvision 提供的模型最大的作用就是当作我们训练时的预训练模型，用来加速我们模型收敛的速度，这就是所谓的微调。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8334"><span data-slate-object="text" data-key="8335"><span data-slate-leaf="true" data-offset-key="8335:0" data-first-offset="true"><span data-slate-string="true">对于微调，最关键的一步就是之前讲的</span></span></span><span data-slate-object="text" data-key="8336"><span data-slate-leaf="true" data-offset-key="8336:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">调整最后全连接层输出的数目</span></span></span></span><span data-slate-object="text" data-key="8337"><span data-slate-leaf="true" data-offset-key="8337:0" data-first-offset="true"><span data-slate-string="true">。Torchvision 中只是对各大网络结构的复现，而不是对它们进行了统一的封装，所以在修改全连接层时，不同的网络有不同的修改方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8338"><span data-slate-object="text" data-key="8339"><span data-slate-leaf="true" data-offset-key="8339:0" data-first-offset="true"><span data-slate-string="true">不过你也别担心，这个修改并不复杂，你只需要打印出网络结构，就可以知道如何修改了。我们接下来以 AlexNet 为例带你尝试一下如何微调。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8340"><span data-slate-object="text" data-key="8341"><span data-slate-leaf="true" data-offset-key="8341:0" data-first-offset="true"><span data-slate-string="true">前面讲 Torchvision 的时候其实提到过一次微调，那个时候说的是固定整个网络的参数，只训练最后的全连接层。今天我再给你介绍另外一种微调的方式，那就是修改全连接层之后，整个网络都重新开始训练。只不过，这时候要使用预训练模型的参数作为初始化的参数，这种方式更为常用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8342"><span data-slate-object="text" data-key="8343"><span data-slate-leaf="true" data-offset-key="8343:0" data-first-offset="true"><span data-slate-string="true">接下来，我们就看看如何使用 Torchvision 中模型进行微调。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8344"><span data-slate-object="text" data-key="8345"><span data-slate-leaf="true" data-offset-key="8345:0" data-first-offset="true"><span data-slate-string="true">首先，导入模型。代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8346"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8347"><span data-slate-object="text" data-key="8348"><span data-slate-leaf="true" data-offset-key="8348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="8349"><span data-slate-leaf="true" data-offset-key="8349:0" data-first-offset="true"><span data-slate-string="true"> torchvision.models </span></span></span><span data-slate-object="text" data-key="8350"><span data-slate-leaf="true" data-offset-key="8350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="8351"><span data-slate-leaf="true" data-offset-key="8351:0" data-first-offset="true"><span data-slate-string="true"> models</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8352"><span data-slate-object="text" data-key="8353"><span data-slate-leaf="true" data-offset-key="8353:0" data-first-offset="true"><span data-slate-string="true">alexnet = models.alexnet(pretrained=</span></span></span><span data-slate-object="text" data-key="8354"><span data-slate-leaf="true" data-offset-key="8354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8355"><span data-slate-leaf="true" data-offset-key="8355:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8356"><span data-slate-object="text" data-key="8357"><span data-slate-leaf="true" data-offset-key="8357:0" data-first-offset="true"><span data-slate-string="true">这一步如果你不能 “科学上网” 的话，可能会比较慢。你可以先根据命令中提示的 url 手动下载，然后使用今天讲的模型加载的方式加载预训练模型，代码如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8358"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8359"><span data-slate-object="text" data-key="8360"><span data-slate-leaf="true" data-offset-key="8360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="8361"><span data-slate-leaf="true" data-offset-key="8361:0" data-first-offset="true"><span data-slate-string="true"> torchvision.models </span></span></span><span data-slate-object="text" data-key="8362"><span data-slate-leaf="true" data-offset-key="8362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="8363"><span data-slate-leaf="true" data-offset-key="8363:0" data-first-offset="true"><span data-slate-string="true"> models</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8364"><span data-slate-object="text" data-key="8365"><span data-slate-leaf="true" data-offset-key="8365:0" data-first-offset="true"><span data-slate-string="true">alexnet = models.alexnet()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8366"><span data-slate-object="text" data-key="8367"><span data-slate-leaf="true" data-offset-key="8367:0" data-first-offset="true"><span data-slate-string="true">alexnet.load_state_dict(torch.load(</span></span></span><span data-slate-object="text" data-key="8368"><span data-slate-leaf="true" data-offset-key="8368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./model/alexnet-owt-4df8aa71.pth'</span></span></span></span><span data-slate-object="text" data-key="8369"><span data-slate-leaf="true" data-offset-key="8369:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8370"><span data-slate-object="text" data-key="8371"><span data-slate-leaf="true" data-offset-key="8371:0" data-first-offset="true"><span data-slate-string="true">为了验证加载是否成功，我们让它对下图进行预测：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="8372"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/66/20/666181b44c23e9075debe0daf6126b20.jpg?wh=1920x1867"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8373"><span data-slate-object="text" data-key="8374"><span data-slate-leaf="true" data-offset-key="8374:0" data-first-offset="true"><span data-slate-string="true">代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8375"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8376"><span data-slate-object="text" data-key="8377"><span data-slate-leaf="true" data-offset-key="8377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="8378"><span data-slate-leaf="true" data-offset-key="8378:0" data-first-offset="true"><span data-slate-string="true"> PIL </span></span></span><span data-slate-object="text" data-key="8379"><span data-slate-leaf="true" data-offset-key="8379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="8380"><span data-slate-leaf="true" data-offset-key="8380:0" data-first-offset="true"><span data-slate-string="true"> Image</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8381"><span data-slate-object="text" data-key="8382"><span data-slate-leaf="true" data-offset-key="8382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="8383"><span data-slate-leaf="true" data-offset-key="8383:0" data-first-offset="true"><span data-slate-string="true"> torchvision</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8384"><span data-slate-object="text" data-key="8385"><span data-slate-leaf="true" data-offset-key="8385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="8386"><span data-slate-leaf="true" data-offset-key="8386:0" data-first-offset="true"><span data-slate-string="true"> torchvision.transforms </span></span></span><span data-slate-object="text" data-key="8387"><span data-slate-leaf="true" data-offset-key="8387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="8388"><span data-slate-leaf="true" data-offset-key="8388:0" data-first-offset="true"><span data-slate-string="true"> transforms</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8389"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8390"><span data-slate-object="text" data-key="8391"><span data-slate-leaf="true" data-offset-key="8391:0" data-first-offset="true"><span data-slate-string="true">im = Image.</span></span></span><span data-slate-object="text" data-key="8392"><span data-slate-leaf="true" data-offset-key="8392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">open</span></span></span></span><span data-slate-object="text" data-key="8393"><span data-slate-leaf="true" data-offset-key="8393:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="8394"><span data-slate-leaf="true" data-offset-key="8394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'dog.jpg'</span></span></span></span><span data-slate-object="text" data-key="8395"><span data-slate-leaf="true" data-offset-key="8395:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8396"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8397"><span data-slate-object="text" data-key="8398"><span data-slate-leaf="true" data-offset-key="8398:0" data-first-offset="true"><span data-slate-string="true">transform = transforms.Compose([</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8399"><span data-slate-object="text" data-key="8400"><span data-slate-leaf="true" data-offset-key="8400:0" data-first-offset="true"><span data-slate-string="true">    transforms.RandomResizedCrop((</span></span></span><span data-slate-object="text" data-key="8401"><span data-slate-leaf="true" data-offset-key="8401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">224</span></span></span></span><span data-slate-object="text" data-key="8402"><span data-slate-leaf="true" data-offset-key="8402:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="8403"><span data-slate-leaf="true" data-offset-key="8403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">224</span></span></span></span><span data-slate-object="text" data-key="8404"><span data-slate-leaf="true" data-offset-key="8404:0" data-first-offset="true"><span data-slate-string="true">)),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8405"><span data-slate-object="text" data-key="8406"><span data-slate-leaf="true" data-offset-key="8406:0" data-first-offset="true"><span data-slate-string="true">    transforms.ToTensor(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8407"><span data-slate-object="text" data-key="8408"><span data-slate-leaf="true" data-offset-key="8408:0" data-first-offset="true"><span data-slate-string="true">    transforms.Normalize(mean=[</span></span></span><span data-slate-object="text" data-key="8409"><span data-slate-leaf="true" data-offset-key="8409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.485</span></span></span></span><span data-slate-object="text" data-key="8410"><span data-slate-leaf="true" data-offset-key="8410:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8411"><span data-slate-leaf="true" data-offset-key="8411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.456</span></span></span></span><span data-slate-object="text" data-key="8412"><span data-slate-leaf="true" data-offset-key="8412:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8413"><span data-slate-leaf="true" data-offset-key="8413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.406</span></span></span></span><span data-slate-object="text" data-key="8414"><span data-slate-leaf="true" data-offset-key="8414:0" data-first-offset="true"><span data-slate-string="true">], std=[</span></span></span><span data-slate-object="text" data-key="8415"><span data-slate-leaf="true" data-offset-key="8415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.229</span></span></span></span><span data-slate-object="text" data-key="8416"><span data-slate-leaf="true" data-offset-key="8416:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8417"><span data-slate-leaf="true" data-offset-key="8417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.224</span></span></span></span><span data-slate-object="text" data-key="8418"><span data-slate-leaf="true" data-offset-key="8418:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8419"><span data-slate-leaf="true" data-offset-key="8419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.225</span></span></span></span><span data-slate-object="text" data-key="8420"><span data-slate-leaf="true" data-offset-key="8420:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8421"><span data-slate-object="text" data-key="8422"><span data-slate-leaf="true" data-offset-key="8422:0" data-first-offset="true"><span data-slate-string="true">    ])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8423"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8424"><span data-slate-object="text" data-key="8425"><span data-slate-leaf="true" data-offset-key="8425:0" data-first-offset="true"><span data-slate-string="true">input_tensor = transform(im).unsqueeze(</span></span></span><span data-slate-object="text" data-key="8426"><span data-slate-leaf="true" data-offset-key="8426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8427"><span data-slate-leaf="true" data-offset-key="8427:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8428"><span data-slate-object="text" data-key="8429"><span data-slate-leaf="true" data-offset-key="8429:0" data-first-offset="true"><span data-slate-string="true">alexnet(input_tensor).argmax()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8430"><span data-slate-object="text" data-key="8431"><span data-slate-leaf="true" data-offset-key="8431:0" data-first-offset="true"><span data-slate-string="true">输出：</span></span></span><span data-slate-object="text" data-key="8432"><span data-slate-leaf="true" data-offset-key="8432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">263</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8433"><span data-slate-object="text" data-key="8434"><span data-slate-leaf="true" data-offset-key="8434:0" data-first-offset="true"><span data-slate-string="true">运行了前面的代码之后，对应到 ImageNet 的类别标签中可以找到，263 对应的是 Pembroke（柯基狗），这就证明模型已经加载成功了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8435"><span data-slate-object="text" data-key="8436"><span data-slate-leaf="true" data-offset-key="8436:0" data-first-offset="true"><span data-slate-string="true">这个过程中有两个重点你要留意。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8437"><span data-slate-object="text" data-key="8438"><span data-slate-leaf="true" data-offset-key="8438:0" data-first-offset="true"><span data-slate-string="true">首先，因为 Torchvision 中所有图像分类的预训练模型，它们都是在 ImageNet 上训练的。所以，输入数据需要是 3 通道的数据，也就是 shape 为 (B, 3, H, W) 的 Tensor，B 为 batchsize。我们需要使用均值为 [0.485, 0.456, 0.406]，标准差为 [0.229, 0.224, 0.225] 对数据进行正规化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8439"><span data-slate-object="text" data-key="8440"><span data-slate-leaf="true" data-offset-key="8440:0" data-first-offset="true"><span data-slate-string="true">另外，从理论上说，大部分的经典卷积神经最后采用全连接层（也就是机器学习中的感知机）进行分类，这也导致了网络的输入尺寸是固定的。但是，在 Torchvision 的模型可以接受任意尺寸的输入的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8441"><span data-slate-object="text" data-key="8442"><span data-slate-leaf="true" data-offset-key="8442:0" data-first-offset="true"><span data-slate-string="true">这是因为 Torchvision 对模型做了优化，有的网络是在最后的卷积层采用了全局平均，或者采用的是全卷积网络。这两种方式都可以让网络接受在最小输入尺寸基础之上，任意尺度的输入。这一点，你现在可能认识得还不够清楚，不过别担心，以后我们学习完图像分类理论之后，你会理解得更加透彻。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8443"><span data-slate-object="text" data-key="8444"><span data-slate-leaf="true" data-offset-key="8444:0" data-first-offset="true"><span data-slate-string="true">我们回到微调这个主题。正如刚才所说，训练一个 AlexNet 需要的数据必须是三通道数据。所以，在这里我使用了 CIFAR-10 公开数据集举例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8445"><span data-slate-object="text" data-key="8446"><span data-slate-leaf="true" data-offset-key="8446:0" data-first-offset="true"><span data-slate-string="true">CIFAR-10 数据集一共有 60000 张图片构成，共 10 个类别，每一类包含 6000 图片。每张图片为 32x32 的 RGB 图片。其中 50000 张图片作为训练集，10000 张图片作为测试集。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8447"><span data-slate-object="text" data-key="8448"><span data-slate-leaf="true" data-offset-key="8448:0" data-first-offset="true"><span data-slate-string="true">可以说 CIFAR-10 是非常接近真实项目数据的数据集了，因为真实项目中的数据通常是 RGB 三通道数据，而 CIFAR-10 同样是三通道数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8449"><span data-slate-object="text" data-key="8450"><span data-slate-leaf="true" data-offset-key="8450:0" data-first-offset="true"><span data-slate-string="true">我们用之前讲的 make_grid 方法，将 CIFAR-10 的数据打印出来，代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8451"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8452"><span data-slate-object="text" data-key="8453"><span data-slate-leaf="true" data-offset-key="8453:0" data-first-offset="true"><span data-slate-string="true">cifar10_dataset = torchvision.datasets.CIFAR10(root=</span></span></span><span data-slate-object="text" data-key="8454"><span data-slate-leaf="true" data-offset-key="8454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./data'</span></span></span></span><span data-slate-object="text" data-key="8455"><span data-slate-leaf="true" data-offset-key="8455:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8456"><span data-slate-object="text" data-key="8457"><span data-slate-leaf="true" data-offset-key="8457:0" data-first-offset="true"><span data-slate-string="true">                                       train=</span></span></span><span data-slate-object="text" data-key="8458"><span data-slate-leaf="true" data-offset-key="8458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8459"><span data-slate-leaf="true" data-offset-key="8459:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8460"><span data-slate-object="text" data-key="8461"><span data-slate-leaf="true" data-offset-key="8461:0" data-first-offset="true"><span data-slate-string="true">                                       transform=transforms.ToTensor(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8462"><span data-slate-object="text" data-key="8463"><span data-slate-leaf="true" data-offset-key="8463:0" data-first-offset="true"><span data-slate-string="true">                                       target_transform=</span></span></span><span data-slate-object="text" data-key="8464"><span data-slate-leaf="true" data-offset-key="8464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">None</span></span></span></span><span data-slate-object="text" data-key="8465"><span data-slate-leaf="true" data-offset-key="8465:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8466"><span data-slate-object="text" data-key="8467"><span data-slate-leaf="true" data-offset-key="8467:0" data-first-offset="true"><span data-slate-string="true">                                       download=</span></span></span><span data-slate-object="text" data-key="8468"><span data-slate-leaf="true" data-offset-key="8468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8469"><span data-slate-leaf="true" data-offset-key="8469:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8470"><span data-slate-object="text" data-key="8471"><span data-slate-leaf="true" data-offset-key="8471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 取 32 张图片的 tensor</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8472"><span data-slate-object="text" data-key="8473"><span data-slate-leaf="true" data-offset-key="8473:0" data-first-offset="true"><span data-slate-string="true">tensor_dataloader = DataLoader(dataset=cifar10_dataset,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8474"><span data-slate-object="text" data-key="8475"><span data-slate-leaf="true" data-offset-key="8475:0" data-first-offset="true"><span data-slate-string="true">                               batch_size=</span></span></span><span data-slate-object="text" data-key="8476"><span data-slate-leaf="true" data-offset-key="8476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">32</span></span></span></span><span data-slate-object="text" data-key="8477"><span data-slate-leaf="true" data-offset-key="8477:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8478"><span data-slate-object="text" data-key="8479"><span data-slate-leaf="true" data-offset-key="8479:0" data-first-offset="true"><span data-slate-string="true">data_iter = </span></span></span><span data-slate-object="text" data-key="8480"><span data-slate-leaf="true" data-offset-key="8480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">iter</span></span></span></span><span data-slate-object="text" data-key="8481"><span data-slate-leaf="true" data-offset-key="8481:0" data-first-offset="true"><span data-slate-string="true">(tensor_dataloader)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8482"><span data-slate-object="text" data-key="8483"><span data-slate-leaf="true" data-offset-key="8483:0" data-first-offset="true"><span data-slate-string="true">img_tensor, label_tensor = data_iter.</span></span></span><span data-slate-object="text" data-key="8484"><span data-slate-leaf="true" data-offset-key="8484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">next</span></span></span></span><span data-slate-object="text" data-key="8485"><span data-slate-leaf="true" data-offset-key="8485:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8486"><span data-slate-object="text" data-key="8487"><span data-slate-leaf="true" data-offset-key="8487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="8488"><span data-slate-leaf="true" data-offset-key="8488:0" data-first-offset="true"><span data-slate-string="true">(img_tensor.shape)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8489"><span data-slate-object="text" data-key="8490"><span data-slate-leaf="true" data-offset-key="8490:0" data-first-offset="true"><span data-slate-string="true">grid_tensor = torchvision.utils.make_grid(img_tensor, nrow=</span></span></span><span data-slate-object="text" data-key="8491"><span data-slate-leaf="true" data-offset-key="8491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">16</span></span></span></span><span data-slate-object="text" data-key="8492"><span data-slate-leaf="true" data-offset-key="8492:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8493"><span data-slate-leaf="true" data-offset-key="8493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8494"><span data-slate-leaf="true" data-offset-key="8494:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8495"><span data-slate-object="text" data-key="8496"><span data-slate-leaf="true" data-offset-key="8496:0" data-first-offset="true"><span data-slate-string="true">grid_img = transforms.ToPILImage()(grid_tensor)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8497"><span data-slate-object="text" data-key="8498"><span data-slate-leaf="true" data-offset-key="8498:0" data-first-offset="true"><span data-slate-string="true">display(grid_img)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8499"><span data-slate-object="text" data-key="8500"><span data-slate-leaf="true" data-offset-key="8500:0" data-first-offset="true"><span data-slate-string="true">请注意，上述代码中的 transform，我为了打印图片只使用了 transform.ToTensor () 输出图片，结果如下所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="8501"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f0/f2/f0b5f4ed8c24fbb81c7b7c71a907a6f2.jpg?wh=546x546"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8502"><span data-slate-object="text" data-key="8503"><span data-slate-leaf="true" data-offset-key="8503:0" data-first-offset="true"><span data-slate-string="true">这里我特别说明一下，因为这个训练集的数据都是 32x32 的，所以你现在看到的就是原图效果，图片大小并不影响咱们的学习。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8504"><span data-slate-object="text" data-key="8505"><span data-slate-leaf="true" data-offset-key="8505:0" data-first-offset="true"><span data-slate-string="true">下面我们要做的是修改全连接层，直接 print 就可以打印出网络结构，代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8506"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8507"><span data-slate-object="text" data-key="8508"><span data-slate-leaf="true" data-offset-key="8508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="8509"><span data-slate-leaf="true" data-offset-key="8509:0" data-first-offset="true"><span data-slate-string="true">(alexnet)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8510"><span data-slate-object="text" data-key="8511"><span data-slate-leaf="true" data-offset-key="8511:0" data-first-offset="true"><span data-slate-string="true">输出：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8512"><span data-slate-object="text" data-key="8513"><span data-slate-leaf="true" data-offset-key="8513:0" data-first-offset="true"><span data-slate-string="true">AlexNet(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8514"><span data-slate-object="text" data-key="8515"><span data-slate-leaf="true" data-offset-key="8515:0" data-first-offset="true"><span data-slate-string="true">  (features): Sequential(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8516"><span data-slate-object="text" data-key="8517"><span data-slate-leaf="true" data-offset-key="8517:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8518"><span data-slate-leaf="true" data-offset-key="8518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8519"><span data-slate-leaf="true" data-offset-key="8519:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8520"><span data-slate-leaf="true" data-offset-key="8520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8521"><span data-slate-leaf="true" data-offset-key="8521:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8522"><span data-slate-leaf="true" data-offset-key="8522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">64</span></span></span></span><span data-slate-object="text" data-key="8523"><span data-slate-leaf="true" data-offset-key="8523:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8524"><span data-slate-leaf="true" data-offset-key="8524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8525"><span data-slate-leaf="true" data-offset-key="8525:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8526"><span data-slate-leaf="true" data-offset-key="8526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8527"><span data-slate-leaf="true" data-offset-key="8527:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8528"><span data-slate-leaf="true" data-offset-key="8528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8529"><span data-slate-leaf="true" data-offset-key="8529:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8530"><span data-slate-leaf="true" data-offset-key="8530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8531"><span data-slate-leaf="true" data-offset-key="8531:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8532"><span data-slate-leaf="true" data-offset-key="8532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8533"><span data-slate-leaf="true" data-offset-key="8533:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8534"><span data-slate-leaf="true" data-offset-key="8534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8535"><span data-slate-leaf="true" data-offset-key="8535:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8536"><span data-slate-object="text" data-key="8537"><span data-slate-leaf="true" data-offset-key="8537:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8538"><span data-slate-leaf="true" data-offset-key="8538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8539"><span data-slate-leaf="true" data-offset-key="8539:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8540"><span data-slate-leaf="true" data-offset-key="8540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8541"><span data-slate-leaf="true" data-offset-key="8541:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8542"><span data-slate-object="text" data-key="8543"><span data-slate-leaf="true" data-offset-key="8543:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8544"><span data-slate-leaf="true" data-offset-key="8544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8545"><span data-slate-leaf="true" data-offset-key="8545:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8546"><span data-slate-leaf="true" data-offset-key="8546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8547"><span data-slate-leaf="true" data-offset-key="8547:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8548"><span data-slate-leaf="true" data-offset-key="8548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8549"><span data-slate-leaf="true" data-offset-key="8549:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8550"><span data-slate-leaf="true" data-offset-key="8550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8551"><span data-slate-leaf="true" data-offset-key="8551:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8552"><span data-slate-leaf="true" data-offset-key="8552:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8553"><span data-slate-leaf="true" data-offset-key="8553:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8554"><span data-slate-leaf="true" data-offset-key="8554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8555"><span data-slate-leaf="true" data-offset-key="8555:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8556"><span data-slate-object="text" data-key="8557"><span data-slate-leaf="true" data-offset-key="8557:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8558"><span data-slate-leaf="true" data-offset-key="8558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8559"><span data-slate-leaf="true" data-offset-key="8559:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8560"><span data-slate-leaf="true" data-offset-key="8560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">64</span></span></span></span><span data-slate-object="text" data-key="8561"><span data-slate-leaf="true" data-offset-key="8561:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8562"><span data-slate-leaf="true" data-offset-key="8562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">192</span></span></span></span><span data-slate-object="text" data-key="8563"><span data-slate-leaf="true" data-offset-key="8563:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8564"><span data-slate-leaf="true" data-offset-key="8564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8565"><span data-slate-leaf="true" data-offset-key="8565:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8566"><span data-slate-leaf="true" data-offset-key="8566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8567"><span data-slate-leaf="true" data-offset-key="8567:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8568"><span data-slate-leaf="true" data-offset-key="8568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8569"><span data-slate-leaf="true" data-offset-key="8569:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8570"><span data-slate-leaf="true" data-offset-key="8570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8571"><span data-slate-leaf="true" data-offset-key="8571:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8572"><span data-slate-leaf="true" data-offset-key="8572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8573"><span data-slate-leaf="true" data-offset-key="8573:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8574"><span data-slate-leaf="true" data-offset-key="8574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8575"><span data-slate-leaf="true" data-offset-key="8575:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8576"><span data-slate-object="text" data-key="8577"><span data-slate-leaf="true" data-offset-key="8577:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8578"><span data-slate-leaf="true" data-offset-key="8578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8579"><span data-slate-leaf="true" data-offset-key="8579:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8580"><span data-slate-leaf="true" data-offset-key="8580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8581"><span data-slate-leaf="true" data-offset-key="8581:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8582"><span data-slate-object="text" data-key="8583"><span data-slate-leaf="true" data-offset-key="8583:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8584"><span data-slate-leaf="true" data-offset-key="8584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8585"><span data-slate-leaf="true" data-offset-key="8585:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8586"><span data-slate-leaf="true" data-offset-key="8586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8587"><span data-slate-leaf="true" data-offset-key="8587:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8588"><span data-slate-leaf="true" data-offset-key="8588:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8589"><span data-slate-leaf="true" data-offset-key="8589:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8590"><span data-slate-leaf="true" data-offset-key="8590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8591"><span data-slate-leaf="true" data-offset-key="8591:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8592"><span data-slate-leaf="true" data-offset-key="8592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8593"><span data-slate-leaf="true" data-offset-key="8593:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8594"><span data-slate-leaf="true" data-offset-key="8594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8595"><span data-slate-leaf="true" data-offset-key="8595:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8596"><span data-slate-object="text" data-key="8597"><span data-slate-leaf="true" data-offset-key="8597:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8598"><span data-slate-leaf="true" data-offset-key="8598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8599"><span data-slate-leaf="true" data-offset-key="8599:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8600"><span data-slate-leaf="true" data-offset-key="8600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">192</span></span></span></span><span data-slate-object="text" data-key="8601"><span data-slate-leaf="true" data-offset-key="8601:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8602"><span data-slate-leaf="true" data-offset-key="8602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">384</span></span></span></span><span data-slate-object="text" data-key="8603"><span data-slate-leaf="true" data-offset-key="8603:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8604"><span data-slate-leaf="true" data-offset-key="8604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8605"><span data-slate-leaf="true" data-offset-key="8605:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8606"><span data-slate-leaf="true" data-offset-key="8606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8607"><span data-slate-leaf="true" data-offset-key="8607:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8608"><span data-slate-leaf="true" data-offset-key="8608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8609"><span data-slate-leaf="true" data-offset-key="8609:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8610"><span data-slate-leaf="true" data-offset-key="8610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8611"><span data-slate-leaf="true" data-offset-key="8611:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8612"><span data-slate-leaf="true" data-offset-key="8612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8613"><span data-slate-leaf="true" data-offset-key="8613:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8614"><span data-slate-leaf="true" data-offset-key="8614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8615"><span data-slate-leaf="true" data-offset-key="8615:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8616"><span data-slate-object="text" data-key="8617"><span data-slate-leaf="true" data-offset-key="8617:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8618"><span data-slate-leaf="true" data-offset-key="8618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">7</span></span></span></span><span data-slate-object="text" data-key="8619"><span data-slate-leaf="true" data-offset-key="8619:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8620"><span data-slate-leaf="true" data-offset-key="8620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8621"><span data-slate-leaf="true" data-offset-key="8621:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8622"><span data-slate-object="text" data-key="8623"><span data-slate-leaf="true" data-offset-key="8623:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8624"><span data-slate-leaf="true" data-offset-key="8624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8</span></span></span></span><span data-slate-object="text" data-key="8625"><span data-slate-leaf="true" data-offset-key="8625:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8626"><span data-slate-leaf="true" data-offset-key="8626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">384</span></span></span></span><span data-slate-object="text" data-key="8627"><span data-slate-leaf="true" data-offset-key="8627:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8628"><span data-slate-leaf="true" data-offset-key="8628:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8629"><span data-slate-leaf="true" data-offset-key="8629:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8630"><span data-slate-leaf="true" data-offset-key="8630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8631"><span data-slate-leaf="true" data-offset-key="8631:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8632"><span data-slate-leaf="true" data-offset-key="8632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8633"><span data-slate-leaf="true" data-offset-key="8633:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8634"><span data-slate-leaf="true" data-offset-key="8634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8635"><span data-slate-leaf="true" data-offset-key="8635:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8636"><span data-slate-leaf="true" data-offset-key="8636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8637"><span data-slate-leaf="true" data-offset-key="8637:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8638"><span data-slate-leaf="true" data-offset-key="8638:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8639"><span data-slate-leaf="true" data-offset-key="8639:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8640"><span data-slate-leaf="true" data-offset-key="8640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8641"><span data-slate-leaf="true" data-offset-key="8641:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8642"><span data-slate-object="text" data-key="8643"><span data-slate-leaf="true" data-offset-key="8643:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8644"><span data-slate-leaf="true" data-offset-key="8644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9</span></span></span></span><span data-slate-object="text" data-key="8645"><span data-slate-leaf="true" data-offset-key="8645:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8646"><span data-slate-leaf="true" data-offset-key="8646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8647"><span data-slate-leaf="true" data-offset-key="8647:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8648"><span data-slate-object="text" data-key="8649"><span data-slate-leaf="true" data-offset-key="8649:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8650"><span data-slate-leaf="true" data-offset-key="8650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="8651"><span data-slate-leaf="true" data-offset-key="8651:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8652"><span data-slate-leaf="true" data-offset-key="8652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8653"><span data-slate-leaf="true" data-offset-key="8653:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8654"><span data-slate-leaf="true" data-offset-key="8654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8655"><span data-slate-leaf="true" data-offset-key="8655:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8656"><span data-slate-leaf="true" data-offset-key="8656:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8657"><span data-slate-leaf="true" data-offset-key="8657:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8658"><span data-slate-leaf="true" data-offset-key="8658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8659"><span data-slate-leaf="true" data-offset-key="8659:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8660"><span data-slate-leaf="true" data-offset-key="8660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8661"><span data-slate-leaf="true" data-offset-key="8661:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8662"><span data-slate-leaf="true" data-offset-key="8662:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8663"><span data-slate-leaf="true" data-offset-key="8663:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8664"><span data-slate-leaf="true" data-offset-key="8664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8665"><span data-slate-leaf="true" data-offset-key="8665:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8666"><span data-slate-leaf="true" data-offset-key="8666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8667"><span data-slate-leaf="true" data-offset-key="8667:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8668"><span data-slate-object="text" data-key="8669"><span data-slate-leaf="true" data-offset-key="8669:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8670"><span data-slate-leaf="true" data-offset-key="8670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8671"><span data-slate-leaf="true" data-offset-key="8671:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8672"><span data-slate-leaf="true" data-offset-key="8672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8673"><span data-slate-leaf="true" data-offset-key="8673:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8674"><span data-slate-object="text" data-key="8675"><span data-slate-leaf="true" data-offset-key="8675:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8676"><span data-slate-leaf="true" data-offset-key="8676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">12</span></span></span></span><span data-slate-object="text" data-key="8677"><span data-slate-leaf="true" data-offset-key="8677:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8678"><span data-slate-leaf="true" data-offset-key="8678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8679"><span data-slate-leaf="true" data-offset-key="8679:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8680"><span data-slate-leaf="true" data-offset-key="8680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8681"><span data-slate-leaf="true" data-offset-key="8681:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8682"><span data-slate-leaf="true" data-offset-key="8682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8683"><span data-slate-leaf="true" data-offset-key="8683:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8684"><span data-slate-leaf="true" data-offset-key="8684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8685"><span data-slate-leaf="true" data-offset-key="8685:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8686"><span data-slate-leaf="true" data-offset-key="8686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8687"><span data-slate-leaf="true" data-offset-key="8687:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8688"><span data-slate-object="text" data-key="8689"><span data-slate-leaf="true" data-offset-key="8689:0" data-first-offset="true"><span data-slate-string="true">  )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8690"><span data-slate-object="text" data-key="8691"><span data-slate-leaf="true" data-offset-key="8691:0" data-first-offset="true"><span data-slate-string="true">  (avgpool): AdaptiveAvgPool2d(output_size=(</span></span></span><span data-slate-object="text" data-key="8692"><span data-slate-leaf="true" data-offset-key="8692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8693"><span data-slate-leaf="true" data-offset-key="8693:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8694"><span data-slate-leaf="true" data-offset-key="8694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8695"><span data-slate-leaf="true" data-offset-key="8695:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8696"><span data-slate-object="text" data-key="8697"><span data-slate-leaf="true" data-offset-key="8697:0" data-first-offset="true"><span data-slate-string="true">  (classifier): Sequential(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8698"><span data-slate-object="text" data-key="8699"><span data-slate-leaf="true" data-offset-key="8699:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8700"><span data-slate-leaf="true" data-offset-key="8700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8701"><span data-slate-leaf="true" data-offset-key="8701:0" data-first-offset="true"><span data-slate-string="true">): Dropout(p=</span></span></span><span data-slate-object="text" data-key="8702"><span data-slate-leaf="true" data-offset-key="8702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.5</span></span></span></span><span data-slate-object="text" data-key="8703"><span data-slate-leaf="true" data-offset-key="8703:0" data-first-offset="true"><span data-slate-string="true">, inplace=</span></span></span><span data-slate-object="text" data-key="8704"><span data-slate-leaf="true" data-offset-key="8704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8705"><span data-slate-leaf="true" data-offset-key="8705:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8706"><span data-slate-object="text" data-key="8707"><span data-slate-leaf="true" data-offset-key="8707:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8708"><span data-slate-leaf="true" data-offset-key="8708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8709"><span data-slate-leaf="true" data-offset-key="8709:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="8710"><span data-slate-leaf="true" data-offset-key="8710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9216</span></span></span></span><span data-slate-object="text" data-key="8711"><span data-slate-leaf="true" data-offset-key="8711:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="8712"><span data-slate-leaf="true" data-offset-key="8712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="8713"><span data-slate-leaf="true" data-offset-key="8713:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="8714"><span data-slate-leaf="true" data-offset-key="8714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8715"><span data-slate-leaf="true" data-offset-key="8715:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8716"><span data-slate-object="text" data-key="8717"><span data-slate-leaf="true" data-offset-key="8717:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8718"><span data-slate-leaf="true" data-offset-key="8718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8719"><span data-slate-leaf="true" data-offset-key="8719:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8720"><span data-slate-leaf="true" data-offset-key="8720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8721"><span data-slate-leaf="true" data-offset-key="8721:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8722"><span data-slate-object="text" data-key="8723"><span data-slate-leaf="true" data-offset-key="8723:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8724"><span data-slate-leaf="true" data-offset-key="8724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8725"><span data-slate-leaf="true" data-offset-key="8725:0" data-first-offset="true"><span data-slate-string="true">): Dropout(p=</span></span></span><span data-slate-object="text" data-key="8726"><span data-slate-leaf="true" data-offset-key="8726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.5</span></span></span></span><span data-slate-object="text" data-key="8727"><span data-slate-leaf="true" data-offset-key="8727:0" data-first-offset="true"><span data-slate-string="true">, inplace=</span></span></span><span data-slate-object="text" data-key="8728"><span data-slate-leaf="true" data-offset-key="8728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8729"><span data-slate-leaf="true" data-offset-key="8729:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8730"><span data-slate-object="text" data-key="8731"><span data-slate-leaf="true" data-offset-key="8731:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8732"><span data-slate-leaf="true" data-offset-key="8732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8733"><span data-slate-leaf="true" data-offset-key="8733:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="8734"><span data-slate-leaf="true" data-offset-key="8734:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="8735"><span data-slate-leaf="true" data-offset-key="8735:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="8736"><span data-slate-leaf="true" data-offset-key="8736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="8737"><span data-slate-leaf="true" data-offset-key="8737:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="8738"><span data-slate-leaf="true" data-offset-key="8738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8739"><span data-slate-leaf="true" data-offset-key="8739:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8740"><span data-slate-object="text" data-key="8741"><span data-slate-leaf="true" data-offset-key="8741:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8742"><span data-slate-leaf="true" data-offset-key="8742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8743"><span data-slate-leaf="true" data-offset-key="8743:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8744"><span data-slate-leaf="true" data-offset-key="8744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8745"><span data-slate-leaf="true" data-offset-key="8745:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8746"><span data-slate-object="text" data-key="8747"><span data-slate-leaf="true" data-offset-key="8747:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8748"><span data-slate-leaf="true" data-offset-key="8748:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8749"><span data-slate-leaf="true" data-offset-key="8749:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="8750"><span data-slate-leaf="true" data-offset-key="8750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="8751"><span data-slate-leaf="true" data-offset-key="8751:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="8752"><span data-slate-leaf="true" data-offset-key="8752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1000</span></span></span></span><span data-slate-object="text" data-key="8753"><span data-slate-leaf="true" data-offset-key="8753:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="8754"><span data-slate-leaf="true" data-offset-key="8754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8755"><span data-slate-leaf="true" data-offset-key="8755:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8756"><span data-slate-object="text" data-key="8757"><span data-slate-leaf="true" data-offset-key="8757:0" data-first-offset="true"><span data-slate-string="true">  )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8758"><span data-slate-object="text" data-key="8759"><span data-slate-leaf="true" data-offset-key="8759:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="8760"><span data-slate-object="text" data-key="8761"><span data-slate-leaf="true" data-offset-key="8761:0" data-first-offset="true"><span data-slate-string="true">可以看到，最后全连接层输入是 4096 个单元，输出是 1000 个单元，我们要把它修改为输出是 10 个单元的全连接层（CIFR10 有 10 类）。代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="8762"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="8763"><span data-slate-object="text" data-key="8764"><span data-slate-leaf="true" data-offset-key="8764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 提取分类层的输入参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8765"><span data-slate-object="text" data-key="8766"><span data-slate-leaf="true" data-offset-key="8766:0" data-first-offset="true"><span data-slate-string="true">fc_in_features = alexnet.classifier[</span></span></span><span data-slate-object="text" data-key="8767"><span data-slate-leaf="true" data-offset-key="8767:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8768"><span data-slate-leaf="true" data-offset-key="8768:0" data-first-offset="true"><span data-slate-string="true">].in_features</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8769"></div><div data-slate-type="code-line" data-slate-object="block" data-key="8770"><span data-slate-object="text" data-key="8771"><span data-slate-leaf="true" data-offset-key="8771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 修改预训练模型的输出分类数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8772"><span data-slate-object="text" data-key="8773"><span data-slate-leaf="true" data-offset-key="8773:0" data-first-offset="true"><span data-slate-string="true">alexnet.classifier[</span></span></span><span data-slate-object="text" data-key="8774"><span data-slate-leaf="true" data-offset-key="8774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8775"><span data-slate-leaf="true" data-offset-key="8775:0" data-first-offset="true"><span data-slate-string="true">] = torch.nn.Linear(fc_in_features, </span></span></span><span data-slate-object="text" data-key="8776"><span data-slate-leaf="true" data-offset-key="8776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="8777"><span data-slate-leaf="true" data-offset-key="8777:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8778"><span data-slate-object="text" data-key="8779"><span data-slate-leaf="true" data-offset-key="8779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="8780"><span data-slate-leaf="true" data-offset-key="8780:0" data-first-offset="true"><span data-slate-string="true">(alexnet)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8781"><span data-slate-object="text" data-key="8782"><span data-slate-leaf="true" data-offset-key="8782:0" data-first-offset="true"><span data-slate-string="true">输出：</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8783"><span data-slate-object="text" data-key="8784"><span data-slate-leaf="true" data-offset-key="8784:0" data-first-offset="true"><span data-slate-string="true">AlexNet(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8785"><span data-slate-object="text" data-key="8786"><span data-slate-leaf="true" data-offset-key="8786:0" data-first-offset="true"><span data-slate-string="true">  (features): Sequential(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8787"><span data-slate-object="text" data-key="8788"><span data-slate-leaf="true" data-offset-key="8788:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8789"><span data-slate-leaf="true" data-offset-key="8789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8790"><span data-slate-leaf="true" data-offset-key="8790:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8791"><span data-slate-leaf="true" data-offset-key="8791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8792"><span data-slate-leaf="true" data-offset-key="8792:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8793"><span data-slate-leaf="true" data-offset-key="8793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">64</span></span></span></span><span data-slate-object="text" data-key="8794"><span data-slate-leaf="true" data-offset-key="8794:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8795"><span data-slate-leaf="true" data-offset-key="8795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8796"><span data-slate-leaf="true" data-offset-key="8796:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8797"><span data-slate-leaf="true" data-offset-key="8797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8798"><span data-slate-leaf="true" data-offset-key="8798:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8799"><span data-slate-leaf="true" data-offset-key="8799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8800"><span data-slate-leaf="true" data-offset-key="8800:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8801"><span data-slate-leaf="true" data-offset-key="8801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8802"><span data-slate-leaf="true" data-offset-key="8802:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8803"><span data-slate-leaf="true" data-offset-key="8803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8804"><span data-slate-leaf="true" data-offset-key="8804:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8805"><span data-slate-leaf="true" data-offset-key="8805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8806"><span data-slate-leaf="true" data-offset-key="8806:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8807"><span data-slate-object="text" data-key="8808"><span data-slate-leaf="true" data-offset-key="8808:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8809"><span data-slate-leaf="true" data-offset-key="8809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8810"><span data-slate-leaf="true" data-offset-key="8810:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8811"><span data-slate-leaf="true" data-offset-key="8811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8812"><span data-slate-leaf="true" data-offset-key="8812:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8813"><span data-slate-object="text" data-key="8814"><span data-slate-leaf="true" data-offset-key="8814:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8815"><span data-slate-leaf="true" data-offset-key="8815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8816"><span data-slate-leaf="true" data-offset-key="8816:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8817"><span data-slate-leaf="true" data-offset-key="8817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8818"><span data-slate-leaf="true" data-offset-key="8818:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8819"><span data-slate-leaf="true" data-offset-key="8819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8820"><span data-slate-leaf="true" data-offset-key="8820:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8821"><span data-slate-leaf="true" data-offset-key="8821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8822"><span data-slate-leaf="true" data-offset-key="8822:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8823"><span data-slate-leaf="true" data-offset-key="8823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8824"><span data-slate-leaf="true" data-offset-key="8824:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8825"><span data-slate-leaf="true" data-offset-key="8825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8826"><span data-slate-leaf="true" data-offset-key="8826:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8827"><span data-slate-object="text" data-key="8828"><span data-slate-leaf="true" data-offset-key="8828:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8829"><span data-slate-leaf="true" data-offset-key="8829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8830"><span data-slate-leaf="true" data-offset-key="8830:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8831"><span data-slate-leaf="true" data-offset-key="8831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">64</span></span></span></span><span data-slate-object="text" data-key="8832"><span data-slate-leaf="true" data-offset-key="8832:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8833"><span data-slate-leaf="true" data-offset-key="8833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">192</span></span></span></span><span data-slate-object="text" data-key="8834"><span data-slate-leaf="true" data-offset-key="8834:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8835"><span data-slate-leaf="true" data-offset-key="8835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8836"><span data-slate-leaf="true" data-offset-key="8836:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8837"><span data-slate-leaf="true" data-offset-key="8837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8838"><span data-slate-leaf="true" data-offset-key="8838:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8839"><span data-slate-leaf="true" data-offset-key="8839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8840"><span data-slate-leaf="true" data-offset-key="8840:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8841"><span data-slate-leaf="true" data-offset-key="8841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8842"><span data-slate-leaf="true" data-offset-key="8842:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8843"><span data-slate-leaf="true" data-offset-key="8843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8844"><span data-slate-leaf="true" data-offset-key="8844:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8845"><span data-slate-leaf="true" data-offset-key="8845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8846"><span data-slate-leaf="true" data-offset-key="8846:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8847"><span data-slate-object="text" data-key="8848"><span data-slate-leaf="true" data-offset-key="8848:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8849"><span data-slate-leaf="true" data-offset-key="8849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="8850"><span data-slate-leaf="true" data-offset-key="8850:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8851"><span data-slate-leaf="true" data-offset-key="8851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8852"><span data-slate-leaf="true" data-offset-key="8852:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8853"><span data-slate-object="text" data-key="8854"><span data-slate-leaf="true" data-offset-key="8854:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8855"><span data-slate-leaf="true" data-offset-key="8855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="8856"><span data-slate-leaf="true" data-offset-key="8856:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8857"><span data-slate-leaf="true" data-offset-key="8857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8858"><span data-slate-leaf="true" data-offset-key="8858:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8859"><span data-slate-leaf="true" data-offset-key="8859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8860"><span data-slate-leaf="true" data-offset-key="8860:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8861"><span data-slate-leaf="true" data-offset-key="8861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8862"><span data-slate-leaf="true" data-offset-key="8862:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8863"><span data-slate-leaf="true" data-offset-key="8863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8864"><span data-slate-leaf="true" data-offset-key="8864:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8865"><span data-slate-leaf="true" data-offset-key="8865:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8866"><span data-slate-leaf="true" data-offset-key="8866:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8867"><span data-slate-object="text" data-key="8868"><span data-slate-leaf="true" data-offset-key="8868:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8869"><span data-slate-leaf="true" data-offset-key="8869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8870"><span data-slate-leaf="true" data-offset-key="8870:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8871"><span data-slate-leaf="true" data-offset-key="8871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">192</span></span></span></span><span data-slate-object="text" data-key="8872"><span data-slate-leaf="true" data-offset-key="8872:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8873"><span data-slate-leaf="true" data-offset-key="8873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">384</span></span></span></span><span data-slate-object="text" data-key="8874"><span data-slate-leaf="true" data-offset-key="8874:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8875"><span data-slate-leaf="true" data-offset-key="8875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8876"><span data-slate-leaf="true" data-offset-key="8876:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8877"><span data-slate-leaf="true" data-offset-key="8877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8878"><span data-slate-leaf="true" data-offset-key="8878:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8879"><span data-slate-leaf="true" data-offset-key="8879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8880"><span data-slate-leaf="true" data-offset-key="8880:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8881"><span data-slate-leaf="true" data-offset-key="8881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8882"><span data-slate-leaf="true" data-offset-key="8882:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8883"><span data-slate-leaf="true" data-offset-key="8883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8884"><span data-slate-leaf="true" data-offset-key="8884:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8885"><span data-slate-leaf="true" data-offset-key="8885:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8886"><span data-slate-leaf="true" data-offset-key="8886:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8887"><span data-slate-object="text" data-key="8888"><span data-slate-leaf="true" data-offset-key="8888:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8889"><span data-slate-leaf="true" data-offset-key="8889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">7</span></span></span></span><span data-slate-object="text" data-key="8890"><span data-slate-leaf="true" data-offset-key="8890:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8891"><span data-slate-leaf="true" data-offset-key="8891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8892"><span data-slate-leaf="true" data-offset-key="8892:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8893"><span data-slate-object="text" data-key="8894"><span data-slate-leaf="true" data-offset-key="8894:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8895"><span data-slate-leaf="true" data-offset-key="8895:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8</span></span></span></span><span data-slate-object="text" data-key="8896"><span data-slate-leaf="true" data-offset-key="8896:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8897"><span data-slate-leaf="true" data-offset-key="8897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">384</span></span></span></span><span data-slate-object="text" data-key="8898"><span data-slate-leaf="true" data-offset-key="8898:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8899"><span data-slate-leaf="true" data-offset-key="8899:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8900"><span data-slate-leaf="true" data-offset-key="8900:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8901"><span data-slate-leaf="true" data-offset-key="8901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8902"><span data-slate-leaf="true" data-offset-key="8902:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8903"><span data-slate-leaf="true" data-offset-key="8903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8904"><span data-slate-leaf="true" data-offset-key="8904:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8905"><span data-slate-leaf="true" data-offset-key="8905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8906"><span data-slate-leaf="true" data-offset-key="8906:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8907"><span data-slate-leaf="true" data-offset-key="8907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8908"><span data-slate-leaf="true" data-offset-key="8908:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8909"><span data-slate-leaf="true" data-offset-key="8909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8910"><span data-slate-leaf="true" data-offset-key="8910:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8911"><span data-slate-leaf="true" data-offset-key="8911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8912"><span data-slate-leaf="true" data-offset-key="8912:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8913"><span data-slate-object="text" data-key="8914"><span data-slate-leaf="true" data-offset-key="8914:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8915"><span data-slate-leaf="true" data-offset-key="8915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9</span></span></span></span><span data-slate-object="text" data-key="8916"><span data-slate-leaf="true" data-offset-key="8916:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8917"><span data-slate-leaf="true" data-offset-key="8917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8918"><span data-slate-leaf="true" data-offset-key="8918:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8919"><span data-slate-object="text" data-key="8920"><span data-slate-leaf="true" data-offset-key="8920:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8921"><span data-slate-leaf="true" data-offset-key="8921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="8922"><span data-slate-leaf="true" data-offset-key="8922:0" data-first-offset="true"><span data-slate-string="true">): Conv2d(</span></span></span><span data-slate-object="text" data-key="8923"><span data-slate-leaf="true" data-offset-key="8923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8924"><span data-slate-leaf="true" data-offset-key="8924:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8925"><span data-slate-leaf="true" data-offset-key="8925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">256</span></span></span></span><span data-slate-object="text" data-key="8926"><span data-slate-leaf="true" data-offset-key="8926:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=(</span></span></span><span data-slate-object="text" data-key="8927"><span data-slate-leaf="true" data-offset-key="8927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8928"><span data-slate-leaf="true" data-offset-key="8928:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8929"><span data-slate-leaf="true" data-offset-key="8929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8930"><span data-slate-leaf="true" data-offset-key="8930:0" data-first-offset="true"><span data-slate-string="true">), stride=(</span></span></span><span data-slate-object="text" data-key="8931"><span data-slate-leaf="true" data-offset-key="8931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8932"><span data-slate-leaf="true" data-offset-key="8932:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8933"><span data-slate-leaf="true" data-offset-key="8933:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8934"><span data-slate-leaf="true" data-offset-key="8934:0" data-first-offset="true"><span data-slate-string="true">), padding=(</span></span></span><span data-slate-object="text" data-key="8935"><span data-slate-leaf="true" data-offset-key="8935:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8936"><span data-slate-leaf="true" data-offset-key="8936:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8937"><span data-slate-leaf="true" data-offset-key="8937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8938"><span data-slate-leaf="true" data-offset-key="8938:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8939"><span data-slate-object="text" data-key="8940"><span data-slate-leaf="true" data-offset-key="8940:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8941"><span data-slate-leaf="true" data-offset-key="8941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">11</span></span></span></span><span data-slate-object="text" data-key="8942"><span data-slate-leaf="true" data-offset-key="8942:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8943"><span data-slate-leaf="true" data-offset-key="8943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8944"><span data-slate-leaf="true" data-offset-key="8944:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8945"><span data-slate-object="text" data-key="8946"><span data-slate-leaf="true" data-offset-key="8946:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8947"><span data-slate-leaf="true" data-offset-key="8947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">12</span></span></span></span><span data-slate-object="text" data-key="8948"><span data-slate-leaf="true" data-offset-key="8948:0" data-first-offset="true"><span data-slate-string="true">): MaxPool2d(kernel_size=</span></span></span><span data-slate-object="text" data-key="8949"><span data-slate-leaf="true" data-offset-key="8949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8950"><span data-slate-leaf="true" data-offset-key="8950:0" data-first-offset="true"><span data-slate-string="true">, stride=</span></span></span><span data-slate-object="text" data-key="8951"><span data-slate-leaf="true" data-offset-key="8951:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8952"><span data-slate-leaf="true" data-offset-key="8952:0" data-first-offset="true"><span data-slate-string="true">, padding=</span></span></span><span data-slate-object="text" data-key="8953"><span data-slate-leaf="true" data-offset-key="8953:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8954"><span data-slate-leaf="true" data-offset-key="8954:0" data-first-offset="true"><span data-slate-string="true">, dilation=</span></span></span><span data-slate-object="text" data-key="8955"><span data-slate-leaf="true" data-offset-key="8955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8956"><span data-slate-leaf="true" data-offset-key="8956:0" data-first-offset="true"><span data-slate-string="true">, ceil_mode=</span></span></span><span data-slate-object="text" data-key="8957"><span data-slate-leaf="true" data-offset-key="8957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8958"><span data-slate-leaf="true" data-offset-key="8958:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8959"><span data-slate-object="text" data-key="8960"><span data-slate-leaf="true" data-offset-key="8960:0" data-first-offset="true"><span data-slate-string="true">  )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8961"><span data-slate-object="text" data-key="8962"><span data-slate-leaf="true" data-offset-key="8962:0" data-first-offset="true"><span data-slate-string="true">  (avgpool): AdaptiveAvgPool2d(output_size=(</span></span></span><span data-slate-object="text" data-key="8963"><span data-slate-leaf="true" data-offset-key="8963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8964"><span data-slate-leaf="true" data-offset-key="8964:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="8965"><span data-slate-leaf="true" data-offset-key="8965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="8966"><span data-slate-leaf="true" data-offset-key="8966:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8967"><span data-slate-object="text" data-key="8968"><span data-slate-leaf="true" data-offset-key="8968:0" data-first-offset="true"><span data-slate-string="true">  (classifier): Sequential(</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8969"><span data-slate-object="text" data-key="8970"><span data-slate-leaf="true" data-offset-key="8970:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8971"><span data-slate-leaf="true" data-offset-key="8971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="8972"><span data-slate-leaf="true" data-offset-key="8972:0" data-first-offset="true"><span data-slate-string="true">): Dropout(p=</span></span></span><span data-slate-object="text" data-key="8973"><span data-slate-leaf="true" data-offset-key="8973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.5</span></span></span></span><span data-slate-object="text" data-key="8974"><span data-slate-leaf="true" data-offset-key="8974:0" data-first-offset="true"><span data-slate-string="true">, inplace=</span></span></span><span data-slate-object="text" data-key="8975"><span data-slate-leaf="true" data-offset-key="8975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="8976"><span data-slate-leaf="true" data-offset-key="8976:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8977"><span data-slate-object="text" data-key="8978"><span data-slate-leaf="true" data-offset-key="8978:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8979"><span data-slate-leaf="true" data-offset-key="8979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="8980"><span data-slate-leaf="true" data-offset-key="8980:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="8981"><span data-slate-leaf="true" data-offset-key="8981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">9216</span></span></span></span><span data-slate-object="text" data-key="8982"><span data-slate-leaf="true" data-offset-key="8982:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="8983"><span data-slate-leaf="true" data-offset-key="8983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="8984"><span data-slate-leaf="true" data-offset-key="8984:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="8985"><span data-slate-leaf="true" data-offset-key="8985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8986"><span data-slate-leaf="true" data-offset-key="8986:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8987"><span data-slate-object="text" data-key="8988"><span data-slate-leaf="true" data-offset-key="8988:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8989"><span data-slate-leaf="true" data-offset-key="8989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="8990"><span data-slate-leaf="true" data-offset-key="8990:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="8991"><span data-slate-leaf="true" data-offset-key="8991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="8992"><span data-slate-leaf="true" data-offset-key="8992:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="8993"><span data-slate-object="text" data-key="8994"><span data-slate-leaf="true" data-offset-key="8994:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="8995"><span data-slate-leaf="true" data-offset-key="8995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="8996"><span data-slate-leaf="true" data-offset-key="8996:0" data-first-offset="true"><span data-slate-string="true">): Dropout(p=</span></span></span><span data-slate-object="text" data-key="8997"><span data-slate-leaf="true" data-offset-key="8997:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.5</span></span></span></span><span data-slate-object="text" data-key="8998"><span data-slate-leaf="true" data-offset-key="8998:0" data-first-offset="true"><span data-slate-string="true">, inplace=</span></span></span><span data-slate-object="text" data-key="8999"><span data-slate-leaf="true" data-offset-key="8999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="9000"><span data-slate-leaf="true" data-offset-key="9000:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9001"><span data-slate-object="text" data-key="9002"><span data-slate-leaf="true" data-offset-key="9002:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="9003"><span data-slate-leaf="true" data-offset-key="9003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="9004"><span data-slate-leaf="true" data-offset-key="9004:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="9005"><span data-slate-leaf="true" data-offset-key="9005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="9006"><span data-slate-leaf="true" data-offset-key="9006:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="9007"><span data-slate-leaf="true" data-offset-key="9007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="9008"><span data-slate-leaf="true" data-offset-key="9008:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="9009"><span data-slate-leaf="true" data-offset-key="9009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="9010"><span data-slate-leaf="true" data-offset-key="9010:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9011"><span data-slate-object="text" data-key="9012"><span data-slate-leaf="true" data-offset-key="9012:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="9013"><span data-slate-leaf="true" data-offset-key="9013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="9014"><span data-slate-leaf="true" data-offset-key="9014:0" data-first-offset="true"><span data-slate-string="true">): ReLU(inplace=</span></span></span><span data-slate-object="text" data-key="9015"><span data-slate-leaf="true" data-offset-key="9015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="9016"><span data-slate-leaf="true" data-offset-key="9016:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9017"><span data-slate-object="text" data-key="9018"><span data-slate-leaf="true" data-offset-key="9018:0" data-first-offset="true"><span data-slate-string="true">    (</span></span></span><span data-slate-object="text" data-key="9019"><span data-slate-leaf="true" data-offset-key="9019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span><span data-slate-object="text" data-key="9020"><span data-slate-leaf="true" data-offset-key="9020:0" data-first-offset="true"><span data-slate-string="true">): Linear(in_features=</span></span></span><span data-slate-object="text" data-key="9021"><span data-slate-leaf="true" data-offset-key="9021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="9022"><span data-slate-leaf="true" data-offset-key="9022:0" data-first-offset="true"><span data-slate-string="true">, out_features=</span></span></span><span data-slate-object="text" data-key="9023"><span data-slate-leaf="true" data-offset-key="9023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="9024"><span data-slate-leaf="true" data-offset-key="9024:0" data-first-offset="true"><span data-slate-string="true">, bias=</span></span></span><span data-slate-object="text" data-key="9025"><span data-slate-leaf="true" data-offset-key="9025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="9026"><span data-slate-leaf="true" data-offset-key="9026:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9027"><span data-slate-object="text" data-key="9028"><span data-slate-leaf="true" data-offset-key="9028:0" data-first-offset="true"><span data-slate-string="true">  )</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9029"><span data-slate-object="text" data-key="9030"><span data-slate-leaf="true" data-offset-key="9030:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9031"><span data-slate-object="text" data-key="9032"><span data-slate-leaf="true" data-offset-key="9032:0" data-first-offset="true"><span data-slate-string="true">这时，你可以发现输出就变为 10 个单元了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9033"><span data-slate-object="text" data-key="9034"><span data-slate-leaf="true" data-offset-key="9034:0" data-first-offset="true"><span data-slate-string="true">接下来就是在 CIFAR-10 上，使用 AlexNet 作为预训练模型训练我们自己的模型了。首先是数据读入，代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9035"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9036"><span data-slate-object="text" data-key="9037"><span data-slate-leaf="true" data-offset-key="9037:0" data-first-offset="true"><span data-slate-string="true">transform = transforms.Compose([</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9038"><span data-slate-object="text" data-key="9039"><span data-slate-leaf="true" data-offset-key="9039:0" data-first-offset="true"><span data-slate-string="true">    transforms.RandomResizedCrop((</span></span></span><span data-slate-object="text" data-key="9040"><span data-slate-leaf="true" data-offset-key="9040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">224</span></span></span></span><span data-slate-object="text" data-key="9041"><span data-slate-leaf="true" data-offset-key="9041:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span><span data-slate-object="text" data-key="9042"><span data-slate-leaf="true" data-offset-key="9042:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">224</span></span></span></span><span data-slate-object="text" data-key="9043"><span data-slate-leaf="true" data-offset-key="9043:0" data-first-offset="true"><span data-slate-string="true">)),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9044"><span data-slate-object="text" data-key="9045"><span data-slate-leaf="true" data-offset-key="9045:0" data-first-offset="true"><span data-slate-string="true">    transforms.ToTensor(),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9046"><span data-slate-object="text" data-key="9047"><span data-slate-leaf="true" data-offset-key="9047:0" data-first-offset="true"><span data-slate-string="true">    transforms.Normalize(mean=[</span></span></span><span data-slate-object="text" data-key="9048"><span data-slate-leaf="true" data-offset-key="9048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.485</span></span></span></span><span data-slate-object="text" data-key="9049"><span data-slate-leaf="true" data-offset-key="9049:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9050"><span data-slate-leaf="true" data-offset-key="9050:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.456</span></span></span></span><span data-slate-object="text" data-key="9051"><span data-slate-leaf="true" data-offset-key="9051:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9052"><span data-slate-leaf="true" data-offset-key="9052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.406</span></span></span></span><span data-slate-object="text" data-key="9053"><span data-slate-leaf="true" data-offset-key="9053:0" data-first-offset="true"><span data-slate-string="true">], std=[</span></span></span><span data-slate-object="text" data-key="9054"><span data-slate-leaf="true" data-offset-key="9054:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.229</span></span></span></span><span data-slate-object="text" data-key="9055"><span data-slate-leaf="true" data-offset-key="9055:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9056"><span data-slate-leaf="true" data-offset-key="9056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.224</span></span></span></span><span data-slate-object="text" data-key="9057"><span data-slate-leaf="true" data-offset-key="9057:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9058"><span data-slate-leaf="true" data-offset-key="9058:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.225</span></span></span></span><span data-slate-object="text" data-key="9059"><span data-slate-leaf="true" data-offset-key="9059:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9060"><span data-slate-object="text" data-key="9061"><span data-slate-leaf="true" data-offset-key="9061:0" data-first-offset="true"><span data-slate-string="true">    ])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9062"><span data-slate-object="text" data-key="9063"><span data-slate-leaf="true" data-offset-key="9063:0" data-first-offset="true"><span data-slate-string="true">cifar10_dataset = torchvision.datasets.CIFAR10(root=</span></span></span><span data-slate-object="text" data-key="9064"><span data-slate-leaf="true" data-offset-key="9064:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./data'</span></span></span></span><span data-slate-object="text" data-key="9065"><span data-slate-leaf="true" data-offset-key="9065:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9066"><span data-slate-object="text" data-key="9067"><span data-slate-leaf="true" data-offset-key="9067:0" data-first-offset="true"><span data-slate-string="true">                                       train=</span></span></span><span data-slate-object="text" data-key="9068"><span data-slate-leaf="true" data-offset-key="9068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span><span data-slate-object="text" data-key="9069"><span data-slate-leaf="true" data-offset-key="9069:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9070"><span data-slate-object="text" data-key="9071"><span data-slate-leaf="true" data-offset-key="9071:0" data-first-offset="true"><span data-slate-string="true">                                       transform=transform,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9072"><span data-slate-object="text" data-key="9073"><span data-slate-leaf="true" data-offset-key="9073:0" data-first-offset="true"><span data-slate-string="true">                                       target_transform=</span></span></span><span data-slate-object="text" data-key="9074"><span data-slate-leaf="true" data-offset-key="9074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">None</span></span></span></span><span data-slate-object="text" data-key="9075"><span data-slate-leaf="true" data-offset-key="9075:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9076"><span data-slate-object="text" data-key="9077"><span data-slate-leaf="true" data-offset-key="9077:0" data-first-offset="true"><span data-slate-string="true">                                       download=</span></span></span><span data-slate-object="text" data-key="9078"><span data-slate-leaf="true" data-offset-key="9078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="9079"><span data-slate-leaf="true" data-offset-key="9079:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9080"><span data-slate-object="text" data-key="9081"><span data-slate-leaf="true" data-offset-key="9081:0" data-first-offset="true"><span data-slate-string="true">dataloader = DataLoader(dataset=cifar10_dataset, </span></span></span><span data-slate-object="text" data-key="9082"><span data-slate-leaf="true" data-offset-key="9082:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 传入的数据集，必须参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9083"><span data-slate-object="text" data-key="9084"><span data-slate-leaf="true" data-offset-key="9084:0" data-first-offset="true"><span data-slate-string="true">                               batch_size=</span></span></span><span data-slate-object="text" data-key="9085"><span data-slate-leaf="true" data-offset-key="9085:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">32</span></span></span></span><span data-slate-object="text" data-key="9086"><span data-slate-leaf="true" data-offset-key="9086:0" data-first-offset="true"><span data-slate-string="true">,       </span></span></span><span data-slate-object="text" data-key="9087"><span data-slate-leaf="true" data-offset-key="9087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 输出的 batch 大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9088"><span data-slate-object="text" data-key="9089"><span data-slate-leaf="true" data-offset-key="9089:0" data-first-offset="true"><span data-slate-string="true">                               shuffle=</span></span></span><span data-slate-object="text" data-key="9090"><span data-slate-leaf="true" data-offset-key="9090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="9091"><span data-slate-leaf="true" data-offset-key="9091:0" data-first-offset="true"><span data-slate-string="true">,       </span></span></span><span data-slate-object="text" data-key="9092"><span data-slate-leaf="true" data-offset-key="9092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 数据是否打乱</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9093"><span data-slate-object="text" data-key="9094"><span data-slate-leaf="true" data-offset-key="9094:0" data-first-offset="true"><span data-slate-string="true">                               num_workers=</span></span></span><span data-slate-object="text" data-key="9095"><span data-slate-leaf="true" data-offset-key="9095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="9096"><span data-slate-leaf="true" data-offset-key="9096:0" data-first-offset="true"><span data-slate-string="true">)      </span></span></span><span data-slate-object="text" data-key="9097"><span data-slate-leaf="true" data-offset-key="9097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 进程数，0 表示只有主进程</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9098"><span data-slate-object="text" data-key="9099"><span data-slate-leaf="true" data-offset-key="9099:0" data-first-offset="true"><span data-slate-string="true">这里需要注意的是，我更改了 transform，并且将图片 resize 到 224x224 大小。这个尺寸是 Torchvision 中推荐的一个最小训练尺寸。模型就是我们修改后的 AlexNet，之后的训练跟我们之前讲的是一样的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9100"><span data-slate-object="text" data-key="9101"><span data-slate-leaf="true" data-offset-key="9101:0" data-first-offset="true"><span data-slate-string="true">先定义优化器，代码如下：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9102"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9103"><span data-slate-object="text" data-key="9104"><span data-slate-leaf="true" data-offset-key="9104:0" data-first-offset="true"><span data-slate-string="true">optimizer = torch.optim.SGD(alexnet.parameters(), lr=</span></span></span><span data-slate-object="text" data-key="9105"><span data-slate-leaf="true" data-offset-key="9105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1e-4</span></span></span></span><span data-slate-object="text" data-key="9106"><span data-slate-leaf="true" data-offset-key="9106:0" data-first-offset="true"><span data-slate-string="true">, weight_decay=</span></span></span><span data-slate-object="text" data-key="9107"><span data-slate-leaf="true" data-offset-key="9107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1e-2</span></span></span></span><span data-slate-object="text" data-key="9108"><span data-slate-leaf="true" data-offset-key="9108:0" data-first-offset="true"><span data-slate-string="true">, momentum=</span></span></span><span data-slate-object="text" data-key="9109"><span data-slate-leaf="true" data-offset-key="9109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0.9</span></span></span></span><span data-slate-object="text" data-key="9110"><span data-slate-leaf="true" data-offset-key="9110:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9111"><span data-slate-object="text" data-key="9112"><span data-slate-leaf="true" data-offset-key="9112:0" data-first-offset="true"><span data-slate-string="true">然后开始模型训练，是不是感觉后面的代码很眼熟，没错，它跟我们之前讲的一样：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9113"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9114"><span data-slate-object="text" data-key="9115"><span data-slate-leaf="true" data-offset-key="9115:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 训练 3 个 Epoch</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9116"><span data-slate-object="text" data-key="9117"><span data-slate-leaf="true" data-offset-key="9117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="9118"><span data-slate-leaf="true" data-offset-key="9118:0" data-first-offset="true"><span data-slate-string="true"> epoch </span></span></span><span data-slate-object="text" data-key="9119"><span data-slate-leaf="true" data-offset-key="9119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="9120"><span data-slate-leaf="true" data-offset-key="9120:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9121"><span data-slate-leaf="true" data-offset-key="9121:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="9122"><span data-slate-leaf="true" data-offset-key="9122:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="9123"><span data-slate-leaf="true" data-offset-key="9123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="9124"><span data-slate-leaf="true" data-offset-key="9124:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9125"><span data-slate-object="text" data-key="9126"><span data-slate-leaf="true" data-offset-key="9126:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9127"><span data-slate-leaf="true" data-offset-key="9127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="9128"><span data-slate-leaf="true" data-offset-key="9128:0" data-first-offset="true"><span data-slate-string="true"> item </span></span></span><span data-slate-object="text" data-key="9129"><span data-slate-leaf="true" data-offset-key="9129:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="9130"><span data-slate-leaf="true" data-offset-key="9130:0" data-first-offset="true"><span data-slate-string="true"> dataloader: </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9131"><span data-slate-object="text" data-key="9132"><span data-slate-leaf="true" data-offset-key="9132:0" data-first-offset="true"><span data-slate-string="true">        output = alexnet(item[</span></span></span><span data-slate-object="text" data-key="9133"><span data-slate-leaf="true" data-offset-key="9133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="9134"><span data-slate-leaf="true" data-offset-key="9134:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9135"><span data-slate-object="text" data-key="9136"><span data-slate-leaf="true" data-offset-key="9136:0" data-first-offset="true"><span data-slate-string="true">        target = item[</span></span></span><span data-slate-object="text" data-key="9137"><span data-slate-leaf="true" data-offset-key="9137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="9138"><span data-slate-leaf="true" data-offset-key="9138:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9139"><span data-slate-object="text" data-key="9140"><span data-slate-leaf="true" data-offset-key="9140:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9141"><span data-slate-leaf="true" data-offset-key="9141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 使用交叉熵损失函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9142"><span data-slate-object="text" data-key="9143"><span data-slate-leaf="true" data-offset-key="9143:0" data-first-offset="true"><span data-slate-string="true">        loss = nn.CrossEntropyLoss()(output, target)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9144"><span data-slate-object="text" data-key="9145"><span data-slate-leaf="true" data-offset-key="9145:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9146"><span data-slate-leaf="true" data-offset-key="9146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="9147"><span data-slate-leaf="true" data-offset-key="9147:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="9148"><span data-slate-leaf="true" data-offset-key="9148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'Epoch {}, Loss {}'</span></span></span></span><span data-slate-object="text" data-key="9149"><span data-slate-leaf="true" data-offset-key="9149:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="9150"><span data-slate-leaf="true" data-offset-key="9150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="9151"><span data-slate-leaf="true" data-offset-key="9151:0" data-first-offset="true"><span data-slate-string="true">(epoch + </span></span></span><span data-slate-object="text" data-key="9152"><span data-slate-leaf="true" data-offset-key="9152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="9153"><span data-slate-leaf="true" data-offset-key="9153:0" data-first-offset="true"><span data-slate-string="true"> , loss))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9154"><span data-slate-object="text" data-key="9155"><span data-slate-leaf="true" data-offset-key="9155:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9156"><span data-slate-leaf="true" data-offset-key="9156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#以下代码的含义，我们在之前的文章中已经介绍过了</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9157"><span data-slate-object="text" data-key="9158"><span data-slate-leaf="true" data-offset-key="9158:0" data-first-offset="true"><span data-slate-string="true">        alexnet.zero_grad()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9159"><span data-slate-object="text" data-key="9160"><span data-slate-leaf="true" data-offset-key="9160:0" data-first-offset="true"><span data-slate-string="true">        loss.backward()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9161"><span data-slate-object="text" data-key="9162"><span data-slate-leaf="true" data-offset-key="9162:0" data-first-offset="true"><span data-slate-string="true">        optimizer.step()</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9163"><span data-slate-object="text" data-key="9164"><span data-slate-leaf="true" data-offset-key="9164:0" data-first-offset="true"><span data-slate-string="true">这里用到的微调方式，就是所有参数都需要进行重新训练。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9165"><span data-slate-object="text" data-key="9166"><span data-slate-leaf="true" data-offset-key="9166:0" data-first-offset="true"><span data-slate-string="true">而第一种方式（固定整个网络的参数，只训练最后的全连接层），只需要在读取完预训练模型之后，将全连接层之前的参数全部锁死即可，也就是让他们无法训练，我们模型训练时，只训练全连接层就行了，其余一切都不变。代码如下所示：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9167"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9168"><span data-slate-object="text" data-key="9169"><span data-slate-leaf="true" data-offset-key="9169:0" data-first-offset="true"><span data-slate-string="true">alexnet = models.alexnet()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9170"><span data-slate-object="text" data-key="9171"><span data-slate-leaf="true" data-offset-key="9171:0" data-first-offset="true"><span data-slate-string="true">alexnet.load_state_dict(torch.load(</span></span></span><span data-slate-object="text" data-key="9172"><span data-slate-leaf="true" data-offset-key="9172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'./model/alexnet-owt-4df8aa71.pth'</span></span></span></span><span data-slate-object="text" data-key="9173"><span data-slate-leaf="true" data-offset-key="9173:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9174"><span data-slate-object="text" data-key="9175"><span data-slate-leaf="true" data-offset-key="9175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="9176"><span data-slate-leaf="true" data-offset-key="9176:0" data-first-offset="true"><span data-slate-string="true"> param </span></span></span><span data-slate-object="text" data-key="9177"><span data-slate-leaf="true" data-offset-key="9177:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="9178"><span data-slate-leaf="true" data-offset-key="9178:0" data-first-offset="true"><span data-slate-string="true"> alexnet.parameters():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9179"><span data-slate-object="text" data-key="9180"><span data-slate-leaf="true" data-offset-key="9180:0" data-first-offset="true"><span data-slate-string="true">    param.requires_grad = </span></span></span><span data-slate-object="text" data-key="9181"><span data-slate-leaf="true" data-offset-key="9181:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9182"><span data-slate-object="text" data-key="9183"><span data-slate-leaf="true" data-offset-key="9183:0" data-first-offset="true"><span data-slate-string="true">说到这里，我们的模型微调就讲完了，你可以自己动手试试看。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9184" id="sr-toc-9"><span data-slate-object="text" data-key="9185"><span data-slate-leaf="true" data-offset-key="9185:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9186"><span data-slate-object="text" data-key="9187"><span data-slate-leaf="true" data-offset-key="9187:0" data-first-offset="true"><span data-slate-string="true">今天的内容，主要是围绕如何自己搭建一个网络模型，我们介绍了 nn.Module 模块以及围绕它的一些方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9188"><span data-slate-object="text" data-key="9189"><span data-slate-leaf="true" data-offset-key="9189:0" data-first-offset="true"><span data-slate-string="true">根据这讲我分享给你的思路，之后如果你有什么想法时，就可以快速搭建一个模型进行训练和验证。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9190"><span data-slate-object="text" data-key="9191"><span data-slate-leaf="true" data-offset-key="9191:0" data-first-offset="true"><span data-slate-string="true">其实，实际的开发中，我们很少会自己去构建一个网络，绝大多数都是直接使用前人已经构建好的一些经典网络，例如，Torchvision 中那些模型。当你去看一些还没有被封装到 PyTorch 的模型的时候，今天所学的内容就能够帮你直接借鉴前人的工作结果，训练属于自己的模型。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9192"><span data-slate-object="text" data-key="9193"><span data-slate-leaf="true" data-offset-key="9193:0" data-first-offset="true"><span data-slate-string="true">最后，我再结合自己的学习研究经验，给有兴趣了解更多深度学习知识的同学提供一些学习线索。目前我们只讲了卷积层，对于一个网络还有很多其余层，比如 Dropout、Pooling 层、BN 层、激活函数等。Dropout 函数、Pooling 层、激活函数相对比较好理解，BN 层可能稍微复杂一些。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9194"><span data-slate-object="text" data-key="9195"><span data-slate-leaf="true" data-offset-key="9195:0" data-first-offset="true"><span data-slate-string="true">另外，细心的小伙伴应该发现了，我们在打印 AlexNet 网络结构中的时候，它的一部分是使用 nn.Sequential 构建的。</span></span></span><span data-slate-object="text" data-key="9196"><span data-slate-leaf="true" data-offset-key="9196:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">nn.Sequential 是一种快速构建网络的方式</span></span></span></span><span data-slate-object="text" data-key="9197"><span data-slate-leaf="true" data-offset-key="9197:0" data-first-offset="true"><span data-slate-string="true">，有了这节课的知识作储备，弄懂这个方式你会觉得非常简单，也推荐你去看看。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="9198" id="sr-toc-10"><span data-slate-object="text" data-key="9199"><span data-slate-leaf="true" data-offset-key="9199:0" data-first-offset="true"><span data-slate-string="true">每课一练</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="9200"><span data-slate-object="text" data-key="9201"><span data-slate-leaf="true" data-offset-key="9201:0" data-first-offset="true"><span data-slate-string="true">请你自己构建一个卷积神经网络，基于 CIFAR-10，训练一个图像分类模型。因为还没有学习图像分类原理，所以我先帮你写好了网络的结构，需要你补全数据读取、损失函数 (交叉熵损失) 与优化方法（SGD）等部分。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="9202"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="9203"><span data-slate-object="text" data-key="9204"><span data-slate-leaf="true" data-offset-key="9204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">class</span></span></span></span><span data-slate-object="text" data-key="9205"><span data-slate-leaf="true" data-offset-key="9205:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9206"><span data-slate-leaf="true" data-offset-key="9206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">MyCNN</span></span></span></span><span data-slate-object="text" data-key="9207"><span data-slate-leaf="true" data-offset-key="9207:0" data-first-offset="true"><span data-slate-string="true">(nn.Module):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9208"><span data-slate-object="text" data-key="9209"><span data-slate-leaf="true" data-offset-key="9209:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9210"><span data-slate-leaf="true" data-offset-key="9210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="9211"><span data-slate-leaf="true" data-offset-key="9211:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9212"><span data-slate-leaf="true" data-offset-key="9212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">__init__</span></span></span></span><span data-slate-object="text" data-key="9213"><span data-slate-leaf="true" data-offset-key="9213:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="9214"><span data-slate-leaf="true" data-offset-key="9214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self</span></span></span></span><span data-slate-object="text" data-key="9215"><span data-slate-leaf="true" data-offset-key="9215:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9216"><span data-slate-object="text" data-key="9217"><span data-slate-leaf="true" data-offset-key="9217:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9218"><span data-slate-leaf="true" data-offset-key="9218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span><span data-slate-object="text" data-key="9219"><span data-slate-leaf="true" data-offset-key="9219:0" data-first-offset="true"><span data-slate-string="true">().__init__()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9220"><span data-slate-object="text" data-key="9221"><span data-slate-leaf="true" data-offset-key="9221:0" data-first-offset="true"><span data-slate-string="true">        self.conv1 = nn.Conv2d(</span></span></span><span data-slate-object="text" data-key="9222"><span data-slate-leaf="true" data-offset-key="9222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="9223"><span data-slate-leaf="true" data-offset-key="9223:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9224"><span data-slate-leaf="true" data-offset-key="9224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">16</span></span></span></span><span data-slate-object="text" data-key="9225"><span data-slate-leaf="true" data-offset-key="9225:0" data-first-offset="true"><span data-slate-string="true">, kernel_size=</span></span></span><span data-slate-object="text" data-key="9226"><span data-slate-leaf="true" data-offset-key="9226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="9227"><span data-slate-leaf="true" data-offset-key="9227:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9228"><span data-slate-object="text" data-key="9229"><span data-slate-leaf="true" data-offset-key="9229:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9230"><span data-slate-leaf="true" data-offset-key="9230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># conv1 输出的特征图为 222x222 大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9231"><span data-slate-object="text" data-key="9232"><span data-slate-leaf="true" data-offset-key="9232:0" data-first-offset="true"><span data-slate-string="true">        self.fc = nn.Linear(</span></span></span><span data-slate-object="text" data-key="9233"><span data-slate-leaf="true" data-offset-key="9233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">16</span></span></span></span><span data-slate-object="text" data-key="9234"><span data-slate-leaf="true" data-offset-key="9234:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="9235"><span data-slate-leaf="true" data-offset-key="9235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">222</span></span></span></span><span data-slate-object="text" data-key="9236"><span data-slate-leaf="true" data-offset-key="9236:0" data-first-offset="true"><span data-slate-string="true"> * </span></span></span><span data-slate-object="text" data-key="9237"><span data-slate-leaf="true" data-offset-key="9237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">222</span></span></span></span><span data-slate-object="text" data-key="9238"><span data-slate-leaf="true" data-offset-key="9238:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="9239"><span data-slate-leaf="true" data-offset-key="9239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="9240"><span data-slate-leaf="true" data-offset-key="9240:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9241"></div><div data-slate-type="code-line" data-slate-object="block" data-key="9242"><span data-slate-object="text" data-key="9243"><span data-slate-leaf="true" data-offset-key="9243:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="9244"><span data-slate-leaf="true" data-offset-key="9244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="9245"><span data-slate-leaf="true" data-offset-key="9245:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="9246"><span data-slate-leaf="true" data-offset-key="9246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">forward</span></span></span></span><span data-slate-object="text" data-key="9247"><span data-slate-leaf="true" data-offset-key="9247:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="9248"><span data-slate-leaf="true" data-offset-key="9248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">self, </span></span></span></span><span data-slate-object="text" data-key="9249"><span data-slate-leaf="true" data-offset-key="9249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span></span><span data-slate-object="text" data-key="9250"><span data-slate-leaf="true" data-offset-key="9250:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9251"><span data-slate-object="text" data-key="9252"><span data-slate-leaf="true" data-offset-key="9252:0" data-first-offset="true"><span data-slate-string="true">        x = self.conv1(</span></span></span><span data-slate-object="text" data-key="9253"><span data-slate-leaf="true" data-offset-key="9253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">input</span></span></span></span><span data-slate-object="text" data-key="9254"><span data-slate-leaf="true" data-offset-key="9254:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9255"><span data-slate-object="text" data-key="9256"><span data-slate-leaf="true" data-offset-key="9256:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9257"><span data-slate-leaf="true" data-offset-key="9257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 进去全连接层之前，先将特征图铺平</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9258"><span data-slate-object="text" data-key="9259"><span data-slate-leaf="true" data-offset-key="9259:0" data-first-offset="true"><span data-slate-string="true">        x = x.view(x.shape[</span></span></span><span data-slate-object="text" data-key="9260"><span data-slate-leaf="true" data-offset-key="9260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="9261"><span data-slate-leaf="true" data-offset-key="9261:0" data-first-offset="true"><span data-slate-string="true">], -</span></span></span><span data-slate-object="text" data-key="9262"><span data-slate-leaf="true" data-offset-key="9262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="9263"><span data-slate-leaf="true" data-offset-key="9263:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9264"><span data-slate-object="text" data-key="9265"><span data-slate-leaf="true" data-offset-key="9265:0" data-first-offset="true"><span data-slate-string="true">        x = self.fc(x)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="9266"><span data-slate-object="text" data-key="9267"><span data-slate-leaf="true" data-offset-key="9267:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="9268"><span data-slate-leaf="true" data-offset-key="9268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="9269"><span data-slate-leaf="true" data-offset-key="9269:0" data-first-offset="true"><span data-slate-string="true"> x</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="9270"><span data-slate-object="text" data-key="9271"><span data-slate-leaf="true" data-offset-key="9271:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区和我交流讨论。如果这节课对你有帮助，也推荐你顺手分享给更多的同事、朋友，跟他一起学习进步。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-11">精选留言 (24)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/j24oyxHcpB5AMR9pMO6fITqnOFVOncnk2T1vdu1rYLfq1cN6Sj7xVrBVbCvHXUad2MpfyBcE4neBguxmjIxyiaQ/132"></div></div><div><div><div><span>vcjmhg</span></div></div><div>class MyCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3, 16, kernel_size=3)
        # conv1 输出的特征图为 222x222 大小
        self.fc = nn.Linear (16 * 222 * 222, 10)

    def forward (self, input):
        x = self.conv1 (input)
        # 进去全连接层之前，先将特征图铺平
        x = x.view (x.shape [0], -1)
        x = self.fc (x)
        return x
# 尽量使用 gpu 进行训练，如果没有 cpu 则使用 gpu 来训练
device = torch.device ("cuda:0" if torch.cuda.is_available () else "cpu")
cnn = MyCNN ().to (device)
transform = transforms.Compose ([
    # 修改裁剪图片的尺寸
    transforms.RandomResizedCrop ((224, 224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
])
cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',
                                               train=False,
                                               transform=transform,
                                               target_transform=None,
                                               download=True)
dataloader = DataLoader (dataset=cifar10_dataset,  # 传入的数据集，必须参数
                        batch_size=32,  # 输出的 batch 大小
                        shuffle=True,  # 数据是否打乱
                        num_workers=2)  # 进程数，0 表示只有主进程
# 定义优化器
optimizer = torch.optim.SGD (cnn.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)
steps = 0
for epoch in range (16):
    for item in dataloader:
        steps += 1
        output = cnn (item [0].to (device))
        target = item [1].to (device)
        # 使用交叉熵损失函数
        loss = nn.CrossEntropyLoss ()(output, target)
        # 每 100 步打印一次 loss
        if steps % 100 == 0:
            print ('Epoch {}, Loss {}'.format (epoch + 1, loss))
        cnn.zero_grad ()
        loss.backward ()
        optimizer.step ()
# 测试分类结果
im = Image.open ('data/img.png')
input_tensor = transform (im).unsqueeze (0)
result = cnn (input_tensor.to (device)).argmax ()
print (result)
# tensor (3, device='cuda:0')</div><div><p>作者回复: 👍🏻👍🏻 ^^</p></div><div><div>2021-11-16</div><div><div><i></i><span>2</span></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/e5/76/5d0b66aa.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Mr_李冲</span></div></div><div>我在使用预训练好的 alexnet-owt-7be5be79.pth 模型，反复执行下面这段代码的时候
alexnet (input_tensor).argmax ()
得到的结果并不总是 263，而有时候会得到 151 和 264 或者其他的数值，请问我最终应该相信哪一个预测结果呢，是进行多次预测取预测次数最多的那个吗？还是有别的科学的方法呢？</div><div><p>作者回复：你好，感谢你的留言。
如果保证输入一样，正常不会这样的。
你检查检查你的预处理的 resize 是不是会随机切割。
还是不行的话，可以把你的代码发给我看看。</p></div><div><div>2022-03-15</div><div><div><i></i><span>7</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>clee</span></div></div><div>调整之后，可以正常训练了，但是测试数据的时候我发现有些图片分类会有问题，比如狗和猫，鹿和马就容易分类错误，这是因为欠拟合吗？应该如何优化？</div><div><p>作者回复: hi。
CIFAR10 的图片比较小，猫和狗、鹿和马比较像，一部分图片预测错误是可以接受的。可以在下面尝试 1 之后，用验证集评估一下模型精确与召回，看看是否为一个可接受的结果，如果是的话，那部分图片分错是没问题的。

可以做如下尝试：
1. 把 train=Fasle 改为 True。我为了讲解方便直接使用验证集训练的。
cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',
                                               train=False,
                                               transform=transform,
                                           target_transform=None,
                                               download=True)
2. 把学习率调小一点试试。^^</p></div><div><div>2021-11-16</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDm5eHbw1fuicJiaXercgBI48O0Idt2mHUElmZyBM4o119NkndU1SNpsv8rZzKFibj8z1FibFAdNEO3zw/132"></div></div><div><div><div><span>zhangting</span></div></div><div>老师请教个问题，为什么改全连接后，训练出来的模型，总是输出的是 5。而未做改动前，预测出来的是 263. 源码如下：

alexnet = models.alexnet ()
alexnet.load_state_dict (torch.load ('./model/alexnet-owt-7be5be79.pth')) 

fc_in_features = alexnet.classifier [6].in_features

alexnet.classifier [6] = torch.nn.Linear (fc_in_features, 10)
print (alexnet)

transform = transforms.Compose ([
    transforms.RandomResizedCrop ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
    ])

cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',                                       
                                               train=False,                                       
                                               transform=transform,                                       
                                               target_transform=None,                                       
                                               download=False)
dataloader = DataLoader (dataset=cifar10_dataset, batch_size=32, shuffle=True, num_workers=4)

optimizer = torch.optim.SGD (alexnet.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

for epoch in range (3):
    for item in dataloader: 
        output = alexnet (item [0])
        target = item [1]
        loss = nn.CrossEntropyLoss ()(output, target)
        print ('Epoch {}, Loss {}'.format (epoch + 1 , loss))
        alexnet.zero_grad ()
        loss.backward ()
        optimizer.step ()
       
im = Image.open ('dog.jpg')
transform = transforms.Compose ([
    transforms.Resize ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
    ])
input_tensor = transform (im).unsqueeze (0)

alexnet.eval ()

print (alexnet (input_tensor).argmax ())</div><div><p>作者回复：你好，感谢你的留言。
输出 5 不是正确的吗？
cifar10 里 dog 就是 5 啊</p></div><div><div>2022-05-12</div><div><div><i></i><span>3</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/f2/23/bb13b3ed.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 刘利</span></div></div><div>hi，老师，微调的时候，如果这样写，参数都不更新了，那还有哪部分参数会被训练呢？是需要再接一层全连接层么？
alexnet = models.alexnet ()
alexnet.load_state_dict (torch.load ('./model/alexnet-owt-4df8aa71.pth'))
for param in alexnet.parameters (): 
    param.requires_grad = False</div><div><p>作者回复：你好，刘利，感谢留言。
就只训练全连接层了。
finetune 的时候会根据你的分类任务，新加一个全连接层 (而不是使用原模型的)</p></div><div><div>2022-05-03</div><div><div><i></i><span>2</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 马克图布</span></div></div><div>思考：

使用 `nn.CrossEntropyLoss` 作为 loss function 时，会自动在网络最后添加 `nn.LogSoftmax` 和 `nn.nLLLos`，因此不用再在 fc 层后面手动添加 Softmax 层；

问题：

transform 中，标准化的 mean 和 std 是如何确定的（我们需要使用均值为 [0.485, 0.456, 0.406]，标准差为 [0.229, 0.224, 0.225] 对数据进行正规化）？</div><div><p>作者回复：你好，马克图布，感谢你的留言。
对，内置了 Softmax。

均值 [0.485, 0.456, 0.406]，标准差 [0.229, 0.224, 0.225]
是 ImageNet 的均值与标准差。torchvision 中的模型都是在 ImageNet 上训练的。</p></div><div><div>2021-11-12</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Geek_827444</span></div></div><div>老师您好：我一步一步按照咱们那个步骤来的，为什么代码运行不了那？谢谢您！

import torch
import torch.nn as nn
import torch.optim as optim
import torchvision.models as models

import torchvision.models as models
alexnet = models.alexnet (pretrained=True)


import torchvision.transforms as transforms

transform = transforms.Compose ([
    transforms.RandomResizedCrop ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485,0.456,0.406],std=[0.229,0.224,0.225])
])

import torchvision

cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',# 注：这里是存在													pycharm 文件当中的 data 文件夹里
                                              train=False,
                                              transform=transform,
                                              target_transform=None,
                                              download=True)

from torch.utils.data import DataLoader

dataloader = DataLoader (dataset=cifar10_dataset,
                       batch_size=32,
                       shuffle=True,
                       num_workers=2)



fc_in_features = alexnet.classifier [6].in_features
alexnet.classifier [6] = torch.nn.Linear (fc_in_features,10)

optimizer = torch.optim.SGD (alexnet.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

for epoch in range (3):
    # ↓定义比对的元素
    for item in dataloader:
        output = alexnet (item [0])
        target = item [1]

        # ↓使用损失函数
        loss = nn.CrossEntropyLoss ()(output, target)
        print ('Epoch {},Loss {}'.format (epoch + 1, loss))

        # ↓更新损失函数和优化函数
        alexnet.zero_grad ()
        loss.backward ()
        optimizer.step ()

</div><div><p>作者回复：抱歉，回复迟了。
我执行了你的代码，并没有报错。你提示什么错误呢？</p></div><div><div>2022-08-09</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>John (易筋)</span></div></div><div>巨人肩膀 @马克图库
import torch
import torch.nn as nn
import torchvision
import torchvision.transforms as transforms
from PIL import Image
transform = transforms.Compose ([transforms.RandomResizedCrop ((224, 224)), 
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
])

cifar10_train_dataset = torchvision.datasets.CIFAR10 (root='./data',train=True,transform=transform,target_transform=None)
train_loader = torch.utils.data.DataLoader (dataset=cifar10_train_dataset,batch_size=32,shuffle=True,num_workers=2) 
classes = ('plane', 'car', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck')
n_total_steps = len (train_loader)

class MyCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3, 16, kernel_size=3)
        self.fc = nn.Linear (16 * 222 * 222, 10)
        
    def forward (self, input):
        x = self.conv1 (input)
        x = x.view (x.shape [0], -1)
        x = self.fc (x)
        return x
    
device = torch.device ('cuda:0' if torch.cuda.is_available () else 'cpu')
model = MyCNN ().to (device)

criterion = nn.CrossEntropyLoss () 
optimizer = torch.optim.SGD (model.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

print ('Start training...')
for epoch in range (4):
    for i, (images, labels) in enumerate (train_loader):
        images = images.to (device)
        labels = labels.to (device)
        labels_pred = model (images)
        loss = criterion (labels_pred, labels)
        
        optimizer.zero_grad ()
        loss.backward ()
        optimizer.step
        
        if (i+1) % 100 == 0:
            print (f'Epoch [{epoch+1}/{4}], Step [{i+1:5d}/{n_total_steps}], Loss={loss.item ():.4f}')

print ('Training complete!')

with torch.no_grad ():
    im = Image.open ('./images/dog.jpg')
    input_tensor = transform (im).unsqueeze (0).to (device)
    label_pred = model (input_tensor).argmax ()
    print (f'Your label predicted: {classes [label_pred]}')</div><div><p>作者回复: 👍🏻</p></div><div><div>2022-08-07</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>John (易筋)</span></div></div><div>// 这里需要 import DataLoader
from torch.utils.data import Dataset, DataLoader

cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data/',
                                              train=False,
                                              transform=transforms.ToTensor (),
                                              target_transform=None,
                                              download=True)
tensor_dataloader = DataLoader (dataset=cifar10_dataset,                               
                               batch_size=32)
data_iter = iter (tensor_dataloader)
img_tensor, label_tensor = data_iter.next ()
print (img_tensor.shape)
grid_tensor = torchvision.utils.make_grid (img_tensor, nrow=16, padding=2)
grid_img = transforms.ToPILImage ()(grid_tensor)
display (grid_img)
</div><div><div>2022-08-07</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2c/8d/70/b0047299.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Zeurd</span></div></div><div>老师，想请问一下，我在换了一个模型 InceptionV3，做损失函数的时候，会提示我 argument 'input' (position 1) must be Tensor, not InceptionOutputs 这是什么原因呢？我用 output 预测完输出的是一个 InceptionOutPuts 的量，而不是 Tensor 形式的，当我想用 torch.tensor 又会提示我不是一维的，不能转化</div><div><p>作者回复：你好，Zeurd，感谢你的留言。V3 的话比较特殊，有两个输出，使用第一个就行。
你可以这样修改你的代码。
output, _ = your_v3_model (data)

具体你可以参考这里，https://pytorch.org/tutorials/beginner/finetuning_torchvision_models_tutorial.html#inception-v3

Finally, Inception v3 was first described in Rethinking the Inception Architecture for Computer Vision. This network is unique because it has two output layers when training. The second output is known as an auxiliary output and is contained in the AuxLogits part of the network. The primary output is a linear layer at the end of the network. Note, when testing we only consider the primary output. </p></div><div><div>2022-07-25</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1d/3f/4a/b1c9e5e3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>万化 8af10b</span></div></div><div>老师，请教一下，上面的例子

# 训练 3 个 Epoch
for epoch in range (3): 
for item in dataloader: 
output = alexnet (item [0]) target = item [1] 
# 使用交叉熵损失函数 loss = nn.CrossEntropyLoss ()(output, target) 
print ('Epoch {}, Loss {}'.format (epoch + 1 , loss)) #以下代码的含义，我们在之前的文章中已经介绍过了 alexnet.zero_grad () 
loss.backward ()
 optimizer.step ()


每 epoch 里面作的次数我做了计数是 313 次 backwards，为什么会是这个数字，我计算了以下 50000 张训练集，50000/32/2=781.25 次才对阿。请老师点明我算错在哪里？</div><div><p>作者回复：应为例子里我担心训练集数量多，所以用的测试集进行训练。
cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data', train=False, transform=transform, target_transform=None, download=True)

train=False 了，只有 10000 张图片。</p></div><div><div>2022-06-23</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>亚林</span></div></div><div>照抄抄出来了，但是对损失函数选取，优化器参数设置，还是一脸懵</div><div><p>作者回复：这个只能通过项目总结了。
每一种损失函数会解决不同的问题，可以看看图像分割那节。
^^</p></div><div><div>2022-05-20</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/f2/23/bb13b3ed.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>刘利</span></div></div><div>hi，老师，微调的时候，</div><div><div>2022-05-03</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/89/23/e71f180b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Geek_fc975d</span></div></div><div>or epoch in range (3): for item in dataloader: output = alexnet (item [0]) target = item [1] # 使用交叉熵损失函数 loss = nn.CrossEntropyLoss ()(output, target) print ('Epoch {}, Loss {}'.format (epoch + 1 , loss)) #以下代码的含义，我们在之前的文章中已经介绍过了 alexnet.zero_grad () loss.backward () optimizer.step ()

想请教老师和各位同学，这个 item 是多少， 是 cifar10 的总数据数 /batch_size 吗？原先我以为这个值等于 batch-size，看起来这个结果不对呢。

还想请教下 epoch 这个参数是指什么， 是说按照这个 batch_size 将整个数据集训练几次吗？

我在 Jupyter 中训练，训练的速度超级慢，有什么提升的方法吗？</div><div><p>作者回复：你好，感谢留言。
1. item 是迭代一次 dataloader 返回的数据，他包含 batch_size 条数据或 batch_size 张图片
2. Epoch 的解释在 “加餐 | 机器学习其实就那么几件事”
3. 训练速度取决于硬件。可以在更好的 CPU 或 GPU 上尝试训练，速度会变快的。</p></div><div><div>2022-04-10</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIW9p3Q9OuX2kGgroDacib99YvjkichWdl54YBVicno8wNPW9gKibUNb0QPtYvTljSWFdjgXdrGPr7Q5g/132"></div></div><div><div><div><span>璐璐棒</span></div></div><div>你好，老师，请教下，想用预训练的 effientnet b0 来训练自己的数据，自己的数据是 png 的图片，这个行的通吗，是需要修改下输入通道数就可以吗，还是说不能使用预训练的模型，可以重新训练一个新的模型？</div><div><p>作者回复：你好，璐璐棒。感谢你的留言。
把 PNG 转成 RGB 就可以使用预训练模型进行训练了。</p></div><div><div>2021-12-21</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/d2/d7/7f00bea1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Hit 黎明分明🎩</span></div></div><div>
# 数据加载

transform = transforms.Compose ([transforms.RandomResizedCrop ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
    ])
cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',
                                       train=False,
                                       transform=transform,
                                       target_transform=None,
                                       download=True)
dataloader = DataLoader (dataset=cifar10_dataset, # 传入的数据集，必须参数
                               batch_size=32,       # 输出的 batch 大小
                               shuffle=True,       # 数据是否打乱
                               num_workers=0)      # 进程数，0 表示只有主进程


# 定义模型
class myCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3,16,kernel_size=3)
        self.fc = nn.Linear (16 * 222 *222 ,10)
        
    def forward (self,input):
        x = self.conv1 (input)
        # 进去全连接层之前，先将特征图铺平
        x = x.view (x.shape [0],-1)
        x = self.fc (x)
        return x

# 尽量使用 gpu 进行训练，如果没有 cpu 则使用 gpu 来训练
device = torch.device ("cuda:0"if torch.cuda.is_available () else "cpu")

cnn = myCNN ().to (device)


optimizer = torch.optim.SGD (cnn.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)
steps = 0

for epoch in range (30):
    for item in dataloader:
        steps += 1
        output = cnn (item [0])
        target = item [1].to (device)
        loss = nn.CrossEntropyLoss ()(output,target)
        print ('Epoch {},Loss {}'.format (epoch + 1 ,loss))
        cnn.zero_grad ()
        loss.backward ()
        optimizer.step ()
im = Image.open ('data/img.png')
input_tensor = transform (im).unsqueeze (0)
result = cnn (input_tensor.to (device)).argmax ()
print (result)
老师您好，我运行以后出现报错：
RuntimeError: Input type (torch.FloatTensor) and weight type (torch.cuda.FloatTensor) should be the same or input should be a MKLDNN tensor and weight is a dense tensor</div><div><p>作者回复: hello.，你好。
Input type (torch.FloatTensor) 是说输入的数据在 cpu 上。
weight type (torch.cuda.FloatTensor) 是说模型的数据在 gpu 上。
所以报了这个错误。
看你的代码应该是损失函数不在 GPU 上。
可以这样改一下试试。
loss = nn.CrossEntropyLoss ().to (device)(output,target)
数据、模型、损失函数，有 GPU 的话都要放到 GPU 上。
    
</p></div><div><div>2021-12-01</div><div><div><i></i><span>3</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/fc/de/6e2cb960.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>autiplex</span></div></div><div>from PIL import Image
from torch.utils.data import DataLoader
import torch
from torch import nn
import torchvision.transforms as transforms
import torchvision


#  读取数据
transform = transforms.Compose ([transforms.RandomResizedCrop ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
    ])

cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',
                                       train=False,
                                       transform=transform,
                                       target_transform=None,
                                       download=True)
dataloader = DataLoader (dataset=cifar10_dataset, # 传入的数据集，必须参数
                               batch_size=32,       # 输出的 batch 大小
                               shuffle=True,       # 数据是否打乱
                               num_workers=2)      # 进程数，0 表示只有主进程


#  网络结构
class MyCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3, 16, kernel_size=3)
        # conv1 输出的特征图为 222x222 大小
        self.fc = nn.Linear (16 * 222 * 222, 10)

    def forward (self, input):
        x = self.conv1 (input)
        # 进去全连接层之前，先将特征图铺平
        x = x.view (x.shape [0], -1)
        x = self.fc (x)
        return x

cnn = MyCNN ()
#  损失函数
criterion = nn.CrossEntropyLoss ()
optimizer = torch.optim.SGD (cnn.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

#  训练 10 个 Epoch
for epoch in range (10):
    for item in dataloader: 
        output = cnn (item [0])
        target = item [1]
        loss = criterion (output, target)
        print ('Epoch {}, Loss {}'.format (epoch + 1 , loss))
        #以下代码的含义，我们在之前的文章中已经介绍过了
        cnn.zero_grad ()
        loss.backward ()
        optimizer.step ()

#  测试结果
pass

老师上面的代码运行会发生下面的报错，我查了一下说是要放在__name__=='__main__' 里运行，我没太明白

The "freeze_support ()" line can be omitted if the program
        is not going to be frozen to produce an executable.
</div><div><p>作者回复：你好。感谢你的留言。我用你发的代码，并没有出现你说的错误。
我查了一下似乎是多进程的问题。你可以这样试试：
1. num_worker 设为 - 1 试试。
2. num_worker 设为 1 试试。</p></div><div><div>2021-11-23</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>zhaobk</span></div></div><div>#图像分类
class MyCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3, 16, kernel_size=3)
        # conv1 输出的特征图为 222x222 大小
        self.fc = nn.Linear (16 * 222 * 222, 10)

    def forward (self, input):
        x = self.conv1 (input)
        # 进去全连接层之前，先将特征图铺平
        x = x.view (x.shape [0], -1)
        x = self.fc (x)
        return x


# 定义读取数据格式 mean 和 std 是 ImageNet 的均值与标准差。torchvision 中的模型都是在 ImageNet 上训练的。
transform = transforms.Compose ([
    transforms.RandomResizedCrop ((224,224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406],
                         std=[0.229, 0.224, 0.225])
])
# 获取数据

cifar10_dataset = torchvision.datasets.CIFAR10 (root='./data',
                                       train=False,
                                       transform=transform,
                                       target_transform=None,
                                       download=True)


# 加载数据
dataloader = DataLoader (
    dataset=cifar10_dataset, # 传入的数据集，必须参数
    batch_size=32,       # 输出的 batch 大小
    shuffle=True,       # 数据是否打乱
    num_workers=0)      # 进程数，0 表示只有主进程

cnn = MyCNN ()
# 定义优化器
optimizer = torch.optim.SGD (cnn.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

for epoch in range (10):
    for item in dataloader:
        cnt+=1
        output = cnn (item [0])
        target = item [1]
        # 使用交叉熵损失函数
        loss = nn.CrossEntropyLoss ()(output, target)
        print ('Epoch {}, Loss {}'.format (epoch + 1 , loss))
        #首先要通过 zero_grad () 函数把梯度清零

        cnn.zero_grad ()
        # 算完 loss 之后进行反向传播，这个过程之后梯度会记录在变量中
        loss.backward ()
        # 用计算的梯度去做优化
        optimizer.step ()

im = Image.open ('dog.jpg')
input_tensor = transform (im).unsqueeze (0)
print (cnn (input_tensor).argmax ())

我训练完 loss 总是在 1.8~~2.0 之间震荡，最后用 dog.jpg 测试出来的分类是 3，cat。请问老师，我的代码有问题么？还是训练的少？</div><div><p>作者回复: hi，zhaobk，你好。谢谢你的留言。
看代码似乎没有问题。
CIFAR10 的图片比较小，猫和狗比较像，一部分图片预测错误是可以接受的。可以把 cifar10_dataset = torchvision.datasets.CIFAR10 中的 train 改为 True 试一试，我为了方便直接用测试集作为训练集了。
</p></div><div><div>2021-11-15</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0F94uoYZQicSOIfEfSr9gH7CTKibNBsS6d9PRDd8cy7bdTCF9jibXYtf0esGqsQAItHnElejIFovxg/132"></div></div><div><div><div><span>cab</span></div></div><div>请问一下为什么 PyTorch 中的 AlexNet 网络结构与论文中的不一样呢？
</div><div><p>作者回复: hi，cab。感谢你的留言。因为改过之后可以接受任意尺度（在可以正常前向传播的情况下）的输入。</p></div><div><div>2021-11-14</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>马克图布</span></div></div><div>代码：

import torch
import torch.nn as nn
import torchvision
import torchvision.transforms as transforms
from PIL import Image


transform = transforms.Compose ([transforms.RandomResizedCrop ((224, 224)),
    transforms.ToTensor (),
    transforms.Normalize (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
])

cifar10_train_dataset = torchvision.datasets.CIFAR10 (root='./data', train=True, transform=transform, target_transform=None, download=True)
train_loader = torch.utils.data.DataLoader (dataset=cifar10_train_dataset, batch_size=32, shuffle=True, num_workers=2)
classes = ('plane', 'car', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck')
n_total_steps = len (train_loader)


class MyCNN (nn.Module):
    def __init__(self):
        super ().__init__()
        self.conv1 = nn.Conv2d (3, 16, kernel_size=3)
        self.fc = nn.Linear (16 * 222 * 222, 10)

    def forward (self, input):
        x = self.conv1 (input)
        x = x.view (x.shape [0], -1)
        x = self.fc (x)
        return x


device = torch.device ('cuda:0' if torch.cuda.is_available () else 'cpu')
model = MyCNN ().to (device)

criterion = nn.CrossEntropyLoss ()
optimizer = torch.optim.SGD (model.parameters (), lr=1e-4, weight_decay=1e-2, momentum=0.9)

print ('Start training...')
for epoch in range (4):
    for i, (images, labels) in enumerate (train_loader):
        images = images.to (device)
        labels = labels.to (device)
        labels_pred = model (images)
        loss = criterion (labels_pred, labels)

        optimizer.zero_grad ()
        loss.backward ()
        optimizer.step ()

        if (i+1) % 100 == 0:
            print (f'Epoch [{epoch+1}/{4}], Step [{i+1:5d}/{n_total_steps}], Loss = {loss.item ():.4f}')
print ('Training complete!')

print ('Start testing...')
with torch.no_grad ():
    im = Image.open ('dog.jpg')
    input_tensor = my_transform (im).unsqueeze (0).to (device)
    label_pred = model (input_tensor).argmax ()
    print (f'Your label predicted：{classes [label_pred]}')
</div><div><p>作者回复: hi，马克图布。👍🏻👍🏻👍🏻👍🏻👍🏻👍🏻^^，厉害。</p></div><div><div>2021-11-12</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1e"><outline class="toc-level-h1" data-reactid=".1e.0" style="width: 175px;"><active data-reactid=".1e.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1e.0.1"><span data-reactid=".1e.0.1.0"> 14 | 构建网络：一站式实现模型搭建与训练</span></a></outline><outline class="toc-level-h2" data-reactid=".1e.1" style="width: 165px;"><active data-reactid=".1e.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1e.1.1"><span data-reactid=".1e.1.1.0">构建自己的模型</span></a></outline><outline class="toc-level-h3" data-reactid=".1e.2" style="width: 155px;"><active data-reactid=".1e.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1e.2.1"><span data-reactid=".1e.2.1.0">nn.Module 模块</span></a></outline><outline class="toc-level-h3" data-reactid=".1e.3" style="width: 155px;"><active data-reactid=".1e.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1e.3.1"><span data-reactid=".1e.3.1.0">模型的训练</span></a></outline><outline class="toc-level-h3" data-reactid=".1e.4" style="width: 155px;"><active data-reactid=".1e.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1e.4.1"><span data-reactid=".1e.4.1.0">模型保存与加载</span></a></outline><outline class="toc-level-h4" data-reactid=".1e.5" style="width: 145px;"><active data-reactid=".1e.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1e.5.1"><span data-reactid=".1e.5.1.0">方式一：只保存训练好的参数</span></a></outline><outline class="toc-level-h4" data-reactid=".1e.6" style="width: 145px;"><active data-reactid=".1e.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1e.6.1"><span data-reactid=".1e.6.1.0">方式二：保存网络结构与参数</span></a></outline><outline class="toc-level-h2" data-reactid=".1e.7" style="width: 165px;"><active data-reactid=".1e.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1e.7.1"><span data-reactid=".1e.7.1.0">使用 Torchvison 中的模型进行训练</span></a></outline><outline class="toc-level-h3" data-reactid=".1e.8" style="width: 155px;"><active data-reactid=".1e.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1e.8.1"><span data-reactid=".1e.8.1.0">再说微调</span></a></outline><outline class="toc-level-h2" data-reactid=".1e.9" style="width: 165px;"><active data-reactid=".1e.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1e.9.1"><span data-reactid=".1e.9.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".1e.a" style="width: 165px;"><active data-reactid=".1e.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".1e.a.1"><span data-reactid=".1e.a.1.0">每课一练</span></a></outline><outline class="toc-level-h2" data-reactid=".1e.b" style="width: 165px;"><active data-reactid=".1e.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".1e.b.1"><span data-reactid=".1e.b.1.0">精选留言 (24)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/442442" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>