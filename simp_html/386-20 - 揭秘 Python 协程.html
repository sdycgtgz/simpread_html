
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 20 | 揭秘 Python 协程</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>20 | 揭秘 Python 协程</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">今天这节课，我主要带你回顾一下字符串的常用操作，并对其中的一些小 tricks 详细地加以解释。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">20 | 揭秘 Python 协程</h1><div><span>景霄</span> <span> 2019-06-24</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/e0/cd/e04a4e460bd42f7732d1c56b1fc165cd.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：冯永吉</span><span>大小：8.63M</span><span> 时长：10:47</span></div></div><audio title="20 | 揭秘 Python 协程" src="https://res001.geekbang.org//media/audio/9a/94/9ad1eede616d4b7ee4c4e04dbb0b7b94/ld/ld.m3u8" __idm_id__="32784"></audio></div><div><div><div><div data-slate-editor="true" data-key="12182" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="12183"><span data-slate-object="text" data-key="12184"><span data-slate-leaf="true" data-offset-key="12184:0" data-first-offset="true"><span data-slate-string="true">你好，我是景霄。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12185"><span data-slate-object="text" data-key="12186"><span data-slate-leaf="true" data-offset-key="12186:0" data-first-offset="true"><span data-slate-string="true">上一节课的最后，我们留下一个小小的悬念：生成器在 Python 2 中还扮演了一个重要角色，就是用来实现 Python 协程。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12187"><span data-slate-object="text" data-key="12188"><span data-slate-leaf="true" data-offset-key="12188:0" data-first-offset="true"><span data-slate-string="true">那么首先你要明白，什么是协程？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12189"><span data-slate-object="text" data-key="12190"><span data-slate-leaf="true" data-offset-key="12190:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1bbd10c2" data-attr-id="4522" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">协程是实现并发编程的一种方式。</span></span></span><span data-slate-leaf="true" data-offset-key="12190:1"><span data-slate-string="true">一说并发，你肯定想到了多线程 / 多进程模型，没错，多线程 / 多进程，正是解决并发问题的经典模型之一。最初的互联网世界，多线程 / 多进程在服务器并发中，起到举足轻重的作用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12191"><span data-slate-object="text" data-key="12192"><span data-slate-leaf="true" data-offset-key="12192:0" data-first-offset="true"><span data-slate-string="true">随着互联网的快速发展，你逐渐遇到了 C10K 瓶颈，也就是同时连接到服务器的客户达到了一万个。于是很多代码跑崩了，进程上下文切换占用了大量的资源，线程也顶不住如此巨大的压力，这时，  NGINX 带着事件循环出来拯救世界了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12193"><span data-slate-object="text" data-key="12194"><span data-slate-leaf="true" data-offset-key="12194:0" data-first-offset="true"><span data-slate-string="true">如果将多进程 / 多线程类比为起源于唐朝的藩镇割据，那么事件循环，就是宋朝加强的中央集权制。事件循环启动一个统一的调度器，让调度器来决定一个时刻去运行哪个任务，于是省却了多线程中启动线程、管理线程、同步锁等各种开销。同一时期的 NGINX，在高并发下能保持低资源低消耗高性能，相比 Apache 也支持更多的并发连接。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12195"><span data-slate-object="text" data-key="12196"><span data-slate-leaf="true" data-offset-key="12196:0" data-first-offset="true"><span data-slate-string="true">再到后来，出现了一个很有名的名词，叫做回调地狱（callback hell），手撸过 JavaScript 的朋友肯定知道我在说什么。我们大家惊喜地发现，这种工具完美地继承了事件循环的优越性，同时还能提供 async /await 语法糖，解决了执行性和可读性共存的难题。于是，协程逐渐被更多人发现并看好，也有越来越多的人尝试用 Node.js 做起了后端开发。（讲个笑话，JavaScript 是一门编程语言。）</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12197"><span data-slate-object="text" data-key="12198"><span data-slate-leaf="true" data-offset-key="12198:0" data-first-offset="true"><span data-slate-string="true">回到我们的 Python。使用生成器，是 Python 2 开头的时代实现协程的老方法了，Python 3.7 提供了新的基于 asyncio 和 async /await 的方法。我们这节课，同样的，跟随时代，抛弃掉不容易理解、也不容易写的旧的基于生成器的方法，直接来讲新方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12199"><span data-slate-object="text" data-key="12200"><span data-slate-leaf="true" data-offset-key="12200:0" data-first-offset="true"><span data-slate-string="true">我们先从一个爬虫实例出发，用清晰的讲解思路，带你结合实战来搞懂这个不算特别容易理解的概念。之后，我们再由浅入深，直击协程的核心。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12201" id="sr-toc-1"><span data-slate-object="text" data-key="12202"><span data-slate-leaf="true" data-offset-key="12202:0" data-first-offset="true"><span data-slate-string="true">从一个爬虫说起</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12203"><span data-slate-object="text" data-key="12204"><span data-slate-leaf="true" data-offset-key="12204:0" data-first-offset="true"><span data-slate-string="true">爬虫，就是互联网的蜘蛛，在搜索引擎诞生之时，与其一同来到世上。爬虫每秒钟都会爬取大量的网页，提取关键信息后存储在数据库中，以便日后分析。爬虫有非常简单的 Python 十行代码实现，也有 Google 那样的全球分布式爬虫的上百万行代码，分布在内部上万台服务器上，对全世界的信息进行嗅探。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12205"><span data-slate-object="text" data-key="12206"><span data-slate-leaf="true" data-offset-key="12206:0" data-first-offset="true"><span data-slate-string="true">话不多说，我们先看一个简单的爬虫例子：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12207"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12208"><span data-slate-object="text" data-key="12209"><span data-slate-leaf="true" data-offset-key="12209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12210"><span data-slate-leaf="true" data-offset-key="12210:0" data-first-offset="true"><span data-slate-string="true"> time</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12211"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12212"><span data-slate-object="text" data-key="12213"><span data-slate-leaf="true" data-offset-key="12213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12214"><span data-slate-leaf="true" data-offset-key="12214:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12215"><span data-slate-leaf="true" data-offset-key="12215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">crawl_page</span></span></span></span><span data-slate-object="text" data-key="12216"><span data-slate-leaf="true" data-offset-key="12216:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12217"><span data-slate-leaf="true" data-offset-key="12217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">url</span></span></span></span><span data-slate-object="text" data-key="12218"><span data-slate-leaf="true" data-offset-key="12218:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12219"><span data-slate-object="text" data-key="12220"><span data-slate-leaf="true" data-offset-key="12220:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12221"><span data-slate-leaf="true" data-offset-key="12221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12222"><span data-slate-leaf="true" data-offset-key="12222:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12223"><span data-slate-leaf="true" data-offset-key="12223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'crawling {}'</span></span></span></span><span data-slate-object="text" data-key="12224"><span data-slate-leaf="true" data-offset-key="12224:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12225"><span data-slate-leaf="true" data-offset-key="12225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12226"><span data-slate-leaf="true" data-offset-key="12226:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12227"><span data-slate-object="text" data-key="12228"><span data-slate-leaf="true" data-offset-key="12228:0" data-first-offset="true"><span data-slate-string="true">    sleep_time = </span></span></span><span data-slate-object="text" data-key="12229"><span data-slate-leaf="true" data-offset-key="12229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="12230"><span data-slate-leaf="true" data-offset-key="12230:0" data-first-offset="true"><span data-slate-string="true">(url.split(</span></span></span><span data-slate-object="text" data-key="12231"><span data-slate-leaf="true" data-offset-key="12231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'_'</span></span></span></span><span data-slate-object="text" data-key="12232"><span data-slate-leaf="true" data-offset-key="12232:0" data-first-offset="true"><span data-slate-string="true">)[-</span></span></span><span data-slate-object="text" data-key="12233"><span data-slate-leaf="true" data-offset-key="12233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12234"><span data-slate-leaf="true" data-offset-key="12234:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12235"><span data-slate-object="text" data-key="12236"><span data-slate-leaf="true" data-offset-key="12236:0" data-first-offset="true"><span data-slate-string="true">    time.sleep(sleep_time)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12237"><span data-slate-object="text" data-key="12238"><span data-slate-leaf="true" data-offset-key="12238:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12239"><span data-slate-leaf="true" data-offset-key="12239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12240"><span data-slate-leaf="true" data-offset-key="12240:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12241"><span data-slate-leaf="true" data-offset-key="12241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'OK {}'</span></span></span></span><span data-slate-object="text" data-key="12242"><span data-slate-leaf="true" data-offset-key="12242:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12243"><span data-slate-leaf="true" data-offset-key="12243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12244"><span data-slate-leaf="true" data-offset-key="12244:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12245"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12246"><span data-slate-object="text" data-key="12247"><span data-slate-leaf="true" data-offset-key="12247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12248"><span data-slate-leaf="true" data-offset-key="12248:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12249"><span data-slate-leaf="true" data-offset-key="12249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12250"><span data-slate-leaf="true" data-offset-key="12250:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12251"><span data-slate-leaf="true" data-offset-key="12251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">urls</span></span></span></span><span data-slate-object="text" data-key="12252"><span data-slate-leaf="true" data-offset-key="12252:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12253"><span data-slate-object="text" data-key="12254"><span data-slate-leaf="true" data-offset-key="12254:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12255"><span data-slate-leaf="true" data-offset-key="12255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="12256"><span data-slate-leaf="true" data-offset-key="12256:0" data-first-offset="true"><span data-slate-string="true"> url </span></span></span><span data-slate-object="text" data-key="12257"><span data-slate-leaf="true" data-offset-key="12257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="12258"><span data-slate-leaf="true" data-offset-key="12258:0" data-first-offset="true"><span data-slate-string="true"> urls:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12259"><span data-slate-object="text" data-key="12260"><span data-slate-leaf="true" data-offset-key="12260:0" data-first-offset="true"><span data-slate-string="true">        crawl_page(url)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12261"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12262"><span data-slate-object="text" data-key="12263"><span data-slate-leaf="true" data-offset-key="12263:0" data-first-offset="true"><span data-slate-string="true">%time main([</span></span></span><span data-slate-object="text" data-key="12264"><span data-slate-leaf="true" data-offset-key="12264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_1'</span></span></span></span><span data-slate-object="text" data-key="12265"><span data-slate-leaf="true" data-offset-key="12265:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12266"><span data-slate-leaf="true" data-offset-key="12266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_2'</span></span></span></span><span data-slate-object="text" data-key="12267"><span data-slate-leaf="true" data-offset-key="12267:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12268"><span data-slate-leaf="true" data-offset-key="12268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_3'</span></span></span></span><span data-slate-object="text" data-key="12269"><span data-slate-leaf="true" data-offset-key="12269:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12270"><span data-slate-leaf="true" data-offset-key="12270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_4'</span></span></span></span><span data-slate-object="text" data-key="12271"><span data-slate-leaf="true" data-offset-key="12271:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12272"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12273"><span data-slate-object="text" data-key="12274"><span data-slate-leaf="true" data-offset-key="12274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12275"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12276"><span data-slate-object="text" data-key="12277"><span data-slate-leaf="true" data-offset-key="12277:0" data-first-offset="true"><span data-slate-string="true">crawling url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12278"><span data-slate-object="text" data-key="12279"><span data-slate-leaf="true" data-offset-key="12279:0" data-first-offset="true"><span data-slate-string="true">OK url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12280"><span data-slate-object="text" data-key="12281"><span data-slate-leaf="true" data-offset-key="12281:0" data-first-offset="true"><span data-slate-string="true">crawling url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12282"><span data-slate-object="text" data-key="12283"><span data-slate-leaf="true" data-offset-key="12283:0" data-first-offset="true"><span data-slate-string="true">OK url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12284"><span data-slate-object="text" data-key="12285"><span data-slate-leaf="true" data-offset-key="12285:0" data-first-offset="true"><span data-slate-string="true">crawling url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12286"><span data-slate-object="text" data-key="12287"><span data-slate-leaf="true" data-offset-key="12287:0" data-first-offset="true"><span data-slate-string="true">OK url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12288"><span data-slate-object="text" data-key="12289"><span data-slate-leaf="true" data-offset-key="12289:0" data-first-offset="true"><span data-slate-string="true">crawling url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12290"><span data-slate-object="text" data-key="12291"><span data-slate-leaf="true" data-offset-key="12291:0" data-first-offset="true"><span data-slate-string="true">OK url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12292"><span data-slate-object="text" data-key="12293"><span data-slate-leaf="true" data-offset-key="12293:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12294"><span data-slate-leaf="true" data-offset-key="12294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="12295"><span data-slate-leaf="true" data-offset-key="12295:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12296"><span data-slate-object="text" data-key="12297"><span data-slate-leaf="true" data-offset-key="12297:0" data-first-offset="true"><span data-slate-string="true">（注意：本节的主要目的是协程的基础概念，因此我们简化爬虫的 scrawl_page 函数为休眠数秒，休眠时间取决于 url 最后的那个数字。）</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12298"><span data-slate-object="text" data-key="12299"><span data-slate-leaf="true" data-offset-key="12299:0" data-first-offset="true"><span data-slate-string="true">这是一个很简单的爬虫，main () 函数执行时，调取 crawl_page () 函数进行网络通信，经过若干秒等待后收到结果，然后执行下一个。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12300"><span data-slate-object="text" data-key="12301"><span data-slate-leaf="true" data-offset-key="12301:0" data-first-offset="true"><span data-slate-string="true">看起来很简单，但你仔细一算，它也占用了不少时间，五个页面分别用了 1 秒到 4 秒的时间，加起来一共用了 10 秒。这显然效率低下，该怎么优化呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12302"><span data-slate-object="text" data-key="12303"><span data-slate-leaf="true" data-offset-key="12303:0" data-first-offset="true"><span data-slate-string="true">于是，一个很简单的思路出现了 —— 我们这种爬取操作，完全可以并发化。我们就来看看使用协程怎么写。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12304"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12305"><span data-slate-object="text" data-key="12306"><span data-slate-leaf="true" data-offset-key="12306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12307"><span data-slate-leaf="true" data-offset-key="12307:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12308"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12309"><span data-slate-object="text" data-key="12310"><span data-slate-leaf="true" data-offset-key="12310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12311"><span data-slate-leaf="true" data-offset-key="12311:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12312"><span data-slate-leaf="true" data-offset-key="12312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12313"><span data-slate-leaf="true" data-offset-key="12313:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12314"><span data-slate-leaf="true" data-offset-key="12314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">crawl_page</span></span></span></span><span data-slate-object="text" data-key="12315"><span data-slate-leaf="true" data-offset-key="12315:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12316"><span data-slate-leaf="true" data-offset-key="12316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">url</span></span></span></span><span data-slate-object="text" data-key="12317"><span data-slate-leaf="true" data-offset-key="12317:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12318"><span data-slate-object="text" data-key="12319"><span data-slate-leaf="true" data-offset-key="12319:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12320"><span data-slate-leaf="true" data-offset-key="12320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12321"><span data-slate-leaf="true" data-offset-key="12321:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12322"><span data-slate-leaf="true" data-offset-key="12322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'crawling {}'</span></span></span></span><span data-slate-object="text" data-key="12323"><span data-slate-leaf="true" data-offset-key="12323:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12324"><span data-slate-leaf="true" data-offset-key="12324:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12325"><span data-slate-leaf="true" data-offset-key="12325:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12326"><span data-slate-object="text" data-key="12327"><span data-slate-leaf="true" data-offset-key="12327:0" data-first-offset="true"><span data-slate-string="true">    sleep_time = </span></span></span><span data-slate-object="text" data-key="12328"><span data-slate-leaf="true" data-offset-key="12328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="12329"><span data-slate-leaf="true" data-offset-key="12329:0" data-first-offset="true"><span data-slate-string="true">(url.split(</span></span></span><span data-slate-object="text" data-key="12330"><span data-slate-leaf="true" data-offset-key="12330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'_'</span></span></span></span><span data-slate-object="text" data-key="12331"><span data-slate-leaf="true" data-offset-key="12331:0" data-first-offset="true"><span data-slate-string="true">)[-</span></span></span><span data-slate-object="text" data-key="12332"><span data-slate-leaf="true" data-offset-key="12332:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12333"><span data-slate-leaf="true" data-offset-key="12333:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12334"><span data-slate-object="text" data-key="12335"><span data-slate-leaf="true" data-offset-key="12335:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_fe6cc02e" data-attr-id="10922" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    </span></span></span></span><span data-slate-object="text" data-key="12336"><span data-slate-leaf="true" data-offset-key="12336:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_fe6cc02e" data-attr-id="10922" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span></span><span data-slate-object="text" data-key="12337"><span data-slate-leaf="true" data-offset-key="12337:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_fe6cc02e" data-attr-id="10922" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> asyncio.sleep(sleep_time)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12338"><span data-slate-object="text" data-key="12339"><span data-slate-leaf="true" data-offset-key="12339:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12340"><span data-slate-leaf="true" data-offset-key="12340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12341"><span data-slate-leaf="true" data-offset-key="12341:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12342"><span data-slate-leaf="true" data-offset-key="12342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'OK {}'</span></span></span></span><span data-slate-object="text" data-key="12343"><span data-slate-leaf="true" data-offset-key="12343:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12344"><span data-slate-leaf="true" data-offset-key="12344:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12345"><span data-slate-leaf="true" data-offset-key="12345:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12346"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12347"><span data-slate-object="text" data-key="12348"><span data-slate-leaf="true" data-offset-key="12348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12349"><span data-slate-leaf="true" data-offset-key="12349:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12350"><span data-slate-leaf="true" data-offset-key="12350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12351"><span data-slate-leaf="true" data-offset-key="12351:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12352"><span data-slate-leaf="true" data-offset-key="12352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12353"><span data-slate-leaf="true" data-offset-key="12353:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12354"><span data-slate-leaf="true" data-offset-key="12354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">urls</span></span></span></span><span data-slate-object="text" data-key="12355"><span data-slate-leaf="true" data-offset-key="12355:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12356"><span data-slate-object="text" data-key="12357"><span data-slate-leaf="true" data-offset-key="12357:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12358"><span data-slate-leaf="true" data-offset-key="12358:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="12359"><span data-slate-leaf="true" data-offset-key="12359:0" data-first-offset="true"><span data-slate-string="true"> url </span></span></span><span data-slate-object="text" data-key="12360"><span data-slate-leaf="true" data-offset-key="12360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="12361"><span data-slate-leaf="true" data-offset-key="12361:0" data-first-offset="true"><span data-slate-string="true"> urls:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12362"><span data-slate-object="text" data-key="12363"><span data-slate-leaf="true" data-offset-key="12363:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="12364"><span data-slate-leaf="true" data-offset-key="12364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12365"><span data-slate-leaf="true" data-offset-key="12365:0" data-first-offset="true"><span data-slate-string="true"> crawl_page(url)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12366"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12367"><span data-slate-object="text" data-key="12368"><span data-slate-leaf="true" data-offset-key="12368:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main([</span></span></span><span data-slate-object="text" data-key="12369"><span data-slate-leaf="true" data-offset-key="12369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_1'</span></span></span></span><span data-slate-object="text" data-key="12370"><span data-slate-leaf="true" data-offset-key="12370:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12371"><span data-slate-leaf="true" data-offset-key="12371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_2'</span></span></span></span><span data-slate-object="text" data-key="12372"><span data-slate-leaf="true" data-offset-key="12372:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12373"><span data-slate-leaf="true" data-offset-key="12373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_3'</span></span></span></span><span data-slate-object="text" data-key="12374"><span data-slate-leaf="true" data-offset-key="12374:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12375"><span data-slate-leaf="true" data-offset-key="12375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_4'</span></span></span></span><span data-slate-object="text" data-key="12376"><span data-slate-leaf="true" data-offset-key="12376:0" data-first-offset="true"><span data-slate-string="true">]))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12377"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12378"><span data-slate-object="text" data-key="12379"><span data-slate-leaf="true" data-offset-key="12379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12380"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12381"><span data-slate-object="text" data-key="12382"><span data-slate-leaf="true" data-offset-key="12382:0" data-first-offset="true"><span data-slate-string="true">crawling url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12383"><span data-slate-object="text" data-key="12384"><span data-slate-leaf="true" data-offset-key="12384:0" data-first-offset="true"><span data-slate-string="true">OK url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12385"><span data-slate-object="text" data-key="12386"><span data-slate-leaf="true" data-offset-key="12386:0" data-first-offset="true"><span data-slate-string="true">crawling url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12387"><span data-slate-object="text" data-key="12388"><span data-slate-leaf="true" data-offset-key="12388:0" data-first-offset="true"><span data-slate-string="true">OK url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12389"><span data-slate-object="text" data-key="12390"><span data-slate-leaf="true" data-offset-key="12390:0" data-first-offset="true"><span data-slate-string="true">crawling url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12391"><span data-slate-object="text" data-key="12392"><span data-slate-leaf="true" data-offset-key="12392:0" data-first-offset="true"><span data-slate-string="true">OK url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12393"><span data-slate-object="text" data-key="12394"><span data-slate-leaf="true" data-offset-key="12394:0" data-first-offset="true"><span data-slate-string="true">crawling url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12395"><span data-slate-object="text" data-key="12396"><span data-slate-leaf="true" data-offset-key="12396:0" data-first-offset="true"><span data-slate-string="true">OK url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12397"><span data-slate-object="text" data-key="12398"><span data-slate-leaf="true" data-offset-key="12398:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12399"><span data-slate-leaf="true" data-offset-key="12399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="12400"><span data-slate-leaf="true" data-offset-key="12400:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12401"><span data-slate-object="text" data-key="12402"><span data-slate-leaf="true" data-offset-key="12402:0" data-first-offset="true"><span data-slate-string="true">看到这段代码，你应该发现了，在 Python 3.7 以上版本中，使用协程写异步程序非常简单。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12403"><span data-slate-object="text" data-key="12404"><span data-slate-leaf="true" data-offset-key="12404:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0b67c1a6" data-attr-id="21483" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">首先来看 import asyncio，</span></span></span><span data-slate-leaf="true" data-offset-key="12404:1"><span data-slate-string="true">这个库包含了大部分我们实现协程所需的魔法工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12405"><span data-slate-object="text" data-key="12406"><span data-slate-leaf="true" data-offset-key="12406:0" data-first-offset="true"><span data-slate-string="true">async 修饰词声明异步函数，于是，这里的 crawl_page 和 main 都变成了异步函数。而调用异步函数，</span></span><span data-slate-leaf="true" data-offset-key="12406:1"><span data-slate-object="annotation" data-annotation-key="gkann_c3cb5ff5" data-attr-id="35704" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们便可得到一个协程对象（coroutine object）。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12407"><span data-slate-object="text" data-key="12408"><span data-slate-leaf="true" data-offset-key="12408:0" data-first-offset="true"><span data-slate-string="true">举个例子，如果你 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12409"><span data-slate-object="text" data-key="12410"><span data-slate-leaf="true" data-offset-key="12410:0" data-first-offset="true"><span data-slate-string="true">print(crawl_page(''))</span></span></span></span><span data-slate-object="text" data-key="12411"><span data-slate-leaf="true" data-offset-key="12411:0" data-first-offset="true"><span data-slate-string="true">，便会输出</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12412"><span data-slate-object="text" data-key="12413"><span data-slate-leaf="true" data-offset-key="12413:0" data-first-offset="true"><span data-slate-string="true"> &lt;coroutine object crawl_page at 0x000002BEDF141148&gt;</span></span></span></span><span data-slate-object="text" data-key="12414"><span data-slate-leaf="true" data-offset-key="12414:0" data-first-offset="true"><span data-slate-string="true">，提示你这是一个 Python 的协程对象，而并不会真正执行这个函数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12415"><span data-slate-object="text" data-key="12416"><span data-slate-leaf="true" data-offset-key="12416:0" data-first-offset="true"><span data-slate-string="true">再来说说协程的执行。执行协程有多种方法，这里我介绍一下常用的三种。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12417"><span data-slate-object="text" data-key="12418"><span data-slate-leaf="true" data-offset-key="12418:0" data-first-offset="true"><span data-slate-string="true">首先，我们可以通过 await 来调用。</span></span><span data-slate-leaf="true" data-offset-key="12418:1"><span data-slate-object="annotation" data-annotation-key="gkann_42afacc2" data-attr-id="35705" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">await 执行的效果，和 Python 正常执行是一样的，也就是说程序会阻塞在这里，进入被调用的协程函数，执行完毕返回后再继续，</span></span></span><span data-slate-leaf="true" data-offset-key="12418:2"><span data-slate-string="true">而这也是 await 的字面意思。代码中 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12419"><span data-slate-object="text" data-key="12420"><span data-slate-leaf="true" data-offset-key="12420:0" data-first-offset="true"><span data-slate-string="true">await asyncio.sleep(sleep_time)</span></span></span></span><span data-slate-object="text" data-key="12421"><span data-slate-leaf="true" data-offset-key="12421:0" data-first-offset="true"><span data-slate-string="true"> 会在这里休息若干秒，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12422"><span data-slate-object="text" data-key="12423"><span data-slate-leaf="true" data-offset-key="12423:0" data-first-offset="true"><span data-slate-string="true">await crawl_page(url)</span></span></span></span><span data-slate-object="text" data-key="12424"><span data-slate-leaf="true" data-offset-key="12424:0" data-first-offset="true"><span data-slate-string="true"> 则会执行 crawl_page () 函数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12425"><span data-slate-object="text" data-key="12426"><span data-slate-leaf="true" data-offset-key="12426:0" data-first-offset="true"><span data-slate-string="true">其次，我们可以通过 asyncio.create_task () 来创建任务，这个我们下节课会详细讲一下，你先简单知道即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12427"><span data-slate-object="text" data-key="12428"><span data-slate-leaf="true" data-offset-key="12428:0" data-first-offset="true"><span data-slate-string="true">最后，</span></span><span data-slate-leaf="true" data-offset-key="12428:1"><span data-slate-object="annotation" data-annotation-key="gkann_88e35627" data-attr-id="21752" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们需要 asyncio.run 来触发运行。</span></span></span><span data-slate-leaf="true" data-offset-key="12428:2"><span data-slate-string="true">asyncio.run 这个函数是 Python 3.7 之后才有的特性，可以让 Python 的协程接口变得非常简单，你不用去理会事件循环怎么定义和怎么使用的问题（我们会在下面讲）。</span></span><span data-slate-leaf="true" data-offset-key="12428:3"><span data-slate-object="annotation" data-annotation-key="gkann_760fda4c" data-attr-id="28226" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">一个非常好的编程规范是，asyncio.run (main ()) 作为主程序的入口函数，在程序运行周期内，只调用一次 asyncio.run。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12429"><span data-slate-object="text" data-key="12430"><span data-slate-leaf="true" data-offset-key="12430:0" data-first-offset="true"><span data-slate-string="true">这样，你就大概看懂了协程是怎么用的吧。不妨试着跑一下代码，欸，怎么还是 10 秒？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12431"><span data-slate-object="text" data-key="12432"><span data-slate-leaf="true" data-offset-key="12432:0" data-first-offset="true"><span data-slate-string="true">10 秒就对了，还记得上面所说的，await 是同步调用，因此，</span></span><span data-slate-leaf="true" data-offset-key="12432:1"><span data-slate-object="annotation" data-annotation-key="gkann_8471029a" data-attr-id="28227" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> crawl_page (url) 在当前的调用结束之前，是不会触发下一次调用的。</span></span></span><span data-slate-leaf="true" data-offset-key="12432:2"><span data-slate-string="true">于是，这个代码效果就和上面完全一样了，相当于我们用异步接口写了个同步代码。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12433"><span data-slate-object="text" data-key="12434"><span data-slate-leaf="true" data-offset-key="12434:0" data-first-offset="true"><span data-slate-string="true">现在又该怎么办呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12435"><span data-slate-object="text" data-key="12436"><span data-slate-leaf="true" data-offset-key="12436:0" data-first-offset="true"><span data-slate-string="true">其实很简单，也正是我接下来要讲的协程中的一个重要概念，任务（Task）。老规矩，先看代码。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12437"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12438"><span data-slate-object="text" data-key="12439"><span data-slate-leaf="true" data-offset-key="12439:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_832c194e" data-attr-id="27115" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span></span><span data-slate-object="text" data-key="12440"><span data-slate-leaf="true" data-offset-key="12440:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_832c194e" data-attr-id="27115" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> asyncio</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12441"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12442"><span data-slate-object="text" data-key="12443"><span data-slate-leaf="true" data-offset-key="12443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12444"><span data-slate-leaf="true" data-offset-key="12444:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12445"><span data-slate-leaf="true" data-offset-key="12445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12446"><span data-slate-leaf="true" data-offset-key="12446:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12447"><span data-slate-leaf="true" data-offset-key="12447:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">crawl_page</span></span></span></span><span data-slate-object="text" data-key="12448"><span data-slate-leaf="true" data-offset-key="12448:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12449"><span data-slate-leaf="true" data-offset-key="12449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">url</span></span></span></span><span data-slate-object="text" data-key="12450"><span data-slate-leaf="true" data-offset-key="12450:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12451"><span data-slate-object="text" data-key="12452"><span data-slate-leaf="true" data-offset-key="12452:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12453"><span data-slate-leaf="true" data-offset-key="12453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12454"><span data-slate-leaf="true" data-offset-key="12454:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12455"><span data-slate-leaf="true" data-offset-key="12455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'crawling {}'</span></span></span></span><span data-slate-object="text" data-key="12456"><span data-slate-leaf="true" data-offset-key="12456:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12457"><span data-slate-leaf="true" data-offset-key="12457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12458"><span data-slate-leaf="true" data-offset-key="12458:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12459"><span data-slate-object="text" data-key="12460"><span data-slate-leaf="true" data-offset-key="12460:0" data-first-offset="true"><span data-slate-string="true">    sleep_time = </span></span></span><span data-slate-object="text" data-key="12461"><span data-slate-leaf="true" data-offset-key="12461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="12462"><span data-slate-leaf="true" data-offset-key="12462:0" data-first-offset="true"><span data-slate-string="true">(url.split(</span></span></span><span data-slate-object="text" data-key="12463"><span data-slate-leaf="true" data-offset-key="12463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'_'</span></span></span></span><span data-slate-object="text" data-key="12464"><span data-slate-leaf="true" data-offset-key="12464:0" data-first-offset="true"><span data-slate-string="true">)[-</span></span></span><span data-slate-object="text" data-key="12465"><span data-slate-leaf="true" data-offset-key="12465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12466"><span data-slate-leaf="true" data-offset-key="12466:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12467"><span data-slate-object="text" data-key="12468"><span data-slate-leaf="true" data-offset-key="12468:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12469"><span data-slate-leaf="true" data-offset-key="12469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12470"><span data-slate-leaf="true" data-offset-key="12470:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(sleep_time)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12471"><span data-slate-object="text" data-key="12472"><span data-slate-leaf="true" data-offset-key="12472:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12473"><span data-slate-leaf="true" data-offset-key="12473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12474"><span data-slate-leaf="true" data-offset-key="12474:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12475"><span data-slate-leaf="true" data-offset-key="12475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'OK {}'</span></span></span></span><span data-slate-object="text" data-key="12476"><span data-slate-leaf="true" data-offset-key="12476:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12477"><span data-slate-leaf="true" data-offset-key="12477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12478"><span data-slate-leaf="true" data-offset-key="12478:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12479"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12480"><span data-slate-object="text" data-key="12481"><span data-slate-leaf="true" data-offset-key="12481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12482"><span data-slate-leaf="true" data-offset-key="12482:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12483"><span data-slate-leaf="true" data-offset-key="12483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12484"><span data-slate-leaf="true" data-offset-key="12484:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12485"><span data-slate-leaf="true" data-offset-key="12485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12486"><span data-slate-leaf="true" data-offset-key="12486:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12487"><span data-slate-leaf="true" data-offset-key="12487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">urls</span></span></span></span><span data-slate-object="text" data-key="12488"><span data-slate-leaf="true" data-offset-key="12488:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12489"><span data-slate-object="text" data-key="12490"><span data-slate-leaf="true" data-offset-key="12490:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_214dd3b3" data-attr-id="10923" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    tasks = [asyncio.create_task(crawl_page(url)) </span></span></span></span><span data-slate-object="text" data-key="12491"><span data-slate-leaf="true" data-offset-key="12491:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_214dd3b3" data-attr-id="10923" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span></span><span data-slate-object="text" data-key="12492"><span data-slate-leaf="true" data-offset-key="12492:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_214dd3b3" data-attr-id="10923" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> url </span></span></span></span><span data-slate-object="text" data-key="12493"><span data-slate-leaf="true" data-offset-key="12493:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_214dd3b3" data-attr-id="10923" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span></span><span data-slate-object="text" data-key="12494"><span data-slate-leaf="true" data-offset-key="12494:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_214dd3b3" data-attr-id="10923" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> urls]</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12495"><span data-slate-object="text" data-key="12496"><span data-slate-leaf="true" data-offset-key="12496:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0194c71f" data-attr-id="10924" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    </span></span></span></span><span data-slate-object="text" data-key="12497"><span data-slate-leaf="true" data-offset-key="12497:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0194c71f" data-attr-id="10924" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span></span><span data-slate-object="text" data-key="12498"><span data-slate-leaf="true" data-offset-key="12498:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0194c71f" data-attr-id="10924" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> task </span></span></span></span><span data-slate-object="text" data-key="12499"><span data-slate-leaf="true" data-offset-key="12499:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0194c71f" data-attr-id="10924" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span></span><span data-slate-object="text" data-key="12500"><span data-slate-leaf="true" data-offset-key="12500:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0194c71f" data-attr-id="10924" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> tasks:</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12501"><span data-slate-object="text" data-key="12502"><span data-slate-leaf="true" data-offset-key="12502:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_bf0654d6" data-attr-id="10925" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">        </span></span></span></span><span data-slate-object="text" data-key="12503"><span data-slate-leaf="true" data-offset-key="12503:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_bf0654d6" data-attr-id="10925" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span></span><span data-slate-object="text" data-key="12504"><span data-slate-leaf="true" data-offset-key="12504:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_bf0654d6" data-attr-id="10925" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> task</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12505"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12506"><span data-slate-object="text" data-key="12507"><span data-slate-leaf="true" data-offset-key="12507:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">%time asyncio.run(main([</span></span></span></span><span data-slate-object="text" data-key="12508"><span data-slate-leaf="true" data-offset-key="12508:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_1'</span></span></span></span></span><span data-slate-object="text" data-key="12509"><span data-slate-leaf="true" data-offset-key="12509:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">, </span></span></span></span><span data-slate-object="text" data-key="12510"><span data-slate-leaf="true" data-offset-key="12510:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_2'</span></span></span></span></span><span data-slate-object="text" data-key="12511"><span data-slate-leaf="true" data-offset-key="12511:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">, </span></span></span></span><span data-slate-object="text" data-key="12512"><span data-slate-leaf="true" data-offset-key="12512:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_3'</span></span></span></span></span><span data-slate-object="text" data-key="12513"><span data-slate-leaf="true" data-offset-key="12513:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">, </span></span></span></span><span data-slate-object="text" data-key="12514"><span data-slate-leaf="true" data-offset-key="12514:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_4'</span></span></span></span></span><span data-slate-object="text" data-key="12515"><span data-slate-leaf="true" data-offset-key="12515:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_1b9831ff" data-attr-id="10926" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">]))</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12516"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12517"><span data-slate-object="text" data-key="12518"><span data-slate-leaf="true" data-offset-key="12518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12519"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12520"><span data-slate-object="text" data-key="12521"><span data-slate-leaf="true" data-offset-key="12521:0" data-first-offset="true"><span data-slate-string="true">crawling url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12522"><span data-slate-object="text" data-key="12523"><span data-slate-leaf="true" data-offset-key="12523:0" data-first-offset="true"><span data-slate-string="true">crawling url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12524"><span data-slate-object="text" data-key="12525"><span data-slate-leaf="true" data-offset-key="12525:0" data-first-offset="true"><span data-slate-string="true">crawling url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12526"><span data-slate-object="text" data-key="12527"><span data-slate-leaf="true" data-offset-key="12527:0" data-first-offset="true"><span data-slate-string="true">crawling url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12528"><span data-slate-object="text" data-key="12529"><span data-slate-leaf="true" data-offset-key="12529:0" data-first-offset="true"><span data-slate-string="true">OK url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12530"><span data-slate-object="text" data-key="12531"><span data-slate-leaf="true" data-offset-key="12531:0" data-first-offset="true"><span data-slate-string="true">OK url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12532"><span data-slate-object="text" data-key="12533"><span data-slate-leaf="true" data-offset-key="12533:0" data-first-offset="true"><span data-slate-string="true">OK url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12534"><span data-slate-object="text" data-key="12535"><span data-slate-leaf="true" data-offset-key="12535:0" data-first-offset="true"><span data-slate-string="true">OK url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12536"><span data-slate-object="text" data-key="12537"><span data-slate-leaf="true" data-offset-key="12537:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12538"><span data-slate-leaf="true" data-offset-key="12538:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3.99</span></span></span></span><span data-slate-object="text" data-key="12539"><span data-slate-leaf="true" data-offset-key="12539:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12540"><span data-slate-object="text" data-key="12541"><span data-slate-leaf="true" data-offset-key="12541:0" data-first-offset="true"><span data-slate-string="true">你可以看到，我们有了协程对象后，</span></span><span data-slate-leaf="true" data-offset-key="12541:1"><span data-slate-object="annotation" data-annotation-key="gkann_26384edf" data-attr-id="24250" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">便可以通过 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12542"><span data-slate-object="text" data-key="12543"><span data-slate-leaf="true" data-offset-key="12543:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_26384edf" data-attr-id="24250" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">asyncio.create_task</span></span></span></span></span><span data-slate-object="text" data-key="12544"><span data-slate-leaf="true" data-offset-key="12544:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_26384edf" data-attr-id="24250" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 来创建任务。任务创建后很快就会被调度执行，这样，我们的代码也不会阻塞在任务这里。所以，我们要等所有任务都结束才行，用</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12545"><span data-slate-object="text" data-key="12546"><span data-slate-leaf="true" data-offset-key="12546:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_26384edf" data-attr-id="24250" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> for task in tasks: await task</span></span></span></span></span><span data-slate-object="text" data-key="12547"><span data-slate-leaf="true" data-offset-key="12547:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_26384edf" data-attr-id="24250" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 即可。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12548"><span data-slate-object="text" data-key="12549"><span data-slate-leaf="true" data-offset-key="12549:0" data-first-offset="true"><span data-slate-string="true">这次，你就看到效果了吧，结果显示，运行总时长等于运行时间最长的爬虫。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12550"><span data-slate-object="text" data-key="12551"><span data-slate-leaf="true" data-offset-key="12551:0" data-first-offset="true"><span data-slate-string="true">当然，你也可以想一想，这里用多线程应该怎么写？而如果需要爬取的页面有上万个又该怎么办呢？再对比下协程的写法，谁更清晰自是一目了然。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12552"><span data-slate-object="text" data-key="12553"><span data-slate-leaf="true" data-offset-key="12553:0" data-first-offset="true"><span data-slate-string="true">其实，对于执行 tasks，还有另一种做法：</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12554"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12555"><span data-slate-object="text" data-key="12556"><span data-slate-leaf="true" data-offset-key="12556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12557"><span data-slate-leaf="true" data-offset-key="12557:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12558"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12559"><span data-slate-object="text" data-key="12560"><span data-slate-leaf="true" data-offset-key="12560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12561"><span data-slate-leaf="true" data-offset-key="12561:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12562"><span data-slate-leaf="true" data-offset-key="12562:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12563"><span data-slate-leaf="true" data-offset-key="12563:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12564"><span data-slate-leaf="true" data-offset-key="12564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">crawl_page</span></span></span></span><span data-slate-object="text" data-key="12565"><span data-slate-leaf="true" data-offset-key="12565:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12566"><span data-slate-leaf="true" data-offset-key="12566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">url</span></span></span></span><span data-slate-object="text" data-key="12567"><span data-slate-leaf="true" data-offset-key="12567:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12568"><span data-slate-object="text" data-key="12569"><span data-slate-leaf="true" data-offset-key="12569:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12570"><span data-slate-leaf="true" data-offset-key="12570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12571"><span data-slate-leaf="true" data-offset-key="12571:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12572"><span data-slate-leaf="true" data-offset-key="12572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'crawling {}'</span></span></span></span><span data-slate-object="text" data-key="12573"><span data-slate-leaf="true" data-offset-key="12573:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12574"><span data-slate-leaf="true" data-offset-key="12574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12575"><span data-slate-leaf="true" data-offset-key="12575:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12576"><span data-slate-object="text" data-key="12577"><span data-slate-leaf="true" data-offset-key="12577:0" data-first-offset="true"><span data-slate-string="true">    sleep_time = </span></span></span><span data-slate-object="text" data-key="12578"><span data-slate-leaf="true" data-offset-key="12578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="12579"><span data-slate-leaf="true" data-offset-key="12579:0" data-first-offset="true"><span data-slate-string="true">(url.split(</span></span></span><span data-slate-object="text" data-key="12580"><span data-slate-leaf="true" data-offset-key="12580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'_'</span></span></span></span><span data-slate-object="text" data-key="12581"><span data-slate-leaf="true" data-offset-key="12581:0" data-first-offset="true"><span data-slate-string="true">)[-</span></span></span><span data-slate-object="text" data-key="12582"><span data-slate-leaf="true" data-offset-key="12582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12583"><span data-slate-leaf="true" data-offset-key="12583:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12584"><span data-slate-object="text" data-key="12585"><span data-slate-leaf="true" data-offset-key="12585:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12586"><span data-slate-leaf="true" data-offset-key="12586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12587"><span data-slate-leaf="true" data-offset-key="12587:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(sleep_time)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12588"><span data-slate-object="text" data-key="12589"><span data-slate-leaf="true" data-offset-key="12589:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12590"><span data-slate-leaf="true" data-offset-key="12590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12591"><span data-slate-leaf="true" data-offset-key="12591:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12592"><span data-slate-leaf="true" data-offset-key="12592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'OK {}'</span></span></span></span><span data-slate-object="text" data-key="12593"><span data-slate-leaf="true" data-offset-key="12593:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="12594"><span data-slate-leaf="true" data-offset-key="12594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="12595"><span data-slate-leaf="true" data-offset-key="12595:0" data-first-offset="true"><span data-slate-string="true">(url))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12596"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12597"><span data-slate-object="text" data-key="12598"><span data-slate-leaf="true" data-offset-key="12598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12599"><span data-slate-leaf="true" data-offset-key="12599:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12600"><span data-slate-leaf="true" data-offset-key="12600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12601"><span data-slate-leaf="true" data-offset-key="12601:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12602"><span data-slate-leaf="true" data-offset-key="12602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12603"><span data-slate-leaf="true" data-offset-key="12603:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12604"><span data-slate-leaf="true" data-offset-key="12604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">urls</span></span></span></span><span data-slate-object="text" data-key="12605"><span data-slate-leaf="true" data-offset-key="12605:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12606"><span data-slate-object="text" data-key="12607"><span data-slate-leaf="true" data-offset-key="12607:0" data-first-offset="true"><span data-slate-string="true">    tasks = [asyncio.create_task(crawl_page(url)) </span></span></span><span data-slate-object="text" data-key="12608"><span data-slate-leaf="true" data-offset-key="12608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="12609"><span data-slate-leaf="true" data-offset-key="12609:0" data-first-offset="true"><span data-slate-string="true"> url </span></span></span><span data-slate-object="text" data-key="12610"><span data-slate-leaf="true" data-offset-key="12610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="12611"><span data-slate-leaf="true" data-offset-key="12611:0" data-first-offset="true"><span data-slate-string="true"> urls]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12612"><span data-slate-object="text" data-key="12613"><span data-slate-leaf="true" data-offset-key="12613:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7666b24b" data-attr-id="22773" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    </span></span></span></span><span data-slate-object="text" data-key="12614"><span data-slate-leaf="true" data-offset-key="12614:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7666b24b" data-attr-id="22773" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span></span><span data-slate-object="text" data-key="12615"><span data-slate-leaf="true" data-offset-key="12615:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7666b24b" data-attr-id="22773" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> asyncio.gather(*tasks)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12616"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12617"><span data-slate-object="text" data-key="12618"><span data-slate-leaf="true" data-offset-key="12618:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main([</span></span></span><span data-slate-object="text" data-key="12619"><span data-slate-leaf="true" data-offset-key="12619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_1'</span></span></span></span><span data-slate-object="text" data-key="12620"><span data-slate-leaf="true" data-offset-key="12620:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12621"><span data-slate-leaf="true" data-offset-key="12621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_2'</span></span></span></span><span data-slate-object="text" data-key="12622"><span data-slate-leaf="true" data-offset-key="12622:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12623"><span data-slate-leaf="true" data-offset-key="12623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_3'</span></span></span></span><span data-slate-object="text" data-key="12624"><span data-slate-leaf="true" data-offset-key="12624:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="12625"><span data-slate-leaf="true" data-offset-key="12625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'url_4'</span></span></span></span><span data-slate-object="text" data-key="12626"><span data-slate-leaf="true" data-offset-key="12626:0" data-first-offset="true"><span data-slate-string="true">]))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12627"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12628"><span data-slate-object="text" data-key="12629"><span data-slate-leaf="true" data-offset-key="12629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12630"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12631"><span data-slate-object="text" data-key="12632"><span data-slate-leaf="true" data-offset-key="12632:0" data-first-offset="true"><span data-slate-string="true">crawling url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12633"><span data-slate-object="text" data-key="12634"><span data-slate-leaf="true" data-offset-key="12634:0" data-first-offset="true"><span data-slate-string="true">crawling url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12635"><span data-slate-object="text" data-key="12636"><span data-slate-leaf="true" data-offset-key="12636:0" data-first-offset="true"><span data-slate-string="true">crawling url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12637"><span data-slate-object="text" data-key="12638"><span data-slate-leaf="true" data-offset-key="12638:0" data-first-offset="true"><span data-slate-string="true">crawling url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12639"><span data-slate-object="text" data-key="12640"><span data-slate-leaf="true" data-offset-key="12640:0" data-first-offset="true"><span data-slate-string="true">OK url_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12641"><span data-slate-object="text" data-key="12642"><span data-slate-leaf="true" data-offset-key="12642:0" data-first-offset="true"><span data-slate-string="true">OK url_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12643"><span data-slate-object="text" data-key="12644"><span data-slate-leaf="true" data-offset-key="12644:0" data-first-offset="true"><span data-slate-string="true">OK url_3</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12645"><span data-slate-object="text" data-key="12646"><span data-slate-leaf="true" data-offset-key="12646:0" data-first-offset="true"><span data-slate-string="true">OK url_4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12647"><span data-slate-object="text" data-key="12648"><span data-slate-leaf="true" data-offset-key="12648:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12649"><span data-slate-leaf="true" data-offset-key="12649:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4.01</span></span></span></span><span data-slate-object="text" data-key="12650"><span data-slate-leaf="true" data-offset-key="12650:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12651"><span data-slate-object="text" data-key="12652"><span data-slate-leaf="true" data-offset-key="12652:0" data-first-offset="true"><span data-slate-string="true">这里的代码也很好理解。唯一要注意的是，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12653"><span data-slate-object="text" data-key="12654"><span data-slate-leaf="true" data-offset-key="12654:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_792ee8ec" data-attr-id="29592" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">*tasks</span></span></span></span></span><span data-slate-object="text" data-key="12655"><span data-slate-leaf="true" data-offset-key="12655:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_792ee8ec" data-attr-id="29592" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 解包列表，将列表变成了函数的参数；与之对应的是，  </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12656"><span data-slate-object="text" data-key="12657"><span data-slate-leaf="true" data-offset-key="12657:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_792ee8ec" data-attr-id="29592" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">** dict</span></span></span></span></span><span data-slate-object="text" data-key="12658"><span data-slate-leaf="true" data-offset-key="12658:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_792ee8ec" data-attr-id="29592" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 将字典变成了函数的参数。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12659"><span data-slate-object="text" data-key="12660"><span data-slate-leaf="true" data-offset-key="12660:0" data-first-offset="true"><span data-slate-string="true">另外，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12661"><span data-slate-object="text" data-key="12662"><span data-slate-leaf="true" data-offset-key="12662:0" data-first-offset="true"><span data-slate-string="true">asyncio.create_task</span></span></span></span><span data-slate-object="text" data-key="12663"><span data-slate-leaf="true" data-offset-key="12663:0" data-first-offset="true"><span data-slate-string="true">，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12664"><span data-slate-object="text" data-key="12665"><span data-slate-leaf="true" data-offset-key="12665:0" data-first-offset="true"><span data-slate-string="true">asyncio.run</span></span></span></span><span data-slate-object="text" data-key="12666"><span data-slate-leaf="true" data-offset-key="12666:0" data-first-offset="true"><span data-slate-string="true"> 这些函数都是 Python 3.7 以上的版本才提供的，自然，相比于旧接口它们也更容易理解和阅读。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12667" id="sr-toc-2"><span data-slate-object="text" data-key="12668"><span data-slate-leaf="true" data-offset-key="12668:0" data-first-offset="true"><span data-slate-string="true">解密协程运行时</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12669"><span data-slate-object="text" data-key="12670"><span data-slate-leaf="true" data-offset-key="12670:0" data-first-offset="true"><span data-slate-string="true">说了这么多，现在，我们不妨来深入代码底层看看。有了前面的知识做基础，你应该很容易理解这两段代码。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12671"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12672"><span data-slate-object="text" data-key="12673"><span data-slate-leaf="true" data-offset-key="12673:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12674"><span data-slate-leaf="true" data-offset-key="12674:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12675"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12676"><span data-slate-object="text" data-key="12677"><span data-slate-leaf="true" data-offset-key="12677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12678"><span data-slate-leaf="true" data-offset-key="12678:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12679"><span data-slate-leaf="true" data-offset-key="12679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12680"><span data-slate-leaf="true" data-offset-key="12680:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12681"><span data-slate-leaf="true" data-offset-key="12681:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_1</span></span></span></span><span data-slate-object="text" data-key="12682"><span data-slate-leaf="true" data-offset-key="12682:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12683"><span data-slate-object="text" data-key="12684"><span data-slate-leaf="true" data-offset-key="12684:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12685"><span data-slate-leaf="true" data-offset-key="12685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12686"><span data-slate-leaf="true" data-offset-key="12686:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12687"><span data-slate-leaf="true" data-offset-key="12687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_1 start'</span></span></span></span><span data-slate-object="text" data-key="12688"><span data-slate-leaf="true" data-offset-key="12688:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12689"><span data-slate-object="text" data-key="12690"><span data-slate-leaf="true" data-offset-key="12690:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12691"><span data-slate-leaf="true" data-offset-key="12691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12692"><span data-slate-leaf="true" data-offset-key="12692:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12693"><span data-slate-leaf="true" data-offset-key="12693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12694"><span data-slate-leaf="true" data-offset-key="12694:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12695"><span data-slate-object="text" data-key="12696"><span data-slate-leaf="true" data-offset-key="12696:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12697"><span data-slate-leaf="true" data-offset-key="12697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12698"><span data-slate-leaf="true" data-offset-key="12698:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12699"><span data-slate-leaf="true" data-offset-key="12699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_1 done'</span></span></span></span><span data-slate-object="text" data-key="12700"><span data-slate-leaf="true" data-offset-key="12700:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12701"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12702"><span data-slate-object="text" data-key="12703"><span data-slate-leaf="true" data-offset-key="12703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12704"><span data-slate-leaf="true" data-offset-key="12704:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12705"><span data-slate-leaf="true" data-offset-key="12705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12706"><span data-slate-leaf="true" data-offset-key="12706:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12707"><span data-slate-leaf="true" data-offset-key="12707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_2</span></span></span></span><span data-slate-object="text" data-key="12708"><span data-slate-leaf="true" data-offset-key="12708:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12709"><span data-slate-object="text" data-key="12710"><span data-slate-leaf="true" data-offset-key="12710:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12711"><span data-slate-leaf="true" data-offset-key="12711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12712"><span data-slate-leaf="true" data-offset-key="12712:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12713"><span data-slate-leaf="true" data-offset-key="12713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_2 start'</span></span></span></span><span data-slate-object="text" data-key="12714"><span data-slate-leaf="true" data-offset-key="12714:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12715"><span data-slate-object="text" data-key="12716"><span data-slate-leaf="true" data-offset-key="12716:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12717"><span data-slate-leaf="true" data-offset-key="12717:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12718"><span data-slate-leaf="true" data-offset-key="12718:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12719"><span data-slate-leaf="true" data-offset-key="12719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="12720"><span data-slate-leaf="true" data-offset-key="12720:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12721"><span data-slate-object="text" data-key="12722"><span data-slate-leaf="true" data-offset-key="12722:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12723"><span data-slate-leaf="true" data-offset-key="12723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12724"><span data-slate-leaf="true" data-offset-key="12724:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12725"><span data-slate-leaf="true" data-offset-key="12725:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_2 done'</span></span></span></span><span data-slate-object="text" data-key="12726"><span data-slate-leaf="true" data-offset-key="12726:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12727"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12728"><span data-slate-object="text" data-key="12729"><span data-slate-leaf="true" data-offset-key="12729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12730"><span data-slate-leaf="true" data-offset-key="12730:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12731"><span data-slate-leaf="true" data-offset-key="12731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12732"><span data-slate-leaf="true" data-offset-key="12732:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12733"><span data-slate-leaf="true" data-offset-key="12733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12734"><span data-slate-leaf="true" data-offset-key="12734:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12735"><span data-slate-object="text" data-key="12736"><span data-slate-leaf="true" data-offset-key="12736:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12737"><span data-slate-leaf="true" data-offset-key="12737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12738"><span data-slate-leaf="true" data-offset-key="12738:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12739"><span data-slate-leaf="true" data-offset-key="12739:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'before await'</span></span></span></span><span data-slate-object="text" data-key="12740"><span data-slate-leaf="true" data-offset-key="12740:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12741"><span data-slate-object="text" data-key="12742"><span data-slate-leaf="true" data-offset-key="12742:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12743"><span data-slate-leaf="true" data-offset-key="12743:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12744"><span data-slate-leaf="true" data-offset-key="12744:0" data-first-offset="true"><span data-slate-string="true"> worker_1()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12745"><span data-slate-object="text" data-key="12746"><span data-slate-leaf="true" data-offset-key="12746:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12747"><span data-slate-leaf="true" data-offset-key="12747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12748"><span data-slate-leaf="true" data-offset-key="12748:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12749"><span data-slate-leaf="true" data-offset-key="12749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'awaited worker_1'</span></span></span></span><span data-slate-object="text" data-key="12750"><span data-slate-leaf="true" data-offset-key="12750:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12751"><span data-slate-object="text" data-key="12752"><span data-slate-leaf="true" data-offset-key="12752:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12753"><span data-slate-leaf="true" data-offset-key="12753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12754"><span data-slate-leaf="true" data-offset-key="12754:0" data-first-offset="true"><span data-slate-string="true"> worker_2()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12755"><span data-slate-object="text" data-key="12756"><span data-slate-leaf="true" data-offset-key="12756:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12757"><span data-slate-leaf="true" data-offset-key="12757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12758"><span data-slate-leaf="true" data-offset-key="12758:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12759"><span data-slate-leaf="true" data-offset-key="12759:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'awaited worker_2'</span></span></span></span><span data-slate-object="text" data-key="12760"><span data-slate-leaf="true" data-offset-key="12760:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12761"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12762"><span data-slate-object="text" data-key="12763"><span data-slate-leaf="true" data-offset-key="12763:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c3328dfe" data-attr-id="27044" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">%time asyncio.run(main())</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12764"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12765"><span data-slate-object="text" data-key="12766"><span data-slate-leaf="true" data-offset-key="12766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12767"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12768"><span data-slate-object="text" data-key="12769"><span data-slate-leaf="true" data-offset-key="12769:0" data-first-offset="true"><span data-slate-string="true">before </span></span></span><span data-slate-object="text" data-key="12770"><span data-slate-leaf="true" data-offset-key="12770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12771"><span data-slate-object="text" data-key="12772"><span data-slate-leaf="true" data-offset-key="12772:0" data-first-offset="true"><span data-slate-string="true">worker_1 start</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12773"><span data-slate-object="text" data-key="12774"><span data-slate-leaf="true" data-offset-key="12774:0" data-first-offset="true"><span data-slate-string="true">worker_1 done</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12775"><span data-slate-object="text" data-key="12776"><span data-slate-leaf="true" data-offset-key="12776:0" data-first-offset="true"><span data-slate-string="true">awaited worker_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12777"><span data-slate-object="text" data-key="12778"><span data-slate-leaf="true" data-offset-key="12778:0" data-first-offset="true"><span data-slate-string="true">worker_2 start</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12779"><span data-slate-object="text" data-key="12780"><span data-slate-leaf="true" data-offset-key="12780:0" data-first-offset="true"><span data-slate-string="true">worker_2 done</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12781"><span data-slate-object="text" data-key="12782"><span data-slate-leaf="true" data-offset-key="12782:0" data-first-offset="true"><span data-slate-string="true">awaited worker_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12783"><span data-slate-object="text" data-key="12784"><span data-slate-leaf="true" data-offset-key="12784:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12785"><span data-slate-leaf="true" data-offset-key="12785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="12786"><span data-slate-leaf="true" data-offset-key="12786:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12787"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12788"><span data-slate-object="text" data-key="12789"><span data-slate-leaf="true" data-offset-key="12789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12790"><span data-slate-leaf="true" data-offset-key="12790:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12791"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12792"><span data-slate-object="text" data-key="12793"><span data-slate-leaf="true" data-offset-key="12793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12794"><span data-slate-leaf="true" data-offset-key="12794:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12795"><span data-slate-leaf="true" data-offset-key="12795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12796"><span data-slate-leaf="true" data-offset-key="12796:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12797"><span data-slate-leaf="true" data-offset-key="12797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_1</span></span></span></span><span data-slate-object="text" data-key="12798"><span data-slate-leaf="true" data-offset-key="12798:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12799"><span data-slate-object="text" data-key="12800"><span data-slate-leaf="true" data-offset-key="12800:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12801"><span data-slate-leaf="true" data-offset-key="12801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12802"><span data-slate-leaf="true" data-offset-key="12802:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12803"><span data-slate-leaf="true" data-offset-key="12803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_1 start'</span></span></span></span><span data-slate-object="text" data-key="12804"><span data-slate-leaf="true" data-offset-key="12804:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12805"><span data-slate-object="text" data-key="12806"><span data-slate-leaf="true" data-offset-key="12806:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12807"><span data-slate-leaf="true" data-offset-key="12807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12808"><span data-slate-leaf="true" data-offset-key="12808:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12809"><span data-slate-leaf="true" data-offset-key="12809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12810"><span data-slate-leaf="true" data-offset-key="12810:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12811"><span data-slate-object="text" data-key="12812"><span data-slate-leaf="true" data-offset-key="12812:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12813"><span data-slate-leaf="true" data-offset-key="12813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12814"><span data-slate-leaf="true" data-offset-key="12814:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12815"><span data-slate-leaf="true" data-offset-key="12815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_1 done'</span></span></span></span><span data-slate-object="text" data-key="12816"><span data-slate-leaf="true" data-offset-key="12816:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12817"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12818"><span data-slate-object="text" data-key="12819"><span data-slate-leaf="true" data-offset-key="12819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12820"><span data-slate-leaf="true" data-offset-key="12820:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12821"><span data-slate-leaf="true" data-offset-key="12821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12822"><span data-slate-leaf="true" data-offset-key="12822:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12823"><span data-slate-leaf="true" data-offset-key="12823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_2</span></span></span></span><span data-slate-object="text" data-key="12824"><span data-slate-leaf="true" data-offset-key="12824:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12825"><span data-slate-object="text" data-key="12826"><span data-slate-leaf="true" data-offset-key="12826:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12827"><span data-slate-leaf="true" data-offset-key="12827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12828"><span data-slate-leaf="true" data-offset-key="12828:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12829"><span data-slate-leaf="true" data-offset-key="12829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_2 start'</span></span></span></span><span data-slate-object="text" data-key="12830"><span data-slate-leaf="true" data-offset-key="12830:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12831"><span data-slate-object="text" data-key="12832"><span data-slate-leaf="true" data-offset-key="12832:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12833"><span data-slate-leaf="true" data-offset-key="12833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12834"><span data-slate-leaf="true" data-offset-key="12834:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12835"><span data-slate-leaf="true" data-offset-key="12835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="12836"><span data-slate-leaf="true" data-offset-key="12836:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12837"><span data-slate-object="text" data-key="12838"><span data-slate-leaf="true" data-offset-key="12838:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12839"><span data-slate-leaf="true" data-offset-key="12839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12840"><span data-slate-leaf="true" data-offset-key="12840:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12841"><span data-slate-leaf="true" data-offset-key="12841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'worker_2 done'</span></span></span></span><span data-slate-object="text" data-key="12842"><span data-slate-leaf="true" data-offset-key="12842:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12843"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12844"><span data-slate-object="text" data-key="12845"><span data-slate-leaf="true" data-offset-key="12845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12846"><span data-slate-leaf="true" data-offset-key="12846:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12847"><span data-slate-leaf="true" data-offset-key="12847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12848"><span data-slate-leaf="true" data-offset-key="12848:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12849"><span data-slate-leaf="true" data-offset-key="12849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="12850"><span data-slate-leaf="true" data-offset-key="12850:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12851"><span data-slate-object="text" data-key="12852"><span data-slate-leaf="true" data-offset-key="12852:0" data-first-offset="true"><span data-slate-string="true">    task1 = asyncio.create_task(worker_1())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12853"><span data-slate-object="text" data-key="12854"><span data-slate-leaf="true" data-offset-key="12854:0" data-first-offset="true"><span data-slate-string="true">    task2 = asyncio.create_task(worker_2())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12855"><span data-slate-object="text" data-key="12856"><span data-slate-leaf="true" data-offset-key="12856:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12857"><span data-slate-leaf="true" data-offset-key="12857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12858"><span data-slate-leaf="true" data-offset-key="12858:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12859"><span data-slate-leaf="true" data-offset-key="12859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'before await'</span></span></span></span><span data-slate-object="text" data-key="12860"><span data-slate-leaf="true" data-offset-key="12860:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12861"><span data-slate-object="text" data-key="12862"><span data-slate-leaf="true" data-offset-key="12862:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12863"><span data-slate-leaf="true" data-offset-key="12863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12864"><span data-slate-leaf="true" data-offset-key="12864:0" data-first-offset="true"><span data-slate-string="true"> task1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12865"><span data-slate-object="text" data-key="12866"><span data-slate-leaf="true" data-offset-key="12866:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12867"><span data-slate-leaf="true" data-offset-key="12867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12868"><span data-slate-leaf="true" data-offset-key="12868:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12869"><span data-slate-leaf="true" data-offset-key="12869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'awaited worker_1'</span></span></span></span><span data-slate-object="text" data-key="12870"><span data-slate-leaf="true" data-offset-key="12870:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12871"><span data-slate-object="text" data-key="12872"><span data-slate-leaf="true" data-offset-key="12872:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12873"><span data-slate-leaf="true" data-offset-key="12873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12874"><span data-slate-leaf="true" data-offset-key="12874:0" data-first-offset="true"><span data-slate-string="true"> task2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12875"><span data-slate-object="text" data-key="12876"><span data-slate-leaf="true" data-offset-key="12876:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12877"><span data-slate-leaf="true" data-offset-key="12877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="12878"><span data-slate-leaf="true" data-offset-key="12878:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="12879"><span data-slate-leaf="true" data-offset-key="12879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'awaited worker_2'</span></span></span></span><span data-slate-object="text" data-key="12880"><span data-slate-leaf="true" data-offset-key="12880:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12881"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12882"><span data-slate-object="text" data-key="12883"><span data-slate-leaf="true" data-offset-key="12883:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12884"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12885"><span data-slate-object="text" data-key="12886"><span data-slate-leaf="true" data-offset-key="12886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12887"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12888"><span data-slate-object="text" data-key="12889"><span data-slate-leaf="true" data-offset-key="12889:0" data-first-offset="true"><span data-slate-string="true">before </span></span></span><span data-slate-object="text" data-key="12890"><span data-slate-leaf="true" data-offset-key="12890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12891"><span data-slate-object="text" data-key="12892"><span data-slate-leaf="true" data-offset-key="12892:0" data-first-offset="true"><span data-slate-string="true">worker_1 start</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12893"><span data-slate-object="text" data-key="12894"><span data-slate-leaf="true" data-offset-key="12894:0" data-first-offset="true"><span data-slate-string="true">worker_2 start</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12895"><span data-slate-object="text" data-key="12896"><span data-slate-leaf="true" data-offset-key="12896:0" data-first-offset="true"><span data-slate-string="true">worker_1 done</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12897"><span data-slate-object="text" data-key="12898"><span data-slate-leaf="true" data-offset-key="12898:0" data-first-offset="true"><span data-slate-string="true">awaited worker_1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12899"><span data-slate-object="text" data-key="12900"><span data-slate-leaf="true" data-offset-key="12900:0" data-first-offset="true"><span data-slate-string="true">worker_2 done</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12901"><span data-slate-object="text" data-key="12902"><span data-slate-leaf="true" data-offset-key="12902:0" data-first-offset="true"><span data-slate-string="true">awaited worker_2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12903"><span data-slate-object="text" data-key="12904"><span data-slate-leaf="true" data-offset-key="12904:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="12905"><span data-slate-leaf="true" data-offset-key="12905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2.01</span></span></span></span><span data-slate-object="text" data-key="12906"><span data-slate-leaf="true" data-offset-key="12906:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12907"><span data-slate-object="text" data-key="12908"><span data-slate-leaf="true" data-offset-key="12908:0" data-first-offset="true"><span data-slate-string="true">不过，第二个代码，到底发生了什么呢？为了让你更详细了解到协程和线程的具体区别，</span></span><span data-slate-leaf="true" data-offset-key="12908:1"><span data-slate-object="annotation" data-annotation-key="gkann_17bedc6a" data-attr-id="27045" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">这里我详细地分析了整个过程。</span></span></span><span data-slate-leaf="true" data-offset-key="12908:2"><span data-slate-string="true">步骤有点多，别着急，我们慢慢来看。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12909"><div data-slate-type="list-line" data-slate-object="block" data-key="12910"><div data-code-line-number="1"></div><div><span data-slate-type="code" data-slate-object="inline" data-key="12911"><span data-slate-object="text" data-key="12912"><span data-slate-leaf="true" data-offset-key="12912:0" data-first-offset="true"><span data-slate-string="true">asyncio.run(main())</span></span></span></span><span data-slate-object="text" data-key="12913"><span data-slate-leaf="true" data-offset-key="12913:0" data-first-offset="true"><span data-slate-string="true">，程序进入 main () 函数，事件循环开启；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12914"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12915"><span data-slate-leaf="true" data-offset-key="12915:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0be6e209" data-attr-id="43440" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">task1 和 task2 任务被创建，并进入事件循环等待运行；运行到 print，</span></span></span><span data-slate-leaf="true" data-offset-key="12915:1"><span data-slate-string="true">输出 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12916"><span data-slate-object="text" data-key="12917"><span data-slate-leaf="true" data-offset-key="12917:0" data-first-offset="true"><span data-slate-string="true">'before await'</span></span></span></span><span data-slate-object="text" data-key="12918"><span data-slate-leaf="true" data-offset-key="12918:0" data-first-offset="true"><span data-slate-string="true">；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12919"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="12920"><span data-slate-leaf="true" data-offset-key="12920:0" data-first-offset="true"><span data-slate-string="true">await task1 执行，用户选择从当前的主任务中切出，事件调度器开始调度 worker_1；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12921"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="12922"><span data-slate-leaf="true" data-offset-key="12922:0" data-first-offset="true"><span data-slate-string="true">worker_1 开始运行，运行 print 输出</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12923"><span data-slate-object="text" data-key="12924"><span data-slate-leaf="true" data-offset-key="12924:0" data-first-offset="true"><span data-slate-string="true">'worker_1 start'</span></span></span></span><span data-slate-object="text" data-key="12925"><span data-slate-leaf="true" data-offset-key="12925:0" data-first-offset="true"><span data-slate-string="true">，</span></span><span data-slate-leaf="true" data-offset-key="12925:1"><span data-slate-object="annotation" data-annotation-key="gkann_f595babf" data-attr-id="34000" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">然后运行到 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12926"><span data-slate-object="text" data-key="12927"><span data-slate-leaf="true" data-offset-key="12927:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f595babf" data-attr-id="34000" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">await asyncio.sleep(1)</span></span></span></span></span><span data-slate-object="text" data-key="12928"><span data-slate-leaf="true" data-offset-key="12928:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f595babf" data-attr-id="34000" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">， 从当前任务切出，事件调度器开始调度 worker_2；</span></span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12929"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="12930"><span data-slate-leaf="true" data-offset-key="12930:0" data-first-offset="true"><span data-slate-string="true">worker_2 开始运行，运行 print 输出 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12931"><span data-slate-object="text" data-key="12932"><span data-slate-leaf="true" data-offset-key="12932:0" data-first-offset="true"><span data-slate-string="true">'worker_2 start'</span></span></span></span><span data-slate-object="text" data-key="12933"><span data-slate-leaf="true" data-offset-key="12933:0" data-first-offset="true"><span data-slate-string="true">，然后运行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12934"><span data-slate-object="text" data-key="12935"><span data-slate-leaf="true" data-offset-key="12935:0" data-first-offset="true"><span data-slate-string="true">await asyncio.sleep(2)</span></span></span></span><span data-slate-object="text" data-key="12936"><span data-slate-leaf="true" data-offset-key="12936:0" data-first-offset="true"><span data-slate-string="true"> 从当前任务切出；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12937"><div data-code-line-number="6"></div><div><span data-slate-object="text" data-key="12938"><span data-slate-leaf="true" data-offset-key="12938:0" data-first-offset="true"><span data-slate-string="true">以上所有事件的运行时间，都应该在 1ms 到 10ms 之间，甚至可能更短，事件调度器从这个时候开始暂停调度；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12939"><div data-code-line-number="7"></div><div><span data-slate-object="text" data-key="12940"><span data-slate-leaf="true" data-offset-key="12940:0" data-first-offset="true"><span data-slate-string="true">一秒钟后，worker_1 的 sleep 完成，事件调度器将控制权重新传给 task_1，输出 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12941"><span data-slate-object="text" data-key="12942"><span data-slate-leaf="true" data-offset-key="12942:0" data-first-offset="true"><span data-slate-string="true">'worker_1 done'</span></span></span></span><span data-slate-object="text" data-key="12943"><span data-slate-leaf="true" data-offset-key="12943:0" data-first-offset="true"><span data-slate-string="true">，task_1 完成任务，从事件循环中退出；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12944"><div data-code-line-number="8"></div><div><span data-slate-object="text" data-key="12945"><span data-slate-leaf="true" data-offset-key="12945:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d4237233" data-attr-id="30015" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">await task1 完成，事件调度器将控制器传给主任务，输出 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12946"><span data-slate-object="text" data-key="12947"><span data-slate-leaf="true" data-offset-key="12947:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d4237233" data-attr-id="30015" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">'awaited worker_1'</span></span></span></span></span><span data-slate-object="text" data-key="12948"><span data-slate-leaf="true" data-offset-key="12948:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_d4237233" data-attr-id="30015" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，・然后在 await task2 处继续等待；</span></span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12949"><div data-code-line-number="9"></div><div><span data-slate-object="text" data-key="12950"><span data-slate-leaf="true" data-offset-key="12950:0" data-first-offset="true"><span data-slate-string="true">两秒钟后，worker_2 的 sleep 完成，事件调度器将控制权重新传给 task_2，输出 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12951"><span data-slate-object="text" data-key="12952"><span data-slate-leaf="true" data-offset-key="12952:0" data-first-offset="true"><span data-slate-string="true">'worker_2 done'</span></span></span></span><span data-slate-object="text" data-key="12953"><span data-slate-leaf="true" data-offset-key="12953:0" data-first-offset="true"><span data-slate-string="true">，task_2 完成任务，从事件循环中退出；</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12954"><div data-code-line-number="10"></div><div><span data-slate-object="text" data-key="12955"><span data-slate-leaf="true" data-offset-key="12955:0" data-first-offset="true"><span data-slate-string="true">主任务输出 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12956"><span data-slate-object="text" data-key="12957"><span data-slate-leaf="true" data-offset-key="12957:0" data-first-offset="true"><span data-slate-string="true">'awaited worker_2'</span></span></span></span><span data-slate-object="text" data-key="12958"><span data-slate-leaf="true" data-offset-key="12958:0" data-first-offset="true"><span data-slate-string="true">，协程全任务结束，事件循环结束。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12959"><span data-slate-object="text" data-key="12960"><span data-slate-leaf="true" data-offset-key="12960:0" data-first-offset="true"><span data-slate-string="true">接下来，我们进阶一下。如果我们想给某些协程任务限定运行时间，一旦超时就取消，又该怎么做呢？再进一步，如果某些协程运行时出现错误，又该怎么处理呢？同样的，来看代码。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="12961"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12962"><span data-slate-object="text" data-key="12963"><span data-slate-leaf="true" data-offset-key="12963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="12964"><span data-slate-leaf="true" data-offset-key="12964:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12965"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12966"><span data-slate-object="text" data-key="12967"><span data-slate-leaf="true" data-offset-key="12967:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12968"><span data-slate-leaf="true" data-offset-key="12968:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12969"><span data-slate-leaf="true" data-offset-key="12969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12970"><span data-slate-leaf="true" data-offset-key="12970:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12971"><span data-slate-leaf="true" data-offset-key="12971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_1</span></span></span></span><span data-slate-object="text" data-key="12972"><span data-slate-leaf="true" data-offset-key="12972:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12973"><span data-slate-object="text" data-key="12974"><span data-slate-leaf="true" data-offset-key="12974:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12975"><span data-slate-leaf="true" data-offset-key="12975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12976"><span data-slate-leaf="true" data-offset-key="12976:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12977"><span data-slate-leaf="true" data-offset-key="12977:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="12978"><span data-slate-leaf="true" data-offset-key="12978:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12979"><span data-slate-object="text" data-key="12980"><span data-slate-leaf="true" data-offset-key="12980:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12981"><span data-slate-leaf="true" data-offset-key="12981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="12982"><span data-slate-leaf="true" data-offset-key="12982:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12983"><span data-slate-leaf="true" data-offset-key="12983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12984"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12985"><span data-slate-object="text" data-key="12986"><span data-slate-leaf="true" data-offset-key="12986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="12987"><span data-slate-leaf="true" data-offset-key="12987:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12988"><span data-slate-leaf="true" data-offset-key="12988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="12989"><span data-slate-leaf="true" data-offset-key="12989:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12990"><span data-slate-leaf="true" data-offset-key="12990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_2</span></span></span></span><span data-slate-object="text" data-key="12991"><span data-slate-leaf="true" data-offset-key="12991:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12992"><span data-slate-object="text" data-key="12993"><span data-slate-leaf="true" data-offset-key="12993:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="12994"><span data-slate-leaf="true" data-offset-key="12994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="12995"><span data-slate-leaf="true" data-offset-key="12995:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="12996"><span data-slate-leaf="true" data-offset-key="12996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="12997"><span data-slate-leaf="true" data-offset-key="12997:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12998"><span data-slate-object="text" data-key="12999"><span data-slate-leaf="true" data-offset-key="12999:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13000"><span data-slate-leaf="true" data-offset-key="13000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13001"><span data-slate-leaf="true" data-offset-key="13001:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13002"><span data-slate-leaf="true" data-offset-key="13002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="13003"><span data-slate-leaf="true" data-offset-key="13003:0" data-first-offset="true"><span data-slate-string="true"> / </span></span></span><span data-slate-object="text" data-key="13004"><span data-slate-leaf="true" data-offset-key="13004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13005"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13006"><span data-slate-object="text" data-key="13007"><span data-slate-leaf="true" data-offset-key="13007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13008"><span data-slate-leaf="true" data-offset-key="13008:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13009"><span data-slate-leaf="true" data-offset-key="13009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13010"><span data-slate-leaf="true" data-offset-key="13010:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13011"><span data-slate-leaf="true" data-offset-key="13011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">worker_3</span></span></span></span><span data-slate-object="text" data-key="13012"><span data-slate-leaf="true" data-offset-key="13012:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13013"><span data-slate-object="text" data-key="13014"><span data-slate-leaf="true" data-offset-key="13014:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13015"><span data-slate-leaf="true" data-offset-key="13015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13016"><span data-slate-leaf="true" data-offset-key="13016:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="13017"><span data-slate-leaf="true" data-offset-key="13017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="13018"><span data-slate-leaf="true" data-offset-key="13018:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13019"><span data-slate-object="text" data-key="13020"><span data-slate-leaf="true" data-offset-key="13020:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13021"><span data-slate-leaf="true" data-offset-key="13021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13022"><span data-slate-leaf="true" data-offset-key="13022:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13023"><span data-slate-leaf="true" data-offset-key="13023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13024"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13025"><span data-slate-object="text" data-key="13026"><span data-slate-leaf="true" data-offset-key="13026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13027"><span data-slate-leaf="true" data-offset-key="13027:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13028"><span data-slate-leaf="true" data-offset-key="13028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13029"><span data-slate-leaf="true" data-offset-key="13029:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13030"><span data-slate-leaf="true" data-offset-key="13030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="13031"><span data-slate-leaf="true" data-offset-key="13031:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13032"><span data-slate-object="text" data-key="13033"><span data-slate-leaf="true" data-offset-key="13033:0" data-first-offset="true"><span data-slate-string="true">    task_1 = asyncio.create_task(worker_1())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13034"><span data-slate-object="text" data-key="13035"><span data-slate-leaf="true" data-offset-key="13035:0" data-first-offset="true"><span data-slate-string="true">    task_2 = asyncio.create_task(worker_2())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13036"><span data-slate-object="text" data-key="13037"><span data-slate-leaf="true" data-offset-key="13037:0" data-first-offset="true"><span data-slate-string="true">    task_3 = asyncio.create_task(worker_3())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13038"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13039"><span data-slate-object="text" data-key="13040"><span data-slate-leaf="true" data-offset-key="13040:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13041"><span data-slate-leaf="true" data-offset-key="13041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13042"><span data-slate-leaf="true" data-offset-key="13042:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="13043"><span data-slate-leaf="true" data-offset-key="13043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="13044"><span data-slate-leaf="true" data-offset-key="13044:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13045"><span data-slate-object="text" data-key="13046"><span data-slate-leaf="true" data-offset-key="13046:0" data-first-offset="true"><span data-slate-string="true">    task_3.cancel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13047"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13048"><span data-slate-object="text" data-key="13049"><span data-slate-leaf="true" data-offset-key="13049:0" data-first-offset="true"><span data-slate-string="true">    res = </span></span></span><span data-slate-object="text" data-key="13050"><span data-slate-leaf="true" data-offset-key="13050:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13051"><span data-slate-leaf="true" data-offset-key="13051:0" data-first-offset="true"><span data-slate-string="true"> asyncio.gather(task_1, task_2, task_3, return_exceptions=</span></span></span><span data-slate-object="text" data-key="13052"><span data-slate-leaf="true" data-offset-key="13052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="13053"><span data-slate-leaf="true" data-offset-key="13053:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13054"><span data-slate-object="text" data-key="13055"><span data-slate-leaf="true" data-offset-key="13055:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13056"><span data-slate-leaf="true" data-offset-key="13056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="13057"><span data-slate-leaf="true" data-offset-key="13057:0" data-first-offset="true"><span data-slate-string="true">(res)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13058"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13059"><span data-slate-object="text" data-key="13060"><span data-slate-leaf="true" data-offset-key="13060:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13061"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13062"><span data-slate-object="text" data-key="13063"><span data-slate-leaf="true" data-offset-key="13063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13064"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13065"><span data-slate-object="text" data-key="13066"><span data-slate-leaf="true" data-offset-key="13066:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="13067"><span data-slate-leaf="true" data-offset-key="13067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13068"><span data-slate-leaf="true" data-offset-key="13068:0" data-first-offset="true"><span data-slate-string="true">, ZeroDivisionError(</span></span></span><span data-slate-object="text" data-key="13069"><span data-slate-leaf="true" data-offset-key="13069:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'division by zero'</span></span></span></span><span data-slate-object="text" data-key="13070"><span data-slate-leaf="true" data-offset-key="13070:0" data-first-offset="true"><span data-slate-string="true">), CancelledError()]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13071"><span data-slate-object="text" data-key="13072"><span data-slate-leaf="true" data-offset-key="13072:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="13073"><span data-slate-leaf="true" data-offset-key="13073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="13074"><span data-slate-leaf="true" data-offset-key="13074:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13075"><span data-slate-object="text" data-key="13076"><span data-slate-leaf="true" data-offset-key="13076:0" data-first-offset="true"><span data-slate-string="true">你可以看到，worker_1 正常运行，worker_2 运行中出现错误，worker_3 执行时间过长被我们 cancel 掉了，这些信息会全部体现在最终的返回结果 res 中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13077"><span data-slate-object="text" data-key="13078"><span data-slate-leaf="true" data-offset-key="13078:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7b789dc0" data-attr-id="36170" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">不过要注意</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="13079"><span data-slate-object="text" data-key="13080"><span data-slate-leaf="true" data-offset-key="13080:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7b789dc0" data-attr-id="36170" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> return_exceptions=True</span></span></span></span></span><span data-slate-object="text" data-key="13081"><span data-slate-leaf="true" data-offset-key="13081:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7b789dc0" data-attr-id="36170" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> 这行代码。如果不设置这个参数，错误就会完整地 throw 到我们这个执行层，从而需要 try except 来捕捉，这也就意味着其他还没被执行的任务会被全部取消掉。为了避免这个局面，我们将 return_exceptions 设置为 True 即可。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13082"><span data-slate-object="text" data-key="13083"><span data-slate-leaf="true" data-offset-key="13083:0" data-first-offset="true"><span data-slate-string="true">到这里，发现了没，线程能实现的，协程都能做到。那就让我们温习一下这些知识点，用协程来实现一个经典的生产者消费者模型吧。</span></span></span></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="13084"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13085"><span data-slate-object="text" data-key="13086"><span data-slate-leaf="true" data-offset-key="13086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="13087"><span data-slate-leaf="true" data-offset-key="13087:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13088"><span data-slate-object="text" data-key="13089"><span data-slate-leaf="true" data-offset-key="13089:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="13090"><span data-slate-leaf="true" data-offset-key="13090:0" data-first-offset="true"><span data-slate-string="true"> random</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13091"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13092"><span data-slate-object="text" data-key="13093"><span data-slate-leaf="true" data-offset-key="13093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13094"><span data-slate-leaf="true" data-offset-key="13094:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13095"><span data-slate-leaf="true" data-offset-key="13095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13096"><span data-slate-leaf="true" data-offset-key="13096:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13097"><span data-slate-leaf="true" data-offset-key="13097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">consumer</span></span></span></span><span data-slate-object="text" data-key="13098"><span data-slate-leaf="true" data-offset-key="13098:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13099"><span data-slate-leaf="true" data-offset-key="13099:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">queue, </span></span></span></span><span data-slate-object="text" data-key="13100"><span data-slate-leaf="true" data-offset-key="13100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span></span><span data-slate-object="text" data-key="13101"><span data-slate-leaf="true" data-offset-key="13101:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13102"><span data-slate-object="text" data-key="13103"><span data-slate-leaf="true" data-offset-key="13103:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13104"><span data-slate-leaf="true" data-offset-key="13104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">while</span></span></span></span><span data-slate-object="text" data-key="13105"><span data-slate-leaf="true" data-offset-key="13105:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13106"><span data-slate-leaf="true" data-offset-key="13106:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="13107"><span data-slate-leaf="true" data-offset-key="13107:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13108"><span data-slate-object="text" data-key="13109"><span data-slate-leaf="true" data-offset-key="13109:0" data-first-offset="true"><span data-slate-string="true">        val = </span></span></span><span data-slate-object="text" data-key="13110"><span data-slate-leaf="true" data-offset-key="13110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13111"><span data-slate-leaf="true" data-offset-key="13111:0" data-first-offset="true"><span data-slate-string="true"> queue.get()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13112"><span data-slate-object="text" data-key="13113"><span data-slate-leaf="true" data-offset-key="13113:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13114"><span data-slate-leaf="true" data-offset-key="13114:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="13115"><span data-slate-leaf="true" data-offset-key="13115:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13116"><span data-slate-leaf="true" data-offset-key="13116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'{} get a val: {}'</span></span></span></span><span data-slate-object="text" data-key="13117"><span data-slate-leaf="true" data-offset-key="13117:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="13118"><span data-slate-leaf="true" data-offset-key="13118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="13119"><span data-slate-leaf="true" data-offset-key="13119:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13120"><span data-slate-leaf="true" data-offset-key="13120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span><span data-slate-object="text" data-key="13121"><span data-slate-leaf="true" data-offset-key="13121:0" data-first-offset="true"><span data-slate-string="true">, val))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13122"><span data-slate-object="text" data-key="13123"><span data-slate-leaf="true" data-offset-key="13123:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13124"><span data-slate-leaf="true" data-offset-key="13124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13125"><span data-slate-leaf="true" data-offset-key="13125:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="13126"><span data-slate-leaf="true" data-offset-key="13126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13127"><span data-slate-leaf="true" data-offset-key="13127:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13128"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13129"><span data-slate-object="text" data-key="13130"><span data-slate-leaf="true" data-offset-key="13130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13131"><span data-slate-leaf="true" data-offset-key="13131:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13132"><span data-slate-leaf="true" data-offset-key="13132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13133"><span data-slate-leaf="true" data-offset-key="13133:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13134"><span data-slate-leaf="true" data-offset-key="13134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">producer</span></span></span></span><span data-slate-object="text" data-key="13135"><span data-slate-leaf="true" data-offset-key="13135:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13136"><span data-slate-leaf="true" data-offset-key="13136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">queue, </span></span></span></span><span data-slate-object="text" data-key="13137"><span data-slate-leaf="true" data-offset-key="13137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span></span><span data-slate-object="text" data-key="13138"><span data-slate-leaf="true" data-offset-key="13138:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13139"><span data-slate-object="text" data-key="13140"><span data-slate-leaf="true" data-offset-key="13140:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13141"><span data-slate-leaf="true" data-offset-key="13141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="13142"><span data-slate-leaf="true" data-offset-key="13142:0" data-first-offset="true"><span data-slate-string="true"> i </span></span></span><span data-slate-object="text" data-key="13143"><span data-slate-leaf="true" data-offset-key="13143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="13144"><span data-slate-leaf="true" data-offset-key="13144:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13145"><span data-slate-leaf="true" data-offset-key="13145:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="13146"><span data-slate-leaf="true" data-offset-key="13146:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13147"><span data-slate-leaf="true" data-offset-key="13147:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="13148"><span data-slate-leaf="true" data-offset-key="13148:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13149"><span data-slate-object="text" data-key="13150"><span data-slate-leaf="true" data-offset-key="13150:0" data-first-offset="true"><span data-slate-string="true">        val = random.randint(</span></span></span><span data-slate-object="text" data-key="13151"><span data-slate-leaf="true" data-offset-key="13151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13152"><span data-slate-leaf="true" data-offset-key="13152:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13153"><span data-slate-leaf="true" data-offset-key="13153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="13154"><span data-slate-leaf="true" data-offset-key="13154:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13155"><span data-slate-object="text" data-key="13156"><span data-slate-leaf="true" data-offset-key="13156:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13157"><span data-slate-leaf="true" data-offset-key="13157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13158"><span data-slate-leaf="true" data-offset-key="13158:0" data-first-offset="true"><span data-slate-string="true"> queue.put(val)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13159"><span data-slate-object="text" data-key="13160"><span data-slate-leaf="true" data-offset-key="13160:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13161"><span data-slate-leaf="true" data-offset-key="13161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="13162"><span data-slate-leaf="true" data-offset-key="13162:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13163"><span data-slate-leaf="true" data-offset-key="13163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'{} put a val: {}'</span></span></span></span><span data-slate-object="text" data-key="13164"><span data-slate-leaf="true" data-offset-key="13164:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="13165"><span data-slate-leaf="true" data-offset-key="13165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="13166"><span data-slate-leaf="true" data-offset-key="13166:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13167"><span data-slate-leaf="true" data-offset-key="13167:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span><span data-slate-object="text" data-key="13168"><span data-slate-leaf="true" data-offset-key="13168:0" data-first-offset="true"><span data-slate-string="true">, val))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13169"><span data-slate-object="text" data-key="13170"><span data-slate-leaf="true" data-offset-key="13170:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13171"><span data-slate-leaf="true" data-offset-key="13171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13172"><span data-slate-leaf="true" data-offset-key="13172:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="13173"><span data-slate-leaf="true" data-offset-key="13173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13174"><span data-slate-leaf="true" data-offset-key="13174:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13175"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13176"><span data-slate-object="text" data-key="13177"><span data-slate-leaf="true" data-offset-key="13177:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13178"><span data-slate-leaf="true" data-offset-key="13178:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13179"><span data-slate-leaf="true" data-offset-key="13179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13180"><span data-slate-leaf="true" data-offset-key="13180:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13181"><span data-slate-leaf="true" data-offset-key="13181:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="13182"><span data-slate-leaf="true" data-offset-key="13182:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13183"><span data-slate-object="text" data-key="13184"><span data-slate-leaf="true" data-offset-key="13184:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_b2a4b34c" data-attr-id="44286" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    queue = asyncio.Queue()</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13185"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13186"><span data-slate-object="text" data-key="13187"><span data-slate-leaf="true" data-offset-key="13187:0" data-first-offset="true"><span data-slate-string="true">    consumer_1 = asyncio.create_task(consumer(queue, </span></span></span><span data-slate-object="text" data-key="13188"><span data-slate-leaf="true" data-offset-key="13188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'consumer_1'</span></span></span></span><span data-slate-object="text" data-key="13189"><span data-slate-leaf="true" data-offset-key="13189:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13190"><span data-slate-object="text" data-key="13191"><span data-slate-leaf="true" data-offset-key="13191:0" data-first-offset="true"><span data-slate-string="true">    consumer_2 = asyncio.create_task(consumer(queue, </span></span></span><span data-slate-object="text" data-key="13192"><span data-slate-leaf="true" data-offset-key="13192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'consumer_2'</span></span></span></span><span data-slate-object="text" data-key="13193"><span data-slate-leaf="true" data-offset-key="13193:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13194"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13195"><span data-slate-object="text" data-key="13196"><span data-slate-leaf="true" data-offset-key="13196:0" data-first-offset="true"><span data-slate-string="true">    producer_1 = asyncio.create_task(producer(queue, </span></span></span><span data-slate-object="text" data-key="13197"><span data-slate-leaf="true" data-offset-key="13197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'producer_1'</span></span></span></span><span data-slate-object="text" data-key="13198"><span data-slate-leaf="true" data-offset-key="13198:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13199"><span data-slate-object="text" data-key="13200"><span data-slate-leaf="true" data-offset-key="13200:0" data-first-offset="true"><span data-slate-string="true">    producer_2 = asyncio.create_task(producer(queue, </span></span></span><span data-slate-object="text" data-key="13201"><span data-slate-leaf="true" data-offset-key="13201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'producer_2'</span></span></span></span><span data-slate-object="text" data-key="13202"><span data-slate-leaf="true" data-offset-key="13202:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13203"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13204"><span data-slate-object="text" data-key="13205"><span data-slate-leaf="true" data-offset-key="13205:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13206"><span data-slate-leaf="true" data-offset-key="13206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13207"><span data-slate-leaf="true" data-offset-key="13207:0" data-first-offset="true"><span data-slate-string="true"> asyncio.sleep(</span></span></span><span data-slate-object="text" data-key="13208"><span data-slate-leaf="true" data-offset-key="13208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="13209"><span data-slate-leaf="true" data-offset-key="13209:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13210"><span data-slate-object="text" data-key="13211"><span data-slate-leaf="true" data-offset-key="13211:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_77284ad0" data-attr-id="24707" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    consumer_1.cancel()</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13212"><span data-slate-object="text" data-key="13213"><span data-slate-leaf="true" data-offset-key="13213:0" data-first-offset="true"><span data-slate-string="true">    consumer_2.cancel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13214"><span data-slate-object="text" data-key="13215"><span data-slate-leaf="true" data-offset-key="13215:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13216"><span data-slate-object="text" data-key="13217"><span data-slate-leaf="true" data-offset-key="13217:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13218"><span data-slate-leaf="true" data-offset-key="13218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13219"><span data-slate-leaf="true" data-offset-key="13219:0" data-first-offset="true"><span data-slate-string="true"> asyncio.gather(consumer_1, consumer_2, producer_1, producer_2, return_exceptions=</span></span></span><span data-slate-object="text" data-key="13220"><span data-slate-leaf="true" data-offset-key="13220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">True</span></span></span></span><span data-slate-object="text" data-key="13221"><span data-slate-leaf="true" data-offset-key="13221:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13222"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13223"><span data-slate-object="text" data-key="13224"><span data-slate-leaf="true" data-offset-key="13224:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13225"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13226"><span data-slate-object="text" data-key="13227"><span data-slate-leaf="true" data-offset-key="13227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13228"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13229"><span data-slate-object="text" data-key="13230"><span data-slate-leaf="true" data-offset-key="13230:0" data-first-offset="true"><span data-slate-string="true">producer_1 put a val: </span></span></span><span data-slate-object="text" data-key="13231"><span data-slate-leaf="true" data-offset-key="13231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13232"><span data-slate-object="text" data-key="13233"><span data-slate-leaf="true" data-offset-key="13233:0" data-first-offset="true"><span data-slate-string="true">producer_2 put a val: </span></span></span><span data-slate-object="text" data-key="13234"><span data-slate-leaf="true" data-offset-key="13234:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13235"><span data-slate-object="text" data-key="13236"><span data-slate-leaf="true" data-offset-key="13236:0" data-first-offset="true"><span data-slate-string="true">consumer_1 get a val: </span></span></span><span data-slate-object="text" data-key="13237"><span data-slate-leaf="true" data-offset-key="13237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13238"><span data-slate-object="text" data-key="13239"><span data-slate-leaf="true" data-offset-key="13239:0" data-first-offset="true"><span data-slate-string="true">consumer_2 get a val: </span></span></span><span data-slate-object="text" data-key="13240"><span data-slate-leaf="true" data-offset-key="13240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13241"><span data-slate-object="text" data-key="13242"><span data-slate-leaf="true" data-offset-key="13242:0" data-first-offset="true"><span data-slate-string="true">producer_1 put a val: </span></span></span><span data-slate-object="text" data-key="13243"><span data-slate-leaf="true" data-offset-key="13243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13244"><span data-slate-object="text" data-key="13245"><span data-slate-leaf="true" data-offset-key="13245:0" data-first-offset="true"><span data-slate-string="true">producer_2 put a val: </span></span></span><span data-slate-object="text" data-key="13246"><span data-slate-leaf="true" data-offset-key="13246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13247"><span data-slate-object="text" data-key="13248"><span data-slate-leaf="true" data-offset-key="13248:0" data-first-offset="true"><span data-slate-string="true">consumer_2 get a val: </span></span></span><span data-slate-object="text" data-key="13249"><span data-slate-leaf="true" data-offset-key="13249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13250"><span data-slate-object="text" data-key="13251"><span data-slate-leaf="true" data-offset-key="13251:0" data-first-offset="true"><span data-slate-string="true">consumer_1 get a val: </span></span></span><span data-slate-object="text" data-key="13252"><span data-slate-leaf="true" data-offset-key="13252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13253"><span data-slate-object="text" data-key="13254"><span data-slate-leaf="true" data-offset-key="13254:0" data-first-offset="true"><span data-slate-string="true">producer_1 put a val: </span></span></span><span data-slate-object="text" data-key="13255"><span data-slate-leaf="true" data-offset-key="13255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13256"><span data-slate-object="text" data-key="13257"><span data-slate-leaf="true" data-offset-key="13257:0" data-first-offset="true"><span data-slate-string="true">producer_2 put a val: </span></span></span><span data-slate-object="text" data-key="13258"><span data-slate-leaf="true" data-offset-key="13258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13259"><span data-slate-object="text" data-key="13260"><span data-slate-leaf="true" data-offset-key="13260:0" data-first-offset="true"><span data-slate-string="true">consumer_1 get a val: </span></span></span><span data-slate-object="text" data-key="13261"><span data-slate-leaf="true" data-offset-key="13261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">6</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13262"><span data-slate-object="text" data-key="13263"><span data-slate-leaf="true" data-offset-key="13263:0" data-first-offset="true"><span data-slate-string="true">consumer_2 get a val: </span></span></span><span data-slate-object="text" data-key="13264"><span data-slate-leaf="true" data-offset-key="13264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13265"><span data-slate-object="text" data-key="13266"><span data-slate-leaf="true" data-offset-key="13266:0" data-first-offset="true"><span data-slate-string="true">producer_1 put a val: </span></span></span><span data-slate-object="text" data-key="13267"><span data-slate-leaf="true" data-offset-key="13267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13268"><span data-slate-object="text" data-key="13269"><span data-slate-leaf="true" data-offset-key="13269:0" data-first-offset="true"><span data-slate-string="true">producer_2 put a val: </span></span></span><span data-slate-object="text" data-key="13270"><span data-slate-leaf="true" data-offset-key="13270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13271"><span data-slate-object="text" data-key="13272"><span data-slate-leaf="true" data-offset-key="13272:0" data-first-offset="true"><span data-slate-string="true">consumer_2 get a val: </span></span></span><span data-slate-object="text" data-key="13273"><span data-slate-leaf="true" data-offset-key="13273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13274"><span data-slate-object="text" data-key="13275"><span data-slate-leaf="true" data-offset-key="13275:0" data-first-offset="true"><span data-slate-string="true">consumer_1 get a val: </span></span></span><span data-slate-object="text" data-key="13276"><span data-slate-leaf="true" data-offset-key="13276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13277"><span data-slate-object="text" data-key="13278"><span data-slate-leaf="true" data-offset-key="13278:0" data-first-offset="true"><span data-slate-string="true">producer_1 put a val: </span></span></span><span data-slate-object="text" data-key="13279"><span data-slate-leaf="true" data-offset-key="13279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13280"><span data-slate-object="text" data-key="13281"><span data-slate-leaf="true" data-offset-key="13281:0" data-first-offset="true"><span data-slate-string="true">producer_2 put a val: </span></span></span><span data-slate-object="text" data-key="13282"><span data-slate-leaf="true" data-offset-key="13282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13283"><span data-slate-object="text" data-key="13284"><span data-slate-leaf="true" data-offset-key="13284:0" data-first-offset="true"><span data-slate-string="true">consumer_1 get a val: </span></span></span><span data-slate-object="text" data-key="13285"><span data-slate-leaf="true" data-offset-key="13285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13286"><span data-slate-object="text" data-key="13287"><span data-slate-leaf="true" data-offset-key="13287:0" data-first-offset="true"><span data-slate-string="true">consumer_2 get a val: </span></span></span><span data-slate-object="text" data-key="13288"><span data-slate-leaf="true" data-offset-key="13288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">8</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13289"><span data-slate-object="text" data-key="13290"><span data-slate-leaf="true" data-offset-key="13290:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="13291"><span data-slate-leaf="true" data-offset-key="13291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="13292"><span data-slate-leaf="true" data-offset-key="13292:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13293" id="sr-toc-3"><span data-slate-object="text" data-key="13294"><span data-slate-leaf="true" data-offset-key="13294:0" data-first-offset="true"><span data-slate-string="true">实战：豆瓣近日推荐电影爬虫</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13295"><span data-slate-object="text" data-key="13296"><span data-slate-leaf="true" data-offset-key="13296:0" data-first-offset="true"><span data-slate-string="true">最后，进入今天的实战环节 —— 实现一个完整的协程爬虫。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13297"><span data-slate-object="text" data-key="13298"><span data-slate-leaf="true" data-offset-key="13298:0" data-first-offset="true"><span data-slate-string="true">任务描述：</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13299"><span data-slate-object="text" data-key="13300"><span data-slate-leaf="true" data-offset-key="13300:0" data-first-offset="true"><span data-slate-string="true">https://movie.douban.com/cinema/later/beijing/</span></span></span></a><span data-slate-object="text" data-key="13301"><span data-slate-leaf="true" data-offset-key="13301:0" data-first-offset="true"><span data-slate-string="true"> 这个页面描述了北京最近上映的电影，你能否通过 Python 得到这些电影的名称、上映时间和海报呢？这个页面的海报是缩小版的，我希望你能从具体的电影描述页面中抓取到海报。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13302"><span data-slate-object="text" data-key="13303"><span data-slate-leaf="true" data-offset-key="13303:0" data-first-offset="true"><span data-slate-string="true">听起来难度不是很大吧？我在下面给出了同步版本的代码和协程版本的代码，通过运行时间和代码写法的对比，希望你能对协程有更深的了解。（注意：为了突出重点、简化代码，这里我省略了异常处理。）</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13304"><span data-slate-object="text" data-key="13305"><span data-slate-leaf="true" data-offset-key="13305:0" data-first-offset="true"><span data-slate-string="true">不过，在参考我给出的代码之前，你是不是可以自己先动手写一下、跑一下呢？</span></span></span></div><div data-code-language="css" data-slate-type="pre" data-slate-object="block" data-key="13306"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13307"><span data-slate-object="text" data-key="13308"><span data-slate-leaf="true" data-offset-key="13308:0" data-first-offset="true"><span data-slate-string="true">import requests</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13309"><span data-slate-object="text" data-key="13310"><span data-slate-leaf="true" data-offset-key="13310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="13311"><span data-slate-leaf="true" data-offset-key="13311:0" data-first-offset="true"><span data-slate-string="true"> bs4 import BeautifulSoup</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13312"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13313"><span data-slate-object="text" data-key="13314"><span data-slate-leaf="true" data-offset-key="13314:0" data-first-offset="true"><span data-slate-string="true">def </span></span></span><span data-slate-object="text" data-key="13315"><span data-slate-leaf="true" data-offset-key="13315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="13316"><span data-slate-leaf="true" data-offset-key="13316:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13317"><span data-slate-object="text" data-key="13318"><span data-slate-leaf="true" data-offset-key="13318:0" data-first-offset="true"><span data-slate-string="true">    url = </span></span></span><span data-slate-object="text" data-key="13319"><span data-slate-leaf="true" data-offset-key="13319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://movie.douban.com/cinema/later/beijing/"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13320"><span data-slate-object="text" data-key="13321"><span data-slate-leaf="true" data-offset-key="13321:0" data-first-offset="true"><span data-slate-string="true">    init_page = requests.</span></span></span><span data-slate-object="text" data-key="13322"><span data-slate-leaf="true" data-offset-key="13322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="13323"><span data-slate-leaf="true" data-offset-key="13323:0" data-first-offset="true"><span data-slate-string="true">(url).content</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13324"><span data-slate-object="text" data-key="13325"><span data-slate-leaf="true" data-offset-key="13325:0" data-first-offset="true"><span data-slate-string="true">    init_soup = </span></span></span><span data-slate-object="text" data-key="13326"><span data-slate-leaf="true" data-offset-key="13326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BeautifulSoup</span></span></span></span><span data-slate-object="text" data-key="13327"><span data-slate-leaf="true" data-offset-key="13327:0" data-first-offset="true"><span data-slate-string="true">(init_page, </span></span></span><span data-slate-object="text" data-key="13328"><span data-slate-leaf="true" data-offset-key="13328:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'lxml'</span></span></span></span><span data-slate-object="text" data-key="13329"><span data-slate-leaf="true" data-offset-key="13329:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13330"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13331"><span data-slate-object="text" data-key="13332"><span data-slate-leaf="true" data-offset-key="13332:0" data-first-offset="true"><span data-slate-string="true">    all_movies = init_soup.</span></span></span><span data-slate-object="text" data-key="13333"><span data-slate-leaf="true" data-offset-key="13333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find</span></span></span></span><span data-slate-object="text" data-key="13334"><span data-slate-leaf="true" data-offset-key="13334:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13335"><span data-slate-leaf="true" data-offset-key="13335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'div'</span></span></span></span><span data-slate-object="text" data-key="13336"><span data-slate-leaf="true" data-offset-key="13336:0" data-first-offset="true"><span data-slate-string="true">, id=</span></span></span><span data-slate-object="text" data-key="13337"><span data-slate-leaf="true" data-offset-key="13337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"showing-soon"</span></span></span></span><span data-slate-object="text" data-key="13338"><span data-slate-leaf="true" data-offset-key="13338:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13339"><span data-slate-object="text" data-key="13340"><span data-slate-leaf="true" data-offset-key="13340:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    for each_movie in all_movies.</span></span></span></span><span data-slate-object="text" data-key="13341"><span data-slate-leaf="true" data-offset-key="13341:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find_all</span></span></span></span></span><span data-slate-object="text" data-key="13342"><span data-slate-leaf="true" data-offset-key="13342:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="13343"><span data-slate-leaf="true" data-offset-key="13343:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'div'</span></span></span></span></span><span data-slate-object="text" data-key="13344"><span data-slate-leaf="true" data-offset-key="13344:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">, class_=</span></span></span></span><span data-slate-object="text" data-key="13345"><span data-slate-leaf="true" data-offset-key="13345:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"item"</span></span></span></span></span><span data-slate-object="text" data-key="13346"><span data-slate-leaf="true" data-offset-key="13346:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5c3b6081" data-attr-id="38104" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">):</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13347"><span data-slate-object="text" data-key="13348"><span data-slate-leaf="true" data-offset-key="13348:0" data-first-offset="true"><span data-slate-string="true">        all_a_tag = each_movie.</span></span></span><span data-slate-object="text" data-key="13349"><span data-slate-leaf="true" data-offset-key="13349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find_all</span></span></span></span><span data-slate-object="text" data-key="13350"><span data-slate-leaf="true" data-offset-key="13350:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13351"><span data-slate-leaf="true" data-offset-key="13351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'a'</span></span></span></span><span data-slate-object="text" data-key="13352"><span data-slate-leaf="true" data-offset-key="13352:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13353"><span data-slate-object="text" data-key="13354"><span data-slate-leaf="true" data-offset-key="13354:0" data-first-offset="true"><span data-slate-string="true">        all_li_tag = each_movie.</span></span></span><span data-slate-object="text" data-key="13355"><span data-slate-leaf="true" data-offset-key="13355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find_all</span></span></span></span><span data-slate-object="text" data-key="13356"><span data-slate-leaf="true" data-offset-key="13356:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13357"><span data-slate-leaf="true" data-offset-key="13357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'li'</span></span></span></span><span data-slate-object="text" data-key="13358"><span data-slate-leaf="true" data-offset-key="13358:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13359"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13360"><span data-slate-object="text" data-key="13361"><span data-slate-leaf="true" data-offset-key="13361:0" data-first-offset="true"><span data-slate-string="true">        movie_name = all_a_tag[</span></span></span><span data-slate-object="text" data-key="13362"><span data-slate-leaf="true" data-offset-key="13362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13363"><span data-slate-leaf="true" data-offset-key="13363:0" data-first-offset="true"><span data-slate-string="true">].text</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13364"><span data-slate-object="text" data-key="13365"><span data-slate-leaf="true" data-offset-key="13365:0" data-first-offset="true"><span data-slate-string="true">        url_to_fetch = all_a_tag[</span></span></span><span data-slate-object="text" data-key="13366"><span data-slate-leaf="true" data-offset-key="13366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13367"><span data-slate-leaf="true" data-offset-key="13367:0" data-first-offset="true"><span data-slate-string="true">][</span></span></span><span data-slate-object="text" data-key="13368"><span data-slate-leaf="true" data-offset-key="13368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'href'</span></span></span></span><span data-slate-object="text" data-key="13369"><span data-slate-leaf="true" data-offset-key="13369:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13370"><span data-slate-object="text" data-key="13371"><span data-slate-leaf="true" data-offset-key="13371:0" data-first-offset="true"><span data-slate-string="true">        movie_date = all_li_tag[</span></span></span><span data-slate-object="text" data-key="13372"><span data-slate-leaf="true" data-offset-key="13372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="13373"><span data-slate-leaf="true" data-offset-key="13373:0" data-first-offset="true"><span data-slate-string="true">].text</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13374"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13375"><span data-slate-object="text" data-key="13376"><span data-slate-leaf="true" data-offset-key="13376:0" data-first-offset="true"><span data-slate-string="true">        response_item = requests.</span></span></span><span data-slate-object="text" data-key="13377"><span data-slate-leaf="true" data-offset-key="13377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="13378"><span data-slate-leaf="true" data-offset-key="13378:0" data-first-offset="true"><span data-slate-string="true">(url_to_fetch).content</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13379"><span data-slate-object="text" data-key="13380"><span data-slate-leaf="true" data-offset-key="13380:0" data-first-offset="true"><span data-slate-string="true">        soup_item = </span></span></span><span data-slate-object="text" data-key="13381"><span data-slate-leaf="true" data-offset-key="13381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BeautifulSoup</span></span></span></span><span data-slate-object="text" data-key="13382"><span data-slate-leaf="true" data-offset-key="13382:0" data-first-offset="true"><span data-slate-string="true">(response_item, </span></span></span><span data-slate-object="text" data-key="13383"><span data-slate-leaf="true" data-offset-key="13383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'lxml'</span></span></span></span><span data-slate-object="text" data-key="13384"><span data-slate-leaf="true" data-offset-key="13384:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13385"><span data-slate-object="text" data-key="13386"><span data-slate-leaf="true" data-offset-key="13386:0" data-first-offset="true"><span data-slate-string="true">        img_tag = soup_item.</span></span></span><span data-slate-object="text" data-key="13387"><span data-slate-leaf="true" data-offset-key="13387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find</span></span></span></span><span data-slate-object="text" data-key="13388"><span data-slate-leaf="true" data-offset-key="13388:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13389"><span data-slate-leaf="true" data-offset-key="13389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'img'</span></span></span></span><span data-slate-object="text" data-key="13390"><span data-slate-leaf="true" data-offset-key="13390:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13391"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13392"><span data-slate-object="text" data-key="13393"><span data-slate-leaf="true" data-offset-key="13393:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13394"><span data-slate-leaf="true" data-offset-key="13394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="13395"><span data-slate-leaf="true" data-offset-key="13395:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13396"><span data-slate-leaf="true" data-offset-key="13396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'{} {} {}'</span></span></span></span><span data-slate-object="text" data-key="13397"><span data-slate-leaf="true" data-offset-key="13397:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="13398"><span data-slate-leaf="true" data-offset-key="13398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="13399"><span data-slate-leaf="true" data-offset-key="13399:0" data-first-offset="true"><span data-slate-string="true">(movie_name, movie_date, img_tag[</span></span></span><span data-slate-object="text" data-key="13400"><span data-slate-leaf="true" data-offset-key="13400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'src'</span></span></span></span><span data-slate-object="text" data-key="13401"><span data-slate-leaf="true" data-offset-key="13401:0" data-first-offset="true"><span data-slate-string="true">]))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13402"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13403"><span data-slate-object="text" data-key="13404"><span data-slate-leaf="true" data-offset-key="13404:0" data-first-offset="true"><span data-slate-string="true">%time </span></span></span><span data-slate-object="text" data-key="13405"><span data-slate-leaf="true" data-offset-key="13405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="13406"><span data-slate-leaf="true" data-offset-key="13406:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13407"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13408"><span data-slate-object="text" data-key="13409"><span data-slate-leaf="true" data-offset-key="13409:0" data-first-offset="true"><span data-slate-string="true">########## 输出 ##########</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13410"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13411"><span data-slate-object="text" data-key="13412"><span data-slate-leaf="true" data-offset-key="13412:0" data-first-offset="true"><span data-slate-string="true">阿拉丁 </span></span></span><span data-slate-object="text" data-key="13413"><span data-slate-leaf="true" data-offset-key="13413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">05</span></span></span></span><span data-slate-object="text" data-key="13414"><span data-slate-leaf="true" data-offset-key="13414:0" data-first-offset="true"><span data-slate-string="true"> 月</span></span></span><span data-slate-object="text" data-key="13415"><span data-slate-leaf="true" data-offset-key="13415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13416"><span data-slate-leaf="true" data-offset-key="13416:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2553992741.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13417"><span data-slate-object="text" data-key="13418"><span data-slate-leaf="true" data-offset-key="13418:0" data-first-offset="true"><span data-slate-string="true">龙珠超：布罗利 </span></span></span><span data-slate-object="text" data-key="13419"><span data-slate-leaf="true" data-offset-key="13419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">05</span></span></span></span><span data-slate-object="text" data-key="13420"><span data-slate-leaf="true" data-offset-key="13420:0" data-first-offset="true"><span data-slate-string="true"> 月</span></span></span><span data-slate-object="text" data-key="13421"><span data-slate-leaf="true" data-offset-key="13421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13422"><span data-slate-leaf="true" data-offset-key="13422:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2557371503.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13423"><span data-slate-object="text" data-key="13424"><span data-slate-leaf="true" data-offset-key="13424:0" data-first-offset="true"><span data-slate-string="true">五月天人生无限公司 </span></span></span><span data-slate-object="text" data-key="13425"><span data-slate-leaf="true" data-offset-key="13425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">05</span></span></span></span><span data-slate-object="text" data-key="13426"><span data-slate-leaf="true" data-offset-key="13426:0" data-first-offset="true"><span data-slate-string="true"> 月</span></span></span><span data-slate-object="text" data-key="13427"><span data-slate-leaf="true" data-offset-key="13427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13428"><span data-slate-leaf="true" data-offset-key="13428:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2554324453.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13429"><span data-slate-object="text" data-key="13430"><span data-slate-leaf="true" data-offset-key="13430:0" data-first-offset="true"><span data-slate-string="true">... ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13431"><span data-slate-object="text" data-key="13432"><span data-slate-leaf="true" data-offset-key="13432:0" data-first-offset="true"><span data-slate-string="true">直播攻略 </span></span></span><span data-slate-object="text" data-key="13433"><span data-slate-leaf="true" data-offset-key="13433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">06</span></span></span></span><span data-slate-object="text" data-key="13434"><span data-slate-leaf="true" data-offset-key="13434:0" data-first-offset="true"><span data-slate-string="true"> 月</span></span></span><span data-slate-object="text" data-key="13435"><span data-slate-leaf="true" data-offset-key="13435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 04</span></span></span></span><span data-slate-object="text" data-key="13436"><span data-slate-leaf="true" data-offset-key="13436:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2555957974.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13437"><span data-slate-object="text" data-key="13438"><span data-slate-leaf="true" data-offset-key="13438:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="13439"><span data-slate-leaf="true" data-offset-key="13439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">56.6</span></span></span></span><span data-slate-object="text" data-key="13440"><span data-slate-leaf="true" data-offset-key="13440:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="python" data-slate-type="pre" data-slate-object="block" data-key="13441"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13442"><span data-slate-object="text" data-key="13443"><span data-slate-leaf="true" data-offset-key="13443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="13444"><span data-slate-leaf="true" data-offset-key="13444:0" data-first-offset="true"><span data-slate-string="true"> asyncio</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13445"><span data-slate-object="text" data-key="13446"><span data-slate-leaf="true" data-offset-key="13446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="13447"><span data-slate-leaf="true" data-offset-key="13447:0" data-first-offset="true"><span data-slate-string="true"> aiohttp</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13448"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13449"><span data-slate-object="text" data-key="13450"><span data-slate-leaf="true" data-offset-key="13450:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">from</span></span></span></span><span data-slate-object="text" data-key="13451"><span data-slate-leaf="true" data-offset-key="13451:0" data-first-offset="true"><span data-slate-string="true"> bs4 </span></span></span><span data-slate-object="text" data-key="13452"><span data-slate-leaf="true" data-offset-key="13452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">import</span></span></span></span><span data-slate-object="text" data-key="13453"><span data-slate-leaf="true" data-offset-key="13453:0" data-first-offset="true"><span data-slate-string="true"> BeautifulSoup</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13454"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13455"><span data-slate-object="text" data-key="13456"><span data-slate-leaf="true" data-offset-key="13456:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span></span><span data-slate-object="text" data-key="13457"><span data-slate-leaf="true" data-offset-key="13457:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13458"><span data-slate-leaf="true" data-offset-key="13458:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span></span><span data-slate-object="text" data-key="13459"><span data-slate-leaf="true" data-offset-key="13459:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13460"><span data-slate-leaf="true" data-offset-key="13460:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fetch_content</span></span></span></span></span><span data-slate-object="text" data-key="13461"><span data-slate-leaf="true" data-offset-key="13461:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">(</span></span></span></span><span data-slate-object="text" data-key="13462"><span data-slate-leaf="true" data-offset-key="13462:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">url</span></span></span></span></span><span data-slate-object="text" data-key="13463"><span data-slate-leaf="true" data-offset-key="13463:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eaf0b704" data-attr-id="24253" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">):</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13464"><span data-slate-object="text" data-key="13465"><span data-slate-leaf="true" data-offset-key="13465:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c4142a32" data-attr-id="24255" data-attr-name="public" data-annotation-type="public"><span data-slate-object="annotation" data-annotation-key="gkann_17c9b98d" data-attr-id="24254" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    </span></span></span></span></span><span data-slate-object="text" data-key="13466"><span data-slate-leaf="true" data-offset-key="13466:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c4142a32" data-attr-id="24255" data-attr-name="public" data-annotation-type="public"><span data-slate-object="annotation" data-annotation-key="gkann_17c9b98d" data-attr-id="24254" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span></span></span><span data-slate-object="text" data-key="13467"><span data-slate-leaf="true" data-offset-key="13467:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c4142a32" data-attr-id="24255" data-attr-name="public" data-annotation-type="public"><span data-slate-object="annotation" data-annotation-key="gkann_17c9b98d" data-attr-id="24254" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> </span></span></span></span></span><span data-slate-object="text" data-key="13468"><span data-slate-leaf="true" data-offset-key="13468:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c4142a32" data-attr-id="24255" data-attr-name="public" data-annotation-type="public"><span data-slate-object="annotation" data-annotation-key="gkann_17c9b98d" data-attr-id="24254" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">with</span></span></span></span></span></span><span data-slate-object="text" data-key="13469"><span data-slate-leaf="true" data-offset-key="13469:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c4142a32" data-attr-id="24255" data-attr-name="public" data-annotation-type="public"><span data-slate-object="annotation" data-annotation-key="gkann_17c9b98d" data-attr-id="24254" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> aiohttp.ClientSession(</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13470"><span data-slate-object="text" data-key="13471"><span data-slate-leaf="true" data-offset-key="13471:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_342b3a99" data-attr-id="24256" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">        headers=header, connector=aiohttp.TCPConnector(ssl=</span></span></span></span><span data-slate-object="text" data-key="13472"><span data-slate-leaf="true" data-offset-key="13472:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_342b3a99" data-attr-id="24256" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">False</span></span></span></span></span><span data-slate-object="text" data-key="13473"><span data-slate-leaf="true" data-offset-key="13473:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_342b3a99" data-attr-id="24256" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13474"><span data-slate-object="text" data-key="13475"><span data-slate-leaf="true" data-offset-key="13475:0" data-first-offset="true"><span data-slate-string="true">    ) </span></span></span><span data-slate-object="text" data-key="13476"><span data-slate-leaf="true" data-offset-key="13476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="13477"><span data-slate-leaf="true" data-offset-key="13477:0" data-first-offset="true"><span data-slate-string="true"> session:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13478"><span data-slate-object="text" data-key="13479"><span data-slate-leaf="true" data-offset-key="13479:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13480"><span data-slate-leaf="true" data-offset-key="13480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13481"><span data-slate-leaf="true" data-offset-key="13481:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13482"><span data-slate-leaf="true" data-offset-key="13482:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">with</span></span></span></span><span data-slate-object="text" data-key="13483"><span data-slate-leaf="true" data-offset-key="13483:0" data-first-offset="true"><span data-slate-string="true"> session.get(url) </span></span></span><span data-slate-object="text" data-key="13484"><span data-slate-leaf="true" data-offset-key="13484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">as</span></span></span></span><span data-slate-object="text" data-key="13485"><span data-slate-leaf="true" data-offset-key="13485:0" data-first-offset="true"><span data-slate-string="true"> response:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13486"><span data-slate-object="text" data-key="13487"><span data-slate-leaf="true" data-offset-key="13487:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="13488"><span data-slate-leaf="true" data-offset-key="13488:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13489"><span data-slate-leaf="true" data-offset-key="13489:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13490"><span data-slate-leaf="true" data-offset-key="13490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13491"><span data-slate-leaf="true" data-offset-key="13491:0" data-first-offset="true"><span data-slate-string="true"> response.text()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13492"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13493"><span data-slate-object="text" data-key="13494"><span data-slate-leaf="true" data-offset-key="13494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">async</span></span></span></span><span data-slate-object="text" data-key="13495"><span data-slate-leaf="true" data-offset-key="13495:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13496"><span data-slate-leaf="true" data-offset-key="13496:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">def</span></span></span></span><span data-slate-object="text" data-key="13497"><span data-slate-leaf="true" data-offset-key="13497:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13498"><span data-slate-leaf="true" data-offset-key="13498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="13499"><span data-slate-leaf="true" data-offset-key="13499:0" data-first-offset="true"><span data-slate-string="true">():</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13500"><span data-slate-object="text" data-key="13501"><span data-slate-leaf="true" data-offset-key="13501:0" data-first-offset="true"><span data-slate-string="true">    url = </span></span></span><span data-slate-object="text" data-key="13502"><span data-slate-leaf="true" data-offset-key="13502:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://movie.douban.com/cinema/later/beijing/"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13503"><span data-slate-object="text" data-key="13504"><span data-slate-leaf="true" data-offset-key="13504:0" data-first-offset="true"><span data-slate-string="true">    init_page = </span></span></span><span data-slate-object="text" data-key="13505"><span data-slate-leaf="true" data-offset-key="13505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13506"><span data-slate-leaf="true" data-offset-key="13506:0" data-first-offset="true"><span data-slate-string="true"> fetch_content(url)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13507"><span data-slate-object="text" data-key="13508"><span data-slate-leaf="true" data-offset-key="13508:0" data-first-offset="true"><span data-slate-string="true">    init_soup = BeautifulSoup(init_page, </span></span></span><span data-slate-object="text" data-key="13509"><span data-slate-leaf="true" data-offset-key="13509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'lxml'</span></span></span></span><span data-slate-object="text" data-key="13510"><span data-slate-leaf="true" data-offset-key="13510:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13511"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13512"><span data-slate-object="text" data-key="13513"><span data-slate-leaf="true" data-offset-key="13513:0" data-first-offset="true"><span data-slate-string="true">    movie_names, urls_to_fetch, movie_dates = [], [], []</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13514"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13515"><span data-slate-object="text" data-key="13516"><span data-slate-leaf="true" data-offset-key="13516:0" data-first-offset="true"><span data-slate-string="true">    all_movies = init_soup.find(</span></span></span><span data-slate-object="text" data-key="13517"><span data-slate-leaf="true" data-offset-key="13517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'div'</span></span></span></span><span data-slate-object="text" data-key="13518"><span data-slate-leaf="true" data-offset-key="13518:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13519"><span data-slate-leaf="true" data-offset-key="13519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span><span data-slate-object="text" data-key="13520"><span data-slate-leaf="true" data-offset-key="13520:0" data-first-offset="true"><span data-slate-string="true">=</span></span></span><span data-slate-object="text" data-key="13521"><span data-slate-leaf="true" data-offset-key="13521:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"showing-soon"</span></span></span></span><span data-slate-object="text" data-key="13522"><span data-slate-leaf="true" data-offset-key="13522:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13523"><span data-slate-object="text" data-key="13524"><span data-slate-leaf="true" data-offset-key="13524:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13525"><span data-slate-leaf="true" data-offset-key="13525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="13526"><span data-slate-leaf="true" data-offset-key="13526:0" data-first-offset="true"><span data-slate-string="true"> each_movie </span></span></span><span data-slate-object="text" data-key="13527"><span data-slate-leaf="true" data-offset-key="13527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="13528"><span data-slate-leaf="true" data-offset-key="13528:0" data-first-offset="true"><span data-slate-string="true"> all_movies.find_all(</span></span></span><span data-slate-object="text" data-key="13529"><span data-slate-leaf="true" data-offset-key="13529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'div'</span></span></span></span><span data-slate-object="text" data-key="13530"><span data-slate-leaf="true" data-offset-key="13530:0" data-first-offset="true"><span data-slate-string="true">, class_=</span></span></span><span data-slate-object="text" data-key="13531"><span data-slate-leaf="true" data-offset-key="13531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"item"</span></span></span></span><span data-slate-object="text" data-key="13532"><span data-slate-leaf="true" data-offset-key="13532:0" data-first-offset="true"><span data-slate-string="true">):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13533"><span data-slate-object="text" data-key="13534"><span data-slate-leaf="true" data-offset-key="13534:0" data-first-offset="true"><span data-slate-string="true">        all_a_tag = each_movie.find_all(</span></span></span><span data-slate-object="text" data-key="13535"><span data-slate-leaf="true" data-offset-key="13535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'a'</span></span></span></span><span data-slate-object="text" data-key="13536"><span data-slate-leaf="true" data-offset-key="13536:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13537"><span data-slate-object="text" data-key="13538"><span data-slate-leaf="true" data-offset-key="13538:0" data-first-offset="true"><span data-slate-string="true">        all_li_tag = each_movie.find_all(</span></span></span><span data-slate-object="text" data-key="13539"><span data-slate-leaf="true" data-offset-key="13539:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'li'</span></span></span></span><span data-slate-object="text" data-key="13540"><span data-slate-leaf="true" data-offset-key="13540:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13541"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13542"><span data-slate-object="text" data-key="13543"><span data-slate-leaf="true" data-offset-key="13543:0" data-first-offset="true"><span data-slate-string="true">        movie_names.append(all_a_tag[</span></span></span><span data-slate-object="text" data-key="13544"><span data-slate-leaf="true" data-offset-key="13544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13545"><span data-slate-leaf="true" data-offset-key="13545:0" data-first-offset="true"><span data-slate-string="true">].text)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13546"><span data-slate-object="text" data-key="13547"><span data-slate-leaf="true" data-offset-key="13547:0" data-first-offset="true"><span data-slate-string="true">        urls_to_fetch.append(all_a_tag[</span></span></span><span data-slate-object="text" data-key="13548"><span data-slate-leaf="true" data-offset-key="13548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="13549"><span data-slate-leaf="true" data-offset-key="13549:0" data-first-offset="true"><span data-slate-string="true">][</span></span></span><span data-slate-object="text" data-key="13550"><span data-slate-leaf="true" data-offset-key="13550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'href'</span></span></span></span><span data-slate-object="text" data-key="13551"><span data-slate-leaf="true" data-offset-key="13551:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13552"><span data-slate-object="text" data-key="13553"><span data-slate-leaf="true" data-offset-key="13553:0" data-first-offset="true"><span data-slate-string="true">        movie_dates.append(all_li_tag[</span></span></span><span data-slate-object="text" data-key="13554"><span data-slate-leaf="true" data-offset-key="13554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="13555"><span data-slate-leaf="true" data-offset-key="13555:0" data-first-offset="true"><span data-slate-string="true">].text)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13556"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13557"><span data-slate-object="text" data-key="13558"><span data-slate-leaf="true" data-offset-key="13558:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e025a052" data-attr-id="37359" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    tasks = [fetch_content(url) </span></span></span></span><span data-slate-object="text" data-key="13559"><span data-slate-leaf="true" data-offset-key="13559:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e025a052" data-attr-id="37359" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span></span><span data-slate-object="text" data-key="13560"><span data-slate-leaf="true" data-offset-key="13560:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e025a052" data-attr-id="37359" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> url </span></span></span></span><span data-slate-object="text" data-key="13561"><span data-slate-leaf="true" data-offset-key="13561:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e025a052" data-attr-id="37359" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span></span><span data-slate-object="text" data-key="13562"><span data-slate-leaf="true" data-offset-key="13562:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e025a052" data-attr-id="37359" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> urls_to_fetch]</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13563"><span data-slate-object="text" data-key="13564"><span data-slate-leaf="true" data-offset-key="13564:0" data-first-offset="true"><span data-slate-string="true">    pages = </span></span></span><span data-slate-object="text" data-key="13565"><span data-slate-leaf="true" data-offset-key="13565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">await</span></span></span></span><span data-slate-object="text" data-key="13566"><span data-slate-leaf="true" data-offset-key="13566:0" data-first-offset="true"><span data-slate-string="true"> asyncio.gather(*tasks)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13567"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13568"><span data-slate-object="text" data-key="13569"><span data-slate-leaf="true" data-offset-key="13569:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13570"><span data-slate-leaf="true" data-offset-key="13570:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="13571"><span data-slate-leaf="true" data-offset-key="13571:0" data-first-offset="true"><span data-slate-string="true"> movie_name, movie_date, page </span></span></span><span data-slate-object="text" data-key="13572"><span data-slate-leaf="true" data-offset-key="13572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">in</span></span></span></span><span data-slate-object="text" data-key="13573"><span data-slate-leaf="true" data-offset-key="13573:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13574"><span data-slate-leaf="true" data-offset-key="13574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">zip</span></span></span></span><span data-slate-object="text" data-key="13575"><span data-slate-leaf="true" data-offset-key="13575:0" data-first-offset="true"><span data-slate-string="true">(movie_names, movie_dates, pages):</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13576"><span data-slate-object="text" data-key="13577"><span data-slate-leaf="true" data-offset-key="13577:0" data-first-offset="true"><span data-slate-string="true">        soup_item = BeautifulSoup(page, </span></span></span><span data-slate-object="text" data-key="13578"><span data-slate-leaf="true" data-offset-key="13578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'lxml'</span></span></span></span><span data-slate-object="text" data-key="13579"><span data-slate-leaf="true" data-offset-key="13579:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13580"><span data-slate-object="text" data-key="13581"><span data-slate-leaf="true" data-offset-key="13581:0" data-first-offset="true"><span data-slate-string="true">        img_tag = soup_item.find(</span></span></span><span data-slate-object="text" data-key="13582"><span data-slate-leaf="true" data-offset-key="13582:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'img'</span></span></span></span><span data-slate-object="text" data-key="13583"><span data-slate-leaf="true" data-offset-key="13583:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13584"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13585"><span data-slate-object="text" data-key="13586"><span data-slate-leaf="true" data-offset-key="13586:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="13587"><span data-slate-leaf="true" data-offset-key="13587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">print</span></span></span></span><span data-slate-object="text" data-key="13588"><span data-slate-leaf="true" data-offset-key="13588:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="13589"><span data-slate-leaf="true" data-offset-key="13589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'{} {} {}'</span></span></span></span><span data-slate-object="text" data-key="13590"><span data-slate-leaf="true" data-offset-key="13590:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="13591"><span data-slate-leaf="true" data-offset-key="13591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">format</span></span></span></span><span data-slate-object="text" data-key="13592"><span data-slate-leaf="true" data-offset-key="13592:0" data-first-offset="true"><span data-slate-string="true">(movie_name, movie_date, img_tag[</span></span></span><span data-slate-object="text" data-key="13593"><span data-slate-leaf="true" data-offset-key="13593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'src'</span></span></span></span><span data-slate-object="text" data-key="13594"><span data-slate-leaf="true" data-offset-key="13594:0" data-first-offset="true"><span data-slate-string="true">]))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13595"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13596"><span data-slate-object="text" data-key="13597"><span data-slate-leaf="true" data-offset-key="13597:0" data-first-offset="true"><span data-slate-string="true">%time asyncio.run(main())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13598"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13599"><span data-slate-object="text" data-key="13600"><span data-slate-leaf="true" data-offset-key="13600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">########## 输出 ##########</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13601"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13602"><span data-slate-object="text" data-key="13603"><span data-slate-leaf="true" data-offset-key="13603:0" data-first-offset="true"><span data-slate-string="true">阿拉丁 05 月</span></span></span><span data-slate-object="text" data-key="13604"><span data-slate-leaf="true" data-offset-key="13604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13605"><span data-slate-leaf="true" data-offset-key="13605:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2553992741.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13606"><span data-slate-object="text" data-key="13607"><span data-slate-leaf="true" data-offset-key="13607:0" data-first-offset="true"><span data-slate-string="true">龙珠超：布罗利 05 月</span></span></span><span data-slate-object="text" data-key="13608"><span data-slate-leaf="true" data-offset-key="13608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13609"><span data-slate-leaf="true" data-offset-key="13609:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2557371503.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13610"><span data-slate-object="text" data-key="13611"><span data-slate-leaf="true" data-offset-key="13611:0" data-first-offset="true"><span data-slate-string="true">五月天人生无限公司 05 月</span></span></span><span data-slate-object="text" data-key="13612"><span data-slate-leaf="true" data-offset-key="13612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> 24</span></span></span></span><span data-slate-object="text" data-key="13613"><span data-slate-leaf="true" data-offset-key="13613:0" data-first-offset="true"><span data-slate-string="true"> 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2554324453.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13614"><span data-slate-object="text" data-key="13615"><span data-slate-leaf="true" data-offset-key="13615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">... </span></span></span></span><span data-slate-object="text" data-key="13616"><span data-slate-leaf="true" data-offset-key="13616:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13617"><span data-slate-object="text" data-key="13618"><span data-slate-leaf="true" data-offset-key="13618:0" data-first-offset="true"><span data-slate-string="true">直播攻略 06 月 04 日 https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2555957974.jpg</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13619"><span data-slate-object="text" data-key="13620"><span data-slate-leaf="true" data-offset-key="13620:0" data-first-offset="true"><span data-slate-string="true">Wall time: </span></span></span><span data-slate-object="text" data-key="13621"><span data-slate-leaf="true" data-offset-key="13621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4.98</span></span></span></span><span data-slate-object="text" data-key="13622"><span data-slate-leaf="true" data-offset-key="13622:0" data-first-offset="true"><span data-slate-string="true"> s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13623" id="sr-toc-4"><span data-slate-object="text" data-key="13624"><span data-slate-leaf="true" data-offset-key="13624:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13625"><span data-slate-object="text" data-key="13626"><span data-slate-leaf="true" data-offset-key="13626:0" data-first-offset="true"><span data-slate-string="true">到这里，今天的主要内容就讲完了。今天我用了较长的篇幅，从一个简单的爬虫开始，到一个真正的爬虫结束，在中间穿插讲解了 Python 协程最新的基本概念和用法。这里带你简单复习一下。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13627"><div data-slate-type="list-line" data-slate-object="block" data-key="13628"><span data-slate-object="text" data-key="13629"><span data-slate-leaf="true" data-offset-key="13629:0" data-first-offset="true"><span data-slate-string="true">协程和多线程的区别，主要在于两点，</span></span><span data-slate-leaf="true" data-offset-key="13629:1"><span data-slate-object="annotation" data-annotation-key="gkann_cea67692" data-attr-id="10273" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">一是协程为单线程；二是协程由用户决定，在哪些地方交出控制权，</span></span></span><span data-slate-leaf="true" data-offset-key="13629:2"><span data-slate-string="true">切换到下一个任务。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13630"><span data-slate-object="text" data-key="13631"><span data-slate-leaf="true" data-offset-key="13631:0" data-first-offset="true"><span data-slate-string="true">协程的写法更加简洁清晰，把 async /await 语法和 create_task 结合来用，</span></span><span data-slate-leaf="true" data-offset-key="13631:1"><span data-slate-object="annotation" data-annotation-key="gkann_ef2cfce3" data-attr-id="25127" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">对于中小级别的并发需求已经毫无压力。</span></span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13632"><span data-slate-object="text" data-key="13633"><span data-slate-leaf="true" data-offset-key="13633:0" data-first-offset="true"><span data-slate-string="true">写协程程序的时候，</span></span><span data-slate-leaf="true" data-offset-key="13633:1"><span data-slate-object="annotation" data-annotation-key="gkann_5cacc00c" data-attr-id="25128" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">你的脑海中要有清晰的事件循环概念，知道程序在什么时候需要暂停、等待 I/O，什么时候需要一并执行到底。</span></span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13634"><span data-slate-object="text" data-key="13635"><span data-slate-leaf="true" data-offset-key="13635:0" data-first-offset="true"><span data-slate-string="true">最后的最后，请一定不要轻易炫技。多线程模型也一定有其优点，一个真正牛逼的程序员，应该懂得，在什么时候用什么模型能达到工程上的最优，而不是自觉某个技术非常牛逼，所有项目创造条件也要上。</span></span><span data-slate-leaf="true" data-offset-key="13635:1"><span data-slate-object="annotation" data-annotation-key="gkann_f3beb1ce" data-attr-id="39962" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">技术是工程，而工程则是时间、资源、人力等纷繁复杂的事情的折衷。</span></span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13636" id="sr-toc-5"><span data-slate-object="text" data-key="13637"><span data-slate-leaf="true" data-offset-key="13637:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13638"><span data-slate-object="text" data-key="13639"><span data-slate-leaf="true" data-offset-key="13639:0" data-first-offset="true"><span data-slate-string="true">最后给你留一个思考题。</span></span><span data-slate-leaf="true" data-offset-key="13639:1"><span data-slate-object="annotation" data-annotation-key="gkann_637051e6" data-attr-id="39621" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">协程怎么实现回调函数呢？欢迎留言和我讨论，</span></span></span><span data-slate-leaf="true" data-offset-key="13639:2"><span data-slate-string="true">也欢迎你把这篇文章分享给你的同事朋友，我们一起交流，一起进步。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>27</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-6">精选留言 (120)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132"></div></div><div><div><div><span>Jingxiao</span></div><span>置顶</span></div><div>发现评论区好多朋友说无法运行，在这里统一解释下：
1. % time 是 jupyter notebook 自带的语法糖，用来统计一行命令的运行时间；如果你的运行时是纯粹的命令行 python，或者 pycharm，那么请把 % time 删掉，自己用传统的时间戳方法来记录时间也可以；或者使用 jupyter notebook
2. 我的本地解释器是 Anaconda Python 3.7.3，亲测 windows /ubuntu 均可正常运行，如无法执行可以试试 pip install nest-asyncio，依然无法解决请尝试安装 Anaconda Python
3. 这次代码因为使用了较新的 API，所以需要较新的版本号，但是朋友们依然出现了一些运行时问题，这里先表示下歉意；同时也想说明的是，在提问之前自己经过充分搜索，尝试后解决问题，带来的快感，和能力的提升，相应也是很大的，一门工程最需要的是 hands on dirty work（动手做脏活），才能让自己的能力得到本质的提升，加油！</div><div><div>2019-06-25</div><div><div><i></i><span>10</span></div><div><i></i><span>70</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132"></div></div><div><div><div><span>Jingxiao</span></div><span>置顶</span></div><div>思考题答案：

在 python 3.7 及以上的版本中，我们对 task 对象调用 add_done_callback () 函数，即可绑定特定回调函数。回调函数接受一个 future 对象，可以通过 future.result () 来获取协程函数的返回值。

示例如下：

import asyncio

async def crawl_page (url):
    print ('crawling {}'.format (url))
    sleep_time = int (url.split ('_')[-1])
    await asyncio.sleep (sleep_time)
    return 'OK {}'.format (url)

async def main (urls):
    tasks = [asyncio.create_task (crawl_page (url)) for url in urls]
    for task in tasks:
        task.add_done_callback (lambda future: print ('result:', future.result ()))
    await asyncio.gather (*tasks)

% time asyncio.run (main (['url_1', 'url_2', 'url_3', 'url_4']))

输出：

crawling url_1
crawling url_2
crawling url_3
crawling url_4
result:  OK url_1
result:  OK url_2
result:  OK url_3
result:  OK url_4
Wall time: 4 s</div><div><div>2019-07-01</div><div><div><i></i><span></span></div><div><i></i><span>35</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>helloworld</span></div></div><div>说一下我对 await 的理解：
开发者要提前知道一个任务的哪个环节会造成 I/O 阻塞，然后把这个环节的代码异步化处理，并且通过 await 来标识在任务的该环节中断该任务执行，从而去执行下一个事件循环任务。这样可以充分利用 CPU 资源，避免 CPU 等待 I/O 造成 CPU 资源白白浪费。当之前任务的那个环节的 I/O 完成后，线程可以从 await 获取返回值，然后继续执行没有完成的剩余代码。
由上面分析可知，如果一个任务不涉及到网络或磁盘 I/O 这种耗时的操作，而只有 CPU 计算和内存 I/O 的操作时，协程并发的性能还不如单线程 loop 循环的性能高。</div><div><div>2019-06-27</div><div><div><i></i><span>6</span></div><div><i></i><span>57</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/77/da/54c663f3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Wing ・三金</span></div></div><div>思考题：简单的理解是每个新建的协程对象都会自动调用 add_done_callback () 函数来添加一个回调函数，当协程对象的 Future 状态启动时就会调用该回调函数，从而实现回调。

综合下前面的留言和个人的学习，总结下 py 3.6 版本下 asyncio 的主要不同：
1、没有 run (), create_task ()，可以用 asyncio.get_even_loop ().run_until_complete () 来代替 run ()，用 ensure_future () 来代替 create_task ()；
2、可能会出现 RuntimeError: This event loop is already running，解决方案一：pip install nest_asyncio; import nest_asyncio; nest_asyncio.apply ()；解决方案二：有些友人说是 tornado 5.x 起的版本才有此问题，可考虑将其版本降至 4.x（不推荐）；
3、% time 与 %% time 的主要区别：% time func ()（必须是同一行）；%% time 必须放在单元格的开头，强烈建议单独一行 + 不要与 import、def 相关的语句放在同个单元格；
4、爬虫中的 aiohttp.ClientSession (headers=header, connector=aiohttp.TCPConnector (ssl=False)) 提及未声明的 header，要么将 headers=header 部分去掉使用默认参数，要么用诸如 header={"User-Agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.157 Safari/537.36"} 来显式声明；
5、tasks = [asyncio.create_task (crawl_page (url)) for url in urls]; await asyncio.gather (*tasks); 
约等于
tasks = [crawl_page (url) for url in urls]; asyncio.get_even_loop ().run_until_complete (asyncio.wait (tasks));
或
tasks = [asyncio.ensure_future (crawl_page (url)) for url in urls]; await asyncio.gather (*tasks);</div><div><div>2019-06-27</div><div><div><i></i><span>1</span></div><div><i></i><span>36</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/4e/07/78441c2b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 大侠 110</span></div></div><div>感觉还是有很多人看不懂，我试着用通俗的语句讲一下：协成里面重要的是一个关键字 await 的理解，async 表示其修饰的是协程任务即 task，await 表示的是当线程执行到这一句，此时该 task 在此处挂起，然后调度器去执行其他的 task，当这个挂起的部分处理完，会调用回掉函数告诉调度器我已经执行完了，那么调度器就返回来处理这个 task 的余下语句。
      </div><div><div>2019-12-03</div><div><div><i></i><span>1</span></div><div><i></i><span>34</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/f6/4e/0066303c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>cuikt</span></div></div><div>在代码 async with aiohttp.ClientSession (headers=header, connector=aiohttp.TCPConnector (ssl=False)) as session: 中的 headers=header 需要定义 header 为一个字典可以像下面这样，否则会报错。
header={"User-Agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.157 Safari/537.36"}</div><div><div>2019-06-25</div><div><div><i></i><span>1</span></div><div><i></i><span>20</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/78/e8/b79240e8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>rogerr</span></div></div><div>目前看到进阶篇就很痛苦了，对于小白来说，基础篇还好理解，到这儿就对深层次的知识无法深入理解和实践，感觉渐行渐远，不知道如何深入下去</div><div><div>2019-06-25</div><div><div><i></i><span>7</span></div><div><i></i><span>16</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>tt</span></div></div><div>学习笔记：异步和阻塞。

阻塞主要是同步编程中的概念：执行一个系统调用，如果暂时没有返回结果，这个调用就不会返回，那这个系统调用后面的应用代码也不会执行，整个应用被 “阻塞” 了。

同步编程也可以有非阻塞的方式，在系统调用没有完成时直接返回一个错误码。

异步调用是系统调用完成后返回应用一个消息，应用响应消息，获取结果。

上面说的系统调用 对应 Python 中的异步函数 —— 一个需要执行较长时间的任务。响应消息应该对应回调函数，但我觉得 await 异步函数返回本身就相当于系统告知应用系统调用完成了，后面的代码起码可以完成部分回调函数做的事情。

阻塞和异步必须配合才能完成异步编程。

1、await 异步函数会造成阻塞；
2、await 一个 task 不会造成阻塞，但是 task 对应的异步函数中必定几乎 await 一个异步函数，这个异步函数会阻塞这个 task 的执行，这样其余 task 才能被事件调度器的调度从而获取执行机会。</div><div><div>2019-06-24</div><div><div><i></i><span>2</span></div><div><i></i><span>10</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/15/e0/d4/bdd3ed27.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>converse✪</span></div></div><div>#coding:utf-8
import asyncio
import time

async def corou1 ():
    print ("corou 1, {}".format (time.perf_counter ()))
    await asyncio.sleep (2) 
    print ("corou 1, {}".format (time.perf_counter ()))
    
async def corou2 ():
    print ("corou 2, {}".format (time.perf_counter ()))
    # await asyncio.sleep (2)
    time.sleep (5) 
    print ("corou 2, {}".format (time.perf_counter ()))

async def corou3 ():
    print ("corou 3, {}".format (time.perf_counter ()))
    await asyncio.sleep (2) 
    print ("corou 3, {}".format (time.perf_counter ()))

async def main ():
    tasks = [asyncio.create_task (corou ()) for corou in [corou1,corou2,corou3] ]
    await asyncio.gather (*tasks)

if __name__ == "__main__":
    asyncio.run (main ())
########### 执行结果 ############
func 1, 0.3864962
func 2, 0.3866095
func 2, 5.386688
func 3, 5.387335
func 1, 5.3877248
func 3, 7.3883411

通过上述例子可以看出，协程 corou1，corou2，corou3 的执行顺序按照加入循环事件的顺序。协程 corou1 通过 await asyncio.sleep (2) 让出控制权，协程 corou2 由于没有 await 让出控制权所以一直在执行。当 corou2 结束后，很显然 corou1 也已经执行完，但还是先执行协程 corou3，等协程 corou3 通过 await 让出控制权后，协程 corou1 才执行。

从上可以看出：
- 协程是按照事件循环顺序执行。即使交出控制权的协程执行完毕任务后等待再次获取控制权完成剩余任务，也必须等到循环到该协程才能获得 CPU 控制权。不会由于该协程已经完成 await 的任务而直接给它。这就是解释，协程 corou2 执行完会继续执行协程 corou3，而并非继续执行协程 corou1。
- await 是交出协程控制权的地方
- 从上述代码可以看出，协程中当执行耗时 IO 操作时，应及时释放控制权，否则其他协程即便完成任务也由于没有 CPU 控制权而无法继续执行任务。</div><div><div>2019-07-09</div><div><div><i></i><span></span></div><div><i></i><span>7</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1d/92/fb/4c06bcef.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Airnm. 毁</span></div></div><div>豆瓣那个发现 requests.get (url).content/text 返回都为空，然后打了下 status_code 发现是 418，网上找 418 的解释，一般是网站反爬虫基础机制，需要加请求头模仿浏览器就可跳过，改为下面的样子就可通过：url = "https://movie.douban.com/cinema/later/beijing/"
head={
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36',
    'Referer':'https://time.geekbang.org/column/article/101855',
    'Connection':'keep-alive'}
res = requests.get (url,headers=head)</div><div><p>作者回复: 👍，可能是增加了反爬虫机制
</p></div><div><div>2020-04-18</div><div><div><i></i><span>2</span></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fergus</span></div></div><div># -*- encoding: utf-8 -*-
'''
aiohttp + aysncio 爬取电豆瓣电影
py 3.6
sublime text3
'''


import time
import aiohttp
import asyncio
from bs4 import BeautifulSoup

now = lambda: time.perf_counter ()

async def fetchHtmlText (url):
    async with aiohttp.ClientSession (
        headers={'users-agent':'Mozilla/5.0'}, 
        connector=aiohttp.TCPConnector (ssl=False)) as session:
        async with session.get (url) as response:
            return await response.text ()

async def main ():
    url = "https://movie.douban.com/cinema/later/beijing/"
    html = await fetchHtmlText (url)
    soup = BeautifulSoup (html, "html.parser")

    divs = soup.find_all ('div', class_='item mod')
    urls = list (map (lambda x: x.a.img ['src'], divs))
    names = list (map (lambda x: x.h3.a.string, divs))
    dats = list (map (lambda x: x.ul.li.string, divs))

    lis = zip (names, dats, urls)
    for i in lis:
        print ("{0:{3}^25} \t {1:{3}^10} \t {2:{3}^}".format (i [0], i [1], i [2],chr (12288)))


start = now ()
loop = asyncio.get_event_loop ()
loop.run_until_complete (main ())
print ("Wall time: {}".format (now () - start))


# 九龙不败　　　　　　　　　　　　　　　　　　　　　    　　07 月 02 日　　      https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2560169035.jpg
# 别岁　　　　　　　　　　　　　　　　　　　　　　　    　　07 月 02 日　　      https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2558138041.jpg
...
# 刀背藏身　　　　　　　　　　　　　　　　　　　　　    　　07 月 19 日　　      https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557644589.jpg
# Wall time: 1.994356926937086
# [Finished in 3.7s]
</div><div><div>2019-06-28</div><div><div><i></i><span>2</span></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1a/ee/4d/5d021e4c.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 向左看齐</span></div></div><div>    for each_movie in all_movies.find_all ('div', class_="item"):

AttributeError: 'NoneType' object has no attribute 'find_all'
执行报错，有没有人和我一样的问题？请指教</div><div><div>2020-04-24</div><div><div><i></i><span>3</span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fergus</span></div></div><div># -*- coding:utf-8 -*-
'''
sublime
py -3.6
asyncio.gather (*args) 并发
'''


import time
import asyncio

async def crawl_page (url):
    print ('crawling {}'.format (url))
    sleep_time = int (url.split ('_')[-1])
    await asyncio.sleep (sleep_time)
    print ('OK {}'.format (url))
    
star = time.perf_counter ()
loop = asyncio.get_event_loop ()
tasks = (crawl_page (url) for url in ['url_1', 'url_2', 'url_3', 'url_4'])
loop.run_until_complete (asyncio.gather (*tasks))
loop.close ()

print ('Wall time: {:.2f}'.format (time.perf_counter () - star))


crawling url_4
crawling url_1
crawling url_2
crawling url_3
OK url_1
OK url_2
OK url_3
OK url_4
Wall time: 4.00
[Finished in 4.5s]</div><div><div>2019-06-27</div><div><div><i></i><span>1</span></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/gKnIR8mga02s9xdQoxyJBibmuxHGhfQ8WZicia3Ie4wBQKg4Zc1oVoS03mvaCD46je9xCza25qXc3w6KMckpS0BqQ/132"></div></div><div><div><div><span>supakito</span></div></div><div>对于这段代码：

import asyncio

async def worker_1 ():
    print ('worker_1 start')
    await asyncio.sleep (1)
    print ('worker_1 done')

async def worker_2 ():
    print ('worker_2 start')
    await asyncio.sleep (2)
    print ('worker_2 done')

async def main ():
    task1 = asyncio.create_task (worker_1 ())
    task2 = asyncio.create_task (worker_2 ())
    print ('before await')
    await task1
    print ('awaited worker_1')
    await task2
    print ('awaited worker_2')

% time asyncio.run (main ())

########## 输出 ##########

before await
worker_1 start
worker_2 start
worker_1 done
awaited worker_1
worker_2 done
awaited worker_2
Wall time: 2.01 s

我对老师的解释有些疑问，不知道是不是只要创建了任务以后，不用执行 await，就会运行 worker_1 和 worker_2 中的代码，因为我注释掉了 await 语句后，发现仍然会输出 worker_1 done 和 worker_2 done。所有老师的第三步应该不是调度 worker_1，而是等待 worker_1 执行完成？</div><div><div>2019-11-17</div><div><div><i></i><span>3</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/de/4c/a51ece16.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 刘润森</span></div></div><div> asyncio.run() cannot be called from a running event loop</div><div><div>2019-10-31</div><div><div><i></i><span>1</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 考休</span></div></div><div>翻阅评论，发现大家也有相似的问题，就是在老师的第二个代码块中，代码：
% time asyncio.run (main (['url_1', 'url_2', 'url_3', 'url_4']))
这行代码因为前面有 % time 语法糖，所以大家想当然就在 jupyter 中执行了，但是很多人都遇到了：
RuntimeError: asyncio.run () cannot be called from a running event loop 
查阅 Stack Overflow 的解释 jupyter 已经一个 event loop（https://stackoverflow.com/questions/55409641/asyncio-run-cannot-be-called-from-a-running-event-loop），因此需要将代码改成：
await main (['url_1', 'url_2', 'url_3', 'url_4'])，而且不能在 await 前面加 % time，否则会报错：
SyntaxError: 'await' outside function
新手学习协程感觉各种懵（苦笑脸）</div><div><div>2019-09-23</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/f7/f8/3c0a6854.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>xavier</span></div></div><div>老师你好，请教个问题。如下：

文中代码：

async def main ():
    task1 = asyncio.create_task (worker_1 ())
    task2 = asyncio.create_task (worker_2 ())
    print ('before await')
    await task1
    print ('awaited worker_1')
    await task2
    print ('awaited worker_2')

请问调度器从何时开始启动调度？是一有任务创建就执行调度还是执行 await task1 时？老师这里说的是执行 await task1，事件调度器开始调度 worker_1。但后面的生产者消费者模型，没有 await 操作，任务已开始运行。</div><div><div>2019-07-19</div><div><div><i></i><span>1</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fergus</span></div></div><div># 例 1   3.7 以前的版本实现
import time
import asyncio

# &lt; py 3.7
async def crawl_page (url):
    print ('crawling {}'.format (url))
    sleep_time = int (url.split ('_')[-1])
    r = await asyncio.sleep (sleep_time)
    print ('OK {}'.format (url))

async def main (urls):
    for url in urls:
        await crawl_page (url)
        
star = time.perf_counter ()
loop = asyncio.get_event_loop ()
loop.run_until_complete (main (['url_1', 'url_2', 'url_3', 'url_4']))
loop.close ()
# await main (['url_1', 'url_2', 'url_3', 'url_4'])
print (time.perf_counter () - star)


crawling url_1
OK url_1
crawling url_2
OK url_2
crawling url_3
OK url_3
crawling url_4
OK url_4
10.003888006104894</div><div><div>2019-06-26</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fergus</span></div></div><div># 例一修改 threading

import time
import threading

def crawl_page (url):
    print ('crawling {}'.format (url))
    sleep_time = int (url.split ('_')[-1])
    time.sleep (sleep_time)
    print ('OK {}'.format (url))
    print ('耗时:{:.2f}'.format (time.perf_counter () - star))
    
def main (urls):
    tasks = [threading.Thread (target=crawl_page, name=url, args=(url,)) for url in urls]
    for t in tasks:
        t.start ()
        print (threading.current_thread ().name)
    
star = time.perf_counter ()
main (['url_1', 'url_2', 'url_3', 'url_4'])

crawling url_1MainThread
crawling url_2MainThread
crawling url_3MainThread
crawling url_4MainThread
OK url_1
耗时：1.03
OK url_2
耗时：2.06
OK url_3
耗时：3.08
OK url_4
耗时：4.11</div><div><div>2019-06-26</div><div><div><i></i><span></span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/67/c5/63b09189.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 刘朋</span></div></div><div>当在 jupyter 中运行: % time asyncio.run (main (['url_1', 'url_2', 'url_3', 'url_4']))
出现报错: RuntimeError: asyncio.run () cannot be called from a running event loop
原因是: The problem in your case is that jupyter (IPython) is already running an event loop (for IPython ≥ 7.0)
解决是：将 % time asyncio.run (main (['url_1', 'url_2', 'url_3', 'url_4'])) 换成 await main (['url_1', 'url_2', 'url_3', 'url_4'])</div><div><div>2019-06-26</div><div><div><i></i><span>2</span></div><div><i></i><span>3</span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1a"><outline class="toc-level-h1" data-reactid=".1a.0" style="width: 175px;"><active data-reactid=".1a.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1a.0.1"><span data-reactid=".1a.0.1.0">20 | 揭秘 Python 协程</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.1" style="width: 165px;"><active data-reactid=".1a.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1a.1.1"><span data-reactid=".1a.1.1.0">从一个爬虫说起</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.2" style="width: 165px;"><active data-reactid=".1a.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1a.2.1"><span data-reactid=".1a.2.1.0">解密协程运行时</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.3" style="width: 165px;"><active data-reactid=".1a.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1a.3.1"><span data-reactid=".1a.3.1.0">实战：豆瓣近日推荐电影爬虫</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.4" style="width: 165px;"><active data-reactid=".1a.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1a.4.1"><span data-reactid=".1a.4.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.5" style="width: 165px;"><active data-reactid=".1a.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1a.5.1"><span data-reactid=".1a.5.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.6" style="width: 165px;"><active data-reactid=".1a.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1a.6.1"><span data-reactid=".1a.6.1.0">精选留言 (120)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/101855" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>