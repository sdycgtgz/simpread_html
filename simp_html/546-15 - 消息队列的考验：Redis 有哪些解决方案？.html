
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 15 | 消息队列的考验：Redis 有哪些解决方案？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>15 | 消息队列的考验：Redis 有哪些解决方案？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">15 | 消息队列的考验：Redis 有哪些解决方案？</h1><div><span>蒋德钧</span> <span> 2020-09-11</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/29/53/299c2333d36e9fd3cc94ddc4032f4253.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：蒋德钧</span><span>大小：19.22M</span><span> 时长：21:03</span></div></div><audio title="15 | 消息队列的考验：Redis有哪些解决方案？" src="https://res001.geekbang.org/media/audio/ce/8c/ce703b9yy58ff12b214e59624070c68c/ld/ld.m3u8" __idm_id__="663568"></audio></div><div><div><div><div data-slate-editor="true" data-key="3442" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="3443"><span data-slate-object="text" data-key="3444"><span data-slate-leaf="true" data-offset-key="3444:0" data-first-offset="true"><span data-slate-string="true">你好，我是蒋德钧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3445"><span data-slate-object="text" data-key="3446"><span data-slate-leaf="true" data-offset-key="3446:0" data-first-offset="true"><span data-slate-string="true">现在的互联网应用基本上都是采用分布式系统架构进行设计的，而很多分布式系统必备的一个基础软件就是消息队列。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3447"><span data-slate-object="text" data-key="3448"><span data-slate-leaf="true" data-offset-key="3448:0" data-first-offset="true"><span data-slate-string="true">消息队列要能支持组件通信消息的快速读写，而 Redis 本身支持数据的高速访问，正好可以满足消息队列的读写性能需求。不过，除了性能，消息队列还有其他的要求，所以，很多人都很关心一个问题：“Redis 适合做消息队列吗？”</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3449"><span data-slate-object="text" data-key="3450"><span data-slate-leaf="true" data-offset-key="3450:0" data-first-offset="true"><span data-slate-string="true">其实，这个问题的背后，隐含着两方面的核心问题：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="3451"><div data-slate-type="list-line" data-slate-object="block" data-key="3452"><span data-slate-object="text" data-key="3453"><span data-slate-leaf="true" data-offset-key="3453:0" data-first-offset="true"><span data-slate-string="true">消息队列的消息存取需求是什么？</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3454"><span data-slate-object="text" data-key="3455"><span data-slate-leaf="true" data-offset-key="3455:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_8099a403" data-attr-id="9972" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Redis 如何实现消息队列的需求？</span></span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3456"><span data-slate-object="text" data-key="3457"><span data-slate-leaf="true" data-offset-key="3457:0" data-first-offset="true"><span data-slate-string="true">这节课，我们就来聊一聊消息队列的特征和 Redis 提供的消息队列方案。只有把这两方面的知识和实践经验串连起来，才能彻底理解基于 Redis 实现消息队列的技术实践。以后当你需要为分布式系统组件做消息队列选型时，就可以根据组件通信量和消息通信速度的要求，选择出适合的 Redis 消息队列方案了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3458"><span data-slate-object="text" data-key="3459"><span data-slate-leaf="true" data-offset-key="3459:0" data-first-offset="true"><span data-slate-string="true">我们先来看下第一个问题：消息队列的消息读取有什么样的需求？</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3460" id="sr-toc-1"><span data-slate-object="text" data-key="3461"><span data-slate-leaf="true" data-offset-key="3461:0" data-first-offset="true"><span data-slate-string="true">消息队列的消息存取需求</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3462"><span data-slate-object="text" data-key="3463"><span data-slate-leaf="true" data-offset-key="3463:0" data-first-offset="true"><span data-slate-string="true">我先介绍一下消息队列存取消息的过程。在分布式系统中，当两个组件要基于消息队列进行通信时，一个组件会把要处理的数据以消息的形式传递给消息队列，然后，这个组件就可以继续执行其他操作了；远端的另一个组件从消息队列中把消息读取出来，再在本地进行处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3464"><span data-slate-object="text" data-key="3465"><span data-slate-leaf="true" data-offset-key="3465:0" data-first-offset="true"><span data-slate-string="true">为了方便你理解，我还是借助一个例子来解释一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3466"><span data-slate-object="text" data-key="3467"><span data-slate-leaf="true" data-offset-key="3467:0" data-first-offset="true"><span data-slate-string="true">假设组件 1 需要对采集到的数据进行求和计算，并写入数据库，但是，消息到达的速度很快，组件 1 没有办法及时地既做采集，又做计算，并且写入数据库。所以，我们可以使用基于消息队列的通信，让组件 1 把数据 x 和 y 保存为 JSON 格式的消息，再发到消息队列，这样它就可以继续接收新的数据了。组件 2 则异步地从消息队列中把数据读取出来，在服务器 2 上进行求和计算后，再写入数据库。这个过程如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3468"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/d7/bc/d79d46ec4aa22bf46fde3ae1a99fc2bc.jpg?wh=3000*1459"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3469"><span data-slate-object="text" data-key="3470"><span data-slate-leaf="true" data-offset-key="3470:0" data-first-offset="true"><span data-slate-string="true">我们一般把消息队列中发送消息的组件称为生产者（例子中的组件 1），把接收消息的组件称为消费者（例子中的组件 2），下图展示了一个通用的消息队列的架构模型：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3471"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/f4/62/f470bb957c1faff674c08b1fa65a3a62.jpg?wh=3000*857"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3472"><span data-slate-object="text" data-key="3473"><span data-slate-leaf="true" data-offset-key="3473:0" data-first-offset="true"><span data-slate-string="true">在使用消息队列时，消费者可以异步读取生产者消息，然后再进行处理。这样一来，即使生产者发送消息的速度远远超过了消费者处理消息的速度，生产者已经发送的消息也可以缓存在消息队列中，避免阻塞生产者，这是消息队列作为分布式组件通信的一大优势。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3474"><span data-slate-object="text" data-key="3475"><span data-slate-leaf="true" data-offset-key="3475:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">不过，消息队列在存取消息时，必须要满足三个需求，</span></span></span><span data-slate-leaf="true" data-offset-key="3475:1"><span data-slate-object="annotation" data-annotation-key="gkann_209ae56a" data-attr-id="5228" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">分别是消息保序、处理重复的消息和保证消息可靠性。</span></span></span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3476" id="sr-toc-2"><span data-slate-object="text" data-key="3477"><span data-slate-leaf="true" data-offset-key="3477:0" data-first-offset="true"><span data-slate-string="true">需求一：消息保序</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3478"><span data-slate-object="text" data-key="3479"><span data-slate-leaf="true" data-offset-key="3479:0" data-first-offset="true"><span data-slate-string="true">虽然消费者是异步处理消息，但是，消费者仍然需要按照生产者发送消息的顺序来处理消息，避免后发送的消息被先处理了。对于要求消息保序的场景来说，一旦出现这种消息被乱序处理的情况，就可能会导致业务逻辑被错误执行，从而给业务方造成损失。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3480"><span data-slate-object="text" data-key="3481"><span data-slate-leaf="true" data-offset-key="3481:0" data-first-offset="true"><span data-slate-string="true">我们来看一个更新商品库存的场景。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3482"><span data-slate-object="text" data-key="3483"><span data-slate-leaf="true" data-offset-key="3483:0" data-first-offset="true"><span data-slate-string="true">假设生产者负责接收库存更新请求，消费者负责实际更新库存，现有库存量是 10。生产者先后发送了消息 1 和消息 2，消息 1 要把商品 X 的库存记录更新为 5，消息 2 是把商品 X 库存更新为 3。如果消息 1 和 2 在消息队列中无法保序，出现消息 2 早于消息 1 被处理的情况，那么，很显然，库存更新就出错了。这是业务应用无法接受的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3484"><span data-slate-object="text" data-key="3485"><span data-slate-leaf="true" data-offset-key="3485:0" data-first-offset="true"><span data-slate-string="true">面对这种情况，你可能会想到一种解决方案：不要把更新后的库存量作为生产者发送的消息，而是</span></span></span><span data-slate-object="text" data-key="3486"><span data-slate-leaf="true" data-offset-key="3486:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">把库存扣除值作为消息的内容</span></span></span></span><span data-slate-object="text" data-key="3487"><span data-slate-leaf="true" data-offset-key="3487:0" data-first-offset="true"><span data-slate-string="true">。这样一来，消息 1 是扣减库存量 5，消息 2 是扣减库存量 2。如果消息 1 和消息 2 之间没有库存查询请求的话，即使消费者先处理消息 2，再处理消息 1，这个方案也能够保证最终的库存量是正确的，也就是库存量为 3。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3488"><span data-slate-object="text" data-key="3489"><span data-slate-leaf="true" data-offset-key="3489:0" data-first-offset="true"><span data-slate-string="true">但是，我们还需要考虑这样一种情况：假如消费者收到了这样三条消息：消息 1 是扣减库存量 5，消息 2 是读取库存量，消息 3 是扣减库存量 2，此时，如果消费者先处理了消息 3（把库存量扣减 2），那么库存量就变成了 8。然后，消费者处理了消息 2，读取当前的库存量是 8，这就会出现库存量查询不正确的情况。从业务应用层面看，消息 1、2、3 应该是顺序执行的，所以，消息 2 查询到的应该是扣减了 5 以后的库存量，而不是扣减了 2 以后的库存量。所以，用库存扣除值作为消息的方案，在消息中同时包含读写操作的场景下，会带来数据读取错误的问题。而且，这个方案还会面临一个问题，那就是重复消息处理。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3490" id="sr-toc-3"><span data-slate-object="text" data-key="3491"><span data-slate-leaf="true" data-offset-key="3491:0" data-first-offset="true"><span data-slate-string="true">需求二：重复消息处理</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3492"><span data-slate-object="text" data-key="3493"><span data-slate-leaf="true" data-offset-key="3493:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0e4e5700" data-attr-id="3800" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消费者从消息队列读取消息时，有时会因为网络堵塞而出现消息重传的情况。此时，消费者可能会收到多条重复的消息。对于重复的消息，消费者如果多次处理的话，就可能造成一个业务逻辑被多次执行，如果业务逻辑正好是要修改数据，那就会出现数据被多次修改的问题了。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3494"><span data-slate-object="text" data-key="3495"><span data-slate-leaf="true" data-offset-key="3495:0" data-first-offset="true"><span data-slate-string="true">还是以库存更新为例，假设消费者收到了一次消息 1，要扣减库存量 5，然后又收到了一次消息 1，那么，如果消费者无法识别这两条消息实际是一条相同消息的话，就会执行两次扣减库存量 5 的操作，此时，库存量就不对了。这当然也是无法接受的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3496" id="sr-toc-4"><span data-slate-object="text" data-key="3497"><span data-slate-leaf="true" data-offset-key="3497:0" data-first-offset="true"><span data-slate-string="true">需求三：消息可靠性保证</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3498"><span data-slate-object="text" data-key="3499"><span data-slate-leaf="true" data-offset-key="3499:0" data-first-offset="true"><span data-slate-string="true">另外，消费者在处理消息的时候，还可能出现因为故障或宕机导致消息没有处理完成的情况。此时，消息队列需要能提供消息可靠性的保证，也就是说，当消费者重启后，可以重新读取消息再次进行处理，否则，就会出现消息漏处理的问题了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3500"><span data-slate-object="text" data-key="3501"><span data-slate-leaf="true" data-offset-key="3501:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c2631c5d" data-attr-id="42061" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Redis 的 List 和 Streams 两种数据类型，</span></span></span><span data-slate-leaf="true" data-offset-key="3501:1"><span data-slate-string="true">就可以满足消息队列的这三个需求。我们先来了解下基于 List 的消息队列实现方法。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3502" id="sr-toc-5"><span data-slate-object="text" data-key="3503"><span data-slate-leaf="true" data-offset-key="3503:0" data-first-offset="true"><span data-slate-string="true">基于 List 的消息队列解决方案</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3504"><span data-slate-object="text" data-key="3505"><span data-slate-leaf="true" data-offset-key="3505:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_ab58dbae" data-attr-id="10306" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">List 本身就是按先进先出的顺序对数据进行存取的，</span></span></span><span data-slate-leaf="true" data-offset-key="3505:1"><span data-slate-string="true">所以，如果使用 List 作为消息队列保存消息的话，就已经能满足消息保序的需求了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3506"><span data-slate-object="text" data-key="3507"><span data-slate-leaf="true" data-offset-key="3507:0" data-first-offset="true"><span data-slate-string="true">具体来说，生产者可以使用 LPUSH 命令把要发送的消息依次写入 List，而消费者则可以使用 RPOP 命令，从 List 的另一端按照消息的写入顺序，依次读取消息并进行处理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3508"><span data-slate-object="text" data-key="3509"><span data-slate-leaf="true" data-offset-key="3509:0" data-first-offset="true"><span data-slate-string="true">如下图所示，生产者先用 LPUSH 写入了两条库存消息，分别是 5 和 3，表示要把库存更新为 5 和 3；消费者则用 RPOP 把两条消息依次读出，然后进行相应的处理。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3510"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/b0/7c/b0959216cbce7ac383ce206b8884777c.jpg?wh=3000*2250"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3511"><span data-slate-object="text" data-key="3512"><span data-slate-leaf="true" data-offset-key="3512:0" data-first-offset="true"><span data-slate-string="true">不过，在消费者读取数据时，有一个潜在的性能风险点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3513"><span data-slate-object="text" data-key="3514"><span data-slate-leaf="true" data-offset-key="3514:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_52036ab4" data-attr-id="17618" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">在生产者往 List 中写入数据时，List 并不会主动地通知消费者有新消息写入，如果消费者想要及时处理消息，就需要在程序中不停地调用 RPOP 命令（比如使用一个 while (1) 循环）。如果有新消息写入，RPOP 命令就会返回结果，否则，RPOP 命令返回空值，再继续循环。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3515"><span data-slate-object="text" data-key="3516"><span data-slate-leaf="true" data-offset-key="3516:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f01734ba" data-attr-id="23304" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">所以，即使没有新消息写入 List，消费者也要不停地调用 RPOP 命令，这就会导致消费者程序的 CPU 一直消耗在执行 RPOP 命令上，带来不必要的性能损失。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3517"><span data-slate-object="text" data-key="3518"><span data-slate-leaf="true" data-offset-key="3518:0" data-first-offset="true"><span data-slate-string="true">为了解决这个问题，Redis 提供了 BRPOP 命令。</span></span></span><span data-slate-object="text" data-key="3519"><span data-slate-leaf="true" data-offset-key="3519:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_835c3e05" data-attr-id="2996" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">BRPOP 命令也称为阻塞式读取，客户端在没有读到队列数据时，自动阻塞，直到有新的数据写入队列，再开始读取新数据</span></span></span></span></span><span data-slate-object="text" data-key="3520"><span data-slate-leaf="true" data-offset-key="3520:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_835c3e05" data-attr-id="2996" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span><span data-slate-leaf="true" data-offset-key="3520:1"><span data-slate-string="true">和消费者程序自己不停地调用 RPOP 命令相比，这种方式能节省 CPU 开销。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3521"><span data-slate-object="text" data-key="3522"><span data-slate-leaf="true" data-offset-key="3522:0" data-first-offset="true"><span data-slate-string="true">消息保序的问题解决了，接下来，我们还需要考虑解决重复消息处理的问题，这里其实有一个要求：</span></span></span><span data-slate-object="text" data-key="3523"><span data-slate-leaf="true" data-offset-key="3523:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">消费者程序本身能对重复消息进行判断。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3524"><span data-slate-object="text" data-key="3525"><span data-slate-leaf="true" data-offset-key="3525:0" data-first-offset="true"><span data-slate-string="true">一方面，</span></span><span data-slate-leaf="true" data-offset-key="3525:1"><span data-slate-object="annotation" data-annotation-key="gkann_48889ac2" data-attr-id="27921" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消息队列要能给每一个消息提供全局唯一的 ID 号；另一方面，消费者程序要把已经处理过的消息的 ID 号记录下来。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3526"><span data-slate-object="text" data-key="3527"><span data-slate-leaf="true" data-offset-key="3527:0" data-first-offset="true"><span data-slate-string="true">当收到一条消息后，消费者程序就可以对比收到的消息 ID 和记录的已处理过的消息 ID，来判断当前收到的消息有没有经过处理。如果已经处理过，那么，消费者程序就不再进行处理了。</span></span><span data-slate-leaf="true" data-offset-key="3527:1"><span data-slate-object="annotation" data-annotation-key="gkann_b328b04a" data-attr-id="9973" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">这种处理特性也称为幂等性，幂等性就是指，对于同一条消息，消费者收到一次的处理结果和收到多次的处理结果是一致的。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3528"><span data-slate-object="text" data-key="3529"><span data-slate-leaf="true" data-offset-key="3529:0" data-first-offset="true"><span data-slate-string="true">不过，List 本身是不会为每个消息生成 ID 号的，所以，</span></span><span data-slate-leaf="true" data-offset-key="3529:1"><span data-slate-object="annotation" data-annotation-key="gkann_e3f9eaf0" data-attr-id="10255" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消息的全局唯一 ID 号就需要生产者程序在发送消息前自行生成。</span></span></span><span data-slate-leaf="true" data-offset-key="3529:2"><span data-slate-object="annotation" data-annotation-key="gkann_878175d2" data-attr-id="37476" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">生成之后，我们在用 LPUSH 命令把消息插入 List 时，需要在消息中包含这个全局唯一 ID。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3530"><span data-slate-object="text" data-key="3531"><span data-slate-leaf="true" data-offset-key="3531:0" data-first-offset="true"><span data-slate-string="true">例如，我们执行以下命令，就把一条全局 ID 为 101030001、库存量为 5 的消息插入了消息队列：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3532"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3533"><span data-slate-object="text" data-key="3534"><span data-slate-leaf="true" data-offset-key="3534:0" data-first-offset="true"><span data-slate-string="true">LPUSH mq "101030001:stock:5"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3535"><span data-slate-object="text" data-key="3536"><span data-slate-leaf="true" data-offset-key="3536:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3537"><span data-slate-leaf="true" data-offset-key="3537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">integer</span></span></span></span><span data-slate-object="text" data-key="3538"><span data-slate-leaf="true" data-offset-key="3538:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3539"><span data-slate-leaf="true" data-offset-key="3539:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3540"><span data-slate-object="text" data-key="3541"><span data-slate-leaf="true" data-offset-key="3541:0" data-first-offset="true"><span data-slate-string="true">最后，我们再来看下，List 类型是如何保证消息可靠性的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3542"><span data-slate-object="text" data-key="3543"><span data-slate-leaf="true" data-offset-key="3543:0" data-first-offset="true"><span data-slate-string="true">当消费者程序从 List 中读取一条消息后，List 就不会再留存这条消息了。所以，如果消费者程序在处理消息的过程出现了故障或宕机，就会导致消息没有处理完成，那么，消费者程序再次启动后，就没法再次从 List 中读取消息了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3544"><span data-slate-object="text" data-key="3545"><span data-slate-leaf="true" data-offset-key="3545:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_ab840794" data-attr-id="18955" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">为了留存消息，List 类型提供了 BRPOPLPUSH 命令，这个命令的作用是让消费者程序从一个 List 中读取消息，同时，Redis 会把这个消息再插入到另一个 List（可以叫作备份 List）留存。这样一来，如果消费者程序读了消息但没能正常处理，等它重启后，就可以从备份 List 中重新读取消息并进行处理了。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3546"><span data-slate-object="text" data-key="3547"><span data-slate-leaf="true" data-offset-key="3547:0" data-first-offset="true"><span data-slate-string="true">我画了一张示意图，展示了使用 BRPOPLPUSH 命令留存消息，以及消费者再次读取消息的过程，你可以看下。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="3548"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/50/3d/5045395da08317b546aab7eb698d013d.jpg?wh=3000*2135"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3549"><span data-slate-object="text" data-key="3550"><span data-slate-leaf="true" data-offset-key="3550:0" data-first-offset="true"><span data-slate-string="true">生产者先用 LPUSH 把消息 “5”“3” 插入到消息队列 mq 中。消费者程序使用 BRPOPLPUSH 命令读取消息 “5”，同时，消息 “5” 还会被 Redis 插入到 mqback 队列中。</span></span><span data-slate-leaf="true" data-offset-key="3550:1"><span data-slate-object="annotation" data-annotation-key="gkann_8dfd3f61" data-attr-id="6399" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">如果消费者程序处理消息 “5” 时宕机了，等它重启后，可以从 mqback 中再次读取消息 “5”，继续处理。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3551"><span data-slate-object="text" data-key="3552"><span data-slate-leaf="true" data-offset-key="3552:0" data-first-offset="true"><span data-slate-string="true">好了，到这里，你可以看到，基于 List 类型，我们可以满足分布式组件对消息队列的三大需求。但是，在用 List 做消息队列时，</span></span><span data-slate-leaf="true" data-offset-key="3552:1"><span data-slate-object="annotation" data-annotation-key="gkann_cc61dba4" data-attr-id="7095" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们还可能遇到过一个问题：</span></span></span></span><span data-slate-object="text" data-key="3553"><span data-slate-leaf="true" data-offset-key="3553:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_cc61dba4" data-attr-id="7095" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">生产者消息发送很快，而消费者处理消息的速度比较慢，这就导致 List 中的消息越积越多，给 Redis 的内存带来很大压力</span></span></span></span></span><span data-slate-object="text" data-key="3554"><span data-slate-leaf="true" data-offset-key="3554:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_cc61dba4" data-attr-id="7095" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3555"><span data-slate-object="text" data-key="3556"><span data-slate-leaf="true" data-offset-key="3556:0" data-first-offset="true"><span data-slate-string="true">这个时候，</span></span><span data-slate-leaf="true" data-offset-key="3556:1"><span data-slate-object="annotation" data-annotation-key="gkann_f061822a" data-attr-id="27230" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们希望启动多个消费者程序组成一个消费组，一起分担处理 List 中的消息。</span></span></span><span data-slate-leaf="true" data-offset-key="3556:2"><span data-slate-string="true">但是，List 类型并不支持消费组的实现。那么，</span></span><span data-slate-leaf="true" data-offset-key="3556:3"><span data-slate-object="annotation" data-annotation-key="gkann_da022836" data-attr-id="27231" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">还有没有更合适的解决方案呢？这就要说到 Redis 从 5.0 版本开始提供的 Streams 数据类型了。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3557"><span data-slate-object="text" data-key="3558"><span data-slate-leaf="true" data-offset-key="3558:0" data-first-offset="true"><span data-slate-string="true">和 List 相比，Streams 同样能够满足消息队列的三大需求。而且，它还支持消费组形式的消息读取。接下来，我们就来了解下 Streams 的使用方法。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3559" id="sr-toc-6"><span data-slate-object="text" data-key="3560"><span data-slate-leaf="true" data-offset-key="3560:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_152c7821" data-attr-id="11545" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">基于 Streams 的消息队列解决方案</span></span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3561"><span data-slate-object="text" data-key="3562"><span data-slate-leaf="true" data-offset-key="3562:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f7e659d9" data-attr-id="9974" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Streams 是 Redis 专门为消息队列设计的数据类型，</span></span></span><span data-slate-leaf="true" data-offset-key="3562:1"><span data-slate-string="true">它提供了丰富的消息队列操作命令。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="3563"><div data-slate-type="list-line" data-slate-object="block" data-key="3564"><span data-slate-object="text" data-key="3565"><span data-slate-leaf="true" data-offset-key="3565:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_0dd27fe0" data-attr-id="9975" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">XADD：插入消息，保证有序，可以自动生成全局唯一 ID；</span></span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3566"><span data-slate-object="text" data-key="3567"><span data-slate-leaf="true" data-offset-key="3567:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_4af51393" data-attr-id="17619" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">XREAD：用于读取消息，可以按 ID 读取数据；</span></span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3568"><span data-slate-object="text" data-key="3569"><span data-slate-leaf="true" data-offset-key="3569:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_fd9bf196" data-attr-id="17620" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">XREADGROUP：按消费组形式读取消息；</span></span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3570"><span data-slate-object="text" data-key="3571"><span data-slate-leaf="true" data-offset-key="3571:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e86f70e1" data-attr-id="17621" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">XPENDING 和 XACK：XPENDING 命令可以用来查询每个消费组内所有消费者已读取但尚未确认的消息，而 XACK 命令用于向消息队列确认消息处理已完成。</span></span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3572"><span data-slate-object="text" data-key="3573"><span data-slate-leaf="true" data-offset-key="3573:0" data-first-offset="true"><span data-slate-string="true">首先，我们来学习下 Streams 类型存取消息的操作 XADD。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3574"><span data-slate-object="text" data-key="3575"><span data-slate-leaf="true" data-offset-key="3575:0" data-first-offset="true"><span data-slate-string="true">XADD 命令可以往消息队列中插入新消息，消息的格式是键 - 值对形式。对于插入的每一条消息，Streams 可以自动为其生成一个全局唯一的 ID。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3576"><span data-slate-object="text" data-key="3577"><span data-slate-leaf="true" data-offset-key="3577:0" data-first-offset="true"><span data-slate-string="true">比如说，我们执行下面的命令，就可以往名称为 mqstream 的消息队列中插入一条消息，消息的键是 repo，值是 5。其中，</span></span><span data-slate-leaf="true" data-offset-key="3577:1"><span data-slate-object="annotation" data-annotation-key="gkann_9073fb5b" data-attr-id="7724" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消息队列名称后面的</span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="3578"><span data-slate-object="text" data-key="3579"><span data-slate-leaf="true" data-offset-key="3579:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_9073fb5b" data-attr-id="7724" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true"> *</span></span></span></span></span><span data-slate-object="text" data-key="3580"><span data-slate-leaf="true" data-offset-key="3580:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_9073fb5b" data-attr-id="7724" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，表示让 Redis 为插入的数据自动生成一个全局唯一的 ID，</span></span></span><span data-slate-leaf="true" data-offset-key="3580:1"><span data-slate-string="true">例如 “1599203861727-0”。当然，我们也可以不用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="3581"><span data-slate-object="text" data-key="3582"><span data-slate-leaf="true" data-offset-key="3582:0" data-first-offset="true"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3583"><span data-slate-leaf="true" data-offset-key="3583:0" data-first-offset="true"><span data-slate-string="true">，直接在消息队列名称后自行设定一个 ID 号，</span></span><span data-slate-leaf="true" data-offset-key="3583:1"><span data-slate-object="annotation" data-annotation-key="gkann_cdddc78d" data-attr-id="41282" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">只要保证这个 ID 号是全局唯一的就行。</span></span></span><span data-slate-leaf="true" data-offset-key="3583:2"><span data-slate-string="true">不过，相比自行设定 ID 号，使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="3584"><span data-slate-object="text" data-key="3585"><span data-slate-leaf="true" data-offset-key="3585:0" data-first-offset="true"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3586"><span data-slate-leaf="true" data-offset-key="3586:0" data-first-offset="true"><span data-slate-string="true"> 会更加方便高效。</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="3587"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3588"><span data-slate-object="text" data-key="3589"><span data-slate-leaf="true" data-offset-key="3589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XADD</span></span></span></span><span data-slate-object="text" data-key="3590"><span data-slate-leaf="true" data-offset-key="3590:0" data-first-offset="true"><span data-slate-string="true"> mqstream * repo </span></span></span><span data-slate-object="text" data-key="3591"><span data-slate-leaf="true" data-offset-key="3591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3592"><span data-slate-object="text" data-key="3593"><span data-slate-leaf="true" data-offset-key="3593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1599203861727-0"</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3594"><span data-slate-object="text" data-key="3595"><span data-slate-leaf="true" data-offset-key="3595:0" data-first-offset="true"><span data-slate-string="true">可以看到，消息的全局唯一 ID 由两部分组成，第一部分 “1599203861727” 是数据插入时，以毫秒为单位计算的当前服务器时间，第二部分表示插入消息在当前毫秒内的消息序号，这是从 0 开始编号的。例如，</span></span><span data-slate-leaf="true" data-offset-key="3595:1"><span data-slate-object="annotation" data-annotation-key="gkann_61ee20db" data-attr-id="41422" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">“1599203861727-0” 就表示在 “1599203861727” 毫秒内的第 1 条消息。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3596"><span data-slate-object="text" data-key="3597"><span data-slate-leaf="true" data-offset-key="3597:0" data-first-offset="true"><span data-slate-string="true">当消费者需要读取消息时，可以直接使用 XREAD 命令从消息队列中读取。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3598"><span data-slate-object="text" data-key="3599"><span data-slate-leaf="true" data-offset-key="3599:0" data-first-offset="true"><span data-slate-string="true">XREAD 在读取消息时，可以指定一个消息 ID，并从这个消息 ID 的下一条消息开始进行读取。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3600"><span data-slate-object="text" data-key="3601"><span data-slate-leaf="true" data-offset-key="3601:0" data-first-offset="true"><span data-slate-string="true">例如，我们可以执行下面的命令，从 ID 号为 1599203861727-0 的消息开始，读取后续的所有消息（示例中一共 3 条）。</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="3602"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3603"><span data-slate-object="text" data-key="3604"><span data-slate-leaf="true" data-offset-key="3604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">XREAD</span></span></span></span><span data-slate-object="text" data-key="3605"><span data-slate-leaf="true" data-offset-key="3605:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3606"><span data-slate-leaf="true" data-offset-key="3606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">BLOCK</span></span></span></span><span data-slate-object="text" data-key="3607"><span data-slate-leaf="true" data-offset-key="3607:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3608"><span data-slate-leaf="true" data-offset-key="3608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="3609"><span data-slate-leaf="true" data-offset-key="3609:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3610"><span data-slate-leaf="true" data-offset-key="3610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">STREAMS</span></span></span></span><span data-slate-object="text" data-key="3611"><span data-slate-leaf="true" data-offset-key="3611:0" data-first-offset="true"><span data-slate-string="true">  mqstream </span></span></span><span data-slate-object="text" data-key="3612"><span data-slate-leaf="true" data-offset-key="3612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1599203861727</span></span></span></span><span data-slate-object="text" data-key="3613"><span data-slate-leaf="true" data-offset-key="3613:0" data-first-offset="true"><span data-slate-string="true">-</span></span></span><span data-slate-object="text" data-key="3614"><span data-slate-leaf="true" data-offset-key="3614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3615"><span data-slate-object="text" data-key="3616"><span data-slate-leaf="true" data-offset-key="3616:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3617"><span data-slate-leaf="true" data-offset-key="3617:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3618"><span data-slate-leaf="true" data-offset-key="3618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3619"><span data-slate-leaf="true" data-offset-key="3619:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3620"><span data-slate-leaf="true" data-offset-key="3620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"mqstream"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3621"><span data-slate-object="text" data-key="3622"><span data-slate-leaf="true" data-offset-key="3622:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3623"><span data-slate-leaf="true" data-offset-key="3623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3624"><span data-slate-leaf="true" data-offset-key="3624:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3625"><span data-slate-leaf="true" data-offset-key="3625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3626"><span data-slate-leaf="true" data-offset-key="3626:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3627"><span data-slate-leaf="true" data-offset-key="3627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3628"><span data-slate-leaf="true" data-offset-key="3628:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3629"><span data-slate-leaf="true" data-offset-key="3629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1599274912765-0"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3630"><span data-slate-object="text" data-key="3631"><span data-slate-leaf="true" data-offset-key="3631:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3632"><span data-slate-leaf="true" data-offset-key="3632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3633"><span data-slate-leaf="true" data-offset-key="3633:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3634"><span data-slate-leaf="true" data-offset-key="3634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3635"><span data-slate-leaf="true" data-offset-key="3635:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3636"><span data-slate-leaf="true" data-offset-key="3636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"repo"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3637"><span data-slate-object="text" data-key="3638"><span data-slate-leaf="true" data-offset-key="3638:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3639"><span data-slate-leaf="true" data-offset-key="3639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3640"><span data-slate-leaf="true" data-offset-key="3640:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3641"><span data-slate-leaf="true" data-offset-key="3641:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"3"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3642"><span data-slate-object="text" data-key="3643"><span data-slate-leaf="true" data-offset-key="3643:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3644"><span data-slate-leaf="true" data-offset-key="3644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3645"><span data-slate-leaf="true" data-offset-key="3645:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3646"><span data-slate-leaf="true" data-offset-key="3646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3647"><span data-slate-leaf="true" data-offset-key="3647:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3648"><span data-slate-leaf="true" data-offset-key="3648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1599274925823-0"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3649"><span data-slate-object="text" data-key="3650"><span data-slate-leaf="true" data-offset-key="3650:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3651"><span data-slate-leaf="true" data-offset-key="3651:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3652"><span data-slate-leaf="true" data-offset-key="3652:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3653"><span data-slate-leaf="true" data-offset-key="3653:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3654"><span data-slate-leaf="true" data-offset-key="3654:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3655"><span data-slate-leaf="true" data-offset-key="3655:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"repo"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3656"><span data-slate-object="text" data-key="3657"><span data-slate-leaf="true" data-offset-key="3657:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3658"><span data-slate-leaf="true" data-offset-key="3658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3659"><span data-slate-leaf="true" data-offset-key="3659:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3660"><span data-slate-leaf="true" data-offset-key="3660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"2"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3661"><span data-slate-object="text" data-key="3662"><span data-slate-leaf="true" data-offset-key="3662:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3663"><span data-slate-leaf="true" data-offset-key="3663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="3664"><span data-slate-leaf="true" data-offset-key="3664:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3665"><span data-slate-leaf="true" data-offset-key="3665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3666"><span data-slate-leaf="true" data-offset-key="3666:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3667"><span data-slate-leaf="true" data-offset-key="3667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1599274927910-0"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3668"><span data-slate-object="text" data-key="3669"><span data-slate-leaf="true" data-offset-key="3669:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3670"><span data-slate-leaf="true" data-offset-key="3670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3671"><span data-slate-leaf="true" data-offset-key="3671:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3672"><span data-slate-leaf="true" data-offset-key="3672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3673"><span data-slate-leaf="true" data-offset-key="3673:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3674"><span data-slate-leaf="true" data-offset-key="3674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"repo"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3675"><span data-slate-object="text" data-key="3676"><span data-slate-leaf="true" data-offset-key="3676:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3677"><span data-slate-leaf="true" data-offset-key="3677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3678"><span data-slate-leaf="true" data-offset-key="3678:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3679"><span data-slate-leaf="true" data-offset-key="3679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"1"</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3680"><span data-slate-object="text" data-key="3681"><span data-slate-leaf="true" data-offset-key="3681:0" data-first-offset="true"><span data-slate-string="true">另外，</span></span><span data-slate-leaf="true" data-offset-key="3681:1"><span data-slate-object="annotation" data-annotation-key="gkann_3760203d" data-attr-id="29837" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消费者也可以在调用 XRAED 时设定 block 配置项，实现类似于 BRPOP 的阻塞读取操作。</span></span></span><span data-slate-leaf="true" data-offset-key="3681:2"><span data-slate-string="true">当消息队列中没有消息时，一旦设置了 block 配置项，XREAD 就会阻塞，阻塞的时长可以在 block 配置项进行设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3682"><span data-slate-object="text" data-key="3683"><span data-slate-leaf="true" data-offset-key="3683:0" data-first-offset="true"><span data-slate-string="true">举个例子，我们来看一下下面的命令，其中，</span></span><span data-slate-leaf="true" data-offset-key="3683:1"><span data-slate-object="annotation" data-annotation-key="gkann_6f1037b4" data-attr-id="29836" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">命令最后的 “$” 符号表示读取最新的消息，</span></span></span><span data-slate-leaf="true" data-offset-key="3683:2"><span data-slate-string="true">同时，我们设置了 block 10000 的配置项，10000 的单位是毫秒，表明 XREAD 在读取最新消息时，如果没有消息到来，XREAD 将阻塞 10000 毫秒（即 10 秒），然后再返回。下面命令中的 XREAD 执行后，消息队列 mqstream 中一直没有消息，所以，XREAD 在 10 秒后返回空值（nil）。</span></span></span></div><div data-code-language="objectivec" data-slate-type="pre" data-slate-object="block" data-key="3684"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3685"><span data-slate-object="text" data-key="3686"><span data-slate-leaf="true" data-offset-key="3686:0" data-first-offset="true"><span data-slate-string="true">XREAD block </span></span></span><span data-slate-object="text" data-key="3687"><span data-slate-leaf="true" data-offset-key="3687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10000</span></span></span></span><span data-slate-object="text" data-key="3688"><span data-slate-leaf="true" data-offset-key="3688:0" data-first-offset="true"><span data-slate-string="true"> streams mqstream $</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3689"><span data-slate-object="text" data-key="3690"><span data-slate-leaf="true" data-offset-key="3690:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3691"><span data-slate-leaf="true" data-offset-key="3691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="3692"><span data-slate-leaf="true" data-offset-key="3692:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3693"><span data-slate-object="text" data-key="3694"><span data-slate-leaf="true" data-offset-key="3694:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3695"><span data-slate-leaf="true" data-offset-key="3695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10.00</span></span></span></span><span data-slate-object="text" data-key="3696"><span data-slate-leaf="true" data-offset-key="3696:0" data-first-offset="true"><span data-slate-string="true">s)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3697"><span data-slate-object="text" data-key="3698"><span data-slate-leaf="true" data-offset-key="3698:0" data-first-offset="true"><span data-slate-string="true">刚刚讲到的这些操作是 List 也支持的，接下来，我们再来学习下 Streams 特有的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3699"><span data-slate-object="text" data-key="3700"><span data-slate-leaf="true" data-offset-key="3700:0" data-first-offset="true"><span data-slate-string="true">Streams 本身可以使用 XGROUP 创建消费组，创建消费组之后，Streams 可以使用 XREADGROUP 命令让消费组内的消费者读取消息，</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3701"><span data-slate-object="text" data-key="3702"><span data-slate-leaf="true" data-offset-key="3702:0" data-first-offset="true"><span data-slate-string="true">例如，我们执行下面的命令，创建一个名为 group1 的消费组，这个消费组消费的消息队列是 mqstream。</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3703"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3704"><span data-slate-object="text" data-key="3705"><span data-slate-leaf="true" data-offset-key="3705:0" data-first-offset="true"><span data-slate-string="true">XGROUP </span></span></span><span data-slate-object="text" data-key="3706"><span data-slate-leaf="true" data-offset-key="3706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">create</span></span></span></span><span data-slate-object="text" data-key="3707"><span data-slate-leaf="true" data-offset-key="3707:0" data-first-offset="true"><span data-slate-string="true"> mqstream group1 </span></span></span><span data-slate-object="text" data-key="3708"><span data-slate-leaf="true" data-offset-key="3708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3709"><span data-slate-object="text" data-key="3710"><span data-slate-leaf="true" data-offset-key="3710:0" data-first-offset="true"><span data-slate-string="true">OK</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3711"><span data-slate-object="text" data-key="3712"><span data-slate-leaf="true" data-offset-key="3712:0" data-first-offset="true"><span data-slate-string="true">然后，我们再执行一段命令，让 group1 消费组里的消费者 consumer1 从 mqstream 中读取所有消息，其中，</span></span><span data-slate-leaf="true" data-offset-key="3712:1"><span data-slate-object="annotation" data-annotation-key="gkann_58d62800" data-attr-id="29838" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">命令最后的参数 “&gt;”，表示从第一条尚未被消费的消息开始读取。</span></span></span><span data-slate-leaf="true" data-offset-key="3712:2"><span data-slate-string="true">因为在 consumer1 读取消息前，group1 中没有其他消费者读取过消息，所以，consumer1 就得到 mqstream 消息队列中的所有消息了（一共 4 条）。</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3713"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3714"><span data-slate-object="text" data-key="3715"><span data-slate-leaf="true" data-offset-key="3715:0" data-first-offset="true"><span data-slate-string="true">XREADGROUP </span></span></span><span data-slate-object="text" data-key="3716"><span data-slate-leaf="true" data-offset-key="3716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span><span data-slate-object="text" data-key="3717"><span data-slate-leaf="true" data-offset-key="3717:0" data-first-offset="true"><span data-slate-string="true"> group1 consumer1 streams mqstream </span></span></span><span data-slate-object="text" data-key="3718"><span data-slate-leaf="true" data-offset-key="3718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3719"><span data-slate-object="text" data-key="3720"><span data-slate-leaf="true" data-offset-key="3720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3721"><span data-slate-leaf="true" data-offset-key="3721:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3722"><span data-slate-leaf="true" data-offset-key="3722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3723"><span data-slate-leaf="true" data-offset-key="3723:0" data-first-offset="true"><span data-slate-string="true">) "mqstream"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3724"><span data-slate-object="text" data-key="3725"><span data-slate-leaf="true" data-offset-key="3725:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3726"><span data-slate-leaf="true" data-offset-key="3726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3727"><span data-slate-leaf="true" data-offset-key="3727:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3728"><span data-slate-leaf="true" data-offset-key="3728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3729"><span data-slate-leaf="true" data-offset-key="3729:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3730"><span data-slate-leaf="true" data-offset-key="3730:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3731"><span data-slate-leaf="true" data-offset-key="3731:0" data-first-offset="true"><span data-slate-string="true">) "1599203861727-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3732"><span data-slate-object="text" data-key="3733"><span data-slate-leaf="true" data-offset-key="3733:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3734"><span data-slate-leaf="true" data-offset-key="3734:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3735"><span data-slate-leaf="true" data-offset-key="3735:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3736"><span data-slate-leaf="true" data-offset-key="3736:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3737"><span data-slate-leaf="true" data-offset-key="3737:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3738"><span data-slate-object="text" data-key="3739"><span data-slate-leaf="true" data-offset-key="3739:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3740"><span data-slate-leaf="true" data-offset-key="3740:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3741"><span data-slate-leaf="true" data-offset-key="3741:0" data-first-offset="true"><span data-slate-string="true">) "5"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3742"><span data-slate-object="text" data-key="3743"><span data-slate-leaf="true" data-offset-key="3743:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3744"><span data-slate-leaf="true" data-offset-key="3744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3745"><span data-slate-leaf="true" data-offset-key="3745:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3746"><span data-slate-leaf="true" data-offset-key="3746:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3747"><span data-slate-leaf="true" data-offset-key="3747:0" data-first-offset="true"><span data-slate-string="true">) "1599274912765-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3748"><span data-slate-object="text" data-key="3749"><span data-slate-leaf="true" data-offset-key="3749:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3750"><span data-slate-leaf="true" data-offset-key="3750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3751"><span data-slate-leaf="true" data-offset-key="3751:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3752"><span data-slate-leaf="true" data-offset-key="3752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3753"><span data-slate-leaf="true" data-offset-key="3753:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3754"><span data-slate-object="text" data-key="3755"><span data-slate-leaf="true" data-offset-key="3755:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3756"><span data-slate-leaf="true" data-offset-key="3756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3757"><span data-slate-leaf="true" data-offset-key="3757:0" data-first-offset="true"><span data-slate-string="true">) "3"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3758"><span data-slate-object="text" data-key="3759"><span data-slate-leaf="true" data-offset-key="3759:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3760"><span data-slate-leaf="true" data-offset-key="3760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="3761"><span data-slate-leaf="true" data-offset-key="3761:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3762"><span data-slate-leaf="true" data-offset-key="3762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3763"><span data-slate-leaf="true" data-offset-key="3763:0" data-first-offset="true"><span data-slate-string="true">) "1599274925823-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3764"><span data-slate-object="text" data-key="3765"><span data-slate-leaf="true" data-offset-key="3765:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3766"><span data-slate-leaf="true" data-offset-key="3766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3767"><span data-slate-leaf="true" data-offset-key="3767:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3768"><span data-slate-leaf="true" data-offset-key="3768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3769"><span data-slate-leaf="true" data-offset-key="3769:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3770"><span data-slate-object="text" data-key="3771"><span data-slate-leaf="true" data-offset-key="3771:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3772"><span data-slate-leaf="true" data-offset-key="3772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3773"><span data-slate-leaf="true" data-offset-key="3773:0" data-first-offset="true"><span data-slate-string="true">) "2"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3774"><span data-slate-object="text" data-key="3775"><span data-slate-leaf="true" data-offset-key="3775:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3776"><span data-slate-leaf="true" data-offset-key="3776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="3777"><span data-slate-leaf="true" data-offset-key="3777:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3778"><span data-slate-leaf="true" data-offset-key="3778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3779"><span data-slate-leaf="true" data-offset-key="3779:0" data-first-offset="true"><span data-slate-string="true">) "1599274927910-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3780"><span data-slate-object="text" data-key="3781"><span data-slate-leaf="true" data-offset-key="3781:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3782"><span data-slate-leaf="true" data-offset-key="3782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3783"><span data-slate-leaf="true" data-offset-key="3783:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3784"><span data-slate-leaf="true" data-offset-key="3784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3785"><span data-slate-leaf="true" data-offset-key="3785:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3786"><span data-slate-object="text" data-key="3787"><span data-slate-leaf="true" data-offset-key="3787:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3788"><span data-slate-leaf="true" data-offset-key="3788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3789"><span data-slate-leaf="true" data-offset-key="3789:0" data-first-offset="true"><span data-slate-string="true">) "1"</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3790"><span data-slate-object="text" data-key="3791"><span data-slate-leaf="true" data-offset-key="3791:0" data-first-offset="true"><span data-slate-string="true">需要注意的是，</span></span><span data-slate-leaf="true" data-offset-key="3791:1"><span data-slate-object="annotation" data-annotation-key="gkann_102405d5" data-attr-id="29839" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">消息队列中的消息一旦被消费组里的一个消费者读取了，就不能再被该消费组内的其他消费者读取了。</span></span></span><span data-slate-leaf="true" data-offset-key="3791:2"><span data-slate-string="true">比如说，我们执行完刚才的 XREADGROUP 命令后，再执行下面的命令，让 group1 内的 consumer2 读取消息时，consumer2 读到的就是空值，因为消息已经被 consumer1 读取完了，如下所示：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3792"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3793"><span data-slate-object="text" data-key="3794"><span data-slate-leaf="true" data-offset-key="3794:0" data-first-offset="true"><span data-slate-string="true">XREADGROUP </span></span></span><span data-slate-object="text" data-key="3795"><span data-slate-leaf="true" data-offset-key="3795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span><span data-slate-object="text" data-key="3796"><span data-slate-leaf="true" data-offset-key="3796:0" data-first-offset="true"><span data-slate-string="true"> group1 consumer2  streams mqstream </span></span></span><span data-slate-object="text" data-key="3797"><span data-slate-leaf="true" data-offset-key="3797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3798"><span data-slate-object="text" data-key="3799"><span data-slate-leaf="true" data-offset-key="3799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3800"><span data-slate-leaf="true" data-offset-key="3800:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3801"><span data-slate-leaf="true" data-offset-key="3801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3802"><span data-slate-leaf="true" data-offset-key="3802:0" data-first-offset="true"><span data-slate-string="true">) "mqstream"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3803"><span data-slate-object="text" data-key="3804"><span data-slate-leaf="true" data-offset-key="3804:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3805"><span data-slate-leaf="true" data-offset-key="3805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3806"><span data-slate-leaf="true" data-offset-key="3806:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="3807"><span data-slate-leaf="true" data-offset-key="3807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">empty</span></span></span></span><span data-slate-object="text" data-key="3808"><span data-slate-leaf="true" data-offset-key="3808:0" data-first-offset="true"><span data-slate-string="true"> list </span></span></span><span data-slate-object="text" data-key="3809"><span data-slate-leaf="true" data-offset-key="3809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">or</span></span></span></span><span data-slate-object="text" data-key="3810"><span data-slate-leaf="true" data-offset-key="3810:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3811"><span data-slate-leaf="true" data-offset-key="3811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="3812"><span data-slate-leaf="true" data-offset-key="3812:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3813"><span data-slate-object="text" data-key="3814"><span data-slate-leaf="true" data-offset-key="3814:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_6eaf2ca7" data-attr-id="31657" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">使用消费组的目的是让组内的多个消费者共同分担读取消息，所以，我们通常会让每个消费者读取部分消息，从而实现消息读取负载在多个消费者间是均衡分布的。</span></span></span><span data-slate-leaf="true" data-offset-key="3814:1"><span data-slate-string="true">例如，我们执行下列命令，</span></span><span data-slate-leaf="true" data-offset-key="3814:2"><span data-slate-object="annotation" data-annotation-key="gkann_10b9c66d" data-attr-id="44409" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">让 group2 中的 consumer1、2、3 各自读取一条消息。</span></span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3815"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3816"><span data-slate-object="text" data-key="3817"><span data-slate-leaf="true" data-offset-key="3817:0" data-first-offset="true"><span data-slate-string="true">XREADGROUP </span></span></span><span data-slate-object="text" data-key="3818"><span data-slate-leaf="true" data-offset-key="3818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span><span data-slate-object="text" data-key="3819"><span data-slate-leaf="true" data-offset-key="3819:0" data-first-offset="true"><span data-slate-string="true"> group2 consumer1 count </span></span></span><span data-slate-object="text" data-key="3820"><span data-slate-leaf="true" data-offset-key="3820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3821"><span data-slate-leaf="true" data-offset-key="3821:0" data-first-offset="true"><span data-slate-string="true"> streams mqstream </span></span></span><span data-slate-object="text" data-key="3822"><span data-slate-leaf="true" data-offset-key="3822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3823"><span data-slate-object="text" data-key="3824"><span data-slate-leaf="true" data-offset-key="3824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3825"><span data-slate-leaf="true" data-offset-key="3825:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3826"><span data-slate-leaf="true" data-offset-key="3826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3827"><span data-slate-leaf="true" data-offset-key="3827:0" data-first-offset="true"><span data-slate-string="true">) "mqstream"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3828"><span data-slate-object="text" data-key="3829"><span data-slate-leaf="true" data-offset-key="3829:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3830"><span data-slate-leaf="true" data-offset-key="3830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3831"><span data-slate-leaf="true" data-offset-key="3831:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3832"><span data-slate-leaf="true" data-offset-key="3832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3833"><span data-slate-leaf="true" data-offset-key="3833:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3834"><span data-slate-leaf="true" data-offset-key="3834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3835"><span data-slate-leaf="true" data-offset-key="3835:0" data-first-offset="true"><span data-slate-string="true">) "1599203861727-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3836"><span data-slate-object="text" data-key="3837"><span data-slate-leaf="true" data-offset-key="3837:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3838"><span data-slate-leaf="true" data-offset-key="3838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3839"><span data-slate-leaf="true" data-offset-key="3839:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3840"><span data-slate-leaf="true" data-offset-key="3840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3841"><span data-slate-leaf="true" data-offset-key="3841:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3842"><span data-slate-object="text" data-key="3843"><span data-slate-leaf="true" data-offset-key="3843:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3844"><span data-slate-leaf="true" data-offset-key="3844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3845"><span data-slate-leaf="true" data-offset-key="3845:0" data-first-offset="true"><span data-slate-string="true">) "5"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3846"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3847"><span data-slate-object="text" data-key="3848"><span data-slate-leaf="true" data-offset-key="3848:0" data-first-offset="true"><span data-slate-string="true">XREADGROUP </span></span></span><span data-slate-object="text" data-key="3849"><span data-slate-leaf="true" data-offset-key="3849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span><span data-slate-object="text" data-key="3850"><span data-slate-leaf="true" data-offset-key="3850:0" data-first-offset="true"><span data-slate-string="true"> group2 consumer2 count </span></span></span><span data-slate-object="text" data-key="3851"><span data-slate-leaf="true" data-offset-key="3851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3852"><span data-slate-leaf="true" data-offset-key="3852:0" data-first-offset="true"><span data-slate-string="true"> streams mqstream </span></span></span><span data-slate-object="text" data-key="3853"><span data-slate-leaf="true" data-offset-key="3853:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3854"><span data-slate-object="text" data-key="3855"><span data-slate-leaf="true" data-offset-key="3855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3856"><span data-slate-leaf="true" data-offset-key="3856:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3857"><span data-slate-leaf="true" data-offset-key="3857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3858"><span data-slate-leaf="true" data-offset-key="3858:0" data-first-offset="true"><span data-slate-string="true">) "mqstream"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3859"><span data-slate-object="text" data-key="3860"><span data-slate-leaf="true" data-offset-key="3860:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3861"><span data-slate-leaf="true" data-offset-key="3861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3862"><span data-slate-leaf="true" data-offset-key="3862:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3863"><span data-slate-leaf="true" data-offset-key="3863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3864"><span data-slate-leaf="true" data-offset-key="3864:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3865"><span data-slate-leaf="true" data-offset-key="3865:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3866"><span data-slate-leaf="true" data-offset-key="3866:0" data-first-offset="true"><span data-slate-string="true">) "1599274912765-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3867"><span data-slate-object="text" data-key="3868"><span data-slate-leaf="true" data-offset-key="3868:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3869"><span data-slate-leaf="true" data-offset-key="3869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3870"><span data-slate-leaf="true" data-offset-key="3870:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3871"><span data-slate-leaf="true" data-offset-key="3871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3872"><span data-slate-leaf="true" data-offset-key="3872:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3873"><span data-slate-object="text" data-key="3874"><span data-slate-leaf="true" data-offset-key="3874:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3875"><span data-slate-leaf="true" data-offset-key="3875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3876"><span data-slate-leaf="true" data-offset-key="3876:0" data-first-offset="true"><span data-slate-string="true">) "3"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3877"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3878"><span data-slate-object="text" data-key="3879"><span data-slate-leaf="true" data-offset-key="3879:0" data-first-offset="true"><span data-slate-string="true">XREADGROUP </span></span></span><span data-slate-object="text" data-key="3880"><span data-slate-leaf="true" data-offset-key="3880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">group</span></span></span></span><span data-slate-object="text" data-key="3881"><span data-slate-leaf="true" data-offset-key="3881:0" data-first-offset="true"><span data-slate-string="true"> group2 consumer3 count </span></span></span><span data-slate-object="text" data-key="3882"><span data-slate-leaf="true" data-offset-key="3882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3883"><span data-slate-leaf="true" data-offset-key="3883:0" data-first-offset="true"><span data-slate-string="true"> streams mqstream </span></span></span><span data-slate-object="text" data-key="3884"><span data-slate-leaf="true" data-offset-key="3884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3885"><span data-slate-object="text" data-key="3886"><span data-slate-leaf="true" data-offset-key="3886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3887"><span data-slate-leaf="true" data-offset-key="3887:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3888"><span data-slate-leaf="true" data-offset-key="3888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3889"><span data-slate-leaf="true" data-offset-key="3889:0" data-first-offset="true"><span data-slate-string="true">) "mqstream"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3890"><span data-slate-object="text" data-key="3891"><span data-slate-leaf="true" data-offset-key="3891:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3892"><span data-slate-leaf="true" data-offset-key="3892:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3893"><span data-slate-leaf="true" data-offset-key="3893:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3894"><span data-slate-leaf="true" data-offset-key="3894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3895"><span data-slate-leaf="true" data-offset-key="3895:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3896"><span data-slate-leaf="true" data-offset-key="3896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3897"><span data-slate-leaf="true" data-offset-key="3897:0" data-first-offset="true"><span data-slate-string="true">) "1599274925823-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3898"><span data-slate-object="text" data-key="3899"><span data-slate-leaf="true" data-offset-key="3899:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="3900"><span data-slate-leaf="true" data-offset-key="3900:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3901"><span data-slate-leaf="true" data-offset-key="3901:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3902"><span data-slate-leaf="true" data-offset-key="3902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3903"><span data-slate-leaf="true" data-offset-key="3903:0" data-first-offset="true"><span data-slate-string="true">) "repo"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3904"><span data-slate-object="text" data-key="3905"><span data-slate-leaf="true" data-offset-key="3905:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3906"><span data-slate-leaf="true" data-offset-key="3906:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3907"><span data-slate-leaf="true" data-offset-key="3907:0" data-first-offset="true"><span data-slate-string="true">) "2"</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3908"><span data-slate-object="text" data-key="3909"><span data-slate-leaf="true" data-offset-key="3909:0" data-first-offset="true"><span data-slate-string="true">为了保证消费者在发生故障或宕机再次重启后，仍然可以读取未处理完的消息，</span></span><span data-slate-leaf="true" data-offset-key="3909:1"><span data-slate-object="annotation" data-annotation-key="gkann_e13abda8" data-attr-id="35698" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Streams 会自动使用内部队列（也称为 PENDING List）留存消费组里每个消费者读取的消息，直到消费者使用 XACK 命令通知 Streams “消息已经处理完成”。</span></span></span><span data-slate-leaf="true" data-offset-key="3909:2"><span data-slate-string="true">如果消费者没有成功处理消息，它就不会给 Streams 发送 XACK 命令，消息仍然会留存。此时，消费者可以在重启后，</span></span><span data-slate-leaf="true" data-offset-key="3909:3"><span data-slate-object="annotation" data-annotation-key="gkann_7907375e" data-attr-id="35699" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">用 XPENDING 命令查看已读取、但尚未确认处理完成的消息。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3910"><span data-slate-object="text" data-key="3911"><span data-slate-leaf="true" data-offset-key="3911:0" data-first-offset="true"><span data-slate-string="true">例如，我们来查看一下 group2 中各个消费者已读取、但尚未确认的消息个数。其中，XPENDING 返回结果的第二、三行分别表示 group2 中所有消费者读取的消息最小 ID 和最大 ID。</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3912"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3913"><span data-slate-object="text" data-key="3914"><span data-slate-leaf="true" data-offset-key="3914:0" data-first-offset="true"><span data-slate-string="true">XPENDING mqstream group2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3915"><span data-slate-object="text" data-key="3916"><span data-slate-leaf="true" data-offset-key="3916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3917"><span data-slate-leaf="true" data-offset-key="3917:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="3918"><span data-slate-leaf="true" data-offset-key="3918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">integer</span></span></span></span><span data-slate-object="text" data-key="3919"><span data-slate-leaf="true" data-offset-key="3919:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3920"><span data-slate-leaf="true" data-offset-key="3920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3921"><span data-slate-object="text" data-key="3922"><span data-slate-leaf="true" data-offset-key="3922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3923"><span data-slate-leaf="true" data-offset-key="3923:0" data-first-offset="true"><span data-slate-string="true">) "1599203861727-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3924"><span data-slate-object="text" data-key="3925"><span data-slate-leaf="true" data-offset-key="3925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="3926"><span data-slate-leaf="true" data-offset-key="3926:0" data-first-offset="true"><span data-slate-string="true">) "1599274925823-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3927"><span data-slate-object="text" data-key="3928"><span data-slate-leaf="true" data-offset-key="3928:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="3929"><span data-slate-leaf="true" data-offset-key="3929:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3930"><span data-slate-leaf="true" data-offset-key="3930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3931"><span data-slate-leaf="true" data-offset-key="3931:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3932"><span data-slate-leaf="true" data-offset-key="3932:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3933"><span data-slate-leaf="true" data-offset-key="3933:0" data-first-offset="true"><span data-slate-string="true">) "consumer1"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3934"><span data-slate-object="text" data-key="3935"><span data-slate-leaf="true" data-offset-key="3935:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3936"><span data-slate-leaf="true" data-offset-key="3936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3937"><span data-slate-leaf="true" data-offset-key="3937:0" data-first-offset="true"><span data-slate-string="true">) "1"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3938"><span data-slate-object="text" data-key="3939"><span data-slate-leaf="true" data-offset-key="3939:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3940"><span data-slate-leaf="true" data-offset-key="3940:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3941"><span data-slate-leaf="true" data-offset-key="3941:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3942"><span data-slate-leaf="true" data-offset-key="3942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3943"><span data-slate-leaf="true" data-offset-key="3943:0" data-first-offset="true"><span data-slate-string="true">) "consumer2"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3944"><span data-slate-object="text" data-key="3945"><span data-slate-leaf="true" data-offset-key="3945:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3946"><span data-slate-leaf="true" data-offset-key="3946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3947"><span data-slate-leaf="true" data-offset-key="3947:0" data-first-offset="true"><span data-slate-string="true">) "1"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3948"><span data-slate-object="text" data-key="3949"><span data-slate-leaf="true" data-offset-key="3949:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3950"><span data-slate-leaf="true" data-offset-key="3950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="3951"><span data-slate-leaf="true" data-offset-key="3951:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3952"><span data-slate-leaf="true" data-offset-key="3952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3953"><span data-slate-leaf="true" data-offset-key="3953:0" data-first-offset="true"><span data-slate-string="true">) "consumer3"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3954"><span data-slate-object="text" data-key="3955"><span data-slate-leaf="true" data-offset-key="3955:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="3956"><span data-slate-leaf="true" data-offset-key="3956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3957"><span data-slate-leaf="true" data-offset-key="3957:0" data-first-offset="true"><span data-slate-string="true">) "1"</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3958"><span data-slate-object="text" data-key="3959"><span data-slate-leaf="true" data-offset-key="3959:0" data-first-offset="true"><span data-slate-string="true">如果我们还需要进一步查看某个消费者具体读取了哪些数据，可以执行下面的命令：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3960"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3961"><span data-slate-object="text" data-key="3962"><span data-slate-leaf="true" data-offset-key="3962:0" data-first-offset="true"><span data-slate-string="true">XPENDING mqstream group2 </span></span></span><span data-slate-object="text" data-key="3963"><span data-slate-leaf="true" data-offset-key="3963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="3964"><span data-slate-leaf="true" data-offset-key="3964:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3965"><span data-slate-leaf="true" data-offset-key="3965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">+</span></span></span></span><span data-slate-object="text" data-key="3966"><span data-slate-leaf="true" data-offset-key="3966:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3967"><span data-slate-leaf="true" data-offset-key="3967:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="3968"><span data-slate-leaf="true" data-offset-key="3968:0" data-first-offset="true"><span data-slate-string="true"> consumer2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3969"><span data-slate-object="text" data-key="3970"><span data-slate-leaf="true" data-offset-key="3970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3971"><span data-slate-leaf="true" data-offset-key="3971:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3972"><span data-slate-leaf="true" data-offset-key="3972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3973"><span data-slate-leaf="true" data-offset-key="3973:0" data-first-offset="true"><span data-slate-string="true">) "1599274912765-0"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3974"><span data-slate-object="text" data-key="3975"><span data-slate-leaf="true" data-offset-key="3975:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3976"><span data-slate-leaf="true" data-offset-key="3976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3977"><span data-slate-leaf="true" data-offset-key="3977:0" data-first-offset="true"><span data-slate-string="true">) "consumer2"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3978"><span data-slate-object="text" data-key="3979"><span data-slate-leaf="true" data-offset-key="3979:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3980"><span data-slate-leaf="true" data-offset-key="3980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">3</span></span></span></span><span data-slate-object="text" data-key="3981"><span data-slate-leaf="true" data-offset-key="3981:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="3982"><span data-slate-leaf="true" data-offset-key="3982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">integer</span></span></span></span><span data-slate-object="text" data-key="3983"><span data-slate-leaf="true" data-offset-key="3983:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3984"><span data-slate-leaf="true" data-offset-key="3984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">513336</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3985"><span data-slate-object="text" data-key="3986"><span data-slate-leaf="true" data-offset-key="3986:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="3987"><span data-slate-leaf="true" data-offset-key="3987:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="3988"><span data-slate-leaf="true" data-offset-key="3988:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="3989"><span data-slate-leaf="true" data-offset-key="3989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">integer</span></span></span></span><span data-slate-object="text" data-key="3990"><span data-slate-leaf="true" data-offset-key="3990:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="3991"><span data-slate-leaf="true" data-offset-key="3991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3992"><span data-slate-object="text" data-key="3993"><span data-slate-leaf="true" data-offset-key="3993:0" data-first-offset="true"><span data-slate-string="true">可以看到，consumer2 已读取的消息的 ID 是 1599274912765-0。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3994"><span data-slate-object="text" data-key="3995"><span data-slate-leaf="true" data-offset-key="3995:0" data-first-offset="true"><span data-slate-string="true">一旦消息 1599274912765-0 被 consumer2 处理了，consumer2 就可以使用 XACK 命令通知 Streams，然后这条消息就会被删除。当我们再使用 XPENDING 命令查看时，就可以看到，consumer2 已经没有已读取、但尚未确认处理的消息了。</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="3996"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3997"><span data-slate-object="text" data-key="3998"><span data-slate-leaf="true" data-offset-key="3998:0" data-first-offset="true"><span data-slate-string="true"> XACK mqstream group2 </span></span></span><span data-slate-object="text" data-key="3999"><span data-slate-leaf="true" data-offset-key="3999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1599274912765</span></span></span></span><span data-slate-object="text" data-key="4000"><span data-slate-leaf="true" data-offset-key="4000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4001"><span data-slate-object="text" data-key="4002"><span data-slate-leaf="true" data-offset-key="4002:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="4003"><span data-slate-leaf="true" data-offset-key="4003:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">integer</span></span></span></span><span data-slate-object="text" data-key="4004"><span data-slate-leaf="true" data-offset-key="4004:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="4005"><span data-slate-leaf="true" data-offset-key="4005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4006"><span data-slate-object="text" data-key="4007"><span data-slate-leaf="true" data-offset-key="4007:0" data-first-offset="true"><span data-slate-string="true">XPENDING mqstream group2 </span></span></span><span data-slate-object="text" data-key="4008"><span data-slate-leaf="true" data-offset-key="4008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="4009"><span data-slate-leaf="true" data-offset-key="4009:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4010"><span data-slate-leaf="true" data-offset-key="4010:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">+</span></span></span></span><span data-slate-object="text" data-key="4011"><span data-slate-leaf="true" data-offset-key="4011:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4012"><span data-slate-leaf="true" data-offset-key="4012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">10</span></span></span></span><span data-slate-object="text" data-key="4013"><span data-slate-leaf="true" data-offset-key="4013:0" data-first-offset="true"><span data-slate-string="true"> consumer2</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4014"><span data-slate-object="text" data-key="4015"><span data-slate-leaf="true" data-offset-key="4015:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="4016"><span data-slate-leaf="true" data-offset-key="4016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">empty</span></span></span></span><span data-slate-object="text" data-key="4017"><span data-slate-leaf="true" data-offset-key="4017:0" data-first-offset="true"><span data-slate-string="true"> list </span></span></span><span data-slate-object="text" data-key="4018"><span data-slate-leaf="true" data-offset-key="4018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">or</span></span></span></span><span data-slate-object="text" data-key="4019"><span data-slate-leaf="true" data-offset-key="4019:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4020"><span data-slate-leaf="true" data-offset-key="4020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">set</span></span></span></span><span data-slate-object="text" data-key="4021"><span data-slate-leaf="true" data-offset-key="4021:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4022"><span data-slate-object="text" data-key="4023"><span data-slate-leaf="true" data-offset-key="4023:0" data-first-offset="true"><span data-slate-string="true">现在，我们就知道了用 Streams 实现消息队列的方法，我还想再强调下，Streams 是 Redis 5.0 专门针对消息队列场景设计的数据类型，如果你的 Redis 是 5.0 及 5.0 以后的版本，就可以考虑把 Streams 用作消息队列了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4024" id="sr-toc-7"><span data-slate-object="text" data-key="4025"><span data-slate-leaf="true" data-offset-key="4025:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4026"><span data-slate-object="text" data-key="4027"><span data-slate-leaf="true" data-offset-key="4027:0" data-first-offset="true"><span data-slate-string="true">这节课，</span></span><span data-slate-leaf="true" data-offset-key="4027:1"><span data-slate-object="annotation" data-annotation-key="gkann_c58f704e" data-attr-id="14988" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们学习了分布式系统组件使用消息队列时的三大需求：消息保序、重复消息处理和消息可靠性保证，</span></span></span><span data-slate-leaf="true" data-offset-key="4027:2"><span data-slate-object="annotation" data-annotation-key="gkann_29ed7e73" data-attr-id="14989" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">这三大需求可以进一步转换为对消息队列的三大要求：消息数据有序存取，消息数据具有全局唯一编号，以及消息数据在消费完成后被删除。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4028"><span data-slate-object="text" data-key="4029"><span data-slate-leaf="true" data-offset-key="4029:0" data-first-offset="true"><span data-slate-string="true">我画了一张表格，汇总了用 List 和 Streams 实现消息队列的特点和区别。当然，在实践的过程中，你也可以根据新的积累，进一步补充和完善这张表。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="4030"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b2/14/b2d6581e43f573da6218e790bb8c6814.jpg?wh=2922*943"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4031"><span data-slate-object="text" data-key="4032"><span data-slate-leaf="true" data-offset-key="4032:0" data-first-offset="true"><span data-slate-string="true">其实，关于 Redis 是否适合做消息队列，业界一直是有争论的。很多人认为，要使用消息队列，就应该采用 Kafka、RabbitMQ 这些专门面向消息队列场景的软件，而 Redis 更加适合做缓存。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4033"><span data-slate-object="text" data-key="4034"><span data-slate-leaf="true" data-offset-key="4034:0" data-first-offset="true"><span data-slate-string="true">根据这些年做 Redis 研发工作的经验，我的看法是：Redis 是一个非常轻量级的键值数据库，部署一个 Redis 实例就是启动一个进程，部署 Redis 集群，也就是部署多个 Redis 实例。而 Kafka、RabbitMQ 部署时，涉及额外的组件，例如 Kafka 的运行就需要再部署 ZooKeeper。相比 Redis 来说，Kafka 和 RabbitMQ 一般被认为是重量级的消息队列。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4035"><span data-slate-object="text" data-key="4036"><span data-slate-leaf="true" data-offset-key="4036:0" data-first-offset="true"><span data-slate-string="true">所以，关于是否用 Redis 做消息队列的问题，不能一概而论，我们需要考虑业务层面的数据体量，以及对性能、可靠性、可扩展性的需求。如果分布式系统中的组件消息通信量不大，那么，Redis 只需要使用有限的内存空间就能满足消息存储的需求，而且，Redis 的高性能特性能支持快速的消息读写，不失为消息队列的一个好的解决方案。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4037" id="sr-toc-8"><span data-slate-object="text" data-key="4038"><span data-slate-leaf="true" data-offset-key="4038:0" data-first-offset="true"><span data-slate-string="true">每课一问</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4039"><span data-slate-object="text" data-key="4040"><span data-slate-leaf="true" data-offset-key="4040:0" data-first-offset="true"><span data-slate-string="true">按照惯例，我给你提个小问题。如果一个生产者发送给消息队列的消息，需要被多个消费者进行读取和处理（例如，一个消息是一条从业务系统采集的数据，既要被消费者 1 读取进行实时计算，也要被消费者 2 读取并留存到分布式文件系统 HDFS 中，以便后续进行历史查询），</span></span><span data-slate-leaf="true" data-offset-key="4040:1"><span data-slate-object="annotation" data-annotation-key="gkann_3d62bea1" data-attr-id="18975" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">你会使用 Redis 的什么数据类型来解决这个问题呢？</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4041"><span data-slate-object="text" data-key="4042"><span data-slate-leaf="true" data-offset-key="4042:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区写下你的思考和答案，如果觉得今天的内容对你有所帮助，也欢迎你帮我分享给更多人。我们下节课见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>68</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-9">精选留言 (52)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Kaito</span></div></div><div>如果一个生产者发送给消息队列的消息，需要被多个消费者进行读取和处理，你会使用 Redis 的什么数据类型来解决这个问题？

这种情况下，只能使用 Streams 数据类型来解决。使用 Streams 数据类型，创建多个消费者组，就可以实现同时消费生产者的数据。每个消费者组内可以再挂多个消费者分担读取消息进行消费，消费完成后，各自向 Redis 发送 XACK，标记自己的消费组已经消费到了哪个位置，而且消费组之间互不影响。

另外，老师在介绍使用 List 用作队列时，为了保证消息可靠性，使用 BRPOPLPUSH 命令把消息取出的同时，还把消息插入到备份队列中，从而防止消费者故障导致消息丢失。

这种情况下，还需要额外做一些工作，也就是维护这个备份队列：每次执行 BRPOPLPUSH 命令后，因为都会把消息插入一份到备份队列中，所以当消费者成功消费取出的消息后，最好把备份队列中的消息删除，防止备份队列存储过多无用的数据，导致内存浪费。

这篇文章主要是讲消息队列的使用，借这个机会，也顺便总结一下使用消息队列时的注意点：

在使用消息队列时，重点需要关注的是如何保证不丢消息？

那么下面就来分析一下，哪些情况下，会丢消息，以及如何解决？

1、生产者在发布消息时异常：

a) 网络故障或其他问题导致发布失败（直接返回错误，消息根本没发出去）
b) 网络抖动导致发布超时（可能发送数据包成功，但读取响应结果超时了，不知道结果如何）

情况 a 还好，消息根本没发出去，那么重新发一次就好了。但是情况 b 没办法知道到底有没有发布成功，所以也只能再发一次。所以这两种情况，生产者都需要重新发布消息，直到成功为止（一般设定一个最大重试次数，超过最大次数依旧失败的需要报警处理）。这就会导致消费者可能会收到重复消息的问题，所以消费者需要保证在收到重复消息时，依旧能保证业务的正确性（设计幂等逻辑），一般需要根据具体业务来做，例如使用消息的唯一 ID，或者版本号配合业务逻辑来处理。

2、消费者在处理消息时异常：

也就是消费者把消息拿出来了，但是还没处理完，消费者就挂了。这种情况，需要消费者恢复时，依旧能处理之前没有消费成功的消息。使用 List 当作队列时，也就是利用老师文章所讲的备份队列来保证，代价是增加了维护这个备份队列的成本。而 Streams 则是采用 ack 的方式，消费成功后告知中间件，这种方式处理起来更优雅，成熟的队列中间件例如 RabbitMQ、Kafka 都是采用这种方式来保证消费者不丢消息的。

3、消息队列中间件丢失消息

上面 2 个层面都比较好处理，只要客户端和服务端配合好，就能保证生产者和消费者都不丢消息。但是，如果消息队列中间件本身就不可靠，也有可能会丢失消息，毕竟生产者和消费这都依赖它，如果它不可靠，那么生产者和消费者无论怎么做，都无法保证数据不丢失。

a) 在用 Redis 当作队列或存储数据时，是有可能丢失数据的：一个场景是，如果打开 AOF 并且是每秒写盘，因为这个写盘过程是异步的，Redis 宕机时会丢失 1 秒的数据。而如果 AOF 改为同步写盘，那么写入性能会下降。另一个场景是，如果采用主从集群，如果写入量比较大，从库同步存在延迟，此时进行主从切换，也存在丢失数据的可能（从库还未同步完成主库发来的数据就被提成主库）。总的来说，Redis 不保证严格的数据完整性和主从切换时的一致性。我们在使用 Redis 时需要注意。

b) 而采用 RabbitMQ 和 Kafka 这些专业的队列中间件时，就没有这个问题了。这些组件一般是部署一个集群，生产者在发布消息时，队列中间件一般会采用写多个节点 + 预写磁盘的方式保证消息的完整性，即便其中一个节点挂了，也能保证集群的数据不丢失。当然，为了做到这些，方案肯定比 Redis 设计的要复杂（毕竟是专们针对队列场景设计的）。

综上，Redis 可以用作队列，而且性能很高，部署维护也很轻量，但缺点是无法严格保数据的完整性（个人认为这就是业界有争议要不要使用 Redis 当作队列的地方）。而使用专业的队列中间件，可以严格保证数据的完整性，但缺点是，部署维护成本高，用起来比较重。

所以我们需要根据具体情况进行选择，如果对于丢数据不敏感的业务，例如发短信、发通知的场景，可以采用 Redis 作队列。如果是金融相关的业务场景，例如交易、支付这类，建议还是使用专业的队列中间件。</div><div><div>2020-09-11</div><div><div><i></i><span>60</span></div><div><i></i><span>493</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>每次想回答问题，看到 Kaito 的留言，顿时就有一种 “眼前有景道不得，崔颢题诗在上头” 的感觉。</div><div><div>2020-09-11</div><div><div><i></i><span>10</span></div><div><i></i><span>124</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/fd/fd/326be9bb.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 注定非凡</span></div></div><div>1，作者讲了什么？
    如何使用 redis 实现消息队列的需求

2，作者是怎么把这事给说明白的？
    1，将一个问题拆解为两个具体的小问题：消息队列应具备哪些特性，Redis 能否实现这些特性

3，为了讲明白，作者讲了哪些要点？，有哪些亮点？
    1，亮点 1：作者首先将一个相对模糊的问题，拆解成为两个问题更精确的问题
    2，要点 1：消息队列读取需求有三点：消息保存，消息唯一，消息可靠性
    3，要点 2：消息还要确保有序，削峰平谷，消费性能有弹性
    4，要点 3：Redis 的 list 和 5.0 后的 Stream 数据结构可以满足
    5，要点 4：消息队列的三大要求：消息数据有序存取，消息数据具有全局唯一编号，消息数据在消费完成后被删除
    
4，对于作者所讲，我有哪些发散性思考？
  	解决问题的前提是搞清楚问题是什么
	开篇：“Redis 适合做消息队列吗”？对于这样的问题，我本能的就会直接想：“用 Redis 做消息队列？应该可以吧，很多资料上都这么说的”。
	这样的回答，证明我并没有思考，只是陈述了我所知道的一点东西。我总是渴求快速有个答案，没有在意答案是否正确，更没有思考该如何回答问题。
	虽然我总会说要想解决问题，首先要搞清楚问题是什么。这个句话似乎有点白痴，自己遇到的问题，这个问题不就它本身吗？怎么还会需要搞清楚呢？
	其实不然，我们遇到的往往未必是问题的真身，而只是问题的表面现象或衍生出的问题。其实一个好问题的本身，就是一个好答案，而一个好问题胜过无数好答案。
	那什么才是真正的解答问题？这需要先回答如何回答这个问题，也就是要先搞清楚要从哪些方面解释问题，而不是铺陈信息。
	老师开篇对问题的回答方法，就是个非常好的范例
	他是怎么解答的呢？
	他并没有立即回答行或不行（这是我们最常有的反应），而是向后退了一步，问这个问题真正的问题是啥呢？消息队列存取消息需要哪些特性？Redis 如何实现这些特性？
	这就将一个相对模糊的问题拆解为两个较清晰的小问题，分别作答，最终得到一篇很好的文章

5，将来在哪些场景里，我能够使用它？

6，留言区收获
1，Redis 是否可以作为消息队列？如果可以，哪些场景适合使用 Redis，而不是消息中间件？
	答：这个问题应当进一步拆分为：消息队列读写消息有哪些需求和 Redis 如何实现这些需求。
        首先消息队列的消息读写有三大需求：消息读写的有序性，消息数据的唯一性，消息消费后数据删除。
        针对这三大需求，Redis 的 List 和 5.0 后的 Stream 数据结构，可以支持。
        对于 List，POP 和 PUSH 命令，还有阻塞式的，备份式的。
        对于 Stream，是 Redis5.0 后提供新的数据结构，专门用户消息队列，他可以生成全局唯一 id，还有能够创建消费者组，多个消费者同时消费
        Stream 类型，使用了应答机制，消费者消费完毕后会给 Streams 发送 XACK 命令，否则消息将会保存 Streams 的内部队列中，使用 XPENDING 命令可以查看
       就 Redis 的相关数据结构而言，是可以作为消息队列的。但也要注意使用它的场景，虽然它性能很高，部署维护也轻量，但缺点是无法严格保证数据的完整性。
    他适用于消息量并不是非常巨大，数据不是非常重要，从而不必引入其他消息组件的场景，如发短信，站内信

2，如果一个生产者发送给消息队列的消息，需要被多个消费者进行读取和处理，Redis 的什么数据类型可以解决这个问题？
    答：如果要使用 Redis 实现这个需求，Redis 的 Streams 数据类型可以实现。
		Streams 可以使用 XADD 向队列中写入消息，XGOURP 创建消费者组，XREADGROUP 已消费者组形式消费消息，XACK 向消息队列确认处理完成，XPENDING 查询已消费待确认的消息

3，如果使用 Redis 作为消息队列，有哪些事项需要注意？
    答：消息的可靠性，重点需要关注的是如何保证不丢消息


4，在使用消息队列时，如何保证不丢消息？
    答：消息丢失可能会发生在三个环节：生产者发布消息，消息者消费消息，消息中间件丢失消息
    生产者丢失消息一般通过重试机制和全局唯一 id 来解决，
	消费者消费消息一般通过 ack 方式问询上报消费进度，
	消息中间件宕机，一般通过主从备份，分布式集群来解决</div><div><div>2020-10-19</div><div><div><i></i><span>6</span></div><div><i></i><span>50</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132"></div></div><div><div><div><span>walle 斌</span></div></div><div>redis 作为队列，我觉得最大的问题应该是消息积压的问题。。任何一个 mq 都要应对 高流量的消息积压问题。 </div><div><p>作者回复：是的。所以，如果应用场景中压力不大，Redis 应用起来也相对简单，可以作为一个方案备选。但是如果消息压力大，还是会考虑专用的一些 MQ，例如 Kafka。</p></div><div><div>2020-12-10</div><div><div><i></i><span>5</span></div><div><i></i><span>13</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/62/c9/7da27891.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>DKSky</span></div></div><div>老师的文中说 “我们希望启动多个消费者程序组成一个消费组，一起分担处理 List 中的消息。但是，List 类型并不支持消费组的实现。那么，还有没有更合适的解决方案呢？“这句话不太明白，如果多个消费者客户端使用 brpop 命令阻塞式的 “抢” 列表尾部的元素，这些消费者不属于同一个 consumer group 吗？</div><div><div>2020-09-11</div><div><div><i></i><span>5</span></div><div><i></i><span>12</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/3e/3a/2267d2a3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>hoppo</span></div></div><div>关于顺序消费的问题，其实要严格保证顺序的话，只有生产者 - 队列 - 消费者完全的一对一才行。就好比 List 这种。

如果使用 Stream 消费组的话，多个消费者一起操作的时候，是没法保证顺序性的。

专业的消息队列中间件一般都采用局部有序的方法：需要有序操作的部分通过路由发到一个队列中，队列 - 消费者采用一对一的方式。
</div><div><div>2020-11-15</div><div><div><i></i><span>1</span></div><div><i></i><span>9</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/ed/89/86340059.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>licong</span></div></div><div>redis 的 publish/subscribe 也可以作为简单的 MQ 使用，老师的专栏好像没提到这个</div><div><div>2021-09-13</div><div><div><i></i><span>2</span></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/23/24/e5/a83c0ff5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Aecho1610213142</span></div></div><div>老师好！多个消费者 如何保证消息的顺序执行？</div><div><div>2020-11-13</div><div><div><i></i><span>3</span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/cf/81/96f656ef.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 杨逸林</span></div></div><div>1. 问题回答
每个 Stream 都可以挂多个消费组，每个消费组会有个游标 last_delivered_id 在 Stream 数组之上往前移动，表示当前消费组已经消费到哪条消息了。如果这是对的，那只需要开两个消费者组，消费者 1 在组 1，消费者 2 在组 2 不就行了么。
这个 last_delivered_id 有点像 Kafka 的 offset。

2. 有点不同的观点
Kafka 其实已经考虑去掉 ZK 了，而且适合高吞吐量的业务，不过不适合流式处理。专业的事，还是教给专业的来做好点。

我之前用过 Redis 的 publish 和 subscribe 命令来做不同系统的数据同步。不过那个在用 Jedis 来订阅有坑，必须循环调用，不然会在一定时间后被 down 掉。</div><div><div>2020-09-11</div><div><div><i></i><span></span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Lywane</span></div></div><div>我们希望启动多个消费者程序组成一个消费组，一起分担处理 List 中的消息。但是，List 类型并不支持消费组的实现 （多个消费者执行 BRPOP 不行吗）</div><div><div>2020-11-12</div><div><div><i></i><span></span></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/f4/14/c1c81d88.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Luke 💨</span></div></div><div>不懂为啥要用这种模式实现消息队列，感觉有点牵强，而且大部分功能需要自己实现，redis 内部不是有发布订阅模式吗，就是一种消息队列啊，两者有啥不一样吗？</div><div><div>2020-11-21</div><div><div><i></i><span>5</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小喵喵</span></div></div><div>请教下老师两个问题：
1. 如果消息延迟了，如何做好监控？
2. 如何尽可能的减少消息的延迟，我好像知道一个很牛逼的技术叫 “零拷贝”，但是不太理解其原理，望老师解惑。谢谢。</div><div><div>2020-09-11</div><div><div><i></i><span>1</span></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Yipsen</span></div></div><div>消费组消费时虽然分摊了压力，但是怎么保证顺序消费呢？如果要保证岂不是要上一条消息的消费者必须发出 ack 后，消费组的另一个成员消费者才能开始消费消息，那不就等于加锁来保证顺序了，这样是不是消费组分摊就形同虚设或者没有起到应有的作用了？所以负载处理 + 顺序消费 redis stream 是怎么保证的？</div><div><div>2021-12-03</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/42/53/577009a5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Wang Junling</span></div></div><div>我对 Redis 的源码不是很熟，如果位大佬看到我的提问请帮忙解释一下。
1、LPUSH 和 RPUSH 的运行原理是什么样的呢？时间算法复杂度是？
2、RPOP 和 LPOP 的运行原理和时间复杂度是什么样的呢？</div><div><div>2021-02-28</div><div><div><i></i><span>1</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>dfuru</span></div></div><div>使用 list，list 留存消息队列消费者可指定，且消费者 2 读取后再删除。
stream 留存消息队列是内部匿名的，且消费者 1 消费完发送 ACK 后，消息就被删除，导致消费者 2 读取不到。</div><div><div>2020-09-24</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/b6/75/32c19395.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 土豆白菜</span></div></div><div>茅草房 - 土房 - 平房</div><div><div>2020-09-11</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/59/8c/ba81a832.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 刀斧手何在</span></div></div><div>Redis 做消息队列的优势是高并发写入性能和水平扩展能力。最大的坑 我觉得就是 Kaito 同学说的第 3 点 数据可靠性</div><div><div>2020-09-11</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/41/13/ab14ad25.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 树心</span></div></div><div>评论区小收获：命令的时间复杂度可以在官网查看</div><div><div>2021-12-15</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/ee/c6/bebcbcf0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 俯瞰风景.</span></div></div><div>消息队列的目的是在分布式的系统间进行通信，通信方式是通过网络传输的方式，通过网络传输就有消息丢失、重复发送消息、不同消息到达顺序混乱的可能。所以消息队列应用的三大需求是：
  1、消息保序
  2、重复消息处理
  3、消息可靠性保证

对应处理方案是：
  1、消息数据有序存取
  2、消息数据具有全局唯一编号
  3、消息数据在未消费完宕机恢复时继续消费，消费完成后被删除</div><div><div>2021-09-30</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>HJ_Liu</span></div></div><div>老师你好，有个问题想更深入了解下。用 Stream 类型用作消息队列，用多个消费组，是不是也不能保证处理的顺序性？</div><div><div>2021-09-23</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1a"><outline class="toc-level-h1" data-reactid=".1a.0" style="width: 175px;"><active data-reactid=".1a.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1a.0.1"><span data-reactid=".1a.0.1.0">15 | 消息队列的考验：Redis 有哪些解决方案？</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.1" style="width: 165px;"><active data-reactid=".1a.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1a.1.1"><span data-reactid=".1a.1.1.0">消息队列的消息存取需求</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.2" style="width: 155px;"><active data-reactid=".1a.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1a.2.1"><span data-reactid=".1a.2.1.0">需求一：消息保序</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.3" style="width: 155px;"><active data-reactid=".1a.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1a.3.1"><span data-reactid=".1a.3.1.0">需求二：重复消息处理</span></a></outline><outline class="toc-level-h3" data-reactid=".1a.4" style="width: 155px;"><active data-reactid=".1a.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1a.4.1"><span data-reactid=".1a.4.1.0">需求三：消息可靠性保证</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.5" style="width: 165px;"><active data-reactid=".1a.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1a.5.1"><span data-reactid=".1a.5.1.0">基于 List 的消息队列解决方案</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.6" style="width: 165px;"><active data-reactid=".1a.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1a.6.1"><span data-reactid=".1a.6.1.0">基于 Streams 的消息队列解决方案</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.7" style="width: 165px;"><active data-reactid=".1a.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1a.7.1"><span data-reactid=".1a.7.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.8" style="width: 165px;"><active data-reactid=".1a.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1a.8.1"><span data-reactid=".1a.8.1.0">每课一问</span></a></outline><outline class="toc-level-h2" data-reactid=".1a.9" style="width: 165px;"><active data-reactid=".1a.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1a.9.1"><span data-reactid=".1a.9.1.0">精选留言 (52)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/284291" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>