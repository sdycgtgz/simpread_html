
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 05｜封装：如何让你的框架更好用？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>05｜封装：如何让你的框架更好用？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">05｜封装：如何让你的框架更好用？</h1><div><span>叶剑峰</span> <span> 2021-09-22</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/2e/8d/2e8339a81e67de613fd17a4125c0728d.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：叶剑峰</span><span>大小：16.12M</span><span> 时长：17:39</span></div></div><audio title="05｜封装：如何让你的框架更好用？" src="https://res001.geekbang.org/media/audio/7d/5e/7d784ba00a0445f9ca521fe739b4425e/ld/ld.m3u8" __idm_id__="696326"></audio></div><div><div><div><div data-slate-editor="true" data-key="5070" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="5071"><span data-slate-object="text" data-key="5072"><span data-slate-leaf="true" data-offset-key="5072:0" data-first-offset="true"><span data-slate-string="true">你好，我是轩脉刃。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5073"><span data-slate-object="text" data-key="5074"><span data-slate-leaf="true" data-offset-key="5074:0" data-first-offset="true"><span data-slate-string="true">在前面几节课，我们实现了框架的路由、中间件等机制，并且自定义 context 结构来封装请求。但是回顾在对 context 的封装中，我们只是将 request、response 结构直接放入 context 结构体中，对应的方法并没有很好的封装。所以这节课，我们要做的事情就是为 context 封装更多的方法，让框架更好用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5075"><span data-slate-object="text" data-key="5076"><span data-slate-leaf="true" data-offset-key="5076:0" data-first-offset="true"><span data-slate-string="true">在今天的学习中，希望你能认识到，函数封装并不是一件很简单、很随意的事情。相反，如何封装出易用、可读性高的函数是非常需要精心考量的，</span></span></span><span data-slate-object="text" data-key="5077"><span data-slate-leaf="true" data-offset-key="5077:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">框架中每个函数的参数、返回值、命名，都代表着我们作为作者在某个事情上的思考</span></span></span></span><span data-slate-object="text" data-key="5078"><span data-slate-leaf="true" data-offset-key="5078:0" data-first-offset="true"><span data-slate-string="true">。想要针对某个功能，封装出一系列比较完美的接口，更要我们从系统性的角度思考。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5079" id="sr-toc-1"><span data-slate-object="text" data-key="5080"><span data-slate-leaf="true" data-offset-key="5080:0" data-first-offset="true"><span data-slate-string="true">思考如何封装请求和返回</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5081"><span data-slate-object="text" data-key="5082"><span data-slate-leaf="true" data-offset-key="5082:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_809ef58e" data-attr-id="39361" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们的目标是尽量在 context 这个数据结构中，封装 “读取请求数据” 和 “封装返回数据” 中的方法。</span></span></span><span data-slate-leaf="true" data-offset-key="5082:1"><span data-slate-string="true">在动手之前还是先做到心中有数，我们将请求和返回这两个事情分开思考。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5083"><div data-slate-type="list-line" data-slate-object="block" data-key="5084"><span data-slate-object="text" data-key="5085"><span data-slate-leaf="true" data-offset-key="5085:0" data-first-offset="true"><span data-slate-string="true">读取请求数据</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5086"><span data-slate-object="text" data-key="5087"><span data-slate-leaf="true" data-offset-key="5087:0" data-first-offset="true"><span data-slate-string="true">要读取请求数据包含哪些内容呢？第一讲我们提到过，HTTP 消息体分为两个部分：HTTP 头部和 HTTP Body 体。头部描述的一般是和业务无关但与传输相关的信息，比如请求地址、编码格式、缓存时长等；Body 里面主要描述的是与业务相关的信息。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5088"><span data-slate-object="text" data-key="5089"><span data-slate-leaf="true" data-offset-key="5089:0" data-first-offset="true"><span data-slate-string="true">所以针对请求数据的这两部分，我们应该设计不同的方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5090"><span data-slate-object="text" data-key="5091"><span data-slate-leaf="true" data-offset-key="5091:0" data-first-offset="true"><span data-slate-string="true">Header 信息中，包含 HTTP 的一些基础信息，比如请求地址、请求方法、请求 IP、请求域名、Cookie 信息等，是经常读取使用的，为了方便，我们需要一一提供封装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5092"><span data-slate-object="text" data-key="5093"><span data-slate-leaf="true" data-offset-key="5093:0" data-first-offset="true"><span data-slate-string="true">而另外一些更细节的内容编码格式、缓存时长等，由于涉及的 HTTP 协议细节内容比较多，我们很难将每个细节都封装出来，但是它们都是以 key=value 的形式传递到服务端的，所以这里也考虑封装一个通用的方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5094"><span data-slate-object="text" data-key="5095"><span data-slate-leaf="true" data-offset-key="5095:0" data-first-offset="true"><span data-slate-string="true">Body 信息中，HTTP 是已经以某种形式封装好的，可能是 JSON 格式、XML 格式，也有可能是 Form 表单格式。其中 Form 表单注意一下，它可能包含 File 文件，请求参数和返回值肯定和其他的 Form 表单字段是不一样的，需要我们对其单独封装一个函数。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5096"><div data-slate-type="list-line" data-slate-object="block" data-key="5097"><span data-slate-object="text" data-key="5098"><span data-slate-leaf="true" data-offset-key="5098:0" data-first-offset="true"><span data-slate-string="true">封装返回数据</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5099"><span data-slate-object="text" data-key="5100"><span data-slate-leaf="true" data-offset-key="5100:0" data-first-offset="true"><span data-slate-string="true">封装返回数据，指的是将处理后的数据返回给浏览器。同样，它也分为两个部分，Header 头部和 Body 体。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5101"><span data-slate-object="text" data-key="5102"><span data-slate-leaf="true" data-offset-key="5102:0" data-first-offset="true"><span data-slate-string="true">Header 头部，我们经常要设置的是返回状态码和 Cookie，所以单独为其封装。其他的 Header 同样是 key=value 形式设置的，设置一个通用的方法即可。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5103"><span data-slate-object="text" data-key="5104"><span data-slate-leaf="true" data-offset-key="5104:0" data-first-offset="true"><span data-slate-string="true">返回数据的 Body 体是有不同形式的，比如 JSON、JSONP、XML、HTML 或者其他文本格式，所以我们要针对不同的 Body 体形式，进行不同的封装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5105"><span data-slate-object="text" data-key="5106"><span data-slate-leaf="true" data-offset-key="5106:0" data-first-offset="true"><span data-slate-string="true">一路分析下来，再列出这样一个思维导图就非常清晰了。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5107"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/5d/3b/5d7b8554f7cbd074db00a62acdfe5a3b.jpg?wh=2038x2209"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5108" id="sr-toc-2"><span data-slate-object="text" data-key="5109"><span data-slate-leaf="true" data-offset-key="5109:0" data-first-offset="true"><span data-slate-string="true">定义接口让封装更明确</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5110"><span data-slate-object="text" data-key="5111"><span data-slate-leaf="true" data-offset-key="5111:0" data-first-offset="true"><span data-slate-string="true">现在分析完需要封装哪些方法了，你已经迫不及待想开始进行封装函数的实现了吧。但是这里，</span></span><span data-slate-leaf="true" data-offset-key="5111:1"><span data-slate-object="annotation" data-annotation-key="gkann_7fd6395e" data-attr-id="31609" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我再给一个编码小建议：</span></span></span></span><span data-slate-object="text" data-key="5112"><span data-slate-leaf="true" data-offset-key="5112:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7fd6395e" data-attr-id="31609" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">对于比较完整的功能模块，先定义接口，再具体实现</span></span></span></span></span><span data-slate-object="text" data-key="5113"><span data-slate-leaf="true" data-offset-key="5113:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7fd6395e" data-attr-id="31609" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5114"><span data-slate-object="text" data-key="5115"><span data-slate-leaf="true" data-offset-key="5115:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f607013a" data-attr-id="31610" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">首先，定义一个清晰的、包含若干个方法的接口，可以让使用者非常清楚：这个功能模块提供了哪些函数、哪些函数是我要的、哪些函数是我不要的，在用的时候，查找也更方便。如果你有过，在超过 20 个函数的结构体中，查找你需要的函数的惨痛经历，你就会觉得这一点尤为重要了。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5116"><span data-slate-object="text" data-key="5117"><span data-slate-leaf="true" data-offset-key="5117:0" data-first-offset="true"><span data-slate-string="true">其次，定义接口能做到 “实现解耦”。使用接口作为参数、返回值，能够让使用者在写具体函数的时候，有不同的实现；而且在不同实现中，只需要做到接口一致，就能很简单进行替换，而不用修改使用方的任何代码。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5118"><span data-slate-object="text" data-key="5119"><span data-slate-leaf="true" data-offset-key="5119:0" data-first-offset="true"><span data-slate-string="true">好，明白这两点，我们再回到封装需求上，先定义两个接口：IRequest 和 IResponse，分别对应 “读取请求数据” 和 “封装返回数据” 这两个功能模块。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5120"><span data-slate-object="text" data-key="5121"><span data-slate-leaf="true" data-offset-key="5121:0" data-first-offset="true"><span data-slate-string="true">我们分别在框架目录下创建 request.go 和 response.go 来存放这两个接口及其实现。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5122" id="sr-toc-3"><span data-slate-object="text" data-key="5123"><span data-slate-leaf="true" data-offset-key="5123:0" data-first-offset="true"><span data-slate-string="true">IRequest 接口定义</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5124"><span data-slate-object="text" data-key="5125"><span data-slate-leaf="true" data-offset-key="5125:0" data-first-offset="true"><span data-slate-string="true">读取请求数据 IRequest，我们定义的方法如下，在 request.go 中进行修改：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5126"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5127"><span data-slate-object="text" data-key="5128"><span data-slate-leaf="true" data-offset-key="5128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 代表请求包含的方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5129"><span data-slate-object="text" data-key="5130"><span data-slate-leaf="true" data-offset-key="5130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="5131"><span data-slate-leaf="true" data-offset-key="5131:0" data-first-offset="true"><span data-slate-string="true"> IRequest </span></span></span><span data-slate-object="text" data-key="5132"><span data-slate-leaf="true" data-offset-key="5132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5133"><span data-slate-leaf="true" data-offset-key="5133:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5134"><span data-slate-object="text" data-key="5135"><span data-slate-leaf="true" data-offset-key="5135:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5136"><span data-slate-leaf="true" data-offset-key="5136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 请求地址 url 中带的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5137"><span data-slate-object="text" data-key="5138"><span data-slate-leaf="true" data-offset-key="5138:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5139"><span data-slate-leaf="true" data-offset-key="5139:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 形如: foo.com?a=1&amp;b=bar&amp;c []=bar</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5140"><span data-slate-object="text" data-key="5141"><span data-slate-leaf="true" data-offset-key="5141:0" data-first-offset="true"><span data-slate-string="true">  QueryInt(key </span></span></span><span data-slate-object="text" data-key="5142"><span data-slate-leaf="true" data-offset-key="5142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5143"><span data-slate-leaf="true" data-offset-key="5143:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5144"><span data-slate-leaf="true" data-offset-key="5144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5145"><span data-slate-leaf="true" data-offset-key="5145:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5146"><span data-slate-leaf="true" data-offset-key="5146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5147"><span data-slate-leaf="true" data-offset-key="5147:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5148"><span data-slate-leaf="true" data-offset-key="5148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5149"><span data-slate-leaf="true" data-offset-key="5149:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5150"><span data-slate-object="text" data-key="5151"><span data-slate-leaf="true" data-offset-key="5151:0" data-first-offset="true"><span data-slate-string="true">  QueryInt64(key </span></span></span><span data-slate-object="text" data-key="5152"><span data-slate-leaf="true" data-offset-key="5152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5153"><span data-slate-leaf="true" data-offset-key="5153:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5154"><span data-slate-leaf="true" data-offset-key="5154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5155"><span data-slate-leaf="true" data-offset-key="5155:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5156"><span data-slate-leaf="true" data-offset-key="5156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5157"><span data-slate-leaf="true" data-offset-key="5157:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5158"><span data-slate-leaf="true" data-offset-key="5158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5159"><span data-slate-leaf="true" data-offset-key="5159:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5160"><span data-slate-object="text" data-key="5161"><span data-slate-leaf="true" data-offset-key="5161:0" data-first-offset="true"><span data-slate-string="true">  QueryFloat64(key </span></span></span><span data-slate-object="text" data-key="5162"><span data-slate-leaf="true" data-offset-key="5162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5163"><span data-slate-leaf="true" data-offset-key="5163:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5164"><span data-slate-leaf="true" data-offset-key="5164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5165"><span data-slate-leaf="true" data-offset-key="5165:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5166"><span data-slate-leaf="true" data-offset-key="5166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5167"><span data-slate-leaf="true" data-offset-key="5167:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5168"><span data-slate-leaf="true" data-offset-key="5168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5169"><span data-slate-leaf="true" data-offset-key="5169:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5170"><span data-slate-object="text" data-key="5171"><span data-slate-leaf="true" data-offset-key="5171:0" data-first-offset="true"><span data-slate-string="true">  QueryFloat32(key </span></span></span><span data-slate-object="text" data-key="5172"><span data-slate-leaf="true" data-offset-key="5172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5173"><span data-slate-leaf="true" data-offset-key="5173:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5174"><span data-slate-leaf="true" data-offset-key="5174:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5175"><span data-slate-leaf="true" data-offset-key="5175:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5176"><span data-slate-leaf="true" data-offset-key="5176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5177"><span data-slate-leaf="true" data-offset-key="5177:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5178"><span data-slate-leaf="true" data-offset-key="5178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5179"><span data-slate-leaf="true" data-offset-key="5179:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5180"><span data-slate-object="text" data-key="5181"><span data-slate-leaf="true" data-offset-key="5181:0" data-first-offset="true"><span data-slate-string="true">  QueryBool(key </span></span></span><span data-slate-object="text" data-key="5182"><span data-slate-leaf="true" data-offset-key="5182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5183"><span data-slate-leaf="true" data-offset-key="5183:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5184"><span data-slate-leaf="true" data-offset-key="5184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5185"><span data-slate-leaf="true" data-offset-key="5185:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5186"><span data-slate-leaf="true" data-offset-key="5186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5187"><span data-slate-leaf="true" data-offset-key="5187:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5188"><span data-slate-leaf="true" data-offset-key="5188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5189"><span data-slate-leaf="true" data-offset-key="5189:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5190"><span data-slate-object="text" data-key="5191"><span data-slate-leaf="true" data-offset-key="5191:0" data-first-offset="true"><span data-slate-string="true">  QueryString(key </span></span></span><span data-slate-object="text" data-key="5192"><span data-slate-leaf="true" data-offset-key="5192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5193"><span data-slate-leaf="true" data-offset-key="5193:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5194"><span data-slate-leaf="true" data-offset-key="5194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5195"><span data-slate-leaf="true" data-offset-key="5195:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5196"><span data-slate-leaf="true" data-offset-key="5196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5197"><span data-slate-leaf="true" data-offset-key="5197:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5198"><span data-slate-leaf="true" data-offset-key="5198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5199"><span data-slate-leaf="true" data-offset-key="5199:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5200"><span data-slate-object="text" data-key="5201"><span data-slate-leaf="true" data-offset-key="5201:0" data-first-offset="true"><span data-slate-string="true">  QueryStringSlice(key </span></span></span><span data-slate-object="text" data-key="5202"><span data-slate-leaf="true" data-offset-key="5202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5203"><span data-slate-leaf="true" data-offset-key="5203:0" data-first-offset="true"><span data-slate-string="true">, def []</span></span></span><span data-slate-object="text" data-key="5204"><span data-slate-leaf="true" data-offset-key="5204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5205"><span data-slate-leaf="true" data-offset-key="5205:0" data-first-offset="true"><span data-slate-string="true">) ([]</span></span></span><span data-slate-object="text" data-key="5206"><span data-slate-leaf="true" data-offset-key="5206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5207"><span data-slate-leaf="true" data-offset-key="5207:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5208"><span data-slate-leaf="true" data-offset-key="5208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5209"><span data-slate-leaf="true" data-offset-key="5209:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5210"><span data-slate-object="text" data-key="5211"><span data-slate-leaf="true" data-offset-key="5211:0" data-first-offset="true"><span data-slate-string="true">  Query(key </span></span></span><span data-slate-object="text" data-key="5212"><span data-slate-leaf="true" data-offset-key="5212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5213"><span data-slate-leaf="true" data-offset-key="5213:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="5214"><span data-slate-leaf="true" data-offset-key="5214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5215"><span data-slate-leaf="true" data-offset-key="5215:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5216"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5217"><span data-slate-object="text" data-key="5218"><span data-slate-leaf="true" data-offset-key="5218:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5219"><span data-slate-leaf="true" data-offset-key="5219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配中带的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5220"><span data-slate-object="text" data-key="5221"><span data-slate-leaf="true" data-offset-key="5221:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5222"><span data-slate-leaf="true" data-offset-key="5222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 形如 /book/:id</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5223"><span data-slate-object="text" data-key="5224"><span data-slate-leaf="true" data-offset-key="5224:0" data-first-offset="true"><span data-slate-string="true">  ParamInt(key </span></span></span><span data-slate-object="text" data-key="5225"><span data-slate-leaf="true" data-offset-key="5225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5226"><span data-slate-leaf="true" data-offset-key="5226:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5227"><span data-slate-leaf="true" data-offset-key="5227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5228"><span data-slate-leaf="true" data-offset-key="5228:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5229"><span data-slate-leaf="true" data-offset-key="5229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5230"><span data-slate-leaf="true" data-offset-key="5230:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5231"><span data-slate-leaf="true" data-offset-key="5231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5232"><span data-slate-leaf="true" data-offset-key="5232:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5233"><span data-slate-object="text" data-key="5234"><span data-slate-leaf="true" data-offset-key="5234:0" data-first-offset="true"><span data-slate-string="true">  ParamInt64(key </span></span></span><span data-slate-object="text" data-key="5235"><span data-slate-leaf="true" data-offset-key="5235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5236"><span data-slate-leaf="true" data-offset-key="5236:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5237"><span data-slate-leaf="true" data-offset-key="5237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5238"><span data-slate-leaf="true" data-offset-key="5238:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5239"><span data-slate-leaf="true" data-offset-key="5239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5240"><span data-slate-leaf="true" data-offset-key="5240:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5241"><span data-slate-leaf="true" data-offset-key="5241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5242"><span data-slate-leaf="true" data-offset-key="5242:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5243"><span data-slate-object="text" data-key="5244"><span data-slate-leaf="true" data-offset-key="5244:0" data-first-offset="true"><span data-slate-string="true">  ParamFloat64(key </span></span></span><span data-slate-object="text" data-key="5245"><span data-slate-leaf="true" data-offset-key="5245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5246"><span data-slate-leaf="true" data-offset-key="5246:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5247"><span data-slate-leaf="true" data-offset-key="5247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5248"><span data-slate-leaf="true" data-offset-key="5248:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5249"><span data-slate-leaf="true" data-offset-key="5249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5250"><span data-slate-leaf="true" data-offset-key="5250:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5251"><span data-slate-leaf="true" data-offset-key="5251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5252"><span data-slate-leaf="true" data-offset-key="5252:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5253"><span data-slate-object="text" data-key="5254"><span data-slate-leaf="true" data-offset-key="5254:0" data-first-offset="true"><span data-slate-string="true">  ParamFloat32(key </span></span></span><span data-slate-object="text" data-key="5255"><span data-slate-leaf="true" data-offset-key="5255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5256"><span data-slate-leaf="true" data-offset-key="5256:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5257"><span data-slate-leaf="true" data-offset-key="5257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5258"><span data-slate-leaf="true" data-offset-key="5258:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5259"><span data-slate-leaf="true" data-offset-key="5259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5260"><span data-slate-leaf="true" data-offset-key="5260:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5261"><span data-slate-leaf="true" data-offset-key="5261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5262"><span data-slate-leaf="true" data-offset-key="5262:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5263"><span data-slate-object="text" data-key="5264"><span data-slate-leaf="true" data-offset-key="5264:0" data-first-offset="true"><span data-slate-string="true">  ParamBool(key </span></span></span><span data-slate-object="text" data-key="5265"><span data-slate-leaf="true" data-offset-key="5265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5266"><span data-slate-leaf="true" data-offset-key="5266:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5267"><span data-slate-leaf="true" data-offset-key="5267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5268"><span data-slate-leaf="true" data-offset-key="5268:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5269"><span data-slate-leaf="true" data-offset-key="5269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5270"><span data-slate-leaf="true" data-offset-key="5270:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5271"><span data-slate-leaf="true" data-offset-key="5271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5272"><span data-slate-leaf="true" data-offset-key="5272:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5273"><span data-slate-object="text" data-key="5274"><span data-slate-leaf="true" data-offset-key="5274:0" data-first-offset="true"><span data-slate-string="true">  ParamString(key </span></span></span><span data-slate-object="text" data-key="5275"><span data-slate-leaf="true" data-offset-key="5275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5276"><span data-slate-leaf="true" data-offset-key="5276:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5277"><span data-slate-leaf="true" data-offset-key="5277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5278"><span data-slate-leaf="true" data-offset-key="5278:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5279"><span data-slate-leaf="true" data-offset-key="5279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5280"><span data-slate-leaf="true" data-offset-key="5280:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5281"><span data-slate-leaf="true" data-offset-key="5281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5282"><span data-slate-leaf="true" data-offset-key="5282:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5283"><span data-slate-object="text" data-key="5284"><span data-slate-leaf="true" data-offset-key="5284:0" data-first-offset="true"><span data-slate-string="true">  Param(key </span></span></span><span data-slate-object="text" data-key="5285"><span data-slate-leaf="true" data-offset-key="5285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5286"><span data-slate-leaf="true" data-offset-key="5286:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="5287"><span data-slate-leaf="true" data-offset-key="5287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5288"><span data-slate-leaf="true" data-offset-key="5288:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5289"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5290"><span data-slate-object="text" data-key="5291"><span data-slate-leaf="true" data-offset-key="5291:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5292"><span data-slate-leaf="true" data-offset-key="5292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//form 表单中带的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5293"><span data-slate-object="text" data-key="5294"><span data-slate-leaf="true" data-offset-key="5294:0" data-first-offset="true"><span data-slate-string="true">  FormInt(key </span></span></span><span data-slate-object="text" data-key="5295"><span data-slate-leaf="true" data-offset-key="5295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5296"><span data-slate-leaf="true" data-offset-key="5296:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5297"><span data-slate-leaf="true" data-offset-key="5297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5298"><span data-slate-leaf="true" data-offset-key="5298:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5299"><span data-slate-leaf="true" data-offset-key="5299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5300"><span data-slate-leaf="true" data-offset-key="5300:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5301"><span data-slate-leaf="true" data-offset-key="5301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5302"><span data-slate-leaf="true" data-offset-key="5302:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5303"><span data-slate-object="text" data-key="5304"><span data-slate-leaf="true" data-offset-key="5304:0" data-first-offset="true"><span data-slate-string="true">  FormInt64(key </span></span></span><span data-slate-object="text" data-key="5305"><span data-slate-leaf="true" data-offset-key="5305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5306"><span data-slate-leaf="true" data-offset-key="5306:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5307"><span data-slate-leaf="true" data-offset-key="5307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5308"><span data-slate-leaf="true" data-offset-key="5308:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5309"><span data-slate-leaf="true" data-offset-key="5309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5310"><span data-slate-leaf="true" data-offset-key="5310:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5311"><span data-slate-leaf="true" data-offset-key="5311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5312"><span data-slate-leaf="true" data-offset-key="5312:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5313"><span data-slate-object="text" data-key="5314"><span data-slate-leaf="true" data-offset-key="5314:0" data-first-offset="true"><span data-slate-string="true">  FormFloat64(key </span></span></span><span data-slate-object="text" data-key="5315"><span data-slate-leaf="true" data-offset-key="5315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5316"><span data-slate-leaf="true" data-offset-key="5316:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5317"><span data-slate-leaf="true" data-offset-key="5317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5318"><span data-slate-leaf="true" data-offset-key="5318:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5319"><span data-slate-leaf="true" data-offset-key="5319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5320"><span data-slate-leaf="true" data-offset-key="5320:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5321"><span data-slate-leaf="true" data-offset-key="5321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5322"><span data-slate-leaf="true" data-offset-key="5322:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5323"><span data-slate-object="text" data-key="5324"><span data-slate-leaf="true" data-offset-key="5324:0" data-first-offset="true"><span data-slate-string="true">  FormFloat32(key </span></span></span><span data-slate-object="text" data-key="5325"><span data-slate-leaf="true" data-offset-key="5325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5326"><span data-slate-leaf="true" data-offset-key="5326:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5327"><span data-slate-leaf="true" data-offset-key="5327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5328"><span data-slate-leaf="true" data-offset-key="5328:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5329"><span data-slate-leaf="true" data-offset-key="5329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5330"><span data-slate-leaf="true" data-offset-key="5330:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5331"><span data-slate-leaf="true" data-offset-key="5331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5332"><span data-slate-leaf="true" data-offset-key="5332:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5333"><span data-slate-object="text" data-key="5334"><span data-slate-leaf="true" data-offset-key="5334:0" data-first-offset="true"><span data-slate-string="true">  FormBool(key </span></span></span><span data-slate-object="text" data-key="5335"><span data-slate-leaf="true" data-offset-key="5335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5336"><span data-slate-leaf="true" data-offset-key="5336:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5337"><span data-slate-leaf="true" data-offset-key="5337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5338"><span data-slate-leaf="true" data-offset-key="5338:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5339"><span data-slate-leaf="true" data-offset-key="5339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5340"><span data-slate-leaf="true" data-offset-key="5340:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5341"><span data-slate-leaf="true" data-offset-key="5341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5342"><span data-slate-leaf="true" data-offset-key="5342:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5343"><span data-slate-object="text" data-key="5344"><span data-slate-leaf="true" data-offset-key="5344:0" data-first-offset="true"><span data-slate-string="true">  FormString(key </span></span></span><span data-slate-object="text" data-key="5345"><span data-slate-leaf="true" data-offset-key="5345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5346"><span data-slate-leaf="true" data-offset-key="5346:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5347"><span data-slate-leaf="true" data-offset-key="5347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5348"><span data-slate-leaf="true" data-offset-key="5348:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5349"><span data-slate-leaf="true" data-offset-key="5349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5350"><span data-slate-leaf="true" data-offset-key="5350:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5351"><span data-slate-leaf="true" data-offset-key="5351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5352"><span data-slate-leaf="true" data-offset-key="5352:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5353"><span data-slate-object="text" data-key="5354"><span data-slate-leaf="true" data-offset-key="5354:0" data-first-offset="true"><span data-slate-string="true">  FormStringSlice(key </span></span></span><span data-slate-object="text" data-key="5355"><span data-slate-leaf="true" data-offset-key="5355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5356"><span data-slate-leaf="true" data-offset-key="5356:0" data-first-offset="true"><span data-slate-string="true">, def []</span></span></span><span data-slate-object="text" data-key="5357"><span data-slate-leaf="true" data-offset-key="5357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5358"><span data-slate-leaf="true" data-offset-key="5358:0" data-first-offset="true"><span data-slate-string="true">) ([]</span></span></span><span data-slate-object="text" data-key="5359"><span data-slate-leaf="true" data-offset-key="5359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5360"><span data-slate-leaf="true" data-offset-key="5360:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5361"><span data-slate-leaf="true" data-offset-key="5361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5362"><span data-slate-leaf="true" data-offset-key="5362:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5363"><span data-slate-object="text" data-key="5364"><span data-slate-leaf="true" data-offset-key="5364:0" data-first-offset="true"><span data-slate-string="true">  FormFile(key </span></span></span><span data-slate-object="text" data-key="5365"><span data-slate-leaf="true" data-offset-key="5365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5366"><span data-slate-leaf="true" data-offset-key="5366:0" data-first-offset="true"><span data-slate-string="true">) (*multipart.FileHeader, </span></span></span><span data-slate-object="text" data-key="5367"><span data-slate-leaf="true" data-offset-key="5367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5368"><span data-slate-leaf="true" data-offset-key="5368:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5369"><span data-slate-object="text" data-key="5370"><span data-slate-leaf="true" data-offset-key="5370:0" data-first-offset="true"><span data-slate-string="true">  Form(key </span></span></span><span data-slate-object="text" data-key="5371"><span data-slate-leaf="true" data-offset-key="5371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5372"><span data-slate-leaf="true" data-offset-key="5372:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="5373"><span data-slate-leaf="true" data-offset-key="5373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5374"><span data-slate-leaf="true" data-offset-key="5374:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5375"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5376"><span data-slate-object="text" data-key="5377"><span data-slate-leaf="true" data-offset-key="5377:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5378"><span data-slate-leaf="true" data-offset-key="5378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// json body</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5379"><span data-slate-object="text" data-key="5380"><span data-slate-leaf="true" data-offset-key="5380:0" data-first-offset="true"><span data-slate-string="true">  BindJson(obj </span></span></span><span data-slate-object="text" data-key="5381"><span data-slate-leaf="true" data-offset-key="5381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5382"><span data-slate-leaf="true" data-offset-key="5382:0" data-first-offset="true"><span data-slate-string="true">{}) </span></span></span><span data-slate-object="text" data-key="5383"><span data-slate-leaf="true" data-offset-key="5383:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5384"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5385"><span data-slate-object="text" data-key="5386"><span data-slate-leaf="true" data-offset-key="5386:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5387"><span data-slate-leaf="true" data-offset-key="5387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// xml body</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5388"><span data-slate-object="text" data-key="5389"><span data-slate-leaf="true" data-offset-key="5389:0" data-first-offset="true"><span data-slate-string="true">  BindXml(obj </span></span></span><span data-slate-object="text" data-key="5390"><span data-slate-leaf="true" data-offset-key="5390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5391"><span data-slate-leaf="true" data-offset-key="5391:0" data-first-offset="true"><span data-slate-string="true">{}) </span></span></span><span data-slate-object="text" data-key="5392"><span data-slate-leaf="true" data-offset-key="5392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5393"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5394"><span data-slate-object="text" data-key="5395"><span data-slate-leaf="true" data-offset-key="5395:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5396"><span data-slate-leaf="true" data-offset-key="5396:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 其他格式</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5397"><span data-slate-object="text" data-key="5398"><span data-slate-leaf="true" data-offset-key="5398:0" data-first-offset="true"><span data-slate-string="true">  GetRawData() ([]</span></span></span><span data-slate-object="text" data-key="5399"><span data-slate-leaf="true" data-offset-key="5399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="5400"><span data-slate-leaf="true" data-offset-key="5400:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5401"><span data-slate-leaf="true" data-offset-key="5401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5402"><span data-slate-leaf="true" data-offset-key="5402:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5403"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5404"><span data-slate-object="text" data-key="5405"><span data-slate-leaf="true" data-offset-key="5405:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5406"><span data-slate-leaf="true" data-offset-key="5406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 基础信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5407"><span data-slate-object="text" data-key="5408"><span data-slate-leaf="true" data-offset-key="5408:0" data-first-offset="true"><span data-slate-string="true">  Uri() </span></span></span><span data-slate-object="text" data-key="5409"><span data-slate-leaf="true" data-offset-key="5409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5410"><span data-slate-object="text" data-key="5411"><span data-slate-leaf="true" data-offset-key="5411:0" data-first-offset="true"><span data-slate-string="true">  Method() </span></span></span><span data-slate-object="text" data-key="5412"><span data-slate-leaf="true" data-offset-key="5412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5413"><span data-slate-object="text" data-key="5414"><span data-slate-leaf="true" data-offset-key="5414:0" data-first-offset="true"><span data-slate-string="true">  Host() </span></span></span><span data-slate-object="text" data-key="5415"><span data-slate-leaf="true" data-offset-key="5415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5416"><span data-slate-object="text" data-key="5417"><span data-slate-leaf="true" data-offset-key="5417:0" data-first-offset="true"><span data-slate-string="true">  ClientIp() </span></span></span><span data-slate-object="text" data-key="5418"><span data-slate-leaf="true" data-offset-key="5418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5419"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5420"><span data-slate-object="text" data-key="5421"><span data-slate-leaf="true" data-offset-key="5421:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5422"><span data-slate-leaf="true" data-offset-key="5422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// header</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5423"><span data-slate-object="text" data-key="5424"><span data-slate-leaf="true" data-offset-key="5424:0" data-first-offset="true"><span data-slate-string="true">  Headers() </span></span></span><span data-slate-object="text" data-key="5425"><span data-slate-leaf="true" data-offset-key="5425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5426"><span data-slate-leaf="true" data-offset-key="5426:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5427"><span data-slate-leaf="true" data-offset-key="5427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5428"><span data-slate-leaf="true" data-offset-key="5428:0" data-first-offset="true"><span data-slate-string="true">][]</span></span></span><span data-slate-object="text" data-key="5429"><span data-slate-leaf="true" data-offset-key="5429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5430"><span data-slate-object="text" data-key="5431"><span data-slate-leaf="true" data-offset-key="5431:0" data-first-offset="true"><span data-slate-string="true">  Header(key </span></span></span><span data-slate-object="text" data-key="5432"><span data-slate-leaf="true" data-offset-key="5432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5433"><span data-slate-leaf="true" data-offset-key="5433:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5434"><span data-slate-leaf="true" data-offset-key="5434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5435"><span data-slate-leaf="true" data-offset-key="5435:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5436"><span data-slate-leaf="true" data-offset-key="5436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5437"><span data-slate-leaf="true" data-offset-key="5437:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5438"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5439"><span data-slate-object="text" data-key="5440"><span data-slate-leaf="true" data-offset-key="5440:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5441"><span data-slate-leaf="true" data-offset-key="5441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// cookie</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5442"><span data-slate-object="text" data-key="5443"><span data-slate-leaf="true" data-offset-key="5443:0" data-first-offset="true"><span data-slate-string="true">  Cookies() </span></span></span><span data-slate-object="text" data-key="5444"><span data-slate-leaf="true" data-offset-key="5444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5445"><span data-slate-leaf="true" data-offset-key="5445:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5446"><span data-slate-leaf="true" data-offset-key="5446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5447"><span data-slate-leaf="true" data-offset-key="5447:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="5448"><span data-slate-leaf="true" data-offset-key="5448:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5449"><span data-slate-object="text" data-key="5450"><span data-slate-leaf="true" data-offset-key="5450:0" data-first-offset="true"><span data-slate-string="true">  Cookie(key </span></span></span><span data-slate-object="text" data-key="5451"><span data-slate-leaf="true" data-offset-key="5451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5452"><span data-slate-leaf="true" data-offset-key="5452:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5453"><span data-slate-leaf="true" data-offset-key="5453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5454"><span data-slate-leaf="true" data-offset-key="5454:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5455"><span data-slate-leaf="true" data-offset-key="5455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5456"><span data-slate-leaf="true" data-offset-key="5456:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5457"><span data-slate-object="text" data-key="5458"><span data-slate-leaf="true" data-offset-key="5458:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5459"><span data-slate-object="text" data-key="5460"><span data-slate-leaf="true" data-offset-key="5460:0" data-first-offset="true"><span data-slate-string="true">简单说明一下，</span></span><span data-slate-leaf="true" data-offset-key="5460:1"><span data-slate-object="annotation" data-annotation-key="gkann_2baf25e9" data-attr-id="32702" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们使用了 QueryXXX 的系列方法来代表从 URL 的参数后缀中获取的参数；使用 ParamXXX 的系列方法来代表从路由匹配中获取的参数；使用 FormXXX 的系列方法来代表从 Body 的 form 表单中获取的参数。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5461"><span data-slate-object="text" data-key="5462"><span data-slate-leaf="true" data-offset-key="5462:0" data-first-offset="true"><span data-slate-string="true">不知道你发现了没有，</span></span></span><span data-slate-object="text" data-key="5463"><span data-slate-leaf="true" data-offset-key="5463:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这三个系列的方法，我们统一了参数和返回值</span></span></span></span><span data-slate-object="text" data-key="5464"><span data-slate-leaf="true" data-offset-key="5464:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="5465"><div data-slate-type="list-line" data-slate-object="block" data-key="5466"><span data-slate-object="text" data-key="5467"><span data-slate-leaf="true" data-offset-key="5467:0" data-first-offset="true"><span data-slate-string="true">参数一般都有两个：一个是 key，代表从参数列表中查找参数的关键词；另外一个是 def，代表如果查找不到关键词，会使用哪个默认值进行返回。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="5468"><span data-slate-object="text" data-key="5469"><span data-slate-leaf="true" data-offset-key="5469:0" data-first-offset="true"><span data-slate-string="true">返回值返回两个：一个代表对应 key 的匹配值，而另一个 bool 返回值代表是否有这个返回值。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5470"><span data-slate-object="text" data-key="5471"><span data-slate-leaf="true" data-offset-key="5471:0" data-first-offset="true"><span data-slate-string="true">这样的设计，在获取参数的时候，能让需要处理的两个逻辑，默认参数和是否有参数，都得到很好的处理；同时对于 JSON 格式、XML 格式的 Body 结构读取，也提供了对应的方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5472"><span data-slate-object="text" data-key="5473"><span data-slate-leaf="true" data-offset-key="5473:0" data-first-offset="true"><span data-slate-string="true">对基础信息，我们提供了 URI、Method、Host、ClinetIp 等方法；对 Header 头，我们提供根据 key 获取 Header 值的通用方法；同时，也对 Cookie 单独提供了批量获取 Cookie 和按照关键词获取 Cookie 的两个方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5474"><span data-slate-object="text" data-key="5475"><span data-slate-leaf="true" data-offset-key="5475:0" data-first-offset="true"><span data-slate-string="true">这些都对应我们第一部分分析的思维导图中 “读取请求数据” 部分。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5476" id="sr-toc-4"><span data-slate-object="text" data-key="5477"><span data-slate-leaf="true" data-offset-key="5477:0" data-first-offset="true"><span data-slate-string="true">IResponse 接口定义</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5478"><span data-slate-object="text" data-key="5479"><span data-slate-leaf="true" data-offset-key="5479:0" data-first-offset="true"><span data-slate-string="true">对于封装返回数据 IResponse，我们在 response.go 中定义的方法如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5480"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5481"><span data-slate-object="text" data-key="5482"><span data-slate-leaf="true" data-offset-key="5482:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// IResponse 代表返回方法</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5483"><span data-slate-object="text" data-key="5484"><span data-slate-leaf="true" data-offset-key="5484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="5485"><span data-slate-leaf="true" data-offset-key="5485:0" data-first-offset="true"><span data-slate-string="true"> IResponse </span></span></span><span data-slate-object="text" data-key="5486"><span data-slate-leaf="true" data-offset-key="5486:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5487"><span data-slate-leaf="true" data-offset-key="5487:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5488"><span data-slate-object="text" data-key="5489"><span data-slate-leaf="true" data-offset-key="5489:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5490"><span data-slate-leaf="true" data-offset-key="5490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Json 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5491"><span data-slate-object="text" data-key="5492"><span data-slate-leaf="true" data-offset-key="5492:0" data-first-offset="true"><span data-slate-string="true">  Json(obj </span></span></span><span data-slate-object="text" data-key="5493"><span data-slate-leaf="true" data-offset-key="5493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5494"><span data-slate-leaf="true" data-offset-key="5494:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5495"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5496"><span data-slate-object="text" data-key="5497"><span data-slate-leaf="true" data-offset-key="5497:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5498"><span data-slate-leaf="true" data-offset-key="5498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Jsonp 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5499"><span data-slate-object="text" data-key="5500"><span data-slate-leaf="true" data-offset-key="5500:0" data-first-offset="true"><span data-slate-string="true">  Jsonp(obj </span></span></span><span data-slate-object="text" data-key="5501"><span data-slate-leaf="true" data-offset-key="5501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5502"><span data-slate-leaf="true" data-offset-key="5502:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5503"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5504"><span data-slate-object="text" data-key="5505"><span data-slate-leaf="true" data-offset-key="5505:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5506"><span data-slate-leaf="true" data-offset-key="5506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//xml 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5507"><span data-slate-object="text" data-key="5508"><span data-slate-leaf="true" data-offset-key="5508:0" data-first-offset="true"><span data-slate-string="true">  Xml(obj </span></span></span><span data-slate-object="text" data-key="5509"><span data-slate-leaf="true" data-offset-key="5509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5510"><span data-slate-leaf="true" data-offset-key="5510:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5511"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5512"><span data-slate-object="text" data-key="5513"><span data-slate-leaf="true" data-offset-key="5513:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5514"><span data-slate-leaf="true" data-offset-key="5514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//html 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5515"><span data-slate-object="text" data-key="5516"><span data-slate-leaf="true" data-offset-key="5516:0" data-first-offset="true"><span data-slate-string="true">  Html(template </span></span></span><span data-slate-object="text" data-key="5517"><span data-slate-leaf="true" data-offset-key="5517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5518"><span data-slate-leaf="true" data-offset-key="5518:0" data-first-offset="true"><span data-slate-string="true">, obj </span></span></span><span data-slate-object="text" data-key="5519"><span data-slate-leaf="true" data-offset-key="5519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5520"><span data-slate-leaf="true" data-offset-key="5520:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5521"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5522"><span data-slate-object="text" data-key="5523"><span data-slate-leaf="true" data-offset-key="5523:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5524"><span data-slate-leaf="true" data-offset-key="5524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5525"><span data-slate-object="text" data-key="5526"><span data-slate-leaf="true" data-offset-key="5526:0" data-first-offset="true"><span data-slate-string="true">  Text(format </span></span></span><span data-slate-object="text" data-key="5527"><span data-slate-leaf="true" data-offset-key="5527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5528"><span data-slate-leaf="true" data-offset-key="5528:0" data-first-offset="true"><span data-slate-string="true">, values ...</span></span></span><span data-slate-object="text" data-key="5529"><span data-slate-leaf="true" data-offset-key="5529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5530"><span data-slate-leaf="true" data-offset-key="5530:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5531"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5532"><span data-slate-object="text" data-key="5533"><span data-slate-leaf="true" data-offset-key="5533:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5534"><span data-slate-leaf="true" data-offset-key="5534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 重定向</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5535"><span data-slate-object="text" data-key="5536"><span data-slate-leaf="true" data-offset-key="5536:0" data-first-offset="true"><span data-slate-string="true">  Redirect(path </span></span></span><span data-slate-object="text" data-key="5537"><span data-slate-leaf="true" data-offset-key="5537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5538"><span data-slate-leaf="true" data-offset-key="5538:0" data-first-offset="true"><span data-slate-string="true">) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5539"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5540"><span data-slate-object="text" data-key="5541"><span data-slate-leaf="true" data-offset-key="5541:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5542"><span data-slate-leaf="true" data-offset-key="5542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// header</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5543"><span data-slate-object="text" data-key="5544"><span data-slate-leaf="true" data-offset-key="5544:0" data-first-offset="true"><span data-slate-string="true">  SetHeader(key </span></span></span><span data-slate-object="text" data-key="5545"><span data-slate-leaf="true" data-offset-key="5545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5546"><span data-slate-leaf="true" data-offset-key="5546:0" data-first-offset="true"><span data-slate-string="true">, val </span></span></span><span data-slate-object="text" data-key="5547"><span data-slate-leaf="true" data-offset-key="5547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5548"><span data-slate-leaf="true" data-offset-key="5548:0" data-first-offset="true"><span data-slate-string="true">) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5549"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5550"><span data-slate-object="text" data-key="5551"><span data-slate-leaf="true" data-offset-key="5551:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5552"><span data-slate-leaf="true" data-offset-key="5552:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Cookie</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5553"><span data-slate-object="text" data-key="5554"><span data-slate-leaf="true" data-offset-key="5554:0" data-first-offset="true"><span data-slate-string="true">  SetCookie(key </span></span></span><span data-slate-object="text" data-key="5555"><span data-slate-leaf="true" data-offset-key="5555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5556"><span data-slate-leaf="true" data-offset-key="5556:0" data-first-offset="true"><span data-slate-string="true">, val </span></span></span><span data-slate-object="text" data-key="5557"><span data-slate-leaf="true" data-offset-key="5557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5558"><span data-slate-leaf="true" data-offset-key="5558:0" data-first-offset="true"><span data-slate-string="true">, maxAge </span></span></span><span data-slate-object="text" data-key="5559"><span data-slate-leaf="true" data-offset-key="5559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5560"><span data-slate-leaf="true" data-offset-key="5560:0" data-first-offset="true"><span data-slate-string="true">, path, domain </span></span></span><span data-slate-object="text" data-key="5561"><span data-slate-leaf="true" data-offset-key="5561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5562"><span data-slate-leaf="true" data-offset-key="5562:0" data-first-offset="true"><span data-slate-string="true">, secure, httpOnly </span></span></span><span data-slate-object="text" data-key="5563"><span data-slate-leaf="true" data-offset-key="5563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5564"><span data-slate-leaf="true" data-offset-key="5564:0" data-first-offset="true"><span data-slate-string="true">) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5565"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5566"><span data-slate-object="text" data-key="5567"><span data-slate-leaf="true" data-offset-key="5567:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5568"><span data-slate-leaf="true" data-offset-key="5568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置状态码</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5569"><span data-slate-object="text" data-key="5570"><span data-slate-leaf="true" data-offset-key="5570:0" data-first-offset="true"><span data-slate-string="true">  SetStatus(code </span></span></span><span data-slate-object="text" data-key="5571"><span data-slate-leaf="true" data-offset-key="5571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5572"><span data-slate-leaf="true" data-offset-key="5572:0" data-first-offset="true"><span data-slate-string="true">) IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5573"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5574"><span data-slate-object="text" data-key="5575"><span data-slate-leaf="true" data-offset-key="5575:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5576"><span data-slate-leaf="true" data-offset-key="5576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 200 状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5577"><span data-slate-object="text" data-key="5578"><span data-slate-leaf="true" data-offset-key="5578:0" data-first-offset="true"><span data-slate-string="true">  SetOkStatus() IResponse</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5579"><span data-slate-object="text" data-key="5580"><span data-slate-leaf="true" data-offset-key="5580:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5581"><span data-slate-object="text" data-key="5582"><span data-slate-leaf="true" data-offset-key="5582:0" data-first-offset="true"><span data-slate-string="true">对于 Header 部分，我们设计了状态码的设置函数 SetStatus/SetOkStatus/Redirect，还设计了 Cookie 的设置函数 SetCookie，同时，我们提供了通用的设置 Header 的函数 SetHeader。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5583"><span data-slate-object="text" data-key="5584"><span data-slate-leaf="true" data-offset-key="5584:0" data-first-offset="true"><span data-slate-string="true">对于 Body 部分，我们设计了 JSON、JSONP、XML、HTML、Text 等方法来输出不同格式的 Body。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5585"><span data-slate-object="text" data-key="5586"><span data-slate-leaf="true" data-offset-key="5586:0" data-first-offset="true"><span data-slate-string="true">这里注意下，</span></span></span><span data-slate-object="text" data-key="5587"><span data-slate-leaf="true" data-offset-key="5587:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c6c85e19" data-attr-id="29299" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">很多方法的返回值使用 IResponse 接口本身， 这个设计能允许使用方进行链式调用</span></span></span></span></span><span data-slate-object="text" data-key="5588"><span data-slate-leaf="true" data-offset-key="5588:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_c6c85e19" data-attr-id="29299" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span><span data-slate-leaf="true" data-offset-key="5588:1"><span data-slate-string="true">链式调用的好处是，能很大提升代码的阅读性，比如在业务逻辑代码 controller.go 里这个调用方法：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="5589"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5590"><span data-slate-object="text" data-key="5591"><span data-slate-leaf="true" data-offset-key="5591:0" data-first-offset="true"><span data-slate-string="true">c.</span></span></span><span data-slate-object="text" data-key="5592"><span data-slate-leaf="true" data-offset-key="5592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">SetOkStatus</span></span></span></span><span data-slate-object="text" data-key="5593"><span data-slate-leaf="true" data-offset-key="5593:0" data-first-offset="true"><span data-slate-string="true">().</span></span></span><span data-slate-object="text" data-key="5594"><span data-slate-leaf="true" data-offset-key="5594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Json</span></span></span></span><span data-slate-object="text" data-key="5595"><span data-slate-leaf="true" data-offset-key="5595:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="5596"><span data-slate-leaf="true" data-offset-key="5596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"ok, UserLoginController:"</span></span></span></span><span data-slate-object="text" data-key="5597"><span data-slate-leaf="true" data-offset-key="5597:0" data-first-offset="true"><span data-slate-string="true"> + foo)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5598"><span data-slate-object="text" data-key="5599"><span data-slate-leaf="true" data-offset-key="5599:0" data-first-offset="true"><span data-slate-string="true">就能很好地阅读：“返回成功，并且输出 JSON 字符串”。这种通过返回值返回接口本身的小技巧，我们后面会经常用到。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5600" id="sr-toc-5"><span data-slate-object="text" data-key="5601"><span data-slate-leaf="true" data-offset-key="5601:0" data-first-offset="true"><span data-slate-string="true">实现具体的接口</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5602"><span data-slate-object="text" data-key="5603"><span data-slate-leaf="true" data-offset-key="5603:0" data-first-offset="true"><span data-slate-string="true">接下来，我们需要实现这两个接口，直接将 Context 这个数据结构，实现这两个接口定义的方法就行了。</span></span></span><span data-slate-object="text" data-key="5604"><span data-slate-leaf="true" data-offset-key="5604:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">因为在 Golang 中，只要包含了接口所带的函数就是实现了接口，并不需要显式标记继承</span></span></span></span><span data-slate-object="text" data-key="5605"><span data-slate-leaf="true" data-offset-key="5605:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5606"><span data-slate-object="text" data-key="5607"><span data-slate-leaf="true" data-offset-key="5607:0" data-first-offset="true"><span data-slate-string="true">由于这些接口有的比较重复，所以这里只解说几个重点的实现，具体可以参考 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5608"><span data-slate-object="text" data-key="5609"><span data-slate-leaf="true" data-offset-key="5609:0" data-first-offset="true"><span data-slate-string="true">GitHub 仓库</span></span></span></a><span data-slate-object="text" data-key="5610"><span data-slate-leaf="true" data-offset-key="5610:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="5611" id="sr-toc-6"><span data-slate-object="text" data-key="5612"><span data-slate-leaf="true" data-offset-key="5612:0" data-first-offset="true"><span data-slate-string="true">请求相关接口实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="5613"><span data-slate-object="text" data-key="5614"><span data-slate-leaf="true" data-offset-key="5614:0" data-first-offset="true"><span data-slate-string="true">我们先将注意力专注在 Request 请求相关的方法上，首先处理刚才在 request.go 中定义的 Query 相关的参数请求方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5615"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5616"><span data-slate-object="text" data-key="5617"><span data-slate-leaf="true" data-offset-key="5617:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5618"><span data-slate-leaf="true" data-offset-key="5618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 请求地址 url 中带的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5619"><span data-slate-object="text" data-key="5620"><span data-slate-leaf="true" data-offset-key="5620:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5621"><span data-slate-leaf="true" data-offset-key="5621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 形如: foo.com?a=1&amp;b=bar&amp;c []=bar</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5622"><span data-slate-object="text" data-key="5623"><span data-slate-leaf="true" data-offset-key="5623:0" data-first-offset="true"><span data-slate-string="true">  QueryInt(key </span></span></span><span data-slate-object="text" data-key="5624"><span data-slate-leaf="true" data-offset-key="5624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5625"><span data-slate-leaf="true" data-offset-key="5625:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5626"><span data-slate-leaf="true" data-offset-key="5626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5627"><span data-slate-leaf="true" data-offset-key="5627:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5628"><span data-slate-leaf="true" data-offset-key="5628:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5629"><span data-slate-leaf="true" data-offset-key="5629:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5630"><span data-slate-leaf="true" data-offset-key="5630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5631"><span data-slate-leaf="true" data-offset-key="5631:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5632"><span data-slate-object="text" data-key="5633"><span data-slate-leaf="true" data-offset-key="5633:0" data-first-offset="true"><span data-slate-string="true">  QueryInt64(key </span></span></span><span data-slate-object="text" data-key="5634"><span data-slate-leaf="true" data-offset-key="5634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5635"><span data-slate-leaf="true" data-offset-key="5635:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5636"><span data-slate-leaf="true" data-offset-key="5636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5637"><span data-slate-leaf="true" data-offset-key="5637:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5638"><span data-slate-leaf="true" data-offset-key="5638:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="5639"><span data-slate-leaf="true" data-offset-key="5639:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5640"><span data-slate-leaf="true" data-offset-key="5640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5641"><span data-slate-leaf="true" data-offset-key="5641:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5642"><span data-slate-object="text" data-key="5643"><span data-slate-leaf="true" data-offset-key="5643:0" data-first-offset="true"><span data-slate-string="true">  QueryFloat64(key </span></span></span><span data-slate-object="text" data-key="5644"><span data-slate-leaf="true" data-offset-key="5644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5645"><span data-slate-leaf="true" data-offset-key="5645:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5646"><span data-slate-leaf="true" data-offset-key="5646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5647"><span data-slate-leaf="true" data-offset-key="5647:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5648"><span data-slate-leaf="true" data-offset-key="5648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span><span data-slate-object="text" data-key="5649"><span data-slate-leaf="true" data-offset-key="5649:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5650"><span data-slate-leaf="true" data-offset-key="5650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5651"><span data-slate-leaf="true" data-offset-key="5651:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5652"><span data-slate-object="text" data-key="5653"><span data-slate-leaf="true" data-offset-key="5653:0" data-first-offset="true"><span data-slate-string="true">  QueryFloat32(key </span></span></span><span data-slate-object="text" data-key="5654"><span data-slate-leaf="true" data-offset-key="5654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5655"><span data-slate-leaf="true" data-offset-key="5655:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5656"><span data-slate-leaf="true" data-offset-key="5656:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5657"><span data-slate-leaf="true" data-offset-key="5657:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5658"><span data-slate-leaf="true" data-offset-key="5658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float32</span></span></span></span><span data-slate-object="text" data-key="5659"><span data-slate-leaf="true" data-offset-key="5659:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5660"><span data-slate-leaf="true" data-offset-key="5660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5661"><span data-slate-leaf="true" data-offset-key="5661:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5662"><span data-slate-object="text" data-key="5663"><span data-slate-leaf="true" data-offset-key="5663:0" data-first-offset="true"><span data-slate-string="true">  QueryBool(key </span></span></span><span data-slate-object="text" data-key="5664"><span data-slate-leaf="true" data-offset-key="5664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5665"><span data-slate-leaf="true" data-offset-key="5665:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5666"><span data-slate-leaf="true" data-offset-key="5666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5667"><span data-slate-leaf="true" data-offset-key="5667:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5668"><span data-slate-leaf="true" data-offset-key="5668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5669"><span data-slate-leaf="true" data-offset-key="5669:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5670"><span data-slate-leaf="true" data-offset-key="5670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5671"><span data-slate-leaf="true" data-offset-key="5671:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5672"><span data-slate-object="text" data-key="5673"><span data-slate-leaf="true" data-offset-key="5673:0" data-first-offset="true"><span data-slate-string="true">  QueryString(key </span></span></span><span data-slate-object="text" data-key="5674"><span data-slate-leaf="true" data-offset-key="5674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5675"><span data-slate-leaf="true" data-offset-key="5675:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5676"><span data-slate-leaf="true" data-offset-key="5676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5677"><span data-slate-leaf="true" data-offset-key="5677:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5678"><span data-slate-leaf="true" data-offset-key="5678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5679"><span data-slate-leaf="true" data-offset-key="5679:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5680"><span data-slate-leaf="true" data-offset-key="5680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5681"><span data-slate-leaf="true" data-offset-key="5681:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5682"><span data-slate-object="text" data-key="5683"><span data-slate-leaf="true" data-offset-key="5683:0" data-first-offset="true"><span data-slate-string="true">  QueryStringSlice(key </span></span></span><span data-slate-object="text" data-key="5684"><span data-slate-leaf="true" data-offset-key="5684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5685"><span data-slate-leaf="true" data-offset-key="5685:0" data-first-offset="true"><span data-slate-string="true">, def []</span></span></span><span data-slate-object="text" data-key="5686"><span data-slate-leaf="true" data-offset-key="5686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5687"><span data-slate-leaf="true" data-offset-key="5687:0" data-first-offset="true"><span data-slate-string="true">) ([]</span></span></span><span data-slate-object="text" data-key="5688"><span data-slate-leaf="true" data-offset-key="5688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5689"><span data-slate-leaf="true" data-offset-key="5689:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5690"><span data-slate-leaf="true" data-offset-key="5690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5691"><span data-slate-leaf="true" data-offset-key="5691:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5692"><span data-slate-object="text" data-key="5693"><span data-slate-leaf="true" data-offset-key="5693:0" data-first-offset="true"><span data-slate-string="true">  Query(key </span></span></span><span data-slate-object="text" data-key="5694"><span data-slate-leaf="true" data-offset-key="5694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5695"><span data-slate-leaf="true" data-offset-key="5695:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="5696"><span data-slate-leaf="true" data-offset-key="5696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="5697"><span data-slate-leaf="true" data-offset-key="5697:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5698"><span data-slate-object="text" data-key="5699"><span data-slate-leaf="true" data-offset-key="5699:0" data-first-offset="true"><span data-slate-string="true">如何获取请求参数呢，我们可以从 http.Request 结构中，通过 Query 方法，获取到请求 URL 中的参数。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5700" id="sr-toc-7"><span data-slate-object="text" data-key="5701"><span data-slate-leaf="true" data-offset-key="5701:0" data-first-offset="true"><span data-slate-string="true">Query 请求方法实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5702"><span data-slate-object="text" data-key="5703"><span data-slate-leaf="true" data-offset-key="5703:0" data-first-offset="true"><span data-slate-string="true">所以，在 request.go 中，我们先创建一个 QueryAll () 方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5704"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5705"><span data-slate-object="text" data-key="5706"><span data-slate-leaf="true" data-offset-key="5706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取请求地址中所有参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5707"><span data-slate-object="text" data-key="5708"><span data-slate-leaf="true" data-offset-key="5708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5709"><span data-slate-leaf="true" data-offset-key="5709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5710"><span data-slate-leaf="true" data-offset-key="5710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="5711"><span data-slate-leaf="true" data-offset-key="5711:0" data-first-offset="true"><span data-slate-string="true"> QueryAll() </span></span></span><span data-slate-object="text" data-key="5712"><span data-slate-leaf="true" data-offset-key="5712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5713"><span data-slate-leaf="true" data-offset-key="5713:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5714"><span data-slate-leaf="true" data-offset-key="5714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5715"><span data-slate-leaf="true" data-offset-key="5715:0" data-first-offset="true"><span data-slate-string="true">][]</span></span></span><span data-slate-object="text" data-key="5716"><span data-slate-leaf="true" data-offset-key="5716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5717"><span data-slate-leaf="true" data-offset-key="5717:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5718"><span data-slate-object="text" data-key="5719"><span data-slate-leaf="true" data-offset-key="5719:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5720"><span data-slate-leaf="true" data-offset-key="5720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5721"><span data-slate-leaf="true" data-offset-key="5721:0" data-first-offset="true"><span data-slate-string="true"> ctx.request != </span></span></span><span data-slate-object="text" data-key="5722"><span data-slate-leaf="true" data-offset-key="5722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5723"><span data-slate-leaf="true" data-offset-key="5723:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5724"><span data-slate-object="text" data-key="5725"><span data-slate-leaf="true" data-offset-key="5725:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5726"><span data-slate-leaf="true" data-offset-key="5726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5727"><span data-slate-leaf="true" data-offset-key="5727:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5728"><span data-slate-leaf="true" data-offset-key="5728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5729"><span data-slate-leaf="true" data-offset-key="5729:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5730"><span data-slate-leaf="true" data-offset-key="5730:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5731"><span data-slate-leaf="true" data-offset-key="5731:0" data-first-offset="true"><span data-slate-string="true">][]</span></span></span><span data-slate-object="text" data-key="5732"><span data-slate-leaf="true" data-offset-key="5732:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5733"><span data-slate-leaf="true" data-offset-key="5733:0" data-first-offset="true"><span data-slate-string="true">(ctx.request.URL.Query())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5734"><span data-slate-object="text" data-key="5735"><span data-slate-leaf="true" data-offset-key="5735:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5736"><span data-slate-object="text" data-key="5737"><span data-slate-leaf="true" data-offset-key="5737:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5738"><span data-slate-leaf="true" data-offset-key="5738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5739"><span data-slate-leaf="true" data-offset-key="5739:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5740"><span data-slate-leaf="true" data-offset-key="5740:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="5741"><span data-slate-leaf="true" data-offset-key="5741:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="5742"><span data-slate-leaf="true" data-offset-key="5742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5743"><span data-slate-leaf="true" data-offset-key="5743:0" data-first-offset="true"><span data-slate-string="true">][]</span></span></span><span data-slate-object="text" data-key="5744"><span data-slate-leaf="true" data-offset-key="5744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5745"><span data-slate-leaf="true" data-offset-key="5745:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5746"><span data-slate-object="text" data-key="5747"><span data-slate-leaf="true" data-offset-key="5747:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5748"><span data-slate-object="text" data-key="5749"><span data-slate-leaf="true" data-offset-key="5749:0" data-first-offset="true"><span data-slate-string="true">接着要做的，就是将这个 QueryAll 查询出来的 map 结构根据 key 查询，并且转换为其他类型的数据结构，比如 Int、Int64、Float64、Float32 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5750"><span data-slate-object="text" data-key="5751"><span data-slate-leaf="true" data-offset-key="5751:0" data-first-offset="true"><span data-slate-string="true">这里我推荐一个</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5752"><span data-slate-object="text" data-key="5753"><span data-slate-leaf="true" data-offset-key="5753:0" data-first-offset="true"><span data-slate-string="true">第三方库 cast</span></span></span></a><span data-slate-object="text" data-key="5754"><span data-slate-leaf="true" data-offset-key="5754:0" data-first-offset="true"><span data-slate-string="true">，这个库实现了多种常见类型之间的相互转换，返回最符合直觉的结果，通过</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="5755"><span data-slate-object="text" data-key="5756"><span data-slate-leaf="true" data-offset-key="5756:0" data-first-offset="true"><span data-slate-string="true">这个网站</span></span></span></a><span data-slate-object="text" data-key="5757"><span data-slate-leaf="true" data-offset-key="5757:0" data-first-offset="true"><span data-slate-string="true">可以查看其提供的所有方法，这里展示部分你可以看看：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5758"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5759"><span data-slate-object="text" data-key="5760"><span data-slate-leaf="true" data-offset-key="5760:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5761"><span data-slate-object="text" data-key="5762"><span data-slate-leaf="true" data-offset-key="5762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5763"><span data-slate-leaf="true" data-offset-key="5763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5764"><span data-slate-leaf="true" data-offset-key="5764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint</span></span></span></span></span><span data-slate-object="text" data-key="5765"><span data-slate-leaf="true" data-offset-key="5765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5766"><span data-slate-leaf="true" data-offset-key="5766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5767"><span data-slate-leaf="true" data-offset-key="5767:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5768"><span data-slate-leaf="true" data-offset-key="5768:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5769"><span data-slate-leaf="true" data-offset-key="5769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5770"><span data-slate-object="text" data-key="5771"><span data-slate-leaf="true" data-offset-key="5771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5772"><span data-slate-leaf="true" data-offset-key="5772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5773"><span data-slate-leaf="true" data-offset-key="5773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint16</span></span></span></span></span><span data-slate-object="text" data-key="5774"><span data-slate-leaf="true" data-offset-key="5774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5775"><span data-slate-leaf="true" data-offset-key="5775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5776"><span data-slate-leaf="true" data-offset-key="5776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5777"><span data-slate-leaf="true" data-offset-key="5777:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5778"><span data-slate-leaf="true" data-offset-key="5778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint16</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5779"><span data-slate-object="text" data-key="5780"><span data-slate-leaf="true" data-offset-key="5780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5781"><span data-slate-leaf="true" data-offset-key="5781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5782"><span data-slate-leaf="true" data-offset-key="5782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint16E</span></span></span></span></span><span data-slate-object="text" data-key="5783"><span data-slate-leaf="true" data-offset-key="5783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5784"><span data-slate-leaf="true" data-offset-key="5784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5785"><span data-slate-leaf="true" data-offset-key="5785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5786"><span data-slate-leaf="true" data-offset-key="5786:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="5787"><span data-slate-leaf="true" data-offset-key="5787:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint16</span></span></span></span><span data-slate-object="text" data-key="5788"><span data-slate-leaf="true" data-offset-key="5788:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5789"><span data-slate-leaf="true" data-offset-key="5789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5790"><span data-slate-leaf="true" data-offset-key="5790:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5791"><span data-slate-object="text" data-key="5792"><span data-slate-leaf="true" data-offset-key="5792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5793"><span data-slate-leaf="true" data-offset-key="5793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5794"><span data-slate-leaf="true" data-offset-key="5794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint32</span></span></span></span></span><span data-slate-object="text" data-key="5795"><span data-slate-leaf="true" data-offset-key="5795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5796"><span data-slate-leaf="true" data-offset-key="5796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5797"><span data-slate-leaf="true" data-offset-key="5797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5798"><span data-slate-leaf="true" data-offset-key="5798:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5799"><span data-slate-leaf="true" data-offset-key="5799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint32</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5800"><span data-slate-object="text" data-key="5801"><span data-slate-leaf="true" data-offset-key="5801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5802"><span data-slate-leaf="true" data-offset-key="5802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5803"><span data-slate-leaf="true" data-offset-key="5803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint32E</span></span></span></span></span><span data-slate-object="text" data-key="5804"><span data-slate-leaf="true" data-offset-key="5804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5805"><span data-slate-leaf="true" data-offset-key="5805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5806"><span data-slate-leaf="true" data-offset-key="5806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5807"><span data-slate-leaf="true" data-offset-key="5807:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="5808"><span data-slate-leaf="true" data-offset-key="5808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint32</span></span></span></span><span data-slate-object="text" data-key="5809"><span data-slate-leaf="true" data-offset-key="5809:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5810"><span data-slate-leaf="true" data-offset-key="5810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5811"><span data-slate-leaf="true" data-offset-key="5811:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5812"><span data-slate-object="text" data-key="5813"><span data-slate-leaf="true" data-offset-key="5813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5814"><span data-slate-leaf="true" data-offset-key="5814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5815"><span data-slate-leaf="true" data-offset-key="5815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint64</span></span></span></span></span><span data-slate-object="text" data-key="5816"><span data-slate-leaf="true" data-offset-key="5816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5817"><span data-slate-leaf="true" data-offset-key="5817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5818"><span data-slate-leaf="true" data-offset-key="5818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5819"><span data-slate-leaf="true" data-offset-key="5819:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5820"><span data-slate-leaf="true" data-offset-key="5820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5821"><span data-slate-object="text" data-key="5822"><span data-slate-leaf="true" data-offset-key="5822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5823"><span data-slate-leaf="true" data-offset-key="5823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5824"><span data-slate-leaf="true" data-offset-key="5824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint64E</span></span></span></span></span><span data-slate-object="text" data-key="5825"><span data-slate-leaf="true" data-offset-key="5825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5826"><span data-slate-leaf="true" data-offset-key="5826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5827"><span data-slate-leaf="true" data-offset-key="5827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5828"><span data-slate-leaf="true" data-offset-key="5828:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="5829"><span data-slate-leaf="true" data-offset-key="5829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint64</span></span></span></span><span data-slate-object="text" data-key="5830"><span data-slate-leaf="true" data-offset-key="5830:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5831"><span data-slate-leaf="true" data-offset-key="5831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5832"><span data-slate-leaf="true" data-offset-key="5832:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5833"><span data-slate-object="text" data-key="5834"><span data-slate-leaf="true" data-offset-key="5834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5835"><span data-slate-leaf="true" data-offset-key="5835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5836"><span data-slate-leaf="true" data-offset-key="5836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint8</span></span></span></span></span><span data-slate-object="text" data-key="5837"><span data-slate-leaf="true" data-offset-key="5837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5838"><span data-slate-leaf="true" data-offset-key="5838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5839"><span data-slate-leaf="true" data-offset-key="5839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5840"><span data-slate-leaf="true" data-offset-key="5840:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5841"><span data-slate-leaf="true" data-offset-key="5841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint8</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5842"><span data-slate-object="text" data-key="5843"><span data-slate-leaf="true" data-offset-key="5843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5844"><span data-slate-leaf="true" data-offset-key="5844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5845"><span data-slate-leaf="true" data-offset-key="5845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUint8E</span></span></span></span></span><span data-slate-object="text" data-key="5846"><span data-slate-leaf="true" data-offset-key="5846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5847"><span data-slate-leaf="true" data-offset-key="5847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5848"><span data-slate-leaf="true" data-offset-key="5848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5849"><span data-slate-leaf="true" data-offset-key="5849:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="5850"><span data-slate-leaf="true" data-offset-key="5850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint8</span></span></span></span><span data-slate-object="text" data-key="5851"><span data-slate-leaf="true" data-offset-key="5851:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5852"><span data-slate-leaf="true" data-offset-key="5852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5853"><span data-slate-leaf="true" data-offset-key="5853:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5854"><span data-slate-object="text" data-key="5855"><span data-slate-leaf="true" data-offset-key="5855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5856"><span data-slate-leaf="true" data-offset-key="5856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5857"><span data-slate-leaf="true" data-offset-key="5857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ToUintE</span></span></span></span></span><span data-slate-object="text" data-key="5858"><span data-slate-leaf="true" data-offset-key="5858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(i </span></span></span></span></span><span data-slate-object="text" data-key="5859"><span data-slate-leaf="true" data-offset-key="5859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span></span></span><span data-slate-object="text" data-key="5860"><span data-slate-leaf="true" data-offset-key="5860:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">{})</span></span></span></span></span><span data-slate-object="text" data-key="5861"><span data-slate-leaf="true" data-offset-key="5861:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="5862"><span data-slate-leaf="true" data-offset-key="5862:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint</span></span></span></span><span data-slate-object="text" data-key="5863"><span data-slate-leaf="true" data-offset-key="5863:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5864"><span data-slate-leaf="true" data-offset-key="5864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5865"><span data-slate-leaf="true" data-offset-key="5865:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5866"><span data-slate-object="text" data-key="5867"><span data-slate-leaf="true" data-offset-key="5867:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5868"><span data-slate-object="text" data-key="5869"><span data-slate-leaf="true" data-offset-key="5869:0" data-first-offset="true"><span data-slate-string="true">归纳起来，cast 提供类型转换方法，参数可以是任意类型，转换为对应的目标类型，每种转换会提供两组方法，一组是带 error 返回值的方法，一组是不带 error 返回值的。如果使用 cast 库，我们将 request.go 中 QueryXXX 方式的实现修改一下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5870"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5871"><span data-slate-object="text" data-key="5872"><span data-slate-leaf="true" data-offset-key="5872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 Int 类型的请求参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5873"><span data-slate-object="text" data-key="5874"><span data-slate-leaf="true" data-offset-key="5874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5875"><span data-slate-leaf="true" data-offset-key="5875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5876"><span data-slate-leaf="true" data-offset-key="5876:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="5877"><span data-slate-leaf="true" data-offset-key="5877:0" data-first-offset="true"><span data-slate-string="true"> QueryInt(key </span></span></span><span data-slate-object="text" data-key="5878"><span data-slate-leaf="true" data-offset-key="5878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5879"><span data-slate-leaf="true" data-offset-key="5879:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="5880"><span data-slate-leaf="true" data-offset-key="5880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5881"><span data-slate-leaf="true" data-offset-key="5881:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="5882"><span data-slate-leaf="true" data-offset-key="5882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="5883"><span data-slate-leaf="true" data-offset-key="5883:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="5884"><span data-slate-leaf="true" data-offset-key="5884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="5885"><span data-slate-leaf="true" data-offset-key="5885:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5886"><span data-slate-object="text" data-key="5887"><span data-slate-leaf="true" data-offset-key="5887:0" data-first-offset="true"><span data-slate-string="true">  params := ctx.QueryAll()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5888"><span data-slate-object="text" data-key="5889"><span data-slate-leaf="true" data-offset-key="5889:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5890"><span data-slate-leaf="true" data-offset-key="5890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5891"><span data-slate-leaf="true" data-offset-key="5891:0" data-first-offset="true"><span data-slate-string="true"> vals, ok := params[key]; ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5892"><span data-slate-object="text" data-key="5893"><span data-slate-leaf="true" data-offset-key="5893:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5894"><span data-slate-leaf="true" data-offset-key="5894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5895"><span data-slate-leaf="true" data-offset-key="5895:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="5896"><span data-slate-leaf="true" data-offset-key="5896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="5897"><span data-slate-leaf="true" data-offset-key="5897:0" data-first-offset="true"><span data-slate-string="true">(vals) &gt; </span></span></span><span data-slate-object="text" data-key="5898"><span data-slate-leaf="true" data-offset-key="5898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="5899"><span data-slate-leaf="true" data-offset-key="5899:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5900"><span data-slate-object="text" data-key="5901"><span data-slate-leaf="true" data-offset-key="5901:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="5902"><span data-slate-leaf="true" data-offset-key="5902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用 cast 库将 string 转换为 Int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5903"><span data-slate-object="text" data-key="5904"><span data-slate-leaf="true" data-offset-key="5904:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="5905"><span data-slate-leaf="true" data-offset-key="5905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5906"><span data-slate-leaf="true" data-offset-key="5906:0" data-first-offset="true"><span data-slate-string="true"> cast.ToInt(vals[</span></span></span><span data-slate-object="text" data-key="5907"><span data-slate-leaf="true" data-offset-key="5907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="5908"><span data-slate-leaf="true" data-offset-key="5908:0" data-first-offset="true"><span data-slate-string="true">]), </span></span></span><span data-slate-object="text" data-key="5909"><span data-slate-leaf="true" data-offset-key="5909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5910"><span data-slate-object="text" data-key="5911"><span data-slate-leaf="true" data-offset-key="5911:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5912"><span data-slate-object="text" data-key="5913"><span data-slate-leaf="true" data-offset-key="5913:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5914"><span data-slate-object="text" data-key="5915"><span data-slate-leaf="true" data-offset-key="5915:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5916"><span data-slate-leaf="true" data-offset-key="5916:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="5917"><span data-slate-leaf="true" data-offset-key="5917:0" data-first-offset="true"><span data-slate-string="true"> def, </span></span></span><span data-slate-object="text" data-key="5918"><span data-slate-leaf="true" data-offset-key="5918:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5919"><span data-slate-object="text" data-key="5920"><span data-slate-leaf="true" data-offset-key="5920:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5921"><span data-slate-object="text" data-key="5922"><span data-slate-leaf="true" data-offset-key="5922:0" data-first-offset="true"><span data-slate-string="true">QueryAll 返回一个 map 结构，根据 key 查找出对应的参数值，并且通过 cast 库将对应的参数值转化成目标数据结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5923"><span data-slate-object="text" data-key="5924"><span data-slate-leaf="true" data-offset-key="5924:0" data-first-offset="true"><span data-slate-string="true">Query 的参数请求方法就实现完成了。</span></span></span><span data-slate-object="text" data-key="5925"><span data-slate-leaf="true" data-offset-key="5925:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Form 表单相关的请求方法是从 HTTP Body 中获取参数，同 Query 方法相类似，我们就不再重复</span></span></span></span><span data-slate-object="text" data-key="5926"><span data-slate-leaf="true" data-offset-key="5926:0" data-first-offset="true"><span data-slate-string="true">，简单说下思路：可以从 http.Request 中获取到 Form 的请求参数，然后再用 cast 库进行类型转换。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="5927" id="sr-toc-8"><span data-slate-object="text" data-key="5928"><span data-slate-leaf="true" data-offset-key="5928:0" data-first-offset="true"><span data-slate-string="true">Param 请求方法实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="5929"><span data-slate-object="text" data-key="5930"><span data-slate-leaf="true" data-offset-key="5930:0" data-first-offset="true"><span data-slate-string="true">接下来，我们需要实现 Param 相关的请求方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5931"><span data-slate-object="text" data-key="5932"><span data-slate-leaf="true" data-offset-key="5932:0" data-first-offset="true"><span data-slate-string="true">Param 的请求方法是：通过路由解析请求地址，抽取请求地址中包含通配符的段。比如路由规则为 /subject/:id，真实请求 URI 为 /subject/1，那么获取 key 为 id 的 Param 值就为 1。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5933"><span data-slate-object="text" data-key="5934"><span data-slate-leaf="true" data-offset-key="5934:0" data-first-offset="true"><span data-slate-string="true">怎么实现我们得回顾第三节课讲的路由，用 trie 树实现了路由规则。当请求进入的时候，将请求的 URI 地址根据分隔符分成不同的段，用这个段去匹配 trie 树。只有当每个段都匹配 trie 树中某个路径的时候，我们才将路径终止节点里的 Handlers ，作为这个请求的最终处理函数。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="5935"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/68/98/6837822864392bbb5e7345518448b098.jpg?wh=1920x1080"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5936"><span data-slate-object="text" data-key="5937"><span data-slate-leaf="true" data-offset-key="5937:0" data-first-offset="true"><span data-slate-string="true">而在这个匹配路径中，有的节点是根据通配符进行匹配的，这些节点就是我们要查找的 Param 参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5938"><span data-slate-object="text" data-key="5939"><span data-slate-leaf="true" data-offset-key="5939:0" data-first-offset="true"><span data-slate-string="true">现在就要获取路由解析过程中的这些通配符参数，</span></span></span><span data-slate-object="text" data-key="5940"><span data-slate-leaf="true" data-offset-key="5940:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7952f811" data-attr-id="41009" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">最朴素的想法就是：查找出这个匹配路径，然后查找出其中的通配符节点，再和请求 URI 对应，获取这些通配符参数</span></span></span></span></span><span data-slate-object="text" data-key="5941"><span data-slate-leaf="true" data-offset-key="5941:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7952f811" data-attr-id="41009" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span><span data-slate-leaf="true" data-offset-key="5941:1"><span data-slate-string="true">我们看这个想法如何实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5942"><span data-slate-object="text" data-key="5943"><span data-slate-leaf="true" data-offset-key="5943:0" data-first-offset="true"><span data-slate-string="true">之前查找路由的时候，查到的是匹配路径的最终节点，如何追溯到整个匹配路径呢？这里我们可以考虑构造一个双向链表：改造 node 节点，增加一个 parent 指针，指向父节点，将 trie 树变成一个双向指针。来修改框架目录中的 trie.go：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5944"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5945"><span data-slate-object="text" data-key="5946"><span data-slate-leaf="true" data-offset-key="5946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 代表节点</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5947"><span data-slate-object="text" data-key="5948"><span data-slate-leaf="true" data-offset-key="5948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="5949"><span data-slate-leaf="true" data-offset-key="5949:0" data-first-offset="true"><span data-slate-string="true"> node </span></span></span><span data-slate-object="text" data-key="5950"><span data-slate-leaf="true" data-offset-key="5950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="5951"><span data-slate-leaf="true" data-offset-key="5951:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5952"><span data-slate-object="text" data-key="5953"><span data-slate-leaf="true" data-offset-key="5953:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5954"><span data-slate-object="text" data-key="5955"><span data-slate-leaf="true" data-offset-key="5955:0" data-first-offset="true"><span data-slate-string="true">  parent   *node               </span></span></span><span data-slate-object="text" data-key="5956"><span data-slate-leaf="true" data-offset-key="5956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 父节点，双向指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5957"><span data-slate-object="text" data-key="5958"><span data-slate-leaf="true" data-offset-key="5958:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="5959"><span data-slate-object="text" data-key="5960"><span data-slate-leaf="true" data-offset-key="5960:0" data-first-offset="true"><span data-slate-string="true">在增加路由规则（AddRouter）的时候，创建子节点也要同时修改这个 parent 指针，继续写：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="5961"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="5962"><span data-slate-object="text" data-key="5963"><span data-slate-leaf="true" data-offset-key="5963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="5964"><span data-slate-leaf="true" data-offset-key="5964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="5965"><span data-slate-leaf="true" data-offset-key="5965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(tree *Tree)</span></span></span></span></span><span data-slate-object="text" data-key="5966"><span data-slate-leaf="true" data-offset-key="5966:0" data-first-offset="true"><span data-slate-string="true"> AddRouter(uri </span></span></span><span data-slate-object="text" data-key="5967"><span data-slate-leaf="true" data-offset-key="5967:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="5968"><span data-slate-leaf="true" data-offset-key="5968:0" data-first-offset="true"><span data-slate-string="true">, handlers []ControllerHandler) </span></span></span><span data-slate-object="text" data-key="5969"><span data-slate-leaf="true" data-offset-key="5969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="5970"><span data-slate-leaf="true" data-offset-key="5970:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5971"><span data-slate-object="text" data-key="5972"><span data-slate-leaf="true" data-offset-key="5972:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5973"><span data-slate-object="text" data-key="5974"><span data-slate-leaf="true" data-offset-key="5974:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5975"><span data-slate-leaf="true" data-offset-key="5975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对每个 segment</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5976"><span data-slate-object="text" data-key="5977"><span data-slate-leaf="true" data-offset-key="5977:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="5978"><span data-slate-leaf="true" data-offset-key="5978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="5979"><span data-slate-leaf="true" data-offset-key="5979:0" data-first-offset="true"><span data-slate-string="true"> index, segment := </span></span></span><span data-slate-object="text" data-key="5980"><span data-slate-leaf="true" data-offset-key="5980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="5981"><span data-slate-leaf="true" data-offset-key="5981:0" data-first-offset="true"><span data-slate-string="true"> segments {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5982"></div><div data-slate-type="code-line" data-slate-object="block" data-key="5983"><span data-slate-object="text" data-key="5984"><span data-slate-leaf="true" data-offset-key="5984:0" data-first-offset="true"><span data-slate-string="true">    ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5985"><span data-slate-object="text" data-key="5986"><span data-slate-leaf="true" data-offset-key="5986:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="5987"><span data-slate-leaf="true" data-offset-key="5987:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="5988"><span data-slate-leaf="true" data-offset-key="5988:0" data-first-offset="true"><span data-slate-string="true"> objNode == </span></span></span><span data-slate-object="text" data-key="5989"><span data-slate-leaf="true" data-offset-key="5989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="5990"><span data-slate-leaf="true" data-offset-key="5990:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5991"><span data-slate-object="text" data-key="5992"><span data-slate-leaf="true" data-offset-key="5992:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="5993"><span data-slate-leaf="true" data-offset-key="5993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 创建一个当前 node 的节点</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5994"><span data-slate-object="text" data-key="5995"><span data-slate-leaf="true" data-offset-key="5995:0" data-first-offset="true"><span data-slate-string="true">      cnode := newNode()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5996"><span data-slate-object="text" data-key="5997"><span data-slate-leaf="true" data-offset-key="5997:0" data-first-offset="true"><span data-slate-string="true">      cnode.segment = segment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="5998"><span data-slate-object="text" data-key="5999"><span data-slate-leaf="true" data-offset-key="5999:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6000"><span data-slate-leaf="true" data-offset-key="6000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6001"><span data-slate-leaf="true" data-offset-key="6001:0" data-first-offset="true"><span data-slate-string="true"> isLast {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6002"><span data-slate-object="text" data-key="6003"><span data-slate-leaf="true" data-offset-key="6003:0" data-first-offset="true"><span data-slate-string="true">        cnode.isLast = </span></span></span><span data-slate-object="text" data-key="6004"><span data-slate-leaf="true" data-offset-key="6004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6005"><span data-slate-object="text" data-key="6006"><span data-slate-leaf="true" data-offset-key="6006:0" data-first-offset="true"><span data-slate-string="true">        cnode.handlers = handlers</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6007"><span data-slate-object="text" data-key="6008"><span data-slate-leaf="true" data-offset-key="6008:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6009"><span data-slate-object="text" data-key="6010"><span data-slate-leaf="true" data-offset-key="6010:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6011"><span data-slate-leaf="true" data-offset-key="6011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 父节点指针修改</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6012"><span data-slate-object="text" data-key="6013"><span data-slate-leaf="true" data-offset-key="6013:0" data-first-offset="true"><span data-slate-string="true">      cnode.parent = n</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6014"><span data-slate-object="text" data-key="6015"><span data-slate-leaf="true" data-offset-key="6015:0" data-first-offset="true"><span data-slate-string="true">      n.childs = </span></span></span><span data-slate-object="text" data-key="6016"><span data-slate-leaf="true" data-offset-key="6016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">append</span></span></span></span><span data-slate-object="text" data-key="6017"><span data-slate-leaf="true" data-offset-key="6017:0" data-first-offset="true"><span data-slate-string="true">(n.childs, cnode)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6018"><span data-slate-object="text" data-key="6019"><span data-slate-leaf="true" data-offset-key="6019:0" data-first-offset="true"><span data-slate-string="true">      objNode = cnode</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6020"><span data-slate-object="text" data-key="6021"><span data-slate-leaf="true" data-offset-key="6021:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6022"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6023"><span data-slate-object="text" data-key="6024"><span data-slate-leaf="true" data-offset-key="6024:0" data-first-offset="true"><span data-slate-string="true">    n = objNode</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6025"><span data-slate-object="text" data-key="6026"><span data-slate-leaf="true" data-offset-key="6026:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6027"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6028"><span data-slate-object="text" data-key="6029"><span data-slate-leaf="true" data-offset-key="6029:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6030"><span data-slate-leaf="true" data-offset-key="6030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6031"><span data-slate-leaf="true" data-offset-key="6031:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6032"><span data-slate-leaf="true" data-offset-key="6032:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6033"><span data-slate-object="text" data-key="6034"><span data-slate-leaf="true" data-offset-key="6034:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6035"><span data-slate-object="text" data-key="6036"><span data-slate-leaf="true" data-offset-key="6036:0" data-first-offset="true"><span data-slate-string="true">这样，双向链表就修改完了。接着就根据最终匹配的节点和请求 URI，查找出整个匹配链路中的通配符节点和对应 URI 中的分段，还是在 trie.go 里继续写：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6037"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6038"><span data-slate-object="text" data-key="6039"><span data-slate-leaf="true" data-offset-key="6039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 uri 解析为 params</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6040"><span data-slate-object="text" data-key="6041"><span data-slate-leaf="true" data-offset-key="6041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6042"><span data-slate-leaf="true" data-offset-key="6042:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6043"><span data-slate-leaf="true" data-offset-key="6043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(n *node)</span></span></span></span></span><span data-slate-object="text" data-key="6044"><span data-slate-leaf="true" data-offset-key="6044:0" data-first-offset="true"><span data-slate-string="true"> parseParamsFromEndNode(uri </span></span></span><span data-slate-object="text" data-key="6045"><span data-slate-leaf="true" data-offset-key="6045:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6046"><span data-slate-leaf="true" data-offset-key="6046:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="6047"><span data-slate-leaf="true" data-offset-key="6047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="6048"><span data-slate-leaf="true" data-offset-key="6048:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="6049"><span data-slate-leaf="true" data-offset-key="6049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6050"><span data-slate-leaf="true" data-offset-key="6050:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="6051"><span data-slate-leaf="true" data-offset-key="6051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6052"><span data-slate-leaf="true" data-offset-key="6052:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6053"><span data-slate-object="text" data-key="6054"><span data-slate-leaf="true" data-offset-key="6054:0" data-first-offset="true"><span data-slate-string="true">  ret := </span></span></span><span data-slate-object="text" data-key="6055"><span data-slate-leaf="true" data-offset-key="6055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="6056"><span data-slate-leaf="true" data-offset-key="6056:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="6057"><span data-slate-leaf="true" data-offset-key="6057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6058"><span data-slate-leaf="true" data-offset-key="6058:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="6059"><span data-slate-leaf="true" data-offset-key="6059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6060"><span data-slate-leaf="true" data-offset-key="6060:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6061"><span data-slate-object="text" data-key="6062"><span data-slate-leaf="true" data-offset-key="6062:0" data-first-offset="true"><span data-slate-string="true">  segments := strings.Split(uri, </span></span></span><span data-slate-object="text" data-key="6063"><span data-slate-leaf="true" data-offset-key="6063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"/"</span></span></span></span><span data-slate-object="text" data-key="6064"><span data-slate-leaf="true" data-offset-key="6064:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6065"><span data-slate-object="text" data-key="6066"><span data-slate-leaf="true" data-offset-key="6066:0" data-first-offset="true"><span data-slate-string="true">  cnt := </span></span></span><span data-slate-object="text" data-key="6067"><span data-slate-leaf="true" data-offset-key="6067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="6068"><span data-slate-leaf="true" data-offset-key="6068:0" data-first-offset="true"><span data-slate-string="true">(segments)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6069"><span data-slate-object="text" data-key="6070"><span data-slate-leaf="true" data-offset-key="6070:0" data-first-offset="true"><span data-slate-string="true">  cur := n</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6071"><span data-slate-object="text" data-key="6072"><span data-slate-leaf="true" data-offset-key="6072:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6073"><span data-slate-leaf="true" data-offset-key="6073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="6074"><span data-slate-leaf="true" data-offset-key="6074:0" data-first-offset="true"><span data-slate-string="true"> i := cnt - </span></span></span><span data-slate-object="text" data-key="6075"><span data-slate-leaf="true" data-offset-key="6075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="6076"><span data-slate-leaf="true" data-offset-key="6076:0" data-first-offset="true"><span data-slate-string="true">; i &gt;= </span></span></span><span data-slate-object="text" data-key="6077"><span data-slate-leaf="true" data-offset-key="6077:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="6078"><span data-slate-leaf="true" data-offset-key="6078:0" data-first-offset="true"><span data-slate-string="true">; i-- {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6079"><span data-slate-object="text" data-key="6080"><span data-slate-leaf="true" data-offset-key="6080:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6081"><span data-slate-leaf="true" data-offset-key="6081:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6082"><span data-slate-leaf="true" data-offset-key="6082:0" data-first-offset="true"><span data-slate-string="true"> cur.segment == </span></span></span><span data-slate-object="text" data-key="6083"><span data-slate-leaf="true" data-offset-key="6083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span><span data-slate-object="text" data-key="6084"><span data-slate-leaf="true" data-offset-key="6084:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6085"><span data-slate-object="text" data-key="6086"><span data-slate-leaf="true" data-offset-key="6086:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6087"><span data-slate-leaf="true" data-offset-key="6087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6088"><span data-slate-object="text" data-key="6089"><span data-slate-leaf="true" data-offset-key="6089:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6090"><span data-slate-object="text" data-key="6091"><span data-slate-leaf="true" data-offset-key="6091:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6092"><span data-slate-leaf="true" data-offset-key="6092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果是通配符节点</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6093"><span data-slate-object="text" data-key="6094"><span data-slate-leaf="true" data-offset-key="6094:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6095"><span data-slate-leaf="true" data-offset-key="6095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6096"><span data-slate-leaf="true" data-offset-key="6096:0" data-first-offset="true"><span data-slate-string="true"> isWildSegment(cur.segment) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6097"><span data-slate-object="text" data-key="6098"><span data-slate-leaf="true" data-offset-key="6098:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6099"><span data-slate-leaf="true" data-offset-key="6099:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 params</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6100"><span data-slate-object="text" data-key="6101"><span data-slate-leaf="true" data-offset-key="6101:0" data-first-offset="true"><span data-slate-string="true">      ret[cur.segment[</span></span></span><span data-slate-object="text" data-key="6102"><span data-slate-leaf="true" data-offset-key="6102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="6103"><span data-slate-leaf="true" data-offset-key="6103:0" data-first-offset="true"><span data-slate-string="true">:]] = segments[i]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6104"><span data-slate-object="text" data-key="6105"><span data-slate-leaf="true" data-offset-key="6105:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6106"><span data-slate-object="text" data-key="6107"><span data-slate-leaf="true" data-offset-key="6107:0" data-first-offset="true"><span data-slate-string="true">    cur = cur.parent</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6108"><span data-slate-object="text" data-key="6109"><span data-slate-leaf="true" data-offset-key="6109:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6110"><span data-slate-object="text" data-key="6111"><span data-slate-leaf="true" data-offset-key="6111:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6112"><span data-slate-leaf="true" data-offset-key="6112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6113"><span data-slate-leaf="true" data-offset-key="6113:0" data-first-offset="true"><span data-slate-string="true"> ret</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6114"><span data-slate-object="text" data-key="6115"><span data-slate-leaf="true" data-offset-key="6115:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6116"><span data-slate-object="text" data-key="6117"><span data-slate-leaf="true" data-offset-key="6117:0" data-first-offset="true"><span data-slate-string="true">接下来，为了让 context 中有 map 结构的路由参数，我们将解析出来的 params 存储到 context 结构中。这里修改框架目录中的 core.go 文件：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6118"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6119"><span data-slate-object="text" data-key="6120"><span data-slate-leaf="true" data-offset-key="6120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 所有请求都进入这个函数，这个函数负责路由分发</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6121"><span data-slate-object="text" data-key="6122"><span data-slate-leaf="true" data-offset-key="6122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6123"><span data-slate-leaf="true" data-offset-key="6123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6124"><span data-slate-leaf="true" data-offset-key="6124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *Core)</span></span></span></span></span><span data-slate-object="text" data-key="6125"><span data-slate-leaf="true" data-offset-key="6125:0" data-first-offset="true"><span data-slate-string="true"> ServeHTTP(response http.ResponseWriter, request *http.Request) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6126"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6127"><span data-slate-object="text" data-key="6128"><span data-slate-leaf="true" data-offset-key="6128:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6129"><span data-slate-leaf="true" data-offset-key="6129:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 封装自定义 context</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6130"><span data-slate-object="text" data-key="6131"><span data-slate-leaf="true" data-offset-key="6131:0" data-first-offset="true"><span data-slate-string="true">  ctx := NewContext(request, response)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6132"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6133"><span data-slate-object="text" data-key="6134"><span data-slate-leaf="true" data-offset-key="6134:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6135"><span data-slate-leaf="true" data-offset-key="6135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 寻找路由</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6136"><span data-slate-object="text" data-key="6137"><span data-slate-leaf="true" data-offset-key="6137:0" data-first-offset="true"><span data-slate-string="true">  node := c.FindRouteNodeByRequest(request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6138"><span data-slate-object="text" data-key="6139"><span data-slate-leaf="true" data-offset-key="6139:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6140"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6141"><span data-slate-object="text" data-key="6142"><span data-slate-leaf="true" data-offset-key="6142:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6143"><span data-slate-leaf="true" data-offset-key="6143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置路由参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6144"><span data-slate-object="text" data-key="6145"><span data-slate-leaf="true" data-offset-key="6145:0" data-first-offset="true"><span data-slate-string="true">  params := node.parseParamsFromEndNode(request.URL.Path)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6146"><span data-slate-object="text" data-key="6147"><span data-slate-leaf="true" data-offset-key="6147:0" data-first-offset="true"><span data-slate-string="true">  ctx.SetParams(params)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6148"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6149"><span data-slate-object="text" data-key="6150"><span data-slate-leaf="true" data-offset-key="6150:0" data-first-offset="true"><span data-slate-string="true">  ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6151"><span data-slate-object="text" data-key="6152"><span data-slate-leaf="true" data-offset-key="6152:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6153"><span data-slate-object="text" data-key="6154"><span data-slate-leaf="true" data-offset-key="6154:0" data-first-offset="true"><span data-slate-string="true">最后，回到框架目录的 request.go，我们还是使用 cast 库来将这个 Param 系列方法完成：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6155"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6156"><span data-slate-object="text" data-key="6157"><span data-slate-leaf="true" data-offset-key="6157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取路由参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6158"><span data-slate-object="text" data-key="6159"><span data-slate-leaf="true" data-offset-key="6159:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6160"><span data-slate-leaf="true" data-offset-key="6160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6161"><span data-slate-leaf="true" data-offset-key="6161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="6162"><span data-slate-leaf="true" data-offset-key="6162:0" data-first-offset="true"><span data-slate-string="true"> Param(key </span></span></span><span data-slate-object="text" data-key="6163"><span data-slate-leaf="true" data-offset-key="6163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6164"><span data-slate-leaf="true" data-offset-key="6164:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="6165"><span data-slate-leaf="true" data-offset-key="6165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="6166"><span data-slate-leaf="true" data-offset-key="6166:0" data-first-offset="true"><span data-slate-string="true">{} {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6167"><span data-slate-object="text" data-key="6168"><span data-slate-leaf="true" data-offset-key="6168:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6169"><span data-slate-leaf="true" data-offset-key="6169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6170"><span data-slate-leaf="true" data-offset-key="6170:0" data-first-offset="true"><span data-slate-string="true"> ctx.params != </span></span></span><span data-slate-object="text" data-key="6171"><span data-slate-leaf="true" data-offset-key="6171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6172"><span data-slate-leaf="true" data-offset-key="6172:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6173"><span data-slate-object="text" data-key="6174"><span data-slate-leaf="true" data-offset-key="6174:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6175"><span data-slate-leaf="true" data-offset-key="6175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6176"><span data-slate-leaf="true" data-offset-key="6176:0" data-first-offset="true"><span data-slate-string="true"> val, ok := ctx.params[key]; ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6177"><span data-slate-object="text" data-key="6178"><span data-slate-leaf="true" data-offset-key="6178:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6179"><span data-slate-leaf="true" data-offset-key="6179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6180"><span data-slate-leaf="true" data-offset-key="6180:0" data-first-offset="true"><span data-slate-string="true"> val</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6181"><span data-slate-object="text" data-key="6182"><span data-slate-leaf="true" data-offset-key="6182:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6183"><span data-slate-object="text" data-key="6184"><span data-slate-leaf="true" data-offset-key="6184:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6185"><span data-slate-object="text" data-key="6186"><span data-slate-leaf="true" data-offset-key="6186:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6187"><span data-slate-leaf="true" data-offset-key="6187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6188"><span data-slate-leaf="true" data-offset-key="6188:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6189"><span data-slate-leaf="true" data-offset-key="6189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6190"><span data-slate-object="text" data-key="6191"><span data-slate-leaf="true" data-offset-key="6191:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6192"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6193"><span data-slate-object="text" data-key="6194"><span data-slate-leaf="true" data-offset-key="6194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 路由匹配中带的参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6195"><span data-slate-object="text" data-key="6196"><span data-slate-leaf="true" data-offset-key="6196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 形如 /book/:id</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6197"><span data-slate-object="text" data-key="6198"><span data-slate-leaf="true" data-offset-key="6198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6199"><span data-slate-leaf="true" data-offset-key="6199:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6200"><span data-slate-leaf="true" data-offset-key="6200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="6201"><span data-slate-leaf="true" data-offset-key="6201:0" data-first-offset="true"><span data-slate-string="true"> ParamInt(key </span></span></span><span data-slate-object="text" data-key="6202"><span data-slate-leaf="true" data-offset-key="6202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6203"><span data-slate-leaf="true" data-offset-key="6203:0" data-first-offset="true"><span data-slate-string="true">, def </span></span></span><span data-slate-object="text" data-key="6204"><span data-slate-leaf="true" data-offset-key="6204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="6205"><span data-slate-leaf="true" data-offset-key="6205:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="6206"><span data-slate-leaf="true" data-offset-key="6206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="6207"><span data-slate-leaf="true" data-offset-key="6207:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6208"><span data-slate-leaf="true" data-offset-key="6208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span><span data-slate-object="text" data-key="6209"><span data-slate-leaf="true" data-offset-key="6209:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6210"><span data-slate-object="text" data-key="6211"><span data-slate-leaf="true" data-offset-key="6211:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6212"><span data-slate-leaf="true" data-offset-key="6212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6213"><span data-slate-leaf="true" data-offset-key="6213:0" data-first-offset="true"><span data-slate-string="true"> val := ctx.Param(key); val != </span></span></span><span data-slate-object="text" data-key="6214"><span data-slate-leaf="true" data-offset-key="6214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6215"><span data-slate-leaf="true" data-offset-key="6215:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6216"><span data-slate-object="text" data-key="6217"><span data-slate-leaf="true" data-offset-key="6217:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6218"><span data-slate-leaf="true" data-offset-key="6218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 通过 cast 进行类型转换</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6219"><span data-slate-object="text" data-key="6220"><span data-slate-leaf="true" data-offset-key="6220:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6221"><span data-slate-leaf="true" data-offset-key="6221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6222"><span data-slate-leaf="true" data-offset-key="6222:0" data-first-offset="true"><span data-slate-string="true"> cast.ToInt(val), </span></span></span><span data-slate-object="text" data-key="6223"><span data-slate-leaf="true" data-offset-key="6223:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6224"><span data-slate-object="text" data-key="6225"><span data-slate-leaf="true" data-offset-key="6225:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6226"><span data-slate-object="text" data-key="6227"><span data-slate-leaf="true" data-offset-key="6227:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6228"><span data-slate-leaf="true" data-offset-key="6228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6229"><span data-slate-leaf="true" data-offset-key="6229:0" data-first-offset="true"><span data-slate-string="true"> def, </span></span></span><span data-slate-object="text" data-key="6230"><span data-slate-leaf="true" data-offset-key="6230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6231"><span data-slate-object="text" data-key="6232"><span data-slate-leaf="true" data-offset-key="6232:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6233" id="sr-toc-9"><span data-slate-object="text" data-key="6234"><span data-slate-leaf="true" data-offset-key="6234:0" data-first-offset="true"><span data-slate-string="true">Bind 请求方法实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6235"><span data-slate-object="text" data-key="6236"><span data-slate-leaf="true" data-offset-key="6236:0" data-first-offset="true"><span data-slate-string="true">到这里，ParamXXX 系列函数就完成了，接下来我们看下 BindXXX 系列函数，比如 BindJson。它的实现只需要简单 2 步：读取 Body 中的文本、解析 body 文本到结构体。所以修改 response.go 中的函数：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6237"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6238"><span data-slate-object="text" data-key="6239"><span data-slate-leaf="true" data-offset-key="6239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 body 文本解析到 obj 结构体中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6240"><span data-slate-object="text" data-key="6241"><span data-slate-leaf="true" data-offset-key="6241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6242"><span data-slate-leaf="true" data-offset-key="6242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6243"><span data-slate-leaf="true" data-offset-key="6243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="6244"><span data-slate-leaf="true" data-offset-key="6244:0" data-first-offset="true"><span data-slate-string="true"> BindJson(obj </span></span></span><span data-slate-object="text" data-key="6245"><span data-slate-leaf="true" data-offset-key="6245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="6246"><span data-slate-leaf="true" data-offset-key="6246:0" data-first-offset="true"><span data-slate-string="true">{}) </span></span></span><span data-slate-object="text" data-key="6247"><span data-slate-leaf="true" data-offset-key="6247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="6248"><span data-slate-leaf="true" data-offset-key="6248:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6249"><span data-slate-object="text" data-key="6250"><span data-slate-leaf="true" data-offset-key="6250:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6251"><span data-slate-leaf="true" data-offset-key="6251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6252"><span data-slate-leaf="true" data-offset-key="6252:0" data-first-offset="true"><span data-slate-string="true"> ctx.request != </span></span></span><span data-slate-object="text" data-key="6253"><span data-slate-leaf="true" data-offset-key="6253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6254"><span data-slate-leaf="true" data-offset-key="6254:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6255"><span data-slate-object="text" data-key="6256"><span data-slate-leaf="true" data-offset-key="6256:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6257"><span data-slate-leaf="true" data-offset-key="6257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 读取文本</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6258"><span data-slate-object="text" data-key="6259"><span data-slate-leaf="true" data-offset-key="6259:0" data-first-offset="true"><span data-slate-string="true">    body, err := ioutil.ReadAll(ctx.request.Body)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6260"><span data-slate-object="text" data-key="6261"><span data-slate-leaf="true" data-offset-key="6261:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6262"><span data-slate-leaf="true" data-offset-key="6262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6263"><span data-slate-leaf="true" data-offset-key="6263:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6264"><span data-slate-leaf="true" data-offset-key="6264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6265"><span data-slate-leaf="true" data-offset-key="6265:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6266"><span data-slate-object="text" data-key="6267"><span data-slate-leaf="true" data-offset-key="6267:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6268"><span data-slate-leaf="true" data-offset-key="6268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6269"><span data-slate-leaf="true" data-offset-key="6269:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6270"><span data-slate-object="text" data-key="6271"><span data-slate-leaf="true" data-offset-key="6271:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6272"><span data-slate-object="text" data-key="6273"><span data-slate-leaf="true" data-offset-key="6273:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6274"><span data-slate-leaf="true" data-offset-key="6274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 重新填充 request.Body，为后续的逻辑二次读取做准备</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6275"><span data-slate-object="text" data-key="6276"><span data-slate-leaf="true" data-offset-key="6276:0" data-first-offset="true"><span data-slate-string="true">    ctx.request.Body = ioutil.NopCloser(bytes.NewBuffer(body))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6277"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6278"><span data-slate-object="text" data-key="6279"><span data-slate-leaf="true" data-offset-key="6279:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6280"><span data-slate-leaf="true" data-offset-key="6280:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 解析到 obj 结构体中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6281"><span data-slate-object="text" data-key="6282"><span data-slate-leaf="true" data-offset-key="6282:0" data-first-offset="true"><span data-slate-string="true">    err = json.Unmarshal(body, obj)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6283"><span data-slate-object="text" data-key="6284"><span data-slate-leaf="true" data-offset-key="6284:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6285"><span data-slate-leaf="true" data-offset-key="6285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6286"><span data-slate-leaf="true" data-offset-key="6286:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6287"><span data-slate-leaf="true" data-offset-key="6287:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6288"><span data-slate-leaf="true" data-offset-key="6288:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6289"><span data-slate-object="text" data-key="6290"><span data-slate-leaf="true" data-offset-key="6290:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="6291"><span data-slate-leaf="true" data-offset-key="6291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6292"><span data-slate-leaf="true" data-offset-key="6292:0" data-first-offset="true"><span data-slate-string="true"> err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6293"><span data-slate-object="text" data-key="6294"><span data-slate-leaf="true" data-offset-key="6294:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6295"><span data-slate-object="text" data-key="6296"><span data-slate-leaf="true" data-offset-key="6296:0" data-first-offset="true"><span data-slate-string="true">  } </span></span></span><span data-slate-object="text" data-key="6297"><span data-slate-leaf="true" data-offset-key="6297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="6298"><span data-slate-leaf="true" data-offset-key="6298:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6299"><span data-slate-object="text" data-key="6300"><span data-slate-leaf="true" data-offset-key="6300:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6301"><span data-slate-leaf="true" data-offset-key="6301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6302"><span data-slate-leaf="true" data-offset-key="6302:0" data-first-offset="true"><span data-slate-string="true"> errors.New(</span></span></span><span data-slate-object="text" data-key="6303"><span data-slate-leaf="true" data-offset-key="6303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"ctx.request empty"</span></span></span></span><span data-slate-object="text" data-key="6304"><span data-slate-leaf="true" data-offset-key="6304:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6305"><span data-slate-object="text" data-key="6306"><span data-slate-leaf="true" data-offset-key="6306:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6307"><span data-slate-object="text" data-key="6308"><span data-slate-leaf="true" data-offset-key="6308:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6309"><span data-slate-leaf="true" data-offset-key="6309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6310"><span data-slate-leaf="true" data-offset-key="6310:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6311"><span data-slate-leaf="true" data-offset-key="6311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6312"><span data-slate-object="text" data-key="6313"><span data-slate-leaf="true" data-offset-key="6313:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6314"><span data-slate-object="text" data-key="6315"><span data-slate-leaf="true" data-offset-key="6315:0" data-first-offset="true"><span data-slate-string="true">读取 Body 中的文本，我们使用 ioutil.ReadAll 方法，解析 Body 文本到结构体中，我们使用 json.Unmarshal 方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6316"><span data-slate-object="text" data-key="6317"><span data-slate-leaf="true" data-offset-key="6317:0" data-first-offset="true"><span data-slate-string="true">这里要注意，</span></span></span><span data-slate-object="text" data-key="6318"><span data-slate-leaf="true" data-offset-key="6318:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f33809f1" data-attr-id="44098" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">request.Body 的读取是一次性的</span></span></span></span></span><span data-slate-object="text" data-key="6319"><span data-slate-leaf="true" data-offset-key="6319:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f33809f1" data-attr-id="44098" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，读取一次之后，下个逻辑再去 request.Body 中是读取不到数据内容的。所以我们读取完 request.Body 之后，还要再复制一份 Body 内容，填充到 request.Body 里。</span></span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6320" id="sr-toc-10"><span data-slate-object="text" data-key="6321"><span data-slate-leaf="true" data-offset-key="6321:0" data-first-offset="true"><span data-slate-string="true">返回相关接口实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6322"><span data-slate-object="text" data-key="6323"><span data-slate-leaf="true" data-offset-key="6323:0" data-first-offset="true"><span data-slate-string="true">返回接口中的 JSON、XML、TEXT 的输出是比较简单的，将输出数据结构进行序列化就行，这里我们重点讲比较复杂的两种实现 JSONP 输出和 HTML 输出。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6324" id="sr-toc-11"><span data-slate-object="text" data-key="6325"><span data-slate-leaf="true" data-offset-key="6325:0" data-first-offset="true"><span data-slate-string="true">JSONP 输出方法实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6326"><span data-slate-object="text" data-key="6327"><span data-slate-leaf="true" data-offset-key="6327:0" data-first-offset="true"><span data-slate-string="true">JSONP 是一种我们常用的解决跨域资源共享的方法，简要介绍下这个方法的原理。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6328"><span data-slate-object="text" data-key="6329"><span data-slate-leaf="true" data-offset-key="6329:0" data-first-offset="true"><span data-slate-string="true">在 JavaScript 中使用 HTTP 请求（Ajax）会受到同源策略的限制。比如说 A 网站的页面不能在 JavaScript 中跨域访问 B 网站的资源。但是，如果我们希望能跨域访问怎么办？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6330"><span data-slate-object="text" data-key="6331"><span data-slate-leaf="true" data-offset-key="6331:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eddb8954" data-attr-id="42257" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">我们知道 HTML 中标签 &lt;script&gt; 中的请求是不受同源策略影响的，</span></span></span></span><span data-slate-object="text" data-key="6332"><span data-slate-leaf="true" data-offset-key="6332:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eddb8954" data-attr-id="42257" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">那如果能将 B 网站的资源数据，通过 script 标签返回来，是不是就直接解决了跨域问题</span></span></span></span></span><span data-slate-object="text" data-key="6333"><span data-slate-leaf="true" data-offset-key="6333:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_eddb8954" data-attr-id="42257" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">？确实，JSONP 就是这么设计的，通过 script 标签的源地址，返回数据资源 + JavaScript 代码。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6334"><span data-slate-object="text" data-key="6335"><span data-slate-leaf="true" data-offset-key="6335:0" data-first-offset="true"><span data-slate-string="true">比如 A 网站的网页如下，它希望从 B 网站中获取数据，填充进 id 为 "context" 的 div 标签中。</span></span></span></div><div data-code-language="xml" data-slate-type="pre" data-slate-object="block" data-key="6336"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6337"><span data-slate-object="text" data-key="6338"><span data-slate-leaf="true" data-offset-key="6338:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6339"><span data-slate-leaf="true" data-offset-key="6339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">html</span></span></span></span></span><span data-slate-object="text" data-key="6340"><span data-slate-leaf="true" data-offset-key="6340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6341"><span data-slate-object="text" data-key="6342"><span data-slate-leaf="true" data-offset-key="6342:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6343"><span data-slate-leaf="true" data-offset-key="6343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6344"><span data-slate-leaf="true" data-offset-key="6344:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">body</span></span></span></span></span><span data-slate-object="text" data-key="6345"><span data-slate-leaf="true" data-offset-key="6345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6346"><span data-slate-object="text" data-key="6347"><span data-slate-leaf="true" data-offset-key="6347:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6348"><span data-slate-leaf="true" data-offset-key="6348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6349"><span data-slate-leaf="true" data-offset-key="6349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">div</span></span></span></span></span><span data-slate-object="text" data-key="6350"><span data-slate-leaf="true" data-offset-key="6350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6351"><span data-slate-leaf="true" data-offset-key="6351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">id</span></span></span></span></span><span data-slate-object="text" data-key="6352"><span data-slate-leaf="true" data-offset-key="6352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="6353"><span data-slate-leaf="true" data-offset-key="6353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"context"</span></span></span></span></span><span data-slate-object="text" data-key="6354"><span data-slate-leaf="true" data-offset-key="6354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span><span data-slate-object="text" data-key="6355"><span data-slate-leaf="true" data-offset-key="6355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;/</span></span></span></span><span data-slate-object="text" data-key="6356"><span data-slate-leaf="true" data-offset-key="6356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">div</span></span></span></span></span><span data-slate-object="text" data-key="6357"><span data-slate-leaf="true" data-offset-key="6357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6358"><span data-slate-object="text" data-key="6359"><span data-slate-leaf="true" data-offset-key="6359:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6360"><span data-slate-leaf="true" data-offset-key="6360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;/</span></span></span></span><span data-slate-object="text" data-key="6361"><span data-slate-leaf="true" data-offset-key="6361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">body</span></span></span></span></span><span data-slate-object="text" data-key="6362"><span data-slate-leaf="true" data-offset-key="6362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6363"><span data-slate-object="text" data-key="6364"><span data-slate-leaf="true" data-offset-key="6364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;/</span></span></span></span><span data-slate-object="text" data-key="6365"><span data-slate-leaf="true" data-offset-key="6365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">html</span></span></span></span></span><span data-slate-object="text" data-key="6366"><span data-slate-leaf="true" data-offset-key="6366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6367"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6368"><span data-slate-object="text" data-key="6369"><span data-slate-leaf="true" data-offset-key="6369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6370"><span data-slate-leaf="true" data-offset-key="6370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">script</span></span></span></span></span><span data-slate-object="text" data-key="6371"><span data-slate-leaf="true" data-offset-key="6371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6372"><span data-slate-object="text" data-key="6373"><span data-slate-leaf="true" data-offset-key="6373:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6374"><span data-slate-leaf="true" data-offset-key="6374:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">function</span></span></span></span><span data-slate-object="text" data-key="6375"><span data-slate-leaf="true" data-offset-key="6375:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="6376"><span data-slate-leaf="true" data-offset-key="6376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">callfun</span></span></span></span><span data-slate-object="text" data-key="6377"><span data-slate-leaf="true" data-offset-key="6377:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6378"><span data-slate-leaf="true" data-offset-key="6378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">data</span></span></span></span><span data-slate-object="text" data-key="6379"><span data-slate-leaf="true" data-offset-key="6379:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6380"><span data-slate-object="text" data-key="6381"><span data-slate-leaf="true" data-offset-key="6381:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="6382"><span data-slate-leaf="true" data-offset-key="6382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">document</span></span></span></span><span data-slate-object="text" data-key="6383"><span data-slate-leaf="true" data-offset-key="6383:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="6384"><span data-slate-leaf="true" data-offset-key="6384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getElementById</span></span></span></span><span data-slate-object="text" data-key="6385"><span data-slate-leaf="true" data-offset-key="6385:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6386"><span data-slate-leaf="true" data-offset-key="6386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'context'</span></span></span></span><span data-slate-object="text" data-key="6387"><span data-slate-leaf="true" data-offset-key="6387:0" data-first-offset="true"><span data-slate-string="true">).</span></span></span><span data-slate-object="text" data-key="6388"><span data-slate-leaf="true" data-offset-key="6388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">innerHTML</span></span></span></span><span data-slate-object="text" data-key="6389"><span data-slate-leaf="true" data-offset-key="6389:0" data-first-offset="true"><span data-slate-string="true"> = data;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6390"><span data-slate-object="text" data-key="6391"><span data-slate-leaf="true" data-offset-key="6391:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6392"><span data-slate-object="text" data-key="6393"><span data-slate-leaf="true" data-offset-key="6393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;/</span></span></span></span><span data-slate-object="text" data-key="6394"><span data-slate-leaf="true" data-offset-key="6394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">script</span></span></span></span></span><span data-slate-object="text" data-key="6395"><span data-slate-leaf="true" data-offset-key="6395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6396"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6397"><span data-slate-object="text" data-key="6398"><span data-slate-leaf="true" data-offset-key="6398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;</span></span></span></span><span data-slate-object="text" data-key="6399"><span data-slate-leaf="true" data-offset-key="6399:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">script</span></span></span></span></span><span data-slate-object="text" data-key="6400"><span data-slate-leaf="true" data-offset-key="6400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6401"><span data-slate-leaf="true" data-offset-key="6401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">src</span></span></span></span></span><span data-slate-object="text" data-key="6402"><span data-slate-leaf="true" data-offset-key="6402:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="6403"><span data-slate-leaf="true" data-offset-key="6403:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"http://B.com/jsonp?callback=callfun"</span></span></span></span></span><span data-slate-object="text" data-key="6404"><span data-slate-leaf="true" data-offset-key="6404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span><span data-slate-object="text" data-key="6405"><span data-slate-leaf="true" data-offset-key="6405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;/</span></span></span></span><span data-slate-object="text" data-key="6406"><span data-slate-leaf="true" data-offset-key="6406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">script</span></span></span></span></span><span data-slate-object="text" data-key="6407"><span data-slate-leaf="true" data-offset-key="6407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&gt;</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6408"><span data-slate-object="text" data-key="6409"><span data-slate-leaf="true" data-offset-key="6409:0" data-first-offset="true"><span data-slate-string="true">使用 ajax 请求的时候，我们是做不到这一点的，因为同源策略限制了网页和数据必须在同一个源下。但是如果 B 网站的接口支持了 JSONP，它能根据请求参数返回一段 JavaScript 代码，类似：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="6410"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6411"><span data-slate-object="text" data-key="6412"><span data-slate-leaf="true" data-offset-key="6412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">callfunc</span></span></span></span><span data-slate-object="text" data-key="6413"><span data-slate-leaf="true" data-offset-key="6413:0" data-first-offset="true"><span data-slate-string="true">({</span></span></span><span data-slate-object="text" data-key="6414"><span data-slate-leaf="true" data-offset-key="6414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"id"</span></span></span></span><span data-slate-object="text" data-key="6415"><span data-slate-leaf="true" data-offset-key="6415:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="6416"><span data-slate-leaf="true" data-offset-key="6416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="6417"><span data-slate-leaf="true" data-offset-key="6417:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6418"><span data-slate-leaf="true" data-offset-key="6418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"name"</span></span></span></span><span data-slate-object="text" data-key="6419"><span data-slate-leaf="true" data-offset-key="6419:0" data-first-offset="true"><span data-slate-string="true">: jianfengye})</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6420"><span data-slate-object="text" data-key="6421"><span data-slate-leaf="true" data-offset-key="6421:0" data-first-offset="true"><span data-slate-string="true">这时 A 网站的网页，就能直接调用 callfunc 方法，并且获取到 B 网站返回的数据。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6422"><span data-slate-object="text" data-key="6423"><span data-slate-leaf="true" data-offset-key="6423:0" data-first-offset="true"><span data-slate-string="true">了解了 JSONP 的原理，我们回到服务端实现 JSONP 的方法中。这个方法要做的事情就是：</span></span></span><span data-slate-object="text" data-key="6424"><span data-slate-leaf="true" data-offset-key="6424:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">获取请求中的参数作为函数名，获取要返回的数据 JSON 作为函数参数，将函数名 + 函数参数作为返回文本</span></span></span></span><span data-slate-object="text" data-key="6425"><span data-slate-leaf="true" data-offset-key="6425:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6426"><span data-slate-object="text" data-key="6427"><span data-slate-leaf="true" data-offset-key="6427:0" data-first-offset="true"><span data-slate-string="true">我们在 response.go 中补充 Jsonp 方法。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6428"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6429"><span data-slate-object="text" data-key="6430"><span data-slate-leaf="true" data-offset-key="6430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Jsonp 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6431"><span data-slate-object="text" data-key="6432"><span data-slate-leaf="true" data-offset-key="6432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6433"><span data-slate-leaf="true" data-offset-key="6433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6434"><span data-slate-leaf="true" data-offset-key="6434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="6435"><span data-slate-leaf="true" data-offset-key="6435:0" data-first-offset="true"><span data-slate-string="true"> Jsonp(obj </span></span></span><span data-slate-object="text" data-key="6436"><span data-slate-leaf="true" data-offset-key="6436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="6437"><span data-slate-leaf="true" data-offset-key="6437:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6438"><span data-slate-object="text" data-key="6439"><span data-slate-leaf="true" data-offset-key="6439:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6440"><span data-slate-leaf="true" data-offset-key="6440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取请求参数 callback</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6441"><span data-slate-object="text" data-key="6442"><span data-slate-leaf="true" data-offset-key="6442:0" data-first-offset="true"><span data-slate-string="true">  callbackFunc, _ := ctx.QueryString(</span></span></span><span data-slate-object="text" data-key="6443"><span data-slate-leaf="true" data-offset-key="6443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"callback"</span></span></span></span><span data-slate-object="text" data-key="6444"><span data-slate-leaf="true" data-offset-key="6444:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6445"><span data-slate-leaf="true" data-offset-key="6445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"callback_function"</span></span></span></span><span data-slate-object="text" data-key="6446"><span data-slate-leaf="true" data-offset-key="6446:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6447"><span data-slate-object="text" data-key="6448"><span data-slate-leaf="true" data-offset-key="6448:0" data-first-offset="true"><span data-slate-string="true">  ctx.SetHeader(</span></span></span><span data-slate-object="text" data-key="6449"><span data-slate-leaf="true" data-offset-key="6449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Content-Type"</span></span></span></span><span data-slate-object="text" data-key="6450"><span data-slate-leaf="true" data-offset-key="6450:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6451"><span data-slate-leaf="true" data-offset-key="6451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"application/javascript"</span></span></span></span><span data-slate-object="text" data-key="6452"><span data-slate-leaf="true" data-offset-key="6452:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6453"><span data-slate-object="text" data-key="6454"><span data-slate-leaf="true" data-offset-key="6454:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6455"><span data-slate-leaf="true" data-offset-key="6455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出到前端页面的时候需要注意下进行字符过滤，否则有可能造成 XSS 攻击</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6456"><span data-slate-object="text" data-key="6457"><span data-slate-leaf="true" data-offset-key="6457:0" data-first-offset="true"><span data-slate-string="true">  callback := template.JSEscapeString(callbackFunc)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6458"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6459"><span data-slate-object="text" data-key="6460"><span data-slate-leaf="true" data-offset-key="6460:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6461"><span data-slate-leaf="true" data-offset-key="6461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出函数名</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6462"><span data-slate-object="text" data-key="6463"><span data-slate-leaf="true" data-offset-key="6463:0" data-first-offset="true"><span data-slate-string="true">  _, err := ctx.responseWriter.Write([]</span></span></span><span data-slate-object="text" data-key="6464"><span data-slate-leaf="true" data-offset-key="6464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="6465"><span data-slate-leaf="true" data-offset-key="6465:0" data-first-offset="true"><span data-slate-string="true">(callback))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6466"><span data-slate-object="text" data-key="6467"><span data-slate-leaf="true" data-offset-key="6467:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6468"><span data-slate-leaf="true" data-offset-key="6468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6469"><span data-slate-leaf="true" data-offset-key="6469:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6470"><span data-slate-leaf="true" data-offset-key="6470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6471"><span data-slate-leaf="true" data-offset-key="6471:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6472"><span data-slate-object="text" data-key="6473"><span data-slate-leaf="true" data-offset-key="6473:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6474"><span data-slate-leaf="true" data-offset-key="6474:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6475"><span data-slate-leaf="true" data-offset-key="6475:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6476"><span data-slate-object="text" data-key="6477"><span data-slate-leaf="true" data-offset-key="6477:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6478"><span data-slate-object="text" data-key="6479"><span data-slate-leaf="true" data-offset-key="6479:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6480"><span data-slate-leaf="true" data-offset-key="6480:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出左括号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6481"><span data-slate-object="text" data-key="6482"><span data-slate-leaf="true" data-offset-key="6482:0" data-first-offset="true"><span data-slate-string="true">  _, err = ctx.responseWriter.Write([]</span></span></span><span data-slate-object="text" data-key="6483"><span data-slate-leaf="true" data-offset-key="6483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="6484"><span data-slate-leaf="true" data-offset-key="6484:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6485"><span data-slate-leaf="true" data-offset-key="6485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"("</span></span></span></span><span data-slate-object="text" data-key="6486"><span data-slate-leaf="true" data-offset-key="6486:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6487"><span data-slate-object="text" data-key="6488"><span data-slate-leaf="true" data-offset-key="6488:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6489"><span data-slate-leaf="true" data-offset-key="6489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6490"><span data-slate-leaf="true" data-offset-key="6490:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6491"><span data-slate-leaf="true" data-offset-key="6491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6492"><span data-slate-leaf="true" data-offset-key="6492:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6493"><span data-slate-object="text" data-key="6494"><span data-slate-leaf="true" data-offset-key="6494:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6495"><span data-slate-leaf="true" data-offset-key="6495:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6496"><span data-slate-leaf="true" data-offset-key="6496:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6497"><span data-slate-object="text" data-key="6498"><span data-slate-leaf="true" data-offset-key="6498:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6499"><span data-slate-object="text" data-key="6500"><span data-slate-leaf="true" data-offset-key="6500:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6501"><span data-slate-leaf="true" data-offset-key="6501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 数据函数参数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6502"><span data-slate-object="text" data-key="6503"><span data-slate-leaf="true" data-offset-key="6503:0" data-first-offset="true"><span data-slate-string="true">  ret, err := json.Marshal(obj)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6504"><span data-slate-object="text" data-key="6505"><span data-slate-leaf="true" data-offset-key="6505:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6506"><span data-slate-leaf="true" data-offset-key="6506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6507"><span data-slate-leaf="true" data-offset-key="6507:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6508"><span data-slate-leaf="true" data-offset-key="6508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6509"><span data-slate-leaf="true" data-offset-key="6509:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6510"><span data-slate-object="text" data-key="6511"><span data-slate-leaf="true" data-offset-key="6511:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6512"><span data-slate-leaf="true" data-offset-key="6512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6513"><span data-slate-leaf="true" data-offset-key="6513:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6514"><span data-slate-object="text" data-key="6515"><span data-slate-leaf="true" data-offset-key="6515:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6516"><span data-slate-object="text" data-key="6517"><span data-slate-leaf="true" data-offset-key="6517:0" data-first-offset="true"><span data-slate-string="true">  _, err = ctx.responseWriter.Write(ret)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6518"><span data-slate-object="text" data-key="6519"><span data-slate-leaf="true" data-offset-key="6519:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6520"><span data-slate-leaf="true" data-offset-key="6520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6521"><span data-slate-leaf="true" data-offset-key="6521:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6522"><span data-slate-leaf="true" data-offset-key="6522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6523"><span data-slate-leaf="true" data-offset-key="6523:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6524"><span data-slate-object="text" data-key="6525"><span data-slate-leaf="true" data-offset-key="6525:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6526"><span data-slate-leaf="true" data-offset-key="6526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6527"><span data-slate-leaf="true" data-offset-key="6527:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6528"><span data-slate-object="text" data-key="6529"><span data-slate-leaf="true" data-offset-key="6529:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6530"><span data-slate-object="text" data-key="6531"><span data-slate-leaf="true" data-offset-key="6531:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6532"><span data-slate-leaf="true" data-offset-key="6532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出右括号</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6533"><span data-slate-object="text" data-key="6534"><span data-slate-leaf="true" data-offset-key="6534:0" data-first-offset="true"><span data-slate-string="true">  _, err = ctx.responseWriter.Write([]</span></span></span><span data-slate-object="text" data-key="6535"><span data-slate-leaf="true" data-offset-key="6535:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="6536"><span data-slate-leaf="true" data-offset-key="6536:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="6537"><span data-slate-leaf="true" data-offset-key="6537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">")"</span></span></span></span><span data-slate-object="text" data-key="6538"><span data-slate-leaf="true" data-offset-key="6538:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6539"><span data-slate-object="text" data-key="6540"><span data-slate-leaf="true" data-offset-key="6540:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6541"><span data-slate-leaf="true" data-offset-key="6541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6542"><span data-slate-leaf="true" data-offset-key="6542:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6543"><span data-slate-leaf="true" data-offset-key="6543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6544"><span data-slate-leaf="true" data-offset-key="6544:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6545"><span data-slate-object="text" data-key="6546"><span data-slate-leaf="true" data-offset-key="6546:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6547"><span data-slate-leaf="true" data-offset-key="6547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6548"><span data-slate-leaf="true" data-offset-key="6548:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6549"><span data-slate-object="text" data-key="6550"><span data-slate-leaf="true" data-offset-key="6550:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6551"><span data-slate-object="text" data-key="6552"><span data-slate-leaf="true" data-offset-key="6552:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6553"><span data-slate-leaf="true" data-offset-key="6553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6554"><span data-slate-leaf="true" data-offset-key="6554:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6555"><span data-slate-object="text" data-key="6556"><span data-slate-leaf="true" data-offset-key="6556:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="6557" id="sr-toc-12"><span data-slate-object="text" data-key="6558"><span data-slate-leaf="true" data-offset-key="6558:0" data-first-offset="true"><span data-slate-string="true">HTML 输出方法实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="6559"><span data-slate-object="text" data-key="6560"><span data-slate-leaf="true" data-offset-key="6560:0" data-first-offset="true"><span data-slate-string="true">接下来我们分析下 HTML 输出。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6561"><span data-slate-object="text" data-key="6562"><span data-slate-leaf="true" data-offset-key="6562:0" data-first-offset="true"><span data-slate-string="true">HTML 函数输出的就是一个纯 HTML 页面。现在的 HTML 页面，基本都是动态页面，也就是说页面基本内容都是一样，但是根据不同请求、不同逻辑，页面中的数据部分是不同的。所以，我们在输出 HTML 页面内容的时候，常用 “模版 + 数据” 的方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6563"><span data-slate-object="text" data-key="6564"><span data-slate-leaf="true" data-offset-key="6564:0" data-first-offset="true"><span data-slate-string="true">模版中存放的是页面基本内容，包括布局信息（CSS）、通用脚本（JavaScript）、页面整体结构（HTML）。但是页面结构中，某个标签的具体内容、具体数值，就表示成数据，在模版中保留数据的位置，在最终渲染 HTML 内容的时候，把数据填充进入模版就行了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6565"><span data-slate-object="text" data-key="6566"><span data-slate-leaf="true" data-offset-key="6566:0" data-first-offset="true"><span data-slate-string="true">在 Golang 中，这种 “模版 + 数据” 的文本渲染方式是有一个官方库来实现的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6567"><span data-slate-object="text" data-key="6568"><span data-slate-leaf="true" data-offset-key="6568:0" data-first-offset="true"><span data-slate-string="true">html/template</span></span></span></a><span data-slate-object="text" data-key="6569"><span data-slate-leaf="true" data-offset-key="6569:0" data-first-offset="true"><span data-slate-string="true"> ，它的模版使用 {{.XX}} 作为数据的占位符，表示传入的数据结构的某个字段：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6570"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6571"><span data-slate-object="text" data-key="6572"><span data-slate-leaf="true" data-offset-key="6572:0" data-first-offset="true"><span data-slate-string="true">&lt;h1&gt;{{.PageTitle}}&lt;/h1&gt;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6573"><span data-slate-object="text" data-key="6574"><span data-slate-leaf="true" data-offset-key="6574:0" data-first-offset="true"><span data-slate-string="true">&lt;ul&gt;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6575"><span data-slate-object="text" data-key="6576"><span data-slate-leaf="true" data-offset-key="6576:0" data-first-offset="true"><span data-slate-string="true">    {{</span></span></span><span data-slate-object="text" data-key="6577"><span data-slate-leaf="true" data-offset-key="6577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="6578"><span data-slate-leaf="true" data-offset-key="6578:0" data-first-offset="true"><span data-slate-string="true"> .Todos}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6579"><span data-slate-object="text" data-key="6580"><span data-slate-leaf="true" data-offset-key="6580:0" data-first-offset="true"><span data-slate-string="true">        {{</span></span></span><span data-slate-object="text" data-key="6581"><span data-slate-leaf="true" data-offset-key="6581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6582"><span data-slate-leaf="true" data-offset-key="6582:0" data-first-offset="true"><span data-slate-string="true"> .Done}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6583"><span data-slate-object="text" data-key="6584"><span data-slate-leaf="true" data-offset-key="6584:0" data-first-offset="true"><span data-slate-string="true">            &lt;li class=</span></span></span><span data-slate-object="text" data-key="6585"><span data-slate-leaf="true" data-offset-key="6585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"done"</span></span></span></span><span data-slate-object="text" data-key="6586"><span data-slate-leaf="true" data-offset-key="6586:0" data-first-offset="true"><span data-slate-string="true">&gt;{{.Title}}&lt;/li&gt;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6587"><span data-slate-object="text" data-key="6588"><span data-slate-leaf="true" data-offset-key="6588:0" data-first-offset="true"><span data-slate-string="true">        {{</span></span></span><span data-slate-object="text" data-key="6589"><span data-slate-leaf="true" data-offset-key="6589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="6590"><span data-slate-leaf="true" data-offset-key="6590:0" data-first-offset="true"><span data-slate-string="true">}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6591"><span data-slate-object="text" data-key="6592"><span data-slate-leaf="true" data-offset-key="6592:0" data-first-offset="true"><span data-slate-string="true">            &lt;li&gt;{{.Title}}&lt;/li&gt;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6593"><span data-slate-object="text" data-key="6594"><span data-slate-leaf="true" data-offset-key="6594:0" data-first-offset="true"><span data-slate-string="true">        {{end}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6595"><span data-slate-object="text" data-key="6596"><span data-slate-leaf="true" data-offset-key="6596:0" data-first-offset="true"><span data-slate-string="true">    {{end}}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6597"><span data-slate-object="text" data-key="6598"><span data-slate-leaf="true" data-offset-key="6598:0" data-first-offset="true"><span data-slate-string="true">&lt;/ul&gt;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6599"><span data-slate-object="text" data-key="6600"><span data-slate-leaf="true" data-offset-key="6600:0" data-first-offset="true"><span data-slate-string="true">传入的数据结构为：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6601"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6602"><span data-slate-object="text" data-key="6603"><span data-slate-leaf="true" data-offset-key="6603:0" data-first-offset="true"><span data-slate-string="true">data := TodoPageData{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6604"><span data-slate-object="text" data-key="6605"><span data-slate-leaf="true" data-offset-key="6605:0" data-first-offset="true"><span data-slate-string="true">    PageTitle: </span></span></span><span data-slate-object="text" data-key="6606"><span data-slate-leaf="true" data-offset-key="6606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"My TODO list"</span></span></span></span><span data-slate-object="text" data-key="6607"><span data-slate-leaf="true" data-offset-key="6607:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6608"><span data-slate-object="text" data-key="6609"><span data-slate-leaf="true" data-offset-key="6609:0" data-first-offset="true"><span data-slate-string="true">    Todos: []Todo{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6610"><span data-slate-object="text" data-key="6611"><span data-slate-leaf="true" data-offset-key="6611:0" data-first-offset="true"><span data-slate-string="true">        {Title: </span></span></span><span data-slate-object="text" data-key="6612"><span data-slate-leaf="true" data-offset-key="6612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Task 1"</span></span></span></span><span data-slate-object="text" data-key="6613"><span data-slate-leaf="true" data-offset-key="6613:0" data-first-offset="true"><span data-slate-string="true">, Done: </span></span></span><span data-slate-object="text" data-key="6614"><span data-slate-leaf="true" data-offset-key="6614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="6615"><span data-slate-leaf="true" data-offset-key="6615:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6616"><span data-slate-object="text" data-key="6617"><span data-slate-leaf="true" data-offset-key="6617:0" data-first-offset="true"><span data-slate-string="true">        {Title: </span></span></span><span data-slate-object="text" data-key="6618"><span data-slate-leaf="true" data-offset-key="6618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Task 2"</span></span></span></span><span data-slate-object="text" data-key="6619"><span data-slate-leaf="true" data-offset-key="6619:0" data-first-offset="true"><span data-slate-string="true">, Done: </span></span></span><span data-slate-object="text" data-key="6620"><span data-slate-leaf="true" data-offset-key="6620:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="6621"><span data-slate-leaf="true" data-offset-key="6621:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6622"><span data-slate-object="text" data-key="6623"><span data-slate-leaf="true" data-offset-key="6623:0" data-first-offset="true"><span data-slate-string="true">        {Title: </span></span></span><span data-slate-object="text" data-key="6624"><span data-slate-leaf="true" data-offset-key="6624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Task 3"</span></span></span></span><span data-slate-object="text" data-key="6625"><span data-slate-leaf="true" data-offset-key="6625:0" data-first-offset="true"><span data-slate-string="true">, Done: </span></span></span><span data-slate-object="text" data-key="6626"><span data-slate-leaf="true" data-offset-key="6626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="6627"><span data-slate-leaf="true" data-offset-key="6627:0" data-first-offset="true"><span data-slate-string="true">},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6628"><span data-slate-object="text" data-key="6629"><span data-slate-leaf="true" data-offset-key="6629:0" data-first-offset="true"><span data-slate-string="true">    },</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6630"><span data-slate-object="text" data-key="6631"><span data-slate-leaf="true" data-offset-key="6631:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6632"><span data-slate-object="text" data-key="6633"><span data-slate-leaf="true" data-offset-key="6633:0" data-first-offset="true"><span data-slate-string="true">所以具体的渲染可以分成两步：</span></span></span><span data-slate-object="text" data-key="6634"><span data-slate-leaf="true" data-offset-key="6634:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">先根据模版创造出 template 结构；再使用 template.Execute 将传入数据和模版结合</span></span></span></span><span data-slate-object="text" data-key="6635"><span data-slate-leaf="true" data-offset-key="6635:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6636"><span data-slate-object="text" data-key="6637"><span data-slate-leaf="true" data-offset-key="6637:0" data-first-offset="true"><span data-slate-string="true">我们的 HTML 函数可以使用 html/template，修改框架目录 response.go 中的 Html 方法：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6638"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6639"><span data-slate-object="text" data-key="6640"><span data-slate-leaf="true" data-offset-key="6640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//html 输出</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6641"><span data-slate-object="text" data-key="6642"><span data-slate-leaf="true" data-offset-key="6642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="6643"><span data-slate-leaf="true" data-offset-key="6643:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="6644"><span data-slate-leaf="true" data-offset-key="6644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ctx *Context)</span></span></span></span></span><span data-slate-object="text" data-key="6645"><span data-slate-leaf="true" data-offset-key="6645:0" data-first-offset="true"><span data-slate-string="true"> Html(file </span></span></span><span data-slate-object="text" data-key="6646"><span data-slate-leaf="true" data-offset-key="6646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="6647"><span data-slate-leaf="true" data-offset-key="6647:0" data-first-offset="true"><span data-slate-string="true">, obj </span></span></span><span data-slate-object="text" data-key="6648"><span data-slate-leaf="true" data-offset-key="6648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="6649"><span data-slate-leaf="true" data-offset-key="6649:0" data-first-offset="true"><span data-slate-string="true">{}) IResponse {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6650"><span data-slate-object="text" data-key="6651"><span data-slate-leaf="true" data-offset-key="6651:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6652"><span data-slate-leaf="true" data-offset-key="6652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 读取模版文件，创建 template 实例</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6653"><span data-slate-object="text" data-key="6654"><span data-slate-leaf="true" data-offset-key="6654:0" data-first-offset="true"><span data-slate-string="true">  t, err := template.New(</span></span></span><span data-slate-object="text" data-key="6655"><span data-slate-leaf="true" data-offset-key="6655:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"output"</span></span></span></span><span data-slate-object="text" data-key="6656"><span data-slate-leaf="true" data-offset-key="6656:0" data-first-offset="true"><span data-slate-string="true">).ParseFiles(file)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6657"><span data-slate-object="text" data-key="6658"><span data-slate-leaf="true" data-offset-key="6658:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6659"><span data-slate-leaf="true" data-offset-key="6659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6660"><span data-slate-leaf="true" data-offset-key="6660:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="6661"><span data-slate-leaf="true" data-offset-key="6661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6662"><span data-slate-leaf="true" data-offset-key="6662:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6663"><span data-slate-object="text" data-key="6664"><span data-slate-leaf="true" data-offset-key="6664:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6665"><span data-slate-leaf="true" data-offset-key="6665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6666"><span data-slate-leaf="true" data-offset-key="6666:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6667"><span data-slate-object="text" data-key="6668"><span data-slate-leaf="true" data-offset-key="6668:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6669"><span data-slate-object="text" data-key="6670"><span data-slate-leaf="true" data-offset-key="6670:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6671"><span data-slate-leaf="true" data-offset-key="6671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 执行 Execute 方法将 obj 和模版进行结合</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6672"><span data-slate-object="text" data-key="6673"><span data-slate-leaf="true" data-offset-key="6673:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6674"><span data-slate-leaf="true" data-offset-key="6674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="6675"><span data-slate-leaf="true" data-offset-key="6675:0" data-first-offset="true"><span data-slate-string="true"> err := t.Execute(ctx.responseWriter, obj); err != </span></span></span><span data-slate-object="text" data-key="6676"><span data-slate-leaf="true" data-offset-key="6676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="6677"><span data-slate-leaf="true" data-offset-key="6677:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6678"><span data-slate-object="text" data-key="6679"><span data-slate-leaf="true" data-offset-key="6679:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="6680"><span data-slate-leaf="true" data-offset-key="6680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6681"><span data-slate-leaf="true" data-offset-key="6681:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6682"><span data-slate-object="text" data-key="6683"><span data-slate-leaf="true" data-offset-key="6683:0" data-first-offset="true"><span data-slate-string="true">  }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6684"></div><div data-slate-type="code-line" data-slate-object="block" data-key="6685"><span data-slate-object="text" data-key="6686"><span data-slate-leaf="true" data-offset-key="6686:0" data-first-offset="true"><span data-slate-string="true">  ctx.SetHeader(</span></span></span><span data-slate-object="text" data-key="6687"><span data-slate-leaf="true" data-offset-key="6687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Content-Type"</span></span></span></span><span data-slate-object="text" data-key="6688"><span data-slate-leaf="true" data-offset-key="6688:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="6689"><span data-slate-leaf="true" data-offset-key="6689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"application/html"</span></span></span></span><span data-slate-object="text" data-key="6690"><span data-slate-leaf="true" data-offset-key="6690:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6691"><span data-slate-object="text" data-key="6692"><span data-slate-leaf="true" data-offset-key="6692:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="6693"><span data-slate-leaf="true" data-offset-key="6693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="6694"><span data-slate-leaf="true" data-offset-key="6694:0" data-first-offset="true"><span data-slate-string="true"> ctx</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6695"><span data-slate-object="text" data-key="6696"><span data-slate-leaf="true" data-offset-key="6696:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6697"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6698"><span data-slate-object="text" data-key="6699"><span data-slate-leaf="true" data-offset-key="6699:0" data-first-offset="true"><span data-slate-string="true">参数为模版文件和输出对象，先使用 ParseFiles 来读取模版文件，创建一个 template 数据结构，然后使用 Execute 方法，将数据对象和模版进行结合，并且输出到 responseWriter 中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6700"><span data-slate-object="text" data-key="6701"><span data-slate-leaf="true" data-offset-key="6701:0" data-first-offset="true"><span data-slate-string="true">这节课的代码结构放在这里了，完整的代码在 GitHub 上的 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="6702"><span data-slate-object="text" data-key="6703"><span data-slate-leaf="true" data-offset-key="6703:0" data-first-offset="true"><span data-slate-string="true">geekbang/05</span></span></span></a><span data-slate-object="text" data-key="6704"><span data-slate-leaf="true" data-offset-key="6704:0" data-first-offset="true"><span data-slate-string="true"> 分支上。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="6705"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/f3/37/f352fyyb3443eeed2ce318859638bb37.png?wh=746x1398" style="width: auto;"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6706" id="sr-toc-13"><span data-slate-object="text" data-key="6707"><span data-slate-leaf="true" data-offset-key="6707:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6708"><span data-slate-object="text" data-key="6709"><span data-slate-leaf="true" data-offset-key="6709:0" data-first-offset="true"><span data-slate-string="true">我们这节课在 context 这个数据结构中，封装和实现 “读取请求数据” 和 “封装返回数据” 的方法。首先系统思考这两个需求功能的封装；再设计 IRequest 和 IResponse 两个接口，定义了对应的方法，并且让 context 实现这两个接口；最后，我们对这两个接口的方法进行了具体实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6710"><span data-slate-object="text" data-key="6711"><span data-slate-leaf="true" data-offset-key="6711:0" data-first-offset="true"><span data-slate-string="true">你现在是不是认识到了，为什么我在开头会说，函数封装并不是一件很简单、很随意的事情，如何封装出易用、可读性高的函数是需要我们精心考量的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6712"><span data-slate-object="text" data-key="6713"><span data-slate-leaf="true" data-offset-key="6713:0" data-first-offset="true"><span data-slate-string="true">如果说一定要记住一句话，希望你能记住，在实现 “读取请求数据” 和 “封装返回数据” 的过程中，</span></span><span data-slate-leaf="true" data-offset-key="6713:1"><span data-slate-object="annotation" data-annotation-key="gkann_72591822" data-attr-id="27966" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">采用 “</span></span></span></span><span data-slate-object="text" data-key="6714"><span data-slate-leaf="true" data-offset-key="6714:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_72591822" data-attr-id="27966" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">先系统设计，再定义接口，最后具体实现</span></span></span></span></span><span data-slate-object="text" data-key="6715"><span data-slate-leaf="true" data-offset-key="6715:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_72591822" data-attr-id="27966" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">” 的系统思考方法。</span></span></span><span data-slate-leaf="true" data-offset-key="6715:1"><span data-slate-string="true">如果你一接到要开发某些功能模块需求，不先想清楚就立刻上手，最终实现的代码，细节会非常混乱，复用性极差。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6716"><span data-slate-object="text" data-key="6717"><span data-slate-leaf="true" data-offset-key="6717:0" data-first-offset="true"><span data-slate-string="true">请记住，设计永远优于实现！</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="6718" id="sr-toc-14"><span data-slate-object="text" data-key="6719"><span data-slate-leaf="true" data-offset-key="6719:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="6720"><span data-slate-object="text" data-key="6721"><span data-slate-leaf="true" data-offset-key="6721:0" data-first-offset="true"><span data-slate-string="true">作为一个 Web 框架，安全性是很关键的一个环节，我们在实现 JSONP 方法的时候，有这一行代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="6722"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="6723"><span data-slate-object="text" data-key="6724"><span data-slate-leaf="true" data-offset-key="6724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 输出到前端页面的时候需要注意下进行字符过滤，否则有可能造成 XSS 攻击</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="6725"><span data-slate-object="text" data-key="6726"><span data-slate-leaf="true" data-offset-key="6726:0" data-first-offset="true"><span data-slate-string="true">callback := template.JSEscapeString(callbackFunc)</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6727"><span data-slate-object="text" data-key="6728"><span data-slate-leaf="true" data-offset-key="6728:0" data-first-offset="true"><span data-slate-string="true">请你思考下，如果我直接将 callbackFunc 输出到页面上，会有什么不安全的问题吗？什么是 XSS 攻击？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="6729"><span data-slate-object="text" data-key="6730"><span data-slate-leaf="true" data-offset-key="6730:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区分享你的思考。感谢你的收听，如果你觉得今天的内容对你有所帮助，也欢迎分享给你身边的朋友，邀请他一起学习。下节课见～</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-15">精选留言 (8)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>友</span></div></div><div>不知道各位看 github 有没有看到 FormInt 和 FormString 我没有找到可能是粗心，建议各位在实现的时候可以在开头写上这么几句代码

var _ IRequest = new (Context)
var _ IResponse = new (Context)
var _ context.Context = new (Context)
如果当前 context 没有实现完 IRequest 和 IResponse 会报错并且你能看到是哪些接口未实现。

还有一个地方就是 Headers () map [string] string
这里接口定义的是 这样 但是试下你的时候是这样 Headers () map [string][] string</div><div><p>作者回复：确实是个好办法，直接做一下强制转换能将错误提前暴露
感谢</p></div><div><div>2021-12-02</div><div><div><i></i></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>qinsi</span></div></div><div>转义是为了防止 callback 名称包含任意 js 代码。虽然要达成 XSS 有各种前置条件，防御 XSS 也要分各种情况，没有完美的方法，但转义总比不转义要强。

疑问：

1. JSONP 的响应也是在拼接字符串，是否也可以用 template？

2. 对于各种请求和响应格式的支持，是否也可以写成中间件的形式，让 API 更精简？

3. 重复读取 body 的场景有哪些？我能想到的是某些访问控制的中间件可能需要事先检查 body 的内容。这样是不是就没法做流式处理（因为要把请求 body 读完才能做下一步的处理）？比如一边读取请求 body 一边写入响应 body。</div><div><p>作者回复：疑问：

1. JSONP 的响应也是在拼接字符串，是否也可以用 template？
当然可以的，拼接字符串有多种方式，template 也是可以。

2. 对于各种请求和响应格式的支持，是否也可以写成中间件的形式，让 API 更精简？
可以的，修改响应格式主要要先修改下 context 中的 responseWriter，让输出先进入到我们定义的 writer 中，然后修改后再输出到前端。这样做可行。
不过更多的做法是封装一个公共方法，所有 api 地方调用这个方法。

3. 重复读取 body 的场景有哪些？我能想到的是某些访问控制的中间件可能需要事先检查 body 的内容。这样是不是就没法做流式处理（因为要把请求 body 读完才能做下一步的处理）？比如一边读取请求 body 一边写入响应 body。

这个场景很多的，要打一个输入请求的所有日志到日志管理系统中，或者要实现一个回放功能，都有可能要读取请求 body.</p></div><div><div>2021-09-22</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/56/ab/6a964bbb.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 木移</span></div></div><div>subjectApi.Put ("/:id/:id", SubjectUpdateController)  这种路由取参数就没法区分了，注册路由需要把这种情况考虑进去吗</div><div><div>2021-10-27</div><div><div><i></i><span>1</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/72/85/c337e9a1.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 老兵</span></div></div><div>利用 escape template.JSEscapeString (callbackFunc) 解决 XSS 攻击的问题。
疑问：
但是框架如何解决 CSRF 攻击的问题呢？检查 CSRF token 和 XSRF token？</div><div><div>2022-02-24</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/cb/07/482b7155.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>牛玉富</span></div></div><div>clientIp 拼错了</div><div><div>2022-01-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/62/0e/af82f76f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>咸鱼</span></div></div><div>有两点疑惑，为什么要使用不带 error 返回值的 cast 方法呢，这样如果解析出了问题，返回的不会是默认值，而会是零值。另外一点是我记得前面注册路由的时候把路径都变成了大写来着，这样在取路径参数的时候应该加一道把 key 转成大写的步骤吧，不然会找不到参数的</div><div><p>作者回复: 1 这里其实有三个逻辑，a 是否有这个 key，b 这个 key 是否可以转换为目标对象， c 如果失败和没有，要怎么处理。目前是没有 key 返回默认值，有 key 但是无法转换返回零值，不过思考了一下，这里确实是改成 “失败和处理” 都返回默认值比较好。
2 parseParamsFromEndNode 这里传递的是 request.URL.Path，是没有大写转换过的。应该不需要加这个</p></div><div><div>2021-12-12</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/18/7d/3916b1e8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>kfns0b11</span></div></div><div>&gt; // 重新填充 request.Body，为后续的逻辑二次读取做准备 
&gt; ctx.request.Body = ioutil.NopCloser (bytes.NewBuffer (body))

这里能详细解释一下吗？ctx.request.Body 本身是 io.ReadCloser 类型，使用 NopCloser 函数为后续的逻辑二次读取做准备是什么意思啊？</div><div><div>2021-11-16</div><div><div><i></i><span>1</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Geek_5244fa</span></div></div><div>类似 Jsonp 这些输出方法中，都是忽略错误然后返回 Context 实现链式调用，这样不会有问题吗？

例如用户搞了个没法 json 序列化的数据，输出到左括号就断掉，不会很难排查？</div><div><div>2021-09-22</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".g"><outline class="toc-level-h1" data-reactid=".g.0" style="width: 175px;"><active data-reactid=".g.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".g.0.1"><span data-reactid=".g.0.1.0">05｜封装：如何让你的框架更好用？</span></a></outline><outline class="toc-level-h2" data-reactid=".g.1" style="width: 165px;"><active data-reactid=".g.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".g.1.1"><span data-reactid=".g.1.1.0">思考如何封装请求和返回</span></a></outline><outline class="toc-level-h2" data-reactid=".g.2" style="width: 165px;"><active data-reactid=".g.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".g.2.1"><span data-reactid=".g.2.1.0">定义接口让封装更明确</span></a></outline><outline class="toc-level-h3" data-reactid=".g.3" style="width: 155px;"><active data-reactid=".g.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".g.3.1"><span data-reactid=".g.3.1.0">IRequest 接口定义</span></a></outline><outline class="toc-level-h3" data-reactid=".g.4" style="width: 155px;"><active data-reactid=".g.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".g.4.1"><span data-reactid=".g.4.1.0">IResponse 接口定义</span></a></outline><outline class="toc-level-h2" data-reactid=".g.5" style="width: 165px;"><active data-reactid=".g.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".g.5.1"><span data-reactid=".g.5.1.0">实现具体的接口</span></a></outline><outline class="toc-level-h2" data-reactid=".g.6" style="width: 165px;"><active data-reactid=".g.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".g.6.1"><span data-reactid=".g.6.1.0">请求相关接口实现</span></a></outline><outline class="toc-level-h3" data-reactid=".g.7" style="width: 155px;"><active data-reactid=".g.7.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".g.7.1"><span data-reactid=".g.7.1.0">Query 请求方法实现</span></a></outline><outline class="toc-level-h3" data-reactid=".g.8" style="width: 155px;"><active data-reactid=".g.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".g.8.1"><span data-reactid=".g.8.1.0">Param 请求方法实现</span></a></outline><outline class="toc-level-h3" data-reactid=".g.9" style="width: 155px;"><active data-reactid=".g.9.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".g.9.1"><span data-reactid=".g.9.1.0">Bind 请求方法实现</span></a></outline><outline class="toc-level-h2" data-reactid=".g.a" style="width: 165px;"><active data-reactid=".g.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".g.a.1"><span data-reactid=".g.a.1.0">返回相关接口实现</span></a></outline><outline class="toc-level-h3" data-reactid=".g.b" style="width: 155px;"><active data-reactid=".g.b.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".g.b.1"><span data-reactid=".g.b.1.0">JSONP 输出方法实现</span></a></outline><outline class="toc-level-h3" data-reactid=".g.c" style="width: 155px;"><active data-reactid=".g.c.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".g.c.1"><span data-reactid=".g.c.1.0">HTML 输出方法实现</span></a></outline><outline class="toc-level-h2" data-reactid=".g.d" style="width: 165px;"><active data-reactid=".g.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".g.d.1"><span data-reactid=".g.d.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".g.e" style="width: 165px;"><active data-reactid=".g.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".g.e.1"><span data-reactid=".g.e.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".g.f" style="width: 165px;"><active data-reactid=".g.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".g.f.1"><span data-reactid=".g.f.1.0">精选留言 (8)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/420009" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>