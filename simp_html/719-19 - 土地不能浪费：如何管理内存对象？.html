
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAA7VBMVEUAAAD///8ZGRnw8PBWVlb4+PgeHh719fVEREQlJSUODg6Ojo7Ly8v9/f1NTU2VlZUFBQV6enrCwsLy8vLh4eE0NDQLCwu8vLyXl5dxcXHa2trAwMCFhYVDQ0OysrKampo7OzssLCwICAioqKjJyckhISHu7u4/Pz9TU1NQUFBLS0tAQED6+vrS0tKRkZFISEgvLy+goKB+fn5vb29nZ2fm5uYbGxvk5OTX19d2dnZaWlre3t5hYWEyMjK5ubkoKCgVFRXQ0NDMzMzFxcW0tLSsrKykpKSMjIzq6urU1NSAgICvr6+cnJyHh4dsbGyfc25QAAAFkElEQVRIx4WXB3faMBCA74wHxgMMGAOh1MyyVyBAmtVmd/3/n1OdDtWstt/Li5JD35MtnU4CMnCIlkLEOpSKuMPhuI4FE444L9+dyv3zciad/rAjfU/yOPpGcjWS1NKSGsk29WTSD1IeYsIPkvsAJF+C5BIZkieYMNjJnsF4+JHk61wOSlVDyOIPqKBgZIxYTrqy/AmNtC1ps7yqlgE6dgYa1WqD5aV9SbKDbe6ZNnCq5A5ILlhGjEASIoawJdmHHo98AZLOnmxzKM9yK9Aht63FoAWBBmEgsEHnkfMgsZU8PJbpbXJd3MIep/Lg/MjbRqMRRuNtQ4Tthga5RiNzfmSWD97ZExQ64HhtgLb3CmbBGyj54vixjyeMsKjnV4AvOAHTwsHphKnH9toXki7Li3jLsgswizskv+c3PHKXe7ZHu5E/YMKcM2yqZIJkAclZTPClbJezivI1yTr4f+TeMib5qXxHsr7XtUFJDIc8pLAHA7Su4JXkd8ySnKZddQXH2NohswIutRu0Qu0jyS46JPugU+gISB1R8NBKWegVUsahTKEjAP9Bm5bKAc3DPlzjKaDvscE7PeEJu63WUg9a82tdA1O/ESupL9Cr6C1cXetjIe9zgQ4kvKLgHi6xC5LcGq9hhmiK0AYgUvLQtzm3n/x0jnum/Vo9j1jxg/pL3/f9W8isMOsv6/Ubf47rvl+u17nnZ1xQ+4iIXa6IpRVeimEEE3pnxO8kIz4CbFDyidVSpooBCCLLsj5noFlqUg2rwK0l+Anmm+VhCzKfrRHtqjGOLANxUKIUiYvFEcuaaZpXANniD5ZzpiBDTSRkuDJfWM6awxGuikUArp7fIOE7RlB6OygGTyhfsMyrtwDNIAkcp1YRhKC9Oh2IHUFQ6UPupnLL3icODaD5zVlUto7zhm1n7kmZ5kDSQBxykfZhD66eaQBoWriEGPcA182C4Crst90Z9NwvHgahDTALw/Ae4D500Pjq3oj/4sjtwcwVrCkkgB01HB8cdM0iIlWSr6IpNqFO+1mDHQFWORtO5EIi08b4jxy6giBsgKDnRnEYYdd9nIYvaLmuhS/h9DF5bEFr/7HTKAjUqWY1oUUBKgYEZdgIP6gJE2xQIWVvLhZBcAWx843kz87PDDi4cgR92s8/1FLpAGNeKiUbGtRQEIPkGb9TM1EF8MpCVEni7pIkkUdDs1ZcI/ZUer6YZg4WxTtqMmYsZJWebbOzEekZV4sCKaNhBaXQQ0NtjL71ZooNE1vWLfyyyFUbw7MsD0fWOFMSqAnbwj1Kuk0Aqp4aJ91MZhhvyS7+oQoMy5v63Jfoz/UYfPSiep2KQb5e4/gt1Ycdc7Se6jNyVbpuQNI08FrICQ6ccKnSXddrKCnqkqWFupJFAewKudSTBVAyBEjrLSXjCYnc5rrdQVl6VaiKqOTToi/kaSrlcW5fpGpgrlJTLvoGVxKDOg7PHzc6NLXOmuUHTZQhTWvS4T7T5ixPqGPz/EHXp/azkMeQoGOqBBOSq1gD4vwRe1culz8W8HlZKQt6Sjbm5XeS9eWizJw73HcsOW8mSpa0eT8zfK1w85LdtWKTf5dWfCPzMg5J+MBdsvvy6Q2QD/d91sfzouRz9zAdBp6HCcUzskccyBdKzjTC9ZE8HT8+JHLxtiE4d33Ud0uleOObvpXZk4E4/9h2sKD9t6oxgaCFxs9AHiI3wYJCndMbIMs9lLi7vEHFLxAUURyciOnTyzrLH6qSJwo+8CWuQIFL2wSoVyvQea/qtk2yvPtb4mekZMhJQkPwyvIzBbJGJD+jX3eGcfIFhWVmxsVAG5FMgSzm9y4wKL8aJdzvyctoTqEgep6K5lckWGM3uuuA5DadFvIhiTzBL1xzVtT0UDEDxd9ldeutcJLoyvUaoPgNdiqckZLamd0AAAAASUVORK5CYII=")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 19 | 土地不能浪费：如何管理内存对象？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>19 | 土地不能浪费：如何管理内存对象？</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">这节课我会带你实现分配和释放内存页面，达到内存管理的目的。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">19 | 土地不能浪费：如何管理内存对象？</h1><div><span>LMOS</span> <span>2021-06-21</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/d9/a4/d98e9ed0f23193985e80e0a43905f7a4.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：陈晨</span><span>大小：13.86M</span><span> 时长：15:10</span></div></div><audio title="19 | 土地不能浪费：如何管理内存对象？" src="https://res001.geekbang.org/media/audio/8e/bb/8e6777602cd04f723a495b965199aebb/ld/ld.m3u8" __idm_id__="950274"></audio></div><div><div><div><div data-slate-editor="true" data-key="1489" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="1490"><span data-slate-object="text" data-key="1491"><span data-slate-leaf="true" data-offset-key="1491:0" data-first-offset="true"><span data-slate-string="true">你好，我是 LMOS。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1492"><span data-slate-object="text" data-key="1493"><span data-slate-leaf="true" data-offset-key="1493:0" data-first-offset="true"><span data-slate-string="true">在前面的课程中，我们建立了物理内存页面管理器，它既可以分配单个页面，也可以分配多个连续的页面，还能指定在特殊内存地址区域中分配页面。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1494"><span data-slate-object="text" data-key="1495"><span data-slate-leaf="true" data-offset-key="1495:0" data-first-offset="true"><span data-slate-string="true">但你发现没有，物理内存页面管理器一次分配至少是一个页面，而我们对内存分页是一个页面 4KB，即 4096 字节。对于小于一个页面的内存分配请求，它无能为力。如果要实现小于一个页面的内存分配请求，又该怎么做呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1496"><span data-slate-object="text" data-key="1497"><span data-slate-leaf="true" data-offset-key="1497:0" data-first-offset="true"><span data-slate-string="true">这节课我们就一起来解决这个问题。课程配套代码，你可以从</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="1498"><span data-slate-object="text" data-key="1499"><span data-slate-leaf="true" data-offset-key="1499:0" data-first-offset="true"><span data-slate-string="true">这里</span></span></span></a><span data-slate-object="text" data-key="1500"><span data-slate-leaf="true" data-offset-key="1500:0" data-first-offset="true"><span data-slate-string="true">获得。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="1501" id="sr-toc-1"><span data-slate-object="text" data-key="1502"><span data-slate-leaf="true" data-offset-key="1502:0" data-first-offset="true"><span data-slate-string="true">malloc 给我们的启发</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="1503"><span data-slate-object="text" data-key="1504"><span data-slate-leaf="true" data-offset-key="1504:0" data-first-offset="true"><span data-slate-string="true">首先，我想和你说说，为什么小于一个页面的内存我们也要格外珍惜？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1505"><span data-slate-object="text" data-key="1506"><span data-slate-leaf="true" data-offset-key="1506:0" data-first-offset="true"><span data-slate-string="true">如果你在大学学过 C 程序设计语言的话，相信你对 C 库中的 malloc 函数也不会陌生，它负责完成分配一块内存空间的功能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1507"><span data-slate-object="text" data-key="1508"><span data-slate-leaf="true" data-offset-key="1508:0" data-first-offset="true"><span data-slate-string="true">下面的代码。我相信你也写过，或者写过类似的，不用多介绍你也可以明白。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="1509"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="1510"><span data-slate-object="text" data-key="1511"><span data-slate-leaf="true" data-offset-key="1511:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="1512"><span data-slate-leaf="true" data-offset-key="1512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="1513"><span data-slate-leaf="true" data-offset-key="1513:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1514"><span data-slate-leaf="true" data-offset-key="1514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;stdio.h&gt;</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1515"><span data-slate-object="text" data-key="1516"><span data-slate-leaf="true" data-offset-key="1516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="1517"><span data-slate-leaf="true" data-offset-key="1517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="1518"><span data-slate-leaf="true" data-offset-key="1518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1519"><span data-slate-leaf="true" data-offset-key="1519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;string.h&gt;</span></span></span></span></span><span data-slate-object="text" data-key="1520"><span data-slate-leaf="true" data-offset-key="1520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1521"><span data-slate-object="text" data-key="1522"><span data-slate-leaf="true" data-offset-key="1522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="1523"><span data-slate-leaf="true" data-offset-key="1523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">include</span></span></span></span></span><span data-slate-object="text" data-key="1524"><span data-slate-leaf="true" data-offset-key="1524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1525"><span data-slate-leaf="true" data-offset-key="1525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;stdlib.h&gt;</span></span></span></span></span><span data-slate-object="text" data-key="1526"><span data-slate-leaf="true" data-offset-key="1526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">   </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1527"><span data-slate-object="text" data-key="1528"><span data-slate-leaf="true" data-offset-key="1528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span><span data-slate-object="text" data-key="1529"><span data-slate-leaf="true" data-offset-key="1529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1530"><span data-slate-leaf="true" data-offset-key="1530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="1531"><span data-slate-leaf="true" data-offset-key="1531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="1532"><span data-slate-leaf="true" data-offset-key="1532:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1533"><span data-slate-leaf="true" data-offset-key="1533:0" data-first-offset="true"><span data-slate-string="true">{    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1534"><span data-slate-object="text" data-key="1535"><span data-slate-leaf="true" data-offset-key="1535:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1536"><span data-slate-leaf="true" data-offset-key="1536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">char</span></span></span></span><span data-slate-object="text" data-key="1537"><span data-slate-leaf="true" data-offset-key="1537:0" data-first-offset="true"><span data-slate-string="true"> *str;      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1538"><span data-slate-object="text" data-key="1539"><span data-slate-leaf="true" data-offset-key="1539:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1540"><span data-slate-leaf="true" data-offset-key="1540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存分配 存放 15 个 char 字符类型   </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1541"><span data-slate-object="text" data-key="1542"><span data-slate-leaf="true" data-offset-key="1542:0" data-first-offset="true"><span data-slate-string="true">    str = (</span></span></span><span data-slate-object="text" data-key="1543"><span data-slate-leaf="true" data-offset-key="1543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">char</span></span></span></span><span data-slate-object="text" data-key="1544"><span data-slate-leaf="true" data-offset-key="1544:0" data-first-offset="true"><span data-slate-string="true"> *) </span></span></span><span data-slate-object="text" data-key="1545"><span data-slate-leaf="true" data-offset-key="1545:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">malloc</span></span></span></span><span data-slate-object="text" data-key="1546"><span data-slate-leaf="true" data-offset-key="1546:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="1547"><span data-slate-leaf="true" data-offset-key="1547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">15</span></span></span></span><span data-slate-object="text" data-key="1548"><span data-slate-leaf="true" data-offset-key="1548:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1549"><span data-slate-object="text" data-key="1550"><span data-slate-leaf="true" data-offset-key="1550:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1551"><span data-slate-leaf="true" data-offset-key="1551:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="1552"><span data-slate-leaf="true" data-offset-key="1552:0" data-first-offset="true"><span data-slate-string="true"> (str == </span></span></span><span data-slate-object="text" data-key="1553"><span data-slate-leaf="true" data-offset-key="1553:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="1554"><span data-slate-leaf="true" data-offset-key="1554:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1555"><span data-slate-object="text" data-key="1556"><span data-slate-leaf="true" data-offset-key="1556:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="1557"><span data-slate-leaf="true" data-offset-key="1557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">printf</span></span></span></span><span data-slate-object="text" data-key="1558"><span data-slate-leaf="true" data-offset-key="1558:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="1559"><span data-slate-leaf="true" data-offset-key="1559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"mem alloc err\n"</span></span></span></span><span data-slate-object="text" data-key="1560"><span data-slate-leaf="true" data-offset-key="1560:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1561"><span data-slate-object="text" data-key="1562"><span data-slate-leaf="true" data-offset-key="1562:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="1563"><span data-slate-leaf="true" data-offset-key="1563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="1564"><span data-slate-leaf="true" data-offset-key="1564:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1565"><span data-slate-leaf="true" data-offset-key="1565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-1</span></span></span></span><span data-slate-object="text" data-key="1566"><span data-slate-leaf="true" data-offset-key="1566:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1567"><span data-slate-object="text" data-key="1568"><span data-slate-leaf="true" data-offset-key="1568:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1569"><span data-slate-object="text" data-key="1570"><span data-slate-leaf="true" data-offset-key="1570:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1571"><span data-slate-leaf="true" data-offset-key="1571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把 hello world 字符串复制到 str 开始的内存地址空间中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1572"><span data-slate-object="text" data-key="1573"><span data-slate-leaf="true" data-offset-key="1573:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1574"><span data-slate-leaf="true" data-offset-key="1574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">strcpy</span></span></span></span><span data-slate-object="text" data-key="1575"><span data-slate-leaf="true" data-offset-key="1575:0" data-first-offset="true"><span data-slate-string="true">(str, </span></span></span><span data-slate-object="text" data-key="1576"><span data-slate-leaf="true" data-offset-key="1576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hello world"</span></span></span></span><span data-slate-object="text" data-key="1577"><span data-slate-leaf="true" data-offset-key="1577:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1578"><span data-slate-object="text" data-key="1579"><span data-slate-leaf="true" data-offset-key="1579:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1580"><span data-slate-leaf="true" data-offset-key="1580:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 打印 hello world 字符串和它的地址    </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1581"><span data-slate-object="text" data-key="1582"><span data-slate-leaf="true" data-offset-key="1582:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1583"><span data-slate-leaf="true" data-offset-key="1583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">printf</span></span></span></span><span data-slate-object="text" data-key="1584"><span data-slate-leaf="true" data-offset-key="1584:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="1585"><span data-slate-leaf="true" data-offset-key="1585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"String = %s,  Address = %u\n"</span></span></span></span><span data-slate-object="text" data-key="1586"><span data-slate-leaf="true" data-offset-key="1586:0" data-first-offset="true"><span data-slate-string="true">, str, str);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1587"><span data-slate-object="text" data-key="1588"><span data-slate-leaf="true" data-offset-key="1588:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1589"><span data-slate-leaf="true" data-offset-key="1589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放分配的内存</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1590"><span data-slate-object="text" data-key="1591"><span data-slate-leaf="true" data-offset-key="1591:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1592"><span data-slate-leaf="true" data-offset-key="1592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">free</span></span></span></span><span data-slate-object="text" data-key="1593"><span data-slate-leaf="true" data-offset-key="1593:0" data-first-offset="true"><span data-slate-string="true">(str);      </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1594"><span data-slate-object="text" data-key="1595"><span data-slate-leaf="true" data-offset-key="1595:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1596"><span data-slate-leaf="true" data-offset-key="1596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="1597"><span data-slate-leaf="true" data-offset-key="1597:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="1598"><span data-slate-leaf="true" data-offset-key="1598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="1599"><span data-slate-leaf="true" data-offset-key="1599:0" data-first-offset="true"><span data-slate-string="true">); </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1600"><span data-slate-object="text" data-key="1601"><span data-slate-leaf="true" data-offset-key="1601:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1602"><span data-slate-object="text" data-key="1603"><span data-slate-leaf="true" data-offset-key="1603:0" data-first-offset="true"><span data-slate-string="true">这个代码流程很简单，就是分配一块 15 字节大小的内存空间，然后把字符串复制到分配的内存空间中，最后用字符串的形式打印了那个块内存，最后释放该内存空间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1604"><span data-slate-object="text" data-key="1605"><span data-slate-leaf="true" data-offset-key="1605:0" data-first-offset="true"><span data-slate-string="true">但我们并不是要了解 malloc、free 函数的工作原理，而是要清楚，像这样分配几个字节内存空间的操作，这在内核中比比皆是。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="1606" id="sr-toc-2"><span data-slate-object="text" data-key="1607"><span data-slate-leaf="true" data-offset-key="1607:0" data-first-offset="true"><span data-slate-string="true">页还能细分吗</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="1608"><span data-slate-object="text" data-key="1609"><span data-slate-leaf="true" data-offset-key="1609:0" data-first-offset="true"><span data-slate-string="true">是的，单从内存角度来看，页最小是以字节为单位的。但是从 MMU 角度看，内存是以页为单位的，所以我们的 Cosmos 的物理内存分配器也以页为单位。现在的问题是，内核中有大量远小于一个页面的内存分配请求，如果对此还是分配一个页面，就会浪费内存。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1610"><span data-slate-object="text" data-key="1611"><span data-slate-leaf="true" data-offset-key="1611:0" data-first-offset="true"><span data-slate-string="true">要想解决这个问题，</span></span></span><span data-slate-object="text" data-key="1612"><span data-slate-leaf="true" data-offset-key="1612:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">就要细分 “页” 这个单位</span></span></span></span><span data-slate-object="text" data-key="1613"><span data-slate-leaf="true" data-offset-key="1613:0" data-first-offset="true"><span data-slate-string="true">。虽然从 MMU 角度来看，页不能细分，但是从软件逻辑层面页可以细分，但是如何分，则十分讲究。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1614"><span data-slate-object="text" data-key="1615"><span data-slate-leaf="true" data-offset-key="1615:0" data-first-offset="true"><span data-slate-string="true">结合历史经验和硬件特性（Cache 行大小）来看，我们可以把一个页面或者连续的多个页面，分成 32 字节、64 字节、128 字节、256 字节、512 字节、1024 字节、2048 字节、4096 字节（一个页）。这些都是 Cache 行大小的倍数。我们给这些小块内存取个名字，叫</span></span></span><span data-slate-object="text" data-key="1616"><span data-slate-leaf="true" data-offset-key="1616:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">内存对象</span></span></span></span><span data-slate-object="text" data-key="1617"><span data-slate-leaf="true" data-offset-key="1617:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1618"><span data-slate-object="text" data-key="1619"><span data-slate-leaf="true" data-offset-key="1619:0" data-first-offset="true"><span data-slate-string="true">我们可以这样设计：</span></span></span><span data-slate-object="text" data-key="1620"><span data-slate-leaf="true" data-offset-key="1620:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">把一个或者多个内存页面分配出来，作为一个内存对象的容器，在这个容器中容纳相同的内存对象，即同等大小的内存块。</span></span></span></span><span data-slate-object="text" data-key="1621"><span data-slate-leaf="true" data-offset-key="1621:0" data-first-offset="true"><span data-slate-string="true">你可以把这个容器，想像成一个内存对象数组。为了让你更好理解，我还给你画了张图解释。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="1622"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/a9/47/a9e3c059aceb3433de2116f9bee02d47.jpg?wh=5160x3099"></div><div>内存对象视图</div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="1623" id="sr-toc-3"><span data-slate-object="text" data-key="1624"><span data-slate-leaf="true" data-offset-key="1624:0" data-first-offset="true"><span data-slate-string="true">如何表示一个内存对象</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="1625"><span data-slate-object="text" data-key="1626"><span data-slate-leaf="true" data-offset-key="1626:0" data-first-offset="true"><span data-slate-string="true">前面只是进行了理论上的设计和构想，下面我们就通过代码来实现这些构想，真正把想法变成现实。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1627"><span data-slate-object="text" data-key="1628"><span data-slate-leaf="true" data-offset-key="1628:0" data-first-offset="true"><span data-slate-string="true">我们从内存对象开始入手。如何表示一个内存对象呢？当然是要设计一个表示内存对象的数据结构，代码如下所示：</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="1629"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="1630"><span data-slate-object="text" data-key="1631"><span data-slate-leaf="true" data-offset-key="1631:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1632"><span data-slate-leaf="true" data-offset-key="1632:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1633"><span data-slate-leaf="true" data-offset-key="1633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1634"><span data-slate-leaf="true" data-offset-key="1634:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1635"><span data-slate-leaf="true" data-offset-key="1635:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_FREOBJH</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1636"><span data-slate-object="text" data-key="1637"><span data-slate-leaf="true" data-offset-key="1637:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1638"><span data-slate-object="text" data-key="1639"><span data-slate-leaf="true" data-offset-key="1639:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1640"><span data-slate-leaf="true" data-offset-key="1640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1641"><span data-slate-leaf="true" data-offset-key="1641:0" data-first-offset="true"><span data-slate-string="true"> oh_list;     </span></span></span><span data-slate-object="text" data-key="1642"><span data-slate-leaf="true" data-offset-key="1642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1643"><span data-slate-object="text" data-key="1644"><span data-slate-leaf="true" data-offset-key="1644:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1645"><span data-slate-leaf="true" data-offset-key="1645:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1646"><span data-slate-leaf="true" data-offset-key="1646:0" data-first-offset="true"><span data-slate-string="true"> oh_stus;       </span></span></span><span data-slate-object="text" data-key="1647"><span data-slate-leaf="true" data-offset-key="1647:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对象状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1648"><span data-slate-object="text" data-key="1649"><span data-slate-leaf="true" data-offset-key="1649:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1650"><span data-slate-leaf="true" data-offset-key="1650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="1651"><span data-slate-leaf="true" data-offset-key="1651:0" data-first-offset="true"><span data-slate-string="true">* oh_stat;        </span></span></span><span data-slate-object="text" data-key="1652"><span data-slate-leaf="true" data-offset-key="1652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对象的开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1653"><span data-slate-object="text" data-key="1654"><span data-slate-leaf="true" data-offset-key="1654:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1655"><span data-slate-leaf="true" data-offset-key="1655:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="1656"><span data-slate-leaf="true" data-offset-key="1656:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1657"><span data-slate-object="text" data-key="1658"><span data-slate-leaf="true" data-offset-key="1658:0" data-first-offset="true"><span data-slate-string="true">我们在后面的代码中就用 freobjh_t 结构表示一个对象，其中的链表是为了找到这个对象。是不是很简单？没错，表示一个内存对象就是如此简单。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="1659" id="sr-toc-4"><span data-slate-object="text" data-key="1660"><span data-slate-leaf="true" data-offset-key="1660:0" data-first-offset="true"><span data-slate-string="true">内存对象容器</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="1661"><span data-slate-object="text" data-key="1662"><span data-slate-leaf="true" data-offset-key="1662:0" data-first-offset="true"><span data-slate-string="true">光有内存对象还不够，如何放置内存对象是很重要的。根据前面的构想，为了把多个同等大小的内存对象放在一个内存对象容器中，我们需要设计出表示内存对象容器的数据结构。内存容器要占用内存页面，需要内存对象计数信息、内存对象大小信息，还要能扩展容量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1663"><span data-slate-object="text" data-key="1664"><span data-slate-leaf="true" data-offset-key="1664:0" data-first-offset="true"><span data-slate-string="true">把上述功能综合起来，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="1665"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="1666"><span data-slate-object="text" data-key="1667"><span data-slate-leaf="true" data-offset-key="1667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 管理内存对象容器占用的内存页面所对应的 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1668"><span data-slate-object="text" data-key="1669"><span data-slate-leaf="true" data-offset-key="1669:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1670"><span data-slate-leaf="true" data-offset-key="1670:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1671"><span data-slate-leaf="true" data-offset-key="1671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1672"><span data-slate-leaf="true" data-offset-key="1672:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1673"><span data-slate-leaf="true" data-offset-key="1673:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_MSCLST</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1674"><span data-slate-object="text" data-key="1675"><span data-slate-leaf="true" data-offset-key="1675:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1676"><span data-slate-object="text" data-key="1677"><span data-slate-leaf="true" data-offset-key="1677:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1678"><span data-slate-leaf="true" data-offset-key="1678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1679"><span data-slate-leaf="true" data-offset-key="1679:0" data-first-offset="true"><span data-slate-string="true"> ml_msanr;  </span></span></span><span data-slate-object="text" data-key="1680"><span data-slate-leaf="true" data-offset-key="1680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 多少个 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1681"><span data-slate-object="text" data-key="1682"><span data-slate-leaf="true" data-offset-key="1682:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1683"><span data-slate-leaf="true" data-offset-key="1683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1684"><span data-slate-leaf="true" data-offset-key="1684:0" data-first-offset="true"><span data-slate-string="true"> ml_ompnr;  </span></span></span><span data-slate-object="text" data-key="1685"><span data-slate-leaf="true" data-offset-key="1685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 一个 msadsc_t 对应的连续的物理内存页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1686"><span data-slate-object="text" data-key="1687"><span data-slate-leaf="true" data-offset-key="1687:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1688"><span data-slate-leaf="true" data-offset-key="1688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1689"><span data-slate-leaf="true" data-offset-key="1689:0" data-first-offset="true"><span data-slate-string="true"> ml_list; </span></span></span><span data-slate-object="text" data-key="1690"><span data-slate-leaf="true" data-offset-key="1690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载 msadsc_t 的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1691"><span data-slate-object="text" data-key="1692"><span data-slate-leaf="true" data-offset-key="1692:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1693"><span data-slate-leaf="true" data-offset-key="1693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msclst_t</span></span></span></span><span data-slate-object="text" data-key="1694"><span data-slate-leaf="true" data-offset-key="1694:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1695"><span data-slate-object="text" data-key="1696"><span data-slate-leaf="true" data-offset-key="1696:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 管理内存对象容器占用的内存</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1697"><span data-slate-object="text" data-key="1698"><span data-slate-leaf="true" data-offset-key="1698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1699"><span data-slate-leaf="true" data-offset-key="1699:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1700"><span data-slate-leaf="true" data-offset-key="1700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1701"><span data-slate-leaf="true" data-offset-key="1701:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1702"><span data-slate-leaf="true" data-offset-key="1702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_MSOMDC</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1703"><span data-slate-object="text" data-key="1704"><span data-slate-leaf="true" data-offset-key="1704:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1705"><span data-slate-object="text" data-key="1706"><span data-slate-leaf="true" data-offset-key="1706:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1707"><span data-slate-leaf="true" data-offset-key="1707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//msclst_t 结构数组 mc_lst [0]=1 个连续页面的 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1708"><span data-slate-object="text" data-key="1709"><span data-slate-leaf="true" data-offset-key="1709:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1710"><span data-slate-leaf="true" data-offset-key="1710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//               mc_lst [1]=2 个连续页面的 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1711"><span data-slate-object="text" data-key="1712"><span data-slate-leaf="true" data-offset-key="1712:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1713"><span data-slate-leaf="true" data-offset-key="1713:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//               mc_lst [2]=4 个连续页面的 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1714"><span data-slate-object="text" data-key="1715"><span data-slate-leaf="true" data-offset-key="1715:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1716"><span data-slate-leaf="true" data-offset-key="1716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//               mc_lst [3]=8 个连续页面的 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1717"><span data-slate-object="text" data-key="1718"><span data-slate-leaf="true" data-offset-key="1718:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1719"><span data-slate-leaf="true" data-offset-key="1719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//               mc_lst [4]=16 个连续页面的 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1720"><span data-slate-object="text" data-key="1721"><span data-slate-leaf="true" data-offset-key="1721:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1722"><span data-slate-leaf="true" data-offset-key="1722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msclst_t</span></span></span></span><span data-slate-object="text" data-key="1723"><span data-slate-leaf="true" data-offset-key="1723:0" data-first-offset="true"><span data-slate-string="true"> mc_lst[MSCLST_MAX];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1724"><span data-slate-object="text" data-key="1725"><span data-slate-leaf="true" data-offset-key="1725:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1726"><span data-slate-leaf="true" data-offset-key="1726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1727"><span data-slate-leaf="true" data-offset-key="1727:0" data-first-offset="true"><span data-slate-string="true"> mc_msanr;   </span></span></span><span data-slate-object="text" data-key="1728"><span data-slate-leaf="true" data-offset-key="1728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 总共多个 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1729"><span data-slate-object="text" data-key="1730"><span data-slate-leaf="true" data-offset-key="1730:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1731"><span data-slate-leaf="true" data-offset-key="1731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1732"><span data-slate-leaf="true" data-offset-key="1732:0" data-first-offset="true"><span data-slate-string="true"> mc_list;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1733"><span data-slate-object="text" data-key="1734"><span data-slate-leaf="true" data-offset-key="1734:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1735"><span data-slate-leaf="true" data-offset-key="1735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器第一个占用 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1736"><span data-slate-object="text" data-key="1737"><span data-slate-leaf="true" data-offset-key="1737:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1738"><span data-slate-leaf="true" data-offset-key="1738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1739"><span data-slate-leaf="true" data-offset-key="1739:0" data-first-offset="true"><span data-slate-string="true"> mc_kmobinlst;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1740"><span data-slate-object="text" data-key="1741"><span data-slate-leaf="true" data-offset-key="1741:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1742"><span data-slate-leaf="true" data-offset-key="1742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器第一个占用 msadsc_t 对应的连续的物理内存页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1743"><span data-slate-object="text" data-key="1744"><span data-slate-leaf="true" data-offset-key="1744:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1745"><span data-slate-leaf="true" data-offset-key="1745:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1746"><span data-slate-leaf="true" data-offset-key="1746:0" data-first-offset="true"><span data-slate-string="true"> mc_kmobinpnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1747"><span data-slate-object="text" data-key="1748"><span data-slate-leaf="true" data-offset-key="1748:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1749"><span data-slate-leaf="true" data-offset-key="1749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msomdc_t</span></span></span></span><span data-slate-object="text" data-key="1750"><span data-slate-leaf="true" data-offset-key="1750:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1751"><span data-slate-object="text" data-key="1752"><span data-slate-leaf="true" data-offset-key="1752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 管理内存对象容器扩展容量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1753"><span data-slate-object="text" data-key="1754"><span data-slate-leaf="true" data-offset-key="1754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1755"><span data-slate-leaf="true" data-offset-key="1755:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1756"><span data-slate-leaf="true" data-offset-key="1756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1757"><span data-slate-leaf="true" data-offset-key="1757:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1758"><span data-slate-leaf="true" data-offset-key="1758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_KMBEXT</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1759"><span data-slate-object="text" data-key="1760"><span data-slate-leaf="true" data-offset-key="1760:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1761"><span data-slate-object="text" data-key="1762"><span data-slate-leaf="true" data-offset-key="1762:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1763"><span data-slate-leaf="true" data-offset-key="1763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1764"><span data-slate-leaf="true" data-offset-key="1764:0" data-first-offset="true"><span data-slate-string="true"> mt_list;        </span></span></span><span data-slate-object="text" data-key="1765"><span data-slate-leaf="true" data-offset-key="1765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1766"><span data-slate-object="text" data-key="1767"><span data-slate-leaf="true" data-offset-key="1767:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1768"><span data-slate-leaf="true" data-offset-key="1768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="1769"><span data-slate-leaf="true" data-offset-key="1769:0" data-first-offset="true"><span data-slate-string="true"> mt_vstat;          </span></span></span><span data-slate-object="text" data-key="1770"><span data-slate-leaf="true" data-offset-key="1770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器扩展容量开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1771"><span data-slate-object="text" data-key="1772"><span data-slate-leaf="true" data-offset-key="1772:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1773"><span data-slate-leaf="true" data-offset-key="1773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="1774"><span data-slate-leaf="true" data-offset-key="1774:0" data-first-offset="true"><span data-slate-string="true"> mt_vend;           </span></span></span><span data-slate-object="text" data-key="1775"><span data-slate-leaf="true" data-offset-key="1775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器扩展容量结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1776"><span data-slate-object="text" data-key="1777"><span data-slate-leaf="true" data-offset-key="1777:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1778"><span data-slate-leaf="true" data-offset-key="1778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="1779"><span data-slate-leaf="true" data-offset-key="1779:0" data-first-offset="true"><span data-slate-string="true">* mt_kmsb;        </span></span></span><span data-slate-object="text" data-key="1780"><span data-slate-leaf="true" data-offset-key="1780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 指向内存对象容器结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1781"><span data-slate-object="text" data-key="1782"><span data-slate-leaf="true" data-offset-key="1782:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1783"><span data-slate-leaf="true" data-offset-key="1783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1784"><span data-slate-leaf="true" data-offset-key="1784:0" data-first-offset="true"><span data-slate-string="true"> mt_mobjnr;        </span></span></span><span data-slate-object="text" data-key="1785"><span data-slate-leaf="true" data-offset-key="1785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器扩展容量的内存中有多少对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1786"><span data-slate-object="text" data-key="1787"><span data-slate-leaf="true" data-offset-key="1787:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1788"><span data-slate-leaf="true" data-offset-key="1788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="1789"><span data-slate-leaf="true" data-offset-key="1789:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1790"><span data-slate-object="text" data-key="1791"><span data-slate-leaf="true" data-offset-key="1791:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1792"><span data-slate-object="text" data-key="1793"><span data-slate-leaf="true" data-offset-key="1793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1794"><span data-slate-leaf="true" data-offset-key="1794:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1795"><span data-slate-leaf="true" data-offset-key="1795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1796"><span data-slate-leaf="true" data-offset-key="1796:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1797"><span data-slate-leaf="true" data-offset-key="1797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_KMSOB</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1798"><span data-slate-object="text" data-key="1799"><span data-slate-leaf="true" data-offset-key="1799:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1800"><span data-slate-object="text" data-key="1801"><span data-slate-leaf="true" data-offset-key="1801:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1802"><span data-slate-leaf="true" data-offset-key="1802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1803"><span data-slate-leaf="true" data-offset-key="1803:0" data-first-offset="true"><span data-slate-string="true"> so_list;        </span></span></span><span data-slate-object="text" data-key="1804"><span data-slate-leaf="true" data-offset-key="1804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1805"><span data-slate-object="text" data-key="1806"><span data-slate-leaf="true" data-offset-key="1806:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1807"><span data-slate-leaf="true" data-offset-key="1807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="1808"><span data-slate-leaf="true" data-offset-key="1808:0" data-first-offset="true"><span data-slate-string="true"> so_lock;      </span></span></span><span data-slate-object="text" data-key="1809"><span data-slate-leaf="true" data-offset-key="1809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 保护结构自身的自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1810"><span data-slate-object="text" data-key="1811"><span data-slate-leaf="true" data-offset-key="1811:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1812"><span data-slate-leaf="true" data-offset-key="1812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1813"><span data-slate-leaf="true" data-offset-key="1813:0" data-first-offset="true"><span data-slate-string="true"> so_stus;          </span></span></span><span data-slate-object="text" data-key="1814"><span data-slate-leaf="true" data-offset-key="1814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 状态与标志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1815"><span data-slate-object="text" data-key="1816"><span data-slate-leaf="true" data-offset-key="1816:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1817"><span data-slate-leaf="true" data-offset-key="1817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1818"><span data-slate-leaf="true" data-offset-key="1818:0" data-first-offset="true"><span data-slate-string="true"> so_flgs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1819"><span data-slate-object="text" data-key="1820"><span data-slate-leaf="true" data-offset-key="1820:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1821"><span data-slate-leaf="true" data-offset-key="1821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="1822"><span data-slate-leaf="true" data-offset-key="1822:0" data-first-offset="true"><span data-slate-string="true"> so_vstat;          </span></span></span><span data-slate-object="text" data-key="1823"><span data-slate-leaf="true" data-offset-key="1823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器的开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1824"><span data-slate-object="text" data-key="1825"><span data-slate-leaf="true" data-offset-key="1825:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1826"><span data-slate-leaf="true" data-offset-key="1826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="1827"><span data-slate-leaf="true" data-offset-key="1827:0" data-first-offset="true"><span data-slate-string="true"> so_vend;           </span></span></span><span data-slate-object="text" data-key="1828"><span data-slate-leaf="true" data-offset-key="1828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器的结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1829"><span data-slate-object="text" data-key="1830"><span data-slate-leaf="true" data-offset-key="1830:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1831"><span data-slate-leaf="true" data-offset-key="1831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="1832"><span data-slate-leaf="true" data-offset-key="1832:0" data-first-offset="true"><span data-slate-string="true"> so_objsz;         </span></span></span><span data-slate-object="text" data-key="1833"><span data-slate-leaf="true" data-offset-key="1833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1834"><span data-slate-object="text" data-key="1835"><span data-slate-leaf="true" data-offset-key="1835:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1836"><span data-slate-leaf="true" data-offset-key="1836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="1837"><span data-slate-leaf="true" data-offset-key="1837:0" data-first-offset="true"><span data-slate-string="true"> so_objrelsz;      </span></span></span><span data-slate-object="text" data-key="1838"><span data-slate-leaf="true" data-offset-key="1838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象实际大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1839"><span data-slate-object="text" data-key="1840"><span data-slate-leaf="true" data-offset-key="1840:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1841"><span data-slate-leaf="true" data-offset-key="1841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1842"><span data-slate-leaf="true" data-offset-key="1842:0" data-first-offset="true"><span data-slate-string="true"> so_mobjnr;        </span></span></span><span data-slate-object="text" data-key="1843"><span data-slate-leaf="true" data-offset-key="1843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器中总共的对象个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1844"><span data-slate-object="text" data-key="1845"><span data-slate-leaf="true" data-offset-key="1845:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1846"><span data-slate-leaf="true" data-offset-key="1846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1847"><span data-slate-leaf="true" data-offset-key="1847:0" data-first-offset="true"><span data-slate-string="true"> so_fobjnr;        </span></span></span><span data-slate-object="text" data-key="1848"><span data-slate-leaf="true" data-offset-key="1848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器中空闲的对象个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1849"><span data-slate-object="text" data-key="1850"><span data-slate-leaf="true" data-offset-key="1850:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1851"><span data-slate-leaf="true" data-offset-key="1851:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1852"><span data-slate-leaf="true" data-offset-key="1852:0" data-first-offset="true"><span data-slate-string="true"> so_frelst;      </span></span></span><span data-slate-object="text" data-key="1853"><span data-slate-leaf="true" data-offset-key="1853:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器中空闲的对象链表头</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1854"><span data-slate-object="text" data-key="1855"><span data-slate-leaf="true" data-offset-key="1855:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1856"><span data-slate-leaf="true" data-offset-key="1856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1857"><span data-slate-leaf="true" data-offset-key="1857:0" data-first-offset="true"><span data-slate-string="true"> so_alclst;      </span></span></span><span data-slate-object="text" data-key="1858"><span data-slate-leaf="true" data-offset-key="1858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器中分配的对象链表头</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1859"><span data-slate-object="text" data-key="1860"><span data-slate-leaf="true" data-offset-key="1860:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1861"><span data-slate-leaf="true" data-offset-key="1861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1862"><span data-slate-leaf="true" data-offset-key="1862:0" data-first-offset="true"><span data-slate-string="true"> so_mextlst;     </span></span></span><span data-slate-object="text" data-key="1863"><span data-slate-leaf="true" data-offset-key="1863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器扩展 kmbext_t 结构链表头</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1864"><span data-slate-object="text" data-key="1865"><span data-slate-leaf="true" data-offset-key="1865:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1866"><span data-slate-leaf="true" data-offset-key="1866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1867"><span data-slate-leaf="true" data-offset-key="1867:0" data-first-offset="true"><span data-slate-string="true"> so_mextnr;        </span></span></span><span data-slate-object="text" data-key="1868"><span data-slate-leaf="true" data-offset-key="1868:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器扩展 kmbext_t 结构个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1869"><span data-slate-object="text" data-key="1870"><span data-slate-leaf="true" data-offset-key="1870:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1871"><span data-slate-leaf="true" data-offset-key="1871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msomdc_t</span></span></span></span><span data-slate-object="text" data-key="1872"><span data-slate-leaf="true" data-offset-key="1872:0" data-first-offset="true"><span data-slate-string="true"> so_mc;          </span></span></span><span data-slate-object="text" data-key="1873"><span data-slate-leaf="true" data-offset-key="1873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象容器占用内存页面管理结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1874"><span data-slate-object="text" data-key="1875"><span data-slate-leaf="true" data-offset-key="1875:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1876"><span data-slate-leaf="true" data-offset-key="1876:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="1877"><span data-slate-leaf="true" data-offset-key="1877:0" data-first-offset="true"><span data-slate-string="true">* so_privp;          </span></span></span><span data-slate-object="text" data-key="1878"><span data-slate-leaf="true" data-offset-key="1878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 本结构私有数据指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1879"><span data-slate-object="text" data-key="1880"><span data-slate-leaf="true" data-offset-key="1880:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1881"><span data-slate-leaf="true" data-offset-key="1881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="1882"><span data-slate-leaf="true" data-offset-key="1882:0" data-first-offset="true"><span data-slate-string="true">* so_extdp;          </span></span></span><span data-slate-object="text" data-key="1883"><span data-slate-leaf="true" data-offset-key="1883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 本结构扩展数据指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1884"><span data-slate-object="text" data-key="1885"><span data-slate-leaf="true" data-offset-key="1885:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1886"><span data-slate-leaf="true" data-offset-key="1886:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="1887"><span data-slate-leaf="true" data-offset-key="1887:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1888"><span data-slate-object="text" data-key="1889"><span data-slate-leaf="true" data-offset-key="1889:0" data-first-offset="true"><span data-slate-string="true">这段代码中设计了四个数据结构：kmsob_t 用于表示内存对象容器，kmbext_t 用于表示内存对象容器的扩展内存，msomdc_t 和 msclst_t 用于管理内存对象容器占用的物理内存页面。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1890"><span data-slate-object="text" data-key="1891"><span data-slate-leaf="true" data-offset-key="1891:0" data-first-offset="true"><span data-slate-string="true">你可能很难理解它们之间的关系，所以我为你准备了一幅图，如下所示。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="1892"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/7y/bb/7yye7013ae2a878286fc6052c9318bbb.jpg?wh=4460x3085"></div><div>内存对象容器关系</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1893"><span data-slate-object="text" data-key="1894"><span data-slate-leaf="true" data-offset-key="1894:0" data-first-offset="true"><span data-slate-string="true">结合图示我们可以发现，在一组连续物理内存页面（用来存放内存对象）的开始地址那里，就存放着我们 kmsob_t 和 kmbext_t 的实例变量，它们占用了几十字节的空间。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="1895" id="sr-toc-5"><span data-slate-object="text" data-key="1896"><span data-slate-leaf="true" data-offset-key="1896:0" data-first-offset="true"><span data-slate-string="true">初始化</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="1897"><span data-slate-object="text" data-key="1898"><span data-slate-leaf="true" data-offset-key="1898:0" data-first-offset="true"><span data-slate-string="true">因为 kmsob_t、kmbext_t、freobjh_t 结构的实例变量，它们是建立内存对象容器时创建并初始化的，这个过程是伴随着分配内存对象而进行的，所以内存对象管理器的初始化很简单。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="1899"><span data-slate-object="text" data-key="1900"><span data-slate-leaf="true" data-offset-key="1900:0" data-first-offset="true"><span data-slate-string="true">但是有一点还是要初始化的，那就是</span></span></span><span data-slate-object="text" data-key="1901"><span data-slate-leaf="true" data-offset-key="1901:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">管理 kmsob_t 结构的数据结构</span></span></span></span><span data-slate-object="text" data-key="1902"><span data-slate-leaf="true" data-offset-key="1902:0" data-first-offset="true"><span data-slate-string="true">，它用于挂载不同大小的内存容器。现在我们就在 cosmos/hal/x86/ 目录下建立一个 kmsob.c 文件，来实现这个数据结构并初始化，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="1903"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="1904"><span data-slate-object="text" data-key="1905"><span data-slate-leaf="true" data-offset-key="1905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">#</span></span></span></span><span data-slate-object="text" data-key="1906"><span data-slate-leaf="true" data-offset-key="1906:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">define</span></span></span></span></span><span data-slate-object="text" data-key="1907"><span data-slate-leaf="true" data-offset-key="1907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> KOBLST_MAX (64)</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1908"><span data-slate-object="text" data-key="1909"><span data-slate-leaf="true" data-offset-key="1909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1910"><span data-slate-object="text" data-key="1911"><span data-slate-leaf="true" data-offset-key="1911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1912"><span data-slate-leaf="true" data-offset-key="1912:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1913"><span data-slate-leaf="true" data-offset-key="1913:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1914"><span data-slate-leaf="true" data-offset-key="1914:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1915"><span data-slate-leaf="true" data-offset-key="1915:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_KOBLST</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1916"><span data-slate-object="text" data-key="1917"><span data-slate-leaf="true" data-offset-key="1917:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1918"><span data-slate-object="text" data-key="1919"><span data-slate-leaf="true" data-offset-key="1919:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1920"><span data-slate-leaf="true" data-offset-key="1920:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1921"><span data-slate-leaf="true" data-offset-key="1921:0" data-first-offset="true"><span data-slate-string="true"> ol_emplst; </span></span></span><span data-slate-object="text" data-key="1922"><span data-slate-leaf="true" data-offset-key="1922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载 kmsob_t 结构的链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1923"><span data-slate-object="text" data-key="1924"><span data-slate-leaf="true" data-offset-key="1924:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1925"><span data-slate-leaf="true" data-offset-key="1925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="1926"><span data-slate-leaf="true" data-offset-key="1926:0" data-first-offset="true"><span data-slate-string="true">* ol_cahe;   </span></span></span><span data-slate-object="text" data-key="1927"><span data-slate-leaf="true" data-offset-key="1927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 最近一次查找的 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1928"><span data-slate-object="text" data-key="1929"><span data-slate-leaf="true" data-offset-key="1929:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1930"><span data-slate-leaf="true" data-offset-key="1930:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1931"><span data-slate-leaf="true" data-offset-key="1931:0" data-first-offset="true"><span data-slate-string="true"> ol_emnr;     </span></span></span><span data-slate-object="text" data-key="1932"><span data-slate-leaf="true" data-offset-key="1932:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载 kmsob_t 结构的数量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1933"><span data-slate-object="text" data-key="1934"><span data-slate-leaf="true" data-offset-key="1934:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1935"><span data-slate-leaf="true" data-offset-key="1935:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="1936"><span data-slate-leaf="true" data-offset-key="1936:0" data-first-offset="true"><span data-slate-string="true"> ol_sz;       </span></span></span><span data-slate-object="text" data-key="1937"><span data-slate-leaf="true" data-offset-key="1937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//kmsob_t 结构中内存对象的大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1938"><span data-slate-object="text" data-key="1939"><span data-slate-leaf="true" data-offset-key="1939:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1940"><span data-slate-leaf="true" data-offset-key="1940:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="1941"><span data-slate-leaf="true" data-offset-key="1941:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1942"><span data-slate-object="text" data-key="1943"><span data-slate-leaf="true" data-offset-key="1943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 管理 kmsob_t 结构的数据结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1944"><span data-slate-object="text" data-key="1945"><span data-slate-leaf="true" data-offset-key="1945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="1946"><span data-slate-leaf="true" data-offset-key="1946:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1947"><span data-slate-leaf="true" data-offset-key="1947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="1948"><span data-slate-leaf="true" data-offset-key="1948:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="1949"><span data-slate-leaf="true" data-offset-key="1949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_KMSOBMGRHED</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1950"><span data-slate-object="text" data-key="1951"><span data-slate-leaf="true" data-offset-key="1951:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1952"><span data-slate-object="text" data-key="1953"><span data-slate-leaf="true" data-offset-key="1953:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1954"><span data-slate-leaf="true" data-offset-key="1954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="1955"><span data-slate-leaf="true" data-offset-key="1955:0" data-first-offset="true"><span data-slate-string="true"> ks_lock;  </span></span></span><span data-slate-object="text" data-key="1956"><span data-slate-leaf="true" data-offset-key="1956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 保护自身的自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1957"><span data-slate-object="text" data-key="1958"><span data-slate-leaf="true" data-offset-key="1958:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1959"><span data-slate-leaf="true" data-offset-key="1959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="1960"><span data-slate-leaf="true" data-offset-key="1960:0" data-first-offset="true"><span data-slate-string="true"> ks_tclst;   </span></span></span><span data-slate-object="text" data-key="1961"><span data-slate-leaf="true" data-offset-key="1961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1962"><span data-slate-object="text" data-key="1963"><span data-slate-leaf="true" data-offset-key="1963:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1964"><span data-slate-leaf="true" data-offset-key="1964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1965"><span data-slate-leaf="true" data-offset-key="1965:0" data-first-offset="true"><span data-slate-string="true"> ks_tcnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1966"><span data-slate-object="text" data-key="1967"><span data-slate-leaf="true" data-offset-key="1967:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1968"><span data-slate-leaf="true" data-offset-key="1968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="1969"><span data-slate-leaf="true" data-offset-key="1969:0" data-first-offset="true"><span data-slate-string="true"> ks_msobnr;    </span></span></span><span data-slate-object="text" data-key="1970"><span data-slate-leaf="true" data-offset-key="1970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 总共多少个 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1971"><span data-slate-object="text" data-key="1972"><span data-slate-leaf="true" data-offset-key="1972:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1973"><span data-slate-leaf="true" data-offset-key="1973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="1974"><span data-slate-leaf="true" data-offset-key="1974:0" data-first-offset="true"><span data-slate-string="true">* ks_msobche; </span></span></span><span data-slate-object="text" data-key="1975"><span data-slate-leaf="true" data-offset-key="1975:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 最近分配内存对象的 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1976"><span data-slate-object="text" data-key="1977"><span data-slate-leaf="true" data-offset-key="1977:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="1978"><span data-slate-leaf="true" data-offset-key="1978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="1979"><span data-slate-leaf="true" data-offset-key="1979:0" data-first-offset="true"><span data-slate-string="true"> ks_msoblst[KOBLST_MAX]; </span></span></span><span data-slate-object="text" data-key="1980"><span data-slate-leaf="true" data-offset-key="1980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//koblst_t 结构数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1981"><span data-slate-object="text" data-key="1982"><span data-slate-leaf="true" data-offset-key="1982:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="1983"><span data-slate-leaf="true" data-offset-key="1983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="1984"><span data-slate-leaf="true" data-offset-key="1984:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1985"><span data-slate-object="text" data-key="1986"><span data-slate-leaf="true" data-offset-key="1986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 koblst_t 结构体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1987"><span data-slate-object="text" data-key="1988"><span data-slate-leaf="true" data-offset-key="1988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="1989"><span data-slate-leaf="true" data-offset-key="1989:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="1990"><span data-slate-leaf="true" data-offset-key="1990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t_init</span></span></span></span></span><span data-slate-object="text" data-key="1991"><span data-slate-leaf="true" data-offset-key="1991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="1992"><span data-slate-leaf="true" data-offset-key="1992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="1993"><span data-slate-leaf="true" data-offset-key="1993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp, </span></span></span></span></span><span data-slate-object="text" data-key="1994"><span data-slate-leaf="true" data-offset-key="1994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="1995"><span data-slate-leaf="true" data-offset-key="1995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> koblsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1996"><span data-slate-object="text" data-key="1997"><span data-slate-leaf="true" data-offset-key="1997:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="1998"><span data-slate-object="text" data-key="1999"><span data-slate-leaf="true" data-offset-key="1999:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2000"><span data-slate-leaf="true" data-offset-key="2000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2001"><span data-slate-leaf="true" data-offset-key="2001:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;ol_emplst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2002"><span data-slate-object="text" data-key="2003"><span data-slate-leaf="true" data-offset-key="2003:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ol_cahe = </span></span></span><span data-slate-object="text" data-key="2004"><span data-slate-leaf="true" data-offset-key="2004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2005"><span data-slate-leaf="true" data-offset-key="2005:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2006"><span data-slate-object="text" data-key="2007"><span data-slate-leaf="true" data-offset-key="2007:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ol_emnr = </span></span></span><span data-slate-object="text" data-key="2008"><span data-slate-leaf="true" data-offset-key="2008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2009"><span data-slate-leaf="true" data-offset-key="2009:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2010"><span data-slate-object="text" data-key="2011"><span data-slate-leaf="true" data-offset-key="2011:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ol_sz = koblsz;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2012"><span data-slate-object="text" data-key="2013"><span data-slate-leaf="true" data-offset-key="2013:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2014"><span data-slate-leaf="true" data-offset-key="2014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2015"><span data-slate-leaf="true" data-offset-key="2015:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2016"><span data-slate-object="text" data-key="2017"><span data-slate-leaf="true" data-offset-key="2017:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2018"><span data-slate-object="text" data-key="2019"><span data-slate-leaf="true" data-offset-key="2019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmsobmgrhed_t 结构体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2020"><span data-slate-object="text" data-key="2021"><span data-slate-leaf="true" data-offset-key="2021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2022"><span data-slate-leaf="true" data-offset-key="2022:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2023"><span data-slate-leaf="true" data-offset-key="2023:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t_init</span></span></span></span></span><span data-slate-object="text" data-key="2024"><span data-slate-leaf="true" data-offset-key="2024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2025"><span data-slate-leaf="true" data-offset-key="2025:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2026"><span data-slate-leaf="true" data-offset-key="2026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2027"><span data-slate-object="text" data-key="2028"><span data-slate-leaf="true" data-offset-key="2028:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2029"><span data-slate-object="text" data-key="2030"><span data-slate-leaf="true" data-offset-key="2030:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2031"><span data-slate-leaf="true" data-offset-key="2031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="2032"><span data-slate-leaf="true" data-offset-key="2032:0" data-first-offset="true"><span data-slate-string="true"> koblsz = </span></span></span><span data-slate-object="text" data-key="2033"><span data-slate-leaf="true" data-offset-key="2033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">32</span></span></span></span><span data-slate-object="text" data-key="2034"><span data-slate-leaf="true" data-offset-key="2034:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2035"><span data-slate-object="text" data-key="2036"><span data-slate-leaf="true" data-offset-key="2036:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2037"><span data-slate-leaf="true" data-offset-key="2037:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="2038"><span data-slate-leaf="true" data-offset-key="2038:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;ks_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2039"><span data-slate-object="text" data-key="2040"><span data-slate-leaf="true" data-offset-key="2040:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2041"><span data-slate-leaf="true" data-offset-key="2041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2042"><span data-slate-leaf="true" data-offset-key="2042:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;ks_tclst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2043"><span data-slate-object="text" data-key="2044"><span data-slate-leaf="true" data-offset-key="2044:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ks_tcnr = </span></span></span><span data-slate-object="text" data-key="2045"><span data-slate-leaf="true" data-offset-key="2045:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2046"><span data-slate-leaf="true" data-offset-key="2046:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2047"><span data-slate-object="text" data-key="2048"><span data-slate-leaf="true" data-offset-key="2048:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ks_msobnr = </span></span></span><span data-slate-object="text" data-key="2049"><span data-slate-leaf="true" data-offset-key="2049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2050"><span data-slate-leaf="true" data-offset-key="2050:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2051"><span data-slate-object="text" data-key="2052"><span data-slate-leaf="true" data-offset-key="2052:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;ks_msobche = </span></span></span><span data-slate-object="text" data-key="2053"><span data-slate-leaf="true" data-offset-key="2053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2054"><span data-slate-leaf="true" data-offset-key="2054:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2055"><span data-slate-object="text" data-key="2056"><span data-slate-leaf="true" data-offset-key="2056:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2057"><span data-slate-leaf="true" data-offset-key="2057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="2058"><span data-slate-leaf="true" data-offset-key="2058:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2059"><span data-slate-leaf="true" data-offset-key="2059:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2060"><span data-slate-leaf="true" data-offset-key="2060:0" data-first-offset="true"><span data-slate-string="true"> i = </span></span></span><span data-slate-object="text" data-key="2061"><span data-slate-leaf="true" data-offset-key="2061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2062"><span data-slate-leaf="true" data-offset-key="2062:0" data-first-offset="true"><span data-slate-string="true">; i &lt;KOBLST_MAX; i++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2063"><span data-slate-object="text" data-key="2064"><span data-slate-leaf="true" data-offset-key="2064:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2065"><span data-slate-object="text" data-key="2066"><span data-slate-leaf="true" data-offset-key="2066:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2067"><span data-slate-leaf="true" data-offset-key="2067:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t_init</span></span></span></span><span data-slate-object="text" data-key="2068"><span data-slate-leaf="true" data-offset-key="2068:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;ks_msoblst[i], koblsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2069"><span data-slate-object="text" data-key="2070"><span data-slate-leaf="true" data-offset-key="2070:0" data-first-offset="true"><span data-slate-string="true">        koblsz += </span></span></span><span data-slate-object="text" data-key="2071"><span data-slate-leaf="true" data-offset-key="2071:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">32</span></span></span></span><span data-slate-object="text" data-key="2072"><span data-slate-leaf="true" data-offset-key="2072:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="2073"><span data-slate-leaf="true" data-offset-key="2073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 这里并不是按照开始的图形分类的而是每次增加 32 字节，所以是 32，64,96,128,160,192,224，256，.......</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2074"><span data-slate-object="text" data-key="2075"><span data-slate-leaf="true" data-offset-key="2075:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2076"><span data-slate-object="text" data-key="2077"><span data-slate-leaf="true" data-offset-key="2077:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2078"><span data-slate-leaf="true" data-offset-key="2078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2079"><span data-slate-leaf="true" data-offset-key="2079:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2080"><span data-slate-object="text" data-key="2081"><span data-slate-leaf="true" data-offset-key="2081:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2082"><span data-slate-object="text" data-key="2083"><span data-slate-leaf="true" data-offset-key="2083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmsob</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2084"><span data-slate-object="text" data-key="2085"><span data-slate-leaf="true" data-offset-key="2085:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2086"><span data-slate-leaf="true" data-offset-key="2086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2087"><span data-slate-leaf="true" data-offset-key="2087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_kmsob</span></span></span></span></span><span data-slate-object="text" data-key="2088"><span data-slate-leaf="true" data-offset-key="2088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2089"><span data-slate-object="text" data-key="2090"><span data-slate-leaf="true" data-offset-key="2090:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2091"><span data-slate-object="text" data-key="2092"><span data-slate-leaf="true" data-offset-key="2092:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2093"><span data-slate-leaf="true" data-offset-key="2093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t_init</span></span></span></span><span data-slate-object="text" data-key="2094"><span data-slate-leaf="true" data-offset-key="2094:0" data-first-offset="true"><span data-slate-string="true">(&amp;memmgrob.mo_kmsobmgr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2095"><span data-slate-object="text" data-key="2096"><span data-slate-leaf="true" data-offset-key="2096:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2097"><span data-slate-leaf="true" data-offset-key="2097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2098"><span data-slate-leaf="true" data-offset-key="2098:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2099"><span data-slate-object="text" data-key="2100"><span data-slate-leaf="true" data-offset-key="2100:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2101"><span data-slate-object="text" data-key="2102"><span data-slate-leaf="true" data-offset-key="2102:0" data-first-offset="true"><span data-slate-string="true">上面的代码注释已经很清楚了，就是 init_kmsob 函数调用 kmsobmgrhed_t_init 函数，在其中循环初始化 koblst_t 结构体数组，不多做解释。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2103"><span data-slate-object="text" data-key="2104"><span data-slate-leaf="true" data-offset-key="2104:0" data-first-offset="true"><span data-slate-string="true">但是有一点我们要搞清楚：</span></span></span><span data-slate-object="text" data-key="2105"><span data-slate-leaf="true" data-offset-key="2105:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t 结构的实例变量是放在哪里的，它其实放在我们之前的 memmgrob_t 结构中了</span></span></span></span><span data-slate-object="text" data-key="2106"><span data-slate-leaf="true" data-offset-key="2106:0" data-first-offset="true"><span data-slate-string="true">，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="2107"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2108"><span data-slate-object="text" data-key="2109"><span data-slate-leaf="true" data-offset-key="2109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//cosmos/include/halinc/halglobal.c</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2110"><span data-slate-object="text" data-key="2111"><span data-slate-leaf="true" data-offset-key="2111:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">HAL_DEFGLOB_VARIABLE</span></span></span></span><span data-slate-object="text" data-key="2112"><span data-slate-leaf="true" data-offset-key="2112:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2113"><span data-slate-leaf="true" data-offset-key="2113:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memmgrob_t</span></span></span></span><span data-slate-object="text" data-key="2114"><span data-slate-leaf="true" data-offset-key="2114:0" data-first-offset="true"><span data-slate-string="true">,memmgrob);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2115"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2116"><span data-slate-object="text" data-key="2117"><span data-slate-leaf="true" data-offset-key="2117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">typedef</span></span></span></span><span data-slate-object="text" data-key="2118"><span data-slate-leaf="true" data-offset-key="2118:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2119"><span data-slate-leaf="true" data-offset-key="2119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="2120"><span data-slate-leaf="true" data-offset-key="2120:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2121"><span data-slate-leaf="true" data-offset-key="2121:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_MEMMGROB</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2122"><span data-slate-object="text" data-key="2123"><span data-slate-leaf="true" data-offset-key="2123:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2124"><span data-slate-object="text" data-key="2125"><span data-slate-leaf="true" data-offset-key="2125:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2126"><span data-slate-leaf="true" data-offset-key="2126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="2127"><span data-slate-leaf="true" data-offset-key="2127:0" data-first-offset="true"><span data-slate-string="true"> mo_list;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2128"><span data-slate-object="text" data-key="2129"><span data-slate-leaf="true" data-offset-key="2129:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2130"><span data-slate-leaf="true" data-offset-key="2130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spinlock_t</span></span></span></span><span data-slate-object="text" data-key="2131"><span data-slate-leaf="true" data-offset-key="2131:0" data-first-offset="true"><span data-slate-string="true"> mo_lock;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2132"><span data-slate-object="text" data-key="2133"><span data-slate-leaf="true" data-offset-key="2133:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2134"><span data-slate-leaf="true" data-offset-key="2134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2135"><span data-slate-leaf="true" data-offset-key="2135:0" data-first-offset="true"><span data-slate-string="true"> mo_stus;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2136"><span data-slate-object="text" data-key="2137"><span data-slate-leaf="true" data-offset-key="2137:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2138"><span data-slate-leaf="true" data-offset-key="2138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2139"><span data-slate-leaf="true" data-offset-key="2139:0" data-first-offset="true"><span data-slate-string="true"> mo_flgs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2140"><span data-slate-object="text" data-key="2141"><span data-slate-leaf="true" data-offset-key="2141:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2142"><span data-slate-leaf="true" data-offset-key="2142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 略去很多字段</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2143"><span data-slate-object="text" data-key="2144"><span data-slate-leaf="true" data-offset-key="2144:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2145"><span data-slate-leaf="true" data-offset-key="2145:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 管理 kmsob_t 结构的数据结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2146"><span data-slate-object="text" data-key="2147"><span data-slate-leaf="true" data-offset-key="2147:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2148"><span data-slate-leaf="true" data-offset-key="2148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="2149"><span data-slate-leaf="true" data-offset-key="2149:0" data-first-offset="true"><span data-slate-string="true"> mo_kmsobmgr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2150"><span data-slate-object="text" data-key="2151"><span data-slate-leaf="true" data-offset-key="2151:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2152"><span data-slate-leaf="true" data-offset-key="2152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2153"><span data-slate-leaf="true" data-offset-key="2153:0" data-first-offset="true"><span data-slate-string="true">* mo_privp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2154"><span data-slate-object="text" data-key="2155"><span data-slate-leaf="true" data-offset-key="2155:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2156"><span data-slate-leaf="true" data-offset-key="2156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2157"><span data-slate-leaf="true" data-offset-key="2157:0" data-first-offset="true"><span data-slate-string="true">* mo_extp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2158"><span data-slate-object="text" data-key="2159"><span data-slate-leaf="true" data-offset-key="2159:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span><span data-slate-object="text" data-key="2160"><span data-slate-leaf="true" data-offset-key="2160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memmgrob_t</span></span></span></span><span data-slate-object="text" data-key="2161"><span data-slate-leaf="true" data-offset-key="2161:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2162"><span data-slate-object="text" data-key="2163"><span data-slate-leaf="true" data-offset-key="2163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//cosmos/hal/x86/memmgrinit.c</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2164"><span data-slate-object="text" data-key="2165"><span data-slate-leaf="true" data-offset-key="2165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2166"><span data-slate-leaf="true" data-offset-key="2166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2167"><span data-slate-leaf="true" data-offset-key="2167:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgr</span></span></span></span></span><span data-slate-object="text" data-key="2168"><span data-slate-leaf="true" data-offset-key="2168:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2169"><span data-slate-object="text" data-key="2170"><span data-slate-leaf="true" data-offset-key="2170:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2171"><span data-slate-object="text" data-key="2172"><span data-slate-leaf="true" data-offset-key="2172:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2173"><span data-slate-leaf="true" data-offset-key="2173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存页结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2174"><span data-slate-object="text" data-key="2175"><span data-slate-leaf="true" data-offset-key="2175:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2176"><span data-slate-leaf="true" data-offset-key="2176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_msadsc</span></span></span></span><span data-slate-object="text" data-key="2177"><span data-slate-leaf="true" data-offset-key="2177:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2178"><span data-slate-object="text" data-key="2179"><span data-slate-leaf="true" data-offset-key="2179:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2180"><span data-slate-leaf="true" data-offset-key="2180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存区结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2181"><span data-slate-object="text" data-key="2182"><span data-slate-leaf="true" data-offset-key="2182:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2183"><span data-slate-leaf="true" data-offset-key="2183:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memarea</span></span></span></span><span data-slate-object="text" data-key="2184"><span data-slate-leaf="true" data-offset-key="2184:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2185"><span data-slate-object="text" data-key="2186"><span data-slate-leaf="true" data-offset-key="2186:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2187"><span data-slate-leaf="true" data-offset-key="2187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 处理内存占用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2188"><span data-slate-object="text" data-key="2189"><span data-slate-leaf="true" data-offset-key="2189:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2190"><span data-slate-leaf="true" data-offset-key="2190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_search_krloccupymm</span></span></span></span><span data-slate-object="text" data-key="2191"><span data-slate-leaf="true" data-offset-key="2191:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmachbsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2192"><span data-slate-object="text" data-key="2193"><span data-slate-leaf="true" data-offset-key="2193:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2194"><span data-slate-leaf="true" data-offset-key="2194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 合并内存页到内存区中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2195"><span data-slate-object="text" data-key="2196"><span data-slate-leaf="true" data-offset-key="2196:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2197"><span data-slate-leaf="true" data-offset-key="2197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgrob</span></span></span></span><span data-slate-object="text" data-key="2198"><span data-slate-leaf="true" data-offset-key="2198:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2199"><span data-slate-object="text" data-key="2200"><span data-slate-leaf="true" data-offset-key="2200:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2201"><span data-slate-leaf="true" data-offset-key="2201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmsob</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2202"><span data-slate-object="text" data-key="2203"><span data-slate-leaf="true" data-offset-key="2203:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2204"><span data-slate-leaf="true" data-offset-key="2204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_kmsob</span></span></span></span><span data-slate-object="text" data-key="2205"><span data-slate-leaf="true" data-offset-key="2205:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2206"><span data-slate-object="text" data-key="2207"><span data-slate-leaf="true" data-offset-key="2207:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2208"><span data-slate-leaf="true" data-offset-key="2208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2209"><span data-slate-leaf="true" data-offset-key="2209:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2210"><span data-slate-object="text" data-key="2211"><span data-slate-leaf="true" data-offset-key="2211:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2212"><span data-slate-object="text" data-key="2213"><span data-slate-leaf="true" data-offset-key="2213:0" data-first-offset="true"><span data-slate-string="true">这并没有那么难，是不是？到这里，我们在内存管理初始化 init_memmgr 函数中调用了 init_kmsob 函数，对管理内存对象容器的结构进行了初始化，这样后面我们就能分配内存对象了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2214" id="sr-toc-6"><span data-slate-object="text" data-key="2215"><span data-slate-leaf="true" data-offset-key="2215:0" data-first-offset="true"><span data-slate-string="true">分配内存对象</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2216"><span data-slate-object="text" data-key="2217"><span data-slate-leaf="true" data-offset-key="2217:0" data-first-offset="true"><span data-slate-string="true">根据前面的初始化过程，我们只是初始化了 kmsobmgrhed_t 结构，却没初始化任何 kmsob_t 结构，而这个结构就是存放内存对象的容器，没有它是不能进行任何分配内存对象的操作的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2218"><span data-slate-object="text" data-key="2219"><span data-slate-leaf="true" data-offset-key="2219:0" data-first-offset="true"><span data-slate-string="true">下面我们一起在分配内存对象的过程中探索，应该如何查找、建立 kmsob_t 结构，然后在 kmsob_t 结构中建立 freobjh_t 结构，最后在内存对象容器的容量不足时，一起来扩展容器的内存。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2220" id="sr-toc-7"><span data-slate-object="text" data-key="2221"><span data-slate-leaf="true" data-offset-key="2221:0" data-first-offset="true"><span data-slate-string="true">分配内存对象的接口</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2222"><span data-slate-object="text" data-key="2223"><span data-slate-leaf="true" data-offset-key="2223:0" data-first-offset="true"><span data-slate-string="true">分配内存对象的流程，仍然要从分配接口开始。分配内存对象的接口很简单，只有一个内存对象大小的参数，然后返回内存对象的首地址。下面我们先在 kmsob.c 文件中写好这个函数，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="2224"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2225"><span data-slate-object="text" data-key="2226"><span data-slate-leaf="true" data-offset-key="2226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 分配内存对象的核心函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2227"><span data-slate-object="text" data-key="2228"><span data-slate-leaf="true" data-offset-key="2228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2229"><span data-slate-leaf="true" data-offset-key="2229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="2230"><span data-slate-leaf="true" data-offset-key="2230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_core</span></span></span></span></span><span data-slate-object="text" data-key="2231"><span data-slate-leaf="true" data-offset-key="2231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2232"><span data-slate-leaf="true" data-offset-key="2232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2233"><span data-slate-leaf="true" data-offset-key="2233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2234"><span data-slate-object="text" data-key="2235"><span data-slate-leaf="true" data-offset-key="2235:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2236"><span data-slate-object="text" data-key="2237"><span data-slate-leaf="true" data-offset-key="2237:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2238"><span data-slate-leaf="true" data-offset-key="2238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 kmsobmgrhed_t 结构的地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2239"><span data-slate-object="text" data-key="2240"><span data-slate-leaf="true" data-offset-key="2240:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2241"><span data-slate-leaf="true" data-offset-key="2241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="2242"><span data-slate-leaf="true" data-offset-key="2242:0" data-first-offset="true"><span data-slate-string="true"> *kmobmgrp = &amp;memmgrob.mo_kmsobmgr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2243"><span data-slate-object="text" data-key="2244"><span data-slate-leaf="true" data-offset-key="2244:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2245"><span data-slate-leaf="true" data-offset-key="2245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2246"><span data-slate-leaf="true" data-offset-key="2246:0" data-first-offset="true"><span data-slate-string="true"> *retptr = </span></span></span><span data-slate-object="text" data-key="2247"><span data-slate-leaf="true" data-offset-key="2247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2248"><span data-slate-leaf="true" data-offset-key="2248:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2249"><span data-slate-object="text" data-key="2250"><span data-slate-leaf="true" data-offset-key="2250:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2251"><span data-slate-leaf="true" data-offset-key="2251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="2252"><span data-slate-leaf="true" data-offset-key="2252:0" data-first-offset="true"><span data-slate-string="true"> *koblp = </span></span></span><span data-slate-object="text" data-key="2253"><span data-slate-leaf="true" data-offset-key="2253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2254"><span data-slate-leaf="true" data-offset-key="2254:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2255"><span data-slate-object="text" data-key="2256"><span data-slate-leaf="true" data-offset-key="2256:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2257"><span data-slate-leaf="true" data-offset-key="2257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2258"><span data-slate-leaf="true" data-offset-key="2258:0" data-first-offset="true"><span data-slate-string="true"> *kmsp = </span></span></span><span data-slate-object="text" data-key="2259"><span data-slate-leaf="true" data-offset-key="2259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2260"><span data-slate-leaf="true" data-offset-key="2260:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2261"><span data-slate-object="text" data-key="2262"><span data-slate-leaf="true" data-offset-key="2262:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2263"><span data-slate-leaf="true" data-offset-key="2263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cpuflg_t</span></span></span></span><span data-slate-object="text" data-key="2264"><span data-slate-leaf="true" data-offset-key="2264:0" data-first-offset="true"><span data-slate-string="true"> cpuflg;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2265"><span data-slate-object="text" data-key="2266"><span data-slate-leaf="true" data-offset-key="2266:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2267"><span data-slate-leaf="true" data-offset-key="2267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对 kmsobmgrhed_t 结构加锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2268"><span data-slate-object="text" data-key="2269"><span data-slate-leaf="true" data-offset-key="2269:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2270"><span data-slate-leaf="true" data-offset-key="2270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_cli</span></span></span></span><span data-slate-object="text" data-key="2271"><span data-slate-leaf="true" data-offset-key="2271:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmobmgrp-&gt;ks_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2272"><span data-slate-object="text" data-key="2273"><span data-slate-leaf="true" data-offset-key="2273:0" data-first-offset="true"><span data-slate-string="true">    koblp = </span></span></span><span data-slate-object="text" data-key="2274"><span data-slate-leaf="true" data-offset-key="2274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onmsz_retn_koblst</span></span></span></span><span data-slate-object="text" data-key="2275"><span data-slate-leaf="true" data-offset-key="2275:0" data-first-offset="true"><span data-slate-string="true">(kmobmgrp, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2276"><span data-slate-object="text" data-key="2277"><span data-slate-leaf="true" data-offset-key="2277:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2278"><span data-slate-leaf="true" data-offset-key="2278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2279"><span data-slate-leaf="true" data-offset-key="2279:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2280"><span data-slate-leaf="true" data-offset-key="2280:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2281"><span data-slate-leaf="true" data-offset-key="2281:0" data-first-offset="true"><span data-slate-string="true"> == koblp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2282"><span data-slate-object="text" data-key="2283"><span data-slate-leaf="true" data-offset-key="2283:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2284"><span data-slate-object="text" data-key="2285"><span data-slate-leaf="true" data-offset-key="2285:0" data-first-offset="true"><span data-slate-string="true">        retptr = </span></span></span><span data-slate-object="text" data-key="2286"><span data-slate-leaf="true" data-offset-key="2286:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2287"><span data-slate-leaf="true" data-offset-key="2287:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2288"><span data-slate-object="text" data-key="2289"><span data-slate-leaf="true" data-offset-key="2289:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2290"><span data-slate-leaf="true" data-offset-key="2290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="2291"><span data-slate-leaf="true" data-offset-key="2291:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2292"><span data-slate-object="text" data-key="2293"><span data-slate-leaf="true" data-offset-key="2293:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2294"><span data-slate-object="text" data-key="2295"><span data-slate-leaf="true" data-offset-key="2295:0" data-first-offset="true"><span data-slate-string="true">    kmsp = </span></span></span><span data-slate-object="text" data-key="2296"><span data-slate-leaf="true" data-offset-key="2296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onkoblst_retn_newkmsob</span></span></span></span><span data-slate-object="text" data-key="2297"><span data-slate-leaf="true" data-offset-key="2297:0" data-first-offset="true"><span data-slate-string="true">(koblp, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2298"><span data-slate-object="text" data-key="2299"><span data-slate-leaf="true" data-offset-key="2299:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2300"><span data-slate-leaf="true" data-offset-key="2300:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2301"><span data-slate-leaf="true" data-offset-key="2301:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2302"><span data-slate-leaf="true" data-offset-key="2302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2303"><span data-slate-leaf="true" data-offset-key="2303:0" data-first-offset="true"><span data-slate-string="true"> == kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2304"><span data-slate-object="text" data-key="2305"><span data-slate-leaf="true" data-offset-key="2305:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2306"><span data-slate-object="text" data-key="2307"><span data-slate-leaf="true" data-offset-key="2307:0" data-first-offset="true"><span data-slate-string="true">        kmsp = _create_kmsob(kmobmgrp, koblp, koblp-&gt;ol_sz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2308"><span data-slate-object="text" data-key="2309"><span data-slate-leaf="true" data-offset-key="2309:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2310"><span data-slate-leaf="true" data-offset-key="2310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2311"><span data-slate-leaf="true" data-offset-key="2311:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2312"><span data-slate-leaf="true" data-offset-key="2312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2313"><span data-slate-leaf="true" data-offset-key="2313:0" data-first-offset="true"><span data-slate-string="true"> == kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2314"><span data-slate-object="text" data-key="2315"><span data-slate-leaf="true" data-offset-key="2315:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2316"><span data-slate-object="text" data-key="2317"><span data-slate-leaf="true" data-offset-key="2317:0" data-first-offset="true"><span data-slate-string="true">            retptr = </span></span></span><span data-slate-object="text" data-key="2318"><span data-slate-leaf="true" data-offset-key="2318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2319"><span data-slate-leaf="true" data-offset-key="2319:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2320"><span data-slate-object="text" data-key="2321"><span data-slate-leaf="true" data-offset-key="2321:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2322"><span data-slate-leaf="true" data-offset-key="2322:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="2323"><span data-slate-leaf="true" data-offset-key="2323:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2324"><span data-slate-object="text" data-key="2325"><span data-slate-leaf="true" data-offset-key="2325:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2326"><span data-slate-object="text" data-key="2327"><span data-slate-leaf="true" data-offset-key="2327:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2328"><span data-slate-object="text" data-key="2329"><span data-slate-leaf="true" data-offset-key="2329:0" data-first-offset="true"><span data-slate-string="true">    retptr = </span></span></span><span data-slate-object="text" data-key="2330"><span data-slate-leaf="true" data-offset-key="2330:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_onkmsob</span></span></span></span><span data-slate-object="text" data-key="2331"><span data-slate-leaf="true" data-offset-key="2331:0" data-first-offset="true"><span data-slate-string="true">(kmsp, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2332"><span data-slate-object="text" data-key="2333"><span data-slate-leaf="true" data-offset-key="2333:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2334"><span data-slate-leaf="true" data-offset-key="2334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2335"><span data-slate-leaf="true" data-offset-key="2335:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2336"><span data-slate-leaf="true" data-offset-key="2336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2337"><span data-slate-leaf="true" data-offset-key="2337:0" data-first-offset="true"><span data-slate-string="true"> == retptr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2338"><span data-slate-object="text" data-key="2339"><span data-slate-leaf="true" data-offset-key="2339:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2340"><span data-slate-object="text" data-key="2341"><span data-slate-leaf="true" data-offset-key="2341:0" data-first-offset="true"><span data-slate-string="true">        retptr = </span></span></span><span data-slate-object="text" data-key="2342"><span data-slate-leaf="true" data-offset-key="2342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2343"><span data-slate-leaf="true" data-offset-key="2343:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2344"><span data-slate-object="text" data-key="2345"><span data-slate-leaf="true" data-offset-key="2345:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2346"><span data-slate-leaf="true" data-offset-key="2346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="2347"><span data-slate-leaf="true" data-offset-key="2347:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2348"><span data-slate-object="text" data-key="2349"><span data-slate-leaf="true" data-offset-key="2349:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2350"><span data-slate-object="text" data-key="2351"><span data-slate-leaf="true" data-offset-key="2351:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2352"><span data-slate-leaf="true" data-offset-key="2352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 更新 kmsobmgrhed_t 结构的信息</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2353"><span data-slate-object="text" data-key="2354"><span data-slate-leaf="true" data-offset-key="2354:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2355"><span data-slate-leaf="true" data-offset-key="2355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_updata_cache</span></span></span></span><span data-slate-object="text" data-key="2356"><span data-slate-leaf="true" data-offset-key="2356:0" data-first-offset="true"><span data-slate-string="true">(kmobmgrp, koblp, kmsp, KUC_NEWFLG);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2357"><span data-slate-object="text" data-key="2358"><span data-slate-leaf="true" data-offset-key="2358:0" data-first-offset="true"><span data-slate-string="true">ret_step:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2359"><span data-slate-object="text" data-key="2360"><span data-slate-leaf="true" data-offset-key="2360:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2361"><span data-slate-leaf="true" data-offset-key="2361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 解锁 kmsobmgrhed_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2362"><span data-slate-object="text" data-key="2363"><span data-slate-leaf="true" data-offset-key="2363:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2364"><span data-slate-leaf="true" data-offset-key="2364:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinunlock_sti</span></span></span></span><span data-slate-object="text" data-key="2365"><span data-slate-leaf="true" data-offset-key="2365:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmobmgrp-&gt;ks_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2366"><span data-slate-object="text" data-key="2367"><span data-slate-leaf="true" data-offset-key="2367:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2368"><span data-slate-leaf="true" data-offset-key="2368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2369"><span data-slate-leaf="true" data-offset-key="2369:0" data-first-offset="true"><span data-slate-string="true"> retptr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2370"><span data-slate-object="text" data-key="2371"><span data-slate-leaf="true" data-offset-key="2371:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2372"><span data-slate-object="text" data-key="2373"><span data-slate-leaf="true" data-offset-key="2373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存对象分配接口</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2374"><span data-slate-object="text" data-key="2375"><span data-slate-leaf="true" data-offset-key="2375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2376"><span data-slate-leaf="true" data-offset-key="2376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="2377"><span data-slate-leaf="true" data-offset-key="2377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new</span></span></span></span></span><span data-slate-object="text" data-key="2378"><span data-slate-leaf="true" data-offset-key="2378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2379"><span data-slate-leaf="true" data-offset-key="2379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2380"><span data-slate-leaf="true" data-offset-key="2380:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2381"><span data-slate-object="text" data-key="2382"><span data-slate-leaf="true" data-offset-key="2382:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2383"><span data-slate-object="text" data-key="2384"><span data-slate-leaf="true" data-offset-key="2384:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2385"><span data-slate-leaf="true" data-offset-key="2385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对于小于 1 或者 大于 2048 字节的大小不支持 直接返回 NULL 表示失败</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2386"><span data-slate-object="text" data-key="2387"><span data-slate-leaf="true" data-offset-key="2387:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2388"><span data-slate-leaf="true" data-offset-key="2388:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2389"><span data-slate-leaf="true" data-offset-key="2389:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2390"><span data-slate-leaf="true" data-offset-key="2390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2391"><span data-slate-leaf="true" data-offset-key="2391:0" data-first-offset="true"><span data-slate-string="true"> &gt; msz || </span></span></span><span data-slate-object="text" data-key="2392"><span data-slate-leaf="true" data-offset-key="2392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2048</span></span></span></span><span data-slate-object="text" data-key="2393"><span data-slate-leaf="true" data-offset-key="2393:0" data-first-offset="true"><span data-slate-string="true"> &lt;msz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2394"><span data-slate-object="text" data-key="2395"><span data-slate-leaf="true" data-offset-key="2395:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2396"><span data-slate-object="text" data-key="2397"><span data-slate-leaf="true" data-offset-key="2397:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2398"><span data-slate-leaf="true" data-offset-key="2398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2399"><span data-slate-leaf="true" data-offset-key="2399:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2400"><span data-slate-leaf="true" data-offset-key="2400:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2401"><span data-slate-leaf="true" data-offset-key="2401:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2402"><span data-slate-object="text" data-key="2403"><span data-slate-leaf="true" data-offset-key="2403:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2404"><span data-slate-object="text" data-key="2405"><span data-slate-leaf="true" data-offset-key="2405:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2406"><span data-slate-leaf="true" data-offset-key="2406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 调用核心函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2407"><span data-slate-object="text" data-key="2408"><span data-slate-leaf="true" data-offset-key="2408:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2409"><span data-slate-leaf="true" data-offset-key="2409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2410"><span data-slate-leaf="true" data-offset-key="2410:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2411"><span data-slate-leaf="true" data-offset-key="2411:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_core</span></span></span></span><span data-slate-object="text" data-key="2412"><span data-slate-leaf="true" data-offset-key="2412:0" data-first-offset="true"><span data-slate-string="true">(msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2413"><span data-slate-object="text" data-key="2414"><span data-slate-leaf="true" data-offset-key="2414:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2415"><span data-slate-object="text" data-key="2416"><span data-slate-leaf="true" data-offset-key="2416:0" data-first-offset="true"><span data-slate-string="true">上面代码中，内存对象分配接口很简单，只是对分配内存对象的大小进行检查，然后调用分配内存对象的核心函数，在这个核心函数中，就是围绕我们之前定义的几个数据结构，去进行一系列操作了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2417"><span data-slate-object="text" data-key="2418"><span data-slate-leaf="true" data-offset-key="2418:0" data-first-offset="true"><span data-slate-string="true">但是究竟做了哪些操作呢，别急，我们继续往下看。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2419" id="sr-toc-8"><span data-slate-object="text" data-key="2420"><span data-slate-leaf="true" data-offset-key="2420:0" data-first-offset="true"><span data-slate-string="true">查找内存对象容器</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2421"><span data-slate-object="text" data-key="2422"><span data-slate-leaf="true" data-offset-key="2422:0" data-first-offset="true"><span data-slate-string="true">根据前面的设计，我们已经知道内存对象是放在内存对象容器中的，所以要分配内存对象，必须要先根据要分配的内存对象大小，找到内存对象容器。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2423"><span data-slate-object="text" data-key="2424"><span data-slate-leaf="true" data-offset-key="2424:0" data-first-offset="true"><span data-slate-string="true">同时，我们还知道，内存对象容器数据结构 kmsob_t 就挂载在 kmsobmgrhed_t 数据结构中的 ks_msoblst 数组中，所以我们要遍历 ks_msoblst 数组，我们来写一个 onmsz_retn_koblst 函数，它返回 ks_msoblst 数组元素的指针，表示先根据内存对象的大小找到挂载 kmsob_t 结构对应的 koblst_t 结构。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="2425"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2426"><span data-slate-object="text" data-key="2427"><span data-slate-leaf="true" data-offset-key="2427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 看看内存对象容器是不是合乎要求</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2428"><span data-slate-object="text" data-key="2429"><span data-slate-leaf="true" data-offset-key="2429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span><span data-slate-object="text" data-key="2430"><span data-slate-leaf="true" data-offset-key="2430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="2431"><span data-slate-leaf="true" data-offset-key="2431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_newkmsob_isok</span></span></span></span></span><span data-slate-object="text" data-key="2432"><span data-slate-leaf="true" data-offset-key="2432:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2433"><span data-slate-leaf="true" data-offset-key="2433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2434"><span data-slate-leaf="true" data-offset-key="2434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="2435"><span data-slate-leaf="true" data-offset-key="2435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2436"><span data-slate-leaf="true" data-offset-key="2436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2437"><span data-slate-object="text" data-key="2438"><span data-slate-leaf="true" data-offset-key="2438:0" data-first-offset="true"><span data-slate-string="true">{    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2439"><span data-slate-object="text" data-key="2440"><span data-slate-leaf="true" data-offset-key="2440:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2441"><span data-slate-leaf="true" data-offset-key="2441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 只要内存对象大小小于等于内存对象容器的对象大小就行</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2442"><span data-slate-object="text" data-key="2443"><span data-slate-leaf="true" data-offset-key="2443:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2444"><span data-slate-leaf="true" data-offset-key="2444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2445"><span data-slate-leaf="true" data-offset-key="2445:0" data-first-offset="true"><span data-slate-string="true"> (msz &lt;= kmsp-&gt;so_objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2446"><span data-slate-object="text" data-key="2447"><span data-slate-leaf="true" data-offset-key="2447:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2448"><span data-slate-object="text" data-key="2449"><span data-slate-leaf="true" data-offset-key="2449:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2450"><span data-slate-leaf="true" data-offset-key="2450:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2451"><span data-slate-leaf="true" data-offset-key="2451:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2452"><span data-slate-object="text" data-key="2453"><span data-slate-leaf="true" data-offset-key="2453:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2454"><span data-slate-object="text" data-key="2455"><span data-slate-leaf="true" data-offset-key="2455:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2456"><span data-slate-leaf="true" data-offset-key="2456:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2457"><span data-slate-leaf="true" data-offset-key="2457:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2458"><span data-slate-leaf="true" data-offset-key="2458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2459"><span data-slate-leaf="true" data-offset-key="2459:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2460"><span data-slate-object="text" data-key="2461"><span data-slate-leaf="true" data-offset-key="2461:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2462"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2463"><span data-slate-object="text" data-key="2464"><span data-slate-leaf="true" data-offset-key="2464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span></span><span data-slate-object="text" data-key="2465"><span data-slate-leaf="true" data-offset-key="2465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="2466"><span data-slate-leaf="true" data-offset-key="2466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onmsz_retn_koblst</span></span></span></span></span><span data-slate-object="text" data-key="2467"><span data-slate-leaf="true" data-offset-key="2467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2468"><span data-slate-leaf="true" data-offset-key="2468:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2469"><span data-slate-leaf="true" data-offset-key="2469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmmgrhlokp, </span></span></span></span></span><span data-slate-object="text" data-key="2470"><span data-slate-leaf="true" data-offset-key="2470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2471"><span data-slate-leaf="true" data-offset-key="2471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2472"><span data-slate-object="text" data-key="2473"><span data-slate-leaf="true" data-offset-key="2473:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2474"><span data-slate-object="text" data-key="2475"><span data-slate-leaf="true" data-offset-key="2475:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2476"><span data-slate-leaf="true" data-offset-key="2476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历 ks_msoblst 数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2477"><span data-slate-object="text" data-key="2478"><span data-slate-leaf="true" data-offset-key="2478:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2479"><span data-slate-leaf="true" data-offset-key="2479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="2480"><span data-slate-leaf="true" data-offset-key="2480:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2481"><span data-slate-leaf="true" data-offset-key="2481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2482"><span data-slate-leaf="true" data-offset-key="2482:0" data-first-offset="true"><span data-slate-string="true"> kli = </span></span></span><span data-slate-object="text" data-key="2483"><span data-slate-leaf="true" data-offset-key="2483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2484"><span data-slate-leaf="true" data-offset-key="2484:0" data-first-offset="true"><span data-slate-string="true">; kli &lt;KOBLST_MAX; kli++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2485"><span data-slate-object="text" data-key="2486"><span data-slate-leaf="true" data-offset-key="2486:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2487"><span data-slate-object="text" data-key="2488"><span data-slate-leaf="true" data-offset-key="2488:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2489"><span data-slate-leaf="true" data-offset-key="2489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 只要大小合适就返回       </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2490"><span data-slate-object="text" data-key="2491"><span data-slate-leaf="true" data-offset-key="2491:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2492"><span data-slate-leaf="true" data-offset-key="2492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2493"><span data-slate-leaf="true" data-offset-key="2493:0" data-first-offset="true"><span data-slate-string="true"> (kmmgrhlokp-&gt;ks_msoblst[kli].ol_sz &gt;= msz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2494"><span data-slate-object="text" data-key="2495"><span data-slate-leaf="true" data-offset-key="2495:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2496"><span data-slate-object="text" data-key="2497"><span data-slate-leaf="true" data-offset-key="2497:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2498"><span data-slate-leaf="true" data-offset-key="2498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2499"><span data-slate-leaf="true" data-offset-key="2499:0" data-first-offset="true"><span data-slate-string="true"> &amp;kmmgrhlokp-&gt;ks_msoblst[kli];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2500"><span data-slate-object="text" data-key="2501"><span data-slate-leaf="true" data-offset-key="2501:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2502"><span data-slate-object="text" data-key="2503"><span data-slate-leaf="true" data-offset-key="2503:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2504"><span data-slate-object="text" data-key="2505"><span data-slate-leaf="true" data-offset-key="2505:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2506"><span data-slate-leaf="true" data-offset-key="2506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2507"><span data-slate-leaf="true" data-offset-key="2507:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2508"><span data-slate-leaf="true" data-offset-key="2508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2509"><span data-slate-leaf="true" data-offset-key="2509:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2510"><span data-slate-object="text" data-key="2511"><span data-slate-leaf="true" data-offset-key="2511:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2512"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2513"><span data-slate-object="text" data-key="2514"><span data-slate-leaf="true" data-offset-key="2514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span><span data-slate-object="text" data-key="2515"><span data-slate-leaf="true" data-offset-key="2515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="2516"><span data-slate-leaf="true" data-offset-key="2516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onkoblst_retn_newkmsob</span></span></span></span></span><span data-slate-object="text" data-key="2517"><span data-slate-leaf="true" data-offset-key="2517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2518"><span data-slate-leaf="true" data-offset-key="2518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2519"><span data-slate-leaf="true" data-offset-key="2519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *koblp, </span></span></span></span></span><span data-slate-object="text" data-key="2520"><span data-slate-leaf="true" data-offset-key="2520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2521"><span data-slate-leaf="true" data-offset-key="2521:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2522"><span data-slate-object="text" data-key="2523"><span data-slate-leaf="true" data-offset-key="2523:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2524"><span data-slate-object="text" data-key="2525"><span data-slate-leaf="true" data-offset-key="2525:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2526"><span data-slate-leaf="true" data-offset-key="2526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2527"><span data-slate-leaf="true" data-offset-key="2527:0" data-first-offset="true"><span data-slate-string="true"> *kmsp = </span></span></span><span data-slate-object="text" data-key="2528"><span data-slate-leaf="true" data-offset-key="2528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2529"><span data-slate-leaf="true" data-offset-key="2529:0" data-first-offset="true"><span data-slate-string="true">, *tkmsp = </span></span></span><span data-slate-object="text" data-key="2530"><span data-slate-leaf="true" data-offset-key="2530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2531"><span data-slate-leaf="true" data-offset-key="2531:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2532"><span data-slate-object="text" data-key="2533"><span data-slate-leaf="true" data-offset-key="2533:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2534"><span data-slate-leaf="true" data-offset-key="2534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="2535"><span data-slate-leaf="true" data-offset-key="2535:0" data-first-offset="true"><span data-slate-string="true"> *tmplst = </span></span></span><span data-slate-object="text" data-key="2536"><span data-slate-leaf="true" data-offset-key="2536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2537"><span data-slate-leaf="true" data-offset-key="2537:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2538"><span data-slate-object="text" data-key="2539"><span data-slate-leaf="true" data-offset-key="2539:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2540"><span data-slate-leaf="true" data-offset-key="2540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 先看看上次分配所用到的 koblst_t 是不是正好是这次需要的</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2541"><span data-slate-object="text" data-key="2542"><span data-slate-leaf="true" data-offset-key="2542:0" data-first-offset="true"><span data-slate-string="true">    kmsp = </span></span></span><span data-slate-object="text" data-key="2543"><span data-slate-leaf="true" data-offset-key="2543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_newkmsob_isok</span></span></span></span><span data-slate-object="text" data-key="2544"><span data-slate-leaf="true" data-offset-key="2544:0" data-first-offset="true"><span data-slate-string="true">(koblp-&gt;ol_cahe, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2545"><span data-slate-object="text" data-key="2546"><span data-slate-leaf="true" data-offset-key="2546:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2547"><span data-slate-leaf="true" data-offset-key="2547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2548"><span data-slate-leaf="true" data-offset-key="2548:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2549"><span data-slate-leaf="true" data-offset-key="2549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2550"><span data-slate-leaf="true" data-offset-key="2550:0" data-first-offset="true"><span data-slate-string="true"> != kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2551"><span data-slate-object="text" data-key="2552"><span data-slate-leaf="true" data-offset-key="2552:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2553"><span data-slate-object="text" data-key="2554"><span data-slate-leaf="true" data-offset-key="2554:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2555"><span data-slate-leaf="true" data-offset-key="2555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2556"><span data-slate-leaf="true" data-offset-key="2556:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2557"><span data-slate-object="text" data-key="2558"><span data-slate-leaf="true" data-offset-key="2558:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2559"><span data-slate-object="text" data-key="2560"><span data-slate-leaf="true" data-offset-key="2560:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2561"><span data-slate-leaf="true" data-offset-key="2561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果 koblst_t 中挂载的 kmsob_t 大于 0</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2562"><span data-slate-object="text" data-key="2563"><span data-slate-leaf="true" data-offset-key="2563:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2564"><span data-slate-leaf="true" data-offset-key="2564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2565"><span data-slate-leaf="true" data-offset-key="2565:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2566"><span data-slate-leaf="true" data-offset-key="2566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2567"><span data-slate-leaf="true" data-offset-key="2567:0" data-first-offset="true"><span data-slate-string="true"> &lt;koblp-&gt;ol_emnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2568"><span data-slate-object="text" data-key="2569"><span data-slate-leaf="true" data-offset-key="2569:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2570"><span data-slate-object="text" data-key="2571"><span data-slate-leaf="true" data-offset-key="2571:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2572"><span data-slate-leaf="true" data-offset-key="2572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 开始遍历 koblst_t 中挂载的 kmsob_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2573"><span data-slate-object="text" data-key="2574"><span data-slate-leaf="true" data-offset-key="2574:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2575"><span data-slate-leaf="true" data-offset-key="2575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_for_each</span></span></span></span><span data-slate-object="text" data-key="2576"><span data-slate-leaf="true" data-offset-key="2576:0" data-first-offset="true"><span data-slate-string="true">(tmplst, &amp;koblp-&gt;ol_emplst)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2577"><span data-slate-object="text" data-key="2578"><span data-slate-leaf="true" data-offset-key="2578:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2579"><span data-slate-object="text" data-key="2580"><span data-slate-leaf="true" data-offset-key="2580:0" data-first-offset="true"><span data-slate-string="true">            tkmsp = </span></span></span><span data-slate-object="text" data-key="2581"><span data-slate-leaf="true" data-offset-key="2581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="2582"><span data-slate-leaf="true" data-offset-key="2582:0" data-first-offset="true"><span data-slate-string="true">(tmplst, </span></span></span><span data-slate-object="text" data-key="2583"><span data-slate-leaf="true" data-offset-key="2583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2584"><span data-slate-leaf="true" data-offset-key="2584:0" data-first-offset="true"><span data-slate-string="true">, so_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2585"><span data-slate-object="text" data-key="2586"><span data-slate-leaf="true" data-offset-key="2586:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2587"><span data-slate-leaf="true" data-offset-key="2587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查当前 kmsob_t 是否合乎要求</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2588"><span data-slate-object="text" data-key="2589"><span data-slate-leaf="true" data-offset-key="2589:0" data-first-offset="true"><span data-slate-string="true">            kmsp = </span></span></span><span data-slate-object="text" data-key="2590"><span data-slate-leaf="true" data-offset-key="2590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_newkmsob_isok</span></span></span></span><span data-slate-object="text" data-key="2591"><span data-slate-leaf="true" data-offset-key="2591:0" data-first-offset="true"><span data-slate-string="true">(tkmsp, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2592"><span data-slate-object="text" data-key="2593"><span data-slate-leaf="true" data-offset-key="2593:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2594"><span data-slate-leaf="true" data-offset-key="2594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2595"><span data-slate-leaf="true" data-offset-key="2595:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2596"><span data-slate-leaf="true" data-offset-key="2596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2597"><span data-slate-leaf="true" data-offset-key="2597:0" data-first-offset="true"><span data-slate-string="true"> != kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2598"><span data-slate-object="text" data-key="2599"><span data-slate-leaf="true" data-offset-key="2599:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2600"><span data-slate-object="text" data-key="2601"><span data-slate-leaf="true" data-offset-key="2601:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="2602"><span data-slate-leaf="true" data-offset-key="2602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2603"><span data-slate-leaf="true" data-offset-key="2603:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2604"><span data-slate-object="text" data-key="2605"><span data-slate-leaf="true" data-offset-key="2605:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2606"><span data-slate-object="text" data-key="2607"><span data-slate-leaf="true" data-offset-key="2607:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2608"><span data-slate-object="text" data-key="2609"><span data-slate-leaf="true" data-offset-key="2609:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2610"><span data-slate-object="text" data-key="2611"><span data-slate-leaf="true" data-offset-key="2611:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2612"><span data-slate-leaf="true" data-offset-key="2612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2613"><span data-slate-leaf="true" data-offset-key="2613:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2614"><span data-slate-leaf="true" data-offset-key="2614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2615"><span data-slate-leaf="true" data-offset-key="2615:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2616"><span data-slate-object="text" data-key="2617"><span data-slate-leaf="true" data-offset-key="2617:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2618"><span data-slate-object="text" data-key="2619"><span data-slate-leaf="true" data-offset-key="2619:0" data-first-offset="true"><span data-slate-string="true">上述代码非常好理解，就是通过 onmsz_retn_koblst 函数，它根据内存对象大小查找并返回 ks_msoblst 数组元素的指针，这个数组元素中就挂载着相应的内存对象容器，然后由 onkoblst_retn_newkmsob 函数查询其中的内存对象容器并返回。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2620" id="sr-toc-9"><span data-slate-object="text" data-key="2621"><span data-slate-leaf="true" data-offset-key="2621:0" data-first-offset="true"><span data-slate-string="true">建立内存对象容器</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2622"><span data-slate-object="text" data-key="2623"><span data-slate-leaf="true" data-offset-key="2623:0" data-first-offset="true"><span data-slate-string="true">不知道你发现没有，有一种情况必然会发生，那就是第一次分配内存对象时调用 onkoblst_retn_newkmsob 函数，它肯定会返回一个 NULL。因为第一次分配时肯定没有 kmsob_t 结构，所以我们在这个时候建立一个 kmsob_t 结构，即</span></span></span><span data-slate-object="text" data-key="2624"><span data-slate-leaf="true" data-offset-key="2624:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">建立内存对象容器</span></span></span></span><span data-slate-object="text" data-key="2625"><span data-slate-leaf="true" data-offset-key="2625:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2626"><span data-slate-object="text" data-key="2627"><span data-slate-leaf="true" data-offset-key="2627:0" data-first-offset="true"><span data-slate-string="true">下面我们写一个 _create_kmsob 函数来创建 kmsob_t 结构，并执行一些初始化工作，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="2628"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div><div data-code-line-number="99"></div><div data-code-line-number="100"></div><div data-code-line-number="101"></div><div data-code-line-number="102"></div><div data-code-line-number="103"></div><div data-code-line-number="104"></div><div data-code-line-number="105"></div><div data-code-line-number="106"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2629"><span data-slate-object="text" data-key="2630"><span data-slate-leaf="true" data-offset-key="2630:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存对象数据结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2631"><span data-slate-object="text" data-key="2632"><span data-slate-leaf="true" data-offset-key="2632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2633"><span data-slate-leaf="true" data-offset-key="2633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2634"><span data-slate-leaf="true" data-offset-key="2634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t_init</span></span></span></span></span><span data-slate-object="text" data-key="2635"><span data-slate-leaf="true" data-offset-key="2635:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2636"><span data-slate-leaf="true" data-offset-key="2636:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2637"><span data-slate-leaf="true" data-offset-key="2637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp, </span></span></span></span></span><span data-slate-object="text" data-key="2638"><span data-slate-leaf="true" data-offset-key="2638:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2639"><span data-slate-leaf="true" data-offset-key="2639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> stus, </span></span></span></span></span><span data-slate-object="text" data-key="2640"><span data-slate-leaf="true" data-offset-key="2640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="2641"><span data-slate-leaf="true" data-offset-key="2641:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *stat)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2642"><span data-slate-object="text" data-key="2643"><span data-slate-leaf="true" data-offset-key="2643:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2644"><span data-slate-object="text" data-key="2645"><span data-slate-leaf="true" data-offset-key="2645:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2646"><span data-slate-leaf="true" data-offset-key="2646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2647"><span data-slate-leaf="true" data-offset-key="2647:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;oh_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2648"><span data-slate-object="text" data-key="2649"><span data-slate-leaf="true" data-offset-key="2649:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;oh_stus = stus;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2650"><span data-slate-object="text" data-key="2651"><span data-slate-leaf="true" data-offset-key="2651:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;oh_stat = stat;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2652"><span data-slate-object="text" data-key="2653"><span data-slate-leaf="true" data-offset-key="2653:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2654"><span data-slate-leaf="true" data-offset-key="2654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2655"><span data-slate-leaf="true" data-offset-key="2655:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2656"><span data-slate-object="text" data-key="2657"><span data-slate-leaf="true" data-offset-key="2657:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2658"><span data-slate-object="text" data-key="2659"><span data-slate-leaf="true" data-offset-key="2659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存对象容器数据结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2660"><span data-slate-object="text" data-key="2661"><span data-slate-leaf="true" data-offset-key="2661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="2662"><span data-slate-leaf="true" data-offset-key="2662:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2663"><span data-slate-leaf="true" data-offset-key="2663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t_init</span></span></span></span></span><span data-slate-object="text" data-key="2664"><span data-slate-leaf="true" data-offset-key="2664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2665"><span data-slate-leaf="true" data-offset-key="2665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2666"><span data-slate-leaf="true" data-offset-key="2666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2667"><span data-slate-object="text" data-key="2668"><span data-slate-leaf="true" data-offset-key="2668:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2669"><span data-slate-object="text" data-key="2670"><span data-slate-leaf="true" data-offset-key="2670:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2671"><span data-slate-leaf="true" data-offset-key="2671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2672"><span data-slate-leaf="true" data-offset-key="2672:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2673"><span data-slate-object="text" data-key="2674"><span data-slate-leaf="true" data-offset-key="2674:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2675"><span data-slate-leaf="true" data-offset-key="2675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="2676"><span data-slate-leaf="true" data-offset-key="2676:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2677"><span data-slate-object="text" data-key="2678"><span data-slate-leaf="true" data-offset-key="2678:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_stus = </span></span></span><span data-slate-object="text" data-key="2679"><span data-slate-leaf="true" data-offset-key="2679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2680"><span data-slate-leaf="true" data-offset-key="2680:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2681"><span data-slate-object="text" data-key="2682"><span data-slate-leaf="true" data-offset-key="2682:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_flgs = </span></span></span><span data-slate-object="text" data-key="2683"><span data-slate-leaf="true" data-offset-key="2683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2684"><span data-slate-leaf="true" data-offset-key="2684:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2685"><span data-slate-object="text" data-key="2686"><span data-slate-leaf="true" data-offset-key="2686:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_vstat = </span></span></span><span data-slate-object="text" data-key="2687"><span data-slate-leaf="true" data-offset-key="2687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2688"><span data-slate-leaf="true" data-offset-key="2688:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2689"><span data-slate-object="text" data-key="2690"><span data-slate-leaf="true" data-offset-key="2690:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_vend = </span></span></span><span data-slate-object="text" data-key="2691"><span data-slate-leaf="true" data-offset-key="2691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2692"><span data-slate-leaf="true" data-offset-key="2692:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2693"><span data-slate-object="text" data-key="2694"><span data-slate-leaf="true" data-offset-key="2694:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_objsz = </span></span></span><span data-slate-object="text" data-key="2695"><span data-slate-leaf="true" data-offset-key="2695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2696"><span data-slate-leaf="true" data-offset-key="2696:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2697"><span data-slate-object="text" data-key="2698"><span data-slate-leaf="true" data-offset-key="2698:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_objrelsz = </span></span></span><span data-slate-object="text" data-key="2699"><span data-slate-leaf="true" data-offset-key="2699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2700"><span data-slate-leaf="true" data-offset-key="2700:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2701"><span data-slate-object="text" data-key="2702"><span data-slate-leaf="true" data-offset-key="2702:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_mobjnr = </span></span></span><span data-slate-object="text" data-key="2703"><span data-slate-leaf="true" data-offset-key="2703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2704"><span data-slate-leaf="true" data-offset-key="2704:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2705"><span data-slate-object="text" data-key="2706"><span data-slate-leaf="true" data-offset-key="2706:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_fobjnr = </span></span></span><span data-slate-object="text" data-key="2707"><span data-slate-leaf="true" data-offset-key="2707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2708"><span data-slate-leaf="true" data-offset-key="2708:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2709"><span data-slate-object="text" data-key="2710"><span data-slate-leaf="true" data-offset-key="2710:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2711"><span data-slate-leaf="true" data-offset-key="2711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2712"><span data-slate-leaf="true" data-offset-key="2712:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2713"><span data-slate-object="text" data-key="2714"><span data-slate-leaf="true" data-offset-key="2714:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2715"><span data-slate-leaf="true" data-offset-key="2715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2716"><span data-slate-leaf="true" data-offset-key="2716:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_alclst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2717"><span data-slate-object="text" data-key="2718"><span data-slate-leaf="true" data-offset-key="2718:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2719"><span data-slate-leaf="true" data-offset-key="2719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="2720"><span data-slate-leaf="true" data-offset-key="2720:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_mextlst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2721"><span data-slate-object="text" data-key="2722"><span data-slate-leaf="true" data-offset-key="2722:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_mextnr = </span></span></span><span data-slate-object="text" data-key="2723"><span data-slate-leaf="true" data-offset-key="2723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2724"><span data-slate-leaf="true" data-offset-key="2724:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2725"><span data-slate-object="text" data-key="2726"><span data-slate-leaf="true" data-offset-key="2726:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2727"><span data-slate-leaf="true" data-offset-key="2727:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msomdc_t_init</span></span></span></span><span data-slate-object="text" data-key="2728"><span data-slate-leaf="true" data-offset-key="2728:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;so_mc);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2729"><span data-slate-object="text" data-key="2730"><span data-slate-leaf="true" data-offset-key="2730:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_privp = </span></span></span><span data-slate-object="text" data-key="2731"><span data-slate-leaf="true" data-offset-key="2731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2732"><span data-slate-leaf="true" data-offset-key="2732:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2733"><span data-slate-object="text" data-key="2734"><span data-slate-leaf="true" data-offset-key="2734:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;so_extdp = </span></span></span><span data-slate-object="text" data-key="2735"><span data-slate-leaf="true" data-offset-key="2735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2736"><span data-slate-leaf="true" data-offset-key="2736:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2737"><span data-slate-object="text" data-key="2738"><span data-slate-leaf="true" data-offset-key="2738:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2739"><span data-slate-leaf="true" data-offset-key="2739:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2740"><span data-slate-leaf="true" data-offset-key="2740:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2741"><span data-slate-object="text" data-key="2742"><span data-slate-leaf="true" data-offset-key="2742:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2743"><span data-slate-object="text" data-key="2744"><span data-slate-leaf="true" data-offset-key="2744:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把内存对象容器数据结构，挂载到对应的 koblst_t 结构中去</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2745"><span data-slate-object="text" data-key="2746"><span data-slate-leaf="true" data-offset-key="2746:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="2747"><span data-slate-leaf="true" data-offset-key="2747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="2748"><span data-slate-leaf="true" data-offset-key="2748:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_add_koblst</span></span></span></span></span><span data-slate-object="text" data-key="2749"><span data-slate-leaf="true" data-offset-key="2749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="2750"><span data-slate-leaf="true" data-offset-key="2750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2751"><span data-slate-leaf="true" data-offset-key="2751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *koblp, </span></span></span></span></span><span data-slate-object="text" data-key="2752"><span data-slate-leaf="true" data-offset-key="2752:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="2753"><span data-slate-leaf="true" data-offset-key="2753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2754"><span data-slate-object="text" data-key="2755"><span data-slate-leaf="true" data-offset-key="2755:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2756"><span data-slate-object="text" data-key="2757"><span data-slate-leaf="true" data-offset-key="2757:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2758"><span data-slate-leaf="true" data-offset-key="2758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="2759"><span data-slate-leaf="true" data-offset-key="2759:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_list, &amp;koblp-&gt;ol_emplst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2760"><span data-slate-object="text" data-key="2761"><span data-slate-leaf="true" data-offset-key="2761:0" data-first-offset="true"><span data-slate-string="true">    koblp-&gt;ol_emnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2762"><span data-slate-object="text" data-key="2763"><span data-slate-leaf="true" data-offset-key="2763:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2764"><span data-slate-leaf="true" data-offset-key="2764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2765"><span data-slate-leaf="true" data-offset-key="2765:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2766"><span data-slate-object="text" data-key="2767"><span data-slate-leaf="true" data-offset-key="2767:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2768"><span data-slate-object="text" data-key="2769"><span data-slate-leaf="true" data-offset-key="2769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存对象容器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2770"><span data-slate-object="text" data-key="2771"><span data-slate-leaf="true" data-offset-key="2771:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2772"><span data-slate-leaf="true" data-offset-key="2772:0" data-first-offset="true"><span data-slate-string="true"> *_create_init_kmsob(</span></span></span><span data-slate-object="text" data-key="2773"><span data-slate-leaf="true" data-offset-key="2773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2774"><span data-slate-leaf="true" data-offset-key="2774:0" data-first-offset="true"><span data-slate-string="true"> *kmsp, </span></span></span><span data-slate-object="text" data-key="2775"><span data-slate-leaf="true" data-offset-key="2775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="2776"><span data-slate-leaf="true" data-offset-key="2776:0" data-first-offset="true"><span data-slate-string="true"> objsz, </span></span></span><span data-slate-object="text" data-key="2777"><span data-slate-leaf="true" data-offset-key="2777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="2778"><span data-slate-leaf="true" data-offset-key="2778:0" data-first-offset="true"><span data-slate-string="true"> cvadrs, </span></span></span><span data-slate-object="text" data-key="2779"><span data-slate-leaf="true" data-offset-key="2779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="2780"><span data-slate-leaf="true" data-offset-key="2780:0" data-first-offset="true"><span data-slate-string="true"> cvadre, </span></span></span><span data-slate-object="text" data-key="2781"><span data-slate-leaf="true" data-offset-key="2781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="2782"><span data-slate-leaf="true" data-offset-key="2782:0" data-first-offset="true"><span data-slate-string="true"> *msa, </span></span></span><span data-slate-object="text" data-key="2783"><span data-slate-leaf="true" data-offset-key="2783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2784"><span data-slate-leaf="true" data-offset-key="2784:0" data-first-offset="true"><span data-slate-string="true"> relpnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2785"><span data-slate-object="text" data-key="2786"><span data-slate-leaf="true" data-offset-key="2786:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2787"><span data-slate-object="text" data-key="2788"><span data-slate-leaf="true" data-offset-key="2788:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2789"><span data-slate-leaf="true" data-offset-key="2789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmsob 结构体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2790"><span data-slate-object="text" data-key="2791"><span data-slate-leaf="true" data-offset-key="2791:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2792"><span data-slate-leaf="true" data-offset-key="2792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t_init</span></span></span></span><span data-slate-object="text" data-key="2793"><span data-slate-leaf="true" data-offset-key="2793:0" data-first-offset="true"><span data-slate-string="true">(kmsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2794"><span data-slate-object="text" data-key="2795"><span data-slate-leaf="true" data-offset-key="2795:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2796"><span data-slate-leaf="true" data-offset-key="2796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置内存对象容器的开始、结束地址，内存对象大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2797"><span data-slate-object="text" data-key="2798"><span data-slate-leaf="true" data-offset-key="2798:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_vstat = cvadrs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2799"><span data-slate-object="text" data-key="2800"><span data-slate-leaf="true" data-offset-key="2800:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_vend = cvadre;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2801"><span data-slate-object="text" data-key="2802"><span data-slate-leaf="true" data-offset-key="2802:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_objsz = objsz;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2803"><span data-slate-object="text" data-key="2804"><span data-slate-leaf="true" data-offset-key="2804:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2805"><span data-slate-leaf="true" data-offset-key="2805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把物理内存页面对应的 msadsc_t 结构加入到 kmsob_t 中的 so_mc.mc_kmobinlst 链表上</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2806"><span data-slate-object="text" data-key="2807"><span data-slate-leaf="true" data-offset-key="2807:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2808"><span data-slate-leaf="true" data-offset-key="2808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="2809"><span data-slate-leaf="true" data-offset-key="2809:0" data-first-offset="true"><span data-slate-string="true">(&amp;msa-&gt;md_list, &amp;kmsp-&gt;so_mc.mc_kmobinlst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2810"><span data-slate-object="text" data-key="2811"><span data-slate-leaf="true" data-offset-key="2811:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_mc.mc_kmobinpnr = (</span></span></span><span data-slate-object="text" data-key="2812"><span data-slate-leaf="true" data-offset-key="2812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2813"><span data-slate-leaf="true" data-offset-key="2813:0" data-first-offset="true"><span data-slate-string="true">)relpnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2814"><span data-slate-object="text" data-key="2815"><span data-slate-leaf="true" data-offset-key="2815:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2816"><span data-slate-leaf="true" data-offset-key="2816:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置内存对象的开始地址为 kmsob_t 结构之后，结束地址为内存对象容器的结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2817"><span data-slate-object="text" data-key="2818"><span data-slate-leaf="true" data-offset-key="2818:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2819"><span data-slate-leaf="true" data-offset-key="2819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2820"><span data-slate-leaf="true" data-offset-key="2820:0" data-first-offset="true"><span data-slate-string="true"> *fohstat = (</span></span></span><span data-slate-object="text" data-key="2821"><span data-slate-leaf="true" data-offset-key="2821:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2822"><span data-slate-leaf="true" data-offset-key="2822:0" data-first-offset="true"><span data-slate-string="true"> *)(kmsp + </span></span></span><span data-slate-object="text" data-key="2823"><span data-slate-leaf="true" data-offset-key="2823:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2824"><span data-slate-leaf="true" data-offset-key="2824:0" data-first-offset="true"><span data-slate-string="true">), *fohend = (</span></span></span><span data-slate-object="text" data-key="2825"><span data-slate-leaf="true" data-offset-key="2825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2826"><span data-slate-leaf="true" data-offset-key="2826:0" data-first-offset="true"><span data-slate-string="true"> *)cvadre;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2827"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2828"><span data-slate-object="text" data-key="2829"><span data-slate-leaf="true" data-offset-key="2829:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2830"><span data-slate-leaf="true" data-offset-key="2830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2831"><span data-slate-leaf="true" data-offset-key="2831:0" data-first-offset="true"><span data-slate-string="true"> ap = (</span></span></span><span data-slate-object="text" data-key="2832"><span data-slate-leaf="true" data-offset-key="2832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2833"><span data-slate-leaf="true" data-offset-key="2833:0" data-first-offset="true"><span data-slate-string="true">)((</span></span></span><span data-slate-object="text" data-key="2834"><span data-slate-leaf="true" data-offset-key="2834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2835"><span data-slate-leaf="true" data-offset-key="2835:0" data-first-offset="true"><span data-slate-string="true">)fohstat);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2836"><span data-slate-object="text" data-key="2837"><span data-slate-leaf="true" data-offset-key="2837:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2838"><span data-slate-leaf="true" data-offset-key="2838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2839"><span data-slate-leaf="true" data-offset-key="2839:0" data-first-offset="true"><span data-slate-string="true"> *tmpfoh = (</span></span></span><span data-slate-object="text" data-key="2840"><span data-slate-leaf="true" data-offset-key="2840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2841"><span data-slate-leaf="true" data-offset-key="2841:0" data-first-offset="true"><span data-slate-string="true"> *)((</span></span></span><span data-slate-object="text" data-key="2842"><span data-slate-leaf="true" data-offset-key="2842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2843"><span data-slate-leaf="true" data-offset-key="2843:0" data-first-offset="true"><span data-slate-string="true">)ap);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2844"><span data-slate-object="text" data-key="2845"><span data-slate-leaf="true" data-offset-key="2845:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2846"><span data-slate-leaf="true" data-offset-key="2846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="2847"><span data-slate-leaf="true" data-offset-key="2847:0" data-first-offset="true"><span data-slate-string="true"> (; tmpfoh &lt; fohend;)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2848"><span data-slate-object="text" data-key="2849"><span data-slate-leaf="true" data-offset-key="2849:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span><span data-slate-object="text" data-key="2850"><span data-slate-leaf="true" data-offset-key="2850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 相当在 kmsob_t 结构体之后建立一个 freobjh_t 结构体数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2851"><span data-slate-object="text" data-key="2852"><span data-slate-leaf="true" data-offset-key="2852:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2853"><span data-slate-leaf="true" data-offset-key="2853:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2854"><span data-slate-leaf="true" data-offset-key="2854:0" data-first-offset="true"><span data-slate-string="true"> ((ap + (</span></span></span><span data-slate-object="text" data-key="2855"><span data-slate-leaf="true" data-offset-key="2855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2856"><span data-slate-leaf="true" data-offset-key="2856:0" data-first-offset="true"><span data-slate-string="true">)kmsp-&gt;so_objsz) &lt;= (</span></span></span><span data-slate-object="text" data-key="2857"><span data-slate-leaf="true" data-offset-key="2857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2858"><span data-slate-leaf="true" data-offset-key="2858:0" data-first-offset="true"><span data-slate-string="true">)cvadre)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2859"><span data-slate-object="text" data-key="2860"><span data-slate-leaf="true" data-offset-key="2860:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span><span data-slate-object="text" data-key="2861"><span data-slate-leaf="true" data-offset-key="2861:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化每个 freobjh_t 结构体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2862"><span data-slate-object="text" data-key="2863"><span data-slate-leaf="true" data-offset-key="2863:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2864"><span data-slate-leaf="true" data-offset-key="2864:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t_init</span></span></span></span><span data-slate-object="text" data-key="2865"><span data-slate-leaf="true" data-offset-key="2865:0" data-first-offset="true"><span data-slate-string="true">(tmpfoh, </span></span></span><span data-slate-object="text" data-key="2866"><span data-slate-leaf="true" data-offset-key="2866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2867"><span data-slate-leaf="true" data-offset-key="2867:0" data-first-offset="true"><span data-slate-string="true">, (</span></span></span><span data-slate-object="text" data-key="2868"><span data-slate-leaf="true" data-offset-key="2868:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2869"><span data-slate-leaf="true" data-offset-key="2869:0" data-first-offset="true"><span data-slate-string="true"> *)tmpfoh);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2870"><span data-slate-object="text" data-key="2871"><span data-slate-leaf="true" data-offset-key="2871:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2872"><span data-slate-leaf="true" data-offset-key="2872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把每个 freobjh_t 结构体加入到 kmsob_t 结构体中的 so_frelst 中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2873"><span data-slate-object="text" data-key="2874"><span data-slate-leaf="true" data-offset-key="2874:0" data-first-offset="true"><span data-slate-string="true">           </span></span></span><span data-slate-object="text" data-key="2875"><span data-slate-leaf="true" data-offset-key="2875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="2876"><span data-slate-leaf="true" data-offset-key="2876:0" data-first-offset="true"><span data-slate-string="true">(&amp;tmpfoh-&gt;oh_list, &amp;kmsp-&gt;so_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2877"><span data-slate-object="text" data-key="2878"><span data-slate-leaf="true" data-offset-key="2878:0" data-first-offset="true"><span data-slate-string="true">            kmsp-&gt;so_mobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2879"><span data-slate-object="text" data-key="2880"><span data-slate-leaf="true" data-offset-key="2880:0" data-first-offset="true"><span data-slate-string="true">            kmsp-&gt;so_fobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2881"><span data-slate-object="text" data-key="2882"><span data-slate-leaf="true" data-offset-key="2882:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2883"><span data-slate-object="text" data-key="2884"><span data-slate-leaf="true" data-offset-key="2884:0" data-first-offset="true"><span data-slate-string="true">        ap += (</span></span></span><span data-slate-object="text" data-key="2885"><span data-slate-leaf="true" data-offset-key="2885:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2886"><span data-slate-leaf="true" data-offset-key="2886:0" data-first-offset="true"><span data-slate-string="true">)kmsp-&gt;so_objsz;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2887"><span data-slate-object="text" data-key="2888"><span data-slate-leaf="true" data-offset-key="2888:0" data-first-offset="true"><span data-slate-string="true">        tmpfoh = (</span></span></span><span data-slate-object="text" data-key="2889"><span data-slate-leaf="true" data-offset-key="2889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="2890"><span data-slate-leaf="true" data-offset-key="2890:0" data-first-offset="true"><span data-slate-string="true"> *)((</span></span></span><span data-slate-object="text" data-key="2891"><span data-slate-leaf="true" data-offset-key="2891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2892"><span data-slate-leaf="true" data-offset-key="2892:0" data-first-offset="true"><span data-slate-string="true">)ap);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2893"><span data-slate-object="text" data-key="2894"><span data-slate-leaf="true" data-offset-key="2894:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2895"><span data-slate-object="text" data-key="2896"><span data-slate-leaf="true" data-offset-key="2896:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2897"><span data-slate-leaf="true" data-offset-key="2897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2898"><span data-slate-leaf="true" data-offset-key="2898:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2899"><span data-slate-object="text" data-key="2900"><span data-slate-leaf="true" data-offset-key="2900:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2901"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2902"><span data-slate-object="text" data-key="2903"><span data-slate-leaf="true" data-offset-key="2903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 建立一个内存对象容器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2904"><span data-slate-object="text" data-key="2905"><span data-slate-leaf="true" data-offset-key="2905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2906"><span data-slate-leaf="true" data-offset-key="2906:0" data-first-offset="true"><span data-slate-string="true"> *_create_kmsob(</span></span></span><span data-slate-object="text" data-key="2907"><span data-slate-leaf="true" data-offset-key="2907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="2908"><span data-slate-leaf="true" data-offset-key="2908:0" data-first-offset="true"><span data-slate-string="true"> *kmmgrlokp, </span></span></span><span data-slate-object="text" data-key="2909"><span data-slate-leaf="true" data-offset-key="2909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="2910"><span data-slate-leaf="true" data-offset-key="2910:0" data-first-offset="true"><span data-slate-string="true"> *koblp, </span></span></span><span data-slate-object="text" data-key="2911"><span data-slate-leaf="true" data-offset-key="2911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span><span data-slate-object="text" data-key="2912"><span data-slate-leaf="true" data-offset-key="2912:0" data-first-offset="true"><span data-slate-string="true"> objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2913"><span data-slate-object="text" data-key="2914"><span data-slate-leaf="true" data-offset-key="2914:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2915"><span data-slate-object="text" data-key="2916"><span data-slate-leaf="true" data-offset-key="2916:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2917"><span data-slate-leaf="true" data-offset-key="2917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="2918"><span data-slate-leaf="true" data-offset-key="2918:0" data-first-offset="true"><span data-slate-string="true"> *kmsp = </span></span></span><span data-slate-object="text" data-key="2919"><span data-slate-leaf="true" data-offset-key="2919:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2920"><span data-slate-leaf="true" data-offset-key="2920:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2921"><span data-slate-object="text" data-key="2922"><span data-slate-leaf="true" data-offset-key="2922:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2923"><span data-slate-leaf="true" data-offset-key="2923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="2924"><span data-slate-leaf="true" data-offset-key="2924:0" data-first-offset="true"><span data-slate-string="true"> *msa = </span></span></span><span data-slate-object="text" data-key="2925"><span data-slate-leaf="true" data-offset-key="2925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2926"><span data-slate-leaf="true" data-offset-key="2926:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2927"><span data-slate-object="text" data-key="2928"><span data-slate-leaf="true" data-offset-key="2928:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2929"><span data-slate-leaf="true" data-offset-key="2929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2930"><span data-slate-leaf="true" data-offset-key="2930:0" data-first-offset="true"><span data-slate-string="true"> relpnr = </span></span></span><span data-slate-object="text" data-key="2931"><span data-slate-leaf="true" data-offset-key="2931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="2932"><span data-slate-leaf="true" data-offset-key="2932:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2933"><span data-slate-object="text" data-key="2934"><span data-slate-leaf="true" data-offset-key="2934:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2935"><span data-slate-leaf="true" data-offset-key="2935:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="2936"><span data-slate-leaf="true" data-offset-key="2936:0" data-first-offset="true"><span data-slate-string="true"> pages = </span></span></span><span data-slate-object="text" data-key="2937"><span data-slate-leaf="true" data-offset-key="2937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2938"><span data-slate-leaf="true" data-offset-key="2938:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2939"><span data-slate-object="text" data-key="2940"><span data-slate-leaf="true" data-offset-key="2940:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2941"><span data-slate-leaf="true" data-offset-key="2941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2942"><span data-slate-leaf="true" data-offset-key="2942:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2943"><span data-slate-leaf="true" data-offset-key="2943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">128</span></span></span></span><span data-slate-object="text" data-key="2944"><span data-slate-leaf="true" data-offset-key="2944:0" data-first-offset="true"><span data-slate-string="true"> &lt;objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2945"><span data-slate-object="text" data-key="2946"><span data-slate-leaf="true" data-offset-key="2946:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2947"><span data-slate-object="text" data-key="2948"><span data-slate-leaf="true" data-offset-key="2948:0" data-first-offset="true"><span data-slate-string="true">        pages = </span></span></span><span data-slate-object="text" data-key="2949"><span data-slate-leaf="true" data-offset-key="2949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="2950"><span data-slate-leaf="true" data-offset-key="2950:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2951"><span data-slate-object="text" data-key="2952"><span data-slate-leaf="true" data-offset-key="2952:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2953"><span data-slate-object="text" data-key="2954"><span data-slate-leaf="true" data-offset-key="2954:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2955"><span data-slate-leaf="true" data-offset-key="2955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2956"><span data-slate-leaf="true" data-offset-key="2956:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2957"><span data-slate-leaf="true" data-offset-key="2957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">512</span></span></span></span><span data-slate-object="text" data-key="2958"><span data-slate-leaf="true" data-offset-key="2958:0" data-first-offset="true"><span data-slate-string="true"> &lt;objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2959"><span data-slate-object="text" data-key="2960"><span data-slate-leaf="true" data-offset-key="2960:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2961"><span data-slate-object="text" data-key="2962"><span data-slate-leaf="true" data-offset-key="2962:0" data-first-offset="true"><span data-slate-string="true">        pages = </span></span></span><span data-slate-object="text" data-key="2963"><span data-slate-leaf="true" data-offset-key="2963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="2964"><span data-slate-leaf="true" data-offset-key="2964:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2965"><span data-slate-object="text" data-key="2966"><span data-slate-leaf="true" data-offset-key="2966:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2967"><span data-slate-object="text" data-key="2968"><span data-slate-leaf="true" data-offset-key="2968:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2969"><span data-slate-leaf="true" data-offset-key="2969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 为内存对象容器分配物理内存空间，这是我们之前实现的物理内存页面管理器</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2970"><span data-slate-object="text" data-key="2971"><span data-slate-leaf="true" data-offset-key="2971:0" data-first-offset="true"><span data-slate-string="true">    msa = </span></span></span><span data-slate-object="text" data-key="2972"><span data-slate-leaf="true" data-offset-key="2972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mm_division_pages</span></span></span></span><span data-slate-object="text" data-key="2973"><span data-slate-leaf="true" data-offset-key="2973:0" data-first-offset="true"><span data-slate-string="true">(&amp;memmgrob, pages, &amp;relpnr, MA_TYPE_KRNL, DMF_RELDIV);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2974"><span data-slate-object="text" data-key="2975"><span data-slate-leaf="true" data-offset-key="2975:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2976"><span data-slate-leaf="true" data-offset-key="2976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2977"><span data-slate-leaf="true" data-offset-key="2977:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="2978"><span data-slate-leaf="true" data-offset-key="2978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2979"><span data-slate-leaf="true" data-offset-key="2979:0" data-first-offset="true"><span data-slate-string="true"> == msa)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2980"><span data-slate-object="text" data-key="2981"><span data-slate-leaf="true" data-offset-key="2981:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2982"><span data-slate-object="text" data-key="2983"><span data-slate-leaf="true" data-offset-key="2983:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2984"><span data-slate-leaf="true" data-offset-key="2984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2985"><span data-slate-leaf="true" data-offset-key="2985:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2986"><span data-slate-leaf="true" data-offset-key="2986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="2987"><span data-slate-leaf="true" data-offset-key="2987:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2988"><span data-slate-object="text" data-key="2989"><span data-slate-leaf="true" data-offset-key="2989:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2990"><span data-slate-object="text" data-key="2991"><span data-slate-leaf="true" data-offset-key="2991:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2992"><span data-slate-leaf="true" data-offset-key="2992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="2993"><span data-slate-leaf="true" data-offset-key="2993:0" data-first-offset="true"><span data-slate-string="true"> phyadr = msa-&gt;md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2994"><span data-slate-object="text" data-key="2995"><span data-slate-leaf="true" data-offset-key="2995:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2996"><span data-slate-leaf="true" data-offset-key="2996:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="2997"><span data-slate-leaf="true" data-offset-key="2997:0" data-first-offset="true"><span data-slate-string="true"> phyade = phyadr + (relpnr &lt;&lt; PSHRSIZE) - </span></span></span><span data-slate-object="text" data-key="2998"><span data-slate-leaf="true" data-offset-key="2998:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2999"><span data-slate-leaf="true" data-offset-key="2999:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3000"><span data-slate-object="text" data-key="3001"><span data-slate-leaf="true" data-offset-key="3001:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3002"><span data-slate-leaf="true" data-offset-key="3002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 计算它们的虚拟地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3003"><span data-slate-object="text" data-key="3004"><span data-slate-leaf="true" data-offset-key="3004:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3005"><span data-slate-leaf="true" data-offset-key="3005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3006"><span data-slate-leaf="true" data-offset-key="3006:0" data-first-offset="true"><span data-slate-string="true"> vadrs = </span></span></span><span data-slate-object="text" data-key="3007"><span data-slate-leaf="true" data-offset-key="3007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="3008"><span data-slate-leaf="true" data-offset-key="3008:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="3009"><span data-slate-leaf="true" data-offset-key="3009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3010"><span data-slate-leaf="true" data-offset-key="3010:0" data-first-offset="true"><span data-slate-string="true">)phyadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3011"><span data-slate-object="text" data-key="3012"><span data-slate-leaf="true" data-offset-key="3012:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3013"><span data-slate-leaf="true" data-offset-key="3013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3014"><span data-slate-leaf="true" data-offset-key="3014:0" data-first-offset="true"><span data-slate-string="true"> vadre = </span></span></span><span data-slate-object="text" data-key="3015"><span data-slate-leaf="true" data-offset-key="3015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="3016"><span data-slate-leaf="true" data-offset-key="3016:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="3017"><span data-slate-leaf="true" data-offset-key="3017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3018"><span data-slate-leaf="true" data-offset-key="3018:0" data-first-offset="true"><span data-slate-string="true">)phyade);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3019"><span data-slate-object="text" data-key="3020"><span data-slate-leaf="true" data-offset-key="3020:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3021"><span data-slate-leaf="true" data-offset-key="3021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmsob_t 并建立内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3022"><span data-slate-object="text" data-key="3023"><span data-slate-leaf="true" data-offset-key="3023:0" data-first-offset="true"><span data-slate-string="true">    kmsp = _create_init_kmsob((</span></span></span><span data-slate-object="text" data-key="3024"><span data-slate-leaf="true" data-offset-key="3024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="3025"><span data-slate-leaf="true" data-offset-key="3025:0" data-first-offset="true"><span data-slate-string="true"> *)vadrs, koblp-&gt;ol_sz, vadrs, vadre, msa, relpnr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3026"><span data-slate-object="text" data-key="3027"><span data-slate-leaf="true" data-offset-key="3027:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3028"><span data-slate-leaf="true" data-offset-key="3028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把 kmsob_t 结构，挂载到对应的 koblst_t 结构中去</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3029"><span data-slate-object="text" data-key="3030"><span data-slate-leaf="true" data-offset-key="3030:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3031"><span data-slate-leaf="true" data-offset-key="3031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3032"><span data-slate-leaf="true" data-offset-key="3032:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3033"><span data-slate-leaf="true" data-offset-key="3033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_add_koblst</span></span></span></span><span data-slate-object="text" data-key="3034"><span data-slate-leaf="true" data-offset-key="3034:0" data-first-offset="true"><span data-slate-string="true">(koblp, kmsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3035"><span data-slate-object="text" data-key="3036"><span data-slate-leaf="true" data-offset-key="3036:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3037"><span data-slate-object="text" data-key="3038"><span data-slate-leaf="true" data-offset-key="3038:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3039"><span data-slate-leaf="true" data-offset-key="3039:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="3040"><span data-slate-leaf="true" data-offset-key="3040:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3041"><span data-slate-leaf="true" data-offset-key="3041:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"_create_kmsob kmsob_add_koblst FALSE\n"</span></span></span></span><span data-slate-object="text" data-key="3042"><span data-slate-leaf="true" data-offset-key="3042:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3043"><span data-slate-object="text" data-key="3044"><span data-slate-leaf="true" data-offset-key="3044:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3045"><span data-slate-object="text" data-key="3046"><span data-slate-leaf="true" data-offset-key="3046:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3047"><span data-slate-leaf="true" data-offset-key="3047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 增加计数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3048"><span data-slate-object="text" data-key="3049"><span data-slate-leaf="true" data-offset-key="3049:0" data-first-offset="true"><span data-slate-string="true">    kmmgrlokp-&gt;ks_msobnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3050"><span data-slate-object="text" data-key="3051"><span data-slate-leaf="true" data-offset-key="3051:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3052"><span data-slate-leaf="true" data-offset-key="3052:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3053"><span data-slate-leaf="true" data-offset-key="3053:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3054"><span data-slate-object="text" data-key="3055"><span data-slate-leaf="true" data-offset-key="3055:0" data-first-offset="true"><span data-slate-string="true">_create_kmsob 函数就是根据分配内存对象大小，建立一个内存对象容器。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3056"><span data-slate-object="text" data-key="3057"><span data-slate-leaf="true" data-offset-key="3057:0" data-first-offset="true"><span data-slate-string="true">首先，这个函数会找物理内存页面管理器申请一块连续内存页面。然后，在其中的开始部分建立 kmsob_t 结构的实例变量，又在 kmsob_t 结构的后面建立 freobjh_t 结构数组，并把每个 freobjh_t 结构挂载到 kmsob_t 结构体中的 so_frelst 中。最后再把 kmsob_t 结构，挂载到 kmsobmgrhed_t 结构对应的 koblst_t 结构中去。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3058"><span data-slate-object="text" data-key="3059"><span data-slate-leaf="true" data-offset-key="3059:0" data-first-offset="true"><span data-slate-string="true">上面的注释已经很清楚了，我相信你看得懂。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3060" id="sr-toc-10"><span data-slate-object="text" data-key="3061"><span data-slate-leaf="true" data-offset-key="3061:0" data-first-offset="true"><span data-slate-string="true">扩容内存对象容器</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3062"><span data-slate-object="text" data-key="3063"><span data-slate-leaf="true" data-offset-key="3063:0" data-first-offset="true"><span data-slate-string="true">如果我们不断重复分配同一大小的内存对象，那么那个内存对象容器中的内存对象，迟早要分配完的。一旦内存对象分配完，内存对象容器就没有空闲的内存空间产生内存对象了。这时，我们就要为内存对象容器扩展内存空间了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3064"><span data-slate-object="text" data-key="3065"><span data-slate-leaf="true" data-offset-key="3065:0" data-first-offset="true"><span data-slate-string="true">下面我们来写代码实现，如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="3066"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3067"><span data-slate-object="text" data-key="3068"><span data-slate-leaf="true" data-offset-key="3068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmbext_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3069"><span data-slate-object="text" data-key="3070"><span data-slate-leaf="true" data-offset-key="3070:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="3071"><span data-slate-leaf="true" data-offset-key="3071:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3072"><span data-slate-leaf="true" data-offset-key="3072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t_init</span></span></span></span></span><span data-slate-object="text" data-key="3073"><span data-slate-leaf="true" data-offset-key="3073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3074"><span data-slate-leaf="true" data-offset-key="3074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3075"><span data-slate-leaf="true" data-offset-key="3075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *initp, </span></span></span></span></span><span data-slate-object="text" data-key="3076"><span data-slate-leaf="true" data-offset-key="3076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3077"><span data-slate-leaf="true" data-offset-key="3077:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> vstat, </span></span></span></span></span><span data-slate-object="text" data-key="3078"><span data-slate-leaf="true" data-offset-key="3078:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3079"><span data-slate-leaf="true" data-offset-key="3079:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> vend, </span></span></span></span></span><span data-slate-object="text" data-key="3080"><span data-slate-leaf="true" data-offset-key="3080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3081"><span data-slate-leaf="true" data-offset-key="3081:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3082"><span data-slate-object="text" data-key="3083"><span data-slate-leaf="true" data-offset-key="3083:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3084"><span data-slate-object="text" data-key="3085"><span data-slate-leaf="true" data-offset-key="3085:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3086"><span data-slate-leaf="true" data-offset-key="3086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="3087"><span data-slate-leaf="true" data-offset-key="3087:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp-&gt;mt_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3088"><span data-slate-object="text" data-key="3089"><span data-slate-leaf="true" data-offset-key="3089:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;mt_vstat = vstat;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3090"><span data-slate-object="text" data-key="3091"><span data-slate-leaf="true" data-offset-key="3091:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;mt_vend = vend;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3092"><span data-slate-object="text" data-key="3093"><span data-slate-leaf="true" data-offset-key="3093:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;mt_kmsb = kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3094"><span data-slate-object="text" data-key="3095"><span data-slate-leaf="true" data-offset-key="3095:0" data-first-offset="true"><span data-slate-string="true">    initp-&gt;mt_mobjnr = </span></span></span><span data-slate-object="text" data-key="3096"><span data-slate-leaf="true" data-offset-key="3096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3097"><span data-slate-leaf="true" data-offset-key="3097:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3098"><span data-slate-object="text" data-key="3099"><span data-slate-leaf="true" data-offset-key="3099:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3100"><span data-slate-leaf="true" data-offset-key="3100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3101"><span data-slate-leaf="true" data-offset-key="3101:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3102"><span data-slate-object="text" data-key="3103"><span data-slate-leaf="true" data-offset-key="3103:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3104"><span data-slate-object="text" data-key="3105"><span data-slate-leaf="true" data-offset-key="3105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 扩展内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3106"><span data-slate-object="text" data-key="3107"><span data-slate-leaf="true" data-offset-key="3107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="3108"><span data-slate-leaf="true" data-offset-key="3108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3109"><span data-slate-leaf="true" data-offset-key="3109:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_extn_pages</span></span></span></span></span><span data-slate-object="text" data-key="3110"><span data-slate-leaf="true" data-offset-key="3110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3111"><span data-slate-leaf="true" data-offset-key="3111:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3112"><span data-slate-leaf="true" data-offset-key="3112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3113"><span data-slate-object="text" data-key="3114"><span data-slate-leaf="true" data-offset-key="3114:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3115"><span data-slate-object="text" data-key="3116"><span data-slate-leaf="true" data-offset-key="3116:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3117"><span data-slate-leaf="true" data-offset-key="3117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="3118"><span data-slate-leaf="true" data-offset-key="3118:0" data-first-offset="true"><span data-slate-string="true"> *msa = </span></span></span><span data-slate-object="text" data-key="3119"><span data-slate-leaf="true" data-offset-key="3119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3120"><span data-slate-leaf="true" data-offset-key="3120:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3121"><span data-slate-object="text" data-key="3122"><span data-slate-leaf="true" data-offset-key="3122:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3123"><span data-slate-leaf="true" data-offset-key="3123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3124"><span data-slate-leaf="true" data-offset-key="3124:0" data-first-offset="true"><span data-slate-string="true"> relpnr = </span></span></span><span data-slate-object="text" data-key="3125"><span data-slate-leaf="true" data-offset-key="3125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3126"><span data-slate-leaf="true" data-offset-key="3126:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3127"><span data-slate-object="text" data-key="3128"><span data-slate-leaf="true" data-offset-key="3128:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3129"><span data-slate-leaf="true" data-offset-key="3129:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3130"><span data-slate-leaf="true" data-offset-key="3130:0" data-first-offset="true"><span data-slate-string="true"> pages = </span></span></span><span data-slate-object="text" data-key="3131"><span data-slate-leaf="true" data-offset-key="3131:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3132"><span data-slate-leaf="true" data-offset-key="3132:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3133"><span data-slate-object="text" data-key="3134"><span data-slate-leaf="true" data-offset-key="3134:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3135"><span data-slate-leaf="true" data-offset-key="3135:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3136"><span data-slate-leaf="true" data-offset-key="3136:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3137"><span data-slate-leaf="true" data-offset-key="3137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">128</span></span></span></span><span data-slate-object="text" data-key="3138"><span data-slate-leaf="true" data-offset-key="3138:0" data-first-offset="true"><span data-slate-string="true"> &lt;kmsp-&gt;so_objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3139"><span data-slate-object="text" data-key="3140"><span data-slate-leaf="true" data-offset-key="3140:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3141"><span data-slate-object="text" data-key="3142"><span data-slate-leaf="true" data-offset-key="3142:0" data-first-offset="true"><span data-slate-string="true">        pages = </span></span></span><span data-slate-object="text" data-key="3143"><span data-slate-leaf="true" data-offset-key="3143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3144"><span data-slate-leaf="true" data-offset-key="3144:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3145"><span data-slate-object="text" data-key="3146"><span data-slate-leaf="true" data-offset-key="3146:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3147"><span data-slate-object="text" data-key="3148"><span data-slate-leaf="true" data-offset-key="3148:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3149"><span data-slate-leaf="true" data-offset-key="3149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3150"><span data-slate-leaf="true" data-offset-key="3150:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3151"><span data-slate-leaf="true" data-offset-key="3151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">512</span></span></span></span><span data-slate-object="text" data-key="3152"><span data-slate-leaf="true" data-offset-key="3152:0" data-first-offset="true"><span data-slate-string="true"> &lt;kmsp-&gt;so_objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3153"><span data-slate-object="text" data-key="3154"><span data-slate-leaf="true" data-offset-key="3154:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3155"><span data-slate-object="text" data-key="3156"><span data-slate-leaf="true" data-offset-key="3156:0" data-first-offset="true"><span data-slate-string="true">        pages = </span></span></span><span data-slate-object="text" data-key="3157"><span data-slate-leaf="true" data-offset-key="3157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="3158"><span data-slate-leaf="true" data-offset-key="3158:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3159"><span data-slate-object="text" data-key="3160"><span data-slate-leaf="true" data-offset-key="3160:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3161"><span data-slate-object="text" data-key="3162"><span data-slate-leaf="true" data-offset-key="3162:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3163"><span data-slate-leaf="true" data-offset-key="3163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 找物理内存页面管理器分配 2 或者 4 个连续的页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3164"><span data-slate-object="text" data-key="3165"><span data-slate-leaf="true" data-offset-key="3165:0" data-first-offset="true"><span data-slate-string="true">    msa = </span></span></span><span data-slate-object="text" data-key="3166"><span data-slate-leaf="true" data-offset-key="3166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mm_division_pages</span></span></span></span><span data-slate-object="text" data-key="3167"><span data-slate-leaf="true" data-offset-key="3167:0" data-first-offset="true"><span data-slate-string="true">(&amp;memmgrob, pages, &amp;relpnr, MA_TYPE_KRNL, DMF_RELDIV);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3168"><span data-slate-object="text" data-key="3169"><span data-slate-leaf="true" data-offset-key="3169:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3170"><span data-slate-leaf="true" data-offset-key="3170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3171"><span data-slate-leaf="true" data-offset-key="3171:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3172"><span data-slate-leaf="true" data-offset-key="3172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3173"><span data-slate-leaf="true" data-offset-key="3173:0" data-first-offset="true"><span data-slate-string="true"> == msa)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3174"><span data-slate-object="text" data-key="3175"><span data-slate-leaf="true" data-offset-key="3175:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3176"><span data-slate-object="text" data-key="3177"><span data-slate-leaf="true" data-offset-key="3177:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3178"><span data-slate-leaf="true" data-offset-key="3178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3179"><span data-slate-leaf="true" data-offset-key="3179:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3180"><span data-slate-object="text" data-key="3181"><span data-slate-leaf="true" data-offset-key="3181:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3182"><span data-slate-object="text" data-key="3183"><span data-slate-leaf="true" data-offset-key="3183:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3184"><span data-slate-leaf="true" data-offset-key="3184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="3185"><span data-slate-leaf="true" data-offset-key="3185:0" data-first-offset="true"><span data-slate-string="true"> phyadr = msa-&gt;md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3186"><span data-slate-object="text" data-key="3187"><span data-slate-leaf="true" data-offset-key="3187:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3188"><span data-slate-leaf="true" data-offset-key="3188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="3189"><span data-slate-leaf="true" data-offset-key="3189:0" data-first-offset="true"><span data-slate-string="true"> phyade = phyadr + (relpnr &lt;&lt; PSHRSIZE) - </span></span></span><span data-slate-object="text" data-key="3190"><span data-slate-leaf="true" data-offset-key="3190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3191"><span data-slate-leaf="true" data-offset-key="3191:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3192"><span data-slate-object="text" data-key="3193"><span data-slate-leaf="true" data-offset-key="3193:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3194"><span data-slate-leaf="true" data-offset-key="3194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3195"><span data-slate-leaf="true" data-offset-key="3195:0" data-first-offset="true"><span data-slate-string="true"> vadrs = </span></span></span><span data-slate-object="text" data-key="3196"><span data-slate-leaf="true" data-offset-key="3196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="3197"><span data-slate-leaf="true" data-offset-key="3197:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="3198"><span data-slate-leaf="true" data-offset-key="3198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3199"><span data-slate-leaf="true" data-offset-key="3199:0" data-first-offset="true"><span data-slate-string="true">)phyadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3200"><span data-slate-object="text" data-key="3201"><span data-slate-leaf="true" data-offset-key="3201:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3202"><span data-slate-leaf="true" data-offset-key="3202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3203"><span data-slate-leaf="true" data-offset-key="3203:0" data-first-offset="true"><span data-slate-string="true"> vadre = </span></span></span><span data-slate-object="text" data-key="3204"><span data-slate-leaf="true" data-offset-key="3204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="3205"><span data-slate-leaf="true" data-offset-key="3205:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="3206"><span data-slate-leaf="true" data-offset-key="3206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3207"><span data-slate-leaf="true" data-offset-key="3207:0" data-first-offset="true"><span data-slate-string="true">)phyade);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3208"><span data-slate-object="text" data-key="3209"><span data-slate-leaf="true" data-offset-key="3209:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3210"><span data-slate-leaf="true" data-offset-key="3210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 求出物理内存页面数对应在 kmsob_t 的 so_mc.mc_lst 数组中下标</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3211"><span data-slate-object="text" data-key="3212"><span data-slate-leaf="true" data-offset-key="3212:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3213"><span data-slate-leaf="true" data-offset-key="3213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sint_t</span></span></span></span><span data-slate-object="text" data-key="3214"><span data-slate-leaf="true" data-offset-key="3214:0" data-first-offset="true"><span data-slate-string="true"> mscidx = </span></span></span><span data-slate-object="text" data-key="3215"><span data-slate-leaf="true" data-offset-key="3215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">retn_mscidx</span></span></span></span><span data-slate-object="text" data-key="3216"><span data-slate-leaf="true" data-offset-key="3216:0" data-first-offset="true"><span data-slate-string="true">(relpnr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3217"><span data-slate-object="text" data-key="3218"><span data-slate-leaf="true" data-offset-key="3218:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3219"><span data-slate-leaf="true" data-offset-key="3219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把物理内存页面对应的 msadsc_t 结构加入到 kmsob_t 的 so_mc.mc_lst 数组中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3220"><span data-slate-object="text" data-key="3221"><span data-slate-leaf="true" data-offset-key="3221:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3222"><span data-slate-leaf="true" data-offset-key="3222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="3223"><span data-slate-leaf="true" data-offset-key="3223:0" data-first-offset="true"><span data-slate-string="true">(&amp;msa-&gt;md_list, &amp;kmsp-&gt;so_mc.mc_lst[mscidx].ml_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3224"><span data-slate-object="text" data-key="3225"><span data-slate-leaf="true" data-offset-key="3225:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_mc.mc_lst[mscidx].ml_msanr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3226"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3227"><span data-slate-object="text" data-key="3228"><span data-slate-leaf="true" data-offset-key="3228:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3229"><span data-slate-leaf="true" data-offset-key="3229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="3230"><span data-slate-leaf="true" data-offset-key="3230:0" data-first-offset="true"><span data-slate-string="true"> *bextp = (</span></span></span><span data-slate-object="text" data-key="3231"><span data-slate-leaf="true" data-offset-key="3231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="3232"><span data-slate-leaf="true" data-offset-key="3232:0" data-first-offset="true"><span data-slate-string="true"> *)vadrs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3233"><span data-slate-object="text" data-key="3234"><span data-slate-leaf="true" data-offset-key="3234:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3235"><span data-slate-leaf="true" data-offset-key="3235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 kmbext_t 数据结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3236"><span data-slate-object="text" data-key="3237"><span data-slate-leaf="true" data-offset-key="3237:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3238"><span data-slate-leaf="true" data-offset-key="3238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t_init</span></span></span></span><span data-slate-object="text" data-key="3239"><span data-slate-leaf="true" data-offset-key="3239:0" data-first-offset="true"><span data-slate-string="true">(bextp, vadrs, vadre, kmsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3240"><span data-slate-object="text" data-key="3241"><span data-slate-leaf="true" data-offset-key="3241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置内存对象的开始地址为 kmbext_t 结构之后，结束地址为扩展内存页面的结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3242"><span data-slate-object="text" data-key="3243"><span data-slate-leaf="true" data-offset-key="3243:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3244"><span data-slate-leaf="true" data-offset-key="3244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3245"><span data-slate-leaf="true" data-offset-key="3245:0" data-first-offset="true"><span data-slate-string="true"> *fohstat = (</span></span></span><span data-slate-object="text" data-key="3246"><span data-slate-leaf="true" data-offset-key="3246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3247"><span data-slate-leaf="true" data-offset-key="3247:0" data-first-offset="true"><span data-slate-string="true"> *)(bextp + </span></span></span><span data-slate-object="text" data-key="3248"><span data-slate-leaf="true" data-offset-key="3248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3249"><span data-slate-leaf="true" data-offset-key="3249:0" data-first-offset="true"><span data-slate-string="true">), *fohend = (</span></span></span><span data-slate-object="text" data-key="3250"><span data-slate-leaf="true" data-offset-key="3250:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3251"><span data-slate-leaf="true" data-offset-key="3251:0" data-first-offset="true"><span data-slate-string="true"> *)vadre;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3252"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3253"><span data-slate-object="text" data-key="3254"><span data-slate-leaf="true" data-offset-key="3254:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3255"><span data-slate-leaf="true" data-offset-key="3255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3256"><span data-slate-leaf="true" data-offset-key="3256:0" data-first-offset="true"><span data-slate-string="true"> ap = (</span></span></span><span data-slate-object="text" data-key="3257"><span data-slate-leaf="true" data-offset-key="3257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3258"><span data-slate-leaf="true" data-offset-key="3258:0" data-first-offset="true"><span data-slate-string="true">)((</span></span></span><span data-slate-object="text" data-key="3259"><span data-slate-leaf="true" data-offset-key="3259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3260"><span data-slate-leaf="true" data-offset-key="3260:0" data-first-offset="true"><span data-slate-string="true">)fohstat);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3261"><span data-slate-object="text" data-key="3262"><span data-slate-leaf="true" data-offset-key="3262:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3263"><span data-slate-leaf="true" data-offset-key="3263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3264"><span data-slate-leaf="true" data-offset-key="3264:0" data-first-offset="true"><span data-slate-string="true"> *tmpfoh = (</span></span></span><span data-slate-object="text" data-key="3265"><span data-slate-leaf="true" data-offset-key="3265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3266"><span data-slate-leaf="true" data-offset-key="3266:0" data-first-offset="true"><span data-slate-string="true"> *)((</span></span></span><span data-slate-object="text" data-key="3267"><span data-slate-leaf="true" data-offset-key="3267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3268"><span data-slate-leaf="true" data-offset-key="3268:0" data-first-offset="true"><span data-slate-string="true">)ap);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3269"><span data-slate-object="text" data-key="3270"><span data-slate-leaf="true" data-offset-key="3270:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3271"><span data-slate-leaf="true" data-offset-key="3271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="3272"><span data-slate-leaf="true" data-offset-key="3272:0" data-first-offset="true"><span data-slate-string="true"> (; tmpfoh &lt; fohend;)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3273"><span data-slate-object="text" data-key="3274"><span data-slate-leaf="true" data-offset-key="3274:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3275"><span data-slate-object="text" data-key="3276"><span data-slate-leaf="true" data-offset-key="3276:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3277"><span data-slate-leaf="true" data-offset-key="3277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3278"><span data-slate-leaf="true" data-offset-key="3278:0" data-first-offset="true"><span data-slate-string="true"> ((ap + (</span></span></span><span data-slate-object="text" data-key="3279"><span data-slate-leaf="true" data-offset-key="3279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3280"><span data-slate-leaf="true" data-offset-key="3280:0" data-first-offset="true"><span data-slate-string="true">)kmsp-&gt;so_objsz) &lt;= (</span></span></span><span data-slate-object="text" data-key="3281"><span data-slate-leaf="true" data-offset-key="3281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3282"><span data-slate-leaf="true" data-offset-key="3282:0" data-first-offset="true"><span data-slate-string="true">)vadre)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3283"><span data-slate-object="text" data-key="3284"><span data-slate-leaf="true" data-offset-key="3284:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span><span data-slate-object="text" data-key="3285"><span data-slate-leaf="true" data-offset-key="3285:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 在扩展的内存空间中建立内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3286"><span data-slate-object="text" data-key="3287"><span data-slate-leaf="true" data-offset-key="3287:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3288"><span data-slate-leaf="true" data-offset-key="3288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t_init</span></span></span></span><span data-slate-object="text" data-key="3289"><span data-slate-leaf="true" data-offset-key="3289:0" data-first-offset="true"><span data-slate-string="true">(tmpfoh, </span></span></span><span data-slate-object="text" data-key="3290"><span data-slate-leaf="true" data-offset-key="3290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3291"><span data-slate-leaf="true" data-offset-key="3291:0" data-first-offset="true"><span data-slate-string="true">, (</span></span></span><span data-slate-object="text" data-key="3292"><span data-slate-leaf="true" data-offset-key="3292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="3293"><span data-slate-leaf="true" data-offset-key="3293:0" data-first-offset="true"><span data-slate-string="true"> *)tmpfoh);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3294"><span data-slate-object="text" data-key="3295"><span data-slate-leaf="true" data-offset-key="3295:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3296"><span data-slate-leaf="true" data-offset-key="3296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="3297"><span data-slate-leaf="true" data-offset-key="3297:0" data-first-offset="true"><span data-slate-string="true">(&amp;tmpfoh-&gt;oh_list, &amp;kmsp-&gt;so_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3298"><span data-slate-object="text" data-key="3299"><span data-slate-leaf="true" data-offset-key="3299:0" data-first-offset="true"><span data-slate-string="true">            kmsp-&gt;so_mobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3300"><span data-slate-object="text" data-key="3301"><span data-slate-leaf="true" data-offset-key="3301:0" data-first-offset="true"><span data-slate-string="true">            kmsp-&gt;so_fobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3302"><span data-slate-object="text" data-key="3303"><span data-slate-leaf="true" data-offset-key="3303:0" data-first-offset="true"><span data-slate-string="true">            bextp-&gt;mt_mobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3304"><span data-slate-object="text" data-key="3305"><span data-slate-leaf="true" data-offset-key="3305:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3306"><span data-slate-object="text" data-key="3307"><span data-slate-leaf="true" data-offset-key="3307:0" data-first-offset="true"><span data-slate-string="true">        ap += (</span></span></span><span data-slate-object="text" data-key="3308"><span data-slate-leaf="true" data-offset-key="3308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3309"><span data-slate-leaf="true" data-offset-key="3309:0" data-first-offset="true"><span data-slate-string="true">)kmsp-&gt;so_objsz;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3310"><span data-slate-object="text" data-key="3311"><span data-slate-leaf="true" data-offset-key="3311:0" data-first-offset="true"><span data-slate-string="true">        tmpfoh = (</span></span></span><span data-slate-object="text" data-key="3312"><span data-slate-leaf="true" data-offset-key="3312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3313"><span data-slate-leaf="true" data-offset-key="3313:0" data-first-offset="true"><span data-slate-string="true"> *)((</span></span></span><span data-slate-object="text" data-key="3314"><span data-slate-leaf="true" data-offset-key="3314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="3315"><span data-slate-leaf="true" data-offset-key="3315:0" data-first-offset="true"><span data-slate-string="true">)ap);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3316"><span data-slate-object="text" data-key="3317"><span data-slate-leaf="true" data-offset-key="3317:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3318"><span data-slate-object="text" data-key="3319"><span data-slate-leaf="true" data-offset-key="3319:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3320"><span data-slate-leaf="true" data-offset-key="3320:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="3321"><span data-slate-leaf="true" data-offset-key="3321:0" data-first-offset="true"><span data-slate-string="true">(&amp;bextp-&gt;mt_list, &amp;kmsp-&gt;so_mextlst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3322"><span data-slate-object="text" data-key="3323"><span data-slate-leaf="true" data-offset-key="3323:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_mextnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3324"><span data-slate-object="text" data-key="3325"><span data-slate-leaf="true" data-offset-key="3325:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3326"><span data-slate-leaf="true" data-offset-key="3326:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3327"><span data-slate-leaf="true" data-offset-key="3327:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3328"><span data-slate-object="text" data-key="3329"><span data-slate-leaf="true" data-offset-key="3329:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3330"><span data-slate-object="text" data-key="3331"><span data-slate-leaf="true" data-offset-key="3331:0" data-first-offset="true"><span data-slate-string="true">有了前面建立内存对象容器的经验，加上这里的注释，我们理解上述代码并不难：不过是分配了另一块连续的内存空间，作为空闲的内存对象，并且把这块内存空间加内存对象容器中统一管理。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3332" id="sr-toc-11"><span data-slate-object="text" data-key="3333"><span data-slate-leaf="true" data-offset-key="3333:0" data-first-offset="true"><span data-slate-string="true">分配内存对象</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3334"><span data-slate-object="text" data-key="3335"><span data-slate-leaf="true" data-offset-key="3335:0" data-first-offset="true"><span data-slate-string="true">有了内存对象容器，就可以分配内存对象了。由于我们前面精心设计了内存对象容器、内存对象等数据结构，这使得我们的内存对象分配代码时极其简单，而且性能极高。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3336"><span data-slate-object="text" data-key="3337"><span data-slate-leaf="true" data-offset-key="3337:0" data-first-offset="true"><span data-slate-string="true">下面我们来实现它吧！代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="3338"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3339"><span data-slate-object="text" data-key="3340"><span data-slate-leaf="true" data-offset-key="3340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 判断内存对象容器中有没有内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3341"><span data-slate-object="text" data-key="3342"><span data-slate-leaf="true" data-offset-key="3342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span><span data-slate-object="text" data-key="3343"><span data-slate-leaf="true" data-offset-key="3343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3344"><span data-slate-leaf="true" data-offset-key="3344:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_kmob_objnr</span></span></span></span></span><span data-slate-object="text" data-key="3345"><span data-slate-leaf="true" data-offset-key="3345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3346"><span data-slate-leaf="true" data-offset-key="3346:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3347"><span data-slate-leaf="true" data-offset-key="3347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3348"><span data-slate-object="text" data-key="3349"><span data-slate-leaf="true" data-offset-key="3349:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3350"><span data-slate-object="text" data-key="3351"><span data-slate-leaf="true" data-offset-key="3351:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3352"><span data-slate-leaf="true" data-offset-key="3352:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3353"><span data-slate-leaf="true" data-offset-key="3353:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3354"><span data-slate-leaf="true" data-offset-key="3354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3355"><span data-slate-leaf="true" data-offset-key="3355:0" data-first-offset="true"><span data-slate-string="true"> &lt;kmsp-&gt;so_fobjnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3356"><span data-slate-object="text" data-key="3357"><span data-slate-leaf="true" data-offset-key="3357:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3358"><span data-slate-object="text" data-key="3359"><span data-slate-leaf="true" data-offset-key="3359:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3360"><span data-slate-leaf="true" data-offset-key="3360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3361"><span data-slate-leaf="true" data-offset-key="3361:0" data-first-offset="true"><span data-slate-string="true"> kmsp-&gt;so_fobjnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3362"><span data-slate-object="text" data-key="3363"><span data-slate-leaf="true" data-offset-key="3363:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3364"><span data-slate-object="text" data-key="3365"><span data-slate-leaf="true" data-offset-key="3365:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3366"><span data-slate-leaf="true" data-offset-key="3366:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3367"><span data-slate-leaf="true" data-offset-key="3367:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3368"><span data-slate-leaf="true" data-offset-key="3368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3369"><span data-slate-leaf="true" data-offset-key="3369:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3370"><span data-slate-object="text" data-key="3371"><span data-slate-leaf="true" data-offset-key="3371:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3372"><span data-slate-object="text" data-key="3373"><span data-slate-leaf="true" data-offset-key="3373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实际分配内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3374"><span data-slate-object="text" data-key="3375"><span data-slate-leaf="true" data-offset-key="3375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="3376"><span data-slate-leaf="true" data-offset-key="3376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3377"><span data-slate-leaf="true" data-offset-key="3377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_opkmsob</span></span></span></span></span><span data-slate-object="text" data-key="3378"><span data-slate-leaf="true" data-offset-key="3378:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3379"><span data-slate-leaf="true" data-offset-key="3379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3380"><span data-slate-leaf="true" data-offset-key="3380:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="3381"><span data-slate-leaf="true" data-offset-key="3381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3382"><span data-slate-leaf="true" data-offset-key="3382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3383"><span data-slate-object="text" data-key="3384"><span data-slate-leaf="true" data-offset-key="3384:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3385"><span data-slate-object="text" data-key="3386"><span data-slate-leaf="true" data-offset-key="3386:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3387"><span data-slate-leaf="true" data-offset-key="3387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 kmsob_t 中的 so_frelst 链表头的第一个空闲内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3388"><span data-slate-object="text" data-key="3389"><span data-slate-leaf="true" data-offset-key="3389:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3390"><span data-slate-leaf="true" data-offset-key="3390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3391"><span data-slate-leaf="true" data-offset-key="3391:0" data-first-offset="true"><span data-slate-string="true"> *fobh = </span></span></span><span data-slate-object="text" data-key="3392"><span data-slate-leaf="true" data-offset-key="3392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="3393"><span data-slate-leaf="true" data-offset-key="3393:0" data-first-offset="true"><span data-slate-string="true">(kmsp-&gt;so_frelst.next, </span></span></span><span data-slate-object="text" data-key="3394"><span data-slate-leaf="true" data-offset-key="3394:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3395"><span data-slate-leaf="true" data-offset-key="3395:0" data-first-offset="true"><span data-slate-string="true">, oh_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3396"><span data-slate-object="text" data-key="3397"><span data-slate-leaf="true" data-offset-key="3397:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3398"><span data-slate-leaf="true" data-offset-key="3398:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从链表中脱链</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3399"><span data-slate-object="text" data-key="3400"><span data-slate-leaf="true" data-offset-key="3400:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3401"><span data-slate-leaf="true" data-offset-key="3401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_del</span></span></span></span><span data-slate-object="text" data-key="3402"><span data-slate-leaf="true" data-offset-key="3402:0" data-first-offset="true"><span data-slate-string="true">(&amp;fobh-&gt;oh_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3403"><span data-slate-object="text" data-key="3404"><span data-slate-leaf="true" data-offset-key="3404:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3405"><span data-slate-leaf="true" data-offset-key="3405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//kmsob_t 中的空闲对象计数减一</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3406"><span data-slate-object="text" data-key="3407"><span data-slate-leaf="true" data-offset-key="3407:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_fobjnr--;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3408"><span data-slate-object="text" data-key="3409"><span data-slate-leaf="true" data-offset-key="3409:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3410"><span data-slate-leaf="true" data-offset-key="3410:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 返回内存对象首地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3411"><span data-slate-object="text" data-key="3412"><span data-slate-leaf="true" data-offset-key="3412:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3413"><span data-slate-leaf="true" data-offset-key="3413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3414"><span data-slate-leaf="true" data-offset-key="3414:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3415"><span data-slate-leaf="true" data-offset-key="3415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="3416"><span data-slate-leaf="true" data-offset-key="3416:0" data-first-offset="true"><span data-slate-string="true"> *)(fobh);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3417"><span data-slate-object="text" data-key="3418"><span data-slate-leaf="true" data-offset-key="3418:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3419"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3420"><span data-slate-object="text" data-key="3421"><span data-slate-leaf="true" data-offset-key="3421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="3422"><span data-slate-leaf="true" data-offset-key="3422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3423"><span data-slate-leaf="true" data-offset-key="3423:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_onkmsob</span></span></span></span></span><span data-slate-object="text" data-key="3424"><span data-slate-leaf="true" data-offset-key="3424:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3425"><span data-slate-leaf="true" data-offset-key="3425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3426"><span data-slate-leaf="true" data-offset-key="3426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="3427"><span data-slate-leaf="true" data-offset-key="3427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3428"><span data-slate-leaf="true" data-offset-key="3428:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3429"><span data-slate-object="text" data-key="3430"><span data-slate-leaf="true" data-offset-key="3430:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3431"><span data-slate-object="text" data-key="3432"><span data-slate-leaf="true" data-offset-key="3432:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3433"><span data-slate-leaf="true" data-offset-key="3433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="3434"><span data-slate-leaf="true" data-offset-key="3434:0" data-first-offset="true"><span data-slate-string="true"> *retptr = </span></span></span><span data-slate-object="text" data-key="3435"><span data-slate-leaf="true" data-offset-key="3435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3436"><span data-slate-leaf="true" data-offset-key="3436:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3437"><span data-slate-object="text" data-key="3438"><span data-slate-leaf="true" data-offset-key="3438:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3439"><span data-slate-leaf="true" data-offset-key="3439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cpuflg_t</span></span></span></span><span data-slate-object="text" data-key="3440"><span data-slate-leaf="true" data-offset-key="3440:0" data-first-offset="true"><span data-slate-string="true"> cpuflg;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3441"><span data-slate-object="text" data-key="3442"><span data-slate-leaf="true" data-offset-key="3442:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3443"><span data-slate-leaf="true" data-offset-key="3443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_cli</span></span></span></span><span data-slate-object="text" data-key="3444"><span data-slate-leaf="true" data-offset-key="3444:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3445"><span data-slate-object="text" data-key="3446"><span data-slate-leaf="true" data-offset-key="3446:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3447"><span data-slate-leaf="true" data-offset-key="3447:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果内存对象容器中没有空闲的内存对象了就需要扩展内存对象容器的内存了</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3448"><span data-slate-object="text" data-key="3449"><span data-slate-leaf="true" data-offset-key="3449:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3450"><span data-slate-leaf="true" data-offset-key="3450:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3451"><span data-slate-leaf="true" data-offset-key="3451:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3452"><span data-slate-leaf="true" data-offset-key="3452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_kmsob_objnr</span></span></span></span><span data-slate-object="text" data-key="3453"><span data-slate-leaf="true" data-offset-key="3453:0" data-first-offset="true"><span data-slate-string="true">(kmsp) &lt; </span></span></span><span data-slate-object="text" data-key="3454"><span data-slate-leaf="true" data-offset-key="3454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3455"><span data-slate-leaf="true" data-offset-key="3455:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3456"><span data-slate-object="text" data-key="3457"><span data-slate-leaf="true" data-offset-key="3457:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span><span data-slate-object="text" data-key="3458"><span data-slate-leaf="true" data-offset-key="3458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 扩展内存对象容器的内存</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3459"><span data-slate-object="text" data-key="3460"><span data-slate-leaf="true" data-offset-key="3460:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3461"><span data-slate-leaf="true" data-offset-key="3461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3462"><span data-slate-leaf="true" data-offset-key="3462:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3463"><span data-slate-leaf="true" data-offset-key="3463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_extn_pages</span></span></span></span><span data-slate-object="text" data-key="3464"><span data-slate-leaf="true" data-offset-key="3464:0" data-first-offset="true"><span data-slate-string="true">(kmsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3465"><span data-slate-object="text" data-key="3466"><span data-slate-leaf="true" data-offset-key="3466:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3467"><span data-slate-object="text" data-key="3468"><span data-slate-leaf="true" data-offset-key="3468:0" data-first-offset="true"><span data-slate-string="true">            retptr = </span></span></span><span data-slate-object="text" data-key="3469"><span data-slate-leaf="true" data-offset-key="3469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3470"><span data-slate-leaf="true" data-offset-key="3470:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3471"><span data-slate-object="text" data-key="3472"><span data-slate-leaf="true" data-offset-key="3472:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3473"><span data-slate-leaf="true" data-offset-key="3473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="3474"><span data-slate-leaf="true" data-offset-key="3474:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3475"><span data-slate-object="text" data-key="3476"><span data-slate-leaf="true" data-offset-key="3476:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3477"><span data-slate-object="text" data-key="3478"><span data-slate-leaf="true" data-offset-key="3478:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3479"><span data-slate-object="text" data-key="3480"><span data-slate-leaf="true" data-offset-key="3480:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3481"><span data-slate-leaf="true" data-offset-key="3481:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实际分配内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3482"><span data-slate-object="text" data-key="3483"><span data-slate-leaf="true" data-offset-key="3483:0" data-first-offset="true"><span data-slate-string="true">    retptr = </span></span></span><span data-slate-object="text" data-key="3484"><span data-slate-leaf="true" data-offset-key="3484:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_new_opkmsob</span></span></span></span><span data-slate-object="text" data-key="3485"><span data-slate-leaf="true" data-offset-key="3485:0" data-first-offset="true"><span data-slate-string="true">(kmsp, msz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3486"><span data-slate-object="text" data-key="3487"><span data-slate-leaf="true" data-offset-key="3487:0" data-first-offset="true"><span data-slate-string="true">ret_step:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3488"><span data-slate-object="text" data-key="3489"><span data-slate-leaf="true" data-offset-key="3489:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3490"><span data-slate-leaf="true" data-offset-key="3490:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinunlock_sti</span></span></span></span><span data-slate-object="text" data-key="3491"><span data-slate-leaf="true" data-offset-key="3491:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3492"><span data-slate-object="text" data-key="3493"><span data-slate-leaf="true" data-offset-key="3493:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3494"><span data-slate-leaf="true" data-offset-key="3494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3495"><span data-slate-leaf="true" data-offset-key="3495:0" data-first-offset="true"><span data-slate-string="true"> retptr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3496"><span data-slate-object="text" data-key="3497"><span data-slate-leaf="true" data-offset-key="3497:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3498"><span data-slate-object="text" data-key="3499"><span data-slate-leaf="true" data-offset-key="3499:0" data-first-offset="true"><span data-slate-string="true">分配内存对象的核心操作就是，</span></span></span><span data-slate-object="text" data-key="3500"><span data-slate-leaf="true" data-offset-key="3500:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">kmsob_new_opkmsob 函数从空闲内存对象链表头中取出第一个内存对象，返回它的首地址</span></span></span></span><span data-slate-object="text" data-key="3501"><span data-slate-leaf="true" data-offset-key="3501:0" data-first-offset="true"><span data-slate-string="true">。这个算法非常高效，无论内存对象容器中的内存对象有多少，kmsob_new_opkmsob 函数的操作始终是固定的，而如此高效的算法得益于我们先进的数据结构设计。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3502"><span data-slate-object="text" data-key="3503"><span data-slate-leaf="true" data-offset-key="3503:0" data-first-offset="true"><span data-slate-string="true">好了，到这里内存对象的分配就已经完成了，下面我们去实现内存对象的释放。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3504" id="sr-toc-12"><span data-slate-object="text" data-key="3505"><span data-slate-leaf="true" data-offset-key="3505:0" data-first-offset="true"><span data-slate-string="true">释放内存对象</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3506"><span data-slate-object="text" data-key="3507"><span data-slate-leaf="true" data-offset-key="3507:0" data-first-offset="true"><span data-slate-string="true">释放内存对象，就是要把内存对象还给它所归属的内存对象容器。其逻辑就是根据释放内存对象的地址和大小，找到对应的内存对象容器，然后把该内存对象加入到对应内存对象容器的空闲链表上，最后看一看要不要释放内存对象容器占用的物理内存页面。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3508" id="sr-toc-13"><span data-slate-object="text" data-key="3509"><span data-slate-leaf="true" data-offset-key="3509:0" data-first-offset="true"><span data-slate-string="true">释放内存对象的接口</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3510"><span data-slate-object="text" data-key="3511"><span data-slate-leaf="true" data-offset-key="3511:0" data-first-offset="true"><span data-slate-string="true">这里我们依然要从释放内存对象的接口开始实现，下面我们在 kmsob.c 文中写下这个函数，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="3512"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3513"><span data-slate-object="text" data-key="3514"><span data-slate-leaf="true" data-offset-key="3514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="3515"><span data-slate-leaf="true" data-offset-key="3515:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3516"><span data-slate-leaf="true" data-offset-key="3516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_delete_core</span></span></span></span></span><span data-slate-object="text" data-key="3517"><span data-slate-leaf="true" data-offset-key="3517:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3518"><span data-slate-leaf="true" data-offset-key="3518:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="3519"><span data-slate-leaf="true" data-offset-key="3519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="3520"><span data-slate-leaf="true" data-offset-key="3520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3521"><span data-slate-leaf="true" data-offset-key="3521:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3522"><span data-slate-object="text" data-key="3523"><span data-slate-leaf="true" data-offset-key="3523:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3524"><span data-slate-object="text" data-key="3525"><span data-slate-leaf="true" data-offset-key="3525:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3526"><span data-slate-leaf="true" data-offset-key="3526:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="3527"><span data-slate-leaf="true" data-offset-key="3527:0" data-first-offset="true"><span data-slate-string="true"> *kmobmgrp = &amp;memmgrob.mo_kmsobmgr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3528"><span data-slate-object="text" data-key="3529"><span data-slate-leaf="true" data-offset-key="3529:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3530"><span data-slate-leaf="true" data-offset-key="3530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="3531"><span data-slate-leaf="true" data-offset-key="3531:0" data-first-offset="true"><span data-slate-string="true"> rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3532"><span data-slate-object="text" data-key="3533"><span data-slate-leaf="true" data-offset-key="3533:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3534"><span data-slate-leaf="true" data-offset-key="3534:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="3535"><span data-slate-leaf="true" data-offset-key="3535:0" data-first-offset="true"><span data-slate-string="true"> *koblp = </span></span></span><span data-slate-object="text" data-key="3536"><span data-slate-leaf="true" data-offset-key="3536:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3537"><span data-slate-leaf="true" data-offset-key="3537:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3538"><span data-slate-object="text" data-key="3539"><span data-slate-leaf="true" data-offset-key="3539:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3540"><span data-slate-leaf="true" data-offset-key="3540:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="3541"><span data-slate-leaf="true" data-offset-key="3541:0" data-first-offset="true"><span data-slate-string="true"> *kmsp = </span></span></span><span data-slate-object="text" data-key="3542"><span data-slate-leaf="true" data-offset-key="3542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3543"><span data-slate-leaf="true" data-offset-key="3543:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3544"><span data-slate-object="text" data-key="3545"><span data-slate-leaf="true" data-offset-key="3545:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3546"><span data-slate-leaf="true" data-offset-key="3546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cpuflg_t</span></span></span></span><span data-slate-object="text" data-key="3547"><span data-slate-leaf="true" data-offset-key="3547:0" data-first-offset="true"><span data-slate-string="true"> cpuflg;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3548"><span data-slate-object="text" data-key="3549"><span data-slate-leaf="true" data-offset-key="3549:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3550"><span data-slate-leaf="true" data-offset-key="3550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_cli</span></span></span></span><span data-slate-object="text" data-key="3551"><span data-slate-leaf="true" data-offset-key="3551:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmobmgrp-&gt;ks_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3552"><span data-slate-object="text" data-key="3553"><span data-slate-leaf="true" data-offset-key="3553:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3554"><span data-slate-leaf="true" data-offset-key="3554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 根据释放内存对象的大小在 kmsobmgrhed_t 中查找并返回 koblst_t，在其中挂载着对应的 kmsob_t，这个在前面已经写好了</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3555"><span data-slate-object="text" data-key="3556"><span data-slate-leaf="true" data-offset-key="3556:0" data-first-offset="true"><span data-slate-string="true">    koblp = </span></span></span><span data-slate-object="text" data-key="3557"><span data-slate-leaf="true" data-offset-key="3557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onmsz_retn_koblst</span></span></span></span><span data-slate-object="text" data-key="3558"><span data-slate-leaf="true" data-offset-key="3558:0" data-first-offset="true"><span data-slate-string="true">(kmobmgrp, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3559"><span data-slate-object="text" data-key="3560"><span data-slate-leaf="true" data-offset-key="3560:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3561"><span data-slate-leaf="true" data-offset-key="3561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3562"><span data-slate-leaf="true" data-offset-key="3562:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3563"><span data-slate-leaf="true" data-offset-key="3563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3564"><span data-slate-leaf="true" data-offset-key="3564:0" data-first-offset="true"><span data-slate-string="true"> == koblp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3565"><span data-slate-object="text" data-key="3566"><span data-slate-leaf="true" data-offset-key="3566:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3567"><span data-slate-object="text" data-key="3568"><span data-slate-leaf="true" data-offset-key="3568:0" data-first-offset="true"><span data-slate-string="true">        rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3569"><span data-slate-object="text" data-key="3570"><span data-slate-leaf="true" data-offset-key="3570:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3571"><span data-slate-leaf="true" data-offset-key="3571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="3572"><span data-slate-leaf="true" data-offset-key="3572:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3573"><span data-slate-object="text" data-key="3574"><span data-slate-leaf="true" data-offset-key="3574:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3575"><span data-slate-object="text" data-key="3576"><span data-slate-leaf="true" data-offset-key="3576:0" data-first-offset="true"><span data-slate-string="true">    kmsp = </span></span></span><span data-slate-object="text" data-key="3577"><span data-slate-leaf="true" data-offset-key="3577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onkoblst_retn_delkmsob</span></span></span></span><span data-slate-object="text" data-key="3578"><span data-slate-leaf="true" data-offset-key="3578:0" data-first-offset="true"><span data-slate-string="true">(koblp, fadrs, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3579"><span data-slate-object="text" data-key="3580"><span data-slate-leaf="true" data-offset-key="3580:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3581"><span data-slate-leaf="true" data-offset-key="3581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3582"><span data-slate-leaf="true" data-offset-key="3582:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3583"><span data-slate-leaf="true" data-offset-key="3583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3584"><span data-slate-leaf="true" data-offset-key="3584:0" data-first-offset="true"><span data-slate-string="true"> == kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3585"><span data-slate-object="text" data-key="3586"><span data-slate-leaf="true" data-offset-key="3586:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3587"><span data-slate-object="text" data-key="3588"><span data-slate-leaf="true" data-offset-key="3588:0" data-first-offset="true"><span data-slate-string="true">        rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3589"><span data-slate-object="text" data-key="3590"><span data-slate-leaf="true" data-offset-key="3590:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3591"><span data-slate-leaf="true" data-offset-key="3591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="3592"><span data-slate-leaf="true" data-offset-key="3592:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3593"><span data-slate-object="text" data-key="3594"><span data-slate-leaf="true" data-offset-key="3594:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3595"><span data-slate-object="text" data-key="3596"><span data-slate-leaf="true" data-offset-key="3596:0" data-first-offset="true"><span data-slate-string="true">    rets = </span></span></span><span data-slate-object="text" data-key="3597"><span data-slate-leaf="true" data-offset-key="3597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_delete_onkmsob</span></span></span></span><span data-slate-object="text" data-key="3598"><span data-slate-leaf="true" data-offset-key="3598:0" data-first-offset="true"><span data-slate-string="true">(kmsp, fadrs, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3599"><span data-slate-object="text" data-key="3600"><span data-slate-leaf="true" data-offset-key="3600:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3601"><span data-slate-leaf="true" data-offset-key="3601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3602"><span data-slate-leaf="true" data-offset-key="3602:0" data-first-offset="true"><span data-slate-string="true"> (FALSE == rets)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3603"><span data-slate-object="text" data-key="3604"><span data-slate-leaf="true" data-offset-key="3604:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3605"><span data-slate-object="text" data-key="3606"><span data-slate-leaf="true" data-offset-key="3606:0" data-first-offset="true"><span data-slate-string="true">        rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3607"><span data-slate-object="text" data-key="3608"><span data-slate-leaf="true" data-offset-key="3608:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3609"><span data-slate-leaf="true" data-offset-key="3609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="3610"><span data-slate-leaf="true" data-offset-key="3610:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3611"><span data-slate-object="text" data-key="3612"><span data-slate-leaf="true" data-offset-key="3612:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3613"><span data-slate-object="text" data-key="3614"><span data-slate-leaf="true" data-offset-key="3614:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3615"><span data-slate-leaf="true" data-offset-key="3615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3616"><span data-slate-leaf="true" data-offset-key="3616:0" data-first-offset="true"><span data-slate-string="true"> (_destroy_kmsob(kmobmgrp, koblp, kmsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3617"><span data-slate-object="text" data-key="3618"><span data-slate-leaf="true" data-offset-key="3618:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3619"><span data-slate-object="text" data-key="3620"><span data-slate-leaf="true" data-offset-key="3620:0" data-first-offset="true"><span data-slate-string="true">        rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3621"><span data-slate-object="text" data-key="3622"><span data-slate-leaf="true" data-offset-key="3622:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3623"><span data-slate-leaf="true" data-offset-key="3623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="3624"><span data-slate-leaf="true" data-offset-key="3624:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3625"><span data-slate-object="text" data-key="3626"><span data-slate-leaf="true" data-offset-key="3626:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3627"><span data-slate-object="text" data-key="3628"><span data-slate-leaf="true" data-offset-key="3628:0" data-first-offset="true"><span data-slate-string="true">    rets = TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3629"><span data-slate-object="text" data-key="3630"><span data-slate-leaf="true" data-offset-key="3630:0" data-first-offset="true"><span data-slate-string="true">ret_step:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3631"><span data-slate-object="text" data-key="3632"><span data-slate-leaf="true" data-offset-key="3632:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3633"><span data-slate-leaf="true" data-offset-key="3633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinunlock_sti</span></span></span></span><span data-slate-object="text" data-key="3634"><span data-slate-leaf="true" data-offset-key="3634:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmobmgrp-&gt;ks_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3635"><span data-slate-object="text" data-key="3636"><span data-slate-leaf="true" data-offset-key="3636:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3637"><span data-slate-leaf="true" data-offset-key="3637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3638"><span data-slate-leaf="true" data-offset-key="3638:0" data-first-offset="true"><span data-slate-string="true"> rets;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3639"><span data-slate-object="text" data-key="3640"><span data-slate-leaf="true" data-offset-key="3640:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3641"><span data-slate-object="text" data-key="3642"><span data-slate-leaf="true" data-offset-key="3642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放内存对象接口</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3643"><span data-slate-object="text" data-key="3644"><span data-slate-leaf="true" data-offset-key="3644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="3645"><span data-slate-leaf="true" data-offset-key="3645:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3646"><span data-slate-leaf="true" data-offset-key="3646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_delete</span></span></span></span></span><span data-slate-object="text" data-key="3647"><span data-slate-leaf="true" data-offset-key="3647:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3648"><span data-slate-leaf="true" data-offset-key="3648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="3649"><span data-slate-leaf="true" data-offset-key="3649:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="3650"><span data-slate-leaf="true" data-offset-key="3650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3651"><span data-slate-leaf="true" data-offset-key="3651:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3652"><span data-slate-object="text" data-key="3653"><span data-slate-leaf="true" data-offset-key="3653:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3654"><span data-slate-object="text" data-key="3655"><span data-slate-leaf="true" data-offset-key="3655:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3656"><span data-slate-leaf="true" data-offset-key="3656:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对参数进行检查，但是多了对内存对象地址的检查 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3657"><span data-slate-object="text" data-key="3658"><span data-slate-leaf="true" data-offset-key="3658:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3659"><span data-slate-leaf="true" data-offset-key="3659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3660"><span data-slate-leaf="true" data-offset-key="3660:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3661"><span data-slate-leaf="true" data-offset-key="3661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3662"><span data-slate-leaf="true" data-offset-key="3662:0" data-first-offset="true"><span data-slate-string="true"> == fadrs || </span></span></span><span data-slate-object="text" data-key="3663"><span data-slate-leaf="true" data-offset-key="3663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3664"><span data-slate-leaf="true" data-offset-key="3664:0" data-first-offset="true"><span data-slate-string="true"> &gt; fsz || </span></span></span><span data-slate-object="text" data-key="3665"><span data-slate-leaf="true" data-offset-key="3665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2048</span></span></span></span><span data-slate-object="text" data-key="3666"><span data-slate-leaf="true" data-offset-key="3666:0" data-first-offset="true"><span data-slate-string="true"> &lt;fsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3667"><span data-slate-object="text" data-key="3668"><span data-slate-leaf="true" data-offset-key="3668:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3669"><span data-slate-object="text" data-key="3670"><span data-slate-leaf="true" data-offset-key="3670:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3671"><span data-slate-leaf="true" data-offset-key="3671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3672"><span data-slate-leaf="true" data-offset-key="3672:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3673"><span data-slate-object="text" data-key="3674"><span data-slate-leaf="true" data-offset-key="3674:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3675"><span data-slate-object="text" data-key="3676"><span data-slate-leaf="true" data-offset-key="3676:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3677"><span data-slate-leaf="true" data-offset-key="3677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 调用释放内存对象的核心函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3678"><span data-slate-object="text" data-key="3679"><span data-slate-leaf="true" data-offset-key="3679:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3680"><span data-slate-leaf="true" data-offset-key="3680:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3681"><span data-slate-leaf="true" data-offset-key="3681:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3682"><span data-slate-leaf="true" data-offset-key="3682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_delete_core</span></span></span></span><span data-slate-object="text" data-key="3683"><span data-slate-leaf="true" data-offset-key="3683:0" data-first-offset="true"><span data-slate-string="true">(fadrs, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3684"><span data-slate-object="text" data-key="3685"><span data-slate-leaf="true" data-offset-key="3685:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3686"><span data-slate-object="text" data-key="3687"><span data-slate-leaf="true" data-offset-key="3687:0" data-first-offset="true"><span data-slate-string="true">上述代码中，等到 kmsob_delete 函数检查参数通过之后，就调用释放内存对象的核心函数 kmsob_delete_core，在这个函数中，一开始根据释放内存对象大小，找到挂载其 kmsob_t 结构的 koblst_t 结构，接着又做了一系列的操作，这些操作正是我们接下来要实现的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3688" id="sr-toc-14"><span data-slate-object="text" data-key="3689"><span data-slate-leaf="true" data-offset-key="3689:0" data-first-offset="true"><span data-slate-string="true">查找内存对象容器</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3690"><span data-slate-object="text" data-key="3691"><span data-slate-leaf="true" data-offset-key="3691:0" data-first-offset="true"><span data-slate-string="true">释放内存对象，首先要找到这个将要释放的内存对象所属的内存对象容器。释放时的查找和分配时的查找不一样，因为要检查</span></span></span><span data-slate-object="text" data-key="3692"><span data-slate-leaf="true" data-offset-key="3692:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">释放的内存对象是不是属于该内存对象容器。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3693"><span data-slate-object="text" data-key="3694"><span data-slate-leaf="true" data-offset-key="3694:0" data-first-offset="true"><span data-slate-string="true">下面我们一起来实现这个函数，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="3695"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3696"><span data-slate-object="text" data-key="3697"><span data-slate-leaf="true" data-offset-key="3697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查释放的内存对象是不是在 kmsob_t 结构中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3698"><span data-slate-object="text" data-key="3699"><span data-slate-leaf="true" data-offset-key="3699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span><span data-slate-object="text" data-key="3700"><span data-slate-leaf="true" data-offset-key="3700:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3701"><span data-slate-leaf="true" data-offset-key="3701:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_delkmsob_isok</span></span></span></span></span><span data-slate-object="text" data-key="3702"><span data-slate-leaf="true" data-offset-key="3702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3703"><span data-slate-leaf="true" data-offset-key="3703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3704"><span data-slate-leaf="true" data-offset-key="3704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="3705"><span data-slate-leaf="true" data-offset-key="3705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="3706"><span data-slate-leaf="true" data-offset-key="3706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="3707"><span data-slate-leaf="true" data-offset-key="3707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3708"><span data-slate-leaf="true" data-offset-key="3708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3709"><span data-slate-object="text" data-key="3710"><span data-slate-leaf="true" data-offset-key="3710:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="3711"><span data-slate-leaf="true" data-offset-key="3711:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查释放内存对象的地址是否落在 kmsob_t 结构的地址区间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3712"><span data-slate-object="text" data-key="3713"><span data-slate-leaf="true" data-offset-key="3713:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3714"><span data-slate-leaf="true" data-offset-key="3714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3715"><span data-slate-leaf="true" data-offset-key="3715:0" data-first-offset="true"><span data-slate-string="true"> ((</span></span></span><span data-slate-object="text" data-key="3716"><span data-slate-leaf="true" data-offset-key="3716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3717"><span data-slate-leaf="true" data-offset-key="3717:0" data-first-offset="true"><span data-slate-string="true">)fadrs &gt;= (kmsp-&gt;so_vstat + </span></span></span><span data-slate-object="text" data-key="3718"><span data-slate-leaf="true" data-offset-key="3718:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="3719"><span data-slate-leaf="true" data-offset-key="3719:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3720"><span data-slate-leaf="true" data-offset-key="3720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="3721"><span data-slate-leaf="true" data-offset-key="3721:0" data-first-offset="true"><span data-slate-string="true">)) &amp;&amp; ((</span></span></span><span data-slate-object="text" data-key="3722"><span data-slate-leaf="true" data-offset-key="3722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3723"><span data-slate-leaf="true" data-offset-key="3723:0" data-first-offset="true"><span data-slate-string="true">)fadrs + (</span></span></span><span data-slate-object="text" data-key="3724"><span data-slate-leaf="true" data-offset-key="3724:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3725"><span data-slate-leaf="true" data-offset-key="3725:0" data-first-offset="true"><span data-slate-string="true">)fsz) &lt;= kmsp-&gt;so_vend)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3726"><span data-slate-object="text" data-key="3727"><span data-slate-leaf="true" data-offset-key="3727:0" data-first-offset="true"><span data-slate-string="true">    {    </span></span></span><span data-slate-object="text" data-key="3728"><span data-slate-leaf="true" data-offset-key="3728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查释放内存对象的大小是否小于等于 kmsob_t 内存对象容器的对象大小 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3729"><span data-slate-object="text" data-key="3730"><span data-slate-leaf="true" data-offset-key="3730:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3731"><span data-slate-leaf="true" data-offset-key="3731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3732"><span data-slate-leaf="true" data-offset-key="3732:0" data-first-offset="true"><span data-slate-string="true"> (fsz &lt;= kmsp-&gt;so_objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3733"><span data-slate-object="text" data-key="3734"><span data-slate-leaf="true" data-offset-key="3734:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3735"><span data-slate-object="text" data-key="3736"><span data-slate-leaf="true" data-offset-key="3736:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3737"><span data-slate-leaf="true" data-offset-key="3737:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3738"><span data-slate-leaf="true" data-offset-key="3738:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3739"><span data-slate-object="text" data-key="3740"><span data-slate-leaf="true" data-offset-key="3740:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3741"><span data-slate-object="text" data-key="3742"><span data-slate-leaf="true" data-offset-key="3742:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3743"><span data-slate-object="text" data-key="3744"><span data-slate-leaf="true" data-offset-key="3744:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3745"><span data-slate-leaf="true" data-offset-key="3745:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3746"><span data-slate-leaf="true" data-offset-key="3746:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3747"><span data-slate-leaf="true" data-offset-key="3747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3748"><span data-slate-leaf="true" data-offset-key="3748:0" data-first-offset="true"><span data-slate-string="true"> &gt; kmsp-&gt;so_mextnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3749"><span data-slate-object="text" data-key="3750"><span data-slate-leaf="true" data-offset-key="3750:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span><span data-slate-object="text" data-key="3751"><span data-slate-leaf="true" data-offset-key="3751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果 kmsob_t 结构没有扩展空间，直接返回</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3752"><span data-slate-object="text" data-key="3753"><span data-slate-leaf="true" data-offset-key="3753:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3754"><span data-slate-leaf="true" data-offset-key="3754:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3755"><span data-slate-leaf="true" data-offset-key="3755:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3756"><span data-slate-leaf="true" data-offset-key="3756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3757"><span data-slate-leaf="true" data-offset-key="3757:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3758"><span data-slate-object="text" data-key="3759"><span data-slate-leaf="true" data-offset-key="3759:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3760"><span data-slate-object="text" data-key="3761"><span data-slate-leaf="true" data-offset-key="3761:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3762"><span data-slate-leaf="true" data-offset-key="3762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="3763"><span data-slate-leaf="true" data-offset-key="3763:0" data-first-offset="true"><span data-slate-string="true"> *bexp = </span></span></span><span data-slate-object="text" data-key="3764"><span data-slate-leaf="true" data-offset-key="3764:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3765"><span data-slate-leaf="true" data-offset-key="3765:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3766"><span data-slate-object="text" data-key="3767"><span data-slate-leaf="true" data-offset-key="3767:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3768"><span data-slate-leaf="true" data-offset-key="3768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="3769"><span data-slate-leaf="true" data-offset-key="3769:0" data-first-offset="true"><span data-slate-string="true"> *tmplst = </span></span></span><span data-slate-object="text" data-key="3770"><span data-slate-leaf="true" data-offset-key="3770:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3771"><span data-slate-leaf="true" data-offset-key="3771:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3772"><span data-slate-object="text" data-key="3773"><span data-slate-leaf="true" data-offset-key="3773:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3774"><span data-slate-leaf="true" data-offset-key="3774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历 kmsob_t 结构中的每个扩展空间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3775"><span data-slate-object="text" data-key="3776"><span data-slate-leaf="true" data-offset-key="3776:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3777"><span data-slate-leaf="true" data-offset-key="3777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_for_each</span></span></span></span><span data-slate-object="text" data-key="3778"><span data-slate-leaf="true" data-offset-key="3778:0" data-first-offset="true"><span data-slate-string="true">(tmplst, &amp;kmsp-&gt;so_mextlst)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3779"><span data-slate-object="text" data-key="3780"><span data-slate-leaf="true" data-offset-key="3780:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3781"><span data-slate-object="text" data-key="3782"><span data-slate-leaf="true" data-offset-key="3782:0" data-first-offset="true"><span data-slate-string="true">        bexp = </span></span></span><span data-slate-object="text" data-key="3783"><span data-slate-leaf="true" data-offset-key="3783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="3784"><span data-slate-leaf="true" data-offset-key="3784:0" data-first-offset="true"><span data-slate-string="true">(tmplst, </span></span></span><span data-slate-object="text" data-key="3785"><span data-slate-leaf="true" data-offset-key="3785:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="3786"><span data-slate-leaf="true" data-offset-key="3786:0" data-first-offset="true"><span data-slate-string="true">, mt_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3787"><span data-slate-object="text" data-key="3788"><span data-slate-leaf="true" data-offset-key="3788:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3789"><span data-slate-leaf="true" data-offset-key="3789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查释放内存对象的地址是否落在扩展空间的地址区间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3790"><span data-slate-object="text" data-key="3791"><span data-slate-leaf="true" data-offset-key="3791:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3792"><span data-slate-leaf="true" data-offset-key="3792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3793"><span data-slate-leaf="true" data-offset-key="3793:0" data-first-offset="true"><span data-slate-string="true"> ((</span></span></span><span data-slate-object="text" data-key="3794"><span data-slate-leaf="true" data-offset-key="3794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3795"><span data-slate-leaf="true" data-offset-key="3795:0" data-first-offset="true"><span data-slate-string="true">)fadrs &gt;= (bexp-&gt;mt_vstat + </span></span></span><span data-slate-object="text" data-key="3796"><span data-slate-leaf="true" data-offset-key="3796:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="3797"><span data-slate-leaf="true" data-offset-key="3797:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3798"><span data-slate-leaf="true" data-offset-key="3798:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmbext_t</span></span></span></span><span data-slate-object="text" data-key="3799"><span data-slate-leaf="true" data-offset-key="3799:0" data-first-offset="true"><span data-slate-string="true">)) &amp;&amp; ((</span></span></span><span data-slate-object="text" data-key="3800"><span data-slate-leaf="true" data-offset-key="3800:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3801"><span data-slate-leaf="true" data-offset-key="3801:0" data-first-offset="true"><span data-slate-string="true">)fadrs + (</span></span></span><span data-slate-object="text" data-key="3802"><span data-slate-leaf="true" data-offset-key="3802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="3803"><span data-slate-leaf="true" data-offset-key="3803:0" data-first-offset="true"><span data-slate-string="true">)fsz) &lt;= bexp-&gt;mt_vend)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3804"><span data-slate-object="text" data-key="3805"><span data-slate-leaf="true" data-offset-key="3805:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span><span data-slate-object="text" data-key="3806"><span data-slate-leaf="true" data-offset-key="3806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 同样的要检查大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3807"><span data-slate-object="text" data-key="3808"><span data-slate-leaf="true" data-offset-key="3808:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3809"><span data-slate-leaf="true" data-offset-key="3809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3810"><span data-slate-leaf="true" data-offset-key="3810:0" data-first-offset="true"><span data-slate-string="true"> (fsz &lt;= kmsp-&gt;so_objsz)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3811"><span data-slate-object="text" data-key="3812"><span data-slate-leaf="true" data-offset-key="3812:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3813"><span data-slate-object="text" data-key="3814"><span data-slate-leaf="true" data-offset-key="3814:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="3815"><span data-slate-leaf="true" data-offset-key="3815:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3816"><span data-slate-leaf="true" data-offset-key="3816:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3817"><span data-slate-object="text" data-key="3818"><span data-slate-leaf="true" data-offset-key="3818:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3819"><span data-slate-object="text" data-key="3820"><span data-slate-leaf="true" data-offset-key="3820:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3821"><span data-slate-object="text" data-key="3822"><span data-slate-leaf="true" data-offset-key="3822:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3823"><span data-slate-object="text" data-key="3824"><span data-slate-leaf="true" data-offset-key="3824:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3825"><span data-slate-leaf="true" data-offset-key="3825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3826"><span data-slate-leaf="true" data-offset-key="3826:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3827"><span data-slate-leaf="true" data-offset-key="3827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3828"><span data-slate-leaf="true" data-offset-key="3828:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3829"><span data-slate-object="text" data-key="3830"><span data-slate-leaf="true" data-offset-key="3830:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3831"><span data-slate-object="text" data-key="3832"><span data-slate-leaf="true" data-offset-key="3832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 查找释放内存对象所属的 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3833"><span data-slate-object="text" data-key="3834"><span data-slate-leaf="true" data-offset-key="3834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span><span data-slate-object="text" data-key="3835"><span data-slate-leaf="true" data-offset-key="3835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *</span></span></span></span><span data-slate-object="text" data-key="3836"><span data-slate-leaf="true" data-offset-key="3836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">onkoblst_retn_delkmsob</span></span></span></span></span><span data-slate-object="text" data-key="3837"><span data-slate-leaf="true" data-offset-key="3837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3838"><span data-slate-leaf="true" data-offset-key="3838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3839"><span data-slate-leaf="true" data-offset-key="3839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *koblp, </span></span></span></span></span><span data-slate-object="text" data-key="3840"><span data-slate-leaf="true" data-offset-key="3840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="3841"><span data-slate-leaf="true" data-offset-key="3841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="3842"><span data-slate-leaf="true" data-offset-key="3842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3843"><span data-slate-leaf="true" data-offset-key="3843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3844"><span data-slate-object="text" data-key="3845"><span data-slate-leaf="true" data-offset-key="3845:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3846"><span data-slate-object="text" data-key="3847"><span data-slate-leaf="true" data-offset-key="3847:0" data-first-offset="true"><span data-slate-string="true">    v *kmsp = </span></span></span><span data-slate-object="text" data-key="3848"><span data-slate-leaf="true" data-offset-key="3848:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3849"><span data-slate-leaf="true" data-offset-key="3849:0" data-first-offset="true"><span data-slate-string="true">, *tkmsp = </span></span></span><span data-slate-object="text" data-key="3850"><span data-slate-leaf="true" data-offset-key="3850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3851"><span data-slate-leaf="true" data-offset-key="3851:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3852"><span data-slate-object="text" data-key="3853"><span data-slate-leaf="true" data-offset-key="3853:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3854"><span data-slate-leaf="true" data-offset-key="3854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="3855"><span data-slate-leaf="true" data-offset-key="3855:0" data-first-offset="true"><span data-slate-string="true"> *tmplst = </span></span></span><span data-slate-object="text" data-key="3856"><span data-slate-leaf="true" data-offset-key="3856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3857"><span data-slate-leaf="true" data-offset-key="3857:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3858"><span data-slate-object="text" data-key="3859"><span data-slate-leaf="true" data-offset-key="3859:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3860"><span data-slate-leaf="true" data-offset-key="3860:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 看看上次刚刚操作的 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3861"><span data-slate-object="text" data-key="3862"><span data-slate-leaf="true" data-offset-key="3862:0" data-first-offset="true"><span data-slate-string="true">    kmsp = </span></span></span><span data-slate-object="text" data-key="3863"><span data-slate-leaf="true" data-offset-key="3863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_delkmsob_isok</span></span></span></span><span data-slate-object="text" data-key="3864"><span data-slate-leaf="true" data-offset-key="3864:0" data-first-offset="true"><span data-slate-string="true">(koblp-&gt;ol_cahe, fadrs, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3865"><span data-slate-object="text" data-key="3866"><span data-slate-leaf="true" data-offset-key="3866:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3867"><span data-slate-leaf="true" data-offset-key="3867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3868"><span data-slate-leaf="true" data-offset-key="3868:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3869"><span data-slate-leaf="true" data-offset-key="3869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3870"><span data-slate-leaf="true" data-offset-key="3870:0" data-first-offset="true"><span data-slate-string="true"> != kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3871"><span data-slate-object="text" data-key="3872"><span data-slate-leaf="true" data-offset-key="3872:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3873"><span data-slate-object="text" data-key="3874"><span data-slate-leaf="true" data-offset-key="3874:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3875"><span data-slate-leaf="true" data-offset-key="3875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3876"><span data-slate-leaf="true" data-offset-key="3876:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3877"><span data-slate-object="text" data-key="3878"><span data-slate-leaf="true" data-offset-key="3878:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3879"><span data-slate-object="text" data-key="3880"><span data-slate-leaf="true" data-offset-key="3880:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3881"><span data-slate-leaf="true" data-offset-key="3881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3882"><span data-slate-leaf="true" data-offset-key="3882:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3883"><span data-slate-leaf="true" data-offset-key="3883:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3884"><span data-slate-leaf="true" data-offset-key="3884:0" data-first-offset="true"><span data-slate-string="true"> &lt;koblp-&gt;ol_emnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3885"><span data-slate-object="text" data-key="3886"><span data-slate-leaf="true" data-offset-key="3886:0" data-first-offset="true"><span data-slate-string="true">    {    </span></span></span><span data-slate-object="text" data-key="3887"><span data-slate-leaf="true" data-offset-key="3887:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历挂载 koblp-&gt;ol_emplst 链表上的每个 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3888"><span data-slate-object="text" data-key="3889"><span data-slate-leaf="true" data-offset-key="3889:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3890"><span data-slate-leaf="true" data-offset-key="3890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_for_each</span></span></span></span><span data-slate-object="text" data-key="3891"><span data-slate-leaf="true" data-offset-key="3891:0" data-first-offset="true"><span data-slate-string="true">(tmplst, &amp;koblp-&gt;ol_emplst)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3892"><span data-slate-object="text" data-key="3893"><span data-slate-leaf="true" data-offset-key="3893:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3894"><span data-slate-object="text" data-key="3895"><span data-slate-leaf="true" data-offset-key="3895:0" data-first-offset="true"><span data-slate-string="true">            tkmsp = </span></span></span><span data-slate-object="text" data-key="3896"><span data-slate-leaf="true" data-offset-key="3896:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="3897"><span data-slate-leaf="true" data-offset-key="3897:0" data-first-offset="true"><span data-slate-string="true">(tmplst, </span></span></span><span data-slate-object="text" data-key="3898"><span data-slate-leaf="true" data-offset-key="3898:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="3899"><span data-slate-leaf="true" data-offset-key="3899:0" data-first-offset="true"><span data-slate-string="true">, so_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3900"><span data-slate-object="text" data-key="3901"><span data-slate-leaf="true" data-offset-key="3901:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3902"><span data-slate-leaf="true" data-offset-key="3902:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查释放的内存对象是不是属于这个 kmsob_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3903"><span data-slate-object="text" data-key="3904"><span data-slate-leaf="true" data-offset-key="3904:0" data-first-offset="true"><span data-slate-string="true">            kmsp = </span></span></span><span data-slate-object="text" data-key="3905"><span data-slate-leaf="true" data-offset-key="3905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_delkmsob_isok</span></span></span></span><span data-slate-object="text" data-key="3906"><span data-slate-leaf="true" data-offset-key="3906:0" data-first-offset="true"><span data-slate-string="true">(tkmsp, fadrs, fsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3907"><span data-slate-object="text" data-key="3908"><span data-slate-leaf="true" data-offset-key="3908:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3909"><span data-slate-leaf="true" data-offset-key="3909:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3910"><span data-slate-leaf="true" data-offset-key="3910:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3911"><span data-slate-leaf="true" data-offset-key="3911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3912"><span data-slate-leaf="true" data-offset-key="3912:0" data-first-offset="true"><span data-slate-string="true"> != kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3913"><span data-slate-object="text" data-key="3914"><span data-slate-leaf="true" data-offset-key="3914:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3915"><span data-slate-object="text" data-key="3916"><span data-slate-leaf="true" data-offset-key="3916:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="3917"><span data-slate-leaf="true" data-offset-key="3917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3918"><span data-slate-leaf="true" data-offset-key="3918:0" data-first-offset="true"><span data-slate-string="true"> kmsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3919"><span data-slate-object="text" data-key="3920"><span data-slate-leaf="true" data-offset-key="3920:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3921"><span data-slate-object="text" data-key="3922"><span data-slate-leaf="true" data-offset-key="3922:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3923"><span data-slate-object="text" data-key="3924"><span data-slate-leaf="true" data-offset-key="3924:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3925"><span data-slate-object="text" data-key="3926"><span data-slate-leaf="true" data-offset-key="3926:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3927"><span data-slate-leaf="true" data-offset-key="3927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3928"><span data-slate-leaf="true" data-offset-key="3928:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3929"><span data-slate-leaf="true" data-offset-key="3929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="3930"><span data-slate-leaf="true" data-offset-key="3930:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3931"><span data-slate-object="text" data-key="3932"><span data-slate-leaf="true" data-offset-key="3932:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3933"><span data-slate-object="text" data-key="3934"><span data-slate-leaf="true" data-offset-key="3934:0" data-first-offset="true"><span data-slate-string="true">上面的代码注释已经很明白了，搜索对应 koblst_t 结构中的每个 kmsob_t 结构体，随后进行检查，检查了 kmsob_t 结构的自身内存区域和扩展内存区域。即比较释放内存对象的地址是不是落在它们的内存区间中，其大小是否合乎要求。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3935" id="sr-toc-15"><span data-slate-object="text" data-key="3936"><span data-slate-leaf="true" data-offset-key="3936:0" data-first-offset="true"><span data-slate-string="true">释放内存对象</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3937"><span data-slate-object="text" data-key="3938"><span data-slate-leaf="true" data-offset-key="3938:0" data-first-offset="true"><span data-slate-string="true">如果不出意外，会找到释放内存对象的 kmsob_t 结构，这样就可以释放内存对象了，就是把这块内存空间还给内存对象容器，这个过程的具体代码实现如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="3939"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3940"><span data-slate-object="text" data-key="3941"><span data-slate-leaf="true" data-offset-key="3941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="3942"><span data-slate-leaf="true" data-offset-key="3942:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="3943"><span data-slate-leaf="true" data-offset-key="3943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_del_opkmsob</span></span></span></span></span><span data-slate-object="text" data-key="3944"><span data-slate-leaf="true" data-offset-key="3944:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="3945"><span data-slate-leaf="true" data-offset-key="3945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3946"><span data-slate-leaf="true" data-offset-key="3946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="3947"><span data-slate-leaf="true" data-offset-key="3947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="3948"><span data-slate-leaf="true" data-offset-key="3948:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="3949"><span data-slate-leaf="true" data-offset-key="3949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="3950"><span data-slate-leaf="true" data-offset-key="3950:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3951"><span data-slate-object="text" data-key="3952"><span data-slate-leaf="true" data-offset-key="3952:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3953"><span data-slate-object="text" data-key="3954"><span data-slate-leaf="true" data-offset-key="3954:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3955"><span data-slate-leaf="true" data-offset-key="3955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3956"><span data-slate-leaf="true" data-offset-key="3956:0" data-first-offset="true"><span data-slate-string="true"> ((kmsp-&gt;so_fobjnr + </span></span></span><span data-slate-object="text" data-key="3957"><span data-slate-leaf="true" data-offset-key="3957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3958"><span data-slate-leaf="true" data-offset-key="3958:0" data-first-offset="true"><span data-slate-string="true">) &gt; kmsp-&gt;so_mobjnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3959"><span data-slate-object="text" data-key="3960"><span data-slate-leaf="true" data-offset-key="3960:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3961"><span data-slate-object="text" data-key="3962"><span data-slate-leaf="true" data-offset-key="3962:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3963"><span data-slate-leaf="true" data-offset-key="3963:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3964"><span data-slate-leaf="true" data-offset-key="3964:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3965"><span data-slate-object="text" data-key="3966"><span data-slate-leaf="true" data-offset-key="3966:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3967"><span data-slate-object="text" data-key="3968"><span data-slate-leaf="true" data-offset-key="3968:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3969"><span data-slate-leaf="true" data-offset-key="3969:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 让 freobjh_t 结构重新指向要释放的内存空间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3970"><span data-slate-object="text" data-key="3971"><span data-slate-leaf="true" data-offset-key="3971:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3972"><span data-slate-leaf="true" data-offset-key="3972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3973"><span data-slate-leaf="true" data-offset-key="3973:0" data-first-offset="true"><span data-slate-string="true"> *obhp = (</span></span></span><span data-slate-object="text" data-key="3974"><span data-slate-leaf="true" data-offset-key="3974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t</span></span></span></span><span data-slate-object="text" data-key="3975"><span data-slate-leaf="true" data-offset-key="3975:0" data-first-offset="true"><span data-slate-string="true"> *)fadrs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3976"><span data-slate-object="text" data-key="3977"><span data-slate-leaf="true" data-offset-key="3977:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3978"><span data-slate-leaf="true" data-offset-key="3978:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 重新初始化块内存空间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3979"><span data-slate-object="text" data-key="3980"><span data-slate-leaf="true" data-offset-key="3980:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3981"><span data-slate-leaf="true" data-offset-key="3981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">freobjh_t_init</span></span></span></span><span data-slate-object="text" data-key="3982"><span data-slate-leaf="true" data-offset-key="3982:0" data-first-offset="true"><span data-slate-string="true">(obhp, </span></span></span><span data-slate-object="text" data-key="3983"><span data-slate-leaf="true" data-offset-key="3983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3984"><span data-slate-leaf="true" data-offset-key="3984:0" data-first-offset="true"><span data-slate-string="true">, obhp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3985"><span data-slate-object="text" data-key="3986"><span data-slate-leaf="true" data-offset-key="3986:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3987"><span data-slate-leaf="true" data-offset-key="3987:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 加入 kmsob_t 结构的空闲链表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3988"><span data-slate-object="text" data-key="3989"><span data-slate-leaf="true" data-offset-key="3989:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3990"><span data-slate-leaf="true" data-offset-key="3990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="3991"><span data-slate-leaf="true" data-offset-key="3991:0" data-first-offset="true"><span data-slate-string="true">(&amp;obhp-&gt;oh_list, &amp;kmsp-&gt;so_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3992"><span data-slate-object="text" data-key="3993"><span data-slate-leaf="true" data-offset-key="3993:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3994"><span data-slate-leaf="true" data-offset-key="3994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//kmsob_t 结构的空闲对象计数加一</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3995"><span data-slate-object="text" data-key="3996"><span data-slate-leaf="true" data-offset-key="3996:0" data-first-offset="true"><span data-slate-string="true">    kmsp-&gt;so_fobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3997"><span data-slate-object="text" data-key="3998"><span data-slate-leaf="true" data-offset-key="3998:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3999"><span data-slate-leaf="true" data-offset-key="3999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4000"><span data-slate-leaf="true" data-offset-key="4000:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4001"><span data-slate-object="text" data-key="4002"><span data-slate-leaf="true" data-offset-key="4002:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4003"><span data-slate-object="text" data-key="4004"><span data-slate-leaf="true" data-offset-key="4004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放内存对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4005"><span data-slate-object="text" data-key="4006"><span data-slate-leaf="true" data-offset-key="4006:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="4007"><span data-slate-leaf="true" data-offset-key="4007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="4008"><span data-slate-leaf="true" data-offset-key="4008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_delete_onkmsob</span></span></span></span></span><span data-slate-object="text" data-key="4009"><span data-slate-leaf="true" data-offset-key="4009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="4010"><span data-slate-leaf="true" data-offset-key="4010:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="4011"><span data-slate-leaf="true" data-offset-key="4011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp, </span></span></span></span></span><span data-slate-object="text" data-key="4012"><span data-slate-leaf="true" data-offset-key="4012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span></span><span data-slate-object="text" data-key="4013"><span data-slate-leaf="true" data-offset-key="4013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fadrs, </span></span></span></span></span><span data-slate-object="text" data-key="4014"><span data-slate-leaf="true" data-offset-key="4014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">size_t</span></span></span></span></span></span><span data-slate-object="text" data-key="4015"><span data-slate-leaf="true" data-offset-key="4015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fsz)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4016"><span data-slate-object="text" data-key="4017"><span data-slate-leaf="true" data-offset-key="4017:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4018"><span data-slate-object="text" data-key="4019"><span data-slate-leaf="true" data-offset-key="4019:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4020"><span data-slate-leaf="true" data-offset-key="4020:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="4021"><span data-slate-leaf="true" data-offset-key="4021:0" data-first-offset="true"><span data-slate-string="true"> rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4022"><span data-slate-object="text" data-key="4023"><span data-slate-leaf="true" data-offset-key="4023:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4024"><span data-slate-leaf="true" data-offset-key="4024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cpuflg_t</span></span></span></span><span data-slate-object="text" data-key="4025"><span data-slate-leaf="true" data-offset-key="4025:0" data-first-offset="true"><span data-slate-string="true"> cpuflg;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4026"><span data-slate-object="text" data-key="4027"><span data-slate-leaf="true" data-offset-key="4027:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4028"><span data-slate-leaf="true" data-offset-key="4028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对 kmsob_t 结构加锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4029"><span data-slate-object="text" data-key="4030"><span data-slate-leaf="true" data-offset-key="4030:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4031"><span data-slate-leaf="true" data-offset-key="4031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_cli</span></span></span></span><span data-slate-object="text" data-key="4032"><span data-slate-leaf="true" data-offset-key="4032:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4033"><span data-slate-object="text" data-key="4034"><span data-slate-leaf="true" data-offset-key="4034:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4035"><span data-slate-leaf="true" data-offset-key="4035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实际完成内存对象释放</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4036"><span data-slate-object="text" data-key="4037"><span data-slate-leaf="true" data-offset-key="4037:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4038"><span data-slate-leaf="true" data-offset-key="4038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4039"><span data-slate-leaf="true" data-offset-key="4039:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4040"><span data-slate-leaf="true" data-offset-key="4040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_del_opkmsob</span></span></span></span><span data-slate-object="text" data-key="4041"><span data-slate-leaf="true" data-offset-key="4041:0" data-first-offset="true"><span data-slate-string="true">(kmsp, fadrs, fsz) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4042"><span data-slate-object="text" data-key="4043"><span data-slate-leaf="true" data-offset-key="4043:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4044"><span data-slate-object="text" data-key="4045"><span data-slate-leaf="true" data-offset-key="4045:0" data-first-offset="true"><span data-slate-string="true">        rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4046"><span data-slate-object="text" data-key="4047"><span data-slate-leaf="true" data-offset-key="4047:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4048"><span data-slate-leaf="true" data-offset-key="4048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="4049"><span data-slate-leaf="true" data-offset-key="4049:0" data-first-offset="true"><span data-slate-string="true"> ret_step;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4050"><span data-slate-object="text" data-key="4051"><span data-slate-leaf="true" data-offset-key="4051:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4052"><span data-slate-object="text" data-key="4053"><span data-slate-leaf="true" data-offset-key="4053:0" data-first-offset="true"><span data-slate-string="true">    rets = TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4054"><span data-slate-object="text" data-key="4055"><span data-slate-leaf="true" data-offset-key="4055:0" data-first-offset="true"><span data-slate-string="true">ret_step:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4056"><span data-slate-object="text" data-key="4057"><span data-slate-leaf="true" data-offset-key="4057:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4058"><span data-slate-leaf="true" data-offset-key="4058:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对 kmsob_t 结构解锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4059"><span data-slate-object="text" data-key="4060"><span data-slate-leaf="true" data-offset-key="4060:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4061"><span data-slate-leaf="true" data-offset-key="4061:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinunlock_sti</span></span></span></span><span data-slate-object="text" data-key="4062"><span data-slate-leaf="true" data-offset-key="4062:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_lock, &amp;cpuflg);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4063"><span data-slate-object="text" data-key="4064"><span data-slate-leaf="true" data-offset-key="4064:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4065"><span data-slate-leaf="true" data-offset-key="4065:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4066"><span data-slate-leaf="true" data-offset-key="4066:0" data-first-offset="true"><span data-slate-string="true"> rets;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4067"><span data-slate-object="text" data-key="4068"><span data-slate-leaf="true" data-offset-key="4068:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4069"><span data-slate-object="text" data-key="4070"><span data-slate-leaf="true" data-offset-key="4070:0" data-first-offset="true"><span data-slate-string="true">结合上述代码和注释，我们现在明白了 kmsob_delete_onkmsob 函数调用 kmsob_del_opkmsob 函数。其核心机制就是</span></span></span><span data-slate-object="text" data-key="4071"><span data-slate-leaf="true" data-offset-key="4071:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">把要释放内存对象的空间，重新初始化，变成一个 freobjh_t 结构的实例变量，最后把这个 freobjh_t 结构加入到 kmsob_t 结构中空闲链表中</span></span></span></span><span data-slate-object="text" data-key="4072"><span data-slate-leaf="true" data-offset-key="4072:0" data-first-offset="true"><span data-slate-string="true">，这就实现了内存对象的释放。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="4073" id="sr-toc-16"><span data-slate-object="text" data-key="4074"><span data-slate-leaf="true" data-offset-key="4074:0" data-first-offset="true"><span data-slate-string="true">销毁内存对象容器</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="4075"><span data-slate-object="text" data-key="4076"><span data-slate-leaf="true" data-offset-key="4076:0" data-first-offset="true"><span data-slate-string="true">如果我们释放了所有的内存对象，就会出现空的内存对象容器。如果下一次请求同样大小的内存对象，那么这个空的内存对象容器还能继续复用，提高性能。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4077"><span data-slate-object="text" data-key="4078"><span data-slate-leaf="true" data-offset-key="4078:0" data-first-offset="true"><span data-slate-string="true">但是你有没有想到，频繁请求的是不同大小的内存对象，那么空的内存对象容器会越来越多，这会占用大量内存，所以我们必须要把空的内存对象容器销毁。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4079"><span data-slate-object="text" data-key="4080"><span data-slate-leaf="true" data-offset-key="4080:0" data-first-offset="true"><span data-slate-string="true">下面我们写代码实现销毁内存对象容器。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="4081"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="4082"><span data-slate-object="text" data-key="4083"><span data-slate-leaf="true" data-offset-key="4083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span><span data-slate-object="text" data-key="4084"><span data-slate-leaf="true" data-offset-key="4084:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="4085"><span data-slate-leaf="true" data-offset-key="4085:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_freekmsob_isok</span></span></span></span></span><span data-slate-object="text" data-key="4086"><span data-slate-leaf="true" data-offset-key="4086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="4087"><span data-slate-leaf="true" data-offset-key="4087:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span></span></span><span data-slate-object="text" data-key="4088"><span data-slate-leaf="true" data-offset-key="4088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *kmsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4089"><span data-slate-object="text" data-key="4090"><span data-slate-leaf="true" data-offset-key="4090:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4091"><span data-slate-object="text" data-key="4092"><span data-slate-leaf="true" data-offset-key="4092:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4093"><span data-slate-leaf="true" data-offset-key="4093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 当内存对象容器的总对象个数等于空闲对象个数时，说明这内存对象容器空闲</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4094"><span data-slate-object="text" data-key="4095"><span data-slate-leaf="true" data-offset-key="4095:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4096"><span data-slate-leaf="true" data-offset-key="4096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4097"><span data-slate-leaf="true" data-offset-key="4097:0" data-first-offset="true"><span data-slate-string="true"> (kmsp-&gt;so_mobjnr == kmsp-&gt;so_fobjnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4098"><span data-slate-object="text" data-key="4099"><span data-slate-leaf="true" data-offset-key="4099:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4100"><span data-slate-object="text" data-key="4101"><span data-slate-leaf="true" data-offset-key="4101:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4102"><span data-slate-leaf="true" data-offset-key="4102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4103"><span data-slate-leaf="true" data-offset-key="4103:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4104"><span data-slate-leaf="true" data-offset-key="4104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="4105"><span data-slate-leaf="true" data-offset-key="4105:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4106"><span data-slate-object="text" data-key="4107"><span data-slate-leaf="true" data-offset-key="4107:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4108"><span data-slate-object="text" data-key="4109"><span data-slate-leaf="true" data-offset-key="4109:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4110"><span data-slate-leaf="true" data-offset-key="4110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4111"><span data-slate-leaf="true" data-offset-key="4111:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="4112"><span data-slate-leaf="true" data-offset-key="4112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="4113"><span data-slate-leaf="true" data-offset-key="4113:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4114"><span data-slate-object="text" data-key="4115"><span data-slate-leaf="true" data-offset-key="4115:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4116"></div><div data-slate-type="code-line" data-slate-object="block" data-key="4117"><span data-slate-object="text" data-key="4118"><span data-slate-leaf="true" data-offset-key="4118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="4119"><span data-slate-leaf="true" data-offset-key="4119:0" data-first-offset="true"><span data-slate-string="true"> _destroy_kmsob_core(</span></span></span><span data-slate-object="text" data-key="4120"><span data-slate-leaf="true" data-offset-key="4120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="4121"><span data-slate-leaf="true" data-offset-key="4121:0" data-first-offset="true"><span data-slate-string="true"> *kmobmgrp, </span></span></span><span data-slate-object="text" data-key="4122"><span data-slate-leaf="true" data-offset-key="4122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="4123"><span data-slate-leaf="true" data-offset-key="4123:0" data-first-offset="true"><span data-slate-string="true"> *koblp, </span></span></span><span data-slate-object="text" data-key="4124"><span data-slate-leaf="true" data-offset-key="4124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="4125"><span data-slate-leaf="true" data-offset-key="4125:0" data-first-offset="true"><span data-slate-string="true"> *kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4126"><span data-slate-object="text" data-key="4127"><span data-slate-leaf="true" data-offset-key="4127:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4128"><span data-slate-object="text" data-key="4129"><span data-slate-leaf="true" data-offset-key="4129:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4130"><span data-slate-leaf="true" data-offset-key="4130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_h_t</span></span></span></span><span data-slate-object="text" data-key="4131"><span data-slate-leaf="true" data-offset-key="4131:0" data-first-offset="true"><span data-slate-string="true"> *tmplst = </span></span></span><span data-slate-object="text" data-key="4132"><span data-slate-leaf="true" data-offset-key="4132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="4133"><span data-slate-leaf="true" data-offset-key="4133:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4134"><span data-slate-object="text" data-key="4135"><span data-slate-leaf="true" data-offset-key="4135:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4136"><span data-slate-leaf="true" data-offset-key="4136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="4137"><span data-slate-leaf="true" data-offset-key="4137:0" data-first-offset="true"><span data-slate-string="true"> *msa = </span></span></span><span data-slate-object="text" data-key="4138"><span data-slate-leaf="true" data-offset-key="4138:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="4139"><span data-slate-leaf="true" data-offset-key="4139:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4140"><span data-slate-object="text" data-key="4141"><span data-slate-leaf="true" data-offset-key="4141:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4142"><span data-slate-leaf="true" data-offset-key="4142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msclst_t</span></span></span></span><span data-slate-object="text" data-key="4143"><span data-slate-leaf="true" data-offset-key="4143:0" data-first-offset="true"><span data-slate-string="true"> *mscp = kmsp-&gt;so_mc.mc_lst;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4144"><span data-slate-object="text" data-key="4145"><span data-slate-leaf="true" data-offset-key="4145:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4146"><span data-slate-leaf="true" data-offset-key="4146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_del</span></span></span></span><span data-slate-object="text" data-key="4147"><span data-slate-leaf="true" data-offset-key="4147:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmsp-&gt;so_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4148"><span data-slate-object="text" data-key="4149"><span data-slate-leaf="true" data-offset-key="4149:0" data-first-offset="true"><span data-slate-string="true">    koblp-&gt;ol_emnr--;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4150"><span data-slate-object="text" data-key="4151"><span data-slate-leaf="true" data-offset-key="4151:0" data-first-offset="true"><span data-slate-string="true">    kmobmgrp-&gt;ks_msobnr--;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4152"><span data-slate-object="text" data-key="4153"><span data-slate-leaf="true" data-offset-key="4153:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4154"><span data-slate-leaf="true" data-offset-key="4154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放内存对象容器扩展空间的物理内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4155"><span data-slate-object="text" data-key="4156"><span data-slate-leaf="true" data-offset-key="4156:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4157"><span data-slate-leaf="true" data-offset-key="4157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历 kmsob_t 结构中的 so_mc.mc_lst 数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4158"><span data-slate-object="text" data-key="4159"><span data-slate-leaf="true" data-offset-key="4159:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4160"><span data-slate-leaf="true" data-offset-key="4160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="4161"><span data-slate-leaf="true" data-offset-key="4161:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4162"><span data-slate-leaf="true" data-offset-key="4162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="4163"><span data-slate-leaf="true" data-offset-key="4163:0" data-first-offset="true"><span data-slate-string="true"> j = </span></span></span><span data-slate-object="text" data-key="4164"><span data-slate-leaf="true" data-offset-key="4164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4165"><span data-slate-leaf="true" data-offset-key="4165:0" data-first-offset="true"><span data-slate-string="true">; j &lt;MSCLST_MAX; j++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4166"><span data-slate-object="text" data-key="4167"><span data-slate-leaf="true" data-offset-key="4167:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4168"><span data-slate-object="text" data-key="4169"><span data-slate-leaf="true" data-offset-key="4169:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4170"><span data-slate-leaf="true" data-offset-key="4170:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4171"><span data-slate-leaf="true" data-offset-key="4171:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4172"><span data-slate-leaf="true" data-offset-key="4172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="4173"><span data-slate-leaf="true" data-offset-key="4173:0" data-first-offset="true"><span data-slate-string="true"> &lt;mscp[j].ml_msanr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4174"><span data-slate-object="text" data-key="4175"><span data-slate-leaf="true" data-offset-key="4175:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span><span data-slate-object="text" data-key="4176"><span data-slate-leaf="true" data-offset-key="4176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历每个 so_mc.mc_lst 数组中的 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4177"><span data-slate-object="text" data-key="4178"><span data-slate-leaf="true" data-offset-key="4178:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4179"><span data-slate-leaf="true" data-offset-key="4179:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_for_each_head_dell</span></span></span></span><span data-slate-object="text" data-key="4180"><span data-slate-leaf="true" data-offset-key="4180:0" data-first-offset="true"><span data-slate-string="true">(tmplst, &amp;mscp[j].ml_list)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4181"><span data-slate-object="text" data-key="4182"><span data-slate-leaf="true" data-offset-key="4182:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4183"><span data-slate-object="text" data-key="4184"><span data-slate-leaf="true" data-offset-key="4184:0" data-first-offset="true"><span data-slate-string="true">                msa = </span></span></span><span data-slate-object="text" data-key="4185"><span data-slate-leaf="true" data-offset-key="4185:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="4186"><span data-slate-leaf="true" data-offset-key="4186:0" data-first-offset="true"><span data-slate-string="true">(tmplst, </span></span></span><span data-slate-object="text" data-key="4187"><span data-slate-leaf="true" data-offset-key="4187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="4188"><span data-slate-leaf="true" data-offset-key="4188:0" data-first-offset="true"><span data-slate-string="true">, md_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4189"><span data-slate-object="text" data-key="4190"><span data-slate-leaf="true" data-offset-key="4190:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="4191"><span data-slate-leaf="true" data-offset-key="4191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_del</span></span></span></span><span data-slate-object="text" data-key="4192"><span data-slate-leaf="true" data-offset-key="4192:0" data-first-offset="true"><span data-slate-string="true">(&amp;msa-&gt;md_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4193"><span data-slate-object="text" data-key="4194"><span data-slate-leaf="true" data-offset-key="4194:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="4195"><span data-slate-leaf="true" data-offset-key="4195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//msadsc_t 脱链</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4196"><span data-slate-object="text" data-key="4197"><span data-slate-leaf="true" data-offset-key="4197:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="4198"><span data-slate-leaf="true" data-offset-key="4198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放 msadsc_t 对应的物理内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4199"><span data-slate-object="text" data-key="4200"><span data-slate-leaf="true" data-offset-key="4200:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="4201"><span data-slate-leaf="true" data-offset-key="4201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4202"><span data-slate-leaf="true" data-offset-key="4202:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4203"><span data-slate-leaf="true" data-offset-key="4203:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mm_merge_pages</span></span></span></span><span data-slate-object="text" data-key="4204"><span data-slate-leaf="true" data-offset-key="4204:0" data-first-offset="true"><span data-slate-string="true">(&amp;memmgrob, msa, (</span></span></span><span data-slate-object="text" data-key="4205"><span data-slate-leaf="true" data-offset-key="4205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="4206"><span data-slate-leaf="true" data-offset-key="4206:0" data-first-offset="true"><span data-slate-string="true">)mscp[j].ml_ompnr) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4207"><span data-slate-object="text" data-key="4208"><span data-slate-leaf="true" data-offset-key="4208:0" data-first-offset="true"><span data-slate-string="true">                {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4209"><span data-slate-object="text" data-key="4210"><span data-slate-leaf="true" data-offset-key="4210:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="4211"><span data-slate-leaf="true" data-offset-key="4211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="4212"><span data-slate-leaf="true" data-offset-key="4212:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="4213"><span data-slate-leaf="true" data-offset-key="4213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"_destroy_kmsob_core mm_merge_pages FALSE2\n"</span></span></span></span><span data-slate-object="text" data-key="4214"><span data-slate-leaf="true" data-offset-key="4214:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4215"><span data-slate-object="text" data-key="4216"><span data-slate-leaf="true" data-offset-key="4216:0" data-first-offset="true"><span data-slate-string="true">                }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4217"><span data-slate-object="text" data-key="4218"><span data-slate-leaf="true" data-offset-key="4218:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4219"><span data-slate-object="text" data-key="4220"><span data-slate-leaf="true" data-offset-key="4220:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4221"><span data-slate-object="text" data-key="4222"><span data-slate-leaf="true" data-offset-key="4222:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4223"><span data-slate-object="text" data-key="4224"><span data-slate-leaf="true" data-offset-key="4224:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4225"><span data-slate-leaf="true" data-offset-key="4225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放内存对象容器本身占用的物理内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4226"><span data-slate-object="text" data-key="4227"><span data-slate-leaf="true" data-offset-key="4227:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4228"><span data-slate-leaf="true" data-offset-key="4228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历每个 so_mc.mc_kmobinlst 中的 msadsc_t 结构。它只会遍历一次</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4229"><span data-slate-object="text" data-key="4230"><span data-slate-leaf="true" data-offset-key="4230:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4231"><span data-slate-leaf="true" data-offset-key="4231:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_for_each_head_dell</span></span></span></span><span data-slate-object="text" data-key="4232"><span data-slate-leaf="true" data-offset-key="4232:0" data-first-offset="true"><span data-slate-string="true">(tmplst, &amp;kmsp-&gt;so_mc.mc_kmobinlst)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4233"><span data-slate-object="text" data-key="4234"><span data-slate-leaf="true" data-offset-key="4234:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4235"><span data-slate-object="text" data-key="4236"><span data-slate-leaf="true" data-offset-key="4236:0" data-first-offset="true"><span data-slate-string="true">        msa = </span></span></span><span data-slate-object="text" data-key="4237"><span data-slate-leaf="true" data-offset-key="4237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_entry</span></span></span></span><span data-slate-object="text" data-key="4238"><span data-slate-leaf="true" data-offset-key="4238:0" data-first-offset="true"><span data-slate-string="true">(tmplst, </span></span></span><span data-slate-object="text" data-key="4239"><span data-slate-leaf="true" data-offset-key="4239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="4240"><span data-slate-leaf="true" data-offset-key="4240:0" data-first-offset="true"><span data-slate-string="true">, md_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4241"><span data-slate-object="text" data-key="4242"><span data-slate-leaf="true" data-offset-key="4242:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4243"><span data-slate-leaf="true" data-offset-key="4243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_del</span></span></span></span><span data-slate-object="text" data-key="4244"><span data-slate-leaf="true" data-offset-key="4244:0" data-first-offset="true"><span data-slate-string="true">(&amp;msa-&gt;md_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4245"><span data-slate-object="text" data-key="4246"><span data-slate-leaf="true" data-offset-key="4246:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4247"><span data-slate-leaf="true" data-offset-key="4247:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//msadsc_t 脱链</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4248"><span data-slate-object="text" data-key="4249"><span data-slate-leaf="true" data-offset-key="4249:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4250"><span data-slate-leaf="true" data-offset-key="4250:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 释放 msadsc_t 对应的物理内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4251"><span data-slate-object="text" data-key="4252"><span data-slate-leaf="true" data-offset-key="4252:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4253"><span data-slate-leaf="true" data-offset-key="4253:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4254"><span data-slate-leaf="true" data-offset-key="4254:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4255"><span data-slate-leaf="true" data-offset-key="4255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mm_merge_pages</span></span></span></span><span data-slate-object="text" data-key="4256"><span data-slate-leaf="true" data-offset-key="4256:0" data-first-offset="true"><span data-slate-string="true">(&amp;memmgrob, msa, (</span></span></span><span data-slate-object="text" data-key="4257"><span data-slate-leaf="true" data-offset-key="4257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="4258"><span data-slate-leaf="true" data-offset-key="4258:0" data-first-offset="true"><span data-slate-string="true">)kmsp-&gt;so_mc.mc_kmobinpnr) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4259"><span data-slate-object="text" data-key="4260"><span data-slate-leaf="true" data-offset-key="4260:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4261"><span data-slate-object="text" data-key="4262"><span data-slate-leaf="true" data-offset-key="4262:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="4263"><span data-slate-leaf="true" data-offset-key="4263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="4264"><span data-slate-leaf="true" data-offset-key="4264:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="4265"><span data-slate-leaf="true" data-offset-key="4265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"_destroy_kmsob_core mm_merge_pages FALSE2\n"</span></span></span></span><span data-slate-object="text" data-key="4266"><span data-slate-leaf="true" data-offset-key="4266:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4267"><span data-slate-object="text" data-key="4268"><span data-slate-leaf="true" data-offset-key="4268:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4269"><span data-slate-object="text" data-key="4270"><span data-slate-leaf="true" data-offset-key="4270:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4271"><span data-slate-object="text" data-key="4272"><span data-slate-leaf="true" data-offset-key="4272:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4273"><span data-slate-leaf="true" data-offset-key="4273:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4274"><span data-slate-leaf="true" data-offset-key="4274:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4275"><span data-slate-object="text" data-key="4276"><span data-slate-leaf="true" data-offset-key="4276:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4277"><span data-slate-object="text" data-key="4278"><span data-slate-leaf="true" data-offset-key="4278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4279"><span data-slate-object="text" data-key="4280"><span data-slate-leaf="true" data-offset-key="4280:0" data-first-offset="true"><span data-slate-string="true">``` 销毁内存对象容器</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4281"><span data-slate-object="text" data-key="4282"><span data-slate-leaf="true" data-offset-key="4282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="4283"><span data-slate-leaf="true" data-offset-key="4283:0" data-first-offset="true"><span data-slate-string="true"> _destroy_kmsob(</span></span></span><span data-slate-object="text" data-key="4284"><span data-slate-leaf="true" data-offset-key="4284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsobmgrhed_t</span></span></span></span><span data-slate-object="text" data-key="4285"><span data-slate-leaf="true" data-offset-key="4285:0" data-first-offset="true"><span data-slate-string="true"> *kmobmgrp, </span></span></span><span data-slate-object="text" data-key="4286"><span data-slate-leaf="true" data-offset-key="4286:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">koblst_t</span></span></span></span><span data-slate-object="text" data-key="4287"><span data-slate-leaf="true" data-offset-key="4287:0" data-first-offset="true"><span data-slate-string="true"> *koblp, </span></span></span><span data-slate-object="text" data-key="4288"><span data-slate-leaf="true" data-offset-key="4288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">kmsob_t</span></span></span></span><span data-slate-object="text" data-key="4289"><span data-slate-leaf="true" data-offset-key="4289:0" data-first-offset="true"><span data-slate-string="true"> *kmsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4290"><span data-slate-object="text" data-key="4291"><span data-slate-leaf="true" data-offset-key="4291:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4292"><span data-slate-object="text" data-key="4293"><span data-slate-leaf="true" data-offset-key="4293:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4294"><span data-slate-leaf="true" data-offset-key="4294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 看看能不能销毁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4295"><span data-slate-object="text" data-key="4296"><span data-slate-leaf="true" data-offset-key="4296:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4297"><span data-slate-leaf="true" data-offset-key="4297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="4298"><span data-slate-leaf="true" data-offset-key="4298:0" data-first-offset="true"><span data-slate-string="true"> screts = </span></span></span><span data-slate-object="text" data-key="4299"><span data-slate-leaf="true" data-offset-key="4299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_freekmsob_isok</span></span></span></span><span data-slate-object="text" data-key="4300"><span data-slate-leaf="true" data-offset-key="4300:0" data-first-offset="true"><span data-slate-string="true">(kmsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4301"><span data-slate-object="text" data-key="4302"><span data-slate-leaf="true" data-offset-key="4302:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4303"><span data-slate-leaf="true" data-offset-key="4303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="4304"><span data-slate-leaf="true" data-offset-key="4304:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="4305"><span data-slate-leaf="true" data-offset-key="4305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="4306"><span data-slate-leaf="true" data-offset-key="4306:0" data-first-offset="true"><span data-slate-string="true"> == screts)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4307"><span data-slate-object="text" data-key="4308"><span data-slate-leaf="true" data-offset-key="4308:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span><span data-slate-object="text" data-key="4309"><span data-slate-leaf="true" data-offset-key="4309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 调用销毁内存对象容器的核心函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4310"><span data-slate-object="text" data-key="4311"><span data-slate-leaf="true" data-offset-key="4311:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="4312"><span data-slate-leaf="true" data-offset-key="4312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4313"><span data-slate-leaf="true" data-offset-key="4313:0" data-first-offset="true"><span data-slate-string="true"> _destroy_kmsob_core(kmobmgrp, koblp, kmsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4314"><span data-slate-object="text" data-key="4315"><span data-slate-leaf="true" data-offset-key="4315:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4316"><span data-slate-object="text" data-key="4317"><span data-slate-leaf="true" data-offset-key="4317:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="4318"><span data-slate-leaf="true" data-offset-key="4318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="4319"><span data-slate-leaf="true" data-offset-key="4319:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="4320"><span data-slate-object="text" data-key="4321"><span data-slate-leaf="true" data-offset-key="4321:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4322"><span data-slate-object="text" data-key="4323"><span data-slate-leaf="true" data-offset-key="4323:0" data-first-offset="true"><span data-slate-string="true">上述代码中，首先会检查一下内存对象容器是不是空闲的，如果空闲，就调用</span></span></span><span data-slate-object="text" data-key="4324"><span data-slate-leaf="true" data-offset-key="4324:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">销毁内存对象容器的核心函数 _destroy_kmsob_core</span></span></span></span><span data-slate-object="text" data-key="4325"><span data-slate-leaf="true" data-offset-key="4325:0" data-first-offset="true"><span data-slate-string="true">。在 _destroy_kmsob_core 函数中，首先要释放内存对象容器的扩展空间所占用的物理内存页面，最后才可以释放内存对象容器自身占用物理内存页面。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4326"><span data-slate-object="text" data-key="4327"><span data-slate-leaf="true" data-offset-key="4327:0" data-first-offset="true"><span data-slate-string="true">请注意。</span></span></span><span data-slate-object="text" data-key="4328"><span data-slate-leaf="true" data-offset-key="4328:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这个顺序不能前后颠倒</span></span></span></span><span data-slate-object="text" data-key="4329"><span data-slate-leaf="true" data-offset-key="4329:0" data-first-offset="true"><span data-slate-string="true">，这是因为扩展空间的物理内存页面对应的 msadsc_t 结构，它就挂载在 kmsob_t 结构的 so_mc.mc_lst 数组中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4330"><span data-slate-object="text" data-key="4331"><span data-slate-leaf="true" data-offset-key="4331:0" data-first-offset="true"><span data-slate-string="true">好了，到这里我们内存对象释放的流程就完成了，这意味着我们整个内存对象管理也告一段落了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4332" id="sr-toc-17"><span data-slate-object="text" data-key="4333"><span data-slate-leaf="true" data-offset-key="4333:0" data-first-offset="true"><span data-slate-string="true">重点回顾</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4334"><span data-slate-object="text" data-key="4335"><span data-slate-leaf="true" data-offset-key="4335:0" data-first-offset="true"><span data-slate-string="true">今天我们从 malloc 函数入手，思考内核要怎样分配大量小块内存。我们把物理内存页面进一步细分成内存对象，为了表示和管理内存对象，又设计了内存对象、内存对象容器等一系列数据结构，随后写代码把它们初始化，最后我们依赖这些数据结构实现了内存对象管理算法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4336"><span data-slate-object="text" data-key="4337"><span data-slate-leaf="true" data-offset-key="4337:0" data-first-offset="true"><span data-slate-string="true">下面我们来回顾一下这节课的重点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4338"><span data-slate-object="text" data-key="4339"><span data-slate-leaf="true" data-offset-key="4339:0" data-first-offset="true"><span data-slate-string="true">1. 我们发现，在应用程序中可以使用 malloc 函数动态分配一些小块内存，其实这样的场景在内核中也是比比皆是。比如，内核经常要动态创建数据结构的实例变量，就需要分配小块的内存空间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4340"><span data-slate-object="text" data-key="4341"><span data-slate-leaf="true" data-offset-key="4341:0" data-first-offset="true"><span data-slate-string="true">2. 为了实现内存对象的表示、分配和释放功能，我们定义了内存对象和内存对象容器的数据结构 freobjh_t、kmsob_t，并为了管理 kmsob_t 结构又定义了 kmsobmgrhed_t 结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4342"><span data-slate-object="text" data-key="4343"><span data-slate-leaf="true" data-offset-key="4343:0" data-first-offset="true"><span data-slate-string="true">3. 我们写好了初始化 kmsobmgrhed_t 结构的函数，并在 init_kmsob 中调用了它，进而又被 init_memmgr 函数调用，由于 kmsobmgrhed_t 结构是为了管理 kmsob_t 结构的所以在一开始就要被初始化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4344"><span data-slate-object="text" data-key="4345"><span data-slate-leaf="true" data-offset-key="4345:0" data-first-offset="true"><span data-slate-string="true">4. 我们基于这些数据结构实现了内存对象的分配和释放。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="4346" id="sr-toc-18"><span data-slate-object="text" data-key="4347"><span data-slate-leaf="true" data-offset-key="4347:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="4348"><span data-slate-object="text" data-key="4349"><span data-slate-leaf="true" data-offset-key="4349:0" data-first-offset="true"><span data-slate-string="true">为什么我们在分配内存对象大小时要按照 Cache 行大小的倍数分配呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4350"><span data-slate-object="text" data-key="4351"><span data-slate-leaf="true" data-offset-key="4351:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区分享你的思考或疑问。如果这节课对你有帮助，也欢迎你分享给自己的同事、朋友，跟他一起交流讨论。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="4352"><span data-slate-object="text" data-key="4353"><span data-slate-leaf="true" data-offset-key="4353:0" data-first-offset="true"><span data-slate-string="true">好，我是 LMOS，我们下节课见！</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-19">精选留言 (20)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div><span>置顶</span></div><div>怕大家误会我的意思，我再说明一下。我上面的评论其实是在呼吁大家不要拘泥于代码，也不要深陷细节，一叶而障目是学习路上最容易犯的错误。
我以自身为例来说，初学数据结构时，链表是最简单的一种数据结构，老师一讲就懂，书一看就会，可是自己去写，尤其是链表的各种操作都是细节满满，很考验个人代码功底和思维完善性，至今我都记得从我懂链表起，到真正写出一个能 work 的链表都花了一周时间，最开始写是 CV，后面是背，多次画图和理解后我才能闭卷完完整整的写出链表。
虽然这过去了好几年，我也从初学者到现在走了很多路。对于这几节专栏而言，同样如此，无论是上一节的伙伴算法还是这一节的 slab，都是 linux 系统走过了几十年迭代，摸爬滚打过滤下的精华。这样的算法都有一个普遍性，那就是思路和方式听起来都简单，可是自己去实现却又困难重重，所以专栏里面出现了大量的代码，大家都不适应，扣代码细节，反而忘记了 buddy 和 slab 要解决的问题，要干什么，为什么这样设计，这才是第一次读专栏的重点。
代码我也没全读懂，代码我也看着头疼，所以我才自勉写下上面的评论，希望大家能跳出来，宏观的看待问题，因为即使是 linux 本人都未必能扣出细节。大家加油～</div><div><p>作者回复: 666666</p></div><div><div>2021-06-21</div><div><div><i></i><span>2</span></div><div><i></i><span>32</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>neohope</span></div><span>置顶</span></div><div>一、整理一下内存结构
1、memmgrob_t 中有 kmsobmgrhed_t
2、kmsobmgrhed_t 中有一个 koblst_t 数组【KOBLST_MAX 个】，序号为 n 的 koblst_t，存储全部实际长度为长度为 32*（n+1）内存对象
3、每个 koblst_t，都包括一个 kmsob_t 链表
4、kmsob_t 结构如下：
结构体描述部分【
双向链表
扩展结构链表【kmbext_t】
空闲对象链表【freobjh_t】
已分配对象链表【freobjh_t】
占用内存页面管理结构【msomdc_t】
kmsob_t 结构体页面链表【so_mc.mc_kmobinlst】
全部 kmbext_t 结构体页面链表【so_mc.mc_lst】
结构体起止地址
......
】
除结构体描述部分，都按相同大小划分为了内存对象【freobjh_t】

5、扩展管理 kmbext_t，用于扩容
结构体描述部分 {
双向链表
结构体起止地址
......
}
除结构体描述部分，都按相同大小划分为了内存对象【freobjh_t】

6、链表处理部分做的真漂亮！

二、分配内存
1、从 memmgrob_t 获取 kmsobmgrhed_t，也就找到了 koblst_t 数组
2、根据申请内存对象大小，找到对应的 koblst_t【第一个内存对象比需求大的 koblst_t】
3、如果 koblst_t 中没有找到 kmsob_t，则要初始化
A、按页申请内存【1、2 或 4 页】
B、进行 kmsob_t 初始化工作，首先初始化描述部分
C、将之后的空间，按固定大小全部初始化为 freobjh_t 结构
D、把全部 freobjh_t 挂载到 koblst_t 的空闲列表中
E、然后将 kmsob_t 挂载到 koblst_t 结构中去

4、在 kmsob_t 中分配内存对象
4.1、首先判断 kmsob_t 是否有空闲对象可以分配
4.2、如果没有空闲对象可以分配，则尝试扩容，创建新的 kmbext_t：：
A、申请内存【1、2 或 4 页】
B、并进行初始化工作 kmbext_t，首先初始化描述部分
C、将之后的空间，按固定大小全部初始化为 freobjh_t 结构
D、把内存页面记录到 kmsob_t 的页面列表中
E、把 freobjh_t 挂载到 koblst_t 的空闲列表中
F、把 kmbext_t 挂载到 kmsob_t 的扩展结构链表中
4.3、最后返回一个空闲内存对象，并从空闲列表中移除

5、更新 kmsobmgrhed_t 结构的信息
6、代码中还有各种加速，加锁解锁、校验代码，可以看下

三、释放内存
1、从 memmgrob_t 获取 kmsobmgrhed_t，也就找到了 koblst_t 数组
2、根据申请内存对象大小，找到对应的 koblst_t【第一个内存对象比需求大的 koblst_t】
3、查找内存对象所属的 kmsob_t 结构
对于 koblst_t 中的每一个 kmsob_t 结构：
A、先检查内存对象的地址是否落在 kmsob_t 结构的地址区间
B、然后依次检测内存对象的地址是否落在 kmsob_t 的各个 kmbext_t 扩展结构的地址区间

4、释放内存对象，也就是将内存对象添加到空闲列表中

5、尝试销毁内存对象所在 kmsob_t 结构
4.1、首先判断该 kmsob_t 全部内存对象都已释放
4.2、如果全部内存对象都已释放，则释放 kmsob_t
A、将 kmsob_t 脱链
B、更新 kmsobmgrhed_t 结构的信息
C、遍历释放 kmsob_t 中全部扩展结构占用的内存页面【先脱链，再释放】
D、释放 kmsob_t 自身占用的全部页面【先脱链，再释放】

6、代码中还有各种加速，加锁解锁、校验代码，可以看下

最后，想问一下，koblst_t 在什么情况下，会挂载多个 kmsob_t 呢？感觉内存对象不够用，就去补充 kmbext_t 了吧？</div><div><p>作者回复：大佬 66666

最后，想问一下，koblst_t 在什么情况下，会挂载多个 kmsob_t 呢？感觉内存对象不够用，就去补充 kmbext_t 了吧？
-----------------------------------------------------
目前不会，因为还没有 区分 kmsob_t 的类型</p></div><div><div>2021-06-21</div><div><div><i></i></div><div><i></i><span>14</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/21/f8/d0/092f04df.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>wenkin</span></div><span>置顶</span></div><div>Linux 内存管理之 slab 分配器分析：
前面分析过了大内存分配的实现机制，事实，上，若为小块内存而请求整个页面，这样对于内存来说是种极度的浪费。因此 linux 采用了 slab 来管理小块内存的分配与释放。
1: 内核函数经常倾向于反复请求相同的数据类型。比如：创建进程时，会请求一块内存来存放 mm 结构。
2: 不同的结构使用不同的分配方法可以提高效率。同样，如果进程在撤消的时候，内核不把 mm 结构释放掉，而是存放到一个缓冲区里，以后若有请求 mm 存储空间的行为就可以直接从缓冲区中取得，而不需重新分配内存.
3: 前面，伙伴系统频繁分配，释放内存会影响系统的效率，以此，可以把要释放到的内存放到缓冲区中，直至超过一 - 个阀值才把它释放至伙伴系统，这样可以在 - - 定程度。上缓减减伙伴系统的压力。
4: 为了缓减 “内碎片” 的产生，通常可以把小内存块按照 2 的倍数组织在一起，这一点和伙伴系统类似，这就是为什么分配内存对象大小时要按照 Cache 行大小的倍数分配。


笔记：
本章内容可以细分为三个小节即：内存的初始化，内存的分配，内存的释放，其具体流程参考 neohope 的笔记，就不多赘述。
</div><div><p>作者回复：学的很透</p></div><div><div>2021-09-08</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 沈畅</span></div><span>置顶</span></div><div>建议大家先浏览文稿，理解数据结构以及整体的设计思路（作者画的数据结构图要了然于胸）。先把数据结构理顺，再细看代码就比较容易了。我一开始也是觉得比较难懂，确实变量和函数名缩写不是很好。但是只要理解文稿中概念，和数据结构对应上，不要陷入这些奇怪的命名，代码思路就清晰了。先不要扣细节，从框架到函数最后到细节。看完还是很有收获的。其实看多了，有些缩写也大概猜得出来。</div><div><p>作者回复：对头铁子</p></div><div><div>2021-09-14</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>评论越来越少，证明能跟上的人也越来越少。
作为一个每节都评论，都思考的人，我也能感受到内容难度的加大，而且缺乏阅读方向，代码量越来越大，但是文章要解决什么问题，思路是什么，为什么要这么解决，为什么不用流程图画一下等等，都能改善专栏阅读的困难。

至于思考题，那就比较简单了，前面的小节也谈过 cpu cache line 的问题，总而言之分配内存对象大小按照 cache 行来分配根本原因在于合理利用 cpu 缓存。</div><div><p>作者回复: “文章要解决什么问题，思路是什么，为什么要这么解决”   文章中都有啊 ，页面分配都懂了， 这个应该很简单才对，有什么地方觉得很难的 </p></div><div><div>2021-06-21</div><div><div><i></i><span>5</span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/da/b5/9d1f2f55.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 朱熙</span></div></div><div>感觉确实如 pedro 所说，能跟上的人越来越少，可能也和内核越来越深入有关系。
个人想法是不用纠结代码的每一行，更多的跟着注释体会代码整体流程，知道每块代码在做什么，如果有必要，再去看每行代码。
也希望将来能够每个模块与 linux 内核做一个比较，讲解下优缺点或者差异，让读者能够简单了解 linux 为了某些目的，增加了那些逻辑。</div><div><p>作者回复：对的 </p></div><div><div>2021-06-21</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2d/06/30/c26ea06a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 艾恩凝</span></div></div><div>为啥不能理解细节代码，强迫症，整体流程明白了，深究代码，结束了之后，再画一遍流程图，加深印象，虽然慢倒也可以，对每个函数 函数参数 步骤 添加注释，笔记 + 流程图 ---&gt;https://aeneag.xyz/virginOS  打卡</div><div><p>作者回复：我要分享</p></div><div><div>2022-04-20</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 青玉白露</span></div></div><div>之所以分配内存大小要采用 cache 的倍数，主要是为了合理的使用 CPU 的缓存。
顺带一提，C 语言的代码命名确实一个很大的问题，词不达意，很难理解一个函数到底是来干什么的，相比之下，这段时间学习的 Java 命名格式就显得好的多了，以后我自己写 c 语言代码的时候就需要借鉴 java 的命名方法。</div><div><p>作者回复：因为我搞了很多新的概念 ，那些新的概念你不懂 。也不需要懂，只要明白有什么作用就好了 </p></div><div><div>2021-07-13</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/E5icvvKzlGRD5trSibYvs5ZrhAvOib1UhyZV7ftYJLw1Jna1FWxpHBFlvK130DqArFVdXHh92GVWvSkckqxlibZAbg/132"></div></div><div><div><div><span>blackonion</span></div></div><div>一开始瞄了一眼发现这节代码比较多，的确有点发怵，但看了评论，知道不抠名字这个细节比较好后，耐下心来看了一遍，基本还是能懂的。老师的图非常给力，行文的思路也清晰，注释也比较到位。看到半年过去了，老师还会回答新读者的提问，这种程度的用心真的让我感动～

用我自己的话总结一下这节内容吧。
为提高内存利用率，避免需要很少内容时分配一页，引入了内存对象。
一个结构含有一组内存对象，这个结构叫内存对象容器。
内存对象容器加上内存对象数组默认占据一页，如果不够的话可以申请新的页，用一个类似的结构管理扩展的内存对象。
一种内存对象容器对应一种特定大小的内存对象。
有个结构含有一组内存对象容器，姑且叫内存对象容器管理器。
初始化内存管理功能时，也有初始化内存对象容器管理器的数组。但内存对象是有需求才分配的。</div><div><p>作者回复：对的</p></div><div><div>2021-12-26</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1e/56/3c/f9ff3ed8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 杨军</span></div></div><div>老师能够简单补充写个数据结构、函数的命名规则文档吗？在看代码过程中看到一些名称实在不好理解，来回跳跃看数据结构定义、代码，实在是很不容易把把握整个代码的执行流程，把握不了整体的思路</div><div><p>作者回复：以后 看看吧</p></div><div><div>2021-09-14</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/06/b3/7cb8c071.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>xhy</span></div></div><div>希望老师把这些数据结构简写的全英文名称写出来，否则看着这样的命名太难受了</div><div><p>编辑回复：感谢你的反馈，小编来回应下。因为有些概念是老师自己设计的，比如 mf_olkty 就是 msadsc flags order  link type。但是我们又不知道 order  link type 是啥，这个是老师特别设计的属性，方便未来扩展用。所以，咱们学习重点就是知道各种设计的功能，而不是纠结名字哦。</p></div><div><div>2021-07-10</div><div><div><i></i><span>11</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>blentle</span></div></div><div>提个建议，能否用有意义的名称来命名函数或变量，要不然函数调用关系看的云里雾里. 
其实思考题在最开始的几篇提 cpu 三级缓存的时候已经提了，为了能有效的让缓存生效，提高缓存命中率。不够的都用 padding 还是去拼接成缓存行的倍数</div><div><p>作者回复：你好  是的 </p></div><div><div>2021-06-21</div><div><div><i></i><span>7</span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/68/1a/d9a35bc7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Ziggy_aa</span></div></div><div>一个提问。如果我没有读错代码，按照现在的销毁逻辑，如果但凡有一个内存对象在被使用，该容器就不会被销毁。但是，如果该容器已经分配了许多 extended 部分。那么那些部分占用的内存不会被释放。极端情况下是否会造成巨大的内存浪费？</div><div><p>作者回复：会的 这需要额外的机制来处理</p></div><div><div>2022-07-19</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/9f/be/14b2ad2e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>卖薪沽酒</span></div></div><div>慢慢来， 舒服了</div><div><p>作者回复: 666666</p></div><div><div>2022-06-30</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/60/7c/5afcb3ee.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>飘在空中的鱼</span></div></div><div>老师，这个变量名看得真是头疼啊</div><div><p>作者回复：哈哈 看注释</p></div><div><div>2022-05-06</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>if...else...</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>都是大神</div><div><p>编辑回复：加油</p></div><div><div>2022-02-15</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>王子玉</span></div></div><div>这里的内存管理返回的地址都是虚拟地址吧  那页表呢   phytovirt 好像没用页表啊  有点糊涂了  能不能请点拨一下啊</div><div><p>作者回复: phytovirt  是处理内核线性映射空间的地址</p></div><div><div>2021-12-20</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z"></div></div><div><div><div><span>Geek_34dba1</span></div></div><div>不想让大家关注代码本身就少放一些代码，而是把实现的思路，过程用文字和图示勾勒出来</div><div><p>作者回复：代码也不多啊</p></div><div><div>2021-10-09</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/2a/f8/8d483f93.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>paulpen</span></div></div><div>这是我第一遍看，遇见大段代码，就是简单把注释瞄一下，知道大概是干啥的，然后跳过，就怕迷失在代码细节中。</div><div><p>编辑回复：加油，后面二刷就可以细看了，收获会更大。</p></div><div><div>2021-09-23</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Fan</span></div></div><div>打个卡，不容易呀。来到这里了。</div><div><p>作者回复：哈哈 很困难吗</p></div><div><div>2021-06-29</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".4"><outline class="toc-level-h1" data-reactid=".4.0" style="width: 175px;"><active data-reactid=".4.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".4.0.1"><span data-reactid=".4.0.1.0">19 | 土地不能浪费：如何管理内存对象？</span></a></outline><outline class="toc-level-h2" data-reactid=".4.1" style="width: 165px;"><active data-reactid=".4.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".4.1.1"><span data-reactid=".4.1.1.0">malloc 给我们的启发</span></a></outline><outline class="toc-level-h2" data-reactid=".4.2" style="width: 165px;"><active data-reactid=".4.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".4.2.1"><span data-reactid=".4.2.1.0">页还能细分吗</span></a></outline><outline class="toc-level-h2" data-reactid=".4.3" style="width: 165px;"><active data-reactid=".4.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".4.3.1"><span data-reactid=".4.3.1.0">如何表示一个内存对象</span></a></outline><outline class="toc-level-h2" data-reactid=".4.4" style="width: 165px;"><active data-reactid=".4.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".4.4.1"><span data-reactid=".4.4.1.0">内存对象容器</span></a></outline><outline class="toc-level-h2" data-reactid=".4.5" style="width: 165px;"><active data-reactid=".4.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".4.5.1"><span data-reactid=".4.5.1.0">初始化</span></a></outline><outline class="toc-level-h2" data-reactid=".4.6" style="width: 165px;"><active data-reactid=".4.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".4.6.1"><span data-reactid=".4.6.1.0">分配内存对象</span></a></outline><outline class="toc-level-h3" data-reactid=".4.7" style="width: 155px;"><active data-reactid=".4.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".4.7.1"><span data-reactid=".4.7.1.0">分配内存对象的接口</span></a></outline><outline class="toc-level-h3" data-reactid=".4.8" style="width: 155px;"><active data-reactid=".4.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".4.8.1"><span data-reactid=".4.8.1.0">查找内存对象容器</span></a></outline><outline class="toc-level-h3" data-reactid=".4.9" style="width: 155px;"><active data-reactid=".4.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".4.9.1"><span data-reactid=".4.9.1.0">建立内存对象容器</span></a></outline><outline class="toc-level-h3" data-reactid=".4.a" style="width: 155px;"><active data-reactid=".4.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".4.a.1"><span data-reactid=".4.a.1.0">扩容内存对象容器</span></a></outline><outline class="toc-level-h3" data-reactid=".4.b" style="width: 155px;"><active data-reactid=".4.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".4.b.1"><span data-reactid=".4.b.1.0">分配内存对象</span></a></outline><outline class="toc-level-h2" data-reactid=".4.c" style="width: 165px;"><active data-reactid=".4.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".4.c.1"><span data-reactid=".4.c.1.0">释放内存对象</span></a></outline><outline class="toc-level-h3" data-reactid=".4.d" style="width: 155px;"><active data-reactid=".4.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".4.d.1"><span data-reactid=".4.d.1.0">释放内存对象的接口</span></a></outline><outline class="toc-level-h3" data-reactid=".4.e" style="width: 155px;"><active data-reactid=".4.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".4.e.1"><span data-reactid=".4.e.1.0">查找内存对象容器</span></a></outline><outline class="toc-level-h3" data-reactid=".4.f" style="width: 155px;"><active data-reactid=".4.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".4.f.1"><span data-reactid=".4.f.1.0">释放内存对象</span></a></outline><outline class="toc-level-h3" data-reactid=".4.g" style="width: 155px;"><active data-reactid=".4.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".4.g.1"><span data-reactid=".4.g.1.0">销毁内存对象容器</span></a></outline><outline class="toc-level-h2" data-reactid=".4.h" style="width: 165px;"><active data-reactid=".4.h.0"></active><a class="toc-outline-theme-github" href="#sr-toc-17" data-reactid=".4.h.1"><span data-reactid=".4.h.1.0">重点回顾</span></a></outline><outline class="toc-level-h2" data-reactid=".4.i" style="width: 165px;"><active data-reactid=".4.i.0"></active><a class="toc-outline-theme-github" href="#sr-toc-18" data-reactid=".4.i.1"><span data-reactid=".4.i.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".4.j" style="width: 165px;"><active data-reactid=".4.j.0"></active><a class="toc-outline-theme-github" href="#sr-toc-19" data-reactid=".4.j.1"><span data-reactid=".4.j.1.0">精选留言 (20)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/386400" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>