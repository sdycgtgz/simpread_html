
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 17 | 划分土地（中）：如何实现内存页面初始化？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>17 | 划分土地（中）：如何实现内存页面初始化？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">17 | 划分土地（中）：如何实现内存页面初始化？</h1><div><span>LMOS</span> <span>2021-06-16</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/a0/02/a0693601eeac25ace773f265990e3f02.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：陈晨</span><span>大小：13.11M</span><span> 时长：14:21</span></div></div><audio title="17 | 划分土地（中）：如何实现内存页面初始化？" src="https://res001.geekbang.org/media/audio/d0/10/d088df1d010d96aca47c37649910e610/ld/ld.m3u8" __idm_id__="942102"></audio></div><div><div><div><div data-slate-editor="true" data-key="15057" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="15058"><span data-slate-object="text" data-key="15059"><span data-slate-leaf="true" data-offset-key="15059:0" data-first-offset="true"><span data-slate-string="true">你好，我是 LMOS。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15060"><span data-slate-object="text" data-key="15061"><span data-slate-leaf="true" data-offset-key="15061:0" data-first-offset="true"><span data-slate-string="true">上节课，我们确定了用分页方式管理内存，并且一起动手设计了表示内存页、内存区相关的内存管理数据结构。不过，虽然内存管理相关的数据结构已经定义好了，但是我们还没有在内存中建立对应的</span></span></span><span data-slate-object="text" data-key="15062"><span data-slate-leaf="true" data-offset-key="15062:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">实例变量</span></span></span></span><span data-slate-object="text" data-key="15063"><span data-slate-leaf="true" data-offset-key="15063:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15064"><span data-slate-object="text" data-key="15065"><span data-slate-leaf="true" data-offset-key="15065:0" data-first-offset="true"><span data-slate-string="true">我们都知道，在代码中实际操作的数据结构必须在内存中有相应的变量，这节课我们就去建立对应的实例变量，并初始化它们。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="15066" id="sr-toc-1"><span data-slate-object="text" data-key="15067"><span data-slate-leaf="true" data-offset-key="15067:0" data-first-offset="true"><span data-slate-string="true">初始化</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="15068"><span data-slate-object="text" data-key="15069"><span data-slate-leaf="true" data-offset-key="15069:0" data-first-offset="true"><span data-slate-string="true">前面的课里，我们在 hal 层初始化中，初始化了从二级引导器中获取的内存布局信息，也就是那个 </span></span></span><span data-slate-object="text" data-key="15070"><span data-slate-leaf="true" data-offset-key="15070:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">e820map_t 数组</span></span></span></span><span data-slate-object="text" data-key="15071"><span data-slate-leaf="true" data-offset-key="15071:0" data-first-offset="true"><span data-slate-string="true">，并把这个数组转换成了 phymmarge_t 结构数组，还对它做了排序。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15072"><span data-slate-object="text" data-key="15073"><span data-slate-leaf="true" data-offset-key="15073:0" data-first-offset="true"><span data-slate-string="true">但是，我们 Cosmos 物理内存管理器剩下的部分还没有完成初始化，下面我们就去实现它。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15074"><span data-slate-object="text" data-key="15075"><span data-slate-leaf="true" data-offset-key="15075:0" data-first-offset="true"><span data-slate-string="true">Cosmos 的物理内存管理器，我们依然要放在 Cosmos 的 hal 层。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15076"><span data-slate-object="text" data-key="15077"><span data-slate-leaf="true" data-offset-key="15077:0" data-first-offset="true"><span data-slate-string="true">因为物理内存还和硬件平台相关，所以我们要在 cosmos/hal/x86/ 目录下建立一个 memmgrinit.c 文件，在这个文件中写入一个 Cosmos 物理内存管理器初始化的大总管 ——init_memmgr 函数，并在 init_halmm 函数中调用它，代码如下所示。</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="15078"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15079"><span data-slate-object="text" data-key="15080"><span data-slate-leaf="true" data-offset-key="15080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//cosmos/hal/x86/halmm.c 中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15081"><span data-slate-object="text" data-key="15082"><span data-slate-leaf="true" data-offset-key="15082:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//hal 层的内存初始化函数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15083"><span data-slate-object="text" data-key="15084"><span data-slate-leaf="true" data-offset-key="15084:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="15085"><span data-slate-leaf="true" data-offset-key="15085:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15086"><span data-slate-leaf="true" data-offset-key="15086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_halmm</span></span></span></span><span data-slate-object="text" data-key="15087"><span data-slate-leaf="true" data-offset-key="15087:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15088"><span data-slate-leaf="true" data-offset-key="15088:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15089"><span data-slate-object="text" data-key="15090"><span data-slate-leaf="true" data-offset-key="15090:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15091"><span data-slate-object="text" data-key="15092"><span data-slate-leaf="true" data-offset-key="15092:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15093"><span data-slate-leaf="true" data-offset-key="15093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_phymmarge</span></span></span></span><span data-slate-object="text" data-key="15094"><span data-slate-leaf="true" data-offset-key="15094:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15095"><span data-slate-object="text" data-key="15096"><span data-slate-leaf="true" data-offset-key="15096:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15097"><span data-slate-leaf="true" data-offset-key="15097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgr</span></span></span></span><span data-slate-object="text" data-key="15098"><span data-slate-leaf="true" data-offset-key="15098:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15099"><span data-slate-object="text" data-key="15100"><span data-slate-leaf="true" data-offset-key="15100:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15101"><span data-slate-leaf="true" data-offset-key="15101:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15102"><span data-slate-leaf="true" data-offset-key="15102:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15103"><span data-slate-object="text" data-key="15104"><span data-slate-leaf="true" data-offset-key="15104:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15105"><span data-slate-object="text" data-key="15106"><span data-slate-leaf="true" data-offset-key="15106:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//Cosmos 物理内存管理器初始化</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15107"><span data-slate-object="text" data-key="15108"><span data-slate-leaf="true" data-offset-key="15108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="15109"><span data-slate-leaf="true" data-offset-key="15109:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15110"><span data-slate-leaf="true" data-offset-key="15110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgr</span></span></span></span><span data-slate-object="text" data-key="15111"><span data-slate-leaf="true" data-offset-key="15111:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15112"><span data-slate-leaf="true" data-offset-key="15112:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15113"><span data-slate-object="text" data-key="15114"><span data-slate-leaf="true" data-offset-key="15114:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15115"><span data-slate-object="text" data-key="15116"><span data-slate-leaf="true" data-offset-key="15116:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15117"><span data-slate-leaf="true" data-offset-key="15117:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存页结构 msadsc_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15118"><span data-slate-object="text" data-key="15119"><span data-slate-leaf="true" data-offset-key="15119:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15120"><span data-slate-leaf="true" data-offset-key="15120:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存区结构 memarea_t</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15121"><span data-slate-object="text" data-key="15122"><span data-slate-leaf="true" data-offset-key="15122:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15123"><span data-slate-leaf="true" data-offset-key="15123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15124"><span data-slate-leaf="true" data-offset-key="15124:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15125"><span data-slate-object="text" data-key="15126"><span data-slate-leaf="true" data-offset-key="15126:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15127"><span data-slate-object="text" data-key="15128"><span data-slate-leaf="true" data-offset-key="15128:0" data-first-offset="true"><span data-slate-string="true">根据前面我们对内存管理相关数据结构的设计，你应该不难想到，在 init_memmgr 函数中应该要完成</span></span></span><span data-slate-object="text" data-key="15129"><span data-slate-leaf="true" data-offset-key="15129:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">内存页结构 msadsc_t 和内存区结构 memarea_t 的初始化</span></span></span></span><span data-slate-object="text" data-key="15130"><span data-slate-leaf="true" data-offset-key="15130:0" data-first-offset="true"><span data-slate-string="true">，下面就分别搞定这两件事。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="15131" id="sr-toc-2"><span data-slate-object="text" data-key="15132"><span data-slate-leaf="true" data-offset-key="15132:0" data-first-offset="true"><span data-slate-string="true">内存页结构初始化</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="15133"><span data-slate-object="text" data-key="15134"><span data-slate-leaf="true" data-offset-key="15134:0" data-first-offset="true"><span data-slate-string="true">内存页结构的初始化，其实就是初始化 msadsc_t 结构对应的变量。因为一个 msadsc_t 结构体变量代表一个物理内存页，而物理内存由多个页组成，所以最终会形成一个 msadsc_t 结构体数组。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15135"><span data-slate-object="text" data-key="15136"><span data-slate-leaf="true" data-offset-key="15136:0" data-first-offset="true"><span data-slate-string="true">这会让我们的工作变得简单，我们只需要找一个内存地址，作为 msadsc_t 结构体数组的开始地址，当然这个内存地址必须是可用的，而且之后内存空间足以存放 msadsc_t 结构体数组。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15137"><span data-slate-object="text" data-key="15138"><span data-slate-leaf="true" data-offset-key="15138:0" data-first-offset="true"><span data-slate-string="true">然后，我们要扫描 phymmarge_t 结构体数组中的信息，只要它的类型是可用内存，就建立一个 msadsc_t 结构体，并把其中的开始地址作为第一个页面地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15139"><span data-slate-object="text" data-key="15140"><span data-slate-leaf="true" data-offset-key="15140:0" data-first-offset="true"><span data-slate-string="true">接着，要给这个开始地址加上 0x1000，如此循环，直到其结束地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15141"><span data-slate-object="text" data-key="15142"><span data-slate-leaf="true" data-offset-key="15142:0" data-first-offset="true"><span data-slate-string="true">当这个 phymmarge_t 结构体的地址区间，它对应的所有 msadsc_t 结构体都建立完成之后，就开始下一个 phymmarge_t 结构体。依次类推，最后，我们就能建好所有可用物理内存页面对应的 msadsc_t 结构体。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15143"><span data-slate-object="text" data-key="15144"><span data-slate-leaf="true" data-offset-key="15144:0" data-first-offset="true"><span data-slate-string="true">下面，我们去 cosmos/hal/x86/ 目录下建立一个 msadsc.c 文件。在这里写下完成这些功能的代码，如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="15145"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15146"><span data-slate-object="text" data-key="15147"><span data-slate-leaf="true" data-offset-key="15147:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="15148"><span data-slate-leaf="true" data-offset-key="15148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15149"><span data-slate-leaf="true" data-offset-key="15149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">write_one_msadsc</span></span></span></span></span><span data-slate-object="text" data-key="15150"><span data-slate-leaf="true" data-offset-key="15150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="15151"><span data-slate-leaf="true" data-offset-key="15151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15152"><span data-slate-leaf="true" data-offset-key="15152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *msap, </span></span></span></span></span><span data-slate-object="text" data-key="15153"><span data-slate-leaf="true" data-offset-key="15153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15154"><span data-slate-leaf="true" data-offset-key="15154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> phyadr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15155"><span data-slate-object="text" data-key="15156"><span data-slate-leaf="true" data-offset-key="15156:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15157"><span data-slate-object="text" data-key="15158"><span data-slate-leaf="true" data-offset-key="15158:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15159"><span data-slate-leaf="true" data-offset-key="15159:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 对 msadsc_t 结构做基本的初始化，比如链表、锁、标志位</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15160"><span data-slate-object="text" data-key="15161"><span data-slate-leaf="true" data-offset-key="15161:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15162"><span data-slate-leaf="true" data-offset-key="15162:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t_init</span></span></span></span><span data-slate-object="text" data-key="15163"><span data-slate-leaf="true" data-offset-key="15163:0" data-first-offset="true"><span data-slate-string="true">(msap);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15164"><span data-slate-object="text" data-key="15165"><span data-slate-leaf="true" data-offset-key="15165:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15166"><span data-slate-leaf="true" data-offset-key="15166:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 这是把一个 64 位的变量地址转换成 phyadrflgs_t * 类型方便取得其中的地址位段</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15167"><span data-slate-object="text" data-key="15168"><span data-slate-leaf="true" data-offset-key="15168:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15169"><span data-slate-leaf="true" data-offset-key="15169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadrflgs_t</span></span></span></span><span data-slate-object="text" data-key="15170"><span data-slate-leaf="true" data-offset-key="15170:0" data-first-offset="true"><span data-slate-string="true"> *tmp = (</span></span></span><span data-slate-object="text" data-key="15171"><span data-slate-leaf="true" data-offset-key="15171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadrflgs_t</span></span></span></span><span data-slate-object="text" data-key="15172"><span data-slate-leaf="true" data-offset-key="15172:0" data-first-offset="true"><span data-slate-string="true"> *)(&amp;phyadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15173"><span data-slate-object="text" data-key="15174"><span data-slate-leaf="true" data-offset-key="15174:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15175"><span data-slate-leaf="true" data-offset-key="15175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把页的物理地址写入到 msadsc_t 结构中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15176"><span data-slate-object="text" data-key="15177"><span data-slate-leaf="true" data-offset-key="15177:0" data-first-offset="true"><span data-slate-string="true">    msap-&gt;md_phyadrs.paf_padrs = tmp-&gt;paf_padrs;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15178"><span data-slate-object="text" data-key="15179"><span data-slate-leaf="true" data-offset-key="15179:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15180"><span data-slate-leaf="true" data-offset-key="15180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15181"><span data-slate-leaf="true" data-offset-key="15181:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15182"><span data-slate-object="text" data-key="15183"><span data-slate-leaf="true" data-offset-key="15183:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15184"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15185"><span data-slate-object="text" data-key="15186"><span data-slate-leaf="true" data-offset-key="15186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span><span data-slate-object="text" data-key="15187"><span data-slate-leaf="true" data-offset-key="15187:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15188"><span data-slate-leaf="true" data-offset-key="15188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_msadsc_core</span></span></span></span></span><span data-slate-object="text" data-key="15189"><span data-slate-leaf="true" data-offset-key="15189:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="15190"><span data-slate-leaf="true" data-offset-key="15190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">machbstart_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15191"><span data-slate-leaf="true" data-offset-key="15191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mbsp, </span></span></span></span></span><span data-slate-object="text" data-key="15192"><span data-slate-leaf="true" data-offset-key="15192:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15193"><span data-slate-leaf="true" data-offset-key="15193:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *msavstart, </span></span></span></span></span><span data-slate-object="text" data-key="15194"><span data-slate-leaf="true" data-offset-key="15194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15195"><span data-slate-leaf="true" data-offset-key="15195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msanr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15196"><span data-slate-object="text" data-key="15197"><span data-slate-leaf="true" data-offset-key="15197:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15198"><span data-slate-object="text" data-key="15199"><span data-slate-leaf="true" data-offset-key="15199:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15200"><span data-slate-leaf="true" data-offset-key="15200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 phymmarge_t 结构数组开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15201"><span data-slate-object="text" data-key="15202"><span data-slate-leaf="true" data-offset-key="15202:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15203"><span data-slate-leaf="true" data-offset-key="15203:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phymmarge_t</span></span></span></span><span data-slate-object="text" data-key="15204"><span data-slate-leaf="true" data-offset-key="15204:0" data-first-offset="true"><span data-slate-string="true"> *pmagep = (</span></span></span><span data-slate-object="text" data-key="15205"><span data-slate-leaf="true" data-offset-key="15205:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phymmarge_t</span></span></span></span><span data-slate-object="text" data-key="15206"><span data-slate-leaf="true" data-offset-key="15206:0" data-first-offset="true"><span data-slate-string="true"> *)</span></span></span><span data-slate-object="text" data-key="15207"><span data-slate-leaf="true" data-offset-key="15207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="15208"><span data-slate-leaf="true" data-offset-key="15208:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="15209"><span data-slate-leaf="true" data-offset-key="15209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="15210"><span data-slate-leaf="true" data-offset-key="15210:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_e820expadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15211"><span data-slate-object="text" data-key="15212"><span data-slate-leaf="true" data-offset-key="15212:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15213"><span data-slate-leaf="true" data-offset-key="15213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15214"><span data-slate-leaf="true" data-offset-key="15214:0" data-first-offset="true"><span data-slate-string="true"> mdindx = </span></span></span><span data-slate-object="text" data-key="15215"><span data-slate-leaf="true" data-offset-key="15215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15216"><span data-slate-leaf="true" data-offset-key="15216:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15217"><span data-slate-object="text" data-key="15218"><span data-slate-leaf="true" data-offset-key="15218:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15219"><span data-slate-leaf="true" data-offset-key="15219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 扫描 phymmarge_t 结构数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15220"><span data-slate-object="text" data-key="15221"><span data-slate-leaf="true" data-offset-key="15221:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15222"><span data-slate-leaf="true" data-offset-key="15222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15223"><span data-slate-leaf="true" data-offset-key="15223:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15224"><span data-slate-leaf="true" data-offset-key="15224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15225"><span data-slate-leaf="true" data-offset-key="15225:0" data-first-offset="true"><span data-slate-string="true"> i = </span></span></span><span data-slate-object="text" data-key="15226"><span data-slate-leaf="true" data-offset-key="15226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15227"><span data-slate-leaf="true" data-offset-key="15227:0" data-first-offset="true"><span data-slate-string="true">; i &lt;mbsp-&gt;mb_e820exnr; i++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15228"><span data-slate-object="text" data-key="15229"><span data-slate-leaf="true" data-offset-key="15229:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15230"><span data-slate-object="text" data-key="15231"><span data-slate-leaf="true" data-offset-key="15231:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15232"><span data-slate-leaf="true" data-offset-key="15232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 判断 phymmarge_t 结构的类型是不是可用内存</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15233"><span data-slate-object="text" data-key="15234"><span data-slate-leaf="true" data-offset-key="15234:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15235"><span data-slate-leaf="true" data-offset-key="15235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15236"><span data-slate-leaf="true" data-offset-key="15236:0" data-first-offset="true"><span data-slate-string="true"> (PMR_T_OSAPUSERRAM == pmagep[i].pmr_type)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15237"><span data-slate-object="text" data-key="15238"><span data-slate-leaf="true" data-offset-key="15238:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15239"><span data-slate-object="text" data-key="15240"><span data-slate-leaf="true" data-offset-key="15240:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15241"><span data-slate-leaf="true" data-offset-key="15241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历 phymmarge_t 结构的地址区间</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15242"><span data-slate-object="text" data-key="15243"><span data-slate-leaf="true" data-offset-key="15243:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15244"><span data-slate-leaf="true" data-offset-key="15244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15245"><span data-slate-leaf="true" data-offset-key="15245:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15246"><span data-slate-leaf="true" data-offset-key="15246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15247"><span data-slate-leaf="true" data-offset-key="15247:0" data-first-offset="true"><span data-slate-string="true"> start = pmagep[i].pmr_saddr; start &lt; pmagep[i].pmr_end; start += </span></span></span><span data-slate-object="text" data-key="15248"><span data-slate-leaf="true" data-offset-key="15248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="15249"><span data-slate-leaf="true" data-offset-key="15249:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15250"><span data-slate-object="text" data-key="15251"><span data-slate-leaf="true" data-offset-key="15251:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15252"><span data-slate-object="text" data-key="15253"><span data-slate-leaf="true" data-offset-key="15253:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="15254"><span data-slate-leaf="true" data-offset-key="15254:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 每次加上 4KB-1 比较是否小于等于 phymmarge_t 结构的结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15255"><span data-slate-object="text" data-key="15256"><span data-slate-leaf="true" data-offset-key="15256:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="15257"><span data-slate-leaf="true" data-offset-key="15257:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15258"><span data-slate-leaf="true" data-offset-key="15258:0" data-first-offset="true"><span data-slate-string="true"> ((start + </span></span></span><span data-slate-object="text" data-key="15259"><span data-slate-leaf="true" data-offset-key="15259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4096</span></span></span></span><span data-slate-object="text" data-key="15260"><span data-slate-leaf="true" data-offset-key="15260:0" data-first-offset="true"><span data-slate-string="true"> - </span></span></span><span data-slate-object="text" data-key="15261"><span data-slate-leaf="true" data-offset-key="15261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15262"><span data-slate-leaf="true" data-offset-key="15262:0" data-first-offset="true"><span data-slate-string="true">) &lt;= pmagep[i].pmr_end)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15263"><span data-slate-object="text" data-key="15264"><span data-slate-leaf="true" data-offset-key="15264:0" data-first-offset="true"><span data-slate-string="true">                {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15265"><span data-slate-object="text" data-key="15266"><span data-slate-leaf="true" data-offset-key="15266:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="15267"><span data-slate-leaf="true" data-offset-key="15267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 与当前地址为参数写入第 mdindx 个 msadsc 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15268"><span data-slate-object="text" data-key="15269"><span data-slate-leaf="true" data-offset-key="15269:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="15270"><span data-slate-leaf="true" data-offset-key="15270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">write_one_msadsc</span></span></span></span><span data-slate-object="text" data-key="15271"><span data-slate-leaf="true" data-offset-key="15271:0" data-first-offset="true"><span data-slate-string="true">(&amp;msavstart[mdindx], start);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15272"><span data-slate-object="text" data-key="15273"><span data-slate-leaf="true" data-offset-key="15273:0" data-first-offset="true"><span data-slate-string="true">                    mdindx++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15274"><span data-slate-object="text" data-key="15275"><span data-slate-leaf="true" data-offset-key="15275:0" data-first-offset="true"><span data-slate-string="true">                }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15276"><span data-slate-object="text" data-key="15277"><span data-slate-leaf="true" data-offset-key="15277:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15278"><span data-slate-object="text" data-key="15279"><span data-slate-leaf="true" data-offset-key="15279:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15280"><span data-slate-object="text" data-key="15281"><span data-slate-leaf="true" data-offset-key="15281:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15282"><span data-slate-object="text" data-key="15283"><span data-slate-leaf="true" data-offset-key="15283:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15284"><span data-slate-leaf="true" data-offset-key="15284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15285"><span data-slate-leaf="true" data-offset-key="15285:0" data-first-offset="true"><span data-slate-string="true"> mdindx;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15286"><span data-slate-object="text" data-key="15287"><span data-slate-leaf="true" data-offset-key="15287:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15288"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15289"><span data-slate-object="text" data-key="15290"><span data-slate-leaf="true" data-offset-key="15290:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="15291"><span data-slate-leaf="true" data-offset-key="15291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15292"><span data-slate-leaf="true" data-offset-key="15292:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_msadsc</span></span></span></span></span><span data-slate-object="text" data-key="15293"><span data-slate-leaf="true" data-offset-key="15293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15294"><span data-slate-object="text" data-key="15295"><span data-slate-leaf="true" data-offset-key="15295:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15296"><span data-slate-object="text" data-key="15297"><span data-slate-leaf="true" data-offset-key="15297:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15298"><span data-slate-leaf="true" data-offset-key="15298:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15299"><span data-slate-leaf="true" data-offset-key="15299:0" data-first-offset="true"><span data-slate-string="true"> coremdnr = </span></span></span><span data-slate-object="text" data-key="15300"><span data-slate-leaf="true" data-offset-key="15300:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15301"><span data-slate-leaf="true" data-offset-key="15301:0" data-first-offset="true"><span data-slate-string="true">, msadscnr = </span></span></span><span data-slate-object="text" data-key="15302"><span data-slate-leaf="true" data-offset-key="15302:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15303"><span data-slate-leaf="true" data-offset-key="15303:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15304"><span data-slate-object="text" data-key="15305"><span data-slate-leaf="true" data-offset-key="15305:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15306"><span data-slate-leaf="true" data-offset-key="15306:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="15307"><span data-slate-leaf="true" data-offset-key="15307:0" data-first-offset="true"><span data-slate-string="true"> *msadscvp = </span></span></span><span data-slate-object="text" data-key="15308"><span data-slate-leaf="true" data-offset-key="15308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="15309"><span data-slate-leaf="true" data-offset-key="15309:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15310"><span data-slate-object="text" data-key="15311"><span data-slate-leaf="true" data-offset-key="15311:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15312"><span data-slate-leaf="true" data-offset-key="15312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">machbstart_t</span></span></span></span><span data-slate-object="text" data-key="15313"><span data-slate-leaf="true" data-offset-key="15313:0" data-first-offset="true"><span data-slate-string="true"> *mbsp = &amp;kmachbsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15314"><span data-slate-object="text" data-key="15315"><span data-slate-leaf="true" data-offset-key="15315:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15316"><span data-slate-leaf="true" data-offset-key="15316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 计算 msadsc_t 结构数组的开始地址和数组元素个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15317"><span data-slate-object="text" data-key="15318"><span data-slate-leaf="true" data-offset-key="15318:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15319"><span data-slate-leaf="true" data-offset-key="15319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15320"><span data-slate-leaf="true" data-offset-key="15320:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15321"><span data-slate-leaf="true" data-offset-key="15321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ret_msadsc_vadrandsz</span></span></span></span><span data-slate-object="text" data-key="15322"><span data-slate-leaf="true" data-offset-key="15322:0" data-first-offset="true"><span data-slate-string="true">(mbsp, &amp;msadscvp, &amp;msadscnr) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15323"><span data-slate-object="text" data-key="15324"><span data-slate-leaf="true" data-offset-key="15324:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15325"><span data-slate-object="text" data-key="15326"><span data-slate-leaf="true" data-offset-key="15326:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15327"><span data-slate-leaf="true" data-offset-key="15327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="15328"><span data-slate-leaf="true" data-offset-key="15328:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15329"><span data-slate-leaf="true" data-offset-key="15329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"init_msadsc ret_msadsc_vadrandsz err\n"</span></span></span></span><span data-slate-object="text" data-key="15330"><span data-slate-leaf="true" data-offset-key="15330:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15331"><span data-slate-object="text" data-key="15332"><span data-slate-leaf="true" data-offset-key="15332:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15333"><span data-slate-object="text" data-key="15334"><span data-slate-leaf="true" data-offset-key="15334:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15335"><span data-slate-leaf="true" data-offset-key="15335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 开始真正初始化 msadsc_t 结构数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15336"><span data-slate-object="text" data-key="15337"><span data-slate-leaf="true" data-offset-key="15337:0" data-first-offset="true"><span data-slate-string="true">    coremdnr = </span></span></span><span data-slate-object="text" data-key="15338"><span data-slate-leaf="true" data-offset-key="15338:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_msadsc_core</span></span></span></span><span data-slate-object="text" data-key="15339"><span data-slate-leaf="true" data-offset-key="15339:0" data-first-offset="true"><span data-slate-string="true">(mbsp, msadscvp, msadscnr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15340"><span data-slate-object="text" data-key="15341"><span data-slate-leaf="true" data-offset-key="15341:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15342"><span data-slate-leaf="true" data-offset-key="15342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15343"><span data-slate-leaf="true" data-offset-key="15343:0" data-first-offset="true"><span data-slate-string="true"> (coremdnr != msadscnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15344"><span data-slate-object="text" data-key="15345"><span data-slate-leaf="true" data-offset-key="15345:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15346"><span data-slate-object="text" data-key="15347"><span data-slate-leaf="true" data-offset-key="15347:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15348"><span data-slate-leaf="true" data-offset-key="15348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="15349"><span data-slate-leaf="true" data-offset-key="15349:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15350"><span data-slate-leaf="true" data-offset-key="15350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"init_msadsc init_msadsc_core err\n"</span></span></span></span><span data-slate-object="text" data-key="15351"><span data-slate-leaf="true" data-offset-key="15351:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15352"><span data-slate-object="text" data-key="15353"><span data-slate-leaf="true" data-offset-key="15353:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15354"><span data-slate-object="text" data-key="15355"><span data-slate-leaf="true" data-offset-key="15355:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15356"><span data-slate-leaf="true" data-offset-key="15356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 msadsc_t 结构数组的开始的物理地址写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15357"><span data-slate-object="text" data-key="15358"><span data-slate-leaf="true" data-offset-key="15358:0" data-first-offset="true"><span data-slate-string="true">    mbsp-&gt;mb_memmappadr = </span></span></span><span data-slate-object="text" data-key="15359"><span data-slate-leaf="true" data-offset-key="15359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">viradr_to_phyadr</span></span></span></span><span data-slate-object="text" data-key="15360"><span data-slate-leaf="true" data-offset-key="15360:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="15361"><span data-slate-leaf="true" data-offset-key="15361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="15362"><span data-slate-leaf="true" data-offset-key="15362:0" data-first-offset="true"><span data-slate-string="true">)msadscvp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15363"><span data-slate-object="text" data-key="15364"><span data-slate-leaf="true" data-offset-key="15364:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15365"><span data-slate-leaf="true" data-offset-key="15365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 msadsc_t 结构数组的元素个数写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15366"><span data-slate-object="text" data-key="15367"><span data-slate-leaf="true" data-offset-key="15367:0" data-first-offset="true"><span data-slate-string="true">    mbsp-&gt;mb_memmapnr = coremdnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15368"><span data-slate-object="text" data-key="15369"><span data-slate-leaf="true" data-offset-key="15369:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15370"><span data-slate-leaf="true" data-offset-key="15370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 msadsc_t 结构数组的大小写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15371"><span data-slate-object="text" data-key="15372"><span data-slate-leaf="true" data-offset-key="15372:0" data-first-offset="true"><span data-slate-string="true">    mbsp-&gt;mb_memmapsz = coremdnr * </span></span></span><span data-slate-object="text" data-key="15373"><span data-slate-leaf="true" data-offset-key="15373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="15374"><span data-slate-leaf="true" data-offset-key="15374:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15375"><span data-slate-leaf="true" data-offset-key="15375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="15376"><span data-slate-leaf="true" data-offset-key="15376:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15377"><span data-slate-object="text" data-key="15378"><span data-slate-leaf="true" data-offset-key="15378:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15379"><span data-slate-leaf="true" data-offset-key="15379:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 计算下一个空闲内存的开始地址 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15380"><span data-slate-object="text" data-key="15381"><span data-slate-leaf="true" data-offset-key="15381:0" data-first-offset="true"><span data-slate-string="true">    mbsp-&gt;mb_nextwtpadr = </span></span></span><span data-slate-object="text" data-key="15382"><span data-slate-leaf="true" data-offset-key="15382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PAGE_ALIGN</span></span></span></span><span data-slate-object="text" data-key="15383"><span data-slate-leaf="true" data-offset-key="15383:0" data-first-offset="true"><span data-slate-string="true">(mbsp-&gt;mb_memmappadr + mbsp-&gt;mb_memmapsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15384"><span data-slate-object="text" data-key="15385"><span data-slate-leaf="true" data-offset-key="15385:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15386"><span data-slate-leaf="true" data-offset-key="15386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15387"><span data-slate-leaf="true" data-offset-key="15387:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15388"><span data-slate-object="text" data-key="15389"><span data-slate-leaf="true" data-offset-key="15389:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15390"><span data-slate-object="text" data-key="15391"><span data-slate-leaf="true" data-offset-key="15391:0" data-first-offset="true"><span data-slate-string="true">上面的代码量很少，逻辑也很简单，再配合注释，相信你看得懂。其中的 ret_msadsc_vadrandsz 函数也是遍历 phymmarge_t 结构数组，计算出有多大的可用内存空间，可以分成多少个页面，需要多少个 msadsc_t 结构。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="15392" id="sr-toc-3"><span data-slate-object="text" data-key="15393"><span data-slate-leaf="true" data-offset-key="15393:0" data-first-offset="true"><span data-slate-string="true">内存区结构初始化</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="15394"><span data-slate-object="text" data-key="15395"><span data-slate-leaf="true" data-offset-key="15395:0" data-first-offset="true"><span data-slate-string="true">前面我们将整个物理地址空间在逻辑上分成了三个区，分别是</span></span></span><span data-slate-object="text" data-key="15396"><span data-slate-leaf="true" data-offset-key="15396:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">：硬件区、内核区、用户区</span></span></span></span><span data-slate-object="text" data-key="15397"><span data-slate-leaf="true" data-offset-key="15397:0" data-first-offset="true"><span data-slate-string="true">，这就要求我们要在内存中建立三个 memarea_t 结构体的实例变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15398"><span data-slate-object="text" data-key="15399"><span data-slate-leaf="true" data-offset-key="15399:0" data-first-offset="true"><span data-slate-string="true">就像建立 msadsc_t 结构数组一样，我们只需要在内存中找个空闲空间，存放这三个 memarea_t 结构体就行。相比建立 msadsc_t 结构数组这更为简单，因为 memarea_t 结构体是顶层结构，并不依赖其它数据结构，只是对其本身进行初始化就好了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15400"><span data-slate-object="text" data-key="15401"><span data-slate-leaf="true" data-offset-key="15401:0" data-first-offset="true"><span data-slate-string="true">但是由于它自身包含了其它数据结构，在初始化它时，要对其中的其它数据结构进行初始化，所以要小心一些。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15402"><span data-slate-object="text" data-key="15403"><span data-slate-leaf="true" data-offset-key="15403:0" data-first-offset="true"><span data-slate-string="true">下面我们去 cosmos/hal/x86/ 目录下建立一个 memarea.c 文件，写下完成这些功能的代码，如下所示。</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="15404"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div><div data-code-line-number="99"></div><div data-code-line-number="100"></div><div data-code-line-number="101"></div><div data-code-line-number="102"></div><div data-code-line-number="103"></div><div data-code-line-number="104"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15405"><span data-slate-object="text" data-key="15406"><span data-slate-leaf="true" data-offset-key="15406:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="15407"><span data-slate-leaf="true" data-offset-key="15407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bafhlst_t_init</span></span></span></span><span data-slate-object="text" data-key="15408"><span data-slate-leaf="true" data-offset-key="15408:0" data-first-offset="true"><span data-slate-string="true">(bafhlst_t *initp, u32_t stus, uint_t oder, uint_t oderpnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15409"><span data-slate-object="text" data-key="15410"><span data-slate-leaf="true" data-offset-key="15410:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15411"><span data-slate-object="text" data-key="15412"><span data-slate-leaf="true" data-offset-key="15412:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15413"><span data-slate-leaf="true" data-offset-key="15413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 bafhlst_t 结构体的基本数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15414"><span data-slate-object="text" data-key="15415"><span data-slate-leaf="true" data-offset-key="15415:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15416"><span data-slate-leaf="true" data-offset-key="15416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="15417"><span data-slate-leaf="true" data-offset-key="15417:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15418"><span data-slate-leaf="true" data-offset-key="15418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15419"><span data-slate-leaf="true" data-offset-key="15419:0" data-first-offset="true"><span data-slate-string="true">af_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15420"><span data-slate-object="text" data-key="15421"><span data-slate-leaf="true" data-offset-key="15421:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15422"><span data-slate-leaf="true" data-offset-key="15422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15423"><span data-slate-leaf="true" data-offset-key="15423:0" data-first-offset="true"><span data-slate-string="true">af_stus = stus;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15424"><span data-slate-object="text" data-key="15425"><span data-slate-leaf="true" data-offset-key="15425:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15426"><span data-slate-leaf="true" data-offset-key="15426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15427"><span data-slate-leaf="true" data-offset-key="15427:0" data-first-offset="true"><span data-slate-string="true">af_oder = oder;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15428"><span data-slate-object="text" data-key="15429"><span data-slate-leaf="true" data-offset-key="15429:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15430"><span data-slate-leaf="true" data-offset-key="15430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15431"><span data-slate-leaf="true" data-offset-key="15431:0" data-first-offset="true"><span data-slate-string="true">af_oderpnr = oderpnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15432"><span data-slate-object="text" data-key="15433"><span data-slate-leaf="true" data-offset-key="15433:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15434"><span data-slate-leaf="true" data-offset-key="15434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15435"><span data-slate-leaf="true" data-offset-key="15435:0" data-first-offset="true"><span data-slate-string="true">af_fobjnr = </span></span></span><span data-slate-object="text" data-key="15436"><span data-slate-leaf="true" data-offset-key="15436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15437"><span data-slate-leaf="true" data-offset-key="15437:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15438"><span data-slate-object="text" data-key="15439"><span data-slate-leaf="true" data-offset-key="15439:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15440"><span data-slate-leaf="true" data-offset-key="15440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15441"><span data-slate-leaf="true" data-offset-key="15441:0" data-first-offset="true"><span data-slate-string="true">af_mobjnr = </span></span></span><span data-slate-object="text" data-key="15442"><span data-slate-leaf="true" data-offset-key="15442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15443"><span data-slate-leaf="true" data-offset-key="15443:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15444"><span data-slate-object="text" data-key="15445"><span data-slate-leaf="true" data-offset-key="15445:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15446"><span data-slate-leaf="true" data-offset-key="15446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15447"><span data-slate-leaf="true" data-offset-key="15447:0" data-first-offset="true"><span data-slate-string="true">af_alcindx = </span></span></span><span data-slate-object="text" data-key="15448"><span data-slate-leaf="true" data-offset-key="15448:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15449"><span data-slate-leaf="true" data-offset-key="15449:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15450"><span data-slate-object="text" data-key="15451"><span data-slate-leaf="true" data-offset-key="15451:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15452"><span data-slate-leaf="true" data-offset-key="15452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15453"><span data-slate-leaf="true" data-offset-key="15453:0" data-first-offset="true"><span data-slate-string="true">af_freindx = </span></span></span><span data-slate-object="text" data-key="15454"><span data-slate-leaf="true" data-offset-key="15454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15455"><span data-slate-leaf="true" data-offset-key="15455:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15456"><span data-slate-object="text" data-key="15457"><span data-slate-leaf="true" data-offset-key="15457:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15458"><span data-slate-leaf="true" data-offset-key="15458:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="15459"><span data-slate-leaf="true" data-offset-key="15459:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15460"><span data-slate-leaf="true" data-offset-key="15460:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15461"><span data-slate-leaf="true" data-offset-key="15461:0" data-first-offset="true"><span data-slate-string="true">af_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15462"><span data-slate-object="text" data-key="15463"><span data-slate-leaf="true" data-offset-key="15463:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15464"><span data-slate-leaf="true" data-offset-key="15464:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="15465"><span data-slate-leaf="true" data-offset-key="15465:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15466"><span data-slate-leaf="true" data-offset-key="15466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15467"><span data-slate-leaf="true" data-offset-key="15467:0" data-first-offset="true"><span data-slate-string="true">af_alclst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15468"><span data-slate-object="text" data-key="15469"><span data-slate-leaf="true" data-offset-key="15469:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15470"><span data-slate-leaf="true" data-offset-key="15470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="15471"><span data-slate-leaf="true" data-offset-key="15471:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15472"><span data-slate-leaf="true" data-offset-key="15472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15473"><span data-slate-leaf="true" data-offset-key="15473:0" data-first-offset="true"><span data-slate-string="true">af_ovelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15474"><span data-slate-object="text" data-key="15475"><span data-slate-leaf="true" data-offset-key="15475:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15476"><span data-slate-leaf="true" data-offset-key="15476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15477"><span data-slate-leaf="true" data-offset-key="15477:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15478"><span data-slate-object="text" data-key="15479"><span data-slate-leaf="true" data-offset-key="15479:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15480"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15481"><span data-slate-object="text" data-key="15482"><span data-slate-leaf="true" data-offset-key="15482:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="15483"><span data-slate-leaf="true" data-offset-key="15483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memdivmer_t_init</span></span></span></span><span data-slate-object="text" data-key="15484"><span data-slate-leaf="true" data-offset-key="15484:0" data-first-offset="true"><span data-slate-string="true">(memdivmer_t *initp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15485"><span data-slate-object="text" data-key="15486"><span data-slate-leaf="true" data-offset-key="15486:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15487"><span data-slate-object="text" data-key="15488"><span data-slate-leaf="true" data-offset-key="15488:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15489"><span data-slate-leaf="true" data-offset-key="15489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 medivmer_t 结构体的基本数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15490"><span data-slate-object="text" data-key="15491"><span data-slate-leaf="true" data-offset-key="15491:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15492"><span data-slate-leaf="true" data-offset-key="15492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="15493"><span data-slate-leaf="true" data-offset-key="15493:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15494"><span data-slate-leaf="true" data-offset-key="15494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15495"><span data-slate-leaf="true" data-offset-key="15495:0" data-first-offset="true"><span data-slate-string="true">dm_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15496"><span data-slate-object="text" data-key="15497"><span data-slate-leaf="true" data-offset-key="15497:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15498"><span data-slate-leaf="true" data-offset-key="15498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15499"><span data-slate-leaf="true" data-offset-key="15499:0" data-first-offset="true"><span data-slate-string="true">dm_stus = </span></span></span><span data-slate-object="text" data-key="15500"><span data-slate-leaf="true" data-offset-key="15500:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15501"><span data-slate-leaf="true" data-offset-key="15501:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15502"><span data-slate-object="text" data-key="15503"><span data-slate-leaf="true" data-offset-key="15503:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15504"><span data-slate-leaf="true" data-offset-key="15504:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15505"><span data-slate-leaf="true" data-offset-key="15505:0" data-first-offset="true"><span data-slate-string="true">dm_divnr = </span></span></span><span data-slate-object="text" data-key="15506"><span data-slate-leaf="true" data-offset-key="15506:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15507"><span data-slate-leaf="true" data-offset-key="15507:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15508"><span data-slate-object="text" data-key="15509"><span data-slate-leaf="true" data-offset-key="15509:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15510"><span data-slate-leaf="true" data-offset-key="15510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15511"><span data-slate-leaf="true" data-offset-key="15511:0" data-first-offset="true"><span data-slate-string="true">dm_mernr = </span></span></span><span data-slate-object="text" data-key="15512"><span data-slate-leaf="true" data-offset-key="15512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15513"><span data-slate-leaf="true" data-offset-key="15513:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15514"><span data-slate-object="text" data-key="15515"><span data-slate-leaf="true" data-offset-key="15515:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15516"><span data-slate-leaf="true" data-offset-key="15516:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 循环初始化 memdivmer_t 结构体中 dm_mdmlielst 数组中的每个 bafhlst_t 结构的基本数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15517"><span data-slate-object="text" data-key="15518"><span data-slate-leaf="true" data-offset-key="15518:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15519"><span data-slate-leaf="true" data-offset-key="15519:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15520"><span data-slate-leaf="true" data-offset-key="15520:0" data-first-offset="true"><span data-slate-string="true"> (uint_t li = </span></span></span><span data-slate-object="text" data-key="15521"><span data-slate-leaf="true" data-offset-key="15521:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15522"><span data-slate-leaf="true" data-offset-key="15522:0" data-first-offset="true"><span data-slate-string="true">; li &lt;MDIVMER_ARR_LMAX; li++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15523"><span data-slate-object="text" data-key="15524"><span data-slate-leaf="true" data-offset-key="15524:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15525"><span data-slate-object="text" data-key="15526"><span data-slate-leaf="true" data-offset-key="15526:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15527"><span data-slate-leaf="true" data-offset-key="15527:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bafhlst_t_init</span></span></span></span><span data-slate-object="text" data-key="15528"><span data-slate-leaf="true" data-offset-key="15528:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15529"><span data-slate-leaf="true" data-offset-key="15529:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15530"><span data-slate-leaf="true" data-offset-key="15530:0" data-first-offset="true"><span data-slate-string="true">dm_mdmlielst[li], BAFH_STUS_DIVM, li, (</span></span></span><span data-slate-object="text" data-key="15531"><span data-slate-leaf="true" data-offset-key="15531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15532"><span data-slate-leaf="true" data-offset-key="15532:0" data-first-offset="true"><span data-slate-string="true">UL &lt;&lt;li));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15533"><span data-slate-object="text" data-key="15534"><span data-slate-leaf="true" data-offset-key="15534:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15535"><span data-slate-object="text" data-key="15536"><span data-slate-leaf="true" data-offset-key="15536:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15537"><span data-slate-leaf="true" data-offset-key="15537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bafhlst_t_init</span></span></span></span><span data-slate-object="text" data-key="15538"><span data-slate-leaf="true" data-offset-key="15538:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15539"><span data-slate-leaf="true" data-offset-key="15539:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15540"><span data-slate-leaf="true" data-offset-key="15540:0" data-first-offset="true"><span data-slate-string="true">dm_onemsalst, BAFH_STUS_ONEM, </span></span></span><span data-slate-object="text" data-key="15541"><span data-slate-leaf="true" data-offset-key="15541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15542"><span data-slate-leaf="true" data-offset-key="15542:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="15543"><span data-slate-leaf="true" data-offset-key="15543:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15544"><span data-slate-leaf="true" data-offset-key="15544:0" data-first-offset="true"><span data-slate-string="true">UL);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15545"><span data-slate-object="text" data-key="15546"><span data-slate-leaf="true" data-offset-key="15546:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15547"><span data-slate-leaf="true" data-offset-key="15547:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15548"><span data-slate-leaf="true" data-offset-key="15548:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15549"><span data-slate-object="text" data-key="15550"><span data-slate-leaf="true" data-offset-key="15550:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15551"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15552"><span data-slate-object="text" data-key="15553"><span data-slate-leaf="true" data-offset-key="15553:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="15554"><span data-slate-leaf="true" data-offset-key="15554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t_init</span></span></span></span><span data-slate-object="text" data-key="15555"><span data-slate-leaf="true" data-offset-key="15555:0" data-first-offset="true"><span data-slate-string="true">(memarea_t *initp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15556"><span data-slate-object="text" data-key="15557"><span data-slate-leaf="true" data-offset-key="15557:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15558"><span data-slate-object="text" data-key="15559"><span data-slate-leaf="true" data-offset-key="15559:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15560"><span data-slate-leaf="true" data-offset-key="15560:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 memarea_t 结构体的基本数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15561"><span data-slate-object="text" data-key="15562"><span data-slate-leaf="true" data-offset-key="15562:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15563"><span data-slate-leaf="true" data-offset-key="15563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="15564"><span data-slate-leaf="true" data-offset-key="15564:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15565"><span data-slate-leaf="true" data-offset-key="15565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15566"><span data-slate-leaf="true" data-offset-key="15566:0" data-first-offset="true"><span data-slate-string="true">ma_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15567"><span data-slate-object="text" data-key="15568"><span data-slate-leaf="true" data-offset-key="15568:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15569"><span data-slate-leaf="true" data-offset-key="15569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="15570"><span data-slate-leaf="true" data-offset-key="15570:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15571"><span data-slate-leaf="true" data-offset-key="15571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15572"><span data-slate-leaf="true" data-offset-key="15572:0" data-first-offset="true"><span data-slate-string="true">ma_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15573"><span data-slate-object="text" data-key="15574"><span data-slate-leaf="true" data-offset-key="15574:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15575"><span data-slate-leaf="true" data-offset-key="15575:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15576"><span data-slate-leaf="true" data-offset-key="15576:0" data-first-offset="true"><span data-slate-string="true">ma_stus = </span></span></span><span data-slate-object="text" data-key="15577"><span data-slate-leaf="true" data-offset-key="15577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15578"><span data-slate-leaf="true" data-offset-key="15578:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15579"><span data-slate-object="text" data-key="15580"><span data-slate-leaf="true" data-offset-key="15580:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15581"><span data-slate-leaf="true" data-offset-key="15581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15582"><span data-slate-leaf="true" data-offset-key="15582:0" data-first-offset="true"><span data-slate-string="true">ma_flgs = </span></span></span><span data-slate-object="text" data-key="15583"><span data-slate-leaf="true" data-offset-key="15583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15584"><span data-slate-leaf="true" data-offset-key="15584:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15585"><span data-slate-object="text" data-key="15586"><span data-slate-leaf="true" data-offset-key="15586:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15587"><span data-slate-leaf="true" data-offset-key="15587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15588"><span data-slate-leaf="true" data-offset-key="15588:0" data-first-offset="true"><span data-slate-string="true">ma_type = MA_TYPE_INIT;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15589"><span data-slate-object="text" data-key="15590"><span data-slate-leaf="true" data-offset-key="15590:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15591"><span data-slate-leaf="true" data-offset-key="15591:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15592"><span data-slate-leaf="true" data-offset-key="15592:0" data-first-offset="true"><span data-slate-string="true">ma_maxpages = </span></span></span><span data-slate-object="text" data-key="15593"><span data-slate-leaf="true" data-offset-key="15593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15594"><span data-slate-leaf="true" data-offset-key="15594:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15595"><span data-slate-object="text" data-key="15596"><span data-slate-leaf="true" data-offset-key="15596:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15597"><span data-slate-leaf="true" data-offset-key="15597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15598"><span data-slate-leaf="true" data-offset-key="15598:0" data-first-offset="true"><span data-slate-string="true">ma_allocpages = </span></span></span><span data-slate-object="text" data-key="15599"><span data-slate-leaf="true" data-offset-key="15599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15600"><span data-slate-leaf="true" data-offset-key="15600:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15601"><span data-slate-object="text" data-key="15602"><span data-slate-leaf="true" data-offset-key="15602:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15603"><span data-slate-leaf="true" data-offset-key="15603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15604"><span data-slate-leaf="true" data-offset-key="15604:0" data-first-offset="true"><span data-slate-string="true">ma_freepages = </span></span></span><span data-slate-object="text" data-key="15605"><span data-slate-leaf="true" data-offset-key="15605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15606"><span data-slate-leaf="true" data-offset-key="15606:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15607"><span data-slate-object="text" data-key="15608"><span data-slate-leaf="true" data-offset-key="15608:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15609"><span data-slate-leaf="true" data-offset-key="15609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15610"><span data-slate-leaf="true" data-offset-key="15610:0" data-first-offset="true"><span data-slate-string="true">ma_resvpages = </span></span></span><span data-slate-object="text" data-key="15611"><span data-slate-leaf="true" data-offset-key="15611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15612"><span data-slate-leaf="true" data-offset-key="15612:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15613"><span data-slate-object="text" data-key="15614"><span data-slate-leaf="true" data-offset-key="15614:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15615"><span data-slate-leaf="true" data-offset-key="15615:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15616"><span data-slate-leaf="true" data-offset-key="15616:0" data-first-offset="true"><span data-slate-string="true">ma_horizline = </span></span></span><span data-slate-object="text" data-key="15617"><span data-slate-leaf="true" data-offset-key="15617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15618"><span data-slate-leaf="true" data-offset-key="15618:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15619"><span data-slate-object="text" data-key="15620"><span data-slate-leaf="true" data-offset-key="15620:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15621"><span data-slate-leaf="true" data-offset-key="15621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15622"><span data-slate-leaf="true" data-offset-key="15622:0" data-first-offset="true"><span data-slate-string="true">ma_logicstart = </span></span></span><span data-slate-object="text" data-key="15623"><span data-slate-leaf="true" data-offset-key="15623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15624"><span data-slate-leaf="true" data-offset-key="15624:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15625"><span data-slate-object="text" data-key="15626"><span data-slate-leaf="true" data-offset-key="15626:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15627"><span data-slate-leaf="true" data-offset-key="15627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15628"><span data-slate-leaf="true" data-offset-key="15628:0" data-first-offset="true"><span data-slate-string="true">ma_logicend = </span></span></span><span data-slate-object="text" data-key="15629"><span data-slate-leaf="true" data-offset-key="15629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15630"><span data-slate-leaf="true" data-offset-key="15630:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15631"><span data-slate-object="text" data-key="15632"><span data-slate-leaf="true" data-offset-key="15632:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15633"><span data-slate-leaf="true" data-offset-key="15633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15634"><span data-slate-leaf="true" data-offset-key="15634:0" data-first-offset="true"><span data-slate-string="true">ma_logicsz = </span></span></span><span data-slate-object="text" data-key="15635"><span data-slate-leaf="true" data-offset-key="15635:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15636"><span data-slate-leaf="true" data-offset-key="15636:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15637"><span data-slate-object="text" data-key="15638"><span data-slate-leaf="true" data-offset-key="15638:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15639"><span data-slate-leaf="true" data-offset-key="15639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化 memarea_t 结构体中的 memdivmer_t 结构体</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15640"><span data-slate-object="text" data-key="15641"><span data-slate-leaf="true" data-offset-key="15641:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15642"><span data-slate-leaf="true" data-offset-key="15642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memdivmer_t_init</span></span></span></span><span data-slate-object="text" data-key="15643"><span data-slate-leaf="true" data-offset-key="15643:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="15644"><span data-slate-leaf="true" data-offset-key="15644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15645"><span data-slate-leaf="true" data-offset-key="15645:0" data-first-offset="true"><span data-slate-string="true">ma_mdmdata);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15646"><span data-slate-object="text" data-key="15647"><span data-slate-leaf="true" data-offset-key="15647:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="15648"><span data-slate-leaf="true" data-offset-key="15648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15649"><span data-slate-leaf="true" data-offset-key="15649:0" data-first-offset="true"><span data-slate-string="true">ma_privp = NULL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15650"><span data-slate-object="text" data-key="15651"><span data-slate-leaf="true" data-offset-key="15651:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15652"><span data-slate-leaf="true" data-offset-key="15652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15653"><span data-slate-leaf="true" data-offset-key="15653:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15654"><span data-slate-object="text" data-key="15655"><span data-slate-leaf="true" data-offset-key="15655:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15656"></div><div data-slate-type="code-line" data-slate-object="block" data-key="15657"><span data-slate-object="text" data-key="15658"><span data-slate-leaf="true" data-offset-key="15658:0" data-first-offset="true"><span data-slate-string="true">bool_t </span></span></span><span data-slate-object="text" data-key="15659"><span data-slate-leaf="true" data-offset-key="15659:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memarea_core</span></span></span></span><span data-slate-object="text" data-key="15660"><span data-slate-leaf="true" data-offset-key="15660:0" data-first-offset="true"><span data-slate-string="true">(machbstart_t *mbsp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15661"><span data-slate-object="text" data-key="15662"><span data-slate-leaf="true" data-offset-key="15662:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15663"><span data-slate-object="text" data-key="15664"><span data-slate-leaf="true" data-offset-key="15664:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15665"><span data-slate-leaf="true" data-offset-key="15665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 memarea_t 结构开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15666"><span data-slate-object="text" data-key="15667"><span data-slate-leaf="true" data-offset-key="15667:0" data-first-offset="true"><span data-slate-string="true">    u64_t phymarea = mbsp</span></span></span><span data-slate-object="text" data-key="15668"><span data-slate-leaf="true" data-offset-key="15668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15669"><span data-slate-leaf="true" data-offset-key="15669:0" data-first-offset="true"><span data-slate-string="true">mb_nextwtpadr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15670"><span data-slate-object="text" data-key="15671"><span data-slate-leaf="true" data-offset-key="15671:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15672"><span data-slate-leaf="true" data-offset-key="15672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 检查内存空间够不够放下 MEMAREA_MAX 个 memarea_t 结构实例变量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15673"><span data-slate-object="text" data-key="15674"><span data-slate-leaf="true" data-offset-key="15674:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15675"><span data-slate-leaf="true" data-offset-key="15675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15676"><span data-slate-leaf="true" data-offset-key="15676:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15677"><span data-slate-leaf="true" data-offset-key="15677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">initchkadr_is_ok</span></span></span></span><span data-slate-object="text" data-key="15678"><span data-slate-leaf="true" data-offset-key="15678:0" data-first-offset="true"><span data-slate-string="true">(mbsp, phymarea, (</span></span></span><span data-slate-object="text" data-key="15679"><span data-slate-leaf="true" data-offset-key="15679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="15680"><span data-slate-leaf="true" data-offset-key="15680:0" data-first-offset="true"><span data-slate-string="true">(memarea_t) * MEMAREA_MAX)) != </span></span></span><span data-slate-object="text" data-key="15681"><span data-slate-leaf="true" data-offset-key="15681:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15682"><span data-slate-leaf="true" data-offset-key="15682:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15683"><span data-slate-object="text" data-key="15684"><span data-slate-leaf="true" data-offset-key="15684:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15685"><span data-slate-object="text" data-key="15686"><span data-slate-leaf="true" data-offset-key="15686:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15687"><span data-slate-leaf="true" data-offset-key="15687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15688"><span data-slate-leaf="true" data-offset-key="15688:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15689"><span data-slate-object="text" data-key="15690"><span data-slate-leaf="true" data-offset-key="15690:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15691"><span data-slate-object="text" data-key="15692"><span data-slate-leaf="true" data-offset-key="15692:0" data-first-offset="true"><span data-slate-string="true">    memarea_t *virmarea = (memarea_t *)</span></span></span><span data-slate-object="text" data-key="15693"><span data-slate-leaf="true" data-offset-key="15693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="15694"><span data-slate-leaf="true" data-offset-key="15694:0" data-first-offset="true"><span data-slate-string="true">((adr_t)phymarea);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15695"><span data-slate-object="text" data-key="15696"><span data-slate-leaf="true" data-offset-key="15696:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15697"><span data-slate-leaf="true" data-offset-key="15697:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15698"><span data-slate-leaf="true" data-offset-key="15698:0" data-first-offset="true"><span data-slate-string="true"> (uint_t mai = </span></span></span><span data-slate-object="text" data-key="15699"><span data-slate-leaf="true" data-offset-key="15699:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15700"><span data-slate-leaf="true" data-offset-key="15700:0" data-first-offset="true"><span data-slate-string="true">; mai &lt;MEMAREA_MAX; mai++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15701"><span data-slate-object="text" data-key="15702"><span data-slate-leaf="true" data-offset-key="15702:0" data-first-offset="true"><span data-slate-string="true">    {   </span></span></span><span data-slate-object="text" data-key="15703"><span data-slate-leaf="true" data-offset-key="15703:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 循环初始化每个 memarea_t 结构实例变量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15704"><span data-slate-object="text" data-key="15705"><span data-slate-leaf="true" data-offset-key="15705:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15706"><span data-slate-leaf="true" data-offset-key="15706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t_init</span></span></span></span><span data-slate-object="text" data-key="15707"><span data-slate-leaf="true" data-offset-key="15707:0" data-first-offset="true"><span data-slate-string="true">(&amp;virmarea[mai]);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15708"><span data-slate-object="text" data-key="15709"><span data-slate-leaf="true" data-offset-key="15709:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15710"><span data-slate-object="text" data-key="15711"><span data-slate-leaf="true" data-offset-key="15711:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15712"><span data-slate-leaf="true" data-offset-key="15712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置硬件区的类型和空间大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15713"><span data-slate-object="text" data-key="15714"><span data-slate-leaf="true" data-offset-key="15714:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15715"><span data-slate-leaf="true" data-offset-key="15715:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15716"><span data-slate-leaf="true" data-offset-key="15716:0" data-first-offset="true"><span data-slate-string="true">].ma_type = MA_TYPE_HWAD;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15717"><span data-slate-object="text" data-key="15718"><span data-slate-leaf="true" data-offset-key="15718:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15719"><span data-slate-leaf="true" data-offset-key="15719:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15720"><span data-slate-leaf="true" data-offset-key="15720:0" data-first-offset="true"><span data-slate-string="true">].ma_logicstart = MA_HWAD_LSTART;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15721"><span data-slate-object="text" data-key="15722"><span data-slate-leaf="true" data-offset-key="15722:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15723"><span data-slate-leaf="true" data-offset-key="15723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15724"><span data-slate-leaf="true" data-offset-key="15724:0" data-first-offset="true"><span data-slate-string="true">].ma_logicend = MA_HWAD_LEND;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15725"><span data-slate-object="text" data-key="15726"><span data-slate-leaf="true" data-offset-key="15726:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15727"><span data-slate-leaf="true" data-offset-key="15727:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15728"><span data-slate-leaf="true" data-offset-key="15728:0" data-first-offset="true"><span data-slate-string="true">].ma_logicsz = MA_HWAD_LSZ;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15729"><span data-slate-object="text" data-key="15730"><span data-slate-leaf="true" data-offset-key="15730:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15731"><span data-slate-leaf="true" data-offset-key="15731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置内核区的类型和空间大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15732"><span data-slate-object="text" data-key="15733"><span data-slate-leaf="true" data-offset-key="15733:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15734"><span data-slate-leaf="true" data-offset-key="15734:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15735"><span data-slate-leaf="true" data-offset-key="15735:0" data-first-offset="true"><span data-slate-string="true">].ma_type = MA_TYPE_KRNL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15736"><span data-slate-object="text" data-key="15737"><span data-slate-leaf="true" data-offset-key="15737:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15738"><span data-slate-leaf="true" data-offset-key="15738:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15739"><span data-slate-leaf="true" data-offset-key="15739:0" data-first-offset="true"><span data-slate-string="true">].ma_logicstart = MA_KRNL_LSTART;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15740"><span data-slate-object="text" data-key="15741"><span data-slate-leaf="true" data-offset-key="15741:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15742"><span data-slate-leaf="true" data-offset-key="15742:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15743"><span data-slate-leaf="true" data-offset-key="15743:0" data-first-offset="true"><span data-slate-string="true">].ma_logicend = MA_KRNL_LEND;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15744"><span data-slate-object="text" data-key="15745"><span data-slate-leaf="true" data-offset-key="15745:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15746"><span data-slate-leaf="true" data-offset-key="15746:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="15747"><span data-slate-leaf="true" data-offset-key="15747:0" data-first-offset="true"><span data-slate-string="true">].ma_logicsz = MA_KRNL_LSZ;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15748"><span data-slate-object="text" data-key="15749"><span data-slate-leaf="true" data-offset-key="15749:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15750"><span data-slate-leaf="true" data-offset-key="15750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置应用区的类型和空间大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15751"><span data-slate-object="text" data-key="15752"><span data-slate-leaf="true" data-offset-key="15752:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15753"><span data-slate-leaf="true" data-offset-key="15753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="15754"><span data-slate-leaf="true" data-offset-key="15754:0" data-first-offset="true"><span data-slate-string="true">].ma_type = MA_TYPE_PROC;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15755"><span data-slate-object="text" data-key="15756"><span data-slate-leaf="true" data-offset-key="15756:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15757"><span data-slate-leaf="true" data-offset-key="15757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="15758"><span data-slate-leaf="true" data-offset-key="15758:0" data-first-offset="true"><span data-slate-string="true">].ma_logicstart = MA_PROC_LSTART;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15759"><span data-slate-object="text" data-key="15760"><span data-slate-leaf="true" data-offset-key="15760:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15761"><span data-slate-leaf="true" data-offset-key="15761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="15762"><span data-slate-leaf="true" data-offset-key="15762:0" data-first-offset="true"><span data-slate-string="true">].ma_logicend = MA_PROC_LEND;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15763"><span data-slate-object="text" data-key="15764"><span data-slate-leaf="true" data-offset-key="15764:0" data-first-offset="true"><span data-slate-string="true">    virmarea[</span></span></span><span data-slate-object="text" data-key="15765"><span data-slate-leaf="true" data-offset-key="15765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="15766"><span data-slate-leaf="true" data-offset-key="15766:0" data-first-offset="true"><span data-slate-string="true">].ma_logicsz = MA_PROC_LSZ;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15767"><span data-slate-object="text" data-key="15768"><span data-slate-leaf="true" data-offset-key="15768:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15769"><span data-slate-leaf="true" data-offset-key="15769:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 memarea_t 结构的开始的物理地址写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15770"><span data-slate-object="text" data-key="15771"><span data-slate-leaf="true" data-offset-key="15771:0" data-first-offset="true"><span data-slate-string="true">    mbsp</span></span></span><span data-slate-object="text" data-key="15772"><span data-slate-leaf="true" data-offset-key="15772:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15773"><span data-slate-leaf="true" data-offset-key="15773:0" data-first-offset="true"><span data-slate-string="true">mb_memznpadr = phymarea;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15774"><span data-slate-object="text" data-key="15775"><span data-slate-leaf="true" data-offset-key="15775:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15776"><span data-slate-leaf="true" data-offset-key="15776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将 memarea_t 结构的个数写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15777"><span data-slate-object="text" data-key="15778"><span data-slate-leaf="true" data-offset-key="15778:0" data-first-offset="true"><span data-slate-string="true">    mbsp</span></span></span><span data-slate-object="text" data-key="15779"><span data-slate-leaf="true" data-offset-key="15779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15780"><span data-slate-leaf="true" data-offset-key="15780:0" data-first-offset="true"><span data-slate-string="true">mb_memznnr = MEMAREA_MAX;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15781"><span data-slate-object="text" data-key="15782"><span data-slate-leaf="true" data-offset-key="15782:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15783"><span data-slate-leaf="true" data-offset-key="15783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将所有 memarea_t 结构的大小写入 kmachbsp 结构中 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15784"><span data-slate-object="text" data-key="15785"><span data-slate-leaf="true" data-offset-key="15785:0" data-first-offset="true"><span data-slate-string="true">    mbsp</span></span></span><span data-slate-object="text" data-key="15786"><span data-slate-leaf="true" data-offset-key="15786:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15787"><span data-slate-leaf="true" data-offset-key="15787:0" data-first-offset="true"><span data-slate-string="true">mb_memznsz = </span></span></span><span data-slate-object="text" data-key="15788"><span data-slate-leaf="true" data-offset-key="15788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="15789"><span data-slate-leaf="true" data-offset-key="15789:0" data-first-offset="true"><span data-slate-string="true">(memarea_t) * MEMAREA_MAX;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15790"><span data-slate-object="text" data-key="15791"><span data-slate-leaf="true" data-offset-key="15791:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15792"><span data-slate-leaf="true" data-offset-key="15792:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 计算下一个空闲内存的开始地址 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15793"><span data-slate-object="text" data-key="15794"><span data-slate-leaf="true" data-offset-key="15794:0" data-first-offset="true"><span data-slate-string="true">    mbsp</span></span></span><span data-slate-object="text" data-key="15795"><span data-slate-leaf="true" data-offset-key="15795:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="15796"><span data-slate-leaf="true" data-offset-key="15796:0" data-first-offset="true"><span data-slate-string="true">mb_nextwtpadr = </span></span></span><span data-slate-object="text" data-key="15797"><span data-slate-leaf="true" data-offset-key="15797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">PAGE_ALIGN</span></span></span></span><span data-slate-object="text" data-key="15798"><span data-slate-leaf="true" data-offset-key="15798:0" data-first-offset="true"><span data-slate-string="true">(phymarea + </span></span></span><span data-slate-object="text" data-key="15799"><span data-slate-leaf="true" data-offset-key="15799:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">sizeof</span></span></span></span><span data-slate-object="text" data-key="15800"><span data-slate-leaf="true" data-offset-key="15800:0" data-first-offset="true"><span data-slate-string="true">(memarea_t) * MEMAREA_MAX);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15801"><span data-slate-object="text" data-key="15802"><span data-slate-leaf="true" data-offset-key="15802:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15803"><span data-slate-leaf="true" data-offset-key="15803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15804"><span data-slate-leaf="true" data-offset-key="15804:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15805"><span data-slate-object="text" data-key="15806"><span data-slate-leaf="true" data-offset-key="15806:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15807"><span data-slate-object="text" data-key="15808"><span data-slate-leaf="true" data-offset-key="15808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存区</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15809"><span data-slate-object="text" data-key="15810"><span data-slate-leaf="true" data-offset-key="15810:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="15811"><span data-slate-leaf="true" data-offset-key="15811:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memarea</span></span></span></span><span data-slate-object="text" data-key="15812"><span data-slate-leaf="true" data-offset-key="15812:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15813"><span data-slate-object="text" data-key="15814"><span data-slate-leaf="true" data-offset-key="15814:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15815"><span data-slate-object="text" data-key="15816"><span data-slate-leaf="true" data-offset-key="15816:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15817"><span data-slate-leaf="true" data-offset-key="15817:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 真正初始化内存区</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15818"><span data-slate-object="text" data-key="15819"><span data-slate-leaf="true" data-offset-key="15819:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15820"><span data-slate-leaf="true" data-offset-key="15820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15821"><span data-slate-leaf="true" data-offset-key="15821:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15822"><span data-slate-leaf="true" data-offset-key="15822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memarea_core</span></span></span></span><span data-slate-object="text" data-key="15823"><span data-slate-leaf="true" data-offset-key="15823:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmachbsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15824"><span data-slate-object="text" data-key="15825"><span data-slate-leaf="true" data-offset-key="15825:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15826"><span data-slate-object="text" data-key="15827"><span data-slate-leaf="true" data-offset-key="15827:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15828"><span data-slate-leaf="true" data-offset-key="15828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="15829"><span data-slate-leaf="true" data-offset-key="15829:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="15830"><span data-slate-leaf="true" data-offset-key="15830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"init_memarea_core fail"</span></span></span></span><span data-slate-object="text" data-key="15831"><span data-slate-leaf="true" data-offset-key="15831:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15832"><span data-slate-object="text" data-key="15833"><span data-slate-leaf="true" data-offset-key="15833:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15834"><span data-slate-object="text" data-key="15835"><span data-slate-leaf="true" data-offset-key="15835:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15836"><span data-slate-leaf="true" data-offset-key="15836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15837"><span data-slate-leaf="true" data-offset-key="15837:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15838"><span data-slate-object="text" data-key="15839"><span data-slate-leaf="true" data-offset-key="15839:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15840"><span data-slate-object="text" data-key="15841"><span data-slate-leaf="true" data-offset-key="15841:0" data-first-offset="true"><span data-slate-string="true">由于这些数据结构很大，所以代码有点长，但是重要的代码我都做了详细注释。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15842"><span data-slate-object="text" data-key="15843"><span data-slate-leaf="true" data-offset-key="15843:0" data-first-offset="true"><span data-slate-string="true">在 init_memarea_core 函数的开始，我们调用了 memarea_t_init 函数，对 MEMAREA_MAX 个 memarea_t 结构进行了基本的初始化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15844"><span data-slate-object="text" data-key="15845"><span data-slate-leaf="true" data-offset-key="15845:0" data-first-offset="true"><span data-slate-string="true">然后，在 memarea_t_init 函数中又调用了 memdivmer_t_init 函数，而在 memdivmer_t_init 函数中又调用了 bafhlst_t_init 函数，这保证了那些被包含的数据结构得到了初始化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15846"><span data-slate-object="text" data-key="15847"><span data-slate-leaf="true" data-offset-key="15847:0" data-first-offset="true"><span data-slate-string="true">最后，我们给三个区分别设置了类型和地址空间。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="15848" id="sr-toc-4"><span data-slate-object="text" data-key="15849"><span data-slate-leaf="true" data-offset-key="15849:0" data-first-offset="true"><span data-slate-string="true">处理初始内存占用问题</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="15850"><span data-slate-object="text" data-key="15851"><span data-slate-leaf="true" data-offset-key="15851:0" data-first-offset="true"><span data-slate-string="true">我们初始化了内存页和内存区对应的数据结构，已经可以组织好内存页面了。现在看似已经万事俱备了，其实这有个重大的问题，你知道是什么吗？我给你分析一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15852"><span data-slate-object="text" data-key="15853"><span data-slate-leaf="true" data-offset-key="15853:0" data-first-offset="true"><span data-slate-string="true">目前我们的内存中已经有很多数据了，有 Cosmos 内核本身的执行文件，有字体文件，有 MMU 页表，有打包的内核映像文件，还有刚刚建立的内存页和内存区的数据结构，这些数据都要占用实际的物理内存。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15854"><span data-slate-object="text" data-key="15855"><span data-slate-leaf="true" data-offset-key="15855:0" data-first-offset="true"><span data-slate-string="true">再回头看看我们建立内存页结构 msadsc_t，所有的都是空闲状态，而它们每一个都表示一个实际的物理内存页。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15856"><span data-slate-object="text" data-key="15857"><span data-slate-leaf="true" data-offset-key="15857:0" data-first-offset="true"><span data-slate-string="true">假如在这种情况下，对调用内存分配接口进行内存分配，</span></span></span><span data-slate-object="text" data-key="15858"><span data-slate-leaf="true" data-offset-key="15858:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">它按既定的分配算法查找空闲的 msadsc_t 结构，那它一定会找到内核占用的内存页所对应的 msadsc_t 结构，并把这个内存页分配出去，然后得到这个页面的程序对其进行改写。这样内核数据就会被覆盖，这种情况是我们绝对不能允许的。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15859"><span data-slate-object="text" data-key="15860"><span data-slate-leaf="true" data-offset-key="15860:0" data-first-offset="true"><span data-slate-string="true">所以，我们要把这些已经占用的内存页面所对应的 msadsc_t 结构标记出来，标记成</span></span></span><span data-slate-object="text" data-key="15861"><span data-slate-leaf="true" data-offset-key="15861:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">已分配</span></span></span></span><span data-slate-object="text" data-key="15862"><span data-slate-leaf="true" data-offset-key="15862:0" data-first-offset="true"><span data-slate-string="true">，这样内存分配算法就不会找到它们了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15863"><span data-slate-object="text" data-key="15864"><span data-slate-leaf="true" data-offset-key="15864:0" data-first-offset="true"><span data-slate-string="true">要解决这个问题，我们只要给出被占用内存的起始地址和结束地址，然后从起始地址开始查找对应的 msadsc_t 结构，再把它标记为已经分配，最后直到查找到结束地址为止。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="15865"><span data-slate-object="text" data-key="15866"><span data-slate-leaf="true" data-offset-key="15866:0" data-first-offset="true"><span data-slate-string="true">下面我们在 msadsc.c 文件中来实现这个方案，代码如下。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="15867"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="15868"><span data-slate-object="text" data-key="15869"><span data-slate-leaf="true" data-offset-key="15869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 搜索一段内存地址空间所对应的 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15870"><span data-slate-object="text" data-key="15871"><span data-slate-leaf="true" data-offset-key="15871:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span><span data-slate-object="text" data-key="15872"><span data-slate-leaf="true" data-offset-key="15872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="15873"><span data-slate-leaf="true" data-offset-key="15873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_segment_occupymsadsc</span></span></span></span></span><span data-slate-object="text" data-key="15874"><span data-slate-leaf="true" data-offset-key="15874:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="15875"><span data-slate-leaf="true" data-offset-key="15875:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15876"><span data-slate-leaf="true" data-offset-key="15876:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *msastart, </span></span></span></span></span><span data-slate-object="text" data-key="15877"><span data-slate-leaf="true" data-offset-key="15877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15878"><span data-slate-leaf="true" data-offset-key="15878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msanr, </span></span></span></span></span><span data-slate-object="text" data-key="15879"><span data-slate-leaf="true" data-offset-key="15879:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15880"><span data-slate-leaf="true" data-offset-key="15880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> ocpystat, </span></span></span></span></span><span data-slate-object="text" data-key="15881"><span data-slate-leaf="true" data-offset-key="15881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span></span></span><span data-slate-object="text" data-key="15882"><span data-slate-leaf="true" data-offset-key="15882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> ocpyend)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15883"><span data-slate-object="text" data-key="15884"><span data-slate-leaf="true" data-offset-key="15884:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15885"><span data-slate-object="text" data-key="15886"><span data-slate-leaf="true" data-offset-key="15886:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15887"><span data-slate-leaf="true" data-offset-key="15887:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15888"><span data-slate-leaf="true" data-offset-key="15888:0" data-first-offset="true"><span data-slate-string="true"> mphyadr = </span></span></span><span data-slate-object="text" data-key="15889"><span data-slate-leaf="true" data-offset-key="15889:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15890"><span data-slate-leaf="true" data-offset-key="15890:0" data-first-offset="true"><span data-slate-string="true">, fsmsnr = </span></span></span><span data-slate-object="text" data-key="15891"><span data-slate-leaf="true" data-offset-key="15891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15892"><span data-slate-leaf="true" data-offset-key="15892:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15893"><span data-slate-object="text" data-key="15894"><span data-slate-leaf="true" data-offset-key="15894:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15895"><span data-slate-leaf="true" data-offset-key="15895:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="15896"><span data-slate-leaf="true" data-offset-key="15896:0" data-first-offset="true"><span data-slate-string="true"> *fstatmp = </span></span></span><span data-slate-object="text" data-key="15897"><span data-slate-leaf="true" data-offset-key="15897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="15898"><span data-slate-leaf="true" data-offset-key="15898:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15899"><span data-slate-object="text" data-key="15900"><span data-slate-leaf="true" data-offset-key="15900:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15901"><span data-slate-leaf="true" data-offset-key="15901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15902"><span data-slate-leaf="true" data-offset-key="15902:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15903"><span data-slate-leaf="true" data-offset-key="15903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15904"><span data-slate-leaf="true" data-offset-key="15904:0" data-first-offset="true"><span data-slate-string="true"> mnr = </span></span></span><span data-slate-object="text" data-key="15905"><span data-slate-leaf="true" data-offset-key="15905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15906"><span data-slate-leaf="true" data-offset-key="15906:0" data-first-offset="true"><span data-slate-string="true">; mnr &lt;msanr; mnr++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15907"><span data-slate-object="text" data-key="15908"><span data-slate-leaf="true" data-offset-key="15908:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15909"><span data-slate-object="text" data-key="15910"><span data-slate-leaf="true" data-offset-key="15910:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15911"><span data-slate-leaf="true" data-offset-key="15911:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15912"><span data-slate-leaf="true" data-offset-key="15912:0" data-first-offset="true"><span data-slate-string="true"> ((msastart[mnr].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE) == ocpystat)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15913"><span data-slate-object="text" data-key="15914"><span data-slate-leaf="true" data-offset-key="15914:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15915"><span data-slate-object="text" data-key="15916"><span data-slate-leaf="true" data-offset-key="15916:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15917"><span data-slate-leaf="true" data-offset-key="15917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 找出开始地址对应的第一个 msadsc_t 结构，就跳转到 step1</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15918"><span data-slate-object="text" data-key="15919"><span data-slate-leaf="true" data-offset-key="15919:0" data-first-offset="true"><span data-slate-string="true">            fstatmp = &amp;msastart[mnr];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15920"><span data-slate-object="text" data-key="15921"><span data-slate-leaf="true" data-offset-key="15921:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15922"><span data-slate-leaf="true" data-offset-key="15922:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">goto</span></span></span></span><span data-slate-object="text" data-key="15923"><span data-slate-leaf="true" data-offset-key="15923:0" data-first-offset="true"><span data-slate-string="true"> step1;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15924"><span data-slate-object="text" data-key="15925"><span data-slate-leaf="true" data-offset-key="15925:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15926"><span data-slate-object="text" data-key="15927"><span data-slate-leaf="true" data-offset-key="15927:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15928"><span data-slate-object="text" data-key="15929"><span data-slate-leaf="true" data-offset-key="15929:0" data-first-offset="true"><span data-slate-string="true">step1:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15930"><span data-slate-object="text" data-key="15931"><span data-slate-leaf="true" data-offset-key="15931:0" data-first-offset="true"><span data-slate-string="true">    fsmsnr = </span></span></span><span data-slate-object="text" data-key="15932"><span data-slate-leaf="true" data-offset-key="15932:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15933"><span data-slate-leaf="true" data-offset-key="15933:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15934"><span data-slate-object="text" data-key="15935"><span data-slate-leaf="true" data-offset-key="15935:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15936"><span data-slate-leaf="true" data-offset-key="15936:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15937"><span data-slate-leaf="true" data-offset-key="15937:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15938"><span data-slate-leaf="true" data-offset-key="15938:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="15939"><span data-slate-leaf="true" data-offset-key="15939:0" data-first-offset="true"><span data-slate-string="true"> == fstatmp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15940"><span data-slate-object="text" data-key="15941"><span data-slate-leaf="true" data-offset-key="15941:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15942"><span data-slate-object="text" data-key="15943"><span data-slate-leaf="true" data-offset-key="15943:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15944"><span data-slate-leaf="true" data-offset-key="15944:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15945"><span data-slate-leaf="true" data-offset-key="15945:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15946"><span data-slate-leaf="true" data-offset-key="15946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15947"><span data-slate-leaf="true" data-offset-key="15947:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15948"><span data-slate-object="text" data-key="15949"><span data-slate-leaf="true" data-offset-key="15949:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15950"><span data-slate-object="text" data-key="15951"><span data-slate-leaf="true" data-offset-key="15951:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="15952"><span data-slate-leaf="true" data-offset-key="15952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="15953"><span data-slate-leaf="true" data-offset-key="15953:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="15954"><span data-slate-leaf="true" data-offset-key="15954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="15955"><span data-slate-leaf="true" data-offset-key="15955:0" data-first-offset="true"><span data-slate-string="true"> tmpadr = ocpystat; tmpadr &lt;ocpyend; tmpadr += PAGESIZE, fsmsnr++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15956"><span data-slate-object="text" data-key="15957"><span data-slate-leaf="true" data-offset-key="15957:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15958"><span data-slate-object="text" data-key="15959"><span data-slate-leaf="true" data-offset-key="15959:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15960"><span data-slate-leaf="true" data-offset-key="15960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从开始地址对应的第一个 msadsc_t 结构开始设置，直到结束地址对应的最后一个 masdsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15961"><span data-slate-object="text" data-key="15962"><span data-slate-leaf="true" data-offset-key="15962:0" data-first-offset="true"><span data-slate-string="true">        mphyadr = fstatmp[fsmsnr].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15963"><span data-slate-object="text" data-key="15964"><span data-slate-leaf="true" data-offset-key="15964:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15965"><span data-slate-leaf="true" data-offset-key="15965:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15966"><span data-slate-leaf="true" data-offset-key="15966:0" data-first-offset="true"><span data-slate-string="true"> (mphyadr != tmpadr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15967"><span data-slate-object="text" data-key="15968"><span data-slate-leaf="true" data-offset-key="15968:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15969"><span data-slate-object="text" data-key="15970"><span data-slate-leaf="true" data-offset-key="15970:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15971"><span data-slate-leaf="true" data-offset-key="15971:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15972"><span data-slate-leaf="true" data-offset-key="15972:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15973"><span data-slate-leaf="true" data-offset-key="15973:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15974"><span data-slate-leaf="true" data-offset-key="15974:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15975"><span data-slate-object="text" data-key="15976"><span data-slate-leaf="true" data-offset-key="15976:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15977"><span data-slate-object="text" data-key="15978"><span data-slate-leaf="true" data-offset-key="15978:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15979"><span data-slate-leaf="true" data-offset-key="15979:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="15980"><span data-slate-leaf="true" data-offset-key="15980:0" data-first-offset="true"><span data-slate-string="true"> (MF_MOCTY_FREE != fstatmp[fsmsnr].md_indxflgs.mf_mocty ||</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15981"><span data-slate-object="text" data-key="15982"><span data-slate-leaf="true" data-offset-key="15982:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15983"><span data-slate-leaf="true" data-offset-key="15983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15984"><span data-slate-leaf="true" data-offset-key="15984:0" data-first-offset="true"><span data-slate-string="true"> != fstatmp[fsmsnr].md_indxflgs.mf_uindx ||</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15985"><span data-slate-object="text" data-key="15986"><span data-slate-leaf="true" data-offset-key="15986:0" data-first-offset="true"><span data-slate-string="true">            PAF_NO_ALLOC != fstatmp[fsmsnr].md_phyadrs.paf_alloc)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15987"><span data-slate-object="text" data-key="15988"><span data-slate-leaf="true" data-offset-key="15988:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15989"><span data-slate-object="text" data-key="15990"><span data-slate-leaf="true" data-offset-key="15990:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="15991"><span data-slate-leaf="true" data-offset-key="15991:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="15992"><span data-slate-leaf="true" data-offset-key="15992:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="15993"><span data-slate-leaf="true" data-offset-key="15993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="15994"><span data-slate-leaf="true" data-offset-key="15994:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15995"><span data-slate-object="text" data-key="15996"><span data-slate-leaf="true" data-offset-key="15996:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="15997"><span data-slate-object="text" data-key="15998"><span data-slate-leaf="true" data-offset-key="15998:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="15999"><span data-slate-leaf="true" data-offset-key="15999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 msadsc_t 结构为已经分配，已经分配给内核</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16000"><span data-slate-object="text" data-key="16001"><span data-slate-leaf="true" data-offset-key="16001:0" data-first-offset="true"><span data-slate-string="true">        fstatmp[fsmsnr].md_indxflgs.mf_mocty = MF_MOCTY_KRNL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16002"><span data-slate-object="text" data-key="16003"><span data-slate-leaf="true" data-offset-key="16003:0" data-first-offset="true"><span data-slate-string="true">        fstatmp[fsmsnr].md_indxflgs.mf_uindx++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16004"><span data-slate-object="text" data-key="16005"><span data-slate-leaf="true" data-offset-key="16005:0" data-first-offset="true"><span data-slate-string="true">        fstatmp[fsmsnr].md_phyadrs.paf_alloc = PAF_ALLOC;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16006"><span data-slate-object="text" data-key="16007"><span data-slate-leaf="true" data-offset-key="16007:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16008"><span data-slate-object="text" data-key="16009"><span data-slate-leaf="true" data-offset-key="16009:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16010"><span data-slate-leaf="true" data-offset-key="16010:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 进行一些数据的正确性检查</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16011"><span data-slate-object="text" data-key="16012"><span data-slate-leaf="true" data-offset-key="16012:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16013"><span data-slate-leaf="true" data-offset-key="16013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="16014"><span data-slate-leaf="true" data-offset-key="16014:0" data-first-offset="true"><span data-slate-string="true"> ocpysz = ocpyend - ocpystat;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16015"><span data-slate-object="text" data-key="16016"><span data-slate-leaf="true" data-offset-key="16016:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16017"><span data-slate-leaf="true" data-offset-key="16017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16018"><span data-slate-leaf="true" data-offset-key="16018:0" data-first-offset="true"><span data-slate-string="true"> ((ocpysz &amp; </span></span></span><span data-slate-object="text" data-key="16019"><span data-slate-leaf="true" data-offset-key="16019:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0xfff</span></span></span></span><span data-slate-object="text" data-key="16020"><span data-slate-leaf="true" data-offset-key="16020:0" data-first-offset="true"><span data-slate-string="true">) != </span></span></span><span data-slate-object="text" data-key="16021"><span data-slate-leaf="true" data-offset-key="16021:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16022"><span data-slate-leaf="true" data-offset-key="16022:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16023"><span data-slate-object="text" data-key="16024"><span data-slate-leaf="true" data-offset-key="16024:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16025"><span data-slate-object="text" data-key="16026"><span data-slate-leaf="true" data-offset-key="16026:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16027"><span data-slate-leaf="true" data-offset-key="16027:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16028"><span data-slate-leaf="true" data-offset-key="16028:0" data-first-offset="true"><span data-slate-string="true"> (((ocpysz&gt;&gt; PSHRSIZE) + </span></span></span><span data-slate-object="text" data-key="16029"><span data-slate-leaf="true" data-offset-key="16029:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16030"><span data-slate-leaf="true" data-offset-key="16030:0" data-first-offset="true"><span data-slate-string="true">) != fsmsnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16031"><span data-slate-object="text" data-key="16032"><span data-slate-leaf="true" data-offset-key="16032:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16033"><span data-slate-object="text" data-key="16034"><span data-slate-leaf="true" data-offset-key="16034:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16035"><span data-slate-leaf="true" data-offset-key="16035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16036"><span data-slate-leaf="true" data-offset-key="16036:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16037"><span data-slate-leaf="true" data-offset-key="16037:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16038"><span data-slate-leaf="true" data-offset-key="16038:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16039"><span data-slate-object="text" data-key="16040"><span data-slate-leaf="true" data-offset-key="16040:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16041"><span data-slate-object="text" data-key="16042"><span data-slate-leaf="true" data-offset-key="16042:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16043"><span data-slate-leaf="true" data-offset-key="16043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16044"><span data-slate-leaf="true" data-offset-key="16044:0" data-first-offset="true"><span data-slate-string="true"> fsmsnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16045"><span data-slate-object="text" data-key="16046"><span data-slate-leaf="true" data-offset-key="16046:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16047"><span data-slate-object="text" data-key="16048"><span data-slate-leaf="true" data-offset-key="16048:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16049"><span data-slate-leaf="true" data-offset-key="16049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16050"><span data-slate-leaf="true" data-offset-key="16050:0" data-first-offset="true"><span data-slate-string="true"> ((ocpysz&gt;&gt; PSHRSIZE) != fsmsnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16051"><span data-slate-object="text" data-key="16052"><span data-slate-leaf="true" data-offset-key="16052:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16053"><span data-slate-object="text" data-key="16054"><span data-slate-leaf="true" data-offset-key="16054:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16055"><span data-slate-leaf="true" data-offset-key="16055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16056"><span data-slate-leaf="true" data-offset-key="16056:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="16057"><span data-slate-leaf="true" data-offset-key="16057:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16058"><span data-slate-leaf="true" data-offset-key="16058:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16059"><span data-slate-object="text" data-key="16060"><span data-slate-leaf="true" data-offset-key="16060:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16061"><span data-slate-object="text" data-key="16062"><span data-slate-leaf="true" data-offset-key="16062:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16063"><span data-slate-leaf="true" data-offset-key="16063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16064"><span data-slate-leaf="true" data-offset-key="16064:0" data-first-offset="true"><span data-slate-string="true"> fsmsnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16065"><span data-slate-object="text" data-key="16066"><span data-slate-leaf="true" data-offset-key="16066:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16067"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16068"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16069"><span data-slate-object="text" data-key="16070"><span data-slate-leaf="true" data-offset-key="16070:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16071"><span data-slate-leaf="true" data-offset-key="16071:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16072"><span data-slate-leaf="true" data-offset-key="16072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_krloccupymsadsc_core</span></span></span></span></span><span data-slate-object="text" data-key="16073"><span data-slate-leaf="true" data-offset-key="16073:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16074"><span data-slate-leaf="true" data-offset-key="16074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">machbstart_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16075"><span data-slate-leaf="true" data-offset-key="16075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mbsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16076"><span data-slate-object="text" data-key="16077"><span data-slate-leaf="true" data-offset-key="16077:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16078"><span data-slate-object="text" data-key="16079"><span data-slate-leaf="true" data-offset-key="16079:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16080"><span data-slate-leaf="true" data-offset-key="16080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="16081"><span data-slate-leaf="true" data-offset-key="16081:0" data-first-offset="true"><span data-slate-string="true"> retschmnr = </span></span></span><span data-slate-object="text" data-key="16082"><span data-slate-leaf="true" data-offset-key="16082:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16083"><span data-slate-leaf="true" data-offset-key="16083:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16084"><span data-slate-object="text" data-key="16085"><span data-slate-leaf="true" data-offset-key="16085:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16086"><span data-slate-leaf="true" data-offset-key="16086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16087"><span data-slate-leaf="true" data-offset-key="16087:0" data-first-offset="true"><span data-slate-string="true"> *msadstat = (</span></span></span><span data-slate-object="text" data-key="16088"><span data-slate-leaf="true" data-offset-key="16088:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16089"><span data-slate-leaf="true" data-offset-key="16089:0" data-first-offset="true"><span data-slate-string="true"> *)</span></span></span><span data-slate-object="text" data-key="16090"><span data-slate-leaf="true" data-offset-key="16090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="16091"><span data-slate-leaf="true" data-offset-key="16091:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="16092"><span data-slate-leaf="true" data-offset-key="16092:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="16093"><span data-slate-leaf="true" data-offset-key="16093:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memmappadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16094"><span data-slate-object="text" data-key="16095"><span data-slate-leaf="true" data-offset-key="16095:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16096"><span data-slate-leaf="true" data-offset-key="16096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="16097"><span data-slate-leaf="true" data-offset-key="16097:0" data-first-offset="true"><span data-slate-string="true"> msanr = mbsp-&gt;mb_memmapnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16098"><span data-slate-object="text" data-key="16099"><span data-slate-leaf="true" data-offset-key="16099:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16100"><span data-slate-leaf="true" data-offset-key="16100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 搜索 BIOS 中断表占用的内存页所对应 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16101"><span data-slate-object="text" data-key="16102"><span data-slate-leaf="true" data-offset-key="16102:0" data-first-offset="true"><span data-slate-string="true">    retschmnr = </span></span></span><span data-slate-object="text" data-key="16103"><span data-slate-leaf="true" data-offset-key="16103:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_segment_occupymsadsc</span></span></span></span><span data-slate-object="text" data-key="16104"><span data-slate-leaf="true" data-offset-key="16104:0" data-first-offset="true"><span data-slate-string="true">(msadstat, msanr, </span></span></span><span data-slate-object="text" data-key="16105"><span data-slate-leaf="true" data-offset-key="16105:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16106"><span data-slate-leaf="true" data-offset-key="16106:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="16107"><span data-slate-leaf="true" data-offset-key="16107:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0x1000</span></span></span></span><span data-slate-object="text" data-key="16108"><span data-slate-leaf="true" data-offset-key="16108:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16109"><span data-slate-object="text" data-key="16110"><span data-slate-leaf="true" data-offset-key="16110:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16111"><span data-slate-leaf="true" data-offset-key="16111:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16112"><span data-slate-leaf="true" data-offset-key="16112:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16113"><span data-slate-leaf="true" data-offset-key="16113:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16114"><span data-slate-leaf="true" data-offset-key="16114:0" data-first-offset="true"><span data-slate-string="true"> == retschmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16115"><span data-slate-object="text" data-key="16116"><span data-slate-leaf="true" data-offset-key="16116:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16117"><span data-slate-object="text" data-key="16118"><span data-slate-leaf="true" data-offset-key="16118:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16119"><span data-slate-leaf="true" data-offset-key="16119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16120"><span data-slate-leaf="true" data-offset-key="16120:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16121"><span data-slate-object="text" data-key="16122"><span data-slate-leaf="true" data-offset-key="16122:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16123"><span data-slate-object="text" data-key="16124"><span data-slate-leaf="true" data-offset-key="16124:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16125"><span data-slate-leaf="true" data-offset-key="16125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 搜索内核栈占用的内存页所对应 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16126"><span data-slate-object="text" data-key="16127"><span data-slate-leaf="true" data-offset-key="16127:0" data-first-offset="true"><span data-slate-string="true">    retschmnr = </span></span></span><span data-slate-object="text" data-key="16128"><span data-slate-leaf="true" data-offset-key="16128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_segment_occupymsadsc</span></span></span></span><span data-slate-object="text" data-key="16129"><span data-slate-leaf="true" data-offset-key="16129:0" data-first-offset="true"><span data-slate-string="true">(msadstat, msanr, mbsp-&gt;mb_krlinitstack &amp; (~(</span></span></span><span data-slate-object="text" data-key="16130"><span data-slate-leaf="true" data-offset-key="16130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0xfff</span></span></span></span><span data-slate-object="text" data-key="16131"><span data-slate-leaf="true" data-offset-key="16131:0" data-first-offset="true"><span data-slate-string="true">UL)), mbsp-&gt;mb_krlinitstack);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16132"><span data-slate-object="text" data-key="16133"><span data-slate-leaf="true" data-offset-key="16133:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16134"><span data-slate-leaf="true" data-offset-key="16134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16135"><span data-slate-leaf="true" data-offset-key="16135:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16136"><span data-slate-leaf="true" data-offset-key="16136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16137"><span data-slate-leaf="true" data-offset-key="16137:0" data-first-offset="true"><span data-slate-string="true"> == retschmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16138"><span data-slate-object="text" data-key="16139"><span data-slate-leaf="true" data-offset-key="16139:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16140"><span data-slate-object="text" data-key="16141"><span data-slate-leaf="true" data-offset-key="16141:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16142"><span data-slate-leaf="true" data-offset-key="16142:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16143"><span data-slate-leaf="true" data-offset-key="16143:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16144"><span data-slate-object="text" data-key="16145"><span data-slate-leaf="true" data-offset-key="16145:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16146"><span data-slate-object="text" data-key="16147"><span data-slate-leaf="true" data-offset-key="16147:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16148"><span data-slate-leaf="true" data-offset-key="16148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 搜索内核占用的内存页所对应 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16149"><span data-slate-object="text" data-key="16150"><span data-slate-leaf="true" data-offset-key="16150:0" data-first-offset="true"><span data-slate-string="true">    retschmnr = </span></span></span><span data-slate-object="text" data-key="16151"><span data-slate-leaf="true" data-offset-key="16151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_segment_occupymsadsc</span></span></span></span><span data-slate-object="text" data-key="16152"><span data-slate-leaf="true" data-offset-key="16152:0" data-first-offset="true"><span data-slate-string="true">(msadstat, msanr, mbsp-&gt;mb_krlimgpadr, mbsp-&gt;mb_nextwtpadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16153"><span data-slate-object="text" data-key="16154"><span data-slate-leaf="true" data-offset-key="16154:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16155"><span data-slate-leaf="true" data-offset-key="16155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16156"><span data-slate-leaf="true" data-offset-key="16156:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16157"><span data-slate-leaf="true" data-offset-key="16157:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16158"><span data-slate-leaf="true" data-offset-key="16158:0" data-first-offset="true"><span data-slate-string="true"> == retschmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16159"><span data-slate-object="text" data-key="16160"><span data-slate-leaf="true" data-offset-key="16160:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16161"><span data-slate-object="text" data-key="16162"><span data-slate-leaf="true" data-offset-key="16162:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16163"><span data-slate-leaf="true" data-offset-key="16163:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16164"><span data-slate-leaf="true" data-offset-key="16164:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16165"><span data-slate-object="text" data-key="16166"><span data-slate-leaf="true" data-offset-key="16166:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16167"><span data-slate-object="text" data-key="16168"><span data-slate-leaf="true" data-offset-key="16168:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16169"><span data-slate-leaf="true" data-offset-key="16169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 搜索内核映像文件占用的内存页所对应 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16170"><span data-slate-object="text" data-key="16171"><span data-slate-leaf="true" data-offset-key="16171:0" data-first-offset="true"><span data-slate-string="true">    retschmnr = </span></span></span><span data-slate-object="text" data-key="16172"><span data-slate-leaf="true" data-offset-key="16172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_segment_occupymsadsc</span></span></span></span><span data-slate-object="text" data-key="16173"><span data-slate-leaf="true" data-offset-key="16173:0" data-first-offset="true"><span data-slate-string="true">(msadstat, msanr, mbsp-&gt;mb_imgpadr, mbsp-&gt;mb_imgpadr + mbsp-&gt;mb_imgsz);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16174"><span data-slate-object="text" data-key="16175"><span data-slate-leaf="true" data-offset-key="16175:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16176"><span data-slate-leaf="true" data-offset-key="16176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16177"><span data-slate-leaf="true" data-offset-key="16177:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16178"><span data-slate-leaf="true" data-offset-key="16178:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16179"><span data-slate-leaf="true" data-offset-key="16179:0" data-first-offset="true"><span data-slate-string="true"> == retschmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16180"><span data-slate-object="text" data-key="16181"><span data-slate-leaf="true" data-offset-key="16181:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16182"><span data-slate-object="text" data-key="16183"><span data-slate-leaf="true" data-offset-key="16183:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16184"><span data-slate-leaf="true" data-offset-key="16184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16185"><span data-slate-leaf="true" data-offset-key="16185:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16186"><span data-slate-object="text" data-key="16187"><span data-slate-leaf="true" data-offset-key="16187:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16188"><span data-slate-object="text" data-key="16189"><span data-slate-leaf="true" data-offset-key="16189:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16190"><span data-slate-leaf="true" data-offset-key="16190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16191"><span data-slate-leaf="true" data-offset-key="16191:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16192"><span data-slate-object="text" data-key="16193"><span data-slate-leaf="true" data-offset-key="16193:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16194"><span data-slate-object="text" data-key="16195"><span data-slate-leaf="true" data-offset-key="16195:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化搜索内核占用的内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16196"><span data-slate-object="text" data-key="16197"><span data-slate-leaf="true" data-offset-key="16197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="16198"><span data-slate-leaf="true" data-offset-key="16198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16199"><span data-slate-leaf="true" data-offset-key="16199:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_search_krloccupymm</span></span></span></span></span><span data-slate-object="text" data-key="16200"><span data-slate-leaf="true" data-offset-key="16200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16201"><span data-slate-leaf="true" data-offset-key="16201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">machbstart_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16202"><span data-slate-leaf="true" data-offset-key="16202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mbsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16203"><span data-slate-object="text" data-key="16204"><span data-slate-leaf="true" data-offset-key="16204:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16205"><span data-slate-object="text" data-key="16206"><span data-slate-leaf="true" data-offset-key="16206:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16207"><span data-slate-leaf="true" data-offset-key="16207:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实际初始化搜索内核占用的内存页面</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16208"><span data-slate-object="text" data-key="16209"><span data-slate-leaf="true" data-offset-key="16209:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16210"><span data-slate-leaf="true" data-offset-key="16210:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16211"><span data-slate-leaf="true" data-offset-key="16211:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16212"><span data-slate-leaf="true" data-offset-key="16212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">search_krloccupymsadsc_core</span></span></span></span><span data-slate-object="text" data-key="16213"><span data-slate-leaf="true" data-offset-key="16213:0" data-first-offset="true"><span data-slate-string="true">(mbsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16214"><span data-slate-object="text" data-key="16215"><span data-slate-leaf="true" data-offset-key="16215:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16216"><span data-slate-object="text" data-key="16217"><span data-slate-leaf="true" data-offset-key="16217:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16218"><span data-slate-leaf="true" data-offset-key="16218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="16219"><span data-slate-leaf="true" data-offset-key="16219:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="16220"><span data-slate-leaf="true" data-offset-key="16220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"search_krloccupymsadsc_core fail\n"</span></span></span></span><span data-slate-object="text" data-key="16221"><span data-slate-leaf="true" data-offset-key="16221:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16222"><span data-slate-object="text" data-key="16223"><span data-slate-leaf="true" data-offset-key="16223:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16224"><span data-slate-object="text" data-key="16225"><span data-slate-leaf="true" data-offset-key="16225:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16226"><span data-slate-leaf="true" data-offset-key="16226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16227"><span data-slate-leaf="true" data-offset-key="16227:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16228"><span data-slate-object="text" data-key="16229"><span data-slate-leaf="true" data-offset-key="16229:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16230"><span data-slate-object="text" data-key="16231"><span data-slate-leaf="true" data-offset-key="16231:0" data-first-offset="true"><span data-slate-string="true">这三个函数逻辑很简单，由 init_search_krloccupymm 函数入口，search_krloccupymsadsc_core 函数驱动，由 search_segment_occupymsadsc 函数完成实际的工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16232"><span data-slate-object="text" data-key="16233"><span data-slate-leaf="true" data-offset-key="16233:0" data-first-offset="true"><span data-slate-string="true">由于初始化阶段各种数据占用的开始、结束地址和大小，这些信息都保存在 machbstart_t 类型的 kmachbsp 变量中，所以函数与 machbstart_t 类型的指针为参数。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16234"><span data-slate-object="text" data-key="16235"><span data-slate-leaf="true" data-offset-key="16235:0" data-first-offset="true"><span data-slate-string="true">其实 phymmarge_t、msadsc_t、memarea_t 这些结构的实例变量和 MMU 页表，它们所占用的内存空间已经涵盖在了内核自身占用的内存空间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16236"><span data-slate-object="text" data-key="16237"><span data-slate-leaf="true" data-offset-key="16237:0" data-first-offset="true"><span data-slate-string="true">好了，这个问题我们已经完美解决，只要在初始化内存页结构和内存区结构之后调用 init_search_krloccupymm 函数即可。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="16238" id="sr-toc-5"><span data-slate-object="text" data-key="16239"><span data-slate-leaf="true" data-offset-key="16239:0" data-first-offset="true"><span data-slate-string="true">合并内存页到内存区</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="16240"><span data-slate-object="text" data-key="16241"><span data-slate-leaf="true" data-offset-key="16241:0" data-first-offset="true"><span data-slate-string="true">我们做了这么多前期工作，依然没有让内存页和内存区联系起来，即让 msadsc_t 结构挂载到内存区对应的数组中。只有这样，我们才能提高内存管理器的分配速度。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16242"><span data-slate-object="text" data-key="16243"><span data-slate-leaf="true" data-offset-key="16243:0" data-first-offset="true"><span data-slate-string="true">让我们来着手干这件事情，这件事情有点复杂，但是我给你梳理以后就会清晰很多。整体上可以分成两步。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16244"><span data-slate-object="text" data-key="16245"><span data-slate-leaf="true" data-offset-key="16245:0" data-first-offset="true"><span data-slate-string="true">1.</span></span></span><span data-slate-object="text" data-key="16246"><span data-slate-leaf="true" data-offset-key="16246:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 确定内存页属于哪个区</span></span></span></span><span data-slate-object="text" data-key="16247"><span data-slate-leaf="true" data-offset-key="16247:0" data-first-offset="true"><span data-slate-string="true">，即标定一系列 msadsc_t 结构是属于哪个 memarea_t 结构的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16248"><span data-slate-object="text" data-key="16249"><span data-slate-leaf="true" data-offset-key="16249:0" data-first-offset="true"><span data-slate-string="true">2.</span></span></span><span data-slate-object="text" data-key="16250"><span data-slate-leaf="true" data-offset-key="16250:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 把特定的内存页合并</span></span></span></span><span data-slate-object="text" data-key="16251"><span data-slate-leaf="true" data-offset-key="16251:0" data-first-offset="true"><span data-slate-string="true">，然后挂载到特定的内存区下的 memdivmer_t 结构中的 dm_mdmlielst 数组中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16252"><span data-slate-object="text" data-key="16253"><span data-slate-leaf="true" data-offset-key="16253:0" data-first-offset="true"><span data-slate-string="true">我们先来做第一件事，这件事比较简单，我们只要遍历每个 memarea_t 结构，遍历过程中根据特定的 memarea_t 结构，然后去扫描整个 msadsc_t 结构数组，最后依次对比 msadsc_t 的物理地址，看它是否落在 memarea_t 结构的地址区间中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16254"><span data-slate-object="text" data-key="16255"><span data-slate-leaf="true" data-offset-key="16255:0" data-first-offset="true"><span data-slate-string="true">如果是，就把这个 memarea_t 结构的类型值写入 msadsc_t 结构中，这样就一个一个打上了标签，遍历 memarea_t 结构结束之后，每个 msadsc_t 结构就只归属于某一个 memarea_t 结构了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16256"><span data-slate-object="text" data-key="16257"><span data-slate-leaf="true" data-offset-key="16257:0" data-first-offset="true"><span data-slate-string="true">我们在 memarea.c 文件中写几个函数，来实现前面这个步骤，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="16258"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16259"><span data-slate-object="text" data-key="16260"><span data-slate-leaf="true" data-offset-key="16260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 给 msadsc_t 结构打上标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16261"><span data-slate-object="text" data-key="16262"><span data-slate-leaf="true" data-offset-key="16262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span><span data-slate-object="text" data-key="16263"><span data-slate-leaf="true" data-offset-key="16263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16264"><span data-slate-leaf="true" data-offset-key="16264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_setallmarflgs_onmemarea</span></span></span></span></span><span data-slate-object="text" data-key="16265"><span data-slate-leaf="true" data-offset-key="16265:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16266"><span data-slate-leaf="true" data-offset-key="16266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16267"><span data-slate-leaf="true" data-offset-key="16267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16268"><span data-slate-leaf="true" data-offset-key="16268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16269"><span data-slate-leaf="true" data-offset-key="16269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mstat, </span></span></span></span></span><span data-slate-object="text" data-key="16270"><span data-slate-leaf="true" data-offset-key="16270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16271"><span data-slate-leaf="true" data-offset-key="16271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msanr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16272"><span data-slate-object="text" data-key="16273"><span data-slate-leaf="true" data-offset-key="16273:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16274"><span data-slate-object="text" data-key="16275"><span data-slate-leaf="true" data-offset-key="16275:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16276"><span data-slate-leaf="true" data-offset-key="16276:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u32_t</span></span></span></span><span data-slate-object="text" data-key="16277"><span data-slate-leaf="true" data-offset-key="16277:0" data-first-offset="true"><span data-slate-string="true"> muindx = </span></span></span><span data-slate-object="text" data-key="16278"><span data-slate-leaf="true" data-offset-key="16278:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16279"><span data-slate-leaf="true" data-offset-key="16279:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16280"><span data-slate-object="text" data-key="16281"><span data-slate-leaf="true" data-offset-key="16281:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16282"><span data-slate-leaf="true" data-offset-key="16282:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadflgs_t</span></span></span></span><span data-slate-object="text" data-key="16283"><span data-slate-leaf="true" data-offset-key="16283:0" data-first-offset="true"><span data-slate-string="true"> *mdfp = </span></span></span><span data-slate-object="text" data-key="16284"><span data-slate-leaf="true" data-offset-key="16284:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16285"><span data-slate-leaf="true" data-offset-key="16285:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16286"><span data-slate-object="text" data-key="16287"><span data-slate-leaf="true" data-offset-key="16287:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16288"><span data-slate-leaf="true" data-offset-key="16288:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取内存区类型</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16289"><span data-slate-object="text" data-key="16290"><span data-slate-leaf="true" data-offset-key="16290:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16291"><span data-slate-leaf="true" data-offset-key="16291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">switch</span></span></span></span><span data-slate-object="text" data-key="16292"><span data-slate-leaf="true" data-offset-key="16292:0" data-first-offset="true"><span data-slate-string="true"> (mareap-&gt;ma_type){</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16293"><span data-slate-object="text" data-key="16294"><span data-slate-leaf="true" data-offset-key="16294:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16295"><span data-slate-leaf="true" data-offset-key="16295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="16296"><span data-slate-leaf="true" data-offset-key="16296:0" data-first-offset="true"><span data-slate-string="true"> MA_TYPE_HWAD:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16297"><span data-slate-object="text" data-key="16298"><span data-slate-leaf="true" data-offset-key="16298:0" data-first-offset="true"><span data-slate-string="true">        muindx = MF_MARTY_HWD &lt;&lt; </span></span></span><span data-slate-object="text" data-key="16299"><span data-slate-leaf="true" data-offset-key="16299:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="16300"><span data-slate-leaf="true" data-offset-key="16300:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="16301"><span data-slate-leaf="true" data-offset-key="16301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 硬件区标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16302"><span data-slate-object="text" data-key="16303"><span data-slate-leaf="true" data-offset-key="16303:0" data-first-offset="true"><span data-slate-string="true">        mdfp = (</span></span></span><span data-slate-object="text" data-key="16304"><span data-slate-leaf="true" data-offset-key="16304:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadflgs_t</span></span></span></span><span data-slate-object="text" data-key="16305"><span data-slate-leaf="true" data-offset-key="16305:0" data-first-offset="true"><span data-slate-string="true"> *)(&amp;muindx);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16306"><span data-slate-object="text" data-key="16307"><span data-slate-leaf="true" data-offset-key="16307:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16308"><span data-slate-leaf="true" data-offset-key="16308:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span><span data-slate-object="text" data-key="16309"><span data-slate-leaf="true" data-offset-key="16309:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16310"><span data-slate-object="text" data-key="16311"><span data-slate-leaf="true" data-offset-key="16311:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16312"><span data-slate-leaf="true" data-offset-key="16312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="16313"><span data-slate-leaf="true" data-offset-key="16313:0" data-first-offset="true"><span data-slate-string="true"> MA_TYPE_KRNL:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16314"><span data-slate-object="text" data-key="16315"><span data-slate-leaf="true" data-offset-key="16315:0" data-first-offset="true"><span data-slate-string="true">        muindx = MF_MARTY_KRL &lt;&lt; </span></span></span><span data-slate-object="text" data-key="16316"><span data-slate-leaf="true" data-offset-key="16316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="16317"><span data-slate-leaf="true" data-offset-key="16317:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="16318"><span data-slate-leaf="true" data-offset-key="16318:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内核区标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16319"><span data-slate-object="text" data-key="16320"><span data-slate-leaf="true" data-offset-key="16320:0" data-first-offset="true"><span data-slate-string="true">        mdfp = (</span></span></span><span data-slate-object="text" data-key="16321"><span data-slate-leaf="true" data-offset-key="16321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadflgs_t</span></span></span></span><span data-slate-object="text" data-key="16322"><span data-slate-leaf="true" data-offset-key="16322:0" data-first-offset="true"><span data-slate-string="true"> *)(&amp;muindx);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16323"><span data-slate-object="text" data-key="16324"><span data-slate-leaf="true" data-offset-key="16324:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16325"><span data-slate-leaf="true" data-offset-key="16325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span><span data-slate-object="text" data-key="16326"><span data-slate-leaf="true" data-offset-key="16326:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16327"><span data-slate-object="text" data-key="16328"><span data-slate-leaf="true" data-offset-key="16328:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16329"><span data-slate-leaf="true" data-offset-key="16329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">case</span></span></span></span><span data-slate-object="text" data-key="16330"><span data-slate-leaf="true" data-offset-key="16330:0" data-first-offset="true"><span data-slate-string="true"> MA_TYPE_PROC:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16331"><span data-slate-object="text" data-key="16332"><span data-slate-leaf="true" data-offset-key="16332:0" data-first-offset="true"><span data-slate-string="true">        muindx = MF_MARTY_PRC &lt;&lt; </span></span></span><span data-slate-object="text" data-key="16333"><span data-slate-leaf="true" data-offset-key="16333:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">5</span></span></span></span><span data-slate-object="text" data-key="16334"><span data-slate-leaf="true" data-offset-key="16334:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="16335"><span data-slate-leaf="true" data-offset-key="16335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 应用区标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16336"><span data-slate-object="text" data-key="16337"><span data-slate-leaf="true" data-offset-key="16337:0" data-first-offset="true"><span data-slate-string="true">        mdfp = (</span></span></span><span data-slate-object="text" data-key="16338"><span data-slate-leaf="true" data-offset-key="16338:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadflgs_t</span></span></span></span><span data-slate-object="text" data-key="16339"><span data-slate-leaf="true" data-offset-key="16339:0" data-first-offset="true"><span data-slate-string="true"> *)(&amp;muindx);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16340"><span data-slate-object="text" data-key="16341"><span data-slate-leaf="true" data-offset-key="16341:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16342"><span data-slate-leaf="true" data-offset-key="16342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span><span data-slate-object="text" data-key="16343"><span data-slate-leaf="true" data-offset-key="16343:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16344"><span data-slate-object="text" data-key="16345"><span data-slate-leaf="true" data-offset-key="16345:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16346"><span data-slate-object="text" data-key="16347"><span data-slate-leaf="true" data-offset-key="16347:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16348"><span data-slate-leaf="true" data-offset-key="16348:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u64_t</span></span></span></span><span data-slate-object="text" data-key="16349"><span data-slate-leaf="true" data-offset-key="16349:0" data-first-offset="true"><span data-slate-string="true"> phyadr = </span></span></span><span data-slate-object="text" data-key="16350"><span data-slate-leaf="true" data-offset-key="16350:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16351"><span data-slate-leaf="true" data-offset-key="16351:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16352"><span data-slate-object="text" data-key="16353"><span data-slate-leaf="true" data-offset-key="16353:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16354"><span data-slate-leaf="true" data-offset-key="16354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16355"><span data-slate-leaf="true" data-offset-key="16355:0" data-first-offset="true"><span data-slate-string="true"> retnr = </span></span></span><span data-slate-object="text" data-key="16356"><span data-slate-leaf="true" data-offset-key="16356:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16357"><span data-slate-leaf="true" data-offset-key="16357:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16358"><span data-slate-object="text" data-key="16359"><span data-slate-leaf="true" data-offset-key="16359:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16360"><span data-slate-leaf="true" data-offset-key="16360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 扫描所有的 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16361"><span data-slate-object="text" data-key="16362"><span data-slate-leaf="true" data-offset-key="16362:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16363"><span data-slate-leaf="true" data-offset-key="16363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16364"><span data-slate-leaf="true" data-offset-key="16364:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16365"><span data-slate-leaf="true" data-offset-key="16365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16366"><span data-slate-leaf="true" data-offset-key="16366:0" data-first-offset="true"><span data-slate-string="true"> mix = </span></span></span><span data-slate-object="text" data-key="16367"><span data-slate-leaf="true" data-offset-key="16367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16368"><span data-slate-leaf="true" data-offset-key="16368:0" data-first-offset="true"><span data-slate-string="true">; mix &lt;msanr; mix++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16369"><span data-slate-object="text" data-key="16370"><span data-slate-leaf="true" data-offset-key="16370:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16371"><span data-slate-object="text" data-key="16372"><span data-slate-leaf="true" data-offset-key="16372:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16373"><span data-slate-leaf="true" data-offset-key="16373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16374"><span data-slate-leaf="true" data-offset-key="16374:0" data-first-offset="true"><span data-slate-string="true"> (MF_MARTY_INIT == mstat[mix].md_indxflgs.mf_marty)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16375"><span data-slate-object="text" data-key="16376"><span data-slate-leaf="true" data-offset-key="16376:0" data-first-offset="true"><span data-slate-string="true">        {    </span></span></span><span data-slate-object="text" data-key="16377"><span data-slate-leaf="true" data-offset-key="16377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 msadsc_t 结构对应的地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16378"><span data-slate-object="text" data-key="16379"><span data-slate-leaf="true" data-offset-key="16379:0" data-first-offset="true"><span data-slate-string="true">            phyadr = mstat[mix].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16380"><span data-slate-object="text" data-key="16381"><span data-slate-leaf="true" data-offset-key="16381:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16382"><span data-slate-leaf="true" data-offset-key="16382:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 和内存区的地址区间比较 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16383"><span data-slate-object="text" data-key="16384"><span data-slate-leaf="true" data-offset-key="16384:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16385"><span data-slate-leaf="true" data-offset-key="16385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16386"><span data-slate-leaf="true" data-offset-key="16386:0" data-first-offset="true"><span data-slate-string="true"> (phyadr&gt;= mareap-&gt;ma_logicstart &amp;&amp; ((phyadr + PAGESIZE) - </span></span></span><span data-slate-object="text" data-key="16387"><span data-slate-leaf="true" data-offset-key="16387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16388"><span data-slate-leaf="true" data-offset-key="16388:0" data-first-offset="true"><span data-slate-string="true">) &lt;= mareap-&gt;ma_logicend)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16389"><span data-slate-object="text" data-key="16390"><span data-slate-leaf="true" data-offset-key="16390:0" data-first-offset="true"><span data-slate-string="true">            {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16391"><span data-slate-object="text" data-key="16392"><span data-slate-leaf="true" data-offset-key="16392:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="16393"><span data-slate-leaf="true" data-offset-key="16393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 设置 msadsc_t 结构的标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16394"><span data-slate-object="text" data-key="16395"><span data-slate-leaf="true" data-offset-key="16395:0" data-first-offset="true"><span data-slate-string="true">                mstat[mix].md_indxflgs.mf_marty = mdfp-&gt;mf_marty;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16396"><span data-slate-object="text" data-key="16397"><span data-slate-leaf="true" data-offset-key="16397:0" data-first-offset="true"><span data-slate-string="true">                retnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16398"><span data-slate-object="text" data-key="16399"><span data-slate-leaf="true" data-offset-key="16399:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16400"><span data-slate-object="text" data-key="16401"><span data-slate-leaf="true" data-offset-key="16401:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16402"><span data-slate-object="text" data-key="16403"><span data-slate-leaf="true" data-offset-key="16403:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16404"><span data-slate-object="text" data-key="16405"><span data-slate-leaf="true" data-offset-key="16405:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16406"><span data-slate-leaf="true" data-offset-key="16406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16407"><span data-slate-leaf="true" data-offset-key="16407:0" data-first-offset="true"><span data-slate-string="true"> retnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16408"><span data-slate-object="text" data-key="16409"><span data-slate-leaf="true" data-offset-key="16409:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16410"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16411"><span data-slate-object="text" data-key="16412"><span data-slate-leaf="true" data-offset-key="16412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16413"><span data-slate-leaf="true" data-offset-key="16413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16414"><span data-slate-leaf="true" data-offset-key="16414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_mem_core</span></span></span></span></span><span data-slate-object="text" data-key="16415"><span data-slate-leaf="true" data-offset-key="16415:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16416"><span data-slate-leaf="true" data-offset-key="16416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">machbstart_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16417"><span data-slate-leaf="true" data-offset-key="16417:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mbsp)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16418"><span data-slate-object="text" data-key="16419"><span data-slate-leaf="true" data-offset-key="16419:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16420"><span data-slate-object="text" data-key="16421"><span data-slate-leaf="true" data-offset-key="16421:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16422"><span data-slate-leaf="true" data-offset-key="16422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 msadsc_t 结构的首地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16423"><span data-slate-object="text" data-key="16424"><span data-slate-leaf="true" data-offset-key="16424:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16425"><span data-slate-leaf="true" data-offset-key="16425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16426"><span data-slate-leaf="true" data-offset-key="16426:0" data-first-offset="true"><span data-slate-string="true"> *mstatp = (</span></span></span><span data-slate-object="text" data-key="16427"><span data-slate-leaf="true" data-offset-key="16427:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16428"><span data-slate-leaf="true" data-offset-key="16428:0" data-first-offset="true"><span data-slate-string="true"> *)</span></span></span><span data-slate-object="text" data-key="16429"><span data-slate-leaf="true" data-offset-key="16429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="16430"><span data-slate-leaf="true" data-offset-key="16430:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="16431"><span data-slate-leaf="true" data-offset-key="16431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="16432"><span data-slate-leaf="true" data-offset-key="16432:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memmappadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16433"><span data-slate-object="text" data-key="16434"><span data-slate-leaf="true" data-offset-key="16434:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16435"><span data-slate-leaf="true" data-offset-key="16435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 msadsc_t 结构的个数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16436"><span data-slate-object="text" data-key="16437"><span data-slate-leaf="true" data-offset-key="16437:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16438"><span data-slate-leaf="true" data-offset-key="16438:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16439"><span data-slate-leaf="true" data-offset-key="16439:0" data-first-offset="true"><span data-slate-string="true"> msanr = (</span></span></span><span data-slate-object="text" data-key="16440"><span data-slate-leaf="true" data-offset-key="16440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16441"><span data-slate-leaf="true" data-offset-key="16441:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memmapnr, maxp = </span></span></span><span data-slate-object="text" data-key="16442"><span data-slate-leaf="true" data-offset-key="16442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16443"><span data-slate-leaf="true" data-offset-key="16443:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16444"><span data-slate-object="text" data-key="16445"><span data-slate-leaf="true" data-offset-key="16445:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16446"><span data-slate-leaf="true" data-offset-key="16446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 memarea_t 结构的首地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16447"><span data-slate-object="text" data-key="16448"><span data-slate-leaf="true" data-offset-key="16448:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16449"><span data-slate-leaf="true" data-offset-key="16449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span><span data-slate-object="text" data-key="16450"><span data-slate-leaf="true" data-offset-key="16450:0" data-first-offset="true"><span data-slate-string="true"> *marea = (</span></span></span><span data-slate-object="text" data-key="16451"><span data-slate-leaf="true" data-offset-key="16451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span><span data-slate-object="text" data-key="16452"><span data-slate-leaf="true" data-offset-key="16452:0" data-first-offset="true"><span data-slate-string="true"> *)</span></span></span><span data-slate-object="text" data-key="16453"><span data-slate-leaf="true" data-offset-key="16453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="16454"><span data-slate-leaf="true" data-offset-key="16454:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="16455"><span data-slate-leaf="true" data-offset-key="16455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">adr_t</span></span></span></span><span data-slate-object="text" data-key="16456"><span data-slate-leaf="true" data-offset-key="16456:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memznpadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16457"><span data-slate-object="text" data-key="16458"><span data-slate-leaf="true" data-offset-key="16458:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16459"><span data-slate-leaf="true" data-offset-key="16459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16460"><span data-slate-leaf="true" data-offset-key="16460:0" data-first-offset="true"><span data-slate-string="true"> sretf = ~</span></span></span><span data-slate-object="text" data-key="16461"><span data-slate-leaf="true" data-offset-key="16461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0UL</span></span></span></span><span data-slate-object="text" data-key="16462"><span data-slate-leaf="true" data-offset-key="16462:0" data-first-offset="true"><span data-slate-string="true">, tretf = ~</span></span></span><span data-slate-object="text" data-key="16463"><span data-slate-leaf="true" data-offset-key="16463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0UL</span></span></span></span><span data-slate-object="text" data-key="16464"><span data-slate-leaf="true" data-offset-key="16464:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16465"><span data-slate-object="text" data-key="16466"><span data-slate-leaf="true" data-offset-key="16466:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16467"><span data-slate-leaf="true" data-offset-key="16467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历每个 memarea_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16468"><span data-slate-object="text" data-key="16469"><span data-slate-leaf="true" data-offset-key="16469:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16470"><span data-slate-leaf="true" data-offset-key="16470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16471"><span data-slate-leaf="true" data-offset-key="16471:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16472"><span data-slate-leaf="true" data-offset-key="16472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16473"><span data-slate-leaf="true" data-offset-key="16473:0" data-first-offset="true"><span data-slate-string="true"> mi = </span></span></span><span data-slate-object="text" data-key="16474"><span data-slate-leaf="true" data-offset-key="16474:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16475"><span data-slate-leaf="true" data-offset-key="16475:0" data-first-offset="true"><span data-slate-string="true">; mi &lt; (</span></span></span><span data-slate-object="text" data-key="16476"><span data-slate-leaf="true" data-offset-key="16476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16477"><span data-slate-leaf="true" data-offset-key="16477:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memznnr; mi++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16478"><span data-slate-object="text" data-key="16479"><span data-slate-leaf="true" data-offset-key="16479:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16480"><span data-slate-object="text" data-key="16481"><span data-slate-leaf="true" data-offset-key="16481:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16482"><span data-slate-leaf="true" data-offset-key="16482:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 针对其中一个 memarea_t 结构给 msadsc_t 结构打上标签</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16483"><span data-slate-object="text" data-key="16484"><span data-slate-leaf="true" data-offset-key="16484:0" data-first-offset="true"><span data-slate-string="true">        sretf = </span></span></span><span data-slate-object="text" data-key="16485"><span data-slate-leaf="true" data-offset-key="16485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_setallmarflgs_onmemarea</span></span></span></span><span data-slate-object="text" data-key="16486"><span data-slate-leaf="true" data-offset-key="16486:0" data-first-offset="true"><span data-slate-string="true">(&amp;marea[mi], mstatp, msanr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16487"><span data-slate-object="text" data-key="16488"><span data-slate-leaf="true" data-offset-key="16488:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16489"><span data-slate-leaf="true" data-offset-key="16489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16490"><span data-slate-leaf="true" data-offset-key="16490:0" data-first-offset="true"><span data-slate-string="true"> ((~</span></span></span><span data-slate-object="text" data-key="16491"><span data-slate-leaf="true" data-offset-key="16491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0UL</span></span></span></span><span data-slate-object="text" data-key="16492"><span data-slate-leaf="true" data-offset-key="16492:0" data-first-offset="true"><span data-slate-string="true">) == sretf)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16493"><span data-slate-object="text" data-key="16494"><span data-slate-leaf="true" data-offset-key="16494:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16495"><span data-slate-object="text" data-key="16496"><span data-slate-leaf="true" data-offset-key="16496:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16497"><span data-slate-leaf="true" data-offset-key="16497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16498"><span data-slate-leaf="true" data-offset-key="16498:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16499"><span data-slate-object="text" data-key="16500"><span data-slate-leaf="true" data-offset-key="16500:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16501"><span data-slate-object="text" data-key="16502"><span data-slate-leaf="true" data-offset-key="16502:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16503"><span data-slate-object="text" data-key="16504"><span data-slate-leaf="true" data-offset-key="16504:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span><span data-slate-object="text" data-key="16505"><span data-slate-leaf="true" data-offset-key="16505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 遍历每个 memarea_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16506"><span data-slate-object="text" data-key="16507"><span data-slate-leaf="true" data-offset-key="16507:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16508"><span data-slate-leaf="true" data-offset-key="16508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16509"><span data-slate-leaf="true" data-offset-key="16509:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16510"><span data-slate-leaf="true" data-offset-key="16510:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16511"><span data-slate-leaf="true" data-offset-key="16511:0" data-first-offset="true"><span data-slate-string="true"> maidx = </span></span></span><span data-slate-object="text" data-key="16512"><span data-slate-leaf="true" data-offset-key="16512:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16513"><span data-slate-leaf="true" data-offset-key="16513:0" data-first-offset="true"><span data-slate-string="true">; maidx &lt; (</span></span></span><span data-slate-object="text" data-key="16514"><span data-slate-leaf="true" data-offset-key="16514:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16515"><span data-slate-leaf="true" data-offset-key="16515:0" data-first-offset="true"><span data-slate-string="true">)mbsp-&gt;mb_memznnr; maidx++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16516"><span data-slate-object="text" data-key="16517"><span data-slate-leaf="true" data-offset-key="16517:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16518"><span data-slate-object="text" data-key="16519"><span data-slate-leaf="true" data-offset-key="16519:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16520"><span data-slate-leaf="true" data-offset-key="16520:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 针对其中一个 memarea_t 结构对 msadsc_t 结构进行合并</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16521"><span data-slate-object="text" data-key="16522"><span data-slate-leaf="true" data-offset-key="16522:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16523"><span data-slate-leaf="true" data-offset-key="16523:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16524"><span data-slate-leaf="true" data-offset-key="16524:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16525"><span data-slate-leaf="true" data-offset-key="16525:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_mem_onmemarea</span></span></span></span><span data-slate-object="text" data-key="16526"><span data-slate-leaf="true" data-offset-key="16526:0" data-first-offset="true"><span data-slate-string="true">(&amp;marea[maidx], mstatp, msanr) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16527"><span data-slate-object="text" data-key="16528"><span data-slate-leaf="true" data-offset-key="16528:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16529"><span data-slate-object="text" data-key="16530"><span data-slate-leaf="true" data-offset-key="16530:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16531"><span data-slate-leaf="true" data-offset-key="16531:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16532"><span data-slate-leaf="true" data-offset-key="16532:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16533"><span data-slate-object="text" data-key="16534"><span data-slate-leaf="true" data-offset-key="16534:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16535"><span data-slate-object="text" data-key="16536"><span data-slate-leaf="true" data-offset-key="16536:0" data-first-offset="true"><span data-slate-string="true">        maxp += marea[maidx].ma_maxpages;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16537"><span data-slate-object="text" data-key="16538"><span data-slate-leaf="true" data-offset-key="16538:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16539"><span data-slate-object="text" data-key="16540"><span data-slate-leaf="true" data-offset-key="16540:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16541"><span data-slate-leaf="true" data-offset-key="16541:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16542"><span data-slate-leaf="true" data-offset-key="16542:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16543"><span data-slate-object="text" data-key="16544"><span data-slate-leaf="true" data-offset-key="16544:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16545"><span data-slate-object="text" data-key="16546"><span data-slate-leaf="true" data-offset-key="16546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化页面合并</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16547"><span data-slate-object="text" data-key="16548"><span data-slate-leaf="true" data-offset-key="16548:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span></span><span data-slate-object="text" data-key="16549"><span data-slate-leaf="true" data-offset-key="16549:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16550"><span data-slate-leaf="true" data-offset-key="16550:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_merlove_mem</span></span></span></span></span><span data-slate-object="text" data-key="16551"><span data-slate-leaf="true" data-offset-key="16551:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16552"><span data-slate-object="text" data-key="16553"><span data-slate-leaf="true" data-offset-key="16553:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16554"><span data-slate-object="text" data-key="16555"><span data-slate-leaf="true" data-offset-key="16555:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16556"><span data-slate-leaf="true" data-offset-key="16556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16557"><span data-slate-leaf="true" data-offset-key="16557:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16558"><span data-slate-leaf="true" data-offset-key="16558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_mem_core</span></span></span></span><span data-slate-object="text" data-key="16559"><span data-slate-leaf="true" data-offset-key="16559:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmachbsp) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16560"><span data-slate-object="text" data-key="16561"><span data-slate-leaf="true" data-offset-key="16561:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16562"><span data-slate-object="text" data-key="16563"><span data-slate-leaf="true" data-offset-key="16563:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16564"><span data-slate-leaf="true" data-offset-key="16564:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">system_error</span></span></span></span><span data-slate-object="text" data-key="16565"><span data-slate-leaf="true" data-offset-key="16565:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="16566"><span data-slate-leaf="true" data-offset-key="16566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"merlove_mem_core fail\n"</span></span></span></span><span data-slate-object="text" data-key="16567"><span data-slate-leaf="true" data-offset-key="16567:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16568"><span data-slate-object="text" data-key="16569"><span data-slate-leaf="true" data-offset-key="16569:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16570"><span data-slate-object="text" data-key="16571"><span data-slate-leaf="true" data-offset-key="16571:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16572"><span data-slate-leaf="true" data-offset-key="16572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16573"><span data-slate-leaf="true" data-offset-key="16573:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16574"><span data-slate-object="text" data-key="16575"><span data-slate-leaf="true" data-offset-key="16575:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16576"><span data-slate-object="text" data-key="16577"><span data-slate-leaf="true" data-offset-key="16577:0" data-first-offset="true"><span data-slate-string="true">我们一下子写了三个函数，它们的作用且听我一一道来。从 init_merlove_mem 函数开始，但是它并不实际干活，作为入口函数，它调用的 merlove_mem_core 函数才是真正干活的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16578"><span data-slate-object="text" data-key="16579"><span data-slate-leaf="true" data-offset-key="16579:0" data-first-offset="true"><span data-slate-string="true">这个 merlove_mem_core 函数有两个遍历内存区，第一次遍历是为了完成上述第一步：确定内存页属于哪个区。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16580"><span data-slate-object="text" data-key="16581"><span data-slate-leaf="true" data-offset-key="16581:0" data-first-offset="true"><span data-slate-string="true">当确定内存页属于哪个区之后，就来到了第二次遍历 memarea_t 结构，合并其中的 msadsc_t 结构，并把它们挂载到其中的 memdivmer_t 结构下的 dm_mdmlielst 数组中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16582"><span data-slate-object="text" data-key="16583"><span data-slate-leaf="true" data-offset-key="16583:0" data-first-offset="true"><span data-slate-string="true">这个操作就稍微有点复杂了。</span></span></span><span data-slate-object="text" data-key="16584"><span data-slate-leaf="true" data-offset-key="16584:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一，它要保证其中所有的 msadsc_t 结构挂载到 dm_mdmlielst 数组中合适的 bafhlst_t 结构中。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16585"><span data-slate-object="text" data-key="16586"><span data-slate-leaf="true" data-offset-key="16586:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二，它要保证多个 msadsc_t 结构有最大的连续性。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16587"><span data-slate-object="text" data-key="16588"><span data-slate-leaf="true" data-offset-key="16588:0" data-first-offset="true"><span data-slate-string="true">举个例子，比如一个内存区中有 12 个页面，其中 10 个页面是连续的地址为 0～0x9000，还有两个页面其中一个地址为 0xb000，另一个地址为 0xe000。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16589"><span data-slate-object="text" data-key="16590"><span data-slate-leaf="true" data-offset-key="16590:0" data-first-offset="true"><span data-slate-string="true">这样的情况下，需要多个页面保持最大的连续性，还有在 m_mdmlielst 数组中找到合适的 bafhlst_t 结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16591"><span data-slate-object="text" data-key="16592"><span data-slate-leaf="true" data-offset-key="16592:0" data-first-offset="true"><span data-slate-string="true">那么：0～0x7000 这 8 个页面就要挂载到 m_mdmlielst 数组中第 3 个 bafhlst_t 结构中；0x8000～0x9000 这 2 个页面要挂载到 m_mdmlielst 数组中第 1 个 bafhlst_t 结构中，而 0xb000 和 0xe000 这 2 个页面都要挂载到 m_mdmlielst 数组中第 0 个 bafhlst_t 结构中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="16593"><span data-slate-object="text" data-key="16594"><span data-slate-leaf="true" data-offset-key="16594:0" data-first-offset="true"><span data-slate-string="true">从上述代码可以看出，遍历每个内存区，然后针对其中每一个内存区进行 msadsc_t 结构的合并操作，完成这个操作的是 </span></span></span><span data-slate-object="text" data-key="16595"><span data-slate-leaf="true" data-offset-key="16595:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">merlove_mem_onmemarea</span></span></span></span><span data-slate-object="text" data-key="16596"><span data-slate-leaf="true" data-offset-key="16596:0" data-first-offset="true"><span data-slate-string="true">，我们这就去写好这个函数，代码如下所示。</span></span></span></div><div data-code-language="cpp" data-slate-type="pre" data-slate-object="block" data-key="16597"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div><div data-code-line-number="74"></div><div data-code-line-number="75"></div><div data-code-line-number="76"></div><div data-code-line-number="77"></div><div data-code-line-number="78"></div><div data-code-line-number="79"></div><div data-code-line-number="80"></div><div data-code-line-number="81"></div><div data-code-line-number="82"></div><div data-code-line-number="83"></div><div data-code-line-number="84"></div><div data-code-line-number="85"></div><div data-code-line-number="86"></div><div data-code-line-number="87"></div><div data-code-line-number="88"></div><div data-code-line-number="89"></div><div data-code-line-number="90"></div><div data-code-line-number="91"></div><div data-code-line-number="92"></div><div data-code-line-number="93"></div><div data-code-line-number="94"></div><div data-code-line-number="95"></div><div data-code-line-number="96"></div><div data-code-line-number="97"></div><div data-code-line-number="98"></div><div data-code-line-number="99"></div><div data-code-line-number="100"></div><div data-code-line-number="101"></div><div data-code-line-number="102"></div><div data-code-line-number="103"></div><div data-code-line-number="104"></div><div data-code-line-number="105"></div><div data-code-line-number="106"></div><div data-code-line-number="107"></div><div data-code-line-number="108"></div><div data-code-line-number="109"></div><div data-code-line-number="110"></div><div data-code-line-number="111"></div><div data-code-line-number="112"></div><div data-code-line-number="113"></div><div data-code-line-number="114"></div><div data-code-line-number="115"></div><div data-code-line-number="116"></div><div data-code-line-number="117"></div><div data-code-line-number="118"></div><div data-code-line-number="119"></div><div data-code-line-number="120"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="16598"><span data-slate-object="text" data-key="16599"><span data-slate-leaf="true" data-offset-key="16599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16600"><span data-slate-leaf="true" data-offset-key="16600:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16601"><span data-slate-leaf="true" data-offset-key="16601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continumsadsc_add_bafhlst</span></span></span></span></span><span data-slate-object="text" data-key="16602"><span data-slate-leaf="true" data-offset-key="16602:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16603"><span data-slate-leaf="true" data-offset-key="16603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16604"><span data-slate-leaf="true" data-offset-key="16604:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16605"><span data-slate-leaf="true" data-offset-key="16605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bafhlst_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16606"><span data-slate-leaf="true" data-offset-key="16606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *bafhp, </span></span></span></span></span><span data-slate-object="text" data-key="16607"><span data-slate-leaf="true" data-offset-key="16607:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16608"><span data-slate-leaf="true" data-offset-key="16608:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fstat, </span></span></span></span></span><span data-slate-object="text" data-key="16609"><span data-slate-leaf="true" data-offset-key="16609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16610"><span data-slate-leaf="true" data-offset-key="16610:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fend, </span></span></span></span></span><span data-slate-object="text" data-key="16611"><span data-slate-leaf="true" data-offset-key="16611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16612"><span data-slate-leaf="true" data-offset-key="16612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fmnr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16613"><span data-slate-object="text" data-key="16614"><span data-slate-leaf="true" data-offset-key="16614:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16615"><span data-slate-object="text" data-key="16616"><span data-slate-leaf="true" data-offset-key="16616:0" data-first-offset="true"><span data-slate-string="true">    fstat-&gt;md_indxflgs.mf_olkty = MF_OLKTY_ODER;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16617"><span data-slate-object="text" data-key="16618"><span data-slate-leaf="true" data-offset-key="16618:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16619"><span data-slate-leaf="true" data-offset-key="16619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 开始的 msadsc_t 结构指向最后的 msadsc_t 结构 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16620"><span data-slate-object="text" data-key="16621"><span data-slate-leaf="true" data-offset-key="16621:0" data-first-offset="true"><span data-slate-string="true">    fstat-&gt;md_odlink = fend;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16622"><span data-slate-object="text" data-key="16623"><span data-slate-leaf="true" data-offset-key="16623:0" data-first-offset="true"><span data-slate-string="true">    fend-&gt;md_indxflgs.mf_olkty = MF_OLKTY_BAFH;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16624"><span data-slate-object="text" data-key="16625"><span data-slate-leaf="true" data-offset-key="16625:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16626"><span data-slate-leaf="true" data-offset-key="16626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 最后的 msadsc_t 结构指向它属于的 bafhlst_t 结构 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16627"><span data-slate-object="text" data-key="16628"><span data-slate-leaf="true" data-offset-key="16628:0" data-first-offset="true"><span data-slate-string="true">    fend-&gt;md_odlink = bafhp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16629"><span data-slate-object="text" data-key="16630"><span data-slate-leaf="true" data-offset-key="16630:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16631"><span data-slate-leaf="true" data-offset-key="16631:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把多个地址连续的 msadsc_t 结构的的开始的那个 msadsc_t 结构挂载到 bafhlst_t 结构的 af_frelst 中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16632"><span data-slate-object="text" data-key="16633"><span data-slate-leaf="true" data-offset-key="16633:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16634"><span data-slate-leaf="true" data-offset-key="16634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_add</span></span></span></span><span data-slate-object="text" data-key="16635"><span data-slate-leaf="true" data-offset-key="16635:0" data-first-offset="true"><span data-slate-string="true">(&amp;fstat-&gt;md_list, &amp;bafhp-&gt;af_frelst);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16636"><span data-slate-object="text" data-key="16637"><span data-slate-leaf="true" data-offset-key="16637:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16638"><span data-slate-leaf="true" data-offset-key="16638:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 更新 bafhlst_t 的统计数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16639"><span data-slate-object="text" data-key="16640"><span data-slate-leaf="true" data-offset-key="16640:0" data-first-offset="true"><span data-slate-string="true">    bafhp-&gt;af_fobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16641"><span data-slate-object="text" data-key="16642"><span data-slate-leaf="true" data-offset-key="16642:0" data-first-offset="true"><span data-slate-string="true">    bafhp-&gt;af_mobjnr++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16643"><span data-slate-object="text" data-key="16644"><span data-slate-leaf="true" data-offset-key="16644:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16645"><span data-slate-leaf="true" data-offset-key="16645:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 更新内存区的统计数据</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16646"><span data-slate-object="text" data-key="16647"><span data-slate-leaf="true" data-offset-key="16647:0" data-first-offset="true"><span data-slate-string="true">    mareap-&gt;ma_maxpages += fmnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16648"><span data-slate-object="text" data-key="16649"><span data-slate-leaf="true" data-offset-key="16649:0" data-first-offset="true"><span data-slate-string="true">    mareap-&gt;ma_freepages += fmnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16650"><span data-slate-object="text" data-key="16651"><span data-slate-leaf="true" data-offset-key="16651:0" data-first-offset="true"><span data-slate-string="true">    mareap-&gt;ma_allmsadscnr += fmnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16652"><span data-slate-object="text" data-key="16653"><span data-slate-leaf="true" data-offset-key="16653:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16654"><span data-slate-leaf="true" data-offset-key="16654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16655"><span data-slate-leaf="true" data-offset-key="16655:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16656"><span data-slate-object="text" data-key="16657"><span data-slate-leaf="true" data-offset-key="16657:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16658"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16659"><span data-slate-object="text" data-key="16660"><span data-slate-leaf="true" data-offset-key="16660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16661"><span data-slate-leaf="true" data-offset-key="16661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16662"><span data-slate-leaf="true" data-offset-key="16662:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continumsadsc_mareabafh_core</span></span></span></span></span><span data-slate-object="text" data-key="16663"><span data-slate-leaf="true" data-offset-key="16663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16664"><span data-slate-leaf="true" data-offset-key="16664:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16665"><span data-slate-leaf="true" data-offset-key="16665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16666"><span data-slate-leaf="true" data-offset-key="16666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16667"><span data-slate-leaf="true" data-offset-key="16667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> **rfstat, </span></span></span></span></span><span data-slate-object="text" data-key="16668"><span data-slate-leaf="true" data-offset-key="16668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16669"><span data-slate-leaf="true" data-offset-key="16669:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> **rfend, </span></span></span></span></span><span data-slate-object="text" data-key="16670"><span data-slate-leaf="true" data-offset-key="16670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16671"><span data-slate-leaf="true" data-offset-key="16671:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *rfmnr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16672"><span data-slate-object="text" data-key="16673"><span data-slate-leaf="true" data-offset-key="16673:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16674"><span data-slate-object="text" data-key="16675"><span data-slate-leaf="true" data-offset-key="16675:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16676"><span data-slate-leaf="true" data-offset-key="16676:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16677"><span data-slate-leaf="true" data-offset-key="16677:0" data-first-offset="true"><span data-slate-string="true"> retval = *rfmnr, tmpmnr = </span></span></span><span data-slate-object="text" data-key="16678"><span data-slate-leaf="true" data-offset-key="16678:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16679"><span data-slate-leaf="true" data-offset-key="16679:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16680"><span data-slate-object="text" data-key="16681"><span data-slate-leaf="true" data-offset-key="16681:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16682"><span data-slate-leaf="true" data-offset-key="16682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16683"><span data-slate-leaf="true" data-offset-key="16683:0" data-first-offset="true"><span data-slate-string="true"> *mstat = *rfstat, *mend = *rfend;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16684"><span data-slate-object="text" data-key="16685"><span data-slate-leaf="true" data-offset-key="16685:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16686"><span data-slate-leaf="true" data-offset-key="16686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 根据地址连续的 msadsc_t 结构的数量查找合适 bafhlst_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16687"><span data-slate-object="text" data-key="16688"><span data-slate-leaf="true" data-offset-key="16688:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16689"><span data-slate-leaf="true" data-offset-key="16689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bafhlst_t</span></span></span></span><span data-slate-object="text" data-key="16690"><span data-slate-leaf="true" data-offset-key="16690:0" data-first-offset="true"><span data-slate-string="true"> *bafhp = </span></span></span><span data-slate-object="text" data-key="16691"><span data-slate-leaf="true" data-offset-key="16691:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">find_continumsa_inbafhlst</span></span></span></span><span data-slate-object="text" data-key="16692"><span data-slate-leaf="true" data-offset-key="16692:0" data-first-offset="true"><span data-slate-string="true">(mareap, retval);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16693"><span data-slate-object="text" data-key="16694"><span data-slate-leaf="true" data-offset-key="16694:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16695"><span data-slate-leaf="true" data-offset-key="16695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 判断 bafhlst_t 结构状态和类型对不对</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16696"><span data-slate-object="text" data-key="16697"><span data-slate-leaf="true" data-offset-key="16697:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16698"><span data-slate-leaf="true" data-offset-key="16698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16699"><span data-slate-leaf="true" data-offset-key="16699:0" data-first-offset="true"><span data-slate-string="true"> ((BAFH_STUS_DIVP == bafhp-&gt;af_stus || BAFH_STUS_DIVM == bafhp-&gt;af_stus) &amp;&amp; MA_TYPE_PROC != mareap-&gt;ma_type)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16700"><span data-slate-object="text" data-key="16701"><span data-slate-leaf="true" data-offset-key="16701:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16702"><span data-slate-object="text" data-key="16703"><span data-slate-leaf="true" data-offset-key="16703:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16704"><span data-slate-leaf="true" data-offset-key="16704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 看地址连续的 msadsc_t 结构的数量是不是正好是 bafhp-&gt;af_oderpnr</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16705"><span data-slate-object="text" data-key="16706"><span data-slate-leaf="true" data-offset-key="16706:0" data-first-offset="true"><span data-slate-string="true">        tmpmnr = retval - bafhp-&gt;af_oderpnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16707"><span data-slate-object="text" data-key="16708"><span data-slate-leaf="true" data-offset-key="16708:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16709"><span data-slate-leaf="true" data-offset-key="16709:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 根据地址连续的 msadsc_t 结构挂载到 bafhlst_t 结构中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16710"><span data-slate-object="text" data-key="16711"><span data-slate-leaf="true" data-offset-key="16711:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16712"><span data-slate-leaf="true" data-offset-key="16712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16713"><span data-slate-leaf="true" data-offset-key="16713:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="16714"><span data-slate-leaf="true" data-offset-key="16714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continumsadsc_add_bafhlst</span></span></span></span><span data-slate-object="text" data-key="16715"><span data-slate-leaf="true" data-offset-key="16715:0" data-first-offset="true"><span data-slate-string="true">(mareap, bafhp, mstat, &amp;mstat[bafhp-&gt;af_oderpnr - </span></span></span><span data-slate-object="text" data-key="16716"><span data-slate-leaf="true" data-offset-key="16716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16717"><span data-slate-leaf="true" data-offset-key="16717:0" data-first-offset="true"><span data-slate-string="true">], bafhp-&gt;af_oderpnr) == FALSE)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16718"><span data-slate-object="text" data-key="16719"><span data-slate-leaf="true" data-offset-key="16719:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16720"><span data-slate-object="text" data-key="16721"><span data-slate-leaf="true" data-offset-key="16721:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16722"><span data-slate-leaf="true" data-offset-key="16722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16723"><span data-slate-leaf="true" data-offset-key="16723:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16724"><span data-slate-object="text" data-key="16725"><span data-slate-leaf="true" data-offset-key="16725:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16726"><span data-slate-object="text" data-key="16727"><span data-slate-leaf="true" data-offset-key="16727:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16728"><span data-slate-leaf="true" data-offset-key="16728:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果地址连续的 msadsc_t 结构的数量正好是 bafhp-&gt;af_oderpnr 则完成，否则返回再次进入此函数 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16729"><span data-slate-object="text" data-key="16730"><span data-slate-leaf="true" data-offset-key="16730:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16731"><span data-slate-leaf="true" data-offset-key="16731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16732"><span data-slate-leaf="true" data-offset-key="16732:0" data-first-offset="true"><span data-slate-string="true"> (tmpmnr == </span></span></span><span data-slate-object="text" data-key="16733"><span data-slate-leaf="true" data-offset-key="16733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16734"><span data-slate-leaf="true" data-offset-key="16734:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16735"><span data-slate-object="text" data-key="16736"><span data-slate-leaf="true" data-offset-key="16736:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16737"><span data-slate-object="text" data-key="16738"><span data-slate-leaf="true" data-offset-key="16738:0" data-first-offset="true"><span data-slate-string="true">            *rfmnr = tmpmnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16739"><span data-slate-object="text" data-key="16740"><span data-slate-leaf="true" data-offset-key="16740:0" data-first-offset="true"><span data-slate-string="true">            *rfend = </span></span></span><span data-slate-object="text" data-key="16741"><span data-slate-leaf="true" data-offset-key="16741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16742"><span data-slate-leaf="true" data-offset-key="16742:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16743"><span data-slate-object="text" data-key="16744"><span data-slate-leaf="true" data-offset-key="16744:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16745"><span data-slate-leaf="true" data-offset-key="16745:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16746"><span data-slate-leaf="true" data-offset-key="16746:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16747"><span data-slate-object="text" data-key="16748"><span data-slate-leaf="true" data-offset-key="16748:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16749"><span data-slate-object="text" data-key="16750"><span data-slate-leaf="true" data-offset-key="16750:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16751"><span data-slate-leaf="true" data-offset-key="16751:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 挂载 bafhp-&gt;af_oderpnr 地址连续的 msadsc_t 结构到 bafhlst_t 中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16752"><span data-slate-object="text" data-key="16753"><span data-slate-leaf="true" data-offset-key="16753:0" data-first-offset="true"><span data-slate-string="true">        *rfstat = &amp;mstat[bafhp-&gt;af_oderpnr];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16754"><span data-slate-object="text" data-key="16755"><span data-slate-leaf="true" data-offset-key="16755:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16756"><span data-slate-leaf="true" data-offset-key="16756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 还剩多少个地址连续的 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16757"><span data-slate-object="text" data-key="16758"><span data-slate-leaf="true" data-offset-key="16758:0" data-first-offset="true"><span data-slate-string="true">        *rfmnr = tmpmnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16759"><span data-slate-object="text" data-key="16760"><span data-slate-leaf="true" data-offset-key="16760:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16761"><span data-slate-leaf="true" data-offset-key="16761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16762"><span data-slate-leaf="true" data-offset-key="16762:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16763"><span data-slate-object="text" data-key="16764"><span data-slate-leaf="true" data-offset-key="16764:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16765"><span data-slate-object="text" data-key="16766"><span data-slate-leaf="true" data-offset-key="16766:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16767"><span data-slate-leaf="true" data-offset-key="16767:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16768"><span data-slate-leaf="true" data-offset-key="16768:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16769"><span data-slate-object="text" data-key="16770"><span data-slate-leaf="true" data-offset-key="16770:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16771"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16772"><span data-slate-object="text" data-key="16773"><span data-slate-leaf="true" data-offset-key="16773:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16774"><span data-slate-leaf="true" data-offset-key="16774:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16775"><span data-slate-leaf="true" data-offset-key="16775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_continumsadsc_mareabafh</span></span></span></span></span><span data-slate-object="text" data-key="16776"><span data-slate-leaf="true" data-offset-key="16776:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16777"><span data-slate-leaf="true" data-offset-key="16777:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16778"><span data-slate-leaf="true" data-offset-key="16778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16779"><span data-slate-leaf="true" data-offset-key="16779:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16780"><span data-slate-leaf="true" data-offset-key="16780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mstat, </span></span></span></span></span><span data-slate-object="text" data-key="16781"><span data-slate-leaf="true" data-offset-key="16781:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16782"><span data-slate-leaf="true" data-offset-key="16782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mend, </span></span></span></span></span><span data-slate-object="text" data-key="16783"><span data-slate-leaf="true" data-offset-key="16783:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16784"><span data-slate-leaf="true" data-offset-key="16784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> mnr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16785"><span data-slate-object="text" data-key="16786"><span data-slate-leaf="true" data-offset-key="16786:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16787"><span data-slate-object="text" data-key="16788"><span data-slate-leaf="true" data-offset-key="16788:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16789"><span data-slate-leaf="true" data-offset-key="16789:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16790"><span data-slate-leaf="true" data-offset-key="16790:0" data-first-offset="true"><span data-slate-string="true"> mnridx = mnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16791"><span data-slate-object="text" data-key="16792"><span data-slate-leaf="true" data-offset-key="16792:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16793"><span data-slate-leaf="true" data-offset-key="16793:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16794"><span data-slate-leaf="true" data-offset-key="16794:0" data-first-offset="true"><span data-slate-string="true"> *fstat = mstat, *fend = mend;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16795"><span data-slate-object="text" data-key="16796"><span data-slate-leaf="true" data-offset-key="16796:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16797"><span data-slate-leaf="true" data-offset-key="16797:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果 mnridx &gt; 0 并且 NULL != fend 就循环调用 continumsadsc_mareabafh_core 函数，而 mnridx 和 fend 由这个函数控制</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16798"><span data-slate-object="text" data-key="16799"><span data-slate-leaf="true" data-offset-key="16799:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16800"><span data-slate-leaf="true" data-offset-key="16800:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16801"><span data-slate-leaf="true" data-offset-key="16801:0" data-first-offset="true"><span data-slate-string="true"> (; (mnridx&gt; </span></span></span><span data-slate-object="text" data-key="16802"><span data-slate-leaf="true" data-offset-key="16802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16803"><span data-slate-leaf="true" data-offset-key="16803:0" data-first-offset="true"><span data-slate-string="true"> &amp;&amp; </span></span></span><span data-slate-object="text" data-key="16804"><span data-slate-leaf="true" data-offset-key="16804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16805"><span data-slate-leaf="true" data-offset-key="16805:0" data-first-offset="true"><span data-slate-string="true"> != fend);)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16806"><span data-slate-object="text" data-key="16807"><span data-slate-leaf="true" data-offset-key="16807:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16808"><span data-slate-object="text" data-key="16809"><span data-slate-leaf="true" data-offset-key="16809:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16810"><span data-slate-leaf="true" data-offset-key="16810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 为一段地址连续的 msadsc_t 结构寻找合适 m_mdmlielst 数组中的 bafhlst_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16811"><span data-slate-object="text" data-key="16812"><span data-slate-leaf="true" data-offset-key="16812:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16813"><span data-slate-leaf="true" data-offset-key="16813:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continumsadsc_mareabafh_core</span></span></span></span><span data-slate-object="text" data-key="16814"><span data-slate-leaf="true" data-offset-key="16814:0" data-first-offset="true"><span data-slate-string="true">(mareap, &amp;fstat, &amp;fend, &amp;mnridx)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16815"><span data-slate-object="text" data-key="16816"><span data-slate-leaf="true" data-offset-key="16816:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16817"><span data-slate-object="text" data-key="16818"><span data-slate-leaf="true" data-offset-key="16818:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16819"><span data-slate-leaf="true" data-offset-key="16819:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16820"><span data-slate-leaf="true" data-offset-key="16820:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16821"><span data-slate-object="text" data-key="16822"><span data-slate-leaf="true" data-offset-key="16822:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16823"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16824"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16825"><span data-slate-object="text" data-key="16826"><span data-slate-leaf="true" data-offset-key="16826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16827"><span data-slate-leaf="true" data-offset-key="16827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16828"><span data-slate-leaf="true" data-offset-key="16828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_scan_continumsadsc</span></span></span></span></span><span data-slate-object="text" data-key="16829"><span data-slate-leaf="true" data-offset-key="16829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16830"><span data-slate-leaf="true" data-offset-key="16830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16831"><span data-slate-leaf="true" data-offset-key="16831:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16832"><span data-slate-leaf="true" data-offset-key="16832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16833"><span data-slate-leaf="true" data-offset-key="16833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fmstat, </span></span></span></span></span><span data-slate-object="text" data-key="16834"><span data-slate-leaf="true" data-offset-key="16834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16835"><span data-slate-leaf="true" data-offset-key="16835:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *fntmsanr, </span></span></span></span></span><span data-slate-object="text" data-key="16836"><span data-slate-leaf="true" data-offset-key="16836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16837"><span data-slate-leaf="true" data-offset-key="16837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> fmsanr,</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16838"><span data-slate-object="text" data-key="16839"><span data-slate-leaf="true" data-offset-key="16839:0" data-first-offset="true"><span data-slate-string="true">                                         </span></span></span><span data-slate-object="text" data-key="16840"><span data-slate-leaf="true" data-offset-key="16840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16841"><span data-slate-leaf="true" data-offset-key="16841:0" data-first-offset="true"><span data-slate-string="true"> **retmsastatp, </span></span></span><span data-slate-object="text" data-key="16842"><span data-slate-leaf="true" data-offset-key="16842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16843"><span data-slate-leaf="true" data-offset-key="16843:0" data-first-offset="true"><span data-slate-string="true"> **retmsaendp, </span></span></span><span data-slate-object="text" data-key="16844"><span data-slate-leaf="true" data-offset-key="16844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16845"><span data-slate-leaf="true" data-offset-key="16845:0" data-first-offset="true"><span data-slate-string="true"> *retfmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16846"><span data-slate-object="text" data-key="16847"><span data-slate-leaf="true" data-offset-key="16847:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16848"><span data-slate-object="text" data-key="16849"><span data-slate-leaf="true" data-offset-key="16849:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16850"><span data-slate-leaf="true" data-offset-key="16850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">u32_t</span></span></span></span><span data-slate-object="text" data-key="16851"><span data-slate-leaf="true" data-offset-key="16851:0" data-first-offset="true"><span data-slate-string="true"> muindx = </span></span></span><span data-slate-object="text" data-key="16852"><span data-slate-leaf="true" data-offset-key="16852:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16853"><span data-slate-leaf="true" data-offset-key="16853:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16854"><span data-slate-object="text" data-key="16855"><span data-slate-leaf="true" data-offset-key="16855:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16856"><span data-slate-leaf="true" data-offset-key="16856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadflgs_t</span></span></span></span><span data-slate-object="text" data-key="16857"><span data-slate-leaf="true" data-offset-key="16857:0" data-first-offset="true"><span data-slate-string="true"> *mdfp = </span></span></span><span data-slate-object="text" data-key="16858"><span data-slate-leaf="true" data-offset-key="16858:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16859"><span data-slate-leaf="true" data-offset-key="16859:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16860"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16861"><span data-slate-object="text" data-key="16862"><span data-slate-leaf="true" data-offset-key="16862:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16863"><span data-slate-leaf="true" data-offset-key="16863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16864"><span data-slate-leaf="true" data-offset-key="16864:0" data-first-offset="true"><span data-slate-string="true"> *msastat = fmstat;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16865"><span data-slate-object="text" data-key="16866"><span data-slate-leaf="true" data-offset-key="16866:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16867"><span data-slate-leaf="true" data-offset-key="16867:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16868"><span data-slate-leaf="true" data-offset-key="16868:0" data-first-offset="true"><span data-slate-string="true"> retfindmnr = </span></span></span><span data-slate-object="text" data-key="16869"><span data-slate-leaf="true" data-offset-key="16869:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16870"><span data-slate-leaf="true" data-offset-key="16870:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16871"><span data-slate-object="text" data-key="16872"><span data-slate-leaf="true" data-offset-key="16872:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16873"><span data-slate-leaf="true" data-offset-key="16873:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="16874"><span data-slate-leaf="true" data-offset-key="16874:0" data-first-offset="true"><span data-slate-string="true"> rets = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16875"><span data-slate-object="text" data-key="16876"><span data-slate-leaf="true" data-offset-key="16876:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16877"><span data-slate-leaf="true" data-offset-key="16877:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16878"><span data-slate-leaf="true" data-offset-key="16878:0" data-first-offset="true"><span data-slate-string="true"> tmidx = *fntmsanr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16879"><span data-slate-object="text" data-key="16880"><span data-slate-leaf="true" data-offset-key="16880:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16881"><span data-slate-leaf="true" data-offset-key="16881:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 从外层函数的 fntmnr 变量开始遍历所有 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16882"><span data-slate-object="text" data-key="16883"><span data-slate-leaf="true" data-offset-key="16883:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16884"><span data-slate-leaf="true" data-offset-key="16884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16885"><span data-slate-leaf="true" data-offset-key="16885:0" data-first-offset="true"><span data-slate-string="true"> (; tmidx &lt; fmsanr; tmidx++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16886"><span data-slate-object="text" data-key="16887"><span data-slate-leaf="true" data-offset-key="16887:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16888"><span data-slate-object="text" data-key="16889"><span data-slate-leaf="true" data-offset-key="16889:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16890"><span data-slate-leaf="true" data-offset-key="16890:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 一个 msadsc_t 结构是否属于这个内存区，是否空闲</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16891"><span data-slate-object="text" data-key="16892"><span data-slate-leaf="true" data-offset-key="16892:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16893"><span data-slate-leaf="true" data-offset-key="16893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="16894"><span data-slate-leaf="true" data-offset-key="16894:0" data-first-offset="true"><span data-slate-string="true"> (msastat[tmidx].md_indxflgs.mf_marty == mdfp-&gt;mf_marty &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16895"><span data-slate-object="text" data-key="16896"><span data-slate-leaf="true" data-offset-key="16896:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16897"><span data-slate-leaf="true" data-offset-key="16897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16898"><span data-slate-leaf="true" data-offset-key="16898:0" data-first-offset="true"><span data-slate-string="true"> == msastat[tmidx].md_indxflgs.mf_uindx &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16899"><span data-slate-object="text" data-key="16900"><span data-slate-leaf="true" data-offset-key="16900:0" data-first-offset="true"><span data-slate-string="true">            MF_MOCTY_FREE == msastat[tmidx].md_indxflgs.mf_mocty &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16901"><span data-slate-object="text" data-key="16902"><span data-slate-leaf="true" data-offset-key="16902:0" data-first-offset="true"><span data-slate-string="true">            PAF_NO_ALLOC == msastat[tmidx].md_phyadrs.paf_alloc)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16903"><span data-slate-object="text" data-key="16904"><span data-slate-leaf="true" data-offset-key="16904:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16905"><span data-slate-object="text" data-key="16906"><span data-slate-leaf="true" data-offset-key="16906:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16907"><span data-slate-leaf="true" data-offset-key="16907:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 返回从这个 msadsc_t 结构开始到下一个非空闲、地址非连续的 msadsc_t 结构对应的 msadsc_t 结构索引号到 retfindmnr 变量中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16908"><span data-slate-object="text" data-key="16909"><span data-slate-leaf="true" data-offset-key="16909:0" data-first-offset="true"><span data-slate-string="true">            rets = </span></span></span><span data-slate-object="text" data-key="16910"><span data-slate-leaf="true" data-offset-key="16910:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">scan_len_msadsc</span></span></span></span><span data-slate-object="text" data-key="16911"><span data-slate-leaf="true" data-offset-key="16911:0" data-first-offset="true"><span data-slate-string="true">(&amp;msastat[tmidx], mdfp, fmsanr, &amp;retfindmnr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16912"><span data-slate-object="text" data-key="16913"><span data-slate-leaf="true" data-offset-key="16913:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16914"><span data-slate-leaf="true" data-offset-key="16914:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 下一轮开始的 msadsc_t 结构索引</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16915"><span data-slate-object="text" data-key="16916"><span data-slate-leaf="true" data-offset-key="16916:0" data-first-offset="true"><span data-slate-string="true">            *fntmsanr = tmidx + retfindmnr + </span></span></span><span data-slate-object="text" data-key="16917"><span data-slate-leaf="true" data-offset-key="16917:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16918"><span data-slate-leaf="true" data-offset-key="16918:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16919"><span data-slate-object="text" data-key="16920"><span data-slate-leaf="true" data-offset-key="16920:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16921"><span data-slate-leaf="true" data-offset-key="16921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 当前地址连续 msadsc_t 结构的开始地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16922"><span data-slate-object="text" data-key="16923"><span data-slate-leaf="true" data-offset-key="16923:0" data-first-offset="true"><span data-slate-string="true">            *retmsastatp = &amp;msastat[tmidx];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16924"><span data-slate-object="text" data-key="16925"><span data-slate-leaf="true" data-offset-key="16925:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16926"><span data-slate-leaf="true" data-offset-key="16926:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 当前地址连续 msadsc_t 结构的结束地址</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16927"><span data-slate-object="text" data-key="16928"><span data-slate-leaf="true" data-offset-key="16928:0" data-first-offset="true"><span data-slate-string="true">            *retmsaendp = &amp;msastat[tmidx + retfindmnr];</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16929"><span data-slate-object="text" data-key="16930"><span data-slate-leaf="true" data-offset-key="16930:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16931"><span data-slate-leaf="true" data-offset-key="16931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 当前有多少个地址连续 msadsc_t 结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16932"><span data-slate-object="text" data-key="16933"><span data-slate-leaf="true" data-offset-key="16933:0" data-first-offset="true"><span data-slate-string="true">            *retfmnr = retfindmnr + </span></span></span><span data-slate-object="text" data-key="16934"><span data-slate-leaf="true" data-offset-key="16934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="16935"><span data-slate-leaf="true" data-offset-key="16935:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16936"><span data-slate-object="text" data-key="16937"><span data-slate-leaf="true" data-offset-key="16937:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="16938"><span data-slate-leaf="true" data-offset-key="16938:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16939"><span data-slate-leaf="true" data-offset-key="16939:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16940"><span data-slate-object="text" data-key="16941"><span data-slate-leaf="true" data-offset-key="16941:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16942"><span data-slate-object="text" data-key="16943"><span data-slate-leaf="true" data-offset-key="16943:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16944"><span data-slate-object="text" data-key="16945"><span data-slate-leaf="true" data-offset-key="16945:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16946"><span data-slate-leaf="true" data-offset-key="16946:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="16947"><span data-slate-leaf="true" data-offset-key="16947:0" data-first-offset="true"><span data-slate-string="true"> FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16948"><span data-slate-object="text" data-key="16949"><span data-slate-leaf="true" data-offset-key="16949:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16950"></div><div data-slate-type="code-line" data-slate-object="block" data-key="16951"><span data-slate-object="text" data-key="16952"><span data-slate-leaf="true" data-offset-key="16952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span></span><span data-slate-object="text" data-key="16953"><span data-slate-leaf="true" data-offset-key="16953:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="16954"><span data-slate-leaf="true" data-offset-key="16954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_mem_onmemarea</span></span></span></span></span><span data-slate-object="text" data-key="16955"><span data-slate-leaf="true" data-offset-key="16955:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(</span></span></span></span></span><span data-slate-object="text" data-key="16956"><span data-slate-leaf="true" data-offset-key="16956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memarea_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16957"><span data-slate-leaf="true" data-offset-key="16957:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mareap, </span></span></span></span></span><span data-slate-object="text" data-key="16958"><span data-slate-leaf="true" data-offset-key="16958:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16959"><span data-slate-leaf="true" data-offset-key="16959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> *mstat, </span></span></span></span></span><span data-slate-object="text" data-key="16960"><span data-slate-leaf="true" data-offset-key="16960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span></span></span><span data-slate-object="text" data-key="16961"><span data-slate-leaf="true" data-offset-key="16961:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> msanr)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16962"><span data-slate-object="text" data-key="16963"><span data-slate-leaf="true" data-offset-key="16963:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16964"><span data-slate-object="text" data-key="16965"><span data-slate-leaf="true" data-offset-key="16965:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16966"><span data-slate-leaf="true" data-offset-key="16966:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">msadsc_t</span></span></span></span><span data-slate-object="text" data-key="16967"><span data-slate-leaf="true" data-offset-key="16967:0" data-first-offset="true"><span data-slate-string="true"> *retstatmsap = </span></span></span><span data-slate-object="text" data-key="16968"><span data-slate-leaf="true" data-offset-key="16968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16969"><span data-slate-leaf="true" data-offset-key="16969:0" data-first-offset="true"><span data-slate-string="true">, *retendmsap = </span></span></span><span data-slate-object="text" data-key="16970"><span data-slate-leaf="true" data-offset-key="16970:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="16971"><span data-slate-leaf="true" data-offset-key="16971:0" data-first-offset="true"><span data-slate-string="true">, *fntmsap = mstat;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16972"><span data-slate-object="text" data-key="16973"><span data-slate-leaf="true" data-offset-key="16973:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16974"><span data-slate-leaf="true" data-offset-key="16974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16975"><span data-slate-leaf="true" data-offset-key="16975:0" data-first-offset="true"><span data-slate-string="true"> retfindmnr = </span></span></span><span data-slate-object="text" data-key="16976"><span data-slate-leaf="true" data-offset-key="16976:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16977"><span data-slate-leaf="true" data-offset-key="16977:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16978"><span data-slate-object="text" data-key="16979"><span data-slate-leaf="true" data-offset-key="16979:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16980"><span data-slate-leaf="true" data-offset-key="16980:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">uint_t</span></span></span></span><span data-slate-object="text" data-key="16981"><span data-slate-leaf="true" data-offset-key="16981:0" data-first-offset="true"><span data-slate-string="true"> fntmnr = </span></span></span><span data-slate-object="text" data-key="16982"><span data-slate-leaf="true" data-offset-key="16982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="16983"><span data-slate-leaf="true" data-offset-key="16983:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16984"><span data-slate-object="text" data-key="16985"><span data-slate-leaf="true" data-offset-key="16985:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16986"><span data-slate-leaf="true" data-offset-key="16986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool_t</span></span></span></span><span data-slate-object="text" data-key="16987"><span data-slate-leaf="true" data-offset-key="16987:0" data-first-offset="true"><span data-slate-string="true"> retscan = FALSE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16988"><span data-slate-object="text" data-key="16989"><span data-slate-leaf="true" data-offset-key="16989:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16990"><span data-slate-object="text" data-key="16991"><span data-slate-leaf="true" data-offset-key="16991:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="16992"><span data-slate-leaf="true" data-offset-key="16992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="16993"><span data-slate-leaf="true" data-offset-key="16993:0" data-first-offset="true"><span data-slate-string="true"> (; fntmnr &lt; msanr;)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16994"><span data-slate-object="text" data-key="16995"><span data-slate-leaf="true" data-offset-key="16995:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16996"><span data-slate-object="text" data-key="16997"><span data-slate-leaf="true" data-offset-key="16997:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="16998"><span data-slate-leaf="true" data-offset-key="16998:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取最多且地址连续的 msadsc_t 结构体的开始、结束地址、一共多少个 msadsc_t 结构体，下一次循环的 fntmnr</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="16999"><span data-slate-object="text" data-key="17000"><span data-slate-leaf="true" data-offset-key="17000:0" data-first-offset="true"><span data-slate-string="true">        retscan = </span></span></span><span data-slate-object="text" data-key="17001"><span data-slate-leaf="true" data-offset-key="17001:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_scan_continumsadsc</span></span></span></span><span data-slate-object="text" data-key="17002"><span data-slate-leaf="true" data-offset-key="17002:0" data-first-offset="true"><span data-slate-string="true">(mareap, fntmsap, &amp;fntmnr, msanr, &amp;retstatmsap, &amp;retendmsap, &amp;retfindmnr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17003"><span data-slate-object="text" data-key="17004"><span data-slate-leaf="true" data-offset-key="17004:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="17005"><span data-slate-leaf="true" data-offset-key="17005:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="17006"><span data-slate-leaf="true" data-offset-key="17006:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="17007"><span data-slate-leaf="true" data-offset-key="17007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="17008"><span data-slate-leaf="true" data-offset-key="17008:0" data-first-offset="true"><span data-slate-string="true"> != retstatmsap &amp;&amp; </span></span></span><span data-slate-object="text" data-key="17009"><span data-slate-leaf="true" data-offset-key="17009:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NULL</span></span></span></span><span data-slate-object="text" data-key="17010"><span data-slate-leaf="true" data-offset-key="17010:0" data-first-offset="true"><span data-slate-string="true"> != retendmsap)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17011"><span data-slate-object="text" data-key="17012"><span data-slate-leaf="true" data-offset-key="17012:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17013"><span data-slate-object="text" data-key="17014"><span data-slate-leaf="true" data-offset-key="17014:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="17015"><span data-slate-leaf="true" data-offset-key="17015:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 把一组连续的 msadsc_t 结构体挂载到合适的 m_mdmlielst 数组中的 bafhlst_t 结构中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17016"><span data-slate-object="text" data-key="17017"><span data-slate-leaf="true" data-offset-key="17017:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="17018"><span data-slate-leaf="true" data-offset-key="17018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">merlove_continumsadsc_mareabafh</span></span></span></span><span data-slate-object="text" data-key="17019"><span data-slate-leaf="true" data-offset-key="17019:0" data-first-offset="true"><span data-slate-string="true">(mareap, retstatmsap, retendmsap, retfindmnr)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17020"><span data-slate-object="text" data-key="17021"><span data-slate-leaf="true" data-offset-key="17021:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17022"><span data-slate-object="text" data-key="17023"><span data-slate-leaf="true" data-offset-key="17023:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17024"><span data-slate-object="text" data-key="17025"><span data-slate-leaf="true" data-offset-key="17025:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17026"><span data-slate-leaf="true" data-offset-key="17026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="17027"><span data-slate-leaf="true" data-offset-key="17027:0" data-first-offset="true"><span data-slate-string="true"> TRUE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17028"><span data-slate-object="text" data-key="17029"><span data-slate-leaf="true" data-offset-key="17029:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17030"><span data-slate-object="text" data-key="17031"><span data-slate-leaf="true" data-offset-key="17031:0" data-first-offset="true"><span data-slate-string="true">为了节约篇幅，我删除了大量检查错误的代码，你可以在我提供的</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="17032"><span data-slate-object="text" data-key="17033"><span data-slate-leaf="true" data-offset-key="17033:0" data-first-offset="true"><span data-slate-string="true">源代码</span></span></span></a><span data-slate-object="text" data-key="17034"><span data-slate-leaf="true" data-offset-key="17034:0" data-first-offset="true"><span data-slate-string="true">里自行查看。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17035"><span data-slate-object="text" data-key="17036"><span data-slate-leaf="true" data-offset-key="17036:0" data-first-offset="true"><span data-slate-string="true">上述代码中，整体上分为两步。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17037"><span data-slate-object="text" data-key="17038"><span data-slate-leaf="true" data-offset-key="17038:0" data-first-offset="true"><span data-slate-string="true">第一步，通过 merlove_scan_continumsadsc 函数，返回最多且地址连续的 msadsc_t 结构体的开始、结束地址、一共多少个 msadsc_t 结构体，下一轮开始的 msadsc_t 结构体的索引号。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17039"><span data-slate-object="text" data-key="17040"><span data-slate-leaf="true" data-offset-key="17040:0" data-first-offset="true"><span data-slate-string="true">第二步，根据第一步获取的信息调用 merlove_continumsadsc_mareabafh 函数，把第一步返回那一组连续的 msadsc_t 结构体，挂载到合适的 m_mdmlielst 数组中的 bafhlst_t 结构中。详细的逻辑已经在注释中说明。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17041"><span data-slate-object="text" data-key="17042"><span data-slate-leaf="true" data-offset-key="17042:0" data-first-offset="true"><span data-slate-string="true">好，内存页已经按照规定的方式组织起来了，这表示物理内存管理器的初始化工作已经进入尾声。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="17043" id="sr-toc-6"><span data-slate-object="text" data-key="17044"><span data-slate-leaf="true" data-offset-key="17044:0" data-first-offset="true"><span data-slate-string="true">初始化汇总</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="17045"><span data-slate-object="text" data-key="17046"><span data-slate-leaf="true" data-offset-key="17046:0" data-first-offset="true"><span data-slate-string="true">别急！先别急着写内存分配相关的代码。到目前为止，我们一起写了这么多的内存初始化相关的代码，但是我们没有调用它们。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17047"><span data-slate-object="text" data-key="17048"><span data-slate-leaf="true" data-offset-key="17048:0" data-first-offset="true"><span data-slate-string="true">根据前面内存管理数据结构的关系，很显然，</span></span></span><span data-slate-object="text" data-key="17049"><span data-slate-leaf="true" data-offset-key="17049:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">它们的调用次序很重要，谁先谁后都有严格的规定，这关乎内存管理初始化的成败。</span></span></span></span><span data-slate-object="text" data-key="17050"><span data-slate-leaf="true" data-offset-key="17050:0" data-first-offset="true"><span data-slate-string="true">所以，现在我们就在先前的 init_memmgr 函数中去调用它们，代码如下所示。</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="17051"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17052"><span data-slate-object="text" data-key="17053"><span data-slate-leaf="true" data-offset-key="17053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="17054"><span data-slate-leaf="true" data-offset-key="17054:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17055"><span data-slate-leaf="true" data-offset-key="17055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgr</span></span></span></span><span data-slate-object="text" data-key="17056"><span data-slate-leaf="true" data-offset-key="17056:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="17057"><span data-slate-leaf="true" data-offset-key="17057:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17058"><span data-slate-object="text" data-key="17059"><span data-slate-leaf="true" data-offset-key="17059:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17060"><span data-slate-object="text" data-key="17061"><span data-slate-leaf="true" data-offset-key="17061:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17062"><span data-slate-leaf="true" data-offset-key="17062:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存页结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17063"><span data-slate-object="text" data-key="17064"><span data-slate-leaf="true" data-offset-key="17064:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17065"><span data-slate-leaf="true" data-offset-key="17065:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_msadsc</span></span></span></span><span data-slate-object="text" data-key="17066"><span data-slate-leaf="true" data-offset-key="17066:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17067"><span data-slate-object="text" data-key="17068"><span data-slate-leaf="true" data-offset-key="17068:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17069"><span data-slate-leaf="true" data-offset-key="17069:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 初始化内存区结构</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17070"><span data-slate-object="text" data-key="17071"><span data-slate-leaf="true" data-offset-key="17071:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17072"><span data-slate-leaf="true" data-offset-key="17072:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memarea</span></span></span></span><span data-slate-object="text" data-key="17073"><span data-slate-leaf="true" data-offset-key="17073:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17074"><span data-slate-object="text" data-key="17075"><span data-slate-leaf="true" data-offset-key="17075:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17076"><span data-slate-leaf="true" data-offset-key="17076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 处理内存占用</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17077"><span data-slate-object="text" data-key="17078"><span data-slate-leaf="true" data-offset-key="17078:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17079"><span data-slate-leaf="true" data-offset-key="17079:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_search_krloccupymm</span></span></span></span><span data-slate-object="text" data-key="17080"><span data-slate-leaf="true" data-offset-key="17080:0" data-first-offset="true"><span data-slate-string="true">(&amp;kmachbsp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17081"><span data-slate-object="text" data-key="17082"><span data-slate-leaf="true" data-offset-key="17082:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17083"><span data-slate-leaf="true" data-offset-key="17083:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 合并内存页到内存区中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17084"><span data-slate-object="text" data-key="17085"><span data-slate-leaf="true" data-offset-key="17085:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17086"><span data-slate-leaf="true" data-offset-key="17086:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_merlove_mem</span></span></span></span><span data-slate-object="text" data-key="17087"><span data-slate-leaf="true" data-offset-key="17087:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17088"><span data-slate-object="text" data-key="17089"><span data-slate-leaf="true" data-offset-key="17089:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17090"><span data-slate-leaf="true" data-offset-key="17090:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgrob</span></span></span></span><span data-slate-object="text" data-key="17091"><span data-slate-leaf="true" data-offset-key="17091:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17092"><span data-slate-object="text" data-key="17093"><span data-slate-leaf="true" data-offset-key="17093:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17094"><span data-slate-leaf="true" data-offset-key="17094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="17095"><span data-slate-leaf="true" data-offset-key="17095:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17096"><span data-slate-object="text" data-key="17097"><span data-slate-leaf="true" data-offset-key="17097:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17098"><span data-slate-object="text" data-key="17099"><span data-slate-leaf="true" data-offset-key="17099:0" data-first-offset="true"><span data-slate-string="true">上述代码中，init_msadsc、init_memarea 函数是可以交换次序的，它们俩互不影响，但它们俩必须最先开始调用，而后面的函数要依赖它们生成的数据结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17100"><span data-slate-object="text" data-key="17101"><span data-slate-leaf="true" data-offset-key="17101:0" data-first-offset="true"><span data-slate-string="true">但是 init_search_krloccupymm 函数必须要在 init_merlove_mem 函数之前被调用，因为 init_merlove_mem 函数在合并页面时，必须先知道哪些页面被占用了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17102"><span data-slate-object="text" data-key="17103"><span data-slate-leaf="true" data-offset-key="17103:0" data-first-offset="true"><span data-slate-string="true">等一等，init_memmgrob 是什么函数，这个我们还没写呢。下面我们就来现实它。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17104"><span data-slate-object="text" data-key="17105"><span data-slate-leaf="true" data-offset-key="17105:0" data-first-offset="true"><span data-slate-string="true">不知道你发现没有，我们的 phymmarge_t 结构体的地址和数量、msadsc_t 结构体的地址和数据、memarea_t 结构体的地址和数量都保存在了 kmachbsp 变量中，这个变量其实不是用来管理内存的，而且它里面放的是</span></span></span><span data-slate-object="text" data-key="17106"><span data-slate-leaf="true" data-offset-key="17106:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">物理地址</span></span></span></span><span data-slate-object="text" data-key="17107"><span data-slate-leaf="true" data-offset-key="17107:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17108"><span data-slate-object="text" data-key="17109"><span data-slate-leaf="true" data-offset-key="17109:0" data-first-offset="true"><span data-slate-string="true">但内核使用的是虚拟地址，每次都要转换极不方便，所以我们要设计一个专用的数据结构，用于内存管理。我们来定义一下这个结构，代码如下。</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="17110"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div><div data-code-line-number="46"></div><div data-code-line-number="47"></div><div data-code-line-number="48"></div><div data-code-line-number="49"></div><div data-code-line-number="50"></div><div data-code-line-number="51"></div><div data-code-line-number="52"></div><div data-code-line-number="53"></div><div data-code-line-number="54"></div><div data-code-line-number="55"></div><div data-code-line-number="56"></div><div data-code-line-number="57"></div><div data-code-line-number="58"></div><div data-code-line-number="59"></div><div data-code-line-number="60"></div><div data-code-line-number="61"></div><div data-code-line-number="62"></div><div data-code-line-number="63"></div><div data-code-line-number="64"></div><div data-code-line-number="65"></div><div data-code-line-number="66"></div><div data-code-line-number="67"></div><div data-code-line-number="68"></div><div data-code-line-number="69"></div><div data-code-line-number="70"></div><div data-code-line-number="71"></div><div data-code-line-number="72"></div><div data-code-line-number="73"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="17111"><span data-slate-object="text" data-key="17112"><span data-slate-leaf="true" data-offset-key="17112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//cosmos/include/halinc/halglobal.c</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17113"><span data-slate-object="text" data-key="17114"><span data-slate-leaf="true" data-offset-key="17114:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">HAL_DEFGLOB_VARIABLE</span></span></span></span><span data-slate-object="text" data-key="17115"><span data-slate-leaf="true" data-offset-key="17115:0" data-first-offset="true"><span data-slate-string="true">(memmgrob_t,memmgrob);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17116"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17117"><span data-slate-object="text" data-key="17118"><span data-slate-leaf="true" data-offset-key="17118:0" data-first-offset="true"><span data-slate-string="true">typedef </span></span></span><span data-slate-object="text" data-key="17119"><span data-slate-leaf="true" data-offset-key="17119:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="17120"><span data-slate-leaf="true" data-offset-key="17120:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="17121"><span data-slate-leaf="true" data-offset-key="17121:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">s_MEMMGROB</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17122"><span data-slate-object="text" data-key="17123"><span data-slate-leaf="true" data-offset-key="17123:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17124"><span data-slate-object="text" data-key="17125"><span data-slate-leaf="true" data-offset-key="17125:0" data-first-offset="true"><span data-slate-string="true">    list_h_t mo_list;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17126"><span data-slate-object="text" data-key="17127"><span data-slate-leaf="true" data-offset-key="17127:0" data-first-offset="true"><span data-slate-string="true">    spinlock_t mo_lock;        </span></span></span><span data-slate-object="text" data-key="17128"><span data-slate-leaf="true" data-offset-key="17128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 保护自身自旋锁</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17129"><span data-slate-object="text" data-key="17130"><span data-slate-leaf="true" data-offset-key="17130:0" data-first-offset="true"><span data-slate-string="true">    uint_t mo_stus;            </span></span></span><span data-slate-object="text" data-key="17131"><span data-slate-leaf="true" data-offset-key="17131:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 状态</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17132"><span data-slate-object="text" data-key="17133"><span data-slate-leaf="true" data-offset-key="17133:0" data-first-offset="true"><span data-slate-string="true">    uint_t mo_flgs;            </span></span></span><span data-slate-object="text" data-key="17134"><span data-slate-leaf="true" data-offset-key="17134:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 标志</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17135"><span data-slate-object="text" data-key="17136"><span data-slate-leaf="true" data-offset-key="17136:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_memsz;            </span></span></span><span data-slate-object="text" data-key="17137"><span data-slate-leaf="true" data-offset-key="17137:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存大小</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17138"><span data-slate-object="text" data-key="17139"><span data-slate-leaf="true" data-offset-key="17139:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_maxpages;         </span></span></span><span data-slate-object="text" data-key="17140"><span data-slate-leaf="true" data-offset-key="17140:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存最大页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17141"><span data-slate-object="text" data-key="17142"><span data-slate-leaf="true" data-offset-key="17142:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_freepages;        </span></span></span><span data-slate-object="text" data-key="17143"><span data-slate-leaf="true" data-offset-key="17143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存最大空闲页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17144"><span data-slate-object="text" data-key="17145"><span data-slate-leaf="true" data-offset-key="17145:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_alocpages;        </span></span></span><span data-slate-object="text" data-key="17146"><span data-slate-leaf="true" data-offset-key="17146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存最大分配页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17147"><span data-slate-object="text" data-key="17148"><span data-slate-leaf="true" data-offset-key="17148:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_resvpages;        </span></span></span><span data-slate-object="text" data-key="17149"><span data-slate-leaf="true" data-offset-key="17149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存保留页面数</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17150"><span data-slate-object="text" data-key="17151"><span data-slate-leaf="true" data-offset-key="17151:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_horizline;        </span></span></span><span data-slate-object="text" data-key="17152"><span data-slate-leaf="true" data-offset-key="17152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存分配水位线</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17153"><span data-slate-object="text" data-key="17154"><span data-slate-leaf="true" data-offset-key="17154:0" data-first-offset="true"><span data-slate-string="true">    phymmarge_t* mo_pmagestat; </span></span></span><span data-slate-object="text" data-key="17155"><span data-slate-leaf="true" data-offset-key="17155:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存空间布局结构指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17156"><span data-slate-object="text" data-key="17157"><span data-slate-leaf="true" data-offset-key="17157:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_pmagenr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17158"><span data-slate-object="text" data-key="17159"><span data-slate-leaf="true" data-offset-key="17159:0" data-first-offset="true"><span data-slate-string="true">    msadsc_t* mo_msadscstat;   </span></span></span><span data-slate-object="text" data-key="17160"><span data-slate-leaf="true" data-offset-key="17160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存页面结构指针</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17161"><span data-slate-object="text" data-key="17162"><span data-slate-leaf="true" data-offset-key="17162:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_msanr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17163"><span data-slate-object="text" data-key="17164"><span data-slate-leaf="true" data-offset-key="17164:0" data-first-offset="true"><span data-slate-string="true">    memarea_t* mo_mareastat;   </span></span></span><span data-slate-object="text" data-key="17165"><span data-slate-leaf="true" data-offset-key="17165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 内存区结构指针 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17166"><span data-slate-object="text" data-key="17167"><span data-slate-leaf="true" data-offset-key="17167:0" data-first-offset="true"><span data-slate-string="true">    u64_t mo_mareanr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17168"><span data-slate-object="text" data-key="17169"><span data-slate-leaf="true" data-offset-key="17169:0" data-first-offset="true"><span data-slate-string="true">}memmgrob_t;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17170"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17171"><span data-slate-object="text" data-key="17172"><span data-slate-leaf="true" data-offset-key="17172:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//cosmos/hal/x86/memmgrinit.c</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17173"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17174"><span data-slate-object="text" data-key="17175"><span data-slate-leaf="true" data-offset-key="17175:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="17176"><span data-slate-leaf="true" data-offset-key="17176:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memmgrob_t_init</span></span></span></span><span data-slate-object="text" data-key="17177"><span data-slate-leaf="true" data-offset-key="17177:0" data-first-offset="true"><span data-slate-string="true">(memmgrob_t *initp)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17178"><span data-slate-object="text" data-key="17179"><span data-slate-leaf="true" data-offset-key="17179:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17180"><span data-slate-object="text" data-key="17181"><span data-slate-leaf="true" data-offset-key="17181:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17182"><span data-slate-leaf="true" data-offset-key="17182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">list_init</span></span></span></span><span data-slate-object="text" data-key="17183"><span data-slate-leaf="true" data-offset-key="17183:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="17184"><span data-slate-leaf="true" data-offset-key="17184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17185"><span data-slate-leaf="true" data-offset-key="17185:0" data-first-offset="true"><span data-slate-string="true">mo_list);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17186"><span data-slate-object="text" data-key="17187"><span data-slate-leaf="true" data-offset-key="17187:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17188"><span data-slate-leaf="true" data-offset-key="17188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">knl_spinlock_init</span></span></span></span><span data-slate-object="text" data-key="17189"><span data-slate-leaf="true" data-offset-key="17189:0" data-first-offset="true"><span data-slate-string="true">(&amp;initp</span></span></span><span data-slate-object="text" data-key="17190"><span data-slate-leaf="true" data-offset-key="17190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17191"><span data-slate-leaf="true" data-offset-key="17191:0" data-first-offset="true"><span data-slate-string="true">mo_lock);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17192"><span data-slate-object="text" data-key="17193"><span data-slate-leaf="true" data-offset-key="17193:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17194"><span data-slate-leaf="true" data-offset-key="17194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17195"><span data-slate-leaf="true" data-offset-key="17195:0" data-first-offset="true"><span data-slate-string="true">mo_stus = </span></span></span><span data-slate-object="text" data-key="17196"><span data-slate-leaf="true" data-offset-key="17196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17197"><span data-slate-leaf="true" data-offset-key="17197:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17198"><span data-slate-object="text" data-key="17199"><span data-slate-leaf="true" data-offset-key="17199:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17200"><span data-slate-leaf="true" data-offset-key="17200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17201"><span data-slate-leaf="true" data-offset-key="17201:0" data-first-offset="true"><span data-slate-string="true">mo_flgs = </span></span></span><span data-slate-object="text" data-key="17202"><span data-slate-leaf="true" data-offset-key="17202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17203"><span data-slate-leaf="true" data-offset-key="17203:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17204"><span data-slate-object="text" data-key="17205"><span data-slate-leaf="true" data-offset-key="17205:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17206"><span data-slate-leaf="true" data-offset-key="17206:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17207"><span data-slate-leaf="true" data-offset-key="17207:0" data-first-offset="true"><span data-slate-string="true">mo_memsz = </span></span></span><span data-slate-object="text" data-key="17208"><span data-slate-leaf="true" data-offset-key="17208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17209"><span data-slate-leaf="true" data-offset-key="17209:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17210"><span data-slate-object="text" data-key="17211"><span data-slate-leaf="true" data-offset-key="17211:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17212"><span data-slate-leaf="true" data-offset-key="17212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17213"><span data-slate-leaf="true" data-offset-key="17213:0" data-first-offset="true"><span data-slate-string="true">mo_maxpages = </span></span></span><span data-slate-object="text" data-key="17214"><span data-slate-leaf="true" data-offset-key="17214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17215"><span data-slate-leaf="true" data-offset-key="17215:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17216"><span data-slate-object="text" data-key="17217"><span data-slate-leaf="true" data-offset-key="17217:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17218"><span data-slate-leaf="true" data-offset-key="17218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17219"><span data-slate-leaf="true" data-offset-key="17219:0" data-first-offset="true"><span data-slate-string="true">mo_freepages = </span></span></span><span data-slate-object="text" data-key="17220"><span data-slate-leaf="true" data-offset-key="17220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17221"><span data-slate-leaf="true" data-offset-key="17221:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17222"><span data-slate-object="text" data-key="17223"><span data-slate-leaf="true" data-offset-key="17223:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17224"><span data-slate-leaf="true" data-offset-key="17224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17225"><span data-slate-leaf="true" data-offset-key="17225:0" data-first-offset="true"><span data-slate-string="true">mo_alocpages = </span></span></span><span data-slate-object="text" data-key="17226"><span data-slate-leaf="true" data-offset-key="17226:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17227"><span data-slate-leaf="true" data-offset-key="17227:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17228"><span data-slate-object="text" data-key="17229"><span data-slate-leaf="true" data-offset-key="17229:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17230"><span data-slate-leaf="true" data-offset-key="17230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17231"><span data-slate-leaf="true" data-offset-key="17231:0" data-first-offset="true"><span data-slate-string="true">mo_resvpages = </span></span></span><span data-slate-object="text" data-key="17232"><span data-slate-leaf="true" data-offset-key="17232:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17233"><span data-slate-leaf="true" data-offset-key="17233:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17234"><span data-slate-object="text" data-key="17235"><span data-slate-leaf="true" data-offset-key="17235:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17236"><span data-slate-leaf="true" data-offset-key="17236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17237"><span data-slate-leaf="true" data-offset-key="17237:0" data-first-offset="true"><span data-slate-string="true">mo_horizline = </span></span></span><span data-slate-object="text" data-key="17238"><span data-slate-leaf="true" data-offset-key="17238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17239"><span data-slate-leaf="true" data-offset-key="17239:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17240"><span data-slate-object="text" data-key="17241"><span data-slate-leaf="true" data-offset-key="17241:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17242"><span data-slate-leaf="true" data-offset-key="17242:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17243"><span data-slate-leaf="true" data-offset-key="17243:0" data-first-offset="true"><span data-slate-string="true">mo_pmagestat = NULL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17244"><span data-slate-object="text" data-key="17245"><span data-slate-leaf="true" data-offset-key="17245:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17246"><span data-slate-leaf="true" data-offset-key="17246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17247"><span data-slate-leaf="true" data-offset-key="17247:0" data-first-offset="true"><span data-slate-string="true">mo_pmagenr = </span></span></span><span data-slate-object="text" data-key="17248"><span data-slate-leaf="true" data-offset-key="17248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17249"><span data-slate-leaf="true" data-offset-key="17249:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17250"><span data-slate-object="text" data-key="17251"><span data-slate-leaf="true" data-offset-key="17251:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17252"><span data-slate-leaf="true" data-offset-key="17252:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17253"><span data-slate-leaf="true" data-offset-key="17253:0" data-first-offset="true"><span data-slate-string="true">mo_msadscstat = NULL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17254"><span data-slate-object="text" data-key="17255"><span data-slate-leaf="true" data-offset-key="17255:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17256"><span data-slate-leaf="true" data-offset-key="17256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17257"><span data-slate-leaf="true" data-offset-key="17257:0" data-first-offset="true"><span data-slate-string="true">mo_msanr = </span></span></span><span data-slate-object="text" data-key="17258"><span data-slate-leaf="true" data-offset-key="17258:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17259"><span data-slate-leaf="true" data-offset-key="17259:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17260"><span data-slate-object="text" data-key="17261"><span data-slate-leaf="true" data-offset-key="17261:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17262"><span data-slate-leaf="true" data-offset-key="17262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17263"><span data-slate-leaf="true" data-offset-key="17263:0" data-first-offset="true"><span data-slate-string="true">mo_mareastat = NULL;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17264"><span data-slate-object="text" data-key="17265"><span data-slate-leaf="true" data-offset-key="17265:0" data-first-offset="true"><span data-slate-string="true">    initp</span></span></span><span data-slate-object="text" data-key="17266"><span data-slate-leaf="true" data-offset-key="17266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17267"><span data-slate-leaf="true" data-offset-key="17267:0" data-first-offset="true"><span data-slate-string="true">mo_mareanr = </span></span></span><span data-slate-object="text" data-key="17268"><span data-slate-leaf="true" data-offset-key="17268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17269"><span data-slate-leaf="true" data-offset-key="17269:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17270"><span data-slate-object="text" data-key="17271"><span data-slate-leaf="true" data-offset-key="17271:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17272"><span data-slate-leaf="true" data-offset-key="17272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="17273"><span data-slate-leaf="true" data-offset-key="17273:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17274"><span data-slate-object="text" data-key="17275"><span data-slate-leaf="true" data-offset-key="17275:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17276"></div><div data-slate-type="code-line" data-slate-object="block" data-key="17277"><span data-slate-object="text" data-key="17278"><span data-slate-leaf="true" data-offset-key="17278:0" data-first-offset="true"><span data-slate-string="true">void </span></span></span><span data-slate-object="text" data-key="17279"><span data-slate-leaf="true" data-offset-key="17279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">init_memmgrob</span></span></span></span><span data-slate-object="text" data-key="17280"><span data-slate-leaf="true" data-offset-key="17280:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17281"><span data-slate-object="text" data-key="17282"><span data-slate-leaf="true" data-offset-key="17282:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17283"><span data-slate-object="text" data-key="17284"><span data-slate-leaf="true" data-offset-key="17284:0" data-first-offset="true"><span data-slate-string="true">    machbstart_t *mbsp = &amp;kmachbsp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17285"><span data-slate-object="text" data-key="17286"><span data-slate-leaf="true" data-offset-key="17286:0" data-first-offset="true"><span data-slate-string="true">    memmgrob_t *mobp = &amp;memmgrob;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17287"><span data-slate-object="text" data-key="17288"><span data-slate-leaf="true" data-offset-key="17288:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17289"><span data-slate-leaf="true" data-offset-key="17289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">memmgrob_t_init</span></span></span></span><span data-slate-object="text" data-key="17290"><span data-slate-leaf="true" data-offset-key="17290:0" data-first-offset="true"><span data-slate-string="true">(mobp);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17291"><span data-slate-object="text" data-key="17292"><span data-slate-leaf="true" data-offset-key="17292:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17293"><span data-slate-leaf="true" data-offset-key="17293:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17294"><span data-slate-leaf="true" data-offset-key="17294:0" data-first-offset="true"><span data-slate-string="true">mo_pmagestat = (phymmarge_t *)</span></span></span><span data-slate-object="text" data-key="17295"><span data-slate-leaf="true" data-offset-key="17295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="17296"><span data-slate-leaf="true" data-offset-key="17296:0" data-first-offset="true"><span data-slate-string="true">((adr_t)mbsp</span></span></span><span data-slate-object="text" data-key="17297"><span data-slate-leaf="true" data-offset-key="17297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17298"><span data-slate-leaf="true" data-offset-key="17298:0" data-first-offset="true"><span data-slate-string="true">mb_e820expadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17299"><span data-slate-object="text" data-key="17300"><span data-slate-leaf="true" data-offset-key="17300:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17301"><span data-slate-leaf="true" data-offset-key="17301:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17302"><span data-slate-leaf="true" data-offset-key="17302:0" data-first-offset="true"><span data-slate-string="true">mo_pmagenr = mbsp</span></span></span><span data-slate-object="text" data-key="17303"><span data-slate-leaf="true" data-offset-key="17303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17304"><span data-slate-leaf="true" data-offset-key="17304:0" data-first-offset="true"><span data-slate-string="true">mb_e820exnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17305"><span data-slate-object="text" data-key="17306"><span data-slate-leaf="true" data-offset-key="17306:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17307"><span data-slate-leaf="true" data-offset-key="17307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17308"><span data-slate-leaf="true" data-offset-key="17308:0" data-first-offset="true"><span data-slate-string="true">mo_msadscstat = (msadsc_t *)</span></span></span><span data-slate-object="text" data-key="17309"><span data-slate-leaf="true" data-offset-key="17309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="17310"><span data-slate-leaf="true" data-offset-key="17310:0" data-first-offset="true"><span data-slate-string="true">((adr_t)mbsp</span></span></span><span data-slate-object="text" data-key="17311"><span data-slate-leaf="true" data-offset-key="17311:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17312"><span data-slate-leaf="true" data-offset-key="17312:0" data-first-offset="true"><span data-slate-string="true">mb_memmappadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17313"><span data-slate-object="text" data-key="17314"><span data-slate-leaf="true" data-offset-key="17314:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17315"><span data-slate-leaf="true" data-offset-key="17315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17316"><span data-slate-leaf="true" data-offset-key="17316:0" data-first-offset="true"><span data-slate-string="true">mo_msanr = mbsp</span></span></span><span data-slate-object="text" data-key="17317"><span data-slate-leaf="true" data-offset-key="17317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17318"><span data-slate-leaf="true" data-offset-key="17318:0" data-first-offset="true"><span data-slate-string="true">mb_memmapnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17319"><span data-slate-object="text" data-key="17320"><span data-slate-leaf="true" data-offset-key="17320:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17321"><span data-slate-leaf="true" data-offset-key="17321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17322"><span data-slate-leaf="true" data-offset-key="17322:0" data-first-offset="true"><span data-slate-string="true">mo_mareastat = (memarea_t *)</span></span></span><span data-slate-object="text" data-key="17323"><span data-slate-leaf="true" data-offset-key="17323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">phyadr_to_viradr</span></span></span></span><span data-slate-object="text" data-key="17324"><span data-slate-leaf="true" data-offset-key="17324:0" data-first-offset="true"><span data-slate-string="true">((adr_t)mbsp</span></span></span><span data-slate-object="text" data-key="17325"><span data-slate-leaf="true" data-offset-key="17325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17326"><span data-slate-leaf="true" data-offset-key="17326:0" data-first-offset="true"><span data-slate-string="true">mb_memznpadr);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17327"><span data-slate-object="text" data-key="17328"><span data-slate-leaf="true" data-offset-key="17328:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17329"><span data-slate-leaf="true" data-offset-key="17329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17330"><span data-slate-leaf="true" data-offset-key="17330:0" data-first-offset="true"><span data-slate-string="true">mo_mareanr = mbsp</span></span></span><span data-slate-object="text" data-key="17331"><span data-slate-leaf="true" data-offset-key="17331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17332"><span data-slate-leaf="true" data-offset-key="17332:0" data-first-offset="true"><span data-slate-string="true">mb_memznnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17333"><span data-slate-object="text" data-key="17334"><span data-slate-leaf="true" data-offset-key="17334:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17335"><span data-slate-leaf="true" data-offset-key="17335:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17336"><span data-slate-leaf="true" data-offset-key="17336:0" data-first-offset="true"><span data-slate-string="true">mo_memsz = mbsp</span></span></span><span data-slate-object="text" data-key="17337"><span data-slate-leaf="true" data-offset-key="17337:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17338"><span data-slate-leaf="true" data-offset-key="17338:0" data-first-offset="true"><span data-slate-string="true">mb_memmapnr &lt;&lt; PSHRSIZE;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17339"><span data-slate-object="text" data-key="17340"><span data-slate-leaf="true" data-offset-key="17340:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17341"><span data-slate-leaf="true" data-offset-key="17341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17342"><span data-slate-leaf="true" data-offset-key="17342:0" data-first-offset="true"><span data-slate-string="true">mo_maxpages = mbsp</span></span></span><span data-slate-object="text" data-key="17343"><span data-slate-leaf="true" data-offset-key="17343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17344"><span data-slate-leaf="true" data-offset-key="17344:0" data-first-offset="true"><span data-slate-string="true">mb_memmapnr;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17345"><span data-slate-object="text" data-key="17346"><span data-slate-leaf="true" data-offset-key="17346:0" data-first-offset="true"><span data-slate-string="true">    uint_t aidx = </span></span></span><span data-slate-object="text" data-key="17347"><span data-slate-leaf="true" data-offset-key="17347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17348"><span data-slate-leaf="true" data-offset-key="17348:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17349"><span data-slate-object="text" data-key="17350"><span data-slate-leaf="true" data-offset-key="17350:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17351"><span data-slate-leaf="true" data-offset-key="17351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="17352"><span data-slate-leaf="true" data-offset-key="17352:0" data-first-offset="true"><span data-slate-string="true"> (uint_t i = </span></span></span><span data-slate-object="text" data-key="17353"><span data-slate-leaf="true" data-offset-key="17353:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="17354"><span data-slate-leaf="true" data-offset-key="17354:0" data-first-offset="true"><span data-slate-string="true">; i &lt; mobp</span></span></span><span data-slate-object="text" data-key="17355"><span data-slate-leaf="true" data-offset-key="17355:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17356"><span data-slate-leaf="true" data-offset-key="17356:0" data-first-offset="true"><span data-slate-string="true">mo_msanr; i++)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17357"><span data-slate-object="text" data-key="17358"><span data-slate-leaf="true" data-offset-key="17358:0" data-first-offset="true"><span data-slate-string="true">    {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17359"><span data-slate-object="text" data-key="17360"><span data-slate-leaf="true" data-offset-key="17360:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="17361"><span data-slate-leaf="true" data-offset-key="17361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="17362"><span data-slate-leaf="true" data-offset-key="17362:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="17363"><span data-slate-leaf="true" data-offset-key="17363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="17364"><span data-slate-leaf="true" data-offset-key="17364:0" data-first-offset="true"><span data-slate-string="true"> == mobp</span></span></span><span data-slate-object="text" data-key="17365"><span data-slate-leaf="true" data-offset-key="17365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17366"><span data-slate-leaf="true" data-offset-key="17366:0" data-first-offset="true"><span data-slate-string="true">mo_msadscstat[i].md_indxflgs.mf_uindx &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17367"><span data-slate-object="text" data-key="17368"><span data-slate-leaf="true" data-offset-key="17368:0" data-first-offset="true"><span data-slate-string="true">            MF_MOCTY_KRNL == mobp</span></span></span><span data-slate-object="text" data-key="17369"><span data-slate-leaf="true" data-offset-key="17369:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17370"><span data-slate-leaf="true" data-offset-key="17370:0" data-first-offset="true"><span data-slate-string="true">mo_msadscstat[i].md_indxflgs.mf_mocty &amp;&amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17371"><span data-slate-object="text" data-key="17372"><span data-slate-leaf="true" data-offset-key="17372:0" data-first-offset="true"><span data-slate-string="true">            PAF_ALLOC == mobp</span></span></span><span data-slate-object="text" data-key="17373"><span data-slate-leaf="true" data-offset-key="17373:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17374"><span data-slate-leaf="true" data-offset-key="17374:0" data-first-offset="true"><span data-slate-string="true">mo_msadscstat[i].md_phyadrs.paf_alloc)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17375"><span data-slate-object="text" data-key="17376"><span data-slate-leaf="true" data-offset-key="17376:0" data-first-offset="true"><span data-slate-string="true">        {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17377"><span data-slate-object="text" data-key="17378"><span data-slate-leaf="true" data-offset-key="17378:0" data-first-offset="true"><span data-slate-string="true">            aidx++;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17379"><span data-slate-object="text" data-key="17380"><span data-slate-leaf="true" data-offset-key="17380:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17381"><span data-slate-object="text" data-key="17382"><span data-slate-leaf="true" data-offset-key="17382:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17383"><span data-slate-object="text" data-key="17384"><span data-slate-leaf="true" data-offset-key="17384:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17385"><span data-slate-leaf="true" data-offset-key="17385:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17386"><span data-slate-leaf="true" data-offset-key="17386:0" data-first-offset="true"><span data-slate-string="true">mo_alocpages = aidx;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17387"><span data-slate-object="text" data-key="17388"><span data-slate-leaf="true" data-offset-key="17388:0" data-first-offset="true"><span data-slate-string="true">    mobp</span></span></span><span data-slate-object="text" data-key="17389"><span data-slate-leaf="true" data-offset-key="17389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17390"><span data-slate-leaf="true" data-offset-key="17390:0" data-first-offset="true"><span data-slate-string="true">mo_freepages = mobp</span></span></span><span data-slate-object="text" data-key="17391"><span data-slate-leaf="true" data-offset-key="17391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17392"><span data-slate-leaf="true" data-offset-key="17392:0" data-first-offset="true"><span data-slate-string="true">mo_maxpages - mobp</span></span></span><span data-slate-object="text" data-key="17393"><span data-slate-leaf="true" data-offset-key="17393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="17394"><span data-slate-leaf="true" data-offset-key="17394:0" data-first-offset="true"><span data-slate-string="true">mo_alocpages;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17395"><span data-slate-object="text" data-key="17396"><span data-slate-leaf="true" data-offset-key="17396:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="17397"><span data-slate-leaf="true" data-offset-key="17397:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="17398"><span data-slate-leaf="true" data-offset-key="17398:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="17399"><span data-slate-object="text" data-key="17400"><span data-slate-leaf="true" data-offset-key="17400:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17401"><span data-slate-object="text" data-key="17402"><span data-slate-leaf="true" data-offset-key="17402:0" data-first-offset="true"><span data-slate-string="true">这些代码非常容易理解，我们就不再讨论了，无非是将内存管理核心数据结构的地址和数量放在其中，并计算了一些统计信息，这没有任何难度，相信你会轻松理解。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17403" id="sr-toc-7"><span data-slate-object="text" data-key="17404"><span data-slate-leaf="true" data-offset-key="17404:0" data-first-offset="true"><span data-slate-string="true">重点回顾</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17405"><span data-slate-object="text" data-key="17406"><span data-slate-leaf="true" data-offset-key="17406:0" data-first-offset="true"><span data-slate-string="true">今天课程的重点工作是初始化我们设计的内存管理数据结构，在内存中建立它们的实例变量，我来为你梳理一下重点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17407"><span data-slate-object="text" data-key="17408"><span data-slate-leaf="true" data-offset-key="17408:0" data-first-offset="true"><span data-slate-string="true">首先，我们从初始化 msadsc_t 结构开始，在内存中建立 msadsc_t 结构的实例变量，每个物理内存页面一个 msadsc_t 结构的实例变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17409"><span data-slate-object="text" data-key="17410"><span data-slate-leaf="true" data-offset-key="17410:0" data-first-offset="true"><span data-slate-string="true">然后是初始化 memarea_t 结构，在 msadsc_t 结构的实例变量之后，每个内存区一个 memarea_t 结构实例变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17411"><span data-slate-object="text" data-key="17412"><span data-slate-leaf="true" data-offset-key="17412:0" data-first-offset="true"><span data-slate-string="true">接着标记哪些 msadsc_t 结构对应的物理内存被内核占用了，这些被标记 msadsc_t 结构是不能纳入内存管理结构中去的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17413"><span data-slate-object="text" data-key="17414"><span data-slate-leaf="true" data-offset-key="17414:0" data-first-offset="true"><span data-slate-string="true">最后，把所有的空闲 msadsc_t 结构按最大地址连续的形式组织起来，挂载到 memarea_t 结构下的 memdivmer_t 结构中，对应的 dm_mdmlielst 数组中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17415"><span data-slate-object="text" data-key="17416"><span data-slate-leaf="true" data-offset-key="17416:0" data-first-offset="true"><span data-slate-string="true">不知道你是否想过，随着物理内存不断增加，msadsc_t 结构实例变量本身占用的内存空间就会增加，那你有办法降低 msadsc_t 结构实例变量占用的内存空间吗？期待你的实现。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="17417" id="sr-toc-8"><span data-slate-object="text" data-key="17418"><span data-slate-leaf="true" data-offset-key="17418:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="17419"><span data-slate-object="text" data-key="17420"><span data-slate-leaf="true" data-offset-key="17420:0" data-first-offset="true"><span data-slate-string="true">请问在 4GB 的物理内存的情况下，msadsc_t 结构实例变量本身占用多大的内存空间？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17421"><span data-slate-object="text" data-key="17422"><span data-slate-leaf="true" data-offset-key="17422:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区跟我交流互动，也希望你能把这节课分享给你的同事、朋友。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="17423"><span data-slate-object="text" data-key="17424"><span data-slate-leaf="true" data-offset-key="17424:0" data-first-offset="true"><span data-slate-string="true">好，我是 LMOS，我们下节课见！</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>10</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-9">精选留言 (25)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>neohope</span></div></div><div>一、稍微整理了一下流程：
init_hal-&gt;init_halmm-&gt;init_memmgr
// 每个页对应一个 msadsc_t 结构体，循环填充 msadsc_t 结构体数组
-&gt;init_msadsc
// 初始化三类 memarea_t，硬件区、内核区、用户区
-&gt;init_memarea
// 对已使用的页打上标记，包括：BIOS 中断表、内核栈、内核、内核映像
-&gt;init_search_krloccupymm (&amp;kmachbsp);    
// 将页面按地址范围，分配给内存区
// 然后按顺序依次查找最长连续的页面，根据连续页面的长度，
// 将这些页面的 msadsc_t 挂载到 memdivmer_t 结构下的 bafhlst_t 数组 dm_mdmlielst 中
-&gt;init_merlove_mem ();
// 物理地址转为虚拟地址，便于以后使用
-&gt;init_memmgrob ();

二、对于最后的问题，用了虚拟机进行测试，但无论内存大小，总有 56K 内存没能找到【有知道的小伙伴，麻烦帮忙解答一下】：
1、4G 内存情况如下：
理论内存：0x1 0000 0000 = 4,194,304K
可用内存：0xfff8fc00 = 4,193,855K
预留区域：0x52400  = 329K
硬件使用：0x10000  = 64K
没能找到：0xE000 = 56K

msadsc_t 结构体大小为 40，使用内存总计为：
4,193,855K/4K*40=41,938,520 = 接近 40M

2、2G 内存情况如下
理论内存：0x8000 0000 =2,097,152K
可用内存：0x7ff8fc00 = 2,096,703K
预留区域：0x52400  = 329K
硬件使用：0x10000  = 64K
没能找到：0xE000 = 56K

msadsc_t 结构体大小为 40，使用内存总计为：
2,096,703K/4K*40=20,967,030 = 接近 20M

3、1G 内存情况如下
理论内存：0x4000 0000= 1,048,576K
可用内存：0x3ff8fc00 = 1,048,127K
预留区域：0x52400  = 329K
硬件使用：0x10000  = 64K
没能找到：0xE000 = 56K

msadsc_t 结构体大小为 40，使用内存总计为：
1,048,127K/4K*40=10,481,270 = 接近 10M

三、如果想节约 msadsc_t 内存的话，感觉有几种方案：
1、最简单的方法，就是大内存时采用更大的分页，但应用在申请内存时，同样会有更多内存浪费
2、也可以用更复杂的页面管理机制，比如相同属性的连续页面不要用多个单独 msadsc_t 表示，而用一个 msadsc_t 表示并标明其范围，并通过 skiplist 等数据结构加速查询。但无论是申请内存还是归还内存时，性能会有所下降，感觉得不偿失。
3、页面分组情况较少的时候，可以通过每个组建立一个链表记录哪些页面属于某个链表，而 msadsc_t 中只记录地址等少量信息，不适合复杂系统。</div><div><p>作者回复：大神 6666</p></div><div><div>2021-06-17</div><div><div><i></i><span>5</span></div><div><i></i><span>19</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/17/ba/6a/5a0bb648.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 黄光华</span></div></div><div>老师，我觉得这个类、变量的命名可读性，还是非常非常重要的
这个项目是您手写的，每一个命名什么意思，你了然于胸
但是我们都是新手，很多变量命名真的太简略了，有很多命名就算琢磨也不一定能知道是什么意思。
真心建议命名可读性还是要增强一下哈～～</div><div><p>作者回复：好的 </p></div><div><div>2021-09-02</div><div><div><i></i></div><div><i></i><span>16</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2a/03/b8/72294f1e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 朱炜敏</span></div></div><div>老师，初始化这些数据结构的过程跟行为，让我想到了自己在电脑上装上 4G 内存条后，上电后发现系统反馈的可用内存一般只有 3.8G 左右。
是不是类似的，消失的几百兆内存里，存放的就是这些页管理的数据结构？</div><div><p>作者回复：还有内核 的其它数据   但 32 位下 只能使用 2.8GB</p></div><div><div>2021-11-04</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>pedro</span></div></div><div>胡乱一猜～

msadsc_t  占用内存 = 4GB/4KB (页大小) * sizeof (msadsc_t )</div><div><p>作者回复：是的 </p></div><div><div>2021-06-16</div><div><div><i></i><span>3</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/27/ef/ea/ab7612da.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 浮生尽歇</span></div></div><div>怎么调试内核呢？</div><div><p>作者回复: KPrint</p></div><div><div>2021-11-14</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1e/56/3c/f9ff3ed8.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 杨军</span></div></div><div>这一讲的内容、概念很多，尤其是内存页合并到内存区的代码不好理解，建议大家把 16 讲的内存页面组织结构图放在手边，对照代码多看几次慢慢就有感觉了，加油，过了内存管理这道坎，就看见胜利的曙光了</div><div><p>作者回复：哈哈 </p></div><div><div>2021-09-19</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/d4MHbXBwovYHW7xA18j88ibw1wS2R1JCoH5oLJIMUTdXe07dyVeTNWNzqWUKT7nPg21oClPhy1rSZPFiaibHeUFBA/132"></div></div><div><div><div><span>Geek_a5edac</span></div></div><div>代码的命名，不太好懂，能说下命名规则么，一些看很久才知道是哪些缩写</div><div><p>作者回复：不需要搞懂的，不要陷入名词概念之中</p></div><div><div>2021-07-24</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2e/31/3c/d23f3fa5.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 小李飞刀</span></div></div><div>大佬的这个变量命名是真的把我看懵了。。。</div><div><p>作者回复：哈哈</p></div><div><div>2022-06-25</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/9f/be/14b2ad2e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 卖薪沽酒</span></div></div><div>// 根据地址连续的 msadsc_t 结构的数量查找合适 bafhlst_t 结构
bafhlst_t *find_continumsa_inbafhlst (memarea_t *mareap, uint_t fmnr)
{
	bafhlst_t *retbafhp = NULL;
	uint_t in = 0;
	if (NULL == mareap || 0 == fmnr)			// 检查判断
	{
		return NULL;
	}

	if (MA_TYPE_PROC == mareap-&gt;ma_type)		//TODO 如果是用户区， 直接返回第一个？， 这里不太懂
	{
		return &amp;mareap-&gt;ma_mdmdata.dm_onemsalst;
	}
	if (MA_TYPE_SHAR == mareap-&gt;ma_type)		// 如果是共享区，直接返回 null
	{
		return NULL;
	}

这里的用户区为啥直接返回的是第一个， 不用做类似内核区的判断</div><div><p>作者回复：因为用户区总是一次分配一个页面</p></div><div><div>2022-06-21</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/25/9f/be/14b2ad2e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>卖薪沽酒</span></div></div><div>//mbsp-&gt;mb_krlinitstack &amp; (~(0xfffUL)) 取得是高 52 位，低 12 位全部之置为 0，
	// TODO mbsp-&gt;mb_krlinitstack 作为结束地址的
	retschmnr = search_segment_occupymsadsc (msadstat, msanr, mbsp-&gt;mb_krlinitstack &amp; (~(0xfffUL)), mbsp-&gt;mb_krlinitstack);========================================================= 这里的结束地址为啥不是 mb_krlinitstack + 栈的大小的， 这里不太懂， </div><div><p>作者回复：栈是向下伸长的</p></div><div><div>2022-06-21</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2d/06/30/c26ea06a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>艾恩凝</span></div></div><div>打卡，函数一步步的分析到位，函数搞清逻辑，花了三个下午，再花一个晚上的时间整理一下，参数命名是真的影响阅读，只能联系上下文了</div><div><p>作者回复：哈哈</p></div><div><div>2022-04-13</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>if...else...</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>大家都能看懂代码？</div><div><p>作者回复：代码难度有点点大</p></div><div><div>2022-02-14</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/2c/2b/e5/e276fc41.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>秋宇雨</span></div></div><div>u1s1，代码命名真心看晕了</div><div><p>编辑回复：攻略：关注下这些代码要实现的功能是啥。还是死磕不出来的展开说说，大家一起讨论解决。</p></div><div><div>2022-01-28</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoXoqDLvF3l8OzIwDBVlbgZ2FtbPFoncicFjQPqMFkKqdG5BnRVIxxrN40zUhTkynsd6yLhqqYiblAQ/132"></div></div><div><div><div><span>任国宁</span></div></div><div>hi，有一个疑问，在启动初始化的时候 mmu 设置的每页 2MB 大小，到内核怎么变成 4KB 了，而且看源码里 copy 页表数据的代码也是 2MB</div><div><p>作者回复：启动初始化用 2MB 页是为了简化开发</p></div><div><div>2022-01-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/e2/7e/ffde572d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>PAWCOOK</span></div></div><div>请问 BIOS 中断表占用的内存有必要处理吗？我们不是已经设置好了自己的中断门描述符吗？而且，只处理 BIOS 中断表占用的空间有什么用呢，BIOS 中断服务程序不也占用了内存吗</div><div><p>作者回复：要处理 因为后期要有用的</p></div><div><div>2021-11-29</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/e2/7e/ffde572d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>PAWCOOK</span></div></div><div>kmachbsp 变量的地址是虚拟地址表示的（因为它是长模式下的全局变量），而其中保存的信息却是物理地址。请问这样理解是对的吗？</div><div><p>作者回复：嗯嗯  有的是物理地址 而有些不是</p></div><div><div>2021-11-29</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/bb/98/db72a54a.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>琥珀・</span></div></div><div>扫描 phymmarge_t 结构体数组中的信息，只要它的类型是可用内存，就建立一个 msadsc_t 结构体，并把其中的开始地址作为第一个页面地址。

这里已经把其中的开始地址作为第一个页面地址，那 msadsc_t 这个结构体存放在哪里呢？</div><div><p>作者回复：放在内核后面，初始化时指定了 </p></div><div><div>2021-11-24</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span>Geek_260041</span></div></div><div>老师请问，合并内存页到内存区这里，uint_t merlove_setallmarflgs_onmemarea (memarea_t *mareap, msadsc_t *mstat, uint_t msanr) 这个函数里，在最后 for 循环时，为什么要使用页信息结构 (msadsc_t) 里分配的物理地址去和某个区段逻辑地址去比较啊，这样第一个区 (硬件区) 还可以正常分配，第二个区 (内核区) 就直接会把所有页都分配到内核区了吧，第三个区就完全分配不到一个页了</div><div><p>作者回复：代码是这样的逻辑 第三个区分配不到 就会到第二个区。。。 </p></div><div><div>2021-10-29</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/8e/41/709e9677.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>袁帅</span></div></div><div>一点也看不懂啊😪</div><div><p>编辑回复：内存这部分比较难，有什么地方不懂可以具体提问的。</p></div><div><div>2021-10-20</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>沈畅</span></div></div><div>每个分区都要遍历一次所有的页面结构是不是有点不合理？</div><div><p>作者回复：当然有更高效的方法 只是这很简单</p></div><div><div>2021-09-06</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1j"><outline class="toc-level-h1" data-reactid=".1j.0" style="width: 175px;"><active data-reactid=".1j.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1j.0.1"><span data-reactid=".1j.0.1.0">17 | 划分土地（中）：如何实现内存页面初始化？</span></a></outline><outline class="toc-level-h2" data-reactid=".1j.1" style="width: 165px;"><active data-reactid=".1j.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1j.1.1"><span data-reactid=".1j.1.1.0">初始化</span></a></outline><outline class="toc-level-h3" data-reactid=".1j.2" style="width: 155px;"><active data-reactid=".1j.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1j.2.1"><span data-reactid=".1j.2.1.0">内存页结构初始化</span></a></outline><outline class="toc-level-h3" data-reactid=".1j.3" style="width: 155px;"><active data-reactid=".1j.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1j.3.1"><span data-reactid=".1j.3.1.0">内存区结构初始化</span></a></outline><outline class="toc-level-h3" data-reactid=".1j.4" style="width: 155px;"><active data-reactid=".1j.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1j.4.1"><span data-reactid=".1j.4.1.0">处理初始内存占用问题</span></a></outline><outline class="toc-level-h3" data-reactid=".1j.5" style="width: 155px;"><active data-reactid=".1j.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1j.5.1"><span data-reactid=".1j.5.1.0">合并内存页到内存区</span></a></outline><outline class="toc-level-h3" data-reactid=".1j.6" style="width: 155px;"><active data-reactid=".1j.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1j.6.1"><span data-reactid=".1j.6.1.0">初始化汇总</span></a></outline><outline class="toc-level-h2" data-reactid=".1j.7" style="width: 165px;"><active data-reactid=".1j.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1j.7.1"><span data-reactid=".1j.7.1.0">重点回顾</span></a></outline><outline class="toc-level-h2" data-reactid=".1j.8" style="width: 165px;"><active data-reactid=".1j.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1j.8.1"><span data-reactid=".1j.8.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".1j.9" style="width: 165px;"><active data-reactid=".1j.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1j.9.1"><span data-reactid=".1j.9.1.0">精选留言 (25)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/384772" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>