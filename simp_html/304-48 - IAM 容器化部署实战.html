
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 48 | IAM 容器化部署实战</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>48 | IAM 容器化部署实战</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">每种语言通常都有自己的测试包 / 模块，Go 语言也不例外。在 Go 中，我们可以通过 testing 包对代码进行单元测试和性能测试。今天，我会用一些示</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 48 | IAM 容器化部署实战</h1><div><span>孔令飞</span> <span> 2021-09-16</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/75/06/75fab8aa85c196708bb21858d371b306.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：孔令飞</span><span>大小：14.42M</span><span> 时长：15:47</span></div></div><audio title="48 | IAM 容器化部署实战" src="https://res001.geekbang.org/media/audio/11/f7/119a19c72ded45ee09c7f703351721f7/ld/ld.m3u8" __idm_id__="327693"></audio></div><div><div><div><div data-slate-editor="true" data-key="11805" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="11806"><span data-slate-object="text" data-key="11807"><span data-slate-leaf="true" data-offset-key="11807:0" data-first-offset="true"><span data-slate-string="true">你好，我是孔令飞。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11808"><span data-slate-object="text" data-key="11809"><span data-slate-leaf="true" data-offset-key="11809:0" data-first-offset="true"><span data-slate-string="true">在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11810"><span data-slate-object="text" data-key="11811"><span data-slate-leaf="true" data-offset-key="11811:0" data-first-offset="true"><span data-slate-string="true">45 讲</span></span></span></a><span data-slate-object="text" data-key="11812"><span data-slate-leaf="true" data-offset-key="11812:0" data-first-offset="true"><span data-slate-string="true">中，我介绍了一种基于 Kubernetes 的云原生架构设计方案。在云原生架构中，我们是通过 Docker + Kubernetes 来部署云原生应用的。那么这一讲，我就手把手教你如何在 Kubernetes 集群中部署好 IAM 应用。因为步骤比较多，所以希望你能跟着我完成每一个操作步骤。相信在实操的过程中，你也会学到更多的知识。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="11813" id="sr-toc-1"><span data-slate-object="text" data-key="11814"><span data-slate-leaf="true" data-offset-key="11814:0" data-first-offset="true"><span data-slate-string="true">准备工作</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="11815"><span data-slate-object="text" data-key="11816"><span data-slate-leaf="true" data-offset-key="11816:0" data-first-offset="true"><span data-slate-string="true">在部署 IAM 应用之前，我们需要做以下准备工作：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="11817"><div data-slate-type="list-line" data-slate-object="block" data-key="11818"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="11819"><span data-slate-leaf="true" data-offset-key="11819:0" data-first-offset="true"><span data-slate-string="true">开通腾讯云容器服务镜像仓库。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11820"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="11821"><span data-slate-leaf="true" data-offset-key="11821:0" data-first-offset="true"><span data-slate-string="true">安装并配置 Docker。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11822"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="11823"><span data-slate-leaf="true" data-offset-key="11823:0" data-first-offset="true"><span data-slate-string="true">准备一个 Kubernetes 集群。</span></span></span></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11824" id="sr-toc-2"><span data-slate-object="text" data-key="11825"><span data-slate-leaf="true" data-offset-key="11825:0" data-first-offset="true"><span data-slate-string="true">开通腾讯云容器服务镜像仓库</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11826"><span data-slate-object="text" data-key="11827"><span data-slate-leaf="true" data-offset-key="11827:0" data-first-offset="true"><span data-slate-string="true">在 Kubernetes 集群中部署 IAM 应用，需要从镜像仓库下载指定的 IAM 镜像，所以首先需要有一个镜像仓库来托管 IAM 的镜像。我们可以选择将 IAM 镜像托管到 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11828"><span data-slate-object="text" data-key="11829"><span data-slate-leaf="true" data-offset-key="11829:0" data-first-offset="true"><span data-slate-string="true">DockerHub</span></span></span></a><span data-slate-object="text" data-key="11830"><span data-slate-leaf="true" data-offset-key="11830:0" data-first-offset="true"><span data-slate-string="true"> 上，这也是 docker 运行时默认获取镜像的地址。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11831"><span data-slate-object="text" data-key="11832"><span data-slate-leaf="true" data-offset-key="11832:0" data-first-offset="true"><span data-slate-string="true">但因为 DockerHub 服务部署在国外，国内访问速度很慢。所以，我建议将 IAM 镜像托管在国内的镜像仓库中。这里我们可以选择腾讯云提供的镜像仓库服务，访问地址为</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11833"><span data-slate-object="text" data-key="11834"><span data-slate-leaf="true" data-offset-key="11834:0" data-first-offset="true"><span data-slate-string="true">容器镜像服务个人版</span></span></span></a><span data-slate-object="text" data-key="11835"><span data-slate-leaf="true" data-offset-key="11835:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11836"><span data-slate-object="text" data-key="11837"><span data-slate-leaf="true" data-offset-key="11837:0" data-first-offset="true"><span data-slate-string="true">如果你已经有腾讯云的镜像仓库，可以忽略腾讯云镜像仓库开通步骤。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11838"><span data-slate-object="text" data-key="11839"><span data-slate-leaf="true" data-offset-key="11839:0" data-first-offset="true"><span data-slate-string="true">在开通腾讯云镜像仓库之前，你需要</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11840"><span data-slate-object="text" data-key="11841"><span data-slate-leaf="true" data-offset-key="11841:0" data-first-offset="true"><span data-slate-string="true">注册腾讯云账号</span></span></span></a><span data-slate-object="text" data-key="11842"><span data-slate-leaf="true" data-offset-key="11842:0" data-first-offset="true"><span data-slate-string="true">，并完成</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11843"><span data-slate-object="text" data-key="11844"><span data-slate-leaf="true" data-offset-key="11844:0" data-first-offset="true"><span data-slate-string="true">实名认证</span></span></span></a><span data-slate-object="text" data-key="11845"><span data-slate-leaf="true" data-offset-key="11845:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11846"><span data-slate-object="text" data-key="11847"><span data-slate-leaf="true" data-offset-key="11847:0" data-first-offset="true"><span data-slate-string="true">开通腾讯云镜像仓库的具体步骤如下：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11848"><span data-slate-object="text" data-key="11849"><span data-slate-leaf="true" data-offset-key="11849:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一步，开通个人版镜像仓库。</span></span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="11850"><div data-slate-type="list-line" data-slate-object="block" data-key="11851"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="11852"><span data-slate-leaf="true" data-offset-key="11852:0" data-first-offset="true"><span data-slate-string="true">登录</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11853"><span data-slate-object="text" data-key="11854"><span data-slate-leaf="true" data-offset-key="11854:0" data-first-offset="true"><span data-slate-string="true">容器服务控制台</span></span></span></a><span data-slate-object="text" data-key="11855"><span data-slate-leaf="true" data-offset-key="11855:0" data-first-offset="true"><span data-slate-string="true">，选择左侧导航栏中的【镜像仓库】&gt;【</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11856"><span data-slate-object="text" data-key="11857"><span data-slate-leaf="true" data-offset-key="11857:0" data-first-offset="true"><span data-slate-string="true">个人版</span></span></span></a><span data-slate-object="text" data-key="11858"><span data-slate-leaf="true" data-offset-key="11858:0" data-first-offset="true"><span data-slate-string="true">】。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="11859"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="11860"><span data-slate-leaf="true" data-offset-key="11860:0" data-first-offset="true"><span data-slate-string="true">根据以下提示，填写相关信息，并单击</span></span></span><span data-slate-object="text" data-key="11861"><span data-slate-leaf="true" data-offset-key="11861:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">【开通】</span></span></span></span><span data-slate-object="text" data-key="11862"><span data-slate-leaf="true" data-offset-key="11862:0" data-first-offset="true"><span data-slate-string="true">进行初始化。如下图所示：</span></span></span></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="11863"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1d/8c/1d4bdfe89bc049d224e7002c23a0ea8c.png?wh=1920x569"></div></div><div data-slate-type="list" data-slate-object="block" data-key="11864"><div data-slate-type="list-line" data-slate-object="block" data-key="11865"><span data-slate-object="text" data-key="11866"><span data-slate-leaf="true" data-offset-key="11866:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">用户名：</span></span></span></span><span data-slate-object="text" data-key="11867"><span data-slate-leaf="true" data-offset-key="11867:0" data-first-offset="true"><span data-slate-string="true">默认是当前用户的账号 ID，是你登录到腾讯云 Docker 镜像仓库的身份，可在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11868"><span data-slate-object="text" data-key="11869"><span data-slate-leaf="true" data-offset-key="11869:0" data-first-offset="true"><span data-slate-string="true">账号信息</span></span></span></a><span data-slate-object="text" data-key="11870"><span data-slate-leaf="true" data-offset-key="11870:0" data-first-offset="true"><span data-slate-string="true"> 页面获取。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="11871"><span data-slate-object="text" data-key="11872"><span data-slate-leaf="true" data-offset-key="11872:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">密码：</span></span></span></span><span data-slate-object="text" data-key="11873"><span data-slate-leaf="true" data-offset-key="11873:0" data-first-offset="true"><span data-slate-string="true">是你登录到腾讯云 Docker 镜像仓库的凭证。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11874"><span data-slate-object="text" data-key="11875"><span data-slate-leaf="true" data-offset-key="11875:0" data-first-offset="true"><span data-slate-string="true">这里需要你记录用户名及密码，用于推送及拉取镜像。假如我们开通的镜像仓库，用户名为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11876"><span data-slate-object="text" data-key="11877"><span data-slate-leaf="true" data-offset-key="11877:0" data-first-offset="true"><span data-slate-string="true"> 10000099xxxx</span></span></span></span><span data-slate-object="text" data-key="11878"><span data-slate-leaf="true" data-offset-key="11878:0" data-first-offset="true"><span data-slate-string="true">，密码为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11879"><span data-slate-object="text" data-key="11880"><span data-slate-leaf="true" data-offset-key="11880:0" data-first-offset="true"><span data-slate-string="true"> iam59!z$</span></span></span></span><span data-slate-object="text" data-key="11881"><span data-slate-leaf="true" data-offset-key="11881:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11882"><span data-slate-object="text" data-key="11883"><span data-slate-leaf="true" data-offset-key="11883:0" data-first-offset="true"><span data-slate-string="true">这里要注意，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11884"><span data-slate-object="text" data-key="11885"><span data-slate-leaf="true" data-offset-key="11885:0" data-first-offset="true"><span data-slate-string="true">10000099xxxx</span></span></span></span><span data-slate-object="text" data-key="11886"><span data-slate-leaf="true" data-offset-key="11886:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 要替换成你镜像仓库的用户名。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11887"><span data-slate-object="text" data-key="11888"><span data-slate-leaf="true" data-offset-key="11888:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二步，登录到腾讯云 Registry</span></span></span></span><span data-slate-object="text" data-key="11889"><span data-slate-leaf="true" data-offset-key="11889:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">（镜像仓库）。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11890"><span data-slate-object="text" data-key="11891"><span data-slate-leaf="true" data-offset-key="11891:0" data-first-offset="true"><span data-slate-string="true">在我们开通完 Registry，就可以登录 Registry 了。可以通过以下命令来登录腾讯云 Registry：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="11892"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11893"><span data-slate-object="text" data-key="11894"><span data-slate-leaf="true" data-offset-key="11894:0" data-first-offset="true"><span data-slate-string="true">$ docker login --username=[username] ccr.ccs.tencentyun.com</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11895"><span data-slate-object="text" data-key="11896"><span data-slate-leaf="true" data-offset-key="11896:0" data-first-offset="true"><span data-slate-string="true">这里的 username 是腾讯云账号 ID，开通时已注册，可在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="11897"><span data-slate-object="text" data-key="11898"><span data-slate-leaf="true" data-offset-key="11898:0" data-first-offset="true"><span data-slate-string="true">账号信息</span></span></span></a><span data-slate-object="text" data-key="11899"><span data-slate-leaf="true" data-offset-key="11899:0" data-first-offset="true"><span data-slate-string="true"> 页面获取。docker 命令会在后面安装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11900"><span data-slate-object="text" data-key="11901"><span data-slate-leaf="true" data-offset-key="11901:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第三步，新建镜像仓库命名空间</span></span></span></span><span data-slate-object="text" data-key="11902"><span data-slate-leaf="true" data-offset-key="11902:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11903"><span data-slate-object="text" data-key="11904"><span data-slate-leaf="true" data-offset-key="11904:0" data-first-offset="true"><span data-slate-string="true">如果想使用镜像仓库，那么你首先需要创建一个用来创建镜像的命名空间。上一步，我们开通了镜像仓库，就可以在 “命名空间” 页签新建命名空间了，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11905"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1e/5a/1e79852fdc5ee1a094bd42efdf21015a.png?wh=1920x522"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11906"><span data-slate-object="text" data-key="11907"><span data-slate-leaf="true" data-offset-key="11907:0" data-first-offset="true"><span data-slate-string="true">上图中，我们创建了一个叫</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11908"><span data-slate-object="text" data-key="11909"><span data-slate-leaf="true" data-offset-key="11909:0" data-first-offset="true"><span data-slate-string="true"> marmotedu</span></span></span></span><span data-slate-object="text" data-key="11910"><span data-slate-leaf="true" data-offset-key="11910:0" data-first-offset="true"><span data-slate-string="true"> 的命名空间。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11911"><span data-slate-object="text" data-key="11912"><span data-slate-leaf="true" data-offset-key="11912:0" data-first-offset="true"><span data-slate-string="true">这里，镜像仓库服务、命名空间、镜像仓库、标签这几个概念你可能弄不清楚。接下来，我详细介绍下四者的关系，关系如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="11913"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ab/3b/abe8358d3ea2851bc32c80fd9519c63b.jpg?wh=2248x1581"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11914"><span data-slate-object="text" data-key="11915"><span data-slate-leaf="true" data-offset-key="11915:0" data-first-offset="true"><span data-slate-string="true">先来看下我们使用镜像仓库的格式：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11916"><span data-slate-object="text" data-key="11917"><span data-slate-leaf="true" data-offset-key="11917:0" data-first-offset="true"><span data-slate-string="true">&lt;镜像仓库服务地址&gt;/&lt; 命名空间 &gt;/&lt; 镜像仓库 &gt;:&lt; 标签 &gt;</span></span></span></span><span data-slate-object="text" data-key="11918"><span data-slate-leaf="true" data-offset-key="11918:0" data-first-offset="true"><span data-slate-string="true">，例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11919"><span data-slate-object="text" data-key="11920"><span data-slate-leaf="true" data-offset-key="11920:0" data-first-offset="true"><span data-slate-string="true"> ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:v1.1.0</span></span></span></span><span data-slate-object="text" data-key="11921"><span data-slate-leaf="true" data-offset-key="11921:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11922"><span data-slate-object="text" data-key="11923"><span data-slate-leaf="true" data-offset-key="11923:0" data-first-offset="true"><span data-slate-string="true">如果想使用一个 Docker 镜像，我们首先需要开通一个镜像仓库服务（Registry），镜像仓库服务都会对外提供一个固定的地址供你访问。在 Registry 中，我们（User）可以创建一个或多个命名空间（Namespace），命名空间也可以简单理解为镜像仓库逻辑上的一个分组。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11924"><span data-slate-object="text" data-key="11925"><span data-slate-leaf="true" data-offset-key="11925:0" data-first-offset="true"><span data-slate-string="true">接下来，就可以在 Namespace 中创建一个或多个镜像仓库，例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11926"><span data-slate-object="text" data-key="11927"><span data-slate-leaf="true" data-offset-key="11927:0" data-first-offset="true"><span data-slate-string="true"> iam-apiserver-amd64</span></span></span></span><span data-slate-object="text" data-key="11928"><span data-slate-leaf="true" data-offset-key="11928:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11929"><span data-slate-object="text" data-key="11930"><span data-slate-leaf="true" data-offset-key="11930:0" data-first-offset="true"><span data-slate-string="true">iam-authz-server-amd64</span></span></span></span><span data-slate-object="text" data-key="11931"><span data-slate-leaf="true" data-offset-key="11931:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11932"><span data-slate-object="text" data-key="11933"><span data-slate-leaf="true" data-offset-key="11933:0" data-first-offset="true"><span data-slate-string="true">iam-pump-amd64</span></span></span></span><span data-slate-object="text" data-key="11934"><span data-slate-leaf="true" data-offset-key="11934:0" data-first-offset="true"><span data-slate-string="true"> 等。针对每一个镜像仓库，又可以创建多个标签（Tag），例如</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11935"><span data-slate-object="text" data-key="11936"><span data-slate-leaf="true" data-offset-key="11936:0" data-first-offset="true"><span data-slate-string="true"> v1.0.1</span></span></span></span><span data-slate-object="text" data-key="11937"><span data-slate-leaf="true" data-offset-key="11937:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11938"><span data-slate-object="text" data-key="11939"><span data-slate-leaf="true" data-offset-key="11939:0" data-first-offset="true"><span data-slate-string="true">v1.0.2</span></span></span></span><span data-slate-object="text" data-key="11940"><span data-slate-leaf="true" data-offset-key="11940:0" data-first-offset="true"><span data-slate-string="true"> 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11941"><span data-slate-type="code" data-slate-object="inline" data-key="11942"><span data-slate-object="text" data-key="11943"><span data-slate-leaf="true" data-offset-key="11943:0" data-first-offset="true"><span data-slate-string="true">&lt;镜像仓库&gt;:&lt; 标签 &gt;</span></span></span></span><span data-slate-object="text" data-key="11944"><span data-slate-leaf="true" data-offset-key="11944:0" data-first-offset="true"><span data-slate-string="true"> 又称为镜像。镜像又分为私有镜像和公有镜像，公有镜像可供所有能访问 Registry 的用户下载使用，私有镜像只提供给通过授权的用户使用。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="11945" id="sr-toc-3"><span data-slate-object="text" data-key="11946"><span data-slate-leaf="true" data-offset-key="11946:0" data-first-offset="true"><span data-slate-string="true">安装 Docker</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="11947"><span data-slate-object="text" data-key="11948"><span data-slate-leaf="true" data-offset-key="11948:0" data-first-offset="true"><span data-slate-string="true">开通完镜像仓库之后，我们还需要安装 Docker，用来构建和测试 Docker 镜像。下面我来讲解下具体的安装步骤。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11949"><span data-slate-object="text" data-key="11950"><span data-slate-leaf="true" data-offset-key="11950:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一步，安装 Docker 前置条件检查。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11951"><span data-slate-object="text" data-key="11952"><span data-slate-leaf="true" data-offset-key="11952:0" data-first-offset="true"><span data-slate-string="true">需要确保 CentOS 系统启用了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11953"><span data-slate-object="text" data-key="11954"><span data-slate-leaf="true" data-offset-key="11954:0" data-first-offset="true"><span data-slate-string="true"> centos-extras</span></span></span></span><span data-slate-object="text" data-key="11955"><span data-slate-leaf="true" data-offset-key="11955:0" data-first-offset="true"><span data-slate-string="true"> yum 源，默认情况下已经启用，检查方式如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="11956"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="11957"><span data-slate-object="text" data-key="11958"><span data-slate-leaf="true" data-offset-key="11958:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="11959"><span data-slate-leaf="true" data-offset-key="11959:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cat</span></span></span></span><span data-slate-object="text" data-key="11960"><span data-slate-leaf="true" data-offset-key="11960:0" data-first-offset="true"><span data-slate-string="true"> /etc/yum.repos.d/CentOS-Extras.repo</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11961"><span data-slate-object="text" data-key="11962"><span data-slate-leaf="true" data-offset-key="11962:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># Qcloud-Extras.repo</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11963"></div><div data-slate-type="code-line" data-slate-object="block" data-key="11964"><span data-slate-object="text" data-key="11965"><span data-slate-leaf="true" data-offset-key="11965:0" data-first-offset="true"><span data-slate-string="true">[extras]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11966"><span data-slate-object="text" data-key="11967"><span data-slate-leaf="true" data-offset-key="11967:0" data-first-offset="true"><span data-slate-string="true">name=Qcloud-</span></span></span><span data-slate-object="text" data-key="11968"><span data-slate-leaf="true" data-offset-key="11968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$releasever</span></span></span></span><span data-slate-object="text" data-key="11969"><span data-slate-leaf="true" data-offset-key="11969:0" data-first-offset="true"><span data-slate-string="true"> - Extras</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11970"><span data-slate-object="text" data-key="11971"><span data-slate-leaf="true" data-offset-key="11971:0" data-first-offset="true"><span data-slate-string="true">baseurl=http://mirrors.tencentyun.com/centos/</span></span></span><span data-slate-object="text" data-key="11972"><span data-slate-leaf="true" data-offset-key="11972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$releasever</span></span></span></span><span data-slate-object="text" data-key="11973"><span data-slate-leaf="true" data-offset-key="11973:0" data-first-offset="true"><span data-slate-string="true">/extras/</span></span></span><span data-slate-object="text" data-key="11974"><span data-slate-leaf="true" data-offset-key="11974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$basearch</span></span></span></span><span data-slate-object="text" data-key="11975"><span data-slate-leaf="true" data-offset-key="11975:0" data-first-offset="true"><span data-slate-string="true">/os/</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11976"><span data-slate-object="text" data-key="11977"><span data-slate-leaf="true" data-offset-key="11977:0" data-first-offset="true"><span data-slate-string="true">gpgcheck=1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11978"><span data-slate-object="text" data-key="11979"><span data-slate-leaf="true" data-offset-key="11979:0" data-first-offset="true"><span data-slate-string="true">enabled=1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="11980"><span data-slate-object="text" data-key="11981"><span data-slate-leaf="true" data-offset-key="11981:0" data-first-offset="true"><span data-slate-string="true">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Qcloud-8</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="11982"><span data-slate-object="text" data-key="11983"><span data-slate-leaf="true" data-offset-key="11983:0" data-first-offset="true"><span data-slate-string="true">如果</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11984"><span data-slate-object="text" data-key="11985"><span data-slate-leaf="true" data-offset-key="11985:0" data-first-offset="true"><span data-slate-string="true"> /etc/yum.repos.d/CentOS-Extras.repo</span></span></span></span><span data-slate-object="text" data-key="11986"><span data-slate-leaf="true" data-offset-key="11986:0" data-first-offset="true"><span data-slate-string="true"> 文件存在，且文件中</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11987"><span data-slate-object="text" data-key="11988"><span data-slate-leaf="true" data-offset-key="11988:0" data-first-offset="true"><span data-slate-string="true"> extras</span></span></span></span><span data-slate-object="text" data-key="11989"><span data-slate-leaf="true" data-offset-key="11989:0" data-first-offset="true"><span data-slate-string="true"> 部分的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11990"><span data-slate-object="text" data-key="11991"><span data-slate-leaf="true" data-offset-key="11991:0" data-first-offset="true"><span data-slate-string="true"> enabled</span></span></span></span><span data-slate-object="text" data-key="11992"><span data-slate-leaf="true" data-offset-key="11992:0" data-first-offset="true"><span data-slate-string="true"> 配置项值为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11993"><span data-slate-object="text" data-key="11994"><span data-slate-leaf="true" data-offset-key="11994:0" data-first-offset="true"><span data-slate-string="true"> 1</span></span></span></span><span data-slate-object="text" data-key="11995"><span data-slate-leaf="true" data-offset-key="11995:0" data-first-offset="true"><span data-slate-string="true">，说明已经启用了</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11996"><span data-slate-object="text" data-key="11997"><span data-slate-leaf="true" data-offset-key="11997:0" data-first-offset="true"><span data-slate-string="true"> centos-extras</span></span></span></span><span data-slate-object="text" data-key="11998"><span data-slate-leaf="true" data-offset-key="11998:0" data-first-offset="true"><span data-slate-string="true"> yum 源。如果</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="11999"><span data-slate-object="text" data-key="12000"><span data-slate-leaf="true" data-offset-key="12000:0" data-first-offset="true"><span data-slate-string="true"> /etc/yum.repos.d/CentOS-Extras.repo</span></span></span></span><span data-slate-object="text" data-key="12001"><span data-slate-leaf="true" data-offset-key="12001:0" data-first-offset="true"><span data-slate-string="true"> 文件不存在，或者</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12002"><span data-slate-object="text" data-key="12003"><span data-slate-leaf="true" data-offset-key="12003:0" data-first-offset="true"><span data-slate-string="true"> enabled</span></span></span></span><span data-slate-object="text" data-key="12004"><span data-slate-leaf="true" data-offset-key="12004:0" data-first-offset="true"><span data-slate-string="true"> 不为 1，则需要创建</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12005"><span data-slate-object="text" data-key="12006"><span data-slate-leaf="true" data-offset-key="12006:0" data-first-offset="true"><span data-slate-string="true"> /etc/yum.repos.d/CentOS-Extras.repo</span></span></span></span><span data-slate-object="text" data-key="12007"><span data-slate-leaf="true" data-offset-key="12007:0" data-first-offset="true"><span data-slate-string="true"> 文件，并将上述内容复制进去。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12008"><span data-slate-object="text" data-key="12009"><span data-slate-leaf="true" data-offset-key="12009:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二步，安装 docker。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12010"><span data-slate-object="text" data-key="12011"><span data-slate-leaf="true" data-offset-key="12011:0" data-first-offset="true"><span data-slate-string="true">Docker 官方文档 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12012"><span data-slate-object="text" data-key="12013"><span data-slate-leaf="true" data-offset-key="12013:0" data-first-offset="true"><span data-slate-string="true">Install Docker Engine on CentOS</span></span></span></a><span data-slate-object="text" data-key="12014"><span data-slate-leaf="true" data-offset-key="12014:0" data-first-offset="true"><span data-slate-string="true"> 提供了 3 种安装方法:</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12015"><div data-slate-type="list-line" data-slate-object="block" data-key="12016"><span data-slate-object="text" data-key="12017"><span data-slate-leaf="true" data-offset-key="12017:0" data-first-offset="true"><span data-slate-string="true">通过 Yum 源安装。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12018"><span data-slate-object="text" data-key="12019"><span data-slate-leaf="true" data-offset-key="12019:0" data-first-offset="true"><span data-slate-string="true">通过 RPM 包安装</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12020"><span data-slate-object="text" data-key="12021"><span data-slate-leaf="true" data-offset-key="12021:0" data-first-offset="true"><span data-slate-string="true">通过脚本安装。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12022"><span data-slate-object="text" data-key="12023"><span data-slate-leaf="true" data-offset-key="12023:0" data-first-offset="true"><span data-slate-string="true">这里，我们选择最简单的安装方式：</span></span></span><span data-slate-object="text" data-key="12024"><span data-slate-leaf="true" data-offset-key="12024:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">通过 Yum 源安装</span></span></span></span><span data-slate-object="text" data-key="12025"><span data-slate-leaf="true" data-offset-key="12025:0" data-first-offset="true"><span data-slate-string="true">。它具体又分为下面 3 个步骤。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12026"><div data-slate-type="list-line" data-slate-object="block" data-key="12027"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12028"><span data-slate-leaf="true" data-offset-key="12028:0" data-first-offset="true"><span data-slate-string="true">安装 docker。</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12029"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12030"><span data-slate-object="text" data-key="12031"><span data-slate-leaf="true" data-offset-key="12031:0" data-first-offset="true"><span data-slate-string="true">$ sudo yum install -y yum-utils </span></span></span><span data-slate-object="text" data-key="12032"><span data-slate-leaf="true" data-offset-key="12032:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 1. 安装 `yum-utils` 包，该包提供了 `yum-config-manager` 工具</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12033"><span data-slate-object="text" data-key="12034"><span data-slate-leaf="true" data-offset-key="12034:0" data-first-offset="true"><span data-slate-string="true">$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo </span></span></span><span data-slate-object="text" data-key="12035"><span data-slate-leaf="true" data-offset-key="12035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 2. 安装 `docker-ce.repo` yum 源</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12036"><span data-slate-object="text" data-key="12037"><span data-slate-leaf="true" data-offset-key="12037:0" data-first-offset="true"><span data-slate-string="true">$ sudo yum-config-manager --</span></span></span><span data-slate-object="text" data-key="12038"><span data-slate-leaf="true" data-offset-key="12038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">enable</span></span></span></span><span data-slate-object="text" data-key="12039"><span data-slate-leaf="true" data-offset-key="12039:0" data-first-offset="true"><span data-slate-string="true"> docker-ce-nightly docker-ce-test </span></span></span><span data-slate-object="text" data-key="12040"><span data-slate-leaf="true" data-offset-key="12040:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 3. 启用 `nightly` 和 `test` yum 源</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12041"><span data-slate-object="text" data-key="12042"><span data-slate-leaf="true" data-offset-key="12042:0" data-first-offset="true"><span data-slate-string="true">$ sudo yum install -y docker-ce docker-ce-cli containerd.io </span></span></span><span data-slate-object="text" data-key="12043"><span data-slate-leaf="true" data-offset-key="12043:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 4. 安装最新版本的 docker 引擎和 containerd</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12044"><div data-slate-type="list-line" data-slate-object="block" data-key="12045"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12046"><span data-slate-leaf="true" data-offset-key="12046:0" data-first-offset="true"><span data-slate-string="true">启动 docker。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12047"><span data-slate-object="text" data-key="12048"><span data-slate-leaf="true" data-offset-key="12048:0" data-first-offset="true"><span data-slate-string="true">可以通过以下命令来启动 docker：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12049"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12050"><span data-slate-object="text" data-key="12051"><span data-slate-leaf="true" data-offset-key="12051:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl start docker</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12052"><span data-slate-object="text" data-key="12053"><span data-slate-leaf="true" data-offset-key="12053:0" data-first-offset="true"><span data-slate-string="true">docker 的配置文件是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12054"><span data-slate-object="text" data-key="12055"><span data-slate-leaf="true" data-offset-key="12055:0" data-first-offset="true"><span data-slate-string="true">/etc/docker/daemon.json</span></span></span></span><span data-slate-object="text" data-key="12056"><span data-slate-leaf="true" data-offset-key="12056:0" data-first-offset="true"><span data-slate-string="true"> ，这个配置文件默认是没有的，需要我们手动创建：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12057"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12058"><span data-slate-object="text" data-key="12059"><span data-slate-leaf="true" data-offset-key="12059:0" data-first-offset="true"><span data-slate-string="true">$ sudo </span></span></span><span data-slate-object="text" data-key="12060"><span data-slate-leaf="true" data-offset-key="12060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">tee</span></span></span></span><span data-slate-object="text" data-key="12061"><span data-slate-leaf="true" data-offset-key="12061:0" data-first-offset="true"><span data-slate-string="true"> /etc/docker/daemon.json &lt;&lt; </span></span></span><span data-slate-object="text" data-key="12062"><span data-slate-leaf="true" data-offset-key="12062:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">EOF</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12063"><span data-slate-object="text" data-key="12064"><span data-slate-leaf="true" data-offset-key="12064:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12065"><span data-slate-object="text" data-key="12066"><span data-slate-leaf="true" data-offset-key="12066:0" data-first-offset="true"><span data-slate-string="true">  "bip": "172.16.0.1/24",</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12067"><span data-slate-object="text" data-key="12068"><span data-slate-leaf="true" data-offset-key="12068:0" data-first-offset="true"><span data-slate-string="true">  "registry-mirrors": [],</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12069"><span data-slate-object="text" data-key="12070"><span data-slate-leaf="true" data-offset-key="12070:0" data-first-offset="true"><span data-slate-string="true">  "graph": "/data/lib/docker"</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12071"><span data-slate-object="text" data-key="12072"><span data-slate-leaf="true" data-offset-key="12072:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12073"><span data-slate-object="text" data-key="12074"><span data-slate-leaf="true" data-offset-key="12074:0" data-first-offset="true"><span data-slate-string="true">EOF</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12075"><span data-slate-object="text" data-key="12076"><span data-slate-leaf="true" data-offset-key="12076:0" data-first-offset="true"><span data-slate-string="true">这里，我来解释下常用的配置参数。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12077"><div data-slate-type="list-line" data-slate-object="block" data-key="12078"><span data-slate-object="text" data-key="12079"><span data-slate-leaf="true" data-offset-key="12079:0" data-first-offset="true"><span data-slate-string="true">registry-mirrors：仓库地址，可以根据需要修改为指定的地址。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12080"><span data-slate-object="text" data-key="12081"><span data-slate-leaf="true" data-offset-key="12081:0" data-first-offset="true"><span data-slate-string="true">graph：镜像、容器的存储路径，默认是 /var/lib/docker。如果你的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12082"><span data-slate-object="text" data-key="12083"><span data-slate-leaf="true" data-offset-key="12083:0" data-first-offset="true"><span data-slate-string="true">/</span></span></span></span><span data-slate-object="text" data-key="12084"><span data-slate-leaf="true" data-offset-key="12084:0" data-first-offset="true"><span data-slate-string="true"> 目录存储空间满足不了需求，需要设置 graph 为更大的目录。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12085"><span data-slate-object="text" data-key="12086"><span data-slate-leaf="true" data-offset-key="12086:0" data-first-offset="true"><span data-slate-string="true">bip：指定容器的 IP 网段。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12087"><span data-slate-object="text" data-key="12088"><span data-slate-leaf="true" data-offset-key="12088:0" data-first-offset="true"><span data-slate-string="true">配置完成后，需要重启 Docker：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12089"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12090"><span data-slate-object="text" data-key="12091"><span data-slate-leaf="true" data-offset-key="12091:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl restart docker</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12092"><div data-slate-type="list-line" data-slate-object="block" data-key="12093"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="12094"><span data-slate-leaf="true" data-offset-key="12094:0" data-first-offset="true"><span data-slate-string="true">测试 Docker 是否安装成功。</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12095"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12096"><span data-slate-object="text" data-key="12097"><span data-slate-leaf="true" data-offset-key="12097:0" data-first-offset="true"><span data-slate-string="true">$ sudo docker run hello-world</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12098"><span data-slate-object="text" data-key="12099"><span data-slate-leaf="true" data-offset-key="12099:0" data-first-offset="true"><span data-slate-string="true">Unable to find image </span></span></span><span data-slate-object="text" data-key="12100"><span data-slate-leaf="true" data-offset-key="12100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'hello-world:latest'</span></span></span></span><span data-slate-object="text" data-key="12101"><span data-slate-leaf="true" data-offset-key="12101:0" data-first-offset="true"><span data-slate-string="true"> locally</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12102"><span data-slate-object="text" data-key="12103"><span data-slate-leaf="true" data-offset-key="12103:0" data-first-offset="true"><span data-slate-string="true">latest: Pulling from library/hello-world</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12104"><span data-slate-object="text" data-key="12105"><span data-slate-leaf="true" data-offset-key="12105:0" data-first-offset="true"><span data-slate-string="true">b8dfde127a29: Pull complete</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12106"><span data-slate-object="text" data-key="12107"><span data-slate-leaf="true" data-offset-key="12107:0" data-first-offset="true"><span data-slate-string="true">Digest: sha256:0fe98d7debd9049c50b597ef1f85b7c1e8cc81f59c8d623fcb2250e8bec85b38</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12108"><span data-slate-object="text" data-key="12109"><span data-slate-leaf="true" data-offset-key="12109:0" data-first-offset="true"><span data-slate-string="true">Status: Downloaded newer image </span></span></span><span data-slate-object="text" data-key="12110"><span data-slate-leaf="true" data-offset-key="12110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="12111"><span data-slate-leaf="true" data-offset-key="12111:0" data-first-offset="true"><span data-slate-string="true"> hello-world:latest</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12112"><span data-slate-object="text" data-key="12113"><span data-slate-leaf="true" data-offset-key="12113:0" data-first-offset="true"><span data-slate-string="true">...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12114"><span data-slate-object="text" data-key="12115"><span data-slate-leaf="true" data-offset-key="12115:0" data-first-offset="true"><span data-slate-string="true">Hello from Docker!</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12116"><span data-slate-object="text" data-key="12117"><span data-slate-leaf="true" data-offset-key="12117:0" data-first-offset="true"><span data-slate-string="true">This message shows that your installation appears to be working correctly.</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12118"><span data-slate-object="text" data-key="12119"><span data-slate-leaf="true" data-offset-key="12119:0" data-first-offset="true"><span data-slate-string="true">....</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12120"><span data-slate-type="code" data-slate-object="inline" data-key="12121"><span data-slate-object="text" data-key="12122"><span data-slate-leaf="true" data-offset-key="12122:0" data-first-offset="true"><span data-slate-string="true">docker run hello-world</span></span></span></span><span data-slate-object="text" data-key="12123"><span data-slate-leaf="true" data-offset-key="12123:0" data-first-offset="true"><span data-slate-string="true"> 命令会下载</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12124"><span data-slate-object="text" data-key="12125"><span data-slate-leaf="true" data-offset-key="12125:0" data-first-offset="true"><span data-slate-string="true"> hello-world</span></span></span></span><span data-slate-object="text" data-key="12126"><span data-slate-leaf="true" data-offset-key="12126:0" data-first-offset="true"><span data-slate-string="true"> 镜像，并启动容器，打印安装成功提示信息后退出。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12127"><span data-slate-object="text" data-key="12128"><span data-slate-leaf="true" data-offset-key="12128:0" data-first-offset="true"><span data-slate-string="true">这里注意，如果你通过 Yum 源安装失败，可以尝试 Docker 官方文档 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12129"><span data-slate-object="text" data-key="12130"><span data-slate-leaf="true" data-offset-key="12130:0" data-first-offset="true"><span data-slate-string="true">Install Docker Engine on CentOS</span></span></span></a><span data-slate-object="text" data-key="12131"><span data-slate-leaf="true" data-offset-key="12131:0" data-first-offset="true"><span data-slate-string="true"> 提供的其他方式安装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12132"><span data-slate-object="text" data-key="12133"><span data-slate-leaf="true" data-offset-key="12133:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第三步，安装后配置。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12134"><span data-slate-object="text" data-key="12135"><span data-slate-leaf="true" data-offset-key="12135:0" data-first-offset="true"><span data-slate-string="true">安装成功后，我们还需要做一些其他配置。主要有两个，一个是配置 docker，使其可通过</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12136"><span data-slate-object="text" data-key="12137"><span data-slate-leaf="true" data-offset-key="12137:0" data-first-offset="true"><span data-slate-string="true"> non-root</span></span></span></span><span data-slate-object="text" data-key="12138"><span data-slate-leaf="true" data-offset-key="12138:0" data-first-offset="true"><span data-slate-string="true"> 用户使用，另一个是配置 docker 开机启动。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12139"><div data-slate-type="list-line" data-slate-object="block" data-key="12140"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12141"><span data-slate-leaf="true" data-offset-key="12141:0" data-first-offset="true"><span data-slate-string="true">使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12142"><span data-slate-object="text" data-key="12143"><span data-slate-leaf="true" data-offset-key="12143:0" data-first-offset="true"><span data-slate-string="true"> non-root</span></span></span></span><span data-slate-object="text" data-key="12144"><span data-slate-leaf="true" data-offset-key="12144:0" data-first-offset="true"><span data-slate-string="true"> 用户操作 Docker</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12145"><span data-slate-object="text" data-key="12146"><span data-slate-leaf="true" data-offset-key="12146:0" data-first-offset="true"><span data-slate-string="true">我们在 Linux 系统上操作，为了安全，需要以普通用户的身份登录系统并执行操作。所以，我们需要配置 docker，使它可以被</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12147"><span data-slate-object="text" data-key="12148"><span data-slate-leaf="true" data-offset-key="12148:0" data-first-offset="true"><span data-slate-string="true"> non-root</span></span></span></span><span data-slate-object="text" data-key="12149"><span data-slate-leaf="true" data-offset-key="12149:0" data-first-offset="true"><span data-slate-string="true"> 用户使用。具体配置方法如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12150"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12151"><span data-slate-object="text" data-key="12152"><span data-slate-leaf="true" data-offset-key="12152:0" data-first-offset="true"><span data-slate-string="true">$ sudo groupadd docker </span></span></span><span data-slate-object="text" data-key="12153"><span data-slate-leaf="true" data-offset-key="12153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 1. 创建 `docker` 用户组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12154"><span data-slate-object="text" data-key="12155"><span data-slate-leaf="true" data-offset-key="12155:0" data-first-offset="true"><span data-slate-string="true">$ sudo usermod -aG docker </span></span></span><span data-slate-object="text" data-key="12156"><span data-slate-leaf="true" data-offset-key="12156:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$USER</span></span></span></span><span data-slate-object="text" data-key="12157"><span data-slate-leaf="true" data-offset-key="12157:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12158"><span data-slate-leaf="true" data-offset-key="12158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 2. 将当前用户添加到 `docker` 用户组下</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12159"><span data-slate-object="text" data-key="12160"><span data-slate-leaf="true" data-offset-key="12160:0" data-first-offset="true"><span data-slate-string="true">$ newgrp docker </span></span></span><span data-slate-object="text" data-key="12161"><span data-slate-leaf="true" data-offset-key="12161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 3. 重新加载组成员身份</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12162"><span data-slate-object="text" data-key="12163"><span data-slate-leaf="true" data-offset-key="12163:0" data-first-offset="true"><span data-slate-string="true">$ docker run hello-world </span></span></span><span data-slate-object="text" data-key="12164"><span data-slate-leaf="true" data-offset-key="12164:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 4. 确认能够以普通用户使用 docker</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12165"><span data-slate-object="text" data-key="12166"><span data-slate-leaf="true" data-offset-key="12166:0" data-first-offset="true"><span data-slate-string="true">如果在执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12167"><span data-slate-object="text" data-key="12168"><span data-slate-leaf="true" data-offset-key="12168:0" data-first-offset="true"><span data-slate-string="true">sudo groupadd docker</span></span></span></span><span data-slate-object="text" data-key="12169"><span data-slate-leaf="true" data-offset-key="12169:0" data-first-offset="true"><span data-slate-string="true"> 时报 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12170"><span data-slate-object="text" data-key="12171"><span data-slate-leaf="true" data-offset-key="12171:0" data-first-offset="true"><span data-slate-string="true">groupadd: group 'docker' already exists</span></span></span></span><span data-slate-object="text" data-key="12172"><span data-slate-leaf="true" data-offset-key="12172:0" data-first-offset="true"><span data-slate-string="true"> 错误，说明 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12173"><span data-slate-object="text" data-key="12174"><span data-slate-leaf="true" data-offset-key="12174:0" data-first-offset="true"><span data-slate-string="true">docker</span></span></span></span><span data-slate-object="text" data-key="12175"><span data-slate-leaf="true" data-offset-key="12175:0" data-first-offset="true"><span data-slate-string="true"> 组已经存在了，可以忽略这个报错。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12176"><span data-slate-object="text" data-key="12177"><span data-slate-leaf="true" data-offset-key="12177:0" data-first-offset="true"><span data-slate-string="true">如果你在将用户添加到 docker 组之前，使用 sudo 运行过 docker 命令，你可能会看到以下错误：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="12178"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12179"><span data-slate-object="text" data-key="12180"><span data-slate-leaf="true" data-offset-key="12180:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">WARNING</span></span></span></span><span data-slate-object="text" data-key="12181"><span data-slate-leaf="true" data-offset-key="12181:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12182"><span data-slate-leaf="true" data-offset-key="12182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Error</span></span></span></span><span data-slate-object="text" data-key="12183"><span data-slate-leaf="true" data-offset-key="12183:0" data-first-offset="true"><span data-slate-string="true"> loading config </span></span></span><span data-slate-object="text" data-key="12184"><span data-slate-leaf="true" data-offset-key="12184:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">file</span></span></span></span><span data-slate-object="text" data-key="12185"><span data-slate-leaf="true" data-offset-key="12185:0" data-first-offset="true"><span data-slate-string="true">: </span></span></span><span data-slate-object="text" data-key="12186"><span data-slate-leaf="true" data-offset-key="12186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/home/u</span></span></span></span><span data-slate-object="text" data-key="12187"><span data-slate-leaf="true" data-offset-key="12187:0" data-first-offset="true"><span data-slate-string="true">ser/.</span></span></span><span data-slate-object="text" data-key="12188"><span data-slate-leaf="true" data-offset-key="12188:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">docker</span></span></span></span><span data-slate-object="text" data-key="12189"><span data-slate-leaf="true" data-offset-key="12189:0" data-first-offset="true"><span data-slate-string="true">/config.</span></span></span><span data-slate-object="text" data-key="12190"><span data-slate-leaf="true" data-offset-key="12190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">json</span></span></span></span><span data-slate-object="text" data-key="12191"><span data-slate-leaf="true" data-offset-key="12191:0" data-first-offset="true"><span data-slate-string="true"> -</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12192"><span data-slate-object="text" data-key="12193"><span data-slate-leaf="true" data-offset-key="12193:0" data-first-offset="true"><span data-slate-string="true">stat /home/user/.</span></span></span><span data-slate-object="text" data-key="12194"><span data-slate-leaf="true" data-offset-key="12194:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">docker</span></span></span></span><span data-slate-object="text" data-key="12195"><span data-slate-leaf="true" data-offset-key="12195:0" data-first-offset="true"><span data-slate-string="true">/config.</span></span></span><span data-slate-object="text" data-key="12196"><span data-slate-leaf="true" data-offset-key="12196:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">json</span></span></span></span><span data-slate-object="text" data-key="12197"><span data-slate-leaf="true" data-offset-key="12197:0" data-first-offset="true"><span data-slate-string="true">: permission denied</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12198"><span data-slate-object="text" data-key="12199"><span data-slate-leaf="true" data-offset-key="12199:0" data-first-offset="true"><span data-slate-string="true">这个错误，我们可以通过删除</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12200"><span data-slate-object="text" data-key="12201"><span data-slate-leaf="true" data-offset-key="12201:0" data-first-offset="true"><span data-slate-string="true"> ~/.docker/</span></span></span></span><span data-slate-object="text" data-key="12202"><span data-slate-leaf="true" data-offset-key="12202:0" data-first-offset="true"><span data-slate-string="true"> 目录来解决，或者通过以下命令更改</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12203"><span data-slate-object="text" data-key="12204"><span data-slate-leaf="true" data-offset-key="12204:0" data-first-offset="true"><span data-slate-string="true"> ~/.docker/</span></span></span></span><span data-slate-object="text" data-key="12205"><span data-slate-leaf="true" data-offset-key="12205:0" data-first-offset="true"><span data-slate-string="true"> 目录的所有者和权限：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12206"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12207"><span data-slate-object="text" data-key="12208"><span data-slate-leaf="true" data-offset-key="12208:0" data-first-offset="true"><span data-slate-string="true">$ sudo </span></span></span><span data-slate-object="text" data-key="12209"><span data-slate-leaf="true" data-offset-key="12209:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">chown</span></span></span></span><span data-slate-object="text" data-key="12210"><span data-slate-leaf="true" data-offset-key="12210:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12211"><span data-slate-leaf="true" data-offset-key="12211:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12212"><span data-slate-leaf="true" data-offset-key="12212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$USER</span></span></span></span></span><span data-slate-object="text" data-key="12213"><span data-slate-leaf="true" data-offset-key="12213:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12214"><span data-slate-leaf="true" data-offset-key="12214:0" data-first-offset="true"><span data-slate-string="true">:</span></span></span><span data-slate-object="text" data-key="12215"><span data-slate-leaf="true" data-offset-key="12215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12216"><span data-slate-leaf="true" data-offset-key="12216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$USER</span></span></span></span></span><span data-slate-object="text" data-key="12217"><span data-slate-leaf="true" data-offset-key="12217:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12218"><span data-slate-leaf="true" data-offset-key="12218:0" data-first-offset="true"><span data-slate-string="true"> /home/</span></span></span><span data-slate-object="text" data-key="12219"><span data-slate-leaf="true" data-offset-key="12219:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12220"><span data-slate-leaf="true" data-offset-key="12220:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$USER</span></span></span></span></span><span data-slate-object="text" data-key="12221"><span data-slate-leaf="true" data-offset-key="12221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12222"><span data-slate-leaf="true" data-offset-key="12222:0" data-first-offset="true"><span data-slate-string="true">/.docker -R</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12223"><span data-slate-object="text" data-key="12224"><span data-slate-leaf="true" data-offset-key="12224:0" data-first-offset="true"><span data-slate-string="true">$ sudo </span></span></span><span data-slate-object="text" data-key="12225"><span data-slate-leaf="true" data-offset-key="12225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">chmod</span></span></span></span><span data-slate-object="text" data-key="12226"><span data-slate-leaf="true" data-offset-key="12226:0" data-first-offset="true"><span data-slate-string="true"> g+rwx </span></span></span><span data-slate-object="text" data-key="12227"><span data-slate-leaf="true" data-offset-key="12227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"</span></span></span></span><span data-slate-object="text" data-key="12228"><span data-slate-leaf="true" data-offset-key="12228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span></span><span data-slate-object="text" data-key="12229"><span data-slate-leaf="true" data-offset-key="12229:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/.docker"</span></span></span></span><span data-slate-object="text" data-key="12230"><span data-slate-leaf="true" data-offset-key="12230:0" data-first-offset="true"><span data-slate-string="true"> -R</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12231"><div data-slate-type="list-line" data-slate-object="block" data-key="12232"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12233"><span data-slate-leaf="true" data-offset-key="12233:0" data-first-offset="true"><span data-slate-string="true">配置 docker 开机启动</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12234"><span data-slate-object="text" data-key="12235"><span data-slate-leaf="true" data-offset-key="12235:0" data-first-offset="true"><span data-slate-string="true">大部分 Linux 发行版（RHEL、CentOS、Fedora、Debian、Ubuntu 16.04 及更高版本）使用 systemd 来管理服务，包括指定开启时启动的服务。在 Debian 和 Ubuntu 上，Docker 默认配置为开机启动。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12236"><span data-slate-object="text" data-key="12237"><span data-slate-leaf="true" data-offset-key="12237:0" data-first-offset="true"><span data-slate-string="true">在其他系统，我们需要手动配置 Docker 开机启动，配置方式如下（分别需要配置 docker 和 containerd 服务）：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12238"><span data-slate-object="text" data-key="12239"><span data-slate-leaf="true" data-offset-key="12239:0" data-first-offset="true"><span data-slate-string="true">要在引导时为其他发行版自动启动 Docker 和 Containerd，你可以使用以下命令：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12240"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12241"><span data-slate-object="text" data-key="12242"><span data-slate-leaf="true" data-offset-key="12242:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl </span></span></span><span data-slate-object="text" data-key="12243"><span data-slate-leaf="true" data-offset-key="12243:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">enable</span></span></span></span><span data-slate-object="text" data-key="12244"><span data-slate-leaf="true" data-offset-key="12244:0" data-first-offset="true"><span data-slate-string="true"> docker.service </span></span></span><span data-slate-object="text" data-key="12245"><span data-slate-leaf="true" data-offset-key="12245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 设置 docker 开机启动</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12246"><span data-slate-object="text" data-key="12247"><span data-slate-leaf="true" data-offset-key="12247:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl </span></span></span><span data-slate-object="text" data-key="12248"><span data-slate-leaf="true" data-offset-key="12248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">enable</span></span></span></span><span data-slate-object="text" data-key="12249"><span data-slate-leaf="true" data-offset-key="12249:0" data-first-offset="true"><span data-slate-string="true"> containerd.service </span></span></span><span data-slate-object="text" data-key="12250"><span data-slate-leaf="true" data-offset-key="12250:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 设置 containerd 开机启动</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12251"><span data-slate-object="text" data-key="12252"><span data-slate-leaf="true" data-offset-key="12252:0" data-first-offset="true"><span data-slate-string="true">如果要禁止</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12253"><span data-slate-object="text" data-key="12254"><span data-slate-leaf="true" data-offset-key="12254:0" data-first-offset="true"><span data-slate-string="true"> docker</span></span></span></span><span data-slate-object="text" data-key="12255"><span data-slate-leaf="true" data-offset-key="12255:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12256"><span data-slate-object="text" data-key="12257"><span data-slate-leaf="true" data-offset-key="12257:0" data-first-offset="true"><span data-slate-string="true">containerd</span></span></span></span><span data-slate-object="text" data-key="12258"><span data-slate-leaf="true" data-offset-key="12258:0" data-first-offset="true"><span data-slate-string="true"> 开启启动，可以用这个命令：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12259"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12260"><span data-slate-object="text" data-key="12261"><span data-slate-leaf="true" data-offset-key="12261:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl </span></span></span><span data-slate-object="text" data-key="12262"><span data-slate-leaf="true" data-offset-key="12262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">disable</span></span></span></span><span data-slate-object="text" data-key="12263"><span data-slate-leaf="true" data-offset-key="12263:0" data-first-offset="true"><span data-slate-string="true"> docker.service </span></span></span><span data-slate-object="text" data-key="12264"><span data-slate-leaf="true" data-offset-key="12264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 禁止 docker 开机启动</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12265"><span data-slate-object="text" data-key="12266"><span data-slate-leaf="true" data-offset-key="12266:0" data-first-offset="true"><span data-slate-string="true">$ sudo systemctl </span></span></span><span data-slate-object="text" data-key="12267"><span data-slate-leaf="true" data-offset-key="12267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">disable</span></span></span></span><span data-slate-object="text" data-key="12268"><span data-slate-leaf="true" data-offset-key="12268:0" data-first-offset="true"><span data-slate-string="true"> containerd.service </span></span></span><span data-slate-object="text" data-key="12269"><span data-slate-leaf="true" data-offset-key="12269:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 禁止 containerd 开机启动</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="12270" id="sr-toc-4"><span data-slate-object="text" data-key="12271"><span data-slate-leaf="true" data-offset-key="12271:0" data-first-offset="true"><span data-slate-string="true">准备一个 Kubernetes 集群</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="12272"><span data-slate-object="text" data-key="12273"><span data-slate-leaf="true" data-offset-key="12273:0" data-first-offset="true"><span data-slate-string="true">安装完 Docker 之后，还需要一个 Kubernetes 集群，来调度 Docker 容器。安装 Kubernetes 集群极其复杂，这里选择一种最简单的方式来准备一个 Kubernetes 集群：购买一个腾讯云 Serverless 集群。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12274"><span data-slate-object="text" data-key="12275"><span data-slate-leaf="true" data-offset-key="12275:0" data-first-offset="true"><span data-slate-string="true">腾讯云 Serverless 集群是腾讯云容器服务推出的无须用户购买节点即可部署工作负载的集群类型。你可以把它理解为一个标准的 Kubernetes 集群，不同的是 Serverless 集群是由腾讯云容器服务团队创建和维护，你只需要访问集群，部署你的资源，并按照容器真实的资源使用量支付费用即可。你可以登录腾讯云容器服务控制台（</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12276"><span data-slate-object="text" data-key="12277"><span data-slate-leaf="true" data-offset-key="12277:0" data-first-offset="true"><span data-slate-string="true">https://console.cloud.tencent.com/tke2</span></span></span></a><span data-slate-object="text" data-key="12278"><span data-slate-leaf="true" data-offset-key="12278:0" data-first-offset="true"><span data-slate-string="true">）购买 Serverless 集群。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12279"><span data-slate-object="text" data-key="12280"><span data-slate-leaf="true" data-offset-key="12280:0" data-first-offset="true"><span data-slate-string="true">如果你想自己搭建 Kubernetes 集群，这里建议你购买 3 台腾讯云 CVM 机器，并参照 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12281"><span data-slate-object="text" data-key="12282"><span data-slate-leaf="true" data-offset-key="12282:0" data-first-offset="true"><span data-slate-string="true">follow-me-install-kubernetes-cluster</span></span></span></a><span data-slate-object="text" data-key="12283"><span data-slate-leaf="true" data-offset-key="12283:0" data-first-offset="true"><span data-slate-string="true"> 教程来一步步搭建 Kubernetes 集群，CVM 机器建议的最小配置如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12284"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/88/0b/885d2431e7f2d9bcd02b32d33yye930b.jpg?wh=1920x876"></div></div><h4 data-slate-type="heading" data-slate-object="block" data-key="12285" id="sr-toc-5"><span data-slate-object="text" data-key="12286"><span data-slate-leaf="true" data-offset-key="12286:0" data-first-offset="true"><span data-slate-string="true">EKS 简介</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="12287"><span data-slate-object="text" data-key="12288"><span data-slate-leaf="true" data-offset-key="12288:0" data-first-offset="true"><span data-slate-string="true">我先简单介绍一下 EKS 是什么。EKS（Elastic Kubernetes Service）即腾讯云弹性容器服务，是腾讯云容器服务推出的无须用户购买节点即可部署工作负载的服务模式。它完全兼容原生的 Kubernetes，支持使用原生方式创建及管理资源，按照容器真实的资源使用量计费。弹性容器服务 EKS 还扩展支持腾讯云的存储及网络等产品，同时确保用户容器的安全隔离，开箱即用。</span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="12289" id="sr-toc-6"><span data-slate-object="text" data-key="12290"><span data-slate-leaf="true" data-offset-key="12290:0" data-first-offset="true"><span data-slate-string="true">EKS 费用</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="12291"><span data-slate-object="text" data-key="12292"><span data-slate-leaf="true" data-offset-key="12292:0" data-first-offset="true"><span data-slate-string="true">那它是如何收费呢？EKS 是全托管的 Serverless Kubernetes 服务，不会收取托管的 Master、etcd 等资源的费用。弹性集群内运行的工作负载采用后付费的按量计费模式，费用根据实际配置的资源量按使用时间计算。也就是说：</span></span></span><span data-slate-object="text" data-key="12293"><span data-slate-leaf="true" data-offset-key="12293:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Kubernetes 集群本身是免费的，只有运行工作负载，消耗节点资源时收费。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12294"><span data-slate-object="text" data-key="12295"><span data-slate-leaf="true" data-offset-key="12295:0" data-first-offset="true"><span data-slate-string="true">EKS 有 3 种计费模式：预留券、按量计费、竞价模式，这里我建议选择</span></span></span><span data-slate-object="text" data-key="12296"><span data-slate-leaf="true" data-offset-key="12296:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">按量计费</span></span></span></span><span data-slate-object="text" data-key="12297"><span data-slate-leaf="true" data-offset-key="12297:0" data-first-offset="true"><span data-slate-string="true">。按量计费，支持按秒计费，按小时结算，随时购买随时释放，从专栏学习的角度来说，费用是最低的。EKS 会根据工作负载申请的 CPU、内存数值以及工作负载的运行时间来核算费用，具体定价，你可以参考：</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12298"><span data-slate-object="text" data-key="12299"><span data-slate-leaf="true" data-offset-key="12299:0" data-first-offset="true"><span data-slate-string="true">定价 | 弹性容器服务</span></span></span></a><span data-slate-object="text" data-key="12300"><span data-slate-leaf="true" data-offset-key="12300:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12301"><span data-slate-object="text" data-key="12302"><span data-slate-leaf="true" data-offset-key="12302:0" data-first-offset="true"><span data-slate-string="true">这里我通过例子来说明一下费用问题，IAM 应用会部署 4 个 Deployment，每个 Deployment 一个副本：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12303"><div data-slate-type="list-line" data-slate-object="block" data-key="12304"><span data-slate-object="text" data-key="12305"><span data-slate-leaf="true" data-offset-key="12305:0" data-first-offset="true"><span data-slate-string="true">iam-apiserver：IAM REST API 服务，提供用户、密钥、策略资源的 CURD 功能的 API 接口。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12306"><span data-slate-object="text" data-key="12307"><span data-slate-leaf="true" data-offset-key="12307:0" data-first-offset="true"><span data-slate-string="true">iam-authz-server：IAM 资源授权服务，对外提供资源授权接口。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12308"><span data-slate-object="text" data-key="12309"><span data-slate-leaf="true" data-offset-key="12309:0" data-first-offset="true"><span data-slate-string="true">iam-pump：IAM 数据清洗服务，从 Redis 中获取授权日志，处理后保存在 MongoDB 中。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12310"><span data-slate-object="text" data-key="12311"><span data-slate-leaf="true" data-offset-key="12311:0" data-first-offset="true"><span data-slate-string="true">iamctl：IAM 应用的测试服务，登陆 iamctl Pod 可以执行 iamctl 命令和 smoke 测试脚本，完成对 IAM 应用的运维和测试。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12312"><span data-slate-object="text" data-key="12313"><span data-slate-leaf="true" data-offset-key="12313:0" data-first-offset="true"><span data-slate-string="true">上述 4 个 Deployment 中的 </span></span></span><span data-slate-object="text" data-key="12314"><span data-slate-leaf="true" data-offset-key="12314:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Pod 配置均为 0.25 核、512Mi 内存</span></span></span></span><span data-slate-object="text" data-key="12315"><span data-slate-leaf="true" data-offset-key="12315:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12316"><span data-slate-object="text" data-key="12317"><span data-slate-leaf="true" data-offset-key="12317:0" data-first-offset="true"><span data-slate-string="true">这里，我们根据 EKS 的费用计算公式 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12318"><span data-slate-object="text" data-key="12319"><span data-slate-leaf="true" data-offset-key="12319:0" data-first-offset="true"><span data-slate-string="true">费用 = 相关计费项配置 × 资源单位时间价格 × 运行时间</span></span></span></span><span data-slate-object="text" data-key="12320"><span data-slate-leaf="true" data-offset-key="12320:0" data-first-offset="true"><span data-slate-string="true"> 计算 IAM 部署一天的费用：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="12321"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12322"><span data-slate-object="text" data-key="12323"><span data-slate-leaf="true" data-offset-key="12323:0" data-first-offset="true"><span data-slate-string="true">总费用 = (4 x 1) x (0.25 x 0.12 + 0.5 x 0.05) x 24 = 4.8 元</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12324"><span data-slate-object="text" data-key="12325"><span data-slate-leaf="true" data-offset-key="12325:0" data-first-offset="true"><span data-slate-string="true">也就是按最低配置部署 IAM 应用，运行一天的费用是 4.8 元（一瓶水的钱，就能学到如何将 IAM 应用部署在 Kubernetes 平台上，很值！）。你可能想这个计算公式里每个数值都代表什么呢？我来解释一下，其中：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12326"><div data-slate-type="list-line" data-slate-object="block" data-key="12327"><span data-slate-object="text" data-key="12328"><span data-slate-leaf="true" data-offset-key="12328:0" data-first-offset="true"><span data-slate-string="true">(4 x 1)：Kubernetes Pod 总个数（一共是 4 个 Deployment，每个 Pod 1 个副本）。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12329"><span data-slate-object="text" data-key="12330"><span data-slate-leaf="true" data-offset-key="12330:0" data-first-offset="true"><span data-slate-string="true">0.25 x 0.12：连续运行 1 小时的 CPU 配置费用。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12331"><span data-slate-object="text" data-key="12332"><span data-slate-leaf="true" data-offset-key="12332:0" data-first-offset="true"><span data-slate-string="true">0.5 x 0.05：连续运行 1 小时的内存配置费用。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12333"><span data-slate-object="text" data-key="12334"><span data-slate-leaf="true" data-offset-key="12334:0" data-first-offset="true"><span data-slate-string="true">24：24 小时，也即一天。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12335"><span data-slate-object="text" data-key="12336"><span data-slate-leaf="true" data-offset-key="12336:0" data-first-offset="true"><span data-slate-string="true">这里需要注意，为了帮助你节省费用，上述配置都是最低配置。在实际生产环境中，建议的配置如下：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12337"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1d/35/1d20c7eeb9dba8f53194969b0da5e835.jpg?wh=1920x718"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12338"><span data-slate-object="text" data-key="12339"><span data-slate-leaf="true" data-offset-key="12339:0" data-first-offset="true"><span data-slate-string="true">因为 iam-pump 组件是有状态的，并且目前没有实现抢占机制，所以副本数需要设置为 1。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12340"><span data-slate-object="text" data-key="12341"><span data-slate-leaf="true" data-offset-key="12341:0" data-first-offset="true"><span data-slate-string="true">另外，Intel 按量计费的配置费用见下图：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12342"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/64/59/64a5f89f4cbea95e50691455a06b1e59.png?wh=1372x226"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12343"><span data-slate-object="text" data-key="12344"><span data-slate-leaf="true" data-offset-key="12344:0" data-first-offset="true"><span data-slate-string="true">在这里有个很重要的事情提醒你：</span></span></span><span data-slate-object="text" data-key="12345"><span data-slate-leaf="true" data-offset-key="12345:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">学完本节课，销毁这些 Deployment，避免被继续扣费。建议腾讯云账户余额不要超过 50 元。</span></span></span></span></div><h4 data-slate-type="heading" data-slate-object="block" data-key="12346" id="sr-toc-7"><span data-slate-object="text" data-key="12347"><span data-slate-leaf="true" data-offset-key="12347:0" data-first-offset="true"><span data-slate-string="true">申请 EKS 集群</span></span></span></h4><div data-slate-type="paragraph" data-slate-object="block" data-key="12348"><span data-slate-object="text" data-key="12349"><span data-slate-leaf="true" data-offset-key="12349:0" data-first-offset="true"><span data-slate-string="true">了解了 EKS 以及费用相关的问题，接下来我们看看如何申请 EKS 集群。你可以通过以下 5 步来申请 EKS 集群。在正式申请前，请先确保腾讯云账户有大于 </span></span></span><span data-slate-object="text" data-key="12350"><span data-slate-leaf="true" data-offset-key="12350:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">10 元</span></span></span></span><span data-slate-object="text" data-key="12351"><span data-slate-leaf="true" data-offset-key="12351:0" data-first-offset="true"><span data-slate-string="true">的账户余额，否则在创建和使用 EKS 集群的过程中可能会因为费用不足而报错。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12352"><div data-slate-type="list-line" data-slate-object="block" data-key="12353"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12354"><span data-slate-leaf="true" data-offset-key="12354:0" data-first-offset="true"><span data-slate-string="true">创建腾讯云弹性集群</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12355"><span data-slate-object="text" data-key="12356"><span data-slate-leaf="true" data-offset-key="12356:0" data-first-offset="true"><span data-slate-string="true">具体步骤如下：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12357"><span data-slate-object="text" data-key="12358"><span data-slate-leaf="true" data-offset-key="12358:0" data-first-offset="true"><span data-slate-string="true">首先，登录容器服务控制台，选择左侧导航栏中的【</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12359"><span data-slate-object="text" data-key="12360"><span data-slate-leaf="true" data-offset-key="12360:0" data-first-offset="true"><span data-slate-string="true">弹性集群</span></span></span></a><span data-slate-object="text" data-key="12361"><span data-slate-leaf="true" data-offset-key="12361:0" data-first-offset="true"><span data-slate-string="true">】。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12362"><span data-slate-object="text" data-key="12363"><span data-slate-leaf="true" data-offset-key="12363:0" data-first-offset="true"><span data-slate-string="true">然后，在页面上方选择需创建弹性集群的地域，并单击【新建】。在 “创建弹性集群” 页面，根据以下提示设置集群信息。如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12364"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/37/8c/3740a98a6140b9c85517bdd27f30268c.png?wh=1920x950"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12365"><span data-slate-object="text" data-key="12366"><span data-slate-leaf="true" data-offset-key="12366:0" data-first-offset="true"><span data-slate-string="true">页面中各选择项的意思，我来给你解释一下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12367"><div data-slate-type="list-line" data-slate-object="block" data-key="12368"><span data-slate-object="text" data-key="12369"><span data-slate-leaf="true" data-offset-key="12369:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">集群名称：</span></span></span></span><span data-slate-object="text" data-key="12370"><span data-slate-leaf="true" data-offset-key="12370:0" data-first-offset="true"><span data-slate-string="true">创建的弹性集群名称，不超过 60 个字符。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12371"><span data-slate-object="text" data-key="12372"><span data-slate-leaf="true" data-offset-key="12372:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Kubernetes 版本：</span></span></span></span><span data-slate-object="text" data-key="12373"><span data-slate-leaf="true" data-offset-key="12373:0" data-first-offset="true"><span data-slate-string="true">弹性集群支持 1.12 以上的多个 Kubernetes 版本选择，建议选择最新的版本。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12374"><span data-slate-object="text" data-key="12375"><span data-slate-leaf="true" data-offset-key="12375:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">所在地域：</span></span></span></span><span data-slate-object="text" data-key="12376"><span data-slate-leaf="true" data-offset-key="12376:0" data-first-offset="true"><span data-slate-string="true">建议你根据所在地理位置选择靠近的地域，可降低访问延迟，提高下载速度。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12377"><span data-slate-object="text" data-key="12378"><span data-slate-leaf="true" data-offset-key="12378:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">集群网络：</span></span></span></span><span data-slate-object="text" data-key="12379"><span data-slate-leaf="true" data-offset-key="12379:0" data-first-offset="true"><span data-slate-string="true">已创建的弹性集群 VPC 网络，你可以选择私有网络中的子网用于弹性集群的容器网络，详情请见 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12380"><span data-slate-object="text" data-key="12381"><span data-slate-leaf="true" data-offset-key="12381:0" data-first-offset="true"><span data-slate-string="true">私有网络（VPC）</span></span></span></a><span data-slate-object="text" data-key="12382"><span data-slate-leaf="true" data-offset-key="12382:0" data-first-offset="true"><span data-slate-string="true"> 。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12383"><span data-slate-object="text" data-key="12384"><span data-slate-leaf="true" data-offset-key="12384:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">容器网络：</span></span></span></span><span data-slate-object="text" data-key="12385"><span data-slate-leaf="true" data-offset-key="12385:0" data-first-offset="true"><span data-slate-string="true">为集群内容器分配在容器网络地址范围内的 IP 地址。弹性集群的 Pod 会直接占用 VPC 子网 IP，请尽量选择 IP 数量充足且与其他产品使用无冲突的子网。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12386"><span data-slate-object="text" data-key="12387"><span data-slate-leaf="true" data-offset-key="12387:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Service CIDR：</span></span></span></span><span data-slate-object="text" data-key="12388"><span data-slate-leaf="true" data-offset-key="12388:0" data-first-offset="true"><span data-slate-string="true">集群的 ClusterIP Service 默认分配在所选 VPC 子网中，请尽量选择 IP 数量充足且与其他产品使用无冲突的子网。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12389"><span data-slate-object="text" data-key="12390"><span data-slate-leaf="true" data-offset-key="12390:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">集群描述：</span></span></span></span><span data-slate-object="text" data-key="12391"><span data-slate-leaf="true" data-offset-key="12391:0" data-first-offset="true"><span data-slate-string="true">创建集群的相关信息，该信息将显示在 “集群信息” 页面。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12392"><span data-slate-object="text" data-key="12393"><span data-slate-leaf="true" data-offset-key="12393:0" data-first-offset="true"><span data-slate-string="true">设置完成后，单击【完成】即可开始创建，可在 “弹性集群” 列表页面查看集群的创建进度。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12394"><span data-slate-object="text" data-key="12395"><span data-slate-leaf="true" data-offset-key="12395:0" data-first-offset="true"><span data-slate-string="true">等待弹性集群创建完成，创建完成后的弹性集群页面如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12396"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1c/3e/1c533956986531f0245b27864f17dc3e.png?wh=1920x376"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12397"><span data-slate-object="text" data-key="12398"><span data-slate-leaf="true" data-offset-key="12398:0" data-first-offset="true"><span data-slate-string="true">我们创建的弹性集群 ID 为 </span></span></span><span data-slate-object="text" data-key="12399"><span data-slate-leaf="true" data-offset-key="12399:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">cls-dc6sdos4</span></span></span></span><span data-slate-object="text" data-key="12400"><span data-slate-leaf="true" data-offset-key="12400:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12401"><div data-slate-type="list-line" data-slate-object="block" data-key="12402"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12403"><span data-slate-leaf="true" data-offset-key="12403:0" data-first-offset="true"><span data-slate-string="true">开启外网访问</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12404"><span data-slate-object="text" data-key="12405"><span data-slate-leaf="true" data-offset-key="12405:0" data-first-offset="true"><span data-slate-string="true">如果想访问 EKS 集群，需要先开启 EKS 的外网访问能力，开启方法如下：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12406"><span data-slate-object="text" data-key="12407"><span data-slate-leaf="true" data-offset-key="12407:0" data-first-offset="true"><span data-slate-string="true">登录容器服务控制台 -&gt; 选择左侧导航栏中的【</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12408"><span data-slate-object="text" data-key="12409"><span data-slate-leaf="true" data-offset-key="12409:0" data-first-offset="true"><span data-slate-string="true">弹性集群</span></span></span></a><span data-slate-object="text" data-key="12410"><span data-slate-leaf="true" data-offset-key="12410:0" data-first-offset="true"><span data-slate-string="true">】 -&gt; 进入 </span></span></span><span data-slate-object="text" data-key="12411"><span data-slate-leaf="true" data-offset-key="12411:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">cls-dc6sdos4</span></span></span></span><span data-slate-object="text" data-key="12412"><span data-slate-leaf="true" data-offset-key="12412:0" data-first-offset="true"><span data-slate-string="true"> 集群的详情页中 -&gt; 选择【基本信息】 -&gt; 点击【外网访问】按钮。如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12413"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/23/c6/235679797980de87432a0d4b05dd83c6.png?wh=1920x764"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12414"><span data-slate-object="text" data-key="12415"><span data-slate-leaf="true" data-offset-key="12415:0" data-first-offset="true"><span data-slate-string="true">这里要注意，开启外网访问时，为了安全，需要设置允许访问 kube-apiserver 的 IP 段。为了避免不必要的错误，外网访问地址我们设置为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12416"><span data-slate-object="text" data-key="12417"><span data-slate-leaf="true" data-offset-key="12417:0" data-first-offset="true"><span data-slate-string="true"> 0.0.0.0/0</span></span></span></span><span data-slate-object="text" data-key="12418"><span data-slate-leaf="true" data-offset-key="12418:0" data-first-offset="true"><span data-slate-string="true">  。如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12419"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/ea/21/ea627942e5a432401e5959ee90c06221.png?wh=920x441"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12420"><span data-slate-object="text" data-key="12421"><span data-slate-leaf="true" data-offset-key="12421:0" data-first-offset="true"><span data-slate-string="true">注意，只有测试时才可这么设置为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12422"><span data-slate-object="text" data-key="12423"><span data-slate-leaf="true" data-offset-key="12423:0" data-first-offset="true"><span data-slate-string="true">0.0.0.0/0</span></span></span></span><span data-slate-object="text" data-key="12424"><span data-slate-leaf="true" data-offset-key="12424:0" data-first-offset="true"><span data-slate-string="true"> ，如果是生产环境，建议严格限制可以访问 kube-apiserver 的来源 IP。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12425"><div data-slate-type="list-line" data-slate-object="block" data-key="12426"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="12427"><span data-slate-leaf="true" data-offset-key="12427:0" data-first-offset="true"><span data-slate-string="true">安装 kubectl 命令行工具</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12428"><span data-slate-object="text" data-key="12429"><span data-slate-leaf="true" data-offset-key="12429:0" data-first-offset="true"><span data-slate-string="true">如果要访问 EKS（标准的 Kubernetes 集群），比较高效的方式是通过 Kubernetes 提供的命令行工具 kubectl 来访问。所以，还需要安装 kubectl 工具。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12430"><span data-slate-object="text" data-key="12431"><span data-slate-leaf="true" data-offset-key="12431:0" data-first-offset="true"><span data-slate-string="true">安装方式如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12432"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12433"><span data-slate-object="text" data-key="12434"><span data-slate-leaf="true" data-offset-key="12434:0" data-first-offset="true"><span data-slate-string="true">$ curl -LO </span></span></span><span data-slate-object="text" data-key="12435"><span data-slate-leaf="true" data-offset-key="12435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"https://dl.k8s.io/release/</span></span></span></span><span data-slate-object="text" data-key="12436"><span data-slate-leaf="true" data-offset-key="12436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span></span></span></span></span><span data-slate-object="text" data-key="12437"><span data-slate-leaf="true" data-offset-key="12437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">/bin/linux/amd64/kubectl"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12438"><span data-slate-object="text" data-key="12439"><span data-slate-leaf="true" data-offset-key="12439:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12440"><span data-slate-leaf="true" data-offset-key="12440:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mkdir</span></span></span></span><span data-slate-object="text" data-key="12441"><span data-slate-leaf="true" data-offset-key="12441:0" data-first-offset="true"><span data-slate-string="true"> -p </span></span></span><span data-slate-object="text" data-key="12442"><span data-slate-leaf="true" data-offset-key="12442:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="12443"><span data-slate-leaf="true" data-offset-key="12443:0" data-first-offset="true"><span data-slate-string="true">/bin</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12444"><span data-slate-object="text" data-key="12445"><span data-slate-leaf="true" data-offset-key="12445:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12446"><span data-slate-leaf="true" data-offset-key="12446:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mv</span></span></span></span><span data-slate-object="text" data-key="12447"><span data-slate-leaf="true" data-offset-key="12447:0" data-first-offset="true"><span data-slate-string="true"> kubectl </span></span></span><span data-slate-object="text" data-key="12448"><span data-slate-leaf="true" data-offset-key="12448:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="12449"><span data-slate-leaf="true" data-offset-key="12449:0" data-first-offset="true"><span data-slate-string="true">/bin</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12450"><span data-slate-object="text" data-key="12451"><span data-slate-leaf="true" data-offset-key="12451:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12452"><span data-slate-leaf="true" data-offset-key="12452:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">chmod</span></span></span></span><span data-slate-object="text" data-key="12453"><span data-slate-leaf="true" data-offset-key="12453:0" data-first-offset="true"><span data-slate-string="true"> +x </span></span></span><span data-slate-object="text" data-key="12454"><span data-slate-leaf="true" data-offset-key="12454:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="12455"><span data-slate-leaf="true" data-offset-key="12455:0" data-first-offset="true"><span data-slate-string="true">/bin/kubectl</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12456"><span data-slate-object="text" data-key="12457"><span data-slate-leaf="true" data-offset-key="12457:0" data-first-offset="true"><span data-slate-string="true">具体可参考</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12458"><span data-slate-object="text" data-key="12459"><span data-slate-leaf="true" data-offset-key="12459:0" data-first-offset="true"><span data-slate-string="true">安装和设置 kubectl</span></span></span></a><span data-slate-object="text" data-key="12460"><span data-slate-leaf="true" data-offset-key="12460:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12461"><span data-slate-object="text" data-key="12462"><span data-slate-leaf="true" data-offset-key="12462:0" data-first-offset="true"><span data-slate-string="true">你可以通过以下命令来配置 kubectl 的 bash 自动补全：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12463"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12464"><span data-slate-object="text" data-key="12465"><span data-slate-leaf="true" data-offset-key="12465:0" data-first-offset="true"><span data-slate-string="true">$ kubectl completion bash &gt; </span></span></span><span data-slate-object="text" data-key="12466"><span data-slate-leaf="true" data-offset-key="12466:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$HOME</span></span></span></span><span data-slate-object="text" data-key="12467"><span data-slate-leaf="true" data-offset-key="12467:0" data-first-offset="true"><span data-slate-string="true">/.kube-completion.bash</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12468"><span data-slate-object="text" data-key="12469"><span data-slate-leaf="true" data-offset-key="12469:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12470"><span data-slate-leaf="true" data-offset-key="12470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">echo</span></span></span></span><span data-slate-object="text" data-key="12471"><span data-slate-leaf="true" data-offset-key="12471:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12472"><span data-slate-leaf="true" data-offset-key="12472:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'source $HOME/.kube-completion.bash'</span></span></span></span><span data-slate-object="text" data-key="12473"><span data-slate-leaf="true" data-offset-key="12473:0" data-first-offset="true"><span data-slate-string="true"> &gt;&gt; ~/.bashrc</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12474"><span data-slate-object="text" data-key="12475"><span data-slate-leaf="true" data-offset-key="12475:0" data-first-offset="true"><span data-slate-string="true">$ bash</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12476"><div data-slate-type="list-line" data-slate-object="block" data-key="12477"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="12478"><span data-slate-leaf="true" data-offset-key="12478:0" data-first-offset="true"><span data-slate-string="true">下载并安装 kubeconfig</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12479"><span data-slate-object="text" data-key="12480"><span data-slate-leaf="true" data-offset-key="12480:0" data-first-offset="true"><span data-slate-string="true">安装完 kubectl 工具之后，需要配置 kubectl 所读取的配置文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12481"><span data-slate-object="text" data-key="12482"><span data-slate-leaf="true" data-offset-key="12482:0" data-first-offset="true"><span data-slate-string="true">这里注意，在上一步，我们开启了外网访问，开启后 EKS 会生成一个 kubeconfig 配置（ </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12483"><span data-slate-object="text" data-key="12484"><span data-slate-leaf="true" data-offset-key="12484:0" data-first-offset="true"><span data-slate-string="true">kubeconfig</span></span></span></span><span data-slate-object="text" data-key="12485"><span data-slate-leaf="true" data-offset-key="12485:0" data-first-offset="true"><span data-slate-string="true"> 即为 kubectl 的配置文件）。我们可以从页面下载并安装。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12486"><span data-slate-object="text" data-key="12487"><span data-slate-leaf="true" data-offset-key="12487:0" data-first-offset="true"><span data-slate-string="true">在弹性集群的基本信息页面，点击【复制】按钮，复制 kubeconfig 文件内容，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12488"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/bc/bf/bc314604334dd56b7337a905c9b6bfbf.png?wh=1775x731"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12489"><span data-slate-object="text" data-key="12490"><span data-slate-leaf="true" data-offset-key="12490:0" data-first-offset="true"><span data-slate-string="true">复制后，将粘贴板的内容保存在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12491"><span data-slate-object="text" data-key="12492"><span data-slate-leaf="true" data-offset-key="12492:0" data-first-offset="true"><span data-slate-string="true"> $HOME/.kube/config</span></span></span></span><span data-slate-object="text" data-key="12493"><span data-slate-leaf="true" data-offset-key="12493:0" data-first-offset="true"><span data-slate-string="true"> 文件中。需要先执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12494"><span data-slate-object="text" data-key="12495"><span data-slate-leaf="true" data-offset-key="12495:0" data-first-offset="true"><span data-slate-string="true"> mkdir -p $HOME/.kube</span></span></span></span><span data-slate-object="text" data-key="12496"><span data-slate-leaf="true" data-offset-key="12496:0" data-first-offset="true"><span data-slate-string="true"> 创建</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12497"><span data-slate-object="text" data-key="12498"><span data-slate-leaf="true" data-offset-key="12498:0" data-first-offset="true"><span data-slate-string="true">.kube</span></span></span></span><span data-slate-object="text" data-key="12499"><span data-slate-leaf="true" data-offset-key="12499:0" data-first-offset="true"><span data-slate-string="true"> 目录，再将粘贴版中的内容写到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12500"><span data-slate-object="text" data-key="12501"><span data-slate-leaf="true" data-offset-key="12501:0" data-first-offset="true"><span data-slate-string="true">config</span></span></span></span><span data-slate-object="text" data-key="12502"><span data-slate-leaf="true" data-offset-key="12502:0" data-first-offset="true"><span data-slate-string="true"> 文件中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12503"><span data-slate-object="text" data-key="12504"><span data-slate-leaf="true" data-offset-key="12504:0" data-first-offset="true"><span data-slate-string="true">你可以通过以下命令，来测试 kubectl 工具是否成功安装和配置：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12505"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12506"><span data-slate-object="text" data-key="12507"><span data-slate-leaf="true" data-offset-key="12507:0" data-first-offset="true"><span data-slate-string="true">$ kubectl get nodes</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12508"><span data-slate-object="text" data-key="12509"><span data-slate-leaf="true" data-offset-key="12509:0" data-first-offset="true"><span data-slate-string="true">NAME                    STATUS   ROLES    AGE    VERSION</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12510"><span data-slate-object="text" data-key="12511"><span data-slate-leaf="true" data-offset-key="12511:0" data-first-offset="true"><span data-slate-string="true">eklet-subnet-lowt256k   Ready    &lt;none&gt;   2d1h   v2.5.21</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12512"><span data-slate-object="text" data-key="12513"><span data-slate-leaf="true" data-offset-key="12513:0" data-first-offset="true"><span data-slate-string="true">如果输出了 Kubernetes 的 eklet 节点，并且节点状态为 </span></span></span><span data-slate-object="text" data-key="12514"><span data-slate-leaf="true" data-offset-key="12514:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Ready</span></span></span></span><span data-slate-object="text" data-key="12515"><span data-slate-leaf="true" data-offset-key="12515:0" data-first-offset="true"><span data-slate-string="true">，说明 Kubernetes 集群运行正常，并且 kubectl 安装和配置正确。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12516"><div data-slate-type="list-line" data-slate-object="block" data-key="12517"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="12518"><span data-slate-leaf="true" data-offset-key="12518:0" data-first-offset="true"><span data-slate-string="true">EKS 集群开通集群内服务访问外网能力</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12519"><span data-slate-object="text" data-key="12520"><span data-slate-leaf="true" data-offset-key="12520:0" data-first-offset="true"><span data-slate-string="true">因为 IAM 应用中的数据库：MariaDB、Redis、MongoDB 可能需要通过外网访问，所以还需要开通 EKS 中 Pod 访问外网的能力。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12521"><span data-slate-object="text" data-key="12522"><span data-slate-leaf="true" data-offset-key="12522:0" data-first-offset="true"><span data-slate-string="true">EKS 支持通过配置 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12523"><span data-slate-object="text" data-key="12524"><span data-slate-leaf="true" data-offset-key="12524:0" data-first-offset="true"><span data-slate-string="true">NAT 网关</span></span></span></a><span data-slate-object="text" data-key="12525"><span data-slate-leaf="true" data-offset-key="12525:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12526"><span data-slate-object="text" data-key="12527"><span data-slate-leaf="true" data-offset-key="12527:0" data-first-offset="true"><span data-slate-string="true">路由表</span></span></span></a><span data-slate-object="text" data-key="12528"><span data-slate-leaf="true" data-offset-key="12528:0" data-first-offset="true"><span data-slate-string="true"> 来实现集群内服务访问外网。具体开启步骤，需要你查看腾讯云官方文档：</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="12529"><span data-slate-object="text" data-key="12530"><span data-slate-leaf="true" data-offset-key="12530:0" data-first-offset="true"><span data-slate-string="true">通过 NAT 网关访问外网</span></span></span></a><span data-slate-object="text" data-key="12531"><span data-slate-leaf="true" data-offset-key="12531:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12532"><span data-slate-object="text" data-key="12533"><span data-slate-leaf="true" data-offset-key="12533:0" data-first-offset="true"><span data-slate-string="true">在开通过程中有以下两点需要你注意：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12534"><div data-slate-type="list-line" data-slate-object="block" data-key="12535"><span data-slate-object="text" data-key="12536"><span data-slate-leaf="true" data-offset-key="12536:0" data-first-offset="true"><span data-slate-string="true">在</span></span></span><span data-slate-object="text" data-key="12537"><span data-slate-leaf="true" data-offset-key="12537:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">创建指向 NAT 网关的路由表</span></span></span></span><span data-slate-object="text" data-key="12538"><span data-slate-leaf="true" data-offset-key="12538:0" data-first-offset="true"><span data-slate-string="true">步骤中，目的端要选择：0.0.0.0/0。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12539"><span data-slate-object="text" data-key="12540"><span data-slate-leaf="true" data-offset-key="12540:0" data-first-offset="true"><span data-slate-string="true">在</span></span></span><span data-slate-object="text" data-key="12541"><span data-slate-leaf="true" data-offset-key="12541:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">关联子网至路由表</span></span></span></span><span data-slate-object="text" data-key="12542"><span data-slate-leaf="true" data-offset-key="12542:0" data-first-offset="true"><span data-slate-string="true">步骤中，只关联创建 EKS 集群时选择的子网。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12543"><span data-slate-object="text" data-key="12544"><span data-slate-leaf="true" data-offset-key="12544:0" data-first-offset="true"><span data-slate-string="true">如果你的数据库需要通过外网访问，这里一定要确保 EKS 集群成功开通集群内服务访问外网能力，否则部署 IAM 应用时会因为访问不了数据库而失败。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12545" id="sr-toc-8"><span data-slate-object="text" data-key="12546"><span data-slate-leaf="true" data-offset-key="12546:0" data-first-offset="true"><span data-slate-string="true">安装 IAM 应用</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12547"><span data-slate-object="text" data-key="12548"><span data-slate-leaf="true" data-offset-key="12548:0" data-first-offset="true"><span data-slate-string="true">上面，我们开通了镜像仓库、安装了 Docker 引擎、安装和配置了 Kubernetes 集群，那么接下来，我们就来看下如何将 IAM 应用部署到 Kubernetes 集群中。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12549"><span data-slate-object="text" data-key="12550"><span data-slate-leaf="true" data-offset-key="12550:0" data-first-offset="true"><span data-slate-string="true">假设 IAM 项目仓库根目录路径为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12551"><span data-slate-object="text" data-key="12552"><span data-slate-leaf="true" data-offset-key="12552:0" data-first-offset="true"><span data-slate-string="true">$IAM_ROOT</span></span></span></span><span data-slate-object="text" data-key="12553"><span data-slate-leaf="true" data-offset-key="12553:0" data-first-offset="true"><span data-slate-string="true">，具体安装步骤如下：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12554"><div data-slate-type="list-line" data-slate-object="block" data-key="12555"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12556"><span data-slate-leaf="true" data-offset-key="12556:0" data-first-offset="true"><span data-slate-string="true">配置</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12557"><span data-slate-object="text" data-key="12558"><span data-slate-leaf="true" data-offset-key="12558:0" data-first-offset="true"><span data-slate-string="true"> scripts/install/environment.sh</span></span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12559"><span data-slate-type="code" data-slate-object="inline" data-key="12560"><span data-slate-object="text" data-key="12561"><span data-slate-leaf="true" data-offset-key="12561:0" data-first-offset="true"><span data-slate-string="true">scripts/install/environment.sh</span></span></span></span><span data-slate-object="text" data-key="12562"><span data-slate-leaf="true" data-offset-key="12562:0" data-first-offset="true"><span data-slate-string="true"> 文件中包含了各类自定义配置。你可能需要配置跟数据库相关的配置（当然，也可以都使用默认值）：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12563"><div data-slate-type="list-line" data-slate-object="block" data-key="12564"><span data-slate-object="text" data-key="12565"><span data-slate-leaf="true" data-offset-key="12565:0" data-first-offset="true"><span data-slate-string="true">MariaDB 配置：environment.sh 文件中以</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12566"><span data-slate-object="text" data-key="12567"><span data-slate-leaf="true" data-offset-key="12567:0" data-first-offset="true"><span data-slate-string="true"> MARIADB_</span></span></span></span><span data-slate-object="text" data-key="12568"><span data-slate-leaf="true" data-offset-key="12568:0" data-first-offset="true"><span data-slate-string="true">开头的变量。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12569"><span data-slate-object="text" data-key="12570"><span data-slate-leaf="true" data-offset-key="12570:0" data-first-offset="true"><span data-slate-string="true">Redis 配置：environment.sh 文件中以</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12571"><span data-slate-object="text" data-key="12572"><span data-slate-leaf="true" data-offset-key="12572:0" data-first-offset="true"><span data-slate-string="true"> REDIS_</span></span></span></span><span data-slate-object="text" data-key="12573"><span data-slate-leaf="true" data-offset-key="12573:0" data-first-offset="true"><span data-slate-string="true">开头的变量。</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="12574"><span data-slate-object="text" data-key="12575"><span data-slate-leaf="true" data-offset-key="12575:0" data-first-offset="true"><span data-slate-string="true">MongoDB 配置：environment.sh 文件中以</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12576"><span data-slate-object="text" data-key="12577"><span data-slate-leaf="true" data-offset-key="12577:0" data-first-offset="true"><span data-slate-string="true"> MONGO_</span></span></span></span><span data-slate-object="text" data-key="12578"><span data-slate-leaf="true" data-offset-key="12578:0" data-first-offset="true"><span data-slate-string="true">开头的变量。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12579"><span data-slate-object="text" data-key="12580"><span data-slate-leaf="true" data-offset-key="12580:0" data-first-offset="true"><span data-slate-string="true">其他配置，使用默认值。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12581"><div data-slate-type="list-line" data-slate-object="block" data-key="12582"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12583"><span data-slate-leaf="true" data-offset-key="12583:0" data-first-offset="true"><span data-slate-string="true">创建 IAM 应用的配置文件</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12584"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12585"><span data-slate-object="text" data-key="12586"><span data-slate-leaf="true" data-offset-key="12586:0" data-first-offset="true"><span data-slate-string="true">$ </span></span></span><span data-slate-object="text" data-key="12587"><span data-slate-leaf="true" data-offset-key="12587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">cd</span></span></span></span><span data-slate-object="text" data-key="12588"><span data-slate-leaf="true" data-offset-key="12588:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="12589"><span data-slate-leaf="true" data-offset-key="12589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${IAM_ROOT}</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12590"><span data-slate-object="text" data-key="12591"><span data-slate-leaf="true" data-offset-key="12591:0" data-first-offset="true"><span data-slate-string="true">$ make gen.defaultconfigs </span></span></span><span data-slate-object="text" data-key="12592"><span data-slate-leaf="true" data-offset-key="12592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 生成 iam-apiserver、iam-authz-server、iam-pump、iamctl 组件的默认配置文件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12593"><span data-slate-object="text" data-key="12594"><span data-slate-leaf="true" data-offset-key="12594:0" data-first-offset="true"><span data-slate-string="true">$ make gen.ca </span></span></span><span data-slate-object="text" data-key="12595"><span data-slate-leaf="true" data-offset-key="12595:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 生成 CA 证书</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12596"><span data-slate-object="text" data-key="12597"><span data-slate-leaf="true" data-offset-key="12597:0" data-first-offset="true"><span data-slate-string="true">上述命令会将 IAM 的配置文件存放在这个</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12598"><span data-slate-object="text" data-key="12599"><span data-slate-leaf="true" data-offset-key="12599:0" data-first-offset="true"><span data-slate-string="true"> ${IAM_ROOT}/_output/configs/</span></span></span></span><span data-slate-object="text" data-key="12600"><span data-slate-leaf="true" data-offset-key="12600:0" data-first-offset="true"><span data-slate-string="true"> 目录下。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12601"><div data-slate-type="list-line" data-slate-object="block" data-key="12602"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="12603"><span data-slate-leaf="true" data-offset-key="12603:0" data-first-offset="true"><span data-slate-string="true">创建 IAM 命名空间</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12604"><span data-slate-object="text" data-key="12605"><span data-slate-leaf="true" data-offset-key="12605:0" data-first-offset="true"><span data-slate-string="true">我们将 IAM 应用涉及到的各类资源，都创建在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12606"><span data-slate-object="text" data-key="12607"><span data-slate-leaf="true" data-offset-key="12607:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12608"><span data-slate-leaf="true" data-offset-key="12608:0" data-first-offset="true"><span data-slate-string="true"> 命名空间中。将 IAM 资源创建在独立的命名空间中，不仅方便维护，还可以有效避免影响其他 Kubernetes 资源。</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12609"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12610"><span data-slate-object="text" data-key="12611"><span data-slate-leaf="true" data-offset-key="12611:0" data-first-offset="true"><span data-slate-string="true">$ kubectl create namespace iam</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12612"><div data-slate-type="list-line" data-slate-object="block" data-key="12613"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="12614"><span data-slate-leaf="true" data-offset-key="12614:0" data-first-offset="true"><span data-slate-string="true">将 IAM 各服务的配置文件，以 ConfigMap 资源的形式保存在 Kubernetes 集群中</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12615"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12616"><span data-slate-object="text" data-key="12617"><span data-slate-leaf="true" data-offset-key="12617:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam create configmap iam --from-file=</span></span></span><span data-slate-object="text" data-key="12618"><span data-slate-leaf="true" data-offset-key="12618:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${IAM_ROOT}</span></span></span></span><span data-slate-object="text" data-key="12619"><span data-slate-leaf="true" data-offset-key="12619:0" data-first-offset="true"><span data-slate-string="true">/_output/configs/</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12620"><span data-slate-object="text" data-key="12621"><span data-slate-leaf="true" data-offset-key="12621:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam get configmap iam</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12622"><span data-slate-object="text" data-key="12623"><span data-slate-leaf="true" data-offset-key="12623:0" data-first-offset="true"><span data-slate-string="true">NAME   DATA   AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12624"><span data-slate-object="text" data-key="12625"><span data-slate-leaf="true" data-offset-key="12625:0" data-first-offset="true"><span data-slate-string="true">iam    4      13s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12626"><span data-slate-object="text" data-key="12627"><span data-slate-leaf="true" data-offset-key="12627:0" data-first-offset="true"><span data-slate-string="true">执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12628"><span data-slate-object="text" data-key="12629"><span data-slate-leaf="true" data-offset-key="12629:0" data-first-offset="true"><span data-slate-string="true"> kubectl -n iam get configmap iam</span></span></span></span><span data-slate-object="text" data-key="12630"><span data-slate-leaf="true" data-offset-key="12630:0" data-first-offset="true"><span data-slate-string="true"> 命令，可以成功获取创建的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12631"><span data-slate-object="text" data-key="12632"><span data-slate-leaf="true" data-offset-key="12632:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12633"><span data-slate-leaf="true" data-offset-key="12633:0" data-first-offset="true"><span data-slate-string="true"> configmap。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12634"><span data-slate-object="text" data-key="12635"><span data-slate-leaf="true" data-offset-key="12635:0" data-first-offset="true"><span data-slate-string="true">如果你觉得每次执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12636"><span data-slate-object="text" data-key="12637"><span data-slate-leaf="true" data-offset-key="12637:0" data-first-offset="true"><span data-slate-string="true"> kubectl</span></span></span></span><span data-slate-object="text" data-key="12638"><span data-slate-leaf="true" data-offset-key="12638:0" data-first-offset="true"><span data-slate-string="true"> 命令都要指定</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12639"><span data-slate-object="text" data-key="12640"><span data-slate-leaf="true" data-offset-key="12640:0" data-first-offset="true"><span data-slate-string="true"> -n iam</span></span></span></span><span data-slate-object="text" data-key="12641"><span data-slate-leaf="true" data-offset-key="12641:0" data-first-offset="true"><span data-slate-string="true"> 选项很繁琐，你可以使用以下命令，将</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12642"><span data-slate-object="text" data-key="12643"><span data-slate-leaf="true" data-offset-key="12643:0" data-first-offset="true"><span data-slate-string="true"> kubectl</span></span></span></span><span data-slate-object="text" data-key="12644"><span data-slate-leaf="true" data-offset-key="12644:0" data-first-offset="true"><span data-slate-string="true"> 上下文环境中的命名空间指定为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12645"><span data-slate-object="text" data-key="12646"><span data-slate-leaf="true" data-offset-key="12646:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12647"><span data-slate-leaf="true" data-offset-key="12647:0" data-first-offset="true"><span data-slate-string="true">。设置后，执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12648"><span data-slate-object="text" data-key="12649"><span data-slate-leaf="true" data-offset-key="12649:0" data-first-offset="true"><span data-slate-string="true"> kubectl</span></span></span></span><span data-slate-object="text" data-key="12650"><span data-slate-leaf="true" data-offset-key="12650:0" data-first-offset="true"><span data-slate-string="true"> 命令，默认在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12651"><span data-slate-object="text" data-key="12652"><span data-slate-leaf="true" data-offset-key="12652:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12653"><span data-slate-leaf="true" data-offset-key="12653:0" data-first-offset="true"><span data-slate-string="true"> 命名空间下执行：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12654"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12655"><span data-slate-object="text" data-key="12656"><span data-slate-leaf="true" data-offset-key="12656:0" data-first-offset="true"><span data-slate-string="true">$ kubectl config set-context `kubectl config current-context` --namespace=iam</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12657"><div data-slate-type="list-line" data-slate-object="block" data-key="12658"><div data-code-line-number="5"></div><div><span data-slate-object="text" data-key="12659"><span data-slate-leaf="true" data-offset-key="12659:0" data-first-offset="true"><span data-slate-string="true">将 IAM 各服务使用的证书文件，以 ConfigMap 资源的形式创建在 Kubernetes 集群中</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12660"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12661"><span data-slate-object="text" data-key="12662"><span data-slate-leaf="true" data-offset-key="12662:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam create configmap iam-cert --from-file=</span></span></span><span data-slate-object="text" data-key="12663"><span data-slate-leaf="true" data-offset-key="12663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${IAM_ROOT}</span></span></span></span><span data-slate-object="text" data-key="12664"><span data-slate-leaf="true" data-offset-key="12664:0" data-first-offset="true"><span data-slate-string="true">/_output/cert</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12665"><span data-slate-object="text" data-key="12666"><span data-slate-leaf="true" data-offset-key="12666:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam get configmap iam-cert</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12667"><span data-slate-object="text" data-key="12668"><span data-slate-leaf="true" data-offset-key="12668:0" data-first-offset="true"><span data-slate-string="true">NAME       DATA   AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12669"><span data-slate-object="text" data-key="12670"><span data-slate-leaf="true" data-offset-key="12670:0" data-first-offset="true"><span data-slate-string="true">iam-cert   14     12s</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12671"><span data-slate-object="text" data-key="12672"><span data-slate-leaf="true" data-offset-key="12672:0" data-first-offset="true"><span data-slate-string="true">执行</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12673"><span data-slate-object="text" data-key="12674"><span data-slate-leaf="true" data-offset-key="12674:0" data-first-offset="true"><span data-slate-string="true"> kubectl -n iam get configmap iam-cert</span></span></span></span><span data-slate-object="text" data-key="12675"><span data-slate-leaf="true" data-offset-key="12675:0" data-first-offset="true"><span data-slate-string="true"> 命令，可以成功获取创建的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12676"><span data-slate-object="text" data-key="12677"><span data-slate-leaf="true" data-offset-key="12677:0" data-first-offset="true"><span data-slate-string="true"> iam-cert</span></span></span></span><span data-slate-object="text" data-key="12678"><span data-slate-leaf="true" data-offset-key="12678:0" data-first-offset="true"><span data-slate-string="true"> configmap。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12679"><div data-slate-type="list-line" data-slate-object="block" data-key="12680"><div data-code-line-number="6"></div><div><span data-slate-object="text" data-key="12681"><span data-slate-leaf="true" data-offset-key="12681:0" data-first-offset="true"><span data-slate-string="true">创建镜像仓库访问密钥</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12682"><span data-slate-object="text" data-key="12683"><span data-slate-leaf="true" data-offset-key="12683:0" data-first-offset="true"><span data-slate-string="true">在准备阶段，我们开通了腾讯云镜像仓库服务（访问地址为 ccr.ccs.tencentyun.com），并创建了用户</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12684"><span data-slate-object="text" data-key="12685"><span data-slate-leaf="true" data-offset-key="12685:0" data-first-offset="true"><span data-slate-string="true"> 10000099xxxx</span></span></span></span><span data-slate-object="text" data-key="12686"><span data-slate-leaf="true" data-offset-key="12686:0" data-first-offset="true"><span data-slate-string="true">，其密码为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12687"><span data-slate-object="text" data-key="12688"><span data-slate-leaf="true" data-offset-key="12688:0" data-first-offset="true"><span data-slate-string="true"> iam59!z$</span></span></span></span><span data-slate-object="text" data-key="12689"><span data-slate-leaf="true" data-offset-key="12689:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12690"><span data-slate-object="text" data-key="12691"><span data-slate-leaf="true" data-offset-key="12691:0" data-first-offset="true"><span data-slate-string="true">接下来，我们就可以创建 docker-registry secret。Kubernetes 在下载 Docker 镜像时，需要 docker-registry secret 来进行认证。创建命令如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12692"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12693"><span data-slate-object="text" data-key="12694"><span data-slate-leaf="true" data-offset-key="12694:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam create secret docker-registry ccr-registry --docker-server=ccr.ccs.tencentyun.com --docker-username=10000099xxxx --docker-password=</span></span></span><span data-slate-object="text" data-key="12695"><span data-slate-leaf="true" data-offset-key="12695:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'iam59!z$'</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12696"><div data-slate-type="list-line" data-slate-object="block" data-key="12697"><div data-code-line-number="7"></div><div><span data-slate-object="text" data-key="12698"><span data-slate-leaf="true" data-offset-key="12698:0" data-first-offset="true"><span data-slate-string="true">创建 Docker 镜像，并 Push 到镜像仓库</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12699"><span data-slate-object="text" data-key="12700"><span data-slate-leaf="true" data-offset-key="12700:0" data-first-offset="true"><span data-slate-string="true">将镜像 Push 到 CCR 镜像仓库，需要确保你已经登录到腾讯云 CCR 镜像仓库，如果没登录，可以执行以下命令来登录：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12701"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12702"><span data-slate-object="text" data-key="12703"><span data-slate-leaf="true" data-offset-key="12703:0" data-first-offset="true"><span data-slate-string="true">$ docker login --username=[username] ccr.ccs.tencentyun.com</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12704"><span data-slate-object="text" data-key="12705"><span data-slate-leaf="true" data-offset-key="12705:0" data-first-offset="true"><span data-slate-string="true">执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12706"><span data-slate-object="text" data-key="12707"><span data-slate-leaf="true" data-offset-key="12707:0" data-first-offset="true"><span data-slate-string="true">make push</span></span></span></span><span data-slate-object="text" data-key="12708"><span data-slate-leaf="true" data-offset-key="12708:0" data-first-offset="true"><span data-slate-string="true"> 命令构建镜像，并将镜像 Push 到 CCR 镜像仓库：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12709"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12710"><span data-slate-object="text" data-key="12711"><span data-slate-leaf="true" data-offset-key="12711:0" data-first-offset="true"><span data-slate-string="true">$ make push REGISTRY_PREFIX=ccr.ccs.tencentyun.com/marmotedu VERSION=v1.1.0</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12712"><span data-slate-object="text" data-key="12713"><span data-slate-leaf="true" data-offset-key="12713:0" data-first-offset="true"><span data-slate-string="true">上述命令，会构建 iam-apiserver-amd64、iam-authz-server-amd64、iam-pump-amd64、iamctl-amd64 四个镜像，并将这些镜像 Push 到腾讯云镜像仓库的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12714"><span data-slate-object="text" data-key="12715"><span data-slate-leaf="true" data-offset-key="12715:0" data-first-offset="true"><span data-slate-string="true"> marmotedu</span></span></span></span><span data-slate-object="text" data-key="12716"><span data-slate-leaf="true" data-offset-key="12716:0" data-first-offset="true"><span data-slate-string="true"> 命名空间下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12717"><span data-slate-object="text" data-key="12718"><span data-slate-leaf="true" data-offset-key="12718:0" data-first-offset="true"><span data-slate-string="true">构建的镜像如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12719"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12720"><span data-slate-object="text" data-key="12721"><span data-slate-leaf="true" data-offset-key="12721:0" data-first-offset="true"><span data-slate-string="true">$ docker images|grep marmotedu</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12722"><span data-slate-object="text" data-key="12723"><span data-slate-leaf="true" data-offset-key="12723:0" data-first-offset="true"><span data-slate-string="true">ccr.ccs.tencentyun.com/marmotedu/iam-pump-amd64           v1.1.0   e078d340e3fb        10 seconds ago      244MB</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12724"><span data-slate-object="text" data-key="12725"><span data-slate-leaf="true" data-offset-key="12725:0" data-first-offset="true"><span data-slate-string="true">ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64      v1.1.0   5e90b67cc949        2 minutes ago       239MB</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12726"><span data-slate-object="text" data-key="12727"><span data-slate-leaf="true" data-offset-key="12727:0" data-first-offset="true"><span data-slate-string="true">ccr.ccs.tencentyun.com/marmotedu/iam-authz-server-amd64   v1.1.0   6796b02be68c        2 minutes ago       238MB</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12728"><span data-slate-object="text" data-key="12729"><span data-slate-leaf="true" data-offset-key="12729:0" data-first-offset="true"><span data-slate-string="true">ccr.ccs.tencentyun.com/marmotedu/iamctl-amd64             v1.1.0   320a77d525e3        2 minutes ago       235MB</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="list" data-slate-object="block" data-key="12730"><div data-slate-type="list-line" data-slate-object="block" data-key="12731"><div data-code-line-number="8"></div><div><span data-slate-object="text" data-key="12732"><span data-slate-leaf="true" data-offset-key="12732:0" data-first-offset="true"><span data-slate-string="true">修改 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12733"><span data-slate-object="text" data-key="12734"><span data-slate-leaf="true" data-offset-key="12734:0" data-first-offset="true"><span data-slate-string="true">${IAM_ROOT}/deployments/iam.yaml</span></span></span></span><span data-slate-object="text" data-key="12735"><span data-slate-leaf="true" data-offset-key="12735:0" data-first-offset="true"><span data-slate-string="true"> 配置</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12736"><span data-slate-object="text" data-key="12737"><span data-slate-leaf="true" data-offset-key="12737:0" data-first-offset="true"><span data-slate-string="true">这里请你注意，如果在上一个步骤中，你构建的镜像 tag 不是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12738"><span data-slate-object="text" data-key="12739"><span data-slate-leaf="true" data-offset-key="12739:0" data-first-offset="true"><span data-slate-string="true">v1.1.0</span></span></span></span><span data-slate-object="text" data-key="12740"><span data-slate-leaf="true" data-offset-key="12740:0" data-first-offset="true"><span data-slate-string="true"> ，那么你需要修改  </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12741"><span data-slate-object="text" data-key="12742"><span data-slate-leaf="true" data-offset-key="12742:0" data-first-offset="true"><span data-slate-string="true">${IAM_ROOT}/deployments/iam.yaml</span></span></span></span><span data-slate-object="text" data-key="12743"><span data-slate-leaf="true" data-offset-key="12743:0" data-first-offset="true"><span data-slate-string="true"> 文件，并将 iam-apiserver-amd64、 iam-authz-server-amd64、 iam-pump-amd64、iamctl-amd64 镜像的 tag 修改成你构建镜像时指定的 tag。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12744"><div data-slate-type="list-line" data-slate-object="block" data-key="12745"><div data-code-line-number="9"></div><div><span data-slate-object="text" data-key="12746"><span data-slate-leaf="true" data-offset-key="12746:0" data-first-offset="true"><span data-slate-string="true">部署 IAM 应用</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12747"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12748"><span data-slate-object="text" data-key="12749"><span data-slate-leaf="true" data-offset-key="12749:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam apply -f </span></span></span><span data-slate-object="text" data-key="12750"><span data-slate-leaf="true" data-offset-key="12750:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${IAM_ROOT}</span></span></span></span><span data-slate-object="text" data-key="12751"><span data-slate-leaf="true" data-offset-key="12751:0" data-first-offset="true"><span data-slate-string="true">/deployments/iam.yaml</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12752"><span data-slate-object="text" data-key="12753"><span data-slate-leaf="true" data-offset-key="12753:0" data-first-offset="true"><span data-slate-string="true">执行上述命令，会在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12754"><span data-slate-object="text" data-key="12755"><span data-slate-leaf="true" data-offset-key="12755:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12756"><span data-slate-leaf="true" data-offset-key="12756:0" data-first-offset="true"><span data-slate-string="true"> 命令空间下，创建一系列 Kubernetes 资源，可以使用以下命令，来获取这些资源的状态：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12757"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12758"><span data-slate-object="text" data-key="12759"><span data-slate-leaf="true" data-offset-key="12759:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam get all</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12760"><span data-slate-object="text" data-key="12761"><span data-slate-leaf="true" data-offset-key="12761:0" data-first-offset="true"><span data-slate-string="true">NAME                                    READY   STATUS    RESTARTS   AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12762"><span data-slate-object="text" data-key="12763"><span data-slate-leaf="true" data-offset-key="12763:0" data-first-offset="true"><span data-slate-string="true">pod/iam-apiserver-d8dc48596-wkhpl       1/1     Running   0          94m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12764"><span data-slate-object="text" data-key="12765"><span data-slate-leaf="true" data-offset-key="12765:0" data-first-offset="true"><span data-slate-string="true">pod/iam-authz-server-6bc899c747-fbpbk   1/1     Running   0          94m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12766"><span data-slate-object="text" data-key="12767"><span data-slate-leaf="true" data-offset-key="12767:0" data-first-offset="true"><span data-slate-string="true">pod/iam-pump-7dcbfd4f59-2w9vk           1/1     Running   0          94m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12768"><span data-slate-object="text" data-key="12769"><span data-slate-leaf="true" data-offset-key="12769:0" data-first-offset="true"><span data-slate-string="true">pod/iamctl-6fc46b8ccb-gs62l             1/1     Running   1          98m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12770"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12771"><span data-slate-object="text" data-key="12772"><span data-slate-leaf="true" data-offset-key="12772:0" data-first-offset="true"><span data-slate-string="true">NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12773"><span data-slate-object="text" data-key="12774"><span data-slate-leaf="true" data-offset-key="12774:0" data-first-offset="true"><span data-slate-string="true">service/iam-apiserver      ClusterIP   192.168.0.174   &lt;none&gt;        8443/TCP,8080/TCP,8081/TCP   101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12775"><span data-slate-object="text" data-key="12776"><span data-slate-leaf="true" data-offset-key="12776:0" data-first-offset="true"><span data-slate-string="true">service/iam-authz-server   ClusterIP   192.168.0.76    &lt;none&gt;        9443/TCP,9090/TCP            101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12777"><span data-slate-object="text" data-key="12778"><span data-slate-leaf="true" data-offset-key="12778:0" data-first-offset="true"><span data-slate-string="true">service/iam-pump           ClusterIP   192.168.0.155   &lt;none&gt;        7070/TCP                     101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12779"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12780"><span data-slate-object="text" data-key="12781"><span data-slate-leaf="true" data-offset-key="12781:0" data-first-offset="true"><span data-slate-string="true">NAME                               READY   UP-TO-DATE   AVAILABLE   AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12782"><span data-slate-object="text" data-key="12783"><span data-slate-leaf="true" data-offset-key="12783:0" data-first-offset="true"><span data-slate-string="true">deployment.apps/iam-apiserver      1/1     1            1           101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12784"><span data-slate-object="text" data-key="12785"><span data-slate-leaf="true" data-offset-key="12785:0" data-first-offset="true"><span data-slate-string="true">deployment.apps/iam-authz-server   1/1     1            1           101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12786"><span data-slate-object="text" data-key="12787"><span data-slate-leaf="true" data-offset-key="12787:0" data-first-offset="true"><span data-slate-string="true">deployment.apps/iam-pump           1/1     1            1           101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12788"><span data-slate-object="text" data-key="12789"><span data-slate-leaf="true" data-offset-key="12789:0" data-first-offset="true"><span data-slate-string="true">deployment.apps/iamctl             1/1     1            1           101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12790"></div><div data-slate-type="code-line" data-slate-object="block" data-key="12791"><span data-slate-object="text" data-key="12792"><span data-slate-leaf="true" data-offset-key="12792:0" data-first-offset="true"><span data-slate-string="true">NAME                                          DESIRED   CURRENT   READY   AGE</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12793"><span data-slate-object="text" data-key="12794"><span data-slate-leaf="true" data-offset-key="12794:0" data-first-offset="true"><span data-slate-string="true">replicaset.apps/iam-apiserver-d8dc48596       1         1         1       101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12795"><span data-slate-object="text" data-key="12796"><span data-slate-leaf="true" data-offset-key="12796:0" data-first-offset="true"><span data-slate-string="true">replicaset.apps/iam-authz-server-6bc899c747   1         1         1       101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12797"><span data-slate-object="text" data-key="12798"><span data-slate-leaf="true" data-offset-key="12798:0" data-first-offset="true"><span data-slate-string="true">replicaset.apps/iam-pump-7dcbfd4f59           1         1         1       101m</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12799"><span data-slate-object="text" data-key="12800"><span data-slate-leaf="true" data-offset-key="12800:0" data-first-offset="true"><span data-slate-string="true">replicaset.apps/iamctl-6fc46b8ccb             1         1         1       101m</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12801"><span data-slate-object="text" data-key="12802"><span data-slate-leaf="true" data-offset-key="12802:0" data-first-offset="true"><span data-slate-string="true">我们看到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12803"><span data-slate-object="text" data-key="12804"><span data-slate-leaf="true" data-offset-key="12804:0" data-first-offset="true"><span data-slate-string="true"> pod/iam-apiserver-d8dc48596-wkhpl</span></span></span></span><span data-slate-object="text" data-key="12805"><span data-slate-leaf="true" data-offset-key="12805:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12806"><span data-slate-object="text" data-key="12807"><span data-slate-leaf="true" data-offset-key="12807:0" data-first-offset="true"><span data-slate-string="true">pod/iam-authz-server-6bc899c747-fbpbk</span></span></span></span><span data-slate-object="text" data-key="12808"><span data-slate-leaf="true" data-offset-key="12808:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12809"><span data-slate-object="text" data-key="12810"><span data-slate-leaf="true" data-offset-key="12810:0" data-first-offset="true"><span data-slate-string="true">pod/iam-pump-7dcbfd4f59-2w9vk</span></span></span></span><span data-slate-object="text" data-key="12811"><span data-slate-leaf="true" data-offset-key="12811:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12812"><span data-slate-object="text" data-key="12813"><span data-slate-leaf="true" data-offset-key="12813:0" data-first-offset="true"><span data-slate-string="true">pod/iamctl-6fc46b8ccb-gs62l</span></span></span></span><span data-slate-object="text" data-key="12814"><span data-slate-leaf="true" data-offset-key="12814:0" data-first-offset="true"><span data-slate-string="true"> 4 个 Pod 都处在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12815"><span data-slate-object="text" data-key="12816"><span data-slate-leaf="true" data-offset-key="12816:0" data-first-offset="true"><span data-slate-string="true"> Running</span></span></span></span><span data-slate-object="text" data-key="12817"><span data-slate-leaf="true" data-offset-key="12817:0" data-first-offset="true"><span data-slate-string="true"> 状态，说明服务都成功启动。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12818" id="sr-toc-9"><span data-slate-object="text" data-key="12819"><span data-slate-leaf="true" data-offset-key="12819:0" data-first-offset="true"><span data-slate-string="true">测试 IAM 应用</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12820"><span data-slate-object="text" data-key="12821"><span data-slate-leaf="true" data-offset-key="12821:0" data-first-offset="true"><span data-slate-string="true">我们在</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12822"><span data-slate-object="text" data-key="12823"><span data-slate-leaf="true" data-offset-key="12823:0" data-first-offset="true"><span data-slate-string="true"> iam</span></span></span></span><span data-slate-object="text" data-key="12824"><span data-slate-leaf="true" data-offset-key="12824:0" data-first-offset="true"><span data-slate-string="true"> 命令空间下创建了一个测试 Deployment </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12825"><span data-slate-object="text" data-key="12826"><span data-slate-leaf="true" data-offset-key="12826:0" data-first-offset="true"><span data-slate-string="true">iamctl</span></span></span></span><span data-slate-object="text" data-key="12827"><span data-slate-leaf="true" data-offset-key="12827:0" data-first-offset="true"><span data-slate-string="true">。你可以登陆</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12828"><span data-slate-object="text" data-key="12829"><span data-slate-leaf="true" data-offset-key="12829:0" data-first-offset="true"><span data-slate-string="true"> iamctl</span></span></span></span><span data-slate-object="text" data-key="12830"><span data-slate-leaf="true" data-offset-key="12830:0" data-first-offset="true"><span data-slate-string="true"> Deployment 所创建出来的 Pod，执行一些运维操作和冒烟测试。登陆命令如下：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12831"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12832"><span data-slate-object="text" data-key="12833"><span data-slate-leaf="true" data-offset-key="12833:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam </span></span></span><span data-slate-object="text" data-key="12834"><span data-slate-leaf="true" data-offset-key="12834:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">exec</span></span></span></span><span data-slate-object="text" data-key="12835"><span data-slate-leaf="true" data-offset-key="12835:0" data-first-offset="true"><span data-slate-string="true"> -it `kubectl -n iam get pods -l app=iamctl | awk </span></span></span><span data-slate-object="text" data-key="12836"><span data-slate-leaf="true" data-offset-key="12836:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'/iamctl/{print $1}'</span></span></span></span><span data-slate-object="text" data-key="12837"><span data-slate-leaf="true" data-offset-key="12837:0" data-first-offset="true"><span data-slate-string="true">` -- bash</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12838"><span data-slate-object="text" data-key="12839"><span data-slate-leaf="true" data-offset-key="12839:0" data-first-offset="true"><span data-slate-string="true">登陆到</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12840"><span data-slate-object="text" data-key="12841"><span data-slate-leaf="true" data-offset-key="12841:0" data-first-offset="true"><span data-slate-string="true"> iamctl-xxxxxxxxxx-xxxxx</span></span></span></span><span data-slate-object="text" data-key="12842"><span data-slate-leaf="true" data-offset-key="12842:0" data-first-offset="true"><span data-slate-string="true"> Pod 中后，就可以执行运维操作和冒烟测试了。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12843"><div data-slate-type="list-line" data-slate-object="block" data-key="12844"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12845"><span data-slate-leaf="true" data-offset-key="12845:0" data-first-offset="true"><span data-slate-string="true">运维操作</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12846"><span data-slate-object="text" data-key="12847"><span data-slate-leaf="true" data-offset-key="12847:0" data-first-offset="true"><span data-slate-string="true">在 iamctl 容器中，你可以使用 iamctl 工具提供的各类功能，iamctl 以子命令的方式对外提供功能。命令执行效果见下图：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12848"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/44/7e/4460dfd5cd7f7fae5cbb0c64e605367e.png?wh=1920x433"></div></div><div data-slate-type="list" data-slate-object="block" data-key="12849"><div data-slate-type="list-line" data-slate-object="block" data-key="12850"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12851"><span data-slate-leaf="true" data-offset-key="12851:0" data-first-offset="true"><span data-slate-string="true">冒烟测试</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12852"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12853"><span data-slate-object="text" data-key="12854"><span data-slate-leaf="true" data-offset-key="12854:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># cd /opt/iam/scripts/install</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12855"><span data-slate-object="text" data-key="12856"><span data-slate-leaf="true" data-offset-key="12856:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># ./test.sh iam::test::smoke</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12857"><span data-slate-object="text" data-key="12858"><span data-slate-leaf="true" data-offset-key="12858:0" data-first-offset="true"><span data-slate-string="true">如果</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12859"><span data-slate-object="text" data-key="12860"><span data-slate-leaf="true" data-offset-key="12860:0" data-first-offset="true"><span data-slate-string="true">./test.sh iam::test::smoke</span></span></span></span><span data-slate-object="text" data-key="12861"><span data-slate-leaf="true" data-offset-key="12861:0" data-first-offset="true"><span data-slate-string="true"> 命令，打印的输出中，最后一行为</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12862"><span data-slate-object="text" data-key="12863"><span data-slate-leaf="true" data-offset-key="12863:0" data-first-offset="true"><span data-slate-string="true"> congratulations, smoke test passed!</span></span></span></span><span data-slate-object="text" data-key="12864"><span data-slate-leaf="true" data-offset-key="12864:0" data-first-offset="true"><span data-slate-string="true"> 字符串，说明 IAM 应用安装成功。如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="12865"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b9/2e/b9688e6b0609571a06401da412b63d2e.png?wh=1920x603"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12866" id="sr-toc-10"><span data-slate-object="text" data-key="12867"><span data-slate-leaf="true" data-offset-key="12867:0" data-first-offset="true"><span data-slate-string="true">销毁 Serverless 集群及其资源</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12868"><span data-slate-object="text" data-key="12869"><span data-slate-leaf="true" data-offset-key="12869:0" data-first-offset="true"><span data-slate-string="true">好了，到这里，你已经成功在 Serverless 集群中部署了 IAM 应用，Serverless 的使命也就完成了。接下来，为避免账户被持续扣费，需要删除 Serverless 内的资源和集群。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12870"><div data-slate-type="list-line" data-slate-object="block" data-key="12871"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12872"><span data-slate-leaf="true" data-offset-key="12872:0" data-first-offset="true"><span data-slate-string="true">删除 Serverless 内创建的 IAM 资源</span></span></span></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12873"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12874"><span data-slate-object="text" data-key="12875"><span data-slate-leaf="true" data-offset-key="12875:0" data-first-offset="true"><span data-slate-string="true">$ kubectl delete namespace iam</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12876"><span data-slate-object="text" data-key="12877"><span data-slate-leaf="true" data-offset-key="12877:0" data-first-offset="true"><span data-slate-string="true">因为删除 Namespace 会删除 Namespace 下的所有资源，所以上述命令执行时间会久点。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="12878"><div data-slate-type="list-line" data-slate-object="block" data-key="12879"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12880"><span data-slate-leaf="true" data-offset-key="12880:0" data-first-offset="true"><span data-slate-string="true">删除 Serverless 集群</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12881"><span data-slate-object="text" data-key="12882"><span data-slate-leaf="true" data-offset-key="12882:0" data-first-offset="true"><span data-slate-string="true">登录腾讯云容器服务控制台，选择所创建的 Serverless 集群，删除即可。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12883" id="sr-toc-11"><span data-slate-object="text" data-key="12884"><span data-slate-leaf="true" data-offset-key="12884:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="12885"><span data-slate-object="text" data-key="12886"><span data-slate-leaf="true" data-offset-key="12886:0" data-first-offset="true"><span data-slate-string="true">云原生架构设计中，需要将 IAM 应用部署到 Kubernetes 集群中。所以，首先需要你准备一个 Kubernetes 集群。你可以自己购买腾讯云 CVM 机器搭建 Kubernetes 集群，但这种方式费用高、操作复杂。所以，我建议你直接申请一个 Serverless 集群来部署 IAM 应用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12887"><span data-slate-object="text" data-key="12888"><span data-slate-leaf="true" data-offset-key="12888:0" data-first-offset="true"><span data-slate-string="true">Serverless 集群是一个标准的 Kubernetes 集群，可以快速申请，并免运维。Serverless 集群只收取实际的资源使用费用。在专栏学习过程中，部署 IAM 应用期间产生的资源使用费用其实是很低的，所以推荐使用这种方式来部署 IAM 应用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12889"><span data-slate-object="text" data-key="12890"><span data-slate-leaf="true" data-offset-key="12890:0" data-first-offset="true"><span data-slate-string="true">有了 Kubernetes 集群，就可以直接通过以下命令来部署整个 IAM 应用：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12891"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12892"><span data-slate-object="text" data-key="12893"><span data-slate-leaf="true" data-offset-key="12893:0" data-first-offset="true"><span data-slate-string="true">$ kubectl -n iam apply -f </span></span></span><span data-slate-object="text" data-key="12894"><span data-slate-leaf="true" data-offset-key="12894:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">${IAM_ROOT}</span></span></span></span><span data-slate-object="text" data-key="12895"><span data-slate-leaf="true" data-offset-key="12895:0" data-first-offset="true"><span data-slate-string="true">/deployments/iam.yaml</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12896"><span data-slate-object="text" data-key="12897"><span data-slate-leaf="true" data-offset-key="12897:0" data-first-offset="true"><span data-slate-string="true">应用部署起来之后，我们可以登陆到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="12898"><span data-slate-object="text" data-key="12899"><span data-slate-leaf="true" data-offset-key="12899:0" data-first-offset="true"><span data-slate-string="true">iamctl-xxxxxxxxxx-xxxxx</span></span></span></span><span data-slate-object="text" data-key="12900"><span data-slate-leaf="true" data-offset-key="12900:0" data-first-offset="true"><span data-slate-string="true">Pod，并执行以下命令来测试整个 IAM 应用是否被成功部署：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="12901"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="12902"><span data-slate-object="text" data-key="12903"><span data-slate-leaf="true" data-offset-key="12903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># cd /opt/iam/scripts/install</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="12904"><span data-slate-object="text" data-key="12905"><span data-slate-leaf="true" data-offset-key="12905:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># ./test.sh iam::test::smoke</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="12906" id="sr-toc-12"><span data-slate-object="text" data-key="12907"><span data-slate-leaf="true" data-offset-key="12907:0" data-first-offset="true"><span data-slate-string="true">课后练习</span></span></span></h2><div data-slate-type="list" data-slate-object="block" data-key="12908"><div data-slate-type="list-line" data-slate-object="block" data-key="12909"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="12910"><span data-slate-leaf="true" data-offset-key="12910:0" data-first-offset="true"><span data-slate-string="true">思考下，如何将 MariaDB、MongoDB、Redis 实现容器化？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="12911"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="12912"><span data-slate-leaf="true" data-offset-key="12912:0" data-first-offset="true"><span data-slate-string="true">思考下，如何更相信 IAM 应用中的 iam-apiserver 服务，试着更新这个服务。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="12913"><span data-slate-object="text" data-key="12914"><span data-slate-leaf="true" data-offset-key="12914:0" data-first-offset="true"><span data-slate-string="true">欢迎你在留言区与我交流讨论，我们下一讲见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-13">精选留言 (3)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/05/11/06ae74fa.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Mr. 凉</span></div></div><div>老师您好，这块有点没懂，为什么执行 make push 就会生成下面四个镜像？

$ make push REGISTRY_PREFIX=ccr.ccs.tencentyun.com/marmotedu VERSION=v1.1.0

上述命令，会构建 iam-apiserver-amd64、iam-authz-server-amd64、iam-pump-amd64、iamctl-amd64 四个镜像


</div><div><p>作者回复: make push 会执行 scripts/make-rules/image.mk 下的 image.push 规则，改规则依赖如下：image.verify go.build.verify $(addprefix image.push., $(addprefix $(IMAGE_PLAT)., $(IMAGES)))

也就是执行 make push 前会依次执行以下操作：
1. 检查机器是否安装了 docker，以及 docker 的版本是否符合预期
2. 检查是否安装了 go，以及 go 版本是否符合预期
3. 构建镜像（image.build.%）
4. 执行 docker push 上传镜像到指定的镜像仓库</p></div><div><div>2021-12-28</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>yandongxiao</span></div></div><div>总结：
1. 开通容器服务镜像仓库，自己搭建的话可以使用 harbor
2. 安装并配置 Docker，配置主要包括，docker 通过非 root 用户使用；配置 docker 开启启动；
3. 准备一个 Kubernetes 集群。可以参见 follow-me-install-kubernetes-cluster 教程</div><div><p>作者回复:  follow-me-install-kubernetes-cluster 是一个非常好的教程，搭建 Kubernetes，建议参考下。</p></div><div><div>2021-12-05</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Realm</span></div></div><div>老师好！iam-apiserver 使用到 MySQL 和 cache，在 k8s 集群中部署以上 4 个应用，iam-apiserver 的 Pod 连不上 MySQL，应用拉不起来。</div><div><p>作者回复：可以看下《EKS 集群开通集群内服务访问外网能力》这部分，EKS 集群需要开启外网访问能力，开启后可以通过 Pod 访问 MySQL。

注意：
1. MySQL 需要 bind 0.0.0.0 地址
2. 并且授权的来源 IP 最好设置为 %，也就是任意来源 IP 可访问数据库

这个说明我稍后会更新到专栏中</p></div><div><div>2021-09-26</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".11"><outline class="toc-level-h1" data-reactid=".11.0" style="width: 175px;"><active data-reactid=".11.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".11.0.1"><span data-reactid=".11.0.1.0"> 48 | IAM 容器化部署实战</span></a></outline><outline class="toc-level-h2" data-reactid=".11.1" style="width: 165px;"><active data-reactid=".11.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".11.1.1"><span data-reactid=".11.1.1.0">准备工作</span></a></outline><outline class="toc-level-h3" data-reactid=".11.2" style="width: 155px;"><active data-reactid=".11.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".11.2.1"><span data-reactid=".11.2.1.0">开通腾讯云容器服务镜像仓库</span></a></outline><outline class="toc-level-h3" data-reactid=".11.3" style="width: 155px;"><active data-reactid=".11.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".11.3.1"><span data-reactid=".11.3.1.0">安装 Docker</span></a></outline><outline class="toc-level-h3" data-reactid=".11.4" style="width: 155px;"><active data-reactid=".11.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".11.4.1"><span data-reactid=".11.4.1.0">准备一个 Kubernetes 集群</span></a></outline><outline class="toc-level-h4" data-reactid=".11.5" style="width: 145px;"><active data-reactid=".11.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".11.5.1"><span data-reactid=".11.5.1.0">EKS 简介</span></a></outline><outline class="toc-level-h4" data-reactid=".11.6" style="width: 145px;"><active data-reactid=".11.6.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".11.6.1"><span data-reactid=".11.6.1.0">EKS 费用</span></a></outline><outline class="toc-level-h4" data-reactid=".11.7" style="width: 145px;"><active data-reactid=".11.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".11.7.1"><span data-reactid=".11.7.1.0">申请 EKS 集群</span></a></outline><outline class="toc-level-h2" data-reactid=".11.8" style="width: 165px;"><active data-reactid=".11.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".11.8.1"><span data-reactid=".11.8.1.0">安装 IAM 应用</span></a></outline><outline class="toc-level-h2" data-reactid=".11.9" style="width: 165px;"><active data-reactid=".11.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".11.9.1"><span data-reactid=".11.9.1.0">测试 IAM 应用</span></a></outline><outline class="toc-level-h2" data-reactid=".11.a" style="width: 165px;"><active data-reactid=".11.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".11.a.1"><span data-reactid=".11.a.1.0">销毁 Serverless 集群及其资源</span></a></outline><outline class="toc-level-h2" data-reactid=".11.b" style="width: 165px;"><active data-reactid=".11.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".11.b.1"><span data-reactid=".11.b.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".11.c" style="width: 165px;"><active data-reactid=".11.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".11.c.1"><span data-reactid=".11.c.1.0">课后练习</span></a></outline><outline class="toc-level-h2" data-reactid=".11.d" style="width: 165px;"><active data-reactid=".11.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".11.d.1"><span data-reactid=".11.d.1.0">精选留言 (3)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/418711" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>