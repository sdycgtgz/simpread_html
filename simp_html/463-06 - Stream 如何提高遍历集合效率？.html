
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,R0lGODlhMAAwAPcAAAAAABMTExUVFRsbGx0dHSYmJikpKS8vLzAwMDc3Nz4+PkJCQkRERElJSVBQUFdXV1hYWFxcXGNjY2RkZGhoaGxsbHFxcXZ2dnl5eX9/f4GBgYaGhoiIiI6OjpKSkpaWlpubm56enqKioqWlpampqa6urrCwsLe3t7q6ur6+vsHBwcfHx8vLy8zMzNLS0tXV1dnZ2dzc3OHh4eXl5erq6u7u7vLy8vf39/n5+f///wEBAQQEBA4ODhkZGSEhIS0tLTk5OUNDQ0pKSk1NTV9fX2lpaXBwcHd3d35+foKCgoSEhIuLi4yMjJGRkZWVlZ2dnaSkpKysrLOzs7u7u7y8vMPDw8bGxsnJydvb293d3eLi4ubm5uvr6+zs7Pb29gYGBg8PDyAgICcnJzU1NTs7O0ZGRkxMTFRUVFpaWmFhYWVlZWtra21tbXNzc3V1dXh4eIeHh4qKipCQkJSUlJiYmJycnKampqqqqrW1tcTExMrKys7OztPT09fX19jY2Ojo6PPz8/r6+hwcHCUlJTQ0NDg4OEFBQU9PT11dXWBgYGZmZm9vb3Jycnp6en19fYCAgIWFhaurq8DAwMjIyM3NzdHR0dTU1ODg4OTk5Onp6fDw8PX19fv7+xgYGB8fHz8/P0VFRVZWVl5eXmpqanR0dImJiaCgoKenp6+vr9/f3+fn5+3t7fHx8QUFBQgICBYWFioqKlVVVWJiYo+Pj5eXl6ioqLa2trm5udbW1vT09C4uLkdHR1FRUVtbW3x8fJmZmcXFxc/Pz42Njb+/v+/v7/j4+EtLS5qamri4uL29vdDQ0N7e3jIyMpOTk6Ojo7GxscLCwisrK1NTU1lZWW5ubkhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/i1NYWRlIGJ5IEtyYXNpbWlyYSBOZWpjaGV2YSAod3d3LmxvYWRpbmZvLm5ldCkAIfkEAAoA/wAsAAAAADAAMAAABv/AnHBILBqPyKRySXyNSC+mdFqEAAARqpaIux0dVwduq2VJLN7iI3ys0cZkosogIJSKODBAXLzJYjJpcTkuCAIBDTRceg5GNDGAcIM5GwKWHkWMkjk2kDI1k0MzCwEBCTBEeg9cM5AzoUQjAwECF5KaQzWQMYKwNhClBStDjEM4fzGKZCxRRioFpRA2OXlsQrqAvUM300gsCgofr0UWhwMjQhgHBxhjfpCgeDMtLtpCOBYG+g4lvS8JAQZoEHKjRg042GZsylHjBYuHMY7gyHBAn4EDE1ZI8tCAhL1tNLoJsQGDxYoVEJHcOPHAooEEGSLmKKjlWIuHKF/ES0IjxAL/lwxCfFRCwwVKlC4UTomxIYFFaVtKomzBi8yKCetMkKnxEIZIMjdKdBi6ZIYyWAthSZGUVu0RGRsyyJ07V0SoGC3yutCrN40KcIADK6hAlgmLE4hNIF58QlmKBYIDV2g75bBixouVydCAAUOGzp87h6AsBQa9vfTy0uuFA86Y1m5jyyaDQwUJ0kpexMC95AWHBw9YkJlBYoSKs1RmhJDgoIGDDIWN1BZBvUSLr0psmKDgoLuDCSZ4G4FhgrqIESZeFMbBAsOD7g0ifJBxT7wkGyxImB+Bgr7EEA8418ADGrhARAodtKCEDNYRQYNt+wl3RAfNOWBBCr3MkMEEFZxg3YwkLXjQQQg7URPDCSNQN8wRMEggwQjICUECBRNQoIIQKYAAQgpCvOABBx2ksNANLpRQQolFuCBTETBYQOMHaYxwwQV2UVMCkPO1MY4WN3wwwQQWNJPDCJ2hI4QMH3TQQXixsVDBlyNIIiUGZuKopgdihmLDBjVisOWYGFxQJ0MhADkCdnGcQCMFHsZyAQZVDhEikCtOIsMFNXKAHZmQ9kFCBxyAEGNUmFYgIREiTDmoEDCICMKfccQAgghpiRDoqtSkcAKsk7RlK51IiAcLCZ2RMJsWRbkw6rHMFhEEACH5BAAKAP8ALAAAAAAwADAAAAf/gDmCg4SFhoeIiYqLhFhRUViMkpOFEwICE5SahDg4hjgSAQJEh16em4ctRklehkQBAaSFXhMPVaiFVwoGPyeFOK+xp4MkOzoCVLiDL7sGEF2cwbKDW0A6Oj0tyoNOBt5PhUQCwoRL1zpI29QO3gxZhNLDLz7XP1rqg1E/3kmDwLDTcBS5tgMcPkG0vCW4MkjaICoBrgmxgcrFO0NWEnib0OofORtDrvGYcqhTIhcOHIjgYgiJtx9RcuBQEiSIEkFPjOnIZMiGFi3DCiVRQFTClFaDsDDg1UQQDhs2kB4x1uPFrC1ZsrL8tCQIUQVBMLgY9uSBFKSGvEABwoSQFy5Z/7NqgVZqygSvRIU0uSeTrqIuSHF00RI3yxa0iLqIePBVwYMoQSX5LKyF4qQsTIR8NYJYEla5XSIzwnHFSBAGtzZ5IcylsyYvJ564lmz5oO3buAttabKEie/fS5bE3LYFi/Hjx7MgtZKyefMhQzCIpvTiipUr2LNjp8vcuXck0ydVt649O90tTIIrUbKEfXsS4T0jn6+ck0x/8XPr34/Dyon8iRimDhZOFFGBC6hwMcUULfhFCRckGFHEBEUwAeAvLUhxwglUYDFbXRgUMeEEGExxYSFaULHhhlUApQgOLSwh4gQTGCECXyYtMowNL6i44hVcTIcDCRXQOEEFTVg1SPAVT0SSyBZVKClIFy1MIYWGUzhpyBM0FpGEFYhxscQRSKTmiTwkiCBFbTJt4d+GCB6CxRFHROGgTFLQiYQ2OVxBAgkM5ZAFFCKIECgnWVBBBZuFvMBXIVkkcQQGIpwiRXBSOFVFoSRsVYgNd0qCwxMYHJHERTlcykSmgkBYaBUnStICEhhgIMUwly7BqiBXFAoFqurY0ASdS3iaam+75mCDFIWe8KEmVJSKQWqD5JpsDi8QCoWUymwxJgZOMGrtL1QUaqc6WShBJreCjItimlEYi4sWUNxqiLu5WCHvNtPhu98iJ/hG0r+MdGFcqAQTHAgAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDALHjxZGEqcWNCNAQNvKGokGCjQQTYX2Ry84XHjQT4a5JQk2CakwRtu1OQxWXCPAwVlqhQMBNJAm5UCoxAIcEAnTYF+bipYU4NjSwNsgP5pEIAon6MD6yjYeqdgzzYF5QgIIAAO1oF/0mxFI4NgT5ED/YypuqDtWYFSFmyVMzDQ06gCA7kZO8DO3YGA2mw1c1Xg24FVxIxFA8hkH7sF9TTY+uZGDr8XweYAhKaqGCoH96BG2CeNmihNOTLZugCFQCYOHDARaGcAWdEEZ2QYIMCoQTlmcrep4nlgljM4RQQGBKi5Bt9j+hAEVAcBgO9ngAb/pnMmt4MzcLQPtMOmiviBN6KU4RuYSoMv3wF8UdN8ZxU35jkQAR0zCHRDZQvVUFIfaoCRHwBk3PEeQTVEoUaAa+AxYUI3xEHAg2HE8cdEM8yBRm5mZNCfRDWQkR8Ya6inEUoOoKGHSXZ88UUDVGzI0A0oSGgSIG/UseJhG/k4kZJIolUHHXQ8CeWUGmIFyB9YZvlHDVuWpMcaa6ihRphgihkHkwr9kcWabLbZ3B5hihnnmGowgWZCM7SpZxYIzkDHHHP8CeigUpzFpZaIirfSnU026ihHexi30QyxHZVFHW9k4IdJNeyhhx8IalSDFHC8YWodjA7Uhx6s7iEDozdU/8HEG26YGoekE/3hKat68FGgQoHwMYeptGogxYiBaXRDFp7mwSqoCAUiRQbEZiBCRAPtIQW2CP2hB2aj+cErq+ASZAexcuwBVA11MJFuXytlgQIezBX0x6qscltQFnDEQUWoA1HBhLvq8YECCurNMC8Km+40wx57HNnQrwXJMMfAUngUSBUiiGBUIHs8REWl2wG8pBRMxDEHZhx7XFINVOCBgrpN9iHHwJK2LGkfD6FA8Vk32DFwHSTrTNANMeOhR6oJ6THwuwQZ3VDP+tL0Bx0D33Gk1H3p8VAVJm8kA9ZyVJ0DFR3jmoPCUox81x94rFYQx3WonYMffIR91IRcPxHKUB522DGT3xIBsqbehCceEAAh+QQACgD/ACwAAAAAMAAwAAAI/wBzCBxIsKDBgwgTKlxI8BIVSZcYSpxIkNMjBQo4UNxYkNNBRxgfHdzkkeNBLB3qlBzIqRFGRwY5OVpEyWRBS4kcPJjU0aUCmAXxIDCggKdNgVkQOXDgSFNFn0AHdkFjgKilowOhLHUgpaBPkQTrVDUwB+vATIuWrsHE8itBLAyqOmBrViCVpYfqEITK8lHVH13rCtz0aCmiqzlahhy4olBVRU45YqFbsBKapZA8KlYAdtOaqoRWHKwkaWVBLG7c4IlMcI6DQw8kCQSxaI0IgSV+VI06EBOHHz9EHwShqDikSaYvKYIdSSAnkiU76GaAheAmKIYECAigyLRzKGuKK/9aMwfLyhKOkCPcJOWBXueS0AgKEECAIEbenU+CFL44IyiZOLcJQ5oMmAMWjAxCn3YMSGEgQprg0Yh4azQyRX4KceIBIdvVR4gHAUqECRSMiNcBhgl1IUSHgzBSHUeWeLAGTSZFIoggaKyAIkObSCLFjgkRJgJrghVpJEeaJaakaV1EIgIUUD4JhQgiUIFVS4dspaUDaCBWSSNugNnImGG6AQKQCnWBgA5stulmczl8KWaYYjZy5lFquqmnDnA2KSWUU05p5VFY4rVllxkeyUlJSaJ5ZF2cWEKJowcVaBYmUngwRxYmbXLJJZk8SJEmVMzBQQcclEApQZlk4eolXVD/tMkkdXRgqwd11MSRJp++egmRCGURiQeocjCHJLEmtqpzXVziahagiloQFR5wcKoHUkQ0EBZUUFbpZBVh8iy0yRqEx6kdQIHYQJpIIUIk6yopECaUTFKJtJuI62q5BWECAgiTAJsDJYBymkMWK6xgcBf1UqJtRbxesiOoB2XipAilCUQJHnjoeuAk9krr3LIsSUJlJCHGybHHmtQ7yYtFXjKlCB6r3HFDIFPCL1ab4EGlFERujEcl1lUCcrxYWRIo0pWs3C/Ik3hrUxclUHlhZU5XhEW995qVSdWRPDyQ0EQX1AXIlQjMUSYrGFUQ2Qc5KzKho3Fc9qMTNY0H0ngrCrRJJqH2LXhCAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSFBVlTyqGEqcSJBTBwdmPFDcWJDTwVIOHHQ4yMkjx4Op6pwySXBDyFIGvZTS8OJkQRikFFXY0xGkA5gFpxj6ZIaPzYGXcioqxaqiS5EFVyn6ZCgUjKMDTShSNGpKQZ9AB5r6RLYO1oGrNGx1FFEgJ58jB6ZyQFYRjbMDq4zaGokgSDMdTFokC8orXoFePGy1cDUHp6dxc7BoQPZNU46p2hZ8YWHrBy8C4SK2QLYBT4MvWLAsmGpDqRSXB3IytXcUC4GR3rzpm8OEoaEaC9L4QPb2wVO633jYs1rVG50m3HopKbAOqE+hUhFkhcqBge8VVrv/NeEouSNTqVie6MBHvOwqFXg7zqPowHcDCRy5d8znQ/I3GqByl2OgLTSdQKloUMh9BoRyQoEIsVJFB/+Vksd+CXFShyEMGlLHKhPRYIIGydWBIUKriHJfAhpoh5kpjtB0EioHHKCIakd5sceFJ7HSASoQHibkkBx5ZKRjSKJ1gglLMumkCcbZ5MUGolRppZWKNAZDBx2UUkqXXX4ZyYkLsQJKAGimKQCaAqAi0JZfesllmPKdtIoha66ZJptu5rDKFCYw2WSgJ+SB1WNXJpqlQmRuZOSjbhEpqUGcpFJTj2/UEdtJNFRxyimaUWTKF1+YkUKjBrGyRySmtJoCR6t8/wLArAGMcilDXrxgwimtnmLCrRPJ5Mmss3pSyoAIcXLJFLzyGgkLsaFK0AuK8EAsAIVEEiRBe/DaaxXI5pAKC+HGpEq0KTTwBbFfKLKtQFX0ekJ626VwwhQupnpJKpesxkodBxAbyn40oIIKH+++cMK9bV3ywgttsZLKxCAWdIkGnXRSRUI0VCycvSeclgMMeeSRryoTX/JuDnucehILC6fg8bgsNJaDF/umUu5ZqgB6gs0js1AzQaukvPJJXuSxcBWbwsCCyRXtC4Mq0i6UysInXHKT0PkKVPTEm9rEir1Qiud0HkALhDK/VaNYhQlT7Oz00AVJzO/RFK3CR9pvPhndNVo0tG0TyXRPKhHNfxue4Sqr4K244QEBACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwBgsWNBhKnFjwiRo1pihqLMjpIK2LdA7m6rjxoJYRJkgS/KgmZMFctGZhKVkwy4Y3jnBxZOmS4IpYh2TppClwxs03dDQV/Eihp8BVRxw4UKOF6MAUb7KuIMiJliw1TwqikuqgltWBmjxknRVRYFeQBLXIknpk1dmBlBxlNbHyYtiBtKTGUnF3ICdTR45oyAL4a08XaKRuyFVyRtuaGrI+6fgWrMBcGqRGGFoQF6WEM2jRWUFZbFZHp3OYWLKEb44UQB04FUiDjlQXCG3RnjUCl8ocNJbgJJyDk/OBtWI5oFB1YC4TsgwpULABYQoPS2aF/0dVXaCKJzMRcmLhyJZhFm20bzfk4bhhLLXEi6eVwm5z+yKRlMUSQmyngCEUqAAgQblQ8oR44dFByYIJcTKCAwYqgEYtSkm0Sgq0hDcLKhQilMsi8h3iQXkUzWDCLB4wtpEKZRjyBnBEcWJaiRWacktrhQUpZEmcNefWcwJpsoIKS6rApJMqkEbkLItUaWUbbSxyhIwnmWLKCF6G6aNVmjgAy5kFoHkmLO7l0KWXYIp5C5lmrmnnmW0qCeWTT+JIEydUWiloG1sOuRCSziFp6KKGzSDjRppoMAKQJa1CyS23XEYRKoIIgoaCkGKRgi2ksgCpEAGkWsARUirESRYqkP9KqgosSgQTAq+kGkACHmhqECcOyXpLClgAyeNTrWHRRgG6viKECZQShMUtwlLiH2+4XGtQLiMksIRhKqAhiK6CtLGgC6TessIMxzXIAiUzIPRGKwD44GcOmoxgSK4ByLLgKk5mAaAWD7Hg3yozzODfE/QCoIZ9Rh1wwFYIrdJhQZaysEJ6yGWRRVuaHAIAAGCkcJALzG2ExUOUXEyDx5elAMbIQlx81yoas8Diyx8bpsbIrfx1FycurMCCC5TyrCkuPoyMQK00zWA0RAU52jNBS4wMgCN35eKCxsYVpHTVQIzcQ2xEaULJQ9ryBrNBtbgCwCsmn5VLFlB3fDWDFAwUxihBY297bGGB/31oLiMZrnhBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSDCTCxeZGEqcWPDOmzd3KGosyOmgnQtv7Bzk1HHjQVW2qJQk+PGCyII3RPxKZbKgql9MmtAsaOeiCIMs2Ci64KfmwEw4mdy5UVDExZcDWUFSNFSV0YEsmGhlQZDTxzc/CdqiusbW1ah2tIqowfIpQVVvqEJidXbgiyZaqbAEKaIkJxFU2QCrO5CTCa1OLg38CvWFBapOVlLMxNbgJSdaTXT06jYHpyZULbw4mMpFwkwlSrhgWpCK1iajc1D59UtvDhVrqEIdWEOEBAlFDwITIcKOrVSSe+cMVnilCaG+rA68QYUNrwa8miBkYYd4cRURBwb/K7FzZDAmtgW60PCA1/UHvyQTvISiO/E7LOh6ln+QdY7LETSA3QNvsMBfVy+Y4J0dJvhxYEKclCCBe+4pYoJ+DLESzB3epTfRDb5gx0sEv0inUSYq2HGHYhux0B4TsdXESSoxahShCv4RpuOOJpHk2Y+S3eBCMEMGY2SR5dUUAkhv+HKRk29owGImKJhggi1YYnklMA8ydAMbCoQp5gJhLmAbSlnacqWatgxm1JdixlmmbUIaeeSdSW70ly++aNCnn3wywSKPhBZaVyYmanQDEyVgaBIrfgTDQmUamaCLLooYuNENqUjKAjDBUVRDLwaUmoAGeUKoigufAsMCRJuG/7BLqaXuEkJ4CdXwAgutBnNJlwfVwJofGiRAqwEPoJAjQanw6ioLqTjKiirLEnTDHbtoJxAnwCiiC60I+HJgs66+UINknFySSrQC3cDKuQJpMEAACdR4gwkN0GrBgaw8pAp/mazLLidvXHqBQHbMK4AFBqniRJhcIcRKtTncoG4q4XHCCwAA8CIQK70EEIAYKhy0K7AIBZzKrwNt3HFJKoghci+OnsXKupdQqjHHHg9kgQABDLDbWar4sfJKO3dMkB8JiLxAokbVILCjSfc8UBNAB8BEXemm4gfUVUuWSQMi68LcVRavvGzYBZVAgAC6lHwWJ5Qd5LLV01kggZuGehZ2d38oE9YLxxH0LdELdthRo+GM5xAQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEiQGAwYxBhKnFgQhTBhKChqLFjsoIklwkwc7LgRYSZgVw7iuSiSowk7l0oWzFRCBEyDJlga5JMBg5IsMgcSMyFCBAqSA3OGLGjjiRufM4IO5GPHJq6CSvEUlISh6zCpA3OhKGrCBsGcS1oKzLSkqxyzYAVeqiqCEkE8ILUmdeMmg924AotJKloi08CVS/TmyKKk6xOkFInBnRmpqCSSaFsWE9E1CVCDl2AkJCZpWBbIAq8UtfP5SqRIKXNQyvBUrVATfD/vxMMb2AzINohGuhoYqaSeSwwPFJxEkfPHB2Gg4I0HBaWIA2FIioqwGIwnkgji/5JTxLmiIpESZroynfcwXLmWM0Q6t4L5IksooeZ4SRJ1FJLEtBEKbtyHwTCTLZQLDMO0d8V+ChUjjHmM2KGcRsRQggIKF1JESQUVOKGbTJmMSFExeAADIWAstjgRSTBCVkwWD2VBIww3cidTMZEoscQSPgL5oxzcEXPFkUgmSdyOGTgwhANQRvkkMAIZmeSVS5ZUDAZRSjnEEKFQmcOMONqIY406yhQJSBe1CRKRLkq0Ypx0DmRDgic+YUJ8QeWSySWX8KmRJAww4IZ+GxVDzCU2ZpGmRLm4ocCkQixhYkLF2DBDo47iOV8koUw6aSgiYJdQLps2egkxJOXiqUE28P95iRxDiBqEIigIWtCiqmYCmTCFiKArQcWYEMoTBFGCQRC2LgFhiTbOMCwuPejQihsCuWoDScL8YAADI4olgahJdDfDJZ4Wo4gO1iKbgxJBBKGEQCV4a0ASqBEjApRZcgQhCjywOwRcRAQQABHZKmKAAQmIWVAWf2lkgxDsBvBVDrkUfDBJVySwsCLDSvVEK+wWAaPGRCCVxMI/lMDiJT+w60OWKBOUBQMLO/CoTBmwq8MSxBb8CsIEPbGwAU7ERckr7BbSYQ4oQ0YMEQsr0O9GwzDdSnpBG0z0WQgYoEBsUkkSiiKeRl1QLhkwQjZYxYRcDBGvHDzSnC0qUrcieNcLmV0JJYjm9+AGBQQAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSBCQlmWAGEqcWHAFFBErKGqUKEmECEkHA21MCEhZn4OSLoI0mOzElpEFa7RE9rJgx48Gl8lZcqwmzByAJJ04sUIkwZsrB3qpxYTnn58Dlw09scymx4wEW8hhwuQK1IGBVpyQIsnLUY9Jc9R4whWK2a8C/yAbenIgUoLJuMqpCzdHoBZDkdUYuALtQC20mpYwqhHQ24KAWp5oYfQm1kBSuNLScnBLVYQllW1hPLDP1JrKkCFTJrDPTibJDEbesIHzwWVXcisbTNCLUGSfDV5J/IS3wL9yMCiHglBL7ucQCTp/mlBLiRYEl4lAohwDEimkCdb/gPH8SotljyUy/iMliRs3ymkpC2/wj7Lyyv7QXyhpSXcMS5Q1USBatLBCbjBsFMgTGMCXhBTUNYZbC8ZR1AcSSIgQHEw1RLiRJFfs19eIJKoH1nGkBfLHiiy2WOFIJdAioxwy1vhETV4so+OOPPo0UiBLKCLkkERil4MXD/HYI1RAEulkEUaq2OKUL2oUyAm0HHNMllweI4KHJYYp5k+AMBiRgrUkk56VyRjzxRcijHTFA7wkwdpGfRQBBgB8klGlQl4kwcugEBxjG0N/LOEDn3x6ssSaC12pCC9mUCpBCX8qVQsZjAIAhiJ1eZFpb0ZtcQwElFbqhiT7eaHIF4x+/2EMMozJYUwJkB4nCRvMlbYEnYM+cAx9gTzAKAJPnNnaGAF0ksRxgABilAigKPDAhr4ZQSkvTOwnSSedIOGjX0YIEIAnzAXCxKBMCITMAgoosER4NZQggQQJIpSMkTYVEEAAEJxphAEGsCGQFxjEawxWBS3DF0WAQPBvAQwPbIARRiljRrxG5AoTFJ0IIIAbRgVisREEyRHvAieMuMUCIo+Rr0AnSwdBvBGACdMS/wogR0E1E1RLvAo8AZcyB/xrjIcmE4yxeGzEy8vMMElygACelFBQ0xeHJ0m1vPD70woSdGxQ0AQFIoedIwaSKxsEG2xQICKWiEEBBmAw5kRSSQex4d6ADxQQACH5BAAKAP8ALAAAAAAwADAAAAj/AHMIHEiwoMGDCBMqXEhwE5ctmxhKnFgQFx48lShqlEjpYkaDxTYm3JQly8FKFymBpGSFi8iCmihdoVTDYEc8KgtqseMMlcuXAjdVunIFV0iCNz8OLIbCWc+aQAVyIXrl58CkBf04taM0ajFcRCtFHIgSJ8Eaz5ziGRtVYA2ZV7Qg9Yh0q8m2BLMQpaSJLF2pkZwOO6qxGGGCMYn6ufq32DCnkawS5CIXYTEtWvoa1LL3p94ri3Nk4eksZ0MrIEBsQcilZJYtmpcOpbRa4GFcgZ/FzvHVTocOHPAgrKHFdRYubHNwwQUV4ZZhuAhuQdWMA/Bmw0ZuMa6lxmGGhGtA/5vDwXqHSFm+G9S03XV3kZSe/Lb+hFJyhcWIu65NsRgq83MM0xxFDmF2n0RZNNPMM/y9tMluGhWlHl4UWmYbb7xN+NKEhOGCBi8ghhhiIwdS9BhPKDpjhx2RCRSJDjDGKCMzAxYGQiMX4Ihjjjl+ZIeMQOpAI1DFgMCjjhfk2MhHHooo4iGNaCgRNE5tpSJkkhmGYYYVdumlSJrYkUSJCxWDBzRkTomGIIJEAt8iozQT3UZ+XDBIAHgKUWOZzUzgZxt2NKgQF80QIgCeAhAyR5oHOdbIKH5O0AgeezaECigCHCrAIG2E9iBDmxzFhR1tRDqKEldweIEgmQYgyAPQEP/2xAPPkFnMFY6gQpAfcywyAaSjONPoBIgaYsdufoACywEd2BbqUZE8wMsEldl2hRKQTgDChFYccAAHguaQBCyDHKBrDs4sssgTAkHzwCGHzPFdDXjkeNdB0HQ1kBWEwALLBGM5ooACUfLGAS+HoKGvQFuEppEmE/hbyBUDCUzwQLhEAOKYXaLCjL9JEJbEwI0Q9ESI2VG4BS/+gnJvDhYXzPAEh/CyiGRAzeEvLOwSNPLFBOGBMC924IWLAv4+gLPFjhymSSMgRvCySFYgfYBwBcX83RXSprHwRlcswnHWJIMEQgcOt6WlQTE3+iVCHAwc8tsTaTHMMNXSrbdBAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSPDGqlWcGEqcWDDLlStZKGqUaPEKlo0bOWXKdBDLFSsfDWJRZgNkwRtasmi5ofJkSoKZUOBRscrlQE4xs5AsaNJjQU5X8OBJ0dKnQBtZovYkWPSmQC1KUWR0KpDTlqhaIg6s2lCFUis0uT6NmmWqQLJjleLZohYn2LQ54OawkUIKnmBiNaYIdhBoVLpvL95UpjSFW4Krhh5U0amTBi0GV7FNu8WSJcRbdOKxZPCGshIlHv8MBaC1rhBNu37VonpgFp0q8ObglAUPFCjOrBy8oehLawBfGqQIbGOLboOZrmAemEkFcGfOoBAeXqvQcQA8FJH/psj8Si3s2FGEVZiplI/vPko9Z2hJCvYQUKRYCrzQkqIAxyVQm0KcqIBeLVfERlEKDXzxhTMgbVELFCpIBpINIbyhIEWWbKUWf3UlxMmIu0VEYogLYaGIKKKsyOKLkICo0RVS1FgjHjbiMZUUAfTo44+gDDhRLaUU2UGRpRzZQUol/OhkAKBsSF4tRxqJZAdLvuUiixO8KAok802ElI1k3uiWiSWSKCOKbLaJ0A0ldBDmQgUC5pQViugSjRQgWaJBBiF4SBEWGiRgQDTRTCMlgRm+8YYGUljIXghBGHBoNEGEMGdCVpTiqKMdqLDoQDfgMQ2iiCaQwU2bkipWJlJo//DpG07YaRAnGegZjQG6KGJFYLVQo8KauwXTAR4EZRFCBqQ4moEUMnLCCKoNlKAbFtOAkmlXuw2EBzWKvDFdV8E0IesbUCCkDBmFOCFpDk2wGwSfOUDxBinp5mAFuIo4AyJfkEAyrkFWKHNQMA2QAQopaXUgjTQx5nCDE4oowojBBn0F0g1vFFJIA1cMVIoZ0pQyFiMVN9GqRiiA4nETgZUijRkmDwRFxWsIV1cmiigciqAdkByxQJlkULEGQmrkjMug5Cvyw0MLlMIaFdPrVBbSeKyIpA6bAUlBNpRSMSmCgqRMKIWAgoJBI5dsUDBrUMOIVS4po0EpMsoMMYicQB7hRNk+nVhQ11/f6uZBTZDcweETbWGFFQMzLvlAAQEAIfkEAAoA/wAsAAAAADAAMAAACP8AcwgcSLCgwYMIEypcSLDYjRvFGEqcWPBPqlR/KGpseOOgRYwbN6oINaFjxYsZDWpJZTLkwGQEALiqZfBjSoJd9kyqBMjlwD2CAAAAclPgR0wGYUyatKelTyRCAXA4CZIgJp2TkPocqAWBUB8wCNpsWGmppYhbBz5pJZQC2hxjuS7d0yUtQUDVhAZINjBujhtYw4bMU+lgMh5Ch/SEi3JgqqWTFhe8URfhpB8/OGgdWIyC0FZPBHbBhKnyH8ipDBZLlUyF5IYTAgR4tcDO60oxWzVCiKlsJadw89gaXlh1GwKyAxCAoOItByC2EwKCUbRLpVvDbd2yhPCGiWqvkg//ciOYssYbMJJlv5V1IaZmhMLPJvTh7UQtKtarSGVfIQw3g4T3SjWVTVTMHtklYwlwDBWjAgQECELTRn/ccgtdWwFihwYMSpQKJv25FKJdCkX01ogkGpSKG9RQ04aLL7Y4S4cTWaLCjTjimMdithjg44+D/CjNaxvdIsKRSCJphxYC9fjjkz6GQiRFxSST5JVLCpRKIy3G2KKMNEpkY4457thQDvahmOKabCp0g5FhJnTgWVtV0sgCDKgQkhbNNGPCZhTxWc0nhLYRp2qozMLBLB8kU+BCgNQCAaGESmOHmgjtccwsis7yRFMlqkDBApRWw0FqaGIq0FtdJPNBp7PU/8LfQcU0wwClC7QxCUEmILFrQjA8oedAmJjQzKIcNMOXahpQGoEtr2lBgTShTGjiQCog0QgHRRVjiQiccnALQpVIM8QTRQl0zBDSSDNuDrZwwIEJAu2hbSP0TpbHMccAWtAe3BlkSQTscqguBRN8sKoIjbihAaoVMbnRDRu0C0FxORwzQcJopaKBG26IcChFI7GrsFoTUHCyQCY00ggSe6TYhRvsyiKxuhsfI9YsbjTSzJQh1WKuNKgUdAzCKwukgsuNLLuVFhOY68ajGW+c9F8f9KxZWpbIMkQowxKkMccFWYKEGxvc7BMMsxwT4thXo2lCliQWM6LGKtPaJkIipA8c2t4T/bHHHv4CbjhBAQEAOw==)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 06 | Stream 如何提高遍历集合效率？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>06 | Stream 如何提高遍历集合效率？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">06 | Stream 如何提高遍历集合效率？</h1><div><span>刘超</span> <span> 2019-06-01</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/39/93/39bb9aa6d3ddde6747313cebd9f9fc93.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：李良</span><span>大小：12.18M</span><span> 时长：13:18</span></div></div><audio title="06 | Stream如何提高遍历集合效率？" src="https://res001.geekbang.org//media/audio/69/4a/6930c5ea8503c9740ca43e84fa38574a/ld/ld.m3u8"></audio></div><div><div><div><div data-slate-editor="true" data-key="2358" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="2359"><span data-slate-object="text" data-key="2360"><span data-slate-leaf="true" data-offset-key="2360:0" data-first-offset="true"><span data-slate-string="true">你好，我是刘超。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2361"><span data-slate-object="text" data-key="2362"><span data-slate-leaf="true" data-offset-key="2362:0" data-first-offset="true"><span data-slate-string="true">上一讲中，我在讲 List 集合类，那我想你一定也知道集合的顶端接口 Collection。在 Java8 中，Collection 新增了两个流方法，分别是 Stream () 和 parallelStream ()。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2363"><span data-slate-object="text" data-key="2364"><span data-slate-leaf="true" data-offset-key="2364:0" data-first-offset="true"><span data-slate-string="true">通过英文名不难猜测，这两个方法肯定和 Stream 有关，那进一步猜测，是不是和我们熟悉的 InputStream 和 OutputStream 也有关系呢？集合类中新增的两个 Stream 方法到底有什么作用？今天，我们就来深入了解下 Stream。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2365" id="sr-toc-1"><span data-slate-object="text" data-key="2366"><span data-slate-leaf="true" data-offset-key="2366:0" data-first-offset="true"><span data-slate-string="true">什么是 Stream？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2367"><span data-slate-object="text" data-key="2368"><span data-slate-leaf="true" data-offset-key="2368:0" data-first-offset="true"><span data-slate-string="true">现在很多大数据量系统中都存在分表分库的情况。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2369"><span data-slate-object="text" data-key="2370"><span data-slate-leaf="true" data-offset-key="2370:0" data-first-offset="true"><span data-slate-string="true">例如，电商系统中的订单表，常常使用用户 ID 的 Hash 值来实现分表分库，这样是为了减少单个表的数据量，优化用户查询订单的速度。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2371"><span data-slate-object="text" data-key="2372"><span data-slate-leaf="true" data-offset-key="2372:0" data-first-offset="true"><span data-slate-string="true">但在后台管理员审核订单时，他们需要将各个数据源的数据查询到应用层之后进行合并操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2373"><span data-slate-object="text" data-key="2374"><span data-slate-leaf="true" data-offset-key="2374:0" data-first-offset="true"><span data-slate-string="true">例如，当我们需要查询出过滤条件下的所有订单，并按照订单的某个条件进行排序，单个数据源查询出来的数据是可以按照某个条件进行排序的，但多个数据源查询出来已经排序好的数据，并不代表合并后是正确的排序，所以我们需要在应用层对合并数据集合重新进行排序。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2375"><span data-slate-object="text" data-key="2376"><span data-slate-leaf="true" data-offset-key="2376:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_de27ba9e" data-attr-id="19103" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">在 Java8 之前，我们通常是通过 for 循环或者 Iterator 迭代来重新排序合并数据，又或者通过重新定义 Collections.sorts 的 Comparator 方法来实现，这两种方式对于大数据量系统来说，效率并不是很理想。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2377"><span data-slate-object="text" data-key="2378"><span data-slate-leaf="true" data-offset-key="2378:0" data-first-offset="true"><span data-slate-string="true">Java8 中添加了一个新的接口类 Stream，他和我们之前接触的字节流概念不太一样，Java8 集合中的 Stream 相当于高级版的 Iterator，他可以通过 Lambda 表达式对集合进行各种非常便利、高效的聚合操作（Aggregate Operation），或者大批量数据操作 (Bulk Data Operation)。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2379"><span data-slate-object="text" data-key="2380"><span data-slate-leaf="true" data-offset-key="2380:0" data-first-offset="true"><span data-slate-string="true">Stream 的聚合操作与数据库 SQL 的聚合操作 sorted、filter、map 等类似。我们在应用层就可以高效地实现类似数据库 SQL 的聚合操作了，而在数据操作方面，Stream 不仅可以通过串行的方式实现数据操作，还可以通过并行的方式处理大批量数据，提高数据的处理效率。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2381"><span data-slate-object="text" data-key="2382"><span data-slate-leaf="true" data-offset-key="2382:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">接下来我们就用一个简单的例子来体验下 Stream 的简洁与强大。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2383"><span data-slate-object="text" data-key="2384"><span data-slate-leaf="true" data-offset-key="2384:0" data-first-offset="true"><span data-slate-string="true">这个 Demo 的需求是过滤分组一所中学里身高在 160cm 以上的男女同学，我们先用传统的迭代方式来实现，代码如下：</span></span></span></div><div data-code-language="dart" data-slate-type="pre" data-slate-object="block" data-key="2385"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2386"><span data-slate-object="text" data-key="2387"><span data-slate-leaf="true" data-offset-key="2387:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Map</span></span></span></span><span data-slate-object="text" data-key="2388"><span data-slate-leaf="true" data-offset-key="2388:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2389"><span data-slate-leaf="true" data-offset-key="2389:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2390"><span data-slate-leaf="true" data-offset-key="2390:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2391"><span data-slate-leaf="true" data-offset-key="2391:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">List</span></span></span></span><span data-slate-object="text" data-key="2392"><span data-slate-leaf="true" data-offset-key="2392:0" data-first-offset="true"><span data-slate-string="true">&lt;Student&gt;&gt; stuMap = </span></span></span><span data-slate-object="text" data-key="2393"><span data-slate-leaf="true" data-offset-key="2393:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2394"><span data-slate-leaf="true" data-offset-key="2394:0" data-first-offset="true"><span data-slate-string="true"> HashMap&lt;</span></span></span><span data-slate-object="text" data-key="2395"><span data-slate-leaf="true" data-offset-key="2395:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2396"><span data-slate-leaf="true" data-offset-key="2396:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2397"><span data-slate-leaf="true" data-offset-key="2397:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">List</span></span></span></span><span data-slate-object="text" data-key="2398"><span data-slate-leaf="true" data-offset-key="2398:0" data-first-offset="true"><span data-slate-string="true">&lt;Student&gt;&gt;();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2399"><span data-slate-object="text" data-key="2400"><span data-slate-leaf="true" data-offset-key="2400:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2401"><span data-slate-leaf="true" data-offset-key="2401:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="2402"><span data-slate-leaf="true" data-offset-key="2402:0" data-first-offset="true"><span data-slate-string="true"> (Student stu: studentsList) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2403"><span data-slate-object="text" data-key="2404"><span data-slate-leaf="true" data-offset-key="2404:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2405"><span data-slate-leaf="true" data-offset-key="2405:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2406"><span data-slate-leaf="true" data-offset-key="2406:0" data-first-offset="true"><span data-slate-string="true"> (stu.getHeight() &gt; </span></span></span><span data-slate-object="text" data-key="2407"><span data-slate-leaf="true" data-offset-key="2407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">160</span></span></span></span><span data-slate-object="text" data-key="2408"><span data-slate-leaf="true" data-offset-key="2408:0" data-first-offset="true"><span data-slate-string="true">) { </span></span></span><span data-slate-object="text" data-key="2409"><span data-slate-leaf="true" data-offset-key="2409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果身高大于 160</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2410"><span data-slate-object="text" data-key="2411"><span data-slate-leaf="true" data-offset-key="2411:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="2412"><span data-slate-leaf="true" data-offset-key="2412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2413"><span data-slate-leaf="true" data-offset-key="2413:0" data-first-offset="true"><span data-slate-string="true"> (stuMap.</span></span></span><span data-slate-object="text" data-key="2414"><span data-slate-leaf="true" data-offset-key="2414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="2415"><span data-slate-leaf="true" data-offset-key="2415:0" data-first-offset="true"><span data-slate-string="true">(stu.getSex()) == </span></span></span><span data-slate-object="text" data-key="2416"><span data-slate-leaf="true" data-offset-key="2416:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">null</span></span></span></span><span data-slate-object="text" data-key="2417"><span data-slate-leaf="true" data-offset-key="2417:0" data-first-offset="true"><span data-slate-string="true">) { </span></span></span><span data-slate-object="text" data-key="2418"><span data-slate-leaf="true" data-offset-key="2418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 该性别还没分类</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2419"><span data-slate-object="text" data-key="2420"><span data-slate-leaf="true" data-offset-key="2420:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2421"><span data-slate-leaf="true" data-offset-key="2421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">List</span></span></span></span><span data-slate-object="text" data-key="2422"><span data-slate-leaf="true" data-offset-key="2422:0" data-first-offset="true"><span data-slate-string="true">&lt;Student&gt; list = </span></span></span><span data-slate-object="text" data-key="2423"><span data-slate-leaf="true" data-offset-key="2423:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2424"><span data-slate-leaf="true" data-offset-key="2424:0" data-first-offset="true"><span data-slate-string="true"> ArrayList&lt;Student&gt;(); </span></span></span><span data-slate-object="text" data-key="2425"><span data-slate-leaf="true" data-offset-key="2425:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 新建该性别学生的列表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2426"><span data-slate-object="text" data-key="2427"><span data-slate-leaf="true" data-offset-key="2427:0" data-first-offset="true"><span data-slate-string="true">                    list.add(stu);</span></span></span><span data-slate-object="text" data-key="2428"><span data-slate-leaf="true" data-offset-key="2428:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将学生放进去列表</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2429"><span data-slate-object="text" data-key="2430"><span data-slate-leaf="true" data-offset-key="2430:0" data-first-offset="true"><span data-slate-string="true">                    stuMap.put(stu.getSex(), list);</span></span></span><span data-slate-object="text" data-key="2431"><span data-slate-leaf="true" data-offset-key="2431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将列表放到 map 中</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2432"><span data-slate-object="text" data-key="2433"><span data-slate-leaf="true" data-offset-key="2433:0" data-first-offset="true"><span data-slate-string="true">                } </span></span></span><span data-slate-object="text" data-key="2434"><span data-slate-leaf="true" data-offset-key="2434:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="2435"><span data-slate-leaf="true" data-offset-key="2435:0" data-first-offset="true"><span data-slate-string="true"> { </span></span></span><span data-slate-object="text" data-key="2436"><span data-slate-leaf="true" data-offset-key="2436:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 该性别分类已存在</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2437"><span data-slate-object="text" data-key="2438"><span data-slate-leaf="true" data-offset-key="2438:0" data-first-offset="true"><span data-slate-string="true">                    stuMap.</span></span></span><span data-slate-object="text" data-key="2439"><span data-slate-leaf="true" data-offset-key="2439:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">get</span></span></span></span><span data-slate-object="text" data-key="2440"><span data-slate-leaf="true" data-offset-key="2440:0" data-first-offset="true"><span data-slate-string="true">(stu.getSex()).add(stu);</span></span></span><span data-slate-object="text" data-key="2441"><span data-slate-leaf="true" data-offset-key="2441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 该性别分类已存在，则直接放进去即可</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2442"><span data-slate-object="text" data-key="2443"><span data-slate-leaf="true" data-offset-key="2443:0" data-first-offset="true"><span data-slate-string="true">                }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2444"><span data-slate-object="text" data-key="2445"><span data-slate-leaf="true" data-offset-key="2445:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2446"><span data-slate-object="text" data-key="2447"><span data-slate-leaf="true" data-offset-key="2447:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2448"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2449"><span data-slate-object="text" data-key="2450"><span data-slate-leaf="true" data-offset-key="2450:0" data-first-offset="true"><span data-slate-string="true">我们再使用 Java8 中的 Stream API 进行实现：</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2451"><span data-slate-object="text" data-key="2452"><span data-slate-leaf="true" data-offset-key="2452:0" data-first-offset="true"><span data-slate-string="true">1. 串行实现</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="2453"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2454"><span data-slate-object="text" data-key="2455"><span data-slate-leaf="true" data-offset-key="2455:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Map</span></span></span></span><span data-slate-object="text" data-key="2456"><span data-slate-leaf="true" data-offset-key="2456:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2457"><span data-slate-leaf="true" data-offset-key="2457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2458"><span data-slate-leaf="true" data-offset-key="2458:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2459"><span data-slate-leaf="true" data-offset-key="2459:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">List</span></span></span></span><span data-slate-object="text" data-key="2460"><span data-slate-leaf="true" data-offset-key="2460:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2461"><span data-slate-leaf="true" data-offset-key="2461:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2462"><span data-slate-leaf="true" data-offset-key="2462:0" data-first-offset="true"><span data-slate-string="true">&gt;&gt; stuMap = stuList.</span></span></span><span data-slate-object="text" data-key="2463"><span data-slate-leaf="true" data-offset-key="2463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="2464"><span data-slate-leaf="true" data-offset-key="2464:0" data-first-offset="true"><span data-slate-string="true">().</span></span></span><span data-slate-object="text" data-key="2465"><span data-slate-leaf="true" data-offset-key="2465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="2466"><span data-slate-leaf="true" data-offset-key="2466:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="2467"><span data-slate-leaf="true" data-offset-key="2467:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2468"><span data-slate-leaf="true" data-offset-key="2468:0" data-first-offset="true"><span data-slate-string="true"> s) -&gt; s.</span></span></span><span data-slate-object="text" data-key="2469"><span data-slate-leaf="true" data-offset-key="2469:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getHeight</span></span></span></span><span data-slate-object="text" data-key="2470"><span data-slate-leaf="true" data-offset-key="2470:0" data-first-offset="true"><span data-slate-string="true">()&gt; </span></span></span><span data-slate-object="text" data-key="2471"><span data-slate-leaf="true" data-offset-key="2471:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">160</span></span></span></span><span data-slate-object="text" data-key="2472"><span data-slate-leaf="true" data-offset-key="2472:0" data-first-offset="true"><span data-slate-string="true">) .</span></span></span><span data-slate-object="text" data-key="2473"><span data-slate-leaf="true" data-offset-key="2473:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">collect</span></span></span></span><span data-slate-object="text" data-key="2474"><span data-slate-leaf="true" data-offset-key="2474:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2475"><span data-slate-leaf="true" data-offset-key="2475:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Collectors</span></span></span></span><span data-slate-object="text" data-key="2476"><span data-slate-leaf="true" data-offset-key="2476:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2477"><span data-slate-leaf="true" data-offset-key="2477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">groupingBy</span></span></span></span><span data-slate-object="text" data-key="2478"><span data-slate-leaf="true" data-offset-key="2478:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2479"><span data-slate-leaf="true" data-offset-key="2479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2480"><span data-slate-leaf="true" data-offset-key="2480:0" data-first-offset="true"><span data-slate-string="true"> ::getSex)); </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2481"><span data-slate-object="text" data-key="2482"><span data-slate-leaf="true" data-offset-key="2482:0" data-first-offset="true"><span data-slate-string="true">2. 并行实现</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="2483"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2484"><span data-slate-object="text" data-key="2485"><span data-slate-leaf="true" data-offset-key="2485:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Map</span></span></span></span><span data-slate-object="text" data-key="2486"><span data-slate-leaf="true" data-offset-key="2486:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2487"><span data-slate-leaf="true" data-offset-key="2487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2488"><span data-slate-leaf="true" data-offset-key="2488:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2489"><span data-slate-leaf="true" data-offset-key="2489:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">List</span></span></span></span><span data-slate-object="text" data-key="2490"><span data-slate-leaf="true" data-offset-key="2490:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2491"><span data-slate-leaf="true" data-offset-key="2491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2492"><span data-slate-leaf="true" data-offset-key="2492:0" data-first-offset="true"><span data-slate-string="true">&gt;&gt; stuMap = stuList.</span></span></span><span data-slate-object="text" data-key="2493"><span data-slate-leaf="true" data-offset-key="2493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">parallelStream</span></span></span></span><span data-slate-object="text" data-key="2494"><span data-slate-leaf="true" data-offset-key="2494:0" data-first-offset="true"><span data-slate-string="true">().</span></span></span><span data-slate-object="text" data-key="2495"><span data-slate-leaf="true" data-offset-key="2495:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="2496"><span data-slate-leaf="true" data-offset-key="2496:0" data-first-offset="true"><span data-slate-string="true">((</span></span></span><span data-slate-object="text" data-key="2497"><span data-slate-leaf="true" data-offset-key="2497:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2498"><span data-slate-leaf="true" data-offset-key="2498:0" data-first-offset="true"><span data-slate-string="true"> s) -&gt; s.</span></span></span><span data-slate-object="text" data-key="2499"><span data-slate-leaf="true" data-offset-key="2499:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getHeight</span></span></span></span><span data-slate-object="text" data-key="2500"><span data-slate-leaf="true" data-offset-key="2500:0" data-first-offset="true"><span data-slate-string="true">()&gt; </span></span></span><span data-slate-object="text" data-key="2501"><span data-slate-leaf="true" data-offset-key="2501:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">160</span></span></span></span><span data-slate-object="text" data-key="2502"><span data-slate-leaf="true" data-offset-key="2502:0" data-first-offset="true"><span data-slate-string="true">) .</span></span></span><span data-slate-object="text" data-key="2503"><span data-slate-leaf="true" data-offset-key="2503:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">collect</span></span></span></span><span data-slate-object="text" data-key="2504"><span data-slate-leaf="true" data-offset-key="2504:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2505"><span data-slate-leaf="true" data-offset-key="2505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Collectors</span></span></span></span><span data-slate-object="text" data-key="2506"><span data-slate-leaf="true" data-offset-key="2506:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2507"><span data-slate-leaf="true" data-offset-key="2507:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">groupingBy</span></span></span></span><span data-slate-object="text" data-key="2508"><span data-slate-leaf="true" data-offset-key="2508:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2509"><span data-slate-leaf="true" data-offset-key="2509:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Student</span></span></span></span><span data-slate-object="text" data-key="2510"><span data-slate-leaf="true" data-offset-key="2510:0" data-first-offset="true"><span data-slate-string="true"> ::getSex)); </span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2511"><span data-slate-object="text" data-key="2512"><span data-slate-leaf="true" data-offset-key="2512:0" data-first-offset="true"><span data-slate-string="true">通过上面两个简单的例子，我们可以发现，Stream 结合 Lambda 表达式实现遍历筛选功能非常得简洁和便捷。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="2513" id="sr-toc-2"><span data-slate-object="text" data-key="2514"><span data-slate-leaf="true" data-offset-key="2514:0" data-first-offset="true"><span data-slate-string="true">Stream 如何优化遍历？</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="2515"><span data-slate-object="text" data-key="2516"><span data-slate-leaf="true" data-offset-key="2516:0" data-first-offset="true"><span data-slate-string="true">上面我们初步了解了 Java8 中的 Stream API，那 Stream 是如何做到优化迭代的呢？并行又是如何实现的？下面我们就透过 Stream 源码剖析 Stream 的实现原理。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2517" id="sr-toc-3"><span data-slate-object="text" data-key="2518"><span data-slate-leaf="true" data-offset-key="2518:0" data-first-offset="true"><span data-slate-string="true">1.Stream 操作分类</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2519"><span data-slate-object="text" data-key="2520"><span data-slate-leaf="true" data-offset-key="2520:0" data-first-offset="true"><span data-slate-string="true">在了解 Stream 的实现原理之前，我们先来了解下 Stream 的操作分类，因为他的操作分类其实是实现高效迭代大数据集合的重要原因之一。为什么这样说，分析完你就清楚了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2521"><span data-slate-object="text" data-key="2522"><span data-slate-leaf="true" data-offset-key="2522:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_92ad44ac" data-attr-id="12989" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">官方将 Stream 中的操作分为两大类：中间操作（Intermediate operations）和终结操作（Terminal operations）。中间操作只对操作进行了记录，即只会返回一个流，不会进行计算操作，而终结操作是实现了计算操作。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2523"><span data-slate-object="text" data-key="2524"><span data-slate-leaf="true" data-offset-key="2524:0" data-first-offset="true"><span data-slate-string="true">中间操作又可以分为无状态（Stateless）与有状态（Stateful）操作，前者是指元素的处理不受之前元素的影响，后者是指该操作只有拿到所有元素之后才能继续下去。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2525"><span data-slate-object="text" data-key="2526"><span data-slate-leaf="true" data-offset-key="2526:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_5f3e0b98" data-attr-id="36203" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">终结操作又可以分为短路（Short-circuiting）与非短路（Unshort-circuiting）操作，</span></span></span><span data-slate-leaf="true" data-offset-key="2526:1"><span data-slate-string="true">前者是指遇到某些符合条件的元素就可以得到最终结果，后者是指必须处理完所有元素才能得到最终结果。操作分类详情如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="2527"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/ea/94/ea8dfeebeae8f05ae809ee61b3bf3094.jpg?wh=2036*1438"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2528"><span data-slate-object="text" data-key="2529"><span data-slate-leaf="true" data-offset-key="2529:0" data-first-offset="true"><span data-slate-type="primary" data-slate-object="mark"><span data-slate-string="true">我们通常还会将中间操作称为懒操作，也正是由这种懒操作结合终结操作、数据源构成的处理管道（Pipeline），实现了 Stream 的高效。</span></span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2530" id="sr-toc-4"><span data-slate-object="text" data-key="2531"><span data-slate-leaf="true" data-offset-key="2531:0" data-first-offset="true"><span data-slate-string="true">2.Stream 源码实现</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2532"><span data-slate-object="text" data-key="2533"><span data-slate-leaf="true" data-offset-key="2533:0" data-first-offset="true"><span data-slate-string="true">在了解 Stream 如何工作之前，我们先来了解下 Stream 包是由哪些主要结构类组合而成的，各个类的职责是什么。参照下图：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="2534"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/fc/00/fc256f9f8f9e3224aac10b2ee8940e00.jpg?wh=698*428"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2535"><span data-slate-object="text" data-key="2536"><span data-slate-leaf="true" data-offset-key="2536:0" data-first-offset="true"><span data-slate-string="true">BaseStream 和 Stream 为最顶端的接口类。BaseStream 主要定义了流的基本接口方法，例如，spliterator、isParallel 等；Stream 则定义了一些流的常用操作方法，例如，map、filter 等。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2537"><span data-slate-object="text" data-key="2538"><span data-slate-leaf="true" data-offset-key="2538:0" data-first-offset="true"><span data-slate-string="true">ReferencePipeline 是一个结构类，他通过定义内部类组装了各种操作流。他定义了 Head、StatelessOp、StatefulOp 三个内部类，实现了 BaseStream 与 Stream 的接口方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2539"><span data-slate-object="text" data-key="2540"><span data-slate-leaf="true" data-offset-key="2540:0" data-first-offset="true"><span data-slate-string="true">Sink 接口是定义每个 Stream 操作之间关系的协议，他包含 begin ()、end ()、cancellationRequested ()、accpt () 四个方法。ReferencePipeline 最终会将整个 Stream 流操作组装成一个调用链，而这条调用链上的各个 Stream 操作的上下关系就是通过 Sink 接口协议来定义实现的。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="2541" id="sr-toc-5"><span data-slate-object="text" data-key="2542"><span data-slate-leaf="true" data-offset-key="2542:0" data-first-offset="true"><span data-slate-string="true">3.Stream 操作叠加</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="2543"><span data-slate-object="text" data-key="2544"><span data-slate-leaf="true" data-offset-key="2544:0" data-first-offset="true"><span data-slate-string="true">我们知道，一个 Stream 的各个操作是由处理管道组装，并统一完成数据处理的。在 JDK 中每次的中断操作会以使用阶段（Stage）命名。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2545"><span data-slate-object="text" data-key="2546"><span data-slate-leaf="true" data-offset-key="2546:0" data-first-offset="true"><span data-slate-string="true">管道结构通常是由 ReferencePipeline 类实现的，前面讲解 Stream 包结构时，我提到过 ReferencePipeline 包含了 Head、StatelessOp、StatefulOp 三种内部类。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2547"><span data-slate-object="text" data-key="2548"><span data-slate-leaf="true" data-offset-key="2548:0" data-first-offset="true"><span data-slate-string="true">Head 类主要用来定义数据源操作，在我们初次调用 names.stream () 方法时，会初次加载 Head 对象，此时为加载数据源操作；接着加载的是中间操作，分别为无状态中间操作 StatelessOp 对象和有状态操作 StatefulOp 对象，此时的 Stage 并没有执行，而是通过 AbstractPipeline 生成了一个中间操作 Stage 链表；当我们调用终结操作时，会生成一个最终的 Stage，</span></span><span data-slate-leaf="true" data-offset-key="2548:1"><span data-slate-object="annotation" data-annotation-key="gkann_54615153" data-attr-id="30049" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">通过这个 Stage 触发之前的中间操作，从最后一个 Stage 开始，递归产生一个 Sink 链。</span></span></span><span data-slate-leaf="true" data-offset-key="2548:2"><span data-slate-string="true">如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="2549"><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/resource/image/f5/19/f548ce93fef2d41b03274295aa0a0419.jpg?wh=1854*364"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2550"><span data-slate-object="text" data-key="2551"><span data-slate-leaf="true" data-offset-key="2551:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">下面我们再通过一个例子来感受下 Stream 的操作分类是如何实现高效迭代大数据集合的。</span></span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="2552"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2553"><span data-slate-object="text" data-key="2554"><span data-slate-leaf="true" data-offset-key="2554:0" data-first-offset="true"><span data-slate-string="true">List&lt;</span></span></span><span data-slate-object="text" data-key="2555"><span data-slate-leaf="true" data-offset-key="2555:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2556"><span data-slate-leaf="true" data-offset-key="2556:0" data-first-offset="true"><span data-slate-string="true">&gt; names = Arrays.</span></span></span><span data-slate-object="text" data-key="2557"><span data-slate-leaf="true" data-offset-key="2557:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asList</span></span></span></span><span data-slate-object="text" data-key="2558"><span data-slate-leaf="true" data-offset-key="2558:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2559"><span data-slate-leaf="true" data-offset-key="2559:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张三"</span></span></span></span><span data-slate-object="text" data-key="2560"><span data-slate-leaf="true" data-offset-key="2560:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2561"><span data-slate-leaf="true" data-offset-key="2561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"李四"</span></span></span></span><span data-slate-object="text" data-key="2562"><span data-slate-leaf="true" data-offset-key="2562:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2563"><span data-slate-leaf="true" data-offset-key="2563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"王老五"</span></span></span></span><span data-slate-object="text" data-key="2564"><span data-slate-leaf="true" data-offset-key="2564:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2565"><span data-slate-leaf="true" data-offset-key="2565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"李三"</span></span></span></span><span data-slate-object="text" data-key="2566"><span data-slate-leaf="true" data-offset-key="2566:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2567"><span data-slate-leaf="true" data-offset-key="2567:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"刘老四"</span></span></span></span><span data-slate-object="text" data-key="2568"><span data-slate-leaf="true" data-offset-key="2568:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2569"><span data-slate-leaf="true" data-offset-key="2569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"王小二"</span></span></span></span><span data-slate-object="text" data-key="2570"><span data-slate-leaf="true" data-offset-key="2570:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2571"><span data-slate-leaf="true" data-offset-key="2571:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张四"</span></span></span></span><span data-slate-object="text" data-key="2572"><span data-slate-leaf="true" data-offset-key="2572:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2573"><span data-slate-leaf="true" data-offset-key="2573:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张五六七"</span></span></span></span><span data-slate-object="text" data-key="2574"><span data-slate-leaf="true" data-offset-key="2574:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2575"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2576"><span data-slate-object="text" data-key="2577"><span data-slate-leaf="true" data-offset-key="2577:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="2578"><span data-slate-leaf="true" data-offset-key="2578:0" data-first-offset="true"><span data-slate-string="true"> maxLenStartWithZ = names.</span></span></span><span data-slate-object="text" data-key="2579"><span data-slate-leaf="true" data-offset-key="2579:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="2580"><span data-slate-leaf="true" data-offset-key="2580:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2581"><span data-slate-object="text" data-key="2582"><span data-slate-leaf="true" data-offset-key="2582:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="2583"><span data-slate-leaf="true" data-offset-key="2583:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="2584"><span data-slate-leaf="true" data-offset-key="2584:0" data-first-offset="true"><span data-slate-string="true">(name </span></span></span><span data-slate-object="text" data-key="2585"><span data-slate-leaf="true" data-offset-key="2585:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="2586"><span data-slate-leaf="true" data-offset-key="2586:0" data-first-offset="true"><span data-slate-string="true"> name.</span></span></span><span data-slate-object="text" data-key="2587"><span data-slate-leaf="true" data-offset-key="2587:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">startsWith</span></span></span></span><span data-slate-object="text" data-key="2588"><span data-slate-leaf="true" data-offset-key="2588:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2589"><span data-slate-leaf="true" data-offset-key="2589:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张"</span></span></span></span><span data-slate-object="text" data-key="2590"><span data-slate-leaf="true" data-offset-key="2590:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2591"><span data-slate-object="text" data-key="2592"><span data-slate-leaf="true" data-offset-key="2592:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="2593"><span data-slate-leaf="true" data-offset-key="2593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mapToInt</span></span></span></span><span data-slate-object="text" data-key="2594"><span data-slate-leaf="true" data-offset-key="2594:0" data-first-offset="true"><span data-slate-string="true">(String::length)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2595"><span data-slate-object="text" data-key="2596"><span data-slate-leaf="true" data-offset-key="2596:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="2597"><span data-slate-leaf="true" data-offset-key="2597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">max</span></span></span></span><span data-slate-object="text" data-key="2598"><span data-slate-leaf="true" data-offset-key="2598:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2599"><span data-slate-object="text" data-key="2600"><span data-slate-leaf="true" data-offset-key="2600:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="2601"><span data-slate-leaf="true" data-offset-key="2601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">toString</span></span></span></span><span data-slate-object="text" data-key="2602"><span data-slate-leaf="true" data-offset-key="2602:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2603"><span data-slate-object="text" data-key="2604"><span data-slate-leaf="true" data-offset-key="2604:0" data-first-offset="true"><span data-slate-string="true">这个例子的需求是查找出一个长度最长，并且以张为姓氏的名字。从代码角度来看，你可能会认为是这样的操作流程：首先遍历一次集合，得到以 “张” 开头的所有名字；然后遍历一次 filter 得到的集合，将名字转换成数字长度；最后再从长度集合中找到最长的那个名字并且返回。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2605"><span data-slate-object="text" data-key="2606"><span data-slate-leaf="true" data-offset-key="2606:0" data-first-offset="true"><span data-slate-string="true">这里我要很明确地告诉你，实际情况并非如此。我们来逐步分析下这个方法里所有的操作是如何执行的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2607"><span data-slate-object="text" data-key="2608"><span data-slate-leaf="true" data-offset-key="2608:0" data-first-offset="true"><span data-slate-string="true">首先 ，因为 names 是 ArrayList 集合，所以 names.stream () 方法将会调用集合类基础接口 Collection 的 Stream 方法：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="2609"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2610"><span data-slate-object="text" data-key="2611"><span data-slate-leaf="true" data-offset-key="2611:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2612"><span data-slate-leaf="true" data-offset-key="2612:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">default</span></span></span></span><span data-slate-object="text" data-key="2613"><span data-slate-leaf="true" data-offset-key="2613:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2614"><span data-slate-leaf="true" data-offset-key="2614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Stream</span></span></span></span><span data-slate-object="text" data-key="2615"><span data-slate-leaf="true" data-offset-key="2615:0" data-first-offset="true"><span data-slate-string="true">&lt;E&gt; </span></span></span><span data-slate-object="text" data-key="2616"><span data-slate-leaf="true" data-offset-key="2616:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="2617"><span data-slate-leaf="true" data-offset-key="2617:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2618"><span data-slate-leaf="true" data-offset-key="2618:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2619"><span data-slate-object="text" data-key="2620"><span data-slate-leaf="true" data-offset-key="2620:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2621"><span data-slate-leaf="true" data-offset-key="2621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2622"><span data-slate-leaf="true" data-offset-key="2622:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2623"><span data-slate-leaf="true" data-offset-key="2623:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamSupport</span></span></span></span><span data-slate-object="text" data-key="2624"><span data-slate-leaf="true" data-offset-key="2624:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2625"><span data-slate-leaf="true" data-offset-key="2625:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="2626"><span data-slate-leaf="true" data-offset-key="2626:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2627"><span data-slate-leaf="true" data-offset-key="2627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">spliterator</span></span></span></span><span data-slate-object="text" data-key="2628"><span data-slate-leaf="true" data-offset-key="2628:0" data-first-offset="true"><span data-slate-string="true">(), </span></span></span><span data-slate-object="text" data-key="2629"><span data-slate-leaf="true" data-offset-key="2629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">false</span></span></span></span><span data-slate-object="text" data-key="2630"><span data-slate-leaf="true" data-offset-key="2630:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2631"><span data-slate-object="text" data-key="2632"><span data-slate-leaf="true" data-offset-key="2632:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2633"><span data-slate-object="text" data-key="2634"><span data-slate-leaf="true" data-offset-key="2634:0" data-first-offset="true"><span data-slate-string="true">然后，Stream 方法就会调用 StreamSupport 类的 Stream 方法，方法中初始化了一个 ReferencePipeline 的 Head 内部类对象：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="2635"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2636"><span data-slate-object="text" data-key="2637"><span data-slate-leaf="true" data-offset-key="2637:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2638"><span data-slate-leaf="true" data-offset-key="2638:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2639"><span data-slate-leaf="true" data-offset-key="2639:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2640"><span data-slate-leaf="true" data-offset-key="2640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">static</span></span></span></span><span data-slate-object="text" data-key="2641"><span data-slate-leaf="true" data-offset-key="2641:0" data-first-offset="true"><span data-slate-string="true"> &lt;T&gt; </span></span></span><span data-slate-object="text" data-key="2642"><span data-slate-leaf="true" data-offset-key="2642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Stream</span></span></span></span><span data-slate-object="text" data-key="2643"><span data-slate-leaf="true" data-offset-key="2643:0" data-first-offset="true"><span data-slate-string="true">&lt;T&gt; </span></span></span><span data-slate-object="text" data-key="2644"><span data-slate-leaf="true" data-offset-key="2644:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="2645"><span data-slate-leaf="true" data-offset-key="2645:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2646"><span data-slate-leaf="true" data-offset-key="2646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Spliterator&lt;T&gt; spliterator, </span></span></span></span><span data-slate-object="text" data-key="2647"><span data-slate-leaf="true" data-offset-key="2647:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">boolean</span></span></span></span></span><span data-slate-object="text" data-key="2648"><span data-slate-leaf="true" data-offset-key="2648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> parallel</span></span></span></span><span data-slate-object="text" data-key="2649"><span data-slate-leaf="true" data-offset-key="2649:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2650"><span data-slate-object="text" data-key="2651"><span data-slate-leaf="true" data-offset-key="2651:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2652"><span data-slate-leaf="true" data-offset-key="2652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Objects</span></span></span></span><span data-slate-object="text" data-key="2653"><span data-slate-leaf="true" data-offset-key="2653:0" data-first-offset="true"><span data-slate-string="true">.requireNonNull(spliterator);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2654"><span data-slate-object="text" data-key="2655"><span data-slate-leaf="true" data-offset-key="2655:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2656"><span data-slate-leaf="true" data-offset-key="2656:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2657"><span data-slate-leaf="true" data-offset-key="2657:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2658"><span data-slate-leaf="true" data-offset-key="2658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2659"><span data-slate-leaf="true" data-offset-key="2659:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2660"><span data-slate-leaf="true" data-offset-key="2660:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ReferencePipeline</span></span></span></span><span data-slate-object="text" data-key="2661"><span data-slate-leaf="true" data-offset-key="2661:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2662"><span data-slate-leaf="true" data-offset-key="2662:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Head</span></span></span></span><span data-slate-object="text" data-key="2663"><span data-slate-leaf="true" data-offset-key="2663:0" data-first-offset="true"><span data-slate-string="true">&lt;&gt;(spliterator,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2664"><span data-slate-object="text" data-key="2665"><span data-slate-leaf="true" data-offset-key="2665:0" data-first-offset="true"><span data-slate-string="true">                                            </span></span></span><span data-slate-object="text" data-key="2666"><span data-slate-leaf="true" data-offset-key="2666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamOpFlag</span></span></span></span><span data-slate-object="text" data-key="2667"><span data-slate-leaf="true" data-offset-key="2667:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2668"><span data-slate-leaf="true" data-offset-key="2668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">fromCharacteristics</span></span></span></span><span data-slate-object="text" data-key="2669"><span data-slate-leaf="true" data-offset-key="2669:0" data-first-offset="true"><span data-slate-string="true">(spliterator),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2670"><span data-slate-object="text" data-key="2671"><span data-slate-leaf="true" data-offset-key="2671:0" data-first-offset="true"><span data-slate-string="true">                                            parallel);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2672"><span data-slate-object="text" data-key="2673"><span data-slate-leaf="true" data-offset-key="2673:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2674"><span data-slate-object="text" data-key="2675"><span data-slate-leaf="true" data-offset-key="2675:0" data-first-offset="true"><span data-slate-string="true">再调用 filter 和 map 方法，这两个方法都是无状态的中间操作，所以执行 filter 和 map 操作时，并没有进行任何的操作，而是分别创建了一个 Stage 来标识用户的每一次操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2676"><span data-slate-object="text" data-key="2677"><span data-slate-leaf="true" data-offset-key="2677:0" data-first-offset="true"><span data-slate-string="true">而通常情况下 Stream 的操作又需要一个回调函数，所以一个完整的 Stage 是由数据来源、操作、回调函数组成的三元组来表示。如下图所示，分别是 ReferencePipeline 的 filter 方法和 map 方法：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="2678"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2679"><span data-slate-object="text" data-key="2680"><span data-slate-leaf="true" data-offset-key="2680:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="2681"><span data-slate-leaf="true" data-offset-key="2681:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2682"><span data-slate-object="text" data-key="2683"><span data-slate-leaf="true" data-offset-key="2683:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2684"><span data-slate-leaf="true" data-offset-key="2684:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2685"><span data-slate-leaf="true" data-offset-key="2685:0" data-first-offset="true"><span data-slate-string="true"> final </span></span></span><span data-slate-object="text" data-key="2686"><span data-slate-leaf="true" data-offset-key="2686:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Stream</span></span></span></span><span data-slate-object="text" data-key="2687"><span data-slate-leaf="true" data-offset-key="2687:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2688"><span data-slate-leaf="true" data-offset-key="2688:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2689"><span data-slate-leaf="true" data-offset-key="2689:0" data-first-offset="true"><span data-slate-string="true">&gt; </span></span></span><span data-slate-object="text" data-key="2690"><span data-slate-leaf="true" data-offset-key="2690:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="2691"><span data-slate-leaf="true" data-offset-key="2691:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2692"><span data-slate-leaf="true" data-offset-key="2692:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Predicate&lt;? </span></span></span></span><span data-slate-object="text" data-key="2693"><span data-slate-leaf="true" data-offset-key="2693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span></span><span data-slate-object="text" data-key="2694"><span data-slate-leaf="true" data-offset-key="2694:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> P_OUT&gt; predicate</span></span></span></span><span data-slate-object="text" data-key="2695"><span data-slate-leaf="true" data-offset-key="2695:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2696"><span data-slate-object="text" data-key="2697"><span data-slate-leaf="true" data-offset-key="2697:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2698"><span data-slate-leaf="true" data-offset-key="2698:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Objects</span></span></span></span><span data-slate-object="text" data-key="2699"><span data-slate-leaf="true" data-offset-key="2699:0" data-first-offset="true"><span data-slate-string="true">.requireNonNull(predicate);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2700"><span data-slate-object="text" data-key="2701"><span data-slate-leaf="true" data-offset-key="2701:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2702"><span data-slate-leaf="true" data-offset-key="2702:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2703"><span data-slate-leaf="true" data-offset-key="2703:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2704"><span data-slate-leaf="true" data-offset-key="2704:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2705"><span data-slate-leaf="true" data-offset-key="2705:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2706"><span data-slate-leaf="true" data-offset-key="2706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StatelessOp</span></span></span></span><span data-slate-object="text" data-key="2707"><span data-slate-leaf="true" data-offset-key="2707:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2708"><span data-slate-leaf="true" data-offset-key="2708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2709"><span data-slate-leaf="true" data-offset-key="2709:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2710"><span data-slate-leaf="true" data-offset-key="2710:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2711"><span data-slate-leaf="true" data-offset-key="2711:0" data-first-offset="true"><span data-slate-string="true">&gt;(</span></span></span><span data-slate-object="text" data-key="2712"><span data-slate-leaf="true" data-offset-key="2712:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2713"><span data-slate-leaf="true" data-offset-key="2713:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2714"><span data-slate-leaf="true" data-offset-key="2714:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamShape</span></span></span></span><span data-slate-object="text" data-key="2715"><span data-slate-leaf="true" data-offset-key="2715:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2716"><span data-slate-leaf="true" data-offset-key="2716:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">REFERENCE</span></span></span></span><span data-slate-object="text" data-key="2717"><span data-slate-leaf="true" data-offset-key="2717:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2718"><span data-slate-object="text" data-key="2719"><span data-slate-leaf="true" data-offset-key="2719:0" data-first-offset="true"><span data-slate-string="true">                                     </span></span></span><span data-slate-object="text" data-key="2720"><span data-slate-leaf="true" data-offset-key="2720:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamOpFlag</span></span></span></span><span data-slate-object="text" data-key="2721"><span data-slate-leaf="true" data-offset-key="2721:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2722"><span data-slate-leaf="true" data-offset-key="2722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NOT_SIZED</span></span></span></span><span data-slate-object="text" data-key="2723"><span data-slate-leaf="true" data-offset-key="2723:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2724"><span data-slate-object="text" data-key="2725"><span data-slate-leaf="true" data-offset-key="2725:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2726"><span data-slate-leaf="true" data-offset-key="2726:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2727"><span data-slate-object="text" data-key="2728"><span data-slate-leaf="true" data-offset-key="2728:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2729"><span data-slate-leaf="true" data-offset-key="2729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Sink</span></span></span></span><span data-slate-object="text" data-key="2730"><span data-slate-leaf="true" data-offset-key="2730:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2731"><span data-slate-leaf="true" data-offset-key="2731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2732"><span data-slate-leaf="true" data-offset-key="2732:0" data-first-offset="true"><span data-slate-string="true">&gt; </span></span></span><span data-slate-object="text" data-key="2733"><span data-slate-leaf="true" data-offset-key="2733:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">opWrapSink</span></span></span></span><span data-slate-object="text" data-key="2734"><span data-slate-leaf="true" data-offset-key="2734:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2735"><span data-slate-leaf="true" data-offset-key="2735:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int flags, Sink&lt;P_OUT&gt; sink</span></span></span></span><span data-slate-object="text" data-key="2736"><span data-slate-leaf="true" data-offset-key="2736:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2737"><span data-slate-object="text" data-key="2738"><span data-slate-leaf="true" data-offset-key="2738:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="2739"><span data-slate-leaf="true" data-offset-key="2739:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2740"><span data-slate-leaf="true" data-offset-key="2740:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2741"><span data-slate-leaf="true" data-offset-key="2741:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2742"><span data-slate-leaf="true" data-offset-key="2742:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2743"><span data-slate-leaf="true" data-offset-key="2743:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Sink</span></span></span></span><span data-slate-object="text" data-key="2744"><span data-slate-leaf="true" data-offset-key="2744:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2745"><span data-slate-leaf="true" data-offset-key="2745:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ChainedReference</span></span></span></span><span data-slate-object="text" data-key="2746"><span data-slate-leaf="true" data-offset-key="2746:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2747"><span data-slate-leaf="true" data-offset-key="2747:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2748"><span data-slate-leaf="true" data-offset-key="2748:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2749"><span data-slate-leaf="true" data-offset-key="2749:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2750"><span data-slate-leaf="true" data-offset-key="2750:0" data-first-offset="true"><span data-slate-string="true">&gt;(sink) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2751"><span data-slate-object="text" data-key="2752"><span data-slate-leaf="true" data-offset-key="2752:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2753"><span data-slate-leaf="true" data-offset-key="2753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2754"><span data-slate-object="text" data-key="2755"><span data-slate-leaf="true" data-offset-key="2755:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2756"><span data-slate-leaf="true" data-offset-key="2756:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2757"><span data-slate-leaf="true" data-offset-key="2757:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2758"><span data-slate-leaf="true" data-offset-key="2758:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2759"><span data-slate-leaf="true" data-offset-key="2759:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2760"><span data-slate-leaf="true" data-offset-key="2760:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">begin</span></span></span></span><span data-slate-object="text" data-key="2761"><span data-slate-leaf="true" data-offset-key="2761:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2762"><span data-slate-leaf="true" data-offset-key="2762:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">long size</span></span></span></span><span data-slate-object="text" data-key="2763"><span data-slate-leaf="true" data-offset-key="2763:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2764"><span data-slate-object="text" data-key="2765"><span data-slate-leaf="true" data-offset-key="2765:0" data-first-offset="true"><span data-slate-string="true">                        downstream.</span></span></span><span data-slate-object="text" data-key="2766"><span data-slate-leaf="true" data-offset-key="2766:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">begin</span></span></span></span><span data-slate-object="text" data-key="2767"><span data-slate-leaf="true" data-offset-key="2767:0" data-first-offset="true"><span data-slate-string="true">(-</span></span></span><span data-slate-object="text" data-key="2768"><span data-slate-leaf="true" data-offset-key="2768:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2769"><span data-slate-leaf="true" data-offset-key="2769:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2770"><span data-slate-object="text" data-key="2771"><span data-slate-leaf="true" data-offset-key="2771:0" data-first-offset="true"><span data-slate-string="true">                    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2772"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2773"><span data-slate-object="text" data-key="2774"><span data-slate-leaf="true" data-offset-key="2774:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2775"><span data-slate-leaf="true" data-offset-key="2775:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2776"><span data-slate-object="text" data-key="2777"><span data-slate-leaf="true" data-offset-key="2777:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2778"><span data-slate-leaf="true" data-offset-key="2778:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2779"><span data-slate-leaf="true" data-offset-key="2779:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2780"><span data-slate-leaf="true" data-offset-key="2780:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2781"><span data-slate-leaf="true" data-offset-key="2781:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2782"><span data-slate-leaf="true" data-offset-key="2782:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">accept</span></span></span></span><span data-slate-object="text" data-key="2783"><span data-slate-leaf="true" data-offset-key="2783:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2784"><span data-slate-leaf="true" data-offset-key="2784:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT u</span></span></span></span><span data-slate-object="text" data-key="2785"><span data-slate-leaf="true" data-offset-key="2785:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2786"><span data-slate-object="text" data-key="2787"><span data-slate-leaf="true" data-offset-key="2787:0" data-first-offset="true"><span data-slate-string="true">                        </span></span></span><span data-slate-object="text" data-key="2788"><span data-slate-leaf="true" data-offset-key="2788:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2789"><span data-slate-leaf="true" data-offset-key="2789:0" data-first-offset="true"><span data-slate-string="true"> (predicate.</span></span></span><span data-slate-object="text" data-key="2790"><span data-slate-leaf="true" data-offset-key="2790:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">test</span></span></span></span><span data-slate-object="text" data-key="2791"><span data-slate-leaf="true" data-offset-key="2791:0" data-first-offset="true"><span data-slate-string="true">(u))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2792"><span data-slate-object="text" data-key="2793"><span data-slate-leaf="true" data-offset-key="2793:0" data-first-offset="true"><span data-slate-string="true">                            downstream.</span></span></span><span data-slate-object="text" data-key="2794"><span data-slate-leaf="true" data-offset-key="2794:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">accept</span></span></span></span><span data-slate-object="text" data-key="2795"><span data-slate-leaf="true" data-offset-key="2795:0" data-first-offset="true"><span data-slate-string="true">(u);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2796"><span data-slate-object="text" data-key="2797"><span data-slate-leaf="true" data-offset-key="2797:0" data-first-offset="true"><span data-slate-string="true">                    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2798"><span data-slate-object="text" data-key="2799"><span data-slate-leaf="true" data-offset-key="2799:0" data-first-offset="true"><span data-slate-string="true">                };</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2800"><span data-slate-object="text" data-key="2801"><span data-slate-leaf="true" data-offset-key="2801:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2802"><span data-slate-object="text" data-key="2803"><span data-slate-leaf="true" data-offset-key="2803:0" data-first-offset="true"><span data-slate-string="true">        };</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2804"><span data-slate-object="text" data-key="2805"><span data-slate-leaf="true" data-offset-key="2805:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="2806"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2807"><span data-slate-object="text" data-key="2808"><span data-slate-leaf="true" data-offset-key="2808:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="2809"><span data-slate-leaf="true" data-offset-key="2809:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2810"><span data-slate-object="text" data-key="2811"><span data-slate-leaf="true" data-offset-key="2811:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2812"><span data-slate-leaf="true" data-offset-key="2812:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@SuppressWarnings</span></span></span></span><span data-slate-object="text" data-key="2813"><span data-slate-leaf="true" data-offset-key="2813:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2814"><span data-slate-leaf="true" data-offset-key="2814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"unchecked"</span></span></span></span><span data-slate-object="text" data-key="2815"><span data-slate-leaf="true" data-offset-key="2815:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2816"><span data-slate-object="text" data-key="2817"><span data-slate-leaf="true" data-offset-key="2817:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2818"><span data-slate-leaf="true" data-offset-key="2818:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2819"><span data-slate-leaf="true" data-offset-key="2819:0" data-first-offset="true"><span data-slate-string="true"> final &lt;R&gt; </span></span></span><span data-slate-object="text" data-key="2820"><span data-slate-leaf="true" data-offset-key="2820:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Stream</span></span></span></span><span data-slate-object="text" data-key="2821"><span data-slate-leaf="true" data-offset-key="2821:0" data-first-offset="true"><span data-slate-string="true">&lt;R&gt; </span></span></span><span data-slate-object="text" data-key="2822"><span data-slate-leaf="true" data-offset-key="2822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="2823"><span data-slate-leaf="true" data-offset-key="2823:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2824"><span data-slate-leaf="true" data-offset-key="2824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Function</span></span></span></span></span><span data-slate-object="text" data-key="2825"><span data-slate-leaf="true" data-offset-key="2825:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">&lt;? </span></span></span></span><span data-slate-object="text" data-key="2826"><span data-slate-leaf="true" data-offset-key="2826:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span></span><span data-slate-object="text" data-key="2827"><span data-slate-leaf="true" data-offset-key="2827:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> P_OUT, ? </span></span></span></span><span data-slate-object="text" data-key="2828"><span data-slate-leaf="true" data-offset-key="2828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">extends</span></span></span></span></span><span data-slate-object="text" data-key="2829"><span data-slate-leaf="true" data-offset-key="2829:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> R&gt; mapper</span></span></span></span><span data-slate-object="text" data-key="2830"><span data-slate-leaf="true" data-offset-key="2830:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2831"><span data-slate-object="text" data-key="2832"><span data-slate-leaf="true" data-offset-key="2832:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2833"><span data-slate-leaf="true" data-offset-key="2833:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Objects</span></span></span></span><span data-slate-object="text" data-key="2834"><span data-slate-leaf="true" data-offset-key="2834:0" data-first-offset="true"><span data-slate-string="true">.requireNonNull(mapper);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2835"><span data-slate-object="text" data-key="2836"><span data-slate-leaf="true" data-offset-key="2836:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2837"><span data-slate-leaf="true" data-offset-key="2837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2838"><span data-slate-leaf="true" data-offset-key="2838:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2839"><span data-slate-leaf="true" data-offset-key="2839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2840"><span data-slate-leaf="true" data-offset-key="2840:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2841"><span data-slate-leaf="true" data-offset-key="2841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StatelessOp</span></span></span></span><span data-slate-object="text" data-key="2842"><span data-slate-leaf="true" data-offset-key="2842:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2843"><span data-slate-leaf="true" data-offset-key="2843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2844"><span data-slate-leaf="true" data-offset-key="2844:0" data-first-offset="true"><span data-slate-string="true">, R&gt;(</span></span></span><span data-slate-object="text" data-key="2845"><span data-slate-leaf="true" data-offset-key="2845:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2846"><span data-slate-leaf="true" data-offset-key="2846:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="2847"><span data-slate-leaf="true" data-offset-key="2847:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamShape</span></span></span></span><span data-slate-object="text" data-key="2848"><span data-slate-leaf="true" data-offset-key="2848:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2849"><span data-slate-leaf="true" data-offset-key="2849:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">REFERENCE</span></span></span></span><span data-slate-object="text" data-key="2850"><span data-slate-leaf="true" data-offset-key="2850:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2851"><span data-slate-object="text" data-key="2852"><span data-slate-leaf="true" data-offset-key="2852:0" data-first-offset="true"><span data-slate-string="true">                                     </span></span></span><span data-slate-object="text" data-key="2853"><span data-slate-leaf="true" data-offset-key="2853:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamOpFlag</span></span></span></span><span data-slate-object="text" data-key="2854"><span data-slate-leaf="true" data-offset-key="2854:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2855"><span data-slate-leaf="true" data-offset-key="2855:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NOT_SORTED</span></span></span></span><span data-slate-object="text" data-key="2856"><span data-slate-leaf="true" data-offset-key="2856:0" data-first-offset="true"><span data-slate-string="true"> | </span></span></span><span data-slate-object="text" data-key="2857"><span data-slate-leaf="true" data-offset-key="2857:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">StreamOpFlag</span></span></span></span><span data-slate-object="text" data-key="2858"><span data-slate-leaf="true" data-offset-key="2858:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2859"><span data-slate-leaf="true" data-offset-key="2859:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NOT_DISTINCT</span></span></span></span><span data-slate-object="text" data-key="2860"><span data-slate-leaf="true" data-offset-key="2860:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2861"><span data-slate-object="text" data-key="2862"><span data-slate-leaf="true" data-offset-key="2862:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2863"><span data-slate-leaf="true" data-offset-key="2863:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2864"><span data-slate-object="text" data-key="2865"><span data-slate-leaf="true" data-offset-key="2865:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2866"><span data-slate-leaf="true" data-offset-key="2866:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Sink</span></span></span></span><span data-slate-object="text" data-key="2867"><span data-slate-leaf="true" data-offset-key="2867:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2868"><span data-slate-leaf="true" data-offset-key="2868:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2869"><span data-slate-leaf="true" data-offset-key="2869:0" data-first-offset="true"><span data-slate-string="true">&gt; </span></span></span><span data-slate-object="text" data-key="2870"><span data-slate-leaf="true" data-offset-key="2870:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">opWrapSink</span></span></span></span><span data-slate-object="text" data-key="2871"><span data-slate-leaf="true" data-offset-key="2871:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2872"><span data-slate-leaf="true" data-offset-key="2872:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int flags, Sink&lt;R&gt; sink</span></span></span></span><span data-slate-object="text" data-key="2873"><span data-slate-leaf="true" data-offset-key="2873:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2874"><span data-slate-object="text" data-key="2875"><span data-slate-leaf="true" data-offset-key="2875:0" data-first-offset="true"><span data-slate-string="true">                </span></span></span><span data-slate-object="text" data-key="2876"><span data-slate-leaf="true" data-offset-key="2876:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="2877"><span data-slate-leaf="true" data-offset-key="2877:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2878"><span data-slate-leaf="true" data-offset-key="2878:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2879"><span data-slate-leaf="true" data-offset-key="2879:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2880"><span data-slate-leaf="true" data-offset-key="2880:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Sink</span></span></span></span><span data-slate-object="text" data-key="2881"><span data-slate-leaf="true" data-offset-key="2881:0" data-first-offset="true"><span data-slate-string="true">.</span></span></span><span data-slate-object="text" data-key="2882"><span data-slate-leaf="true" data-offset-key="2882:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ChainedReference</span></span></span></span><span data-slate-object="text" data-key="2883"><span data-slate-leaf="true" data-offset-key="2883:0" data-first-offset="true"><span data-slate-string="true">&lt;</span></span></span><span data-slate-object="text" data-key="2884"><span data-slate-leaf="true" data-offset-key="2884:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT</span></span></span></span><span data-slate-object="text" data-key="2885"><span data-slate-leaf="true" data-offset-key="2885:0" data-first-offset="true"><span data-slate-string="true">, R&gt;(sink) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2886"><span data-slate-object="text" data-key="2887"><span data-slate-leaf="true" data-offset-key="2887:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2888"><span data-slate-leaf="true" data-offset-key="2888:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2889"><span data-slate-object="text" data-key="2890"><span data-slate-leaf="true" data-offset-key="2890:0" data-first-offset="true"><span data-slate-string="true">                    </span></span></span><span data-slate-object="text" data-key="2891"><span data-slate-leaf="true" data-offset-key="2891:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2892"><span data-slate-leaf="true" data-offset-key="2892:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2893"><span data-slate-leaf="true" data-offset-key="2893:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="2894"><span data-slate-leaf="true" data-offset-key="2894:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2895"><span data-slate-leaf="true" data-offset-key="2895:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">accept</span></span></span></span><span data-slate-object="text" data-key="2896"><span data-slate-leaf="true" data-offset-key="2896:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="2897"><span data-slate-leaf="true" data-offset-key="2897:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">P_OUT u</span></span></span></span><span data-slate-object="text" data-key="2898"><span data-slate-leaf="true" data-offset-key="2898:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2899"><span data-slate-object="text" data-key="2900"><span data-slate-leaf="true" data-offset-key="2900:0" data-first-offset="true"><span data-slate-string="true">                        downstream.</span></span></span><span data-slate-object="text" data-key="2901"><span data-slate-leaf="true" data-offset-key="2901:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">accept</span></span></span></span><span data-slate-object="text" data-key="2902"><span data-slate-leaf="true" data-offset-key="2902:0" data-first-offset="true"><span data-slate-string="true">(mapper.</span></span></span><span data-slate-object="text" data-key="2903"><span data-slate-leaf="true" data-offset-key="2903:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">apply</span></span></span></span><span data-slate-object="text" data-key="2904"><span data-slate-leaf="true" data-offset-key="2904:0" data-first-offset="true"><span data-slate-string="true">(u));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2905"><span data-slate-object="text" data-key="2906"><span data-slate-leaf="true" data-offset-key="2906:0" data-first-offset="true"><span data-slate-string="true">                    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2907"><span data-slate-object="text" data-key="2908"><span data-slate-leaf="true" data-offset-key="2908:0" data-first-offset="true"><span data-slate-string="true">                };</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2909"><span data-slate-object="text" data-key="2910"><span data-slate-leaf="true" data-offset-key="2910:0" data-first-offset="true"><span data-slate-string="true">            }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2911"><span data-slate-object="text" data-key="2912"><span data-slate-leaf="true" data-offset-key="2912:0" data-first-offset="true"><span data-slate-string="true">        };</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2913"><span data-slate-object="text" data-key="2914"><span data-slate-leaf="true" data-offset-key="2914:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2915"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2916"><span data-slate-object="text" data-key="2917"><span data-slate-leaf="true" data-offset-key="2917:0" data-first-offset="true"><span data-slate-string="true">new StatelessOp 将会调用父类 AbstractPipeline 的构造函数，这个构造函数将前后的 Stage 联系起来，生成一个 Stage 链表：</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2918"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2919"><span data-slate-object="text" data-key="2920"><span data-slate-leaf="true" data-offset-key="2920:0" data-first-offset="true"><span data-slate-string="true"> AbstractPipeline(AbstractPipeline&lt;?, E_IN, ?&gt; previousStage, </span></span></span><span data-slate-object="text" data-key="2921"><span data-slate-leaf="true" data-offset-key="2921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="2922"><span data-slate-leaf="true" data-offset-key="2922:0" data-first-offset="true"><span data-slate-string="true"> opFlags) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2923"><span data-slate-object="text" data-key="2924"><span data-slate-leaf="true" data-offset-key="2924:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2925"><span data-slate-leaf="true" data-offset-key="2925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2926"><span data-slate-leaf="true" data-offset-key="2926:0" data-first-offset="true"><span data-slate-string="true"> (previousStage.linkedOrConsumed)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2927"><span data-slate-object="text" data-key="2928"><span data-slate-leaf="true" data-offset-key="2928:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="2929"><span data-slate-leaf="true" data-offset-key="2929:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="2930"><span data-slate-leaf="true" data-offset-key="2930:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2931"><span data-slate-leaf="true" data-offset-key="2931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="2932"><span data-slate-leaf="true" data-offset-key="2932:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2933"><span data-slate-leaf="true" data-offset-key="2933:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">IllegalStateException</span></span></span></span><span data-slate-object="text" data-key="2934"><span data-slate-leaf="true" data-offset-key="2934:0" data-first-offset="true"><span data-slate-string="true">(MSG_STREAM_LINKED);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2935"><span data-slate-object="text" data-key="2936"><span data-slate-leaf="true" data-offset-key="2936:0" data-first-offset="true"><span data-slate-string="true">        previousStage.linkedOrConsumed = </span></span></span><span data-slate-object="text" data-key="2937"><span data-slate-leaf="true" data-offset-key="2937:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="2938"><span data-slate-leaf="true" data-offset-key="2938:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2939"><span data-slate-object="text" data-key="2940"><span data-slate-leaf="true" data-offset-key="2940:0" data-first-offset="true"><span data-slate-string="true">        previousStage.nextStage = </span></span></span><span data-slate-object="text" data-key="2941"><span data-slate-leaf="true" data-offset-key="2941:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2942"><span data-slate-leaf="true" data-offset-key="2942:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span><span data-slate-object="text" data-key="2943"><span data-slate-leaf="true" data-offset-key="2943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 将当前的 stage 的 next 指针指向之前的 stage</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2944"></div><div data-slate-type="code-line" data-slate-object="block" data-key="2945"><span data-slate-object="text" data-key="2946"><span data-slate-leaf="true" data-offset-key="2946:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2947"><span data-slate-leaf="true" data-offset-key="2947:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2948"><span data-slate-leaf="true" data-offset-key="2948:0" data-first-offset="true"><span data-slate-string="true">.previousStage = previousStage;</span></span></span><span data-slate-object="text" data-key="2949"><span data-slate-leaf="true" data-offset-key="2949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 赋值当前 stage 当全局变量 previousStage </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2950"><span data-slate-object="text" data-key="2951"><span data-slate-leaf="true" data-offset-key="2951:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2952"><span data-slate-leaf="true" data-offset-key="2952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2953"><span data-slate-leaf="true" data-offset-key="2953:0" data-first-offset="true"><span data-slate-string="true">.sourceOrOpFlags = opFlags &amp; StreamOpFlag.OP_MASK;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2954"><span data-slate-object="text" data-key="2955"><span data-slate-leaf="true" data-offset-key="2955:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2956"><span data-slate-leaf="true" data-offset-key="2956:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2957"><span data-slate-leaf="true" data-offset-key="2957:0" data-first-offset="true"><span data-slate-string="true">.combinedFlags = StreamOpFlag.combineOpFlags(opFlags, previousStage.combinedFlags);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2958"><span data-slate-object="text" data-key="2959"><span data-slate-leaf="true" data-offset-key="2959:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2960"><span data-slate-leaf="true" data-offset-key="2960:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2961"><span data-slate-leaf="true" data-offset-key="2961:0" data-first-offset="true"><span data-slate-string="true">.sourceStage = previousStage.sourceStage;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2962"><span data-slate-object="text" data-key="2963"><span data-slate-leaf="true" data-offset-key="2963:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2964"><span data-slate-leaf="true" data-offset-key="2964:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="2965"><span data-slate-leaf="true" data-offset-key="2965:0" data-first-offset="true"><span data-slate-string="true"> (opIsStateful())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2966"><span data-slate-object="text" data-key="2967"><span data-slate-leaf="true" data-offset-key="2967:0" data-first-offset="true"><span data-slate-string="true">            sourceStage.sourceAnyStateful = </span></span></span><span data-slate-object="text" data-key="2968"><span data-slate-leaf="true" data-offset-key="2968:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="2969"><span data-slate-leaf="true" data-offset-key="2969:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2970"><span data-slate-object="text" data-key="2971"><span data-slate-leaf="true" data-offset-key="2971:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2972"><span data-slate-leaf="true" data-offset-key="2972:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="2973"><span data-slate-leaf="true" data-offset-key="2973:0" data-first-offset="true"><span data-slate-string="true">.depth = previousStage.depth + </span></span></span><span data-slate-object="text" data-key="2974"><span data-slate-leaf="true" data-offset-key="2974:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="2975"><span data-slate-leaf="true" data-offset-key="2975:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2976"><span data-slate-object="text" data-key="2977"><span data-slate-leaf="true" data-offset-key="2977:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2978"><span data-slate-object="text" data-key="2979"><span data-slate-leaf="true" data-offset-key="2979:0" data-first-offset="true"><span data-slate-string="true">因为在创建每一个 Stage 时，都会包含一个 opWrapSink () 方法，该方法会把一个操作的具体实现封装在 Sink 类中，Sink 采用（处理 -&gt; 转发）的模式来叠加操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="2980"><span data-slate-object="text" data-key="2981"><span data-slate-leaf="true" data-offset-key="2981:0" data-first-offset="true"><span data-slate-string="true">当执行 max 方法时，会调用 ReferencePipeline 的 max 方法，此时由于 max 方法是终结操作，所以会创建一个 TerminalOp 操作，同时创建一个 ReducingSink，并且将操作封装在 Sink 类中。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="2982"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="2983"><span data-slate-object="text" data-key="2984"><span data-slate-leaf="true" data-offset-key="2984:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2985"><span data-slate-leaf="true" data-offset-key="2985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2986"><span data-slate-object="text" data-key="2987"><span data-slate-leaf="true" data-offset-key="2987:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="2988"><span data-slate-leaf="true" data-offset-key="2988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">public</span></span></span></span><span data-slate-object="text" data-key="2989"><span data-slate-leaf="true" data-offset-key="2989:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="2990"><span data-slate-leaf="true" data-offset-key="2990:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="2991"><span data-slate-leaf="true" data-offset-key="2991:0" data-first-offset="true"><span data-slate-string="true"> Optional&lt;P_OUT&gt; </span></span></span><span data-slate-object="text" data-key="2992"><span data-slate-leaf="true" data-offset-key="2992:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">max</span></span></span></span><span data-slate-object="text" data-key="2993"><span data-slate-leaf="true" data-offset-key="2993:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(Comparator&lt;? </span></span></span></span><span data-slate-object="text" data-key="2994"><span data-slate-leaf="true" data-offset-key="2994:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">super</span></span></span></span></span><span data-slate-object="text" data-key="2995"><span data-slate-leaf="true" data-offset-key="2995:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> P_OUT&gt; comparator)</span></span></span></span><span data-slate-object="text" data-key="2996"><span data-slate-leaf="true" data-offset-key="2996:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="2997"><span data-slate-object="text" data-key="2998"><span data-slate-leaf="true" data-offset-key="2998:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="2999"><span data-slate-leaf="true" data-offset-key="2999:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3000"><span data-slate-leaf="true" data-offset-key="3000:0" data-first-offset="true"><span data-slate-string="true"> reduce(BinaryOperator.maxBy(comparator));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3001"><span data-slate-object="text" data-key="3002"><span data-slate-leaf="true" data-offset-key="3002:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3003"><span data-slate-object="text" data-key="3004"><span data-slate-leaf="true" data-offset-key="3004:0" data-first-offset="true"><span data-slate-string="true">最后，调用 AbstractPipeline 的 wrapSink 方法，该方法会调用 opWrapSink 生成一个 Sink 链表，Sink 链表中的每一个 Sink 都封装了一个操作的具体实现。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="3005"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3006"><span data-slate-object="text" data-key="3007"><span data-slate-leaf="true" data-offset-key="3007:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="3008"><span data-slate-leaf="true" data-offset-key="3008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3009"><span data-slate-object="text" data-key="3010"><span data-slate-leaf="true" data-offset-key="3010:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3011"><span data-slate-leaf="true" data-offset-key="3011:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@SuppressWarnings("unchecked")</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3012"><span data-slate-object="text" data-key="3013"><span data-slate-leaf="true" data-offset-key="3013:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3014"><span data-slate-leaf="true" data-offset-key="3014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="3015"><span data-slate-leaf="true" data-offset-key="3015:0" data-first-offset="true"><span data-slate-string="true"> &lt;P_IN&gt; Sink&lt;P_IN&gt; </span></span></span><span data-slate-object="text" data-key="3016"><span data-slate-leaf="true" data-offset-key="3016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">wrapSink</span></span></span></span><span data-slate-object="text" data-key="3017"><span data-slate-leaf="true" data-offset-key="3017:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(Sink&lt;E_OUT&gt; sink)</span></span></span></span><span data-slate-object="text" data-key="3018"><span data-slate-leaf="true" data-offset-key="3018:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3019"><span data-slate-object="text" data-key="3020"><span data-slate-leaf="true" data-offset-key="3020:0" data-first-offset="true"><span data-slate-string="true">        Objects.requireNonNull(sink);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3021"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3022"><span data-slate-object="text" data-key="3023"><span data-slate-leaf="true" data-offset-key="3023:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3024"><span data-slate-leaf="true" data-offset-key="3024:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="3025"><span data-slate-leaf="true" data-offset-key="3025:0" data-first-offset="true"><span data-slate-string="true"> ( </span></span></span><span data-slate-object="text" data-key="3026"><span data-slate-leaf="true" data-offset-key="3026:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@SuppressWarnings("rawtypes")</span></span></span></span><span data-slate-object="text" data-key="3027"><span data-slate-leaf="true" data-offset-key="3027:0" data-first-offset="true"><span data-slate-string="true"> AbstractPipeline p=AbstractPipeline.</span></span></span><span data-slate-object="text" data-key="3028"><span data-slate-leaf="true" data-offset-key="3028:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="3029"><span data-slate-leaf="true" data-offset-key="3029:0" data-first-offset="true"><span data-slate-string="true">; p.depth &gt; </span></span></span><span data-slate-object="text" data-key="3030"><span data-slate-leaf="true" data-offset-key="3030:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3031"><span data-slate-leaf="true" data-offset-key="3031:0" data-first-offset="true"><span data-slate-string="true">; p=p.previousStage) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3032"><span data-slate-object="text" data-key="3033"><span data-slate-leaf="true" data-offset-key="3033:0" data-first-offset="true"><span data-slate-string="true">            sink = p.opWrapSink(p.previousStage.combinedFlags, sink);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3034"><span data-slate-object="text" data-key="3035"><span data-slate-leaf="true" data-offset-key="3035:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3036"><span data-slate-object="text" data-key="3037"><span data-slate-leaf="true" data-offset-key="3037:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3038"><span data-slate-leaf="true" data-offset-key="3038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3039"><span data-slate-leaf="true" data-offset-key="3039:0" data-first-offset="true"><span data-slate-string="true"> (Sink&lt;P_IN&gt;) sink;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3040"><span data-slate-object="text" data-key="3041"><span data-slate-leaf="true" data-offset-key="3041:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3042"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3043"><span data-slate-object="text" data-key="3044"><span data-slate-leaf="true" data-offset-key="3044:0" data-first-offset="true"><span data-slate-string="true">当 Sink 链表生成完成后，Stream 开始执行，通过 spliterator 迭代集合，执行 Sink 链表中的具体操作。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="3045"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3046"><span data-slate-object="text" data-key="3047"><span data-slate-leaf="true" data-offset-key="3047:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3048"><span data-slate-leaf="true" data-offset-key="3048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">@Override</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3049"><span data-slate-object="text" data-key="3050"><span data-slate-leaf="true" data-offset-key="3050:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="3051"><span data-slate-leaf="true" data-offset-key="3051:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="3052"><span data-slate-leaf="true" data-offset-key="3052:0" data-first-offset="true"><span data-slate-string="true"> &lt;P_IN&gt; </span></span></span><span data-slate-object="text" data-key="3053"><span data-slate-leaf="true" data-offset-key="3053:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">void</span></span></span></span><span data-slate-object="text" data-key="3054"><span data-slate-leaf="true" data-offset-key="3054:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3055"><span data-slate-leaf="true" data-offset-key="3055:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">copyInto</span></span></span></span><span data-slate-object="text" data-key="3056"><span data-slate-leaf="true" data-offset-key="3056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(Sink&lt;P_IN&gt; wrappedSink, Spliterator&lt;P_IN&gt; spliterator)</span></span></span></span><span data-slate-object="text" data-key="3057"><span data-slate-leaf="true" data-offset-key="3057:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3058"><span data-slate-object="text" data-key="3059"><span data-slate-leaf="true" data-offset-key="3059:0" data-first-offset="true"><span data-slate-string="true">        Objects.requireNonNull(wrappedSink);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3060"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3061"><span data-slate-object="text" data-key="3062"><span data-slate-leaf="true" data-offset-key="3062:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3063"><span data-slate-leaf="true" data-offset-key="3063:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3064"><span data-slate-leaf="true" data-offset-key="3064:0" data-first-offset="true"><span data-slate-string="true"> (!StreamOpFlag.SHORT_CIRCUIT.isKnown(getStreamAndOpFlags())) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3065"><span data-slate-object="text" data-key="3066"><span data-slate-leaf="true" data-offset-key="3066:0" data-first-offset="true"><span data-slate-string="true">            wrappedSink.begin(spliterator.getExactSizeIfKnown());</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3067"><span data-slate-object="text" data-key="3068"><span data-slate-leaf="true" data-offset-key="3068:0" data-first-offset="true"><span data-slate-string="true">            spliterator.forEachRemaining(wrappedSink);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3069"><span data-slate-object="text" data-key="3070"><span data-slate-leaf="true" data-offset-key="3070:0" data-first-offset="true"><span data-slate-string="true">            wrappedSink.end();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3071"><span data-slate-object="text" data-key="3072"><span data-slate-leaf="true" data-offset-key="3072:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3073"><span data-slate-object="text" data-key="3074"><span data-slate-leaf="true" data-offset-key="3074:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3075"><span data-slate-leaf="true" data-offset-key="3075:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">else</span></span></span></span><span data-slate-object="text" data-key="3076"><span data-slate-leaf="true" data-offset-key="3076:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3077"><span data-slate-object="text" data-key="3078"><span data-slate-leaf="true" data-offset-key="3078:0" data-first-offset="true"><span data-slate-string="true">            copyIntoWithCancel(wrappedSink, spliterator);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3079"><span data-slate-object="text" data-key="3080"><span data-slate-leaf="true" data-offset-key="3080:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3081"><span data-slate-object="text" data-key="3082"><span data-slate-leaf="true" data-offset-key="3082:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3083"><span data-slate-object="text" data-key="3084"><span data-slate-leaf="true" data-offset-key="3084:0" data-first-offset="true"><span data-slate-string="true">Java8 中的 Spliterator 的 forEachRemaining 会迭代集合，每迭代一次，都会执行一次 filter 操作，如果 filter 操作通过，就会触发 map 操作，然后将结果放入到临时数组 object 中，再进行下一次的迭代。完成中间操作后，就会触发终结操作 max。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3085"><span data-slate-object="text" data-key="3086"><span data-slate-leaf="true" data-offset-key="3086:0" data-first-offset="true"><span data-slate-string="true">这就是串行处理方式了，那么 Stream 的另一种处理数据的方式又是怎么操作的呢？</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="3087" id="sr-toc-6"><span data-slate-object="text" data-key="3088"><span data-slate-leaf="true" data-offset-key="3088:0" data-first-offset="true"><span data-slate-string="true">4.Stream 并行处理</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="3089"><span data-slate-object="text" data-key="3090"><span data-slate-leaf="true" data-offset-key="3090:0" data-first-offset="true"><span data-slate-string="true">Stream 处理数据的方式有两种，串行处理和并行处理。要实现并行处理，我们只需要在例子的代码中新增一个 Parallel () 方法，代码如下所示：</span></span></span></div><div data-code-language="rust" data-slate-type="pre" data-slate-object="block" data-key="3091"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3092"><span data-slate-object="text" data-key="3093"><span data-slate-leaf="true" data-offset-key="3093:0" data-first-offset="true"><span data-slate-string="true">List&lt;</span></span></span><span data-slate-object="text" data-key="3094"><span data-slate-leaf="true" data-offset-key="3094:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="3095"><span data-slate-leaf="true" data-offset-key="3095:0" data-first-offset="true"><span data-slate-string="true">&gt; names = Arrays.</span></span></span><span data-slate-object="text" data-key="3096"><span data-slate-leaf="true" data-offset-key="3096:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">asList</span></span></span></span><span data-slate-object="text" data-key="3097"><span data-slate-leaf="true" data-offset-key="3097:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3098"><span data-slate-leaf="true" data-offset-key="3098:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张三"</span></span></span></span><span data-slate-object="text" data-key="3099"><span data-slate-leaf="true" data-offset-key="3099:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3100"><span data-slate-leaf="true" data-offset-key="3100:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"李四"</span></span></span></span><span data-slate-object="text" data-key="3101"><span data-slate-leaf="true" data-offset-key="3101:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3102"><span data-slate-leaf="true" data-offset-key="3102:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"王老五"</span></span></span></span><span data-slate-object="text" data-key="3103"><span data-slate-leaf="true" data-offset-key="3103:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3104"><span data-slate-leaf="true" data-offset-key="3104:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"李三"</span></span></span></span><span data-slate-object="text" data-key="3105"><span data-slate-leaf="true" data-offset-key="3105:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3106"><span data-slate-leaf="true" data-offset-key="3106:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"刘老四"</span></span></span></span><span data-slate-object="text" data-key="3107"><span data-slate-leaf="true" data-offset-key="3107:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3108"><span data-slate-leaf="true" data-offset-key="3108:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"王小二"</span></span></span></span><span data-slate-object="text" data-key="3109"><span data-slate-leaf="true" data-offset-key="3109:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3110"><span data-slate-leaf="true" data-offset-key="3110:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张四"</span></span></span></span><span data-slate-object="text" data-key="3111"><span data-slate-leaf="true" data-offset-key="3111:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="3112"><span data-slate-leaf="true" data-offset-key="3112:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张五六七"</span></span></span></span><span data-slate-object="text" data-key="3113"><span data-slate-leaf="true" data-offset-key="3113:0" data-first-offset="true"><span data-slate-string="true">);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3114"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3115"><span data-slate-object="text" data-key="3116"><span data-slate-leaf="true" data-offset-key="3116:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">String</span></span></span></span><span data-slate-object="text" data-key="3117"><span data-slate-leaf="true" data-offset-key="3117:0" data-first-offset="true"><span data-slate-string="true"> maxLenStartWithZ = names.</span></span></span><span data-slate-object="text" data-key="3118"><span data-slate-leaf="true" data-offset-key="3118:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">stream</span></span></span></span><span data-slate-object="text" data-key="3119"><span data-slate-leaf="true" data-offset-key="3119:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3120"><span data-slate-object="text" data-key="3121"><span data-slate-leaf="true" data-offset-key="3121:0" data-first-offset="true"><span data-slate-string="true">                    .</span></span></span><span data-slate-object="text" data-key="3122"><span data-slate-leaf="true" data-offset-key="3122:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">parallel</span></span></span></span><span data-slate-object="text" data-key="3123"><span data-slate-leaf="true" data-offset-key="3123:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3124"><span data-slate-object="text" data-key="3125"><span data-slate-leaf="true" data-offset-key="3125:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="3126"><span data-slate-leaf="true" data-offset-key="3126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">filter</span></span></span></span><span data-slate-object="text" data-key="3127"><span data-slate-leaf="true" data-offset-key="3127:0" data-first-offset="true"><span data-slate-string="true">(name </span></span></span><span data-slate-object="text" data-key="3128"><span data-slate-leaf="true" data-offset-key="3128:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-&gt;</span></span></span></span><span data-slate-object="text" data-key="3129"><span data-slate-leaf="true" data-offset-key="3129:0" data-first-offset="true"><span data-slate-string="true"> name.</span></span></span><span data-slate-object="text" data-key="3130"><span data-slate-leaf="true" data-offset-key="3130:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">startsWith</span></span></span></span><span data-slate-object="text" data-key="3131"><span data-slate-leaf="true" data-offset-key="3131:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="3132"><span data-slate-leaf="true" data-offset-key="3132:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"张"</span></span></span></span><span data-slate-object="text" data-key="3133"><span data-slate-leaf="true" data-offset-key="3133:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3134"><span data-slate-object="text" data-key="3135"><span data-slate-leaf="true" data-offset-key="3135:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="3136"><span data-slate-leaf="true" data-offset-key="3136:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">mapToInt</span></span></span></span><span data-slate-object="text" data-key="3137"><span data-slate-leaf="true" data-offset-key="3137:0" data-first-offset="true"><span data-slate-string="true">(String::length)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3138"><span data-slate-object="text" data-key="3139"><span data-slate-leaf="true" data-offset-key="3139:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="3140"><span data-slate-leaf="true" data-offset-key="3140:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">max</span></span></span></span><span data-slate-object="text" data-key="3141"><span data-slate-leaf="true" data-offset-key="3141:0" data-first-offset="true"><span data-slate-string="true">()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3142"><span data-slate-object="text" data-key="3143"><span data-slate-leaf="true" data-offset-key="3143:0" data-first-offset="true"><span data-slate-string="true">                  .</span></span></span><span data-slate-object="text" data-key="3144"><span data-slate-leaf="true" data-offset-key="3144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">toString</span></span></span></span><span data-slate-object="text" data-key="3145"><span data-slate-leaf="true" data-offset-key="3145:0" data-first-offset="true"><span data-slate-string="true">();</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3146"><span data-slate-object="text" data-key="3147"><span data-slate-leaf="true" data-offset-key="3147:0" data-first-offset="true"><span data-slate-string="true">Stream 的并行处理在执行终结操作之前，跟串行处理的实现是一样的。而在调用终结方法之后，实现的方式就有点不太一样，会调用 TerminalOp 的 evaluateParallel 方法进行并行处理。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="3148"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3149"><span data-slate-object="text" data-key="3150"><span data-slate-leaf="true" data-offset-key="3150:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3151"><span data-slate-leaf="true" data-offset-key="3151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">final</span></span></span></span><span data-slate-object="text" data-key="3152"><span data-slate-leaf="true" data-offset-key="3152:0" data-first-offset="true"><span data-slate-string="true"> &lt;R&gt; R </span></span></span><span data-slate-object="text" data-key="3153"><span data-slate-leaf="true" data-offset-key="3153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">evaluate</span></span></span></span><span data-slate-object="text" data-key="3154"><span data-slate-leaf="true" data-offset-key="3154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(TerminalOp&lt;E_OUT, R&gt; terminalOp)</span></span></span></span><span data-slate-object="text" data-key="3155"><span data-slate-leaf="true" data-offset-key="3155:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3156"><span data-slate-object="text" data-key="3157"><span data-slate-leaf="true" data-offset-key="3157:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3158"><span data-slate-leaf="true" data-offset-key="3158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">assert</span></span></span></span><span data-slate-object="text" data-key="3159"><span data-slate-leaf="true" data-offset-key="3159:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3160"><span data-slate-leaf="true" data-offset-key="3160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">getOutputShape</span></span></span></span><span data-slate-object="text" data-key="3161"><span data-slate-leaf="true" data-offset-key="3161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span><span data-slate-object="text" data-key="3162"><span data-slate-leaf="true" data-offset-key="3162:0" data-first-offset="true"><span data-slate-string="true"> == terminalOp.inputShape();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3163"><span data-slate-object="text" data-key="3164"><span data-slate-leaf="true" data-offset-key="3164:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3165"><span data-slate-leaf="true" data-offset-key="3165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="3166"><span data-slate-leaf="true" data-offset-key="3166:0" data-first-offset="true"><span data-slate-string="true"> (linkedOrConsumed)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3167"><span data-slate-object="text" data-key="3168"><span data-slate-leaf="true" data-offset-key="3168:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="3169"><span data-slate-leaf="true" data-offset-key="3169:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">throw</span></span></span></span><span data-slate-object="text" data-key="3170"><span data-slate-leaf="true" data-offset-key="3170:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3171"><span data-slate-leaf="true" data-offset-key="3171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="3172"><span data-slate-leaf="true" data-offset-key="3172:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3173"><span data-slate-leaf="true" data-offset-key="3173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">IllegalStateException</span></span></span></span><span data-slate-object="text" data-key="3174"><span data-slate-leaf="true" data-offset-key="3174:0" data-first-offset="true"><span data-slate-string="true">(MSG_STREAM_LINKED);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3175"><span data-slate-object="text" data-key="3176"><span data-slate-leaf="true" data-offset-key="3176:0" data-first-offset="true"><span data-slate-string="true">        linkedOrConsumed = </span></span></span><span data-slate-object="text" data-key="3177"><span data-slate-leaf="true" data-offset-key="3177:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">true</span></span></span></span><span data-slate-object="text" data-key="3178"><span data-slate-leaf="true" data-offset-key="3178:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3179"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3180"><span data-slate-object="text" data-key="3181"><span data-slate-leaf="true" data-offset-key="3181:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="3182"><span data-slate-leaf="true" data-offset-key="3182:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="3183"><span data-slate-leaf="true" data-offset-key="3183:0" data-first-offset="true"><span data-slate-string="true"> isParallel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3184"><span data-slate-object="text" data-key="3185"><span data-slate-leaf="true" data-offset-key="3185:0" data-first-offset="true"><span data-slate-string="true">               ? terminalOp.evaluateParallel(</span></span></span><span data-slate-object="text" data-key="3186"><span data-slate-leaf="true" data-offset-key="3186:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="3187"><span data-slate-leaf="true" data-offset-key="3187:0" data-first-offset="true"><span data-slate-string="true">, sourceSpliterator(terminalOp.getOpFlags()))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3188"><span data-slate-object="text" data-key="3189"><span data-slate-leaf="true" data-offset-key="3189:0" data-first-offset="true"><span data-slate-string="true">               : terminalOp.evaluateSequential(</span></span></span><span data-slate-object="text" data-key="3190"><span data-slate-leaf="true" data-offset-key="3190:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">this</span></span></span></span><span data-slate-object="text" data-key="3191"><span data-slate-leaf="true" data-offset-key="3191:0" data-first-offset="true"><span data-slate-string="true">, sourceSpliterator(terminalOp.getOpFlags()));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3192"><span data-slate-object="text" data-key="3193"><span data-slate-leaf="true" data-offset-key="3193:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3194"><span data-slate-object="text" data-key="3195"><span data-slate-leaf="true" data-offset-key="3195:0" data-first-offset="true"><span data-slate-string="true">这里的并行处理指的是，Stream 结合了 ForkJoin 框架，对 Stream 处理进行了分片，Splititerator 中的 estimateSize 方法会估算出分片的数据量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3196"><span data-slate-object="text" data-key="3197"><span data-slate-leaf="true" data-offset-key="3197:0" data-first-offset="true"><span data-slate-string="true">ForkJoin 框架和估算算法，在这里我就不具体讲解了，如果感兴趣，你可以深入源码分析下该算法的实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3198"><span data-slate-object="text" data-key="3199"><span data-slate-leaf="true" data-offset-key="3199:0" data-first-offset="true"><span data-slate-string="true">通过预估的数据量获取最小处理单元的阈值，如果当前分片大小大于最小处理单元的阈值，就继续切分集合。每个分片将会生成一个 Sink 链表，当所有的分片操作完成后，ForkJoin 框架将会合并分片任何结果集。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3200" id="sr-toc-7"><span data-slate-object="text" data-key="3201"><span data-slate-leaf="true" data-offset-key="3201:0" data-first-offset="true"><span data-slate-string="true">合理使用 Stream</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3202"><span data-slate-object="text" data-key="3203"><span data-slate-leaf="true" data-offset-key="3203:0" data-first-offset="true"><span data-slate-string="true">看到这里，你应该对 Stream API 是如何优化集合遍历有个清晰的认知了。Stream API 用起来简洁，还能并行处理，那是不是使用 Stream API，系统性能就更好呢？通过一组测试，我们一探究竟。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3204"><span data-slate-object="text" data-key="3205"><span data-slate-leaf="true" data-offset-key="3205:0" data-first-offset="true"><span data-slate-string="true">我们将对常规的迭代、Stream 串行迭代以及 Stream 并行迭代进行性能测试对比，迭代循环中，我们将对数据进行过滤、分组等操作。分别进行以下几组测试：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="3206"><div data-slate-type="list-line" data-slate-object="block" data-key="3207"><span data-slate-object="text" data-key="3208"><span data-slate-leaf="true" data-offset-key="3208:0" data-first-offset="true"><span data-slate-string="true">多核 CPU 服务器配置环境下，对比长度 100 的 int 数组的性能；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3209"><span data-slate-object="text" data-key="3210"><span data-slate-leaf="true" data-offset-key="3210:0" data-first-offset="true"><span data-slate-string="true">多核 CPU 服务器配置环境下，对比长度 1.00E+8 的 int 数组的性能；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3211"><span data-slate-object="text" data-key="3212"><span data-slate-leaf="true" data-offset-key="3212:0" data-first-offset="true"><span data-slate-string="true">多核 CPU 服务器配置环境下，对比长度 1.00E+8 对象数组过滤分组的性能；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3213"><span data-slate-object="text" data-key="3214"><span data-slate-leaf="true" data-offset-key="3214:0" data-first-offset="true"><span data-slate-string="true">单核 CPU 服务器配置环境下，对比长度 1.00E+8 对象数组过滤分组的性能。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3215"><span data-slate-object="text" data-key="3216"><span data-slate-leaf="true" data-offset-key="3216:0" data-first-offset="true"><span data-slate-string="true">由于篇幅有限，我这里直接给出统计结果，你也可以自己去验证一下，具体的测试代码可以在 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="3217"><span data-slate-object="text" data-key="3218"><span data-slate-leaf="true" data-offset-key="3218:0" data-first-offset="true"><span data-slate-string="true">Github</span></span></span></a><span data-slate-object="text" data-key="3219"><span data-slate-leaf="true" data-offset-key="3219:0" data-first-offset="true"><span data-slate-string="true"> 上查看。通过以上测试，我统计出的测试结果如下（迭代使用时间）：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="3220"><div data-slate-type="list-line" data-slate-object="block" data-key="3221"><span data-slate-object="text" data-key="3222"><span data-slate-leaf="true" data-offset-key="3222:0" data-first-offset="true"><span data-slate-string="true">常规的迭代 &lt;Stream 并行迭代 &lt;Stream 串行迭代</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3223"><span data-slate-object="text" data-key="3224"><span data-slate-leaf="true" data-offset-key="3224:0" data-first-offset="true"><span data-slate-string="true">Stream 并行迭代 &lt; 常规的迭代 &lt;Stream 串行迭代</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3225"><span data-slate-object="text" data-key="3226"><span data-slate-leaf="true" data-offset-key="3226:0" data-first-offset="true"><span data-slate-string="true">Stream 并行迭代 &lt; 常规的迭代 &lt;Stream 串行迭代</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="3227"><span data-slate-object="text" data-key="3228"><span data-slate-leaf="true" data-offset-key="3228:0" data-first-offset="true"><span data-slate-string="true">常规的迭代 &lt;Stream 串行迭代 &lt;Stream 并行迭代</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3229"><span data-slate-object="text" data-key="3230"><span data-slate-leaf="true" data-offset-key="3230:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_7fa4e065" data-attr-id="8349" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">通过以上测试结果，我们可以看到：在循环迭代次数较少的情况下，常规的迭代方式性能反而更好；在单核 CPU 服务器配置环境中，也是常规迭代方式更有优势；而在大数据循环迭代中，如果服务器是多核 CPU 的情况下，Stream 的并行迭代优势明显。所以我们在平时处理大数据的集合时，应该尽量考虑将应用部署在多核 CPU 环境下，并且使用 Stream 的并行迭代方式进行处理。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3231"><span data-slate-object="text" data-key="3232"><span data-slate-leaf="true" data-offset-key="3232:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_15a3d8c8" data-attr-id="24961" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">用事实说话，我们看到其实使用 Stream 未必可以使系统性能更佳，还是要结合应用场景进行选择，也就是合理地使用 Stream。</span></span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3233" id="sr-toc-8"><span data-slate-object="text" data-key="3234"><span data-slate-leaf="true" data-offset-key="3234:0" data-first-offset="true"><span data-slate-string="true">总结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3235"><span data-slate-object="text" data-key="3236"><span data-slate-leaf="true" data-offset-key="3236:0" data-first-offset="true"><span data-slate-string="true">纵观 Stream 的设计实现，非常值得我们学习。</span></span><span data-slate-leaf="true" data-offset-key="3236:1"><span data-slate-object="annotation" data-annotation-key="gkann_87fa5758" data-attr-id="5720" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">从大的设计方向上来说，Stream 将整个操作分解为了链式结构，不仅简化了遍历操作，还为实现了并行计算打下了基础。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3237"><span data-slate-object="text" data-key="3238"><span data-slate-leaf="true" data-offset-key="3238:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_b7ea4044" data-attr-id="5721" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">从小的分类方向上来说，Stream 将遍历元素的操作和对元素的计算分为中间操作和终结操作，而中间操作又根据元素之间状态有无干扰分为有状态和无状态操作，实现了链结构中的不同阶段。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3239"><span data-slate-object="text" data-key="3240"><span data-slate-leaf="true" data-offset-key="3240:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f2a19e96" data-attr-id="13203" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在串行处理操作中，</span></span></span></span></span><span data-slate-object="text" data-key="3241"><span data-slate-leaf="true" data-offset-key="3241:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_f2a19e96" data-attr-id="13203" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Stream 在执行每一步中间操作时，并不会做实际的数据操作处理，而是将这些中间操作串联起来，最终由终结操作触发，生成一个数据处理链表，通过 Java8 中的 Spliterator 迭代器进行数据处理；此时，每执行一次迭代，就对所有的无状态的中间操作进行数据处理，而对有状态的中间操作，就需要迭代处理完所有的数据，再进行处理操作；最后就是进行终结操作的数据处理。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3242"><span data-slate-object="text" data-key="3243"><span data-slate-leaf="true" data-offset-key="3243:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_15f31677" data-attr-id="13204" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在并行处理操作中，</span></span></span></span></span><span data-slate-object="text" data-key="3244"><span data-slate-leaf="true" data-offset-key="3244:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_15f31677" data-attr-id="13204" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Stream 对中间操作基本跟串行处理方式是一样的，但在终结操作中，Stream 将结合 ForkJoin 框架对集合进行切片处理，ForkJoin 框架将每个切片的处理结果 Join 合并起来。最后就是要注意 Stream 的使用场景。</span></span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="3245" id="sr-toc-9"><span data-slate-object="text" data-key="3246"><span data-slate-leaf="true" data-offset-key="3246:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="3247"><span data-slate-object="text" data-key="3248"><span data-slate-leaf="true" data-offset-key="3248:0" data-first-offset="true"><span data-slate-string="true">这里有一个简单的并行处理案例，请你找出其中存在的问题。</span></span></span></div><div data-code-language="java" data-slate-type="pre" data-slate-object="block" data-key="3249"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="3250"><span data-slate-object="text" data-key="3251"><span data-slate-leaf="true" data-offset-key="3251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 使用一个容器装载 100 个数字，通过 Stream 并行处理的方式将容器中为单数的数字转移到容器 parallelList</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3252"><span data-slate-object="text" data-key="3253"><span data-slate-leaf="true" data-offset-key="3253:0" data-first-offset="true"><span data-slate-string="true">List&lt;Integer&gt; integerList= </span></span></span><span data-slate-object="text" data-key="3254"><span data-slate-leaf="true" data-offset-key="3254:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="3255"><span data-slate-leaf="true" data-offset-key="3255:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3256"><span data-slate-leaf="true" data-offset-key="3256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ArrayList</span></span></span></span><span data-slate-object="text" data-key="3257"><span data-slate-leaf="true" data-offset-key="3257:0" data-first-offset="true"><span data-slate-string="true">&lt;Integer&gt;();</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3258"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3259"><span data-slate-object="text" data-key="3260"><span data-slate-leaf="true" data-offset-key="3260:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="3261"><span data-slate-leaf="true" data-offset-key="3261:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span><span data-slate-object="text" data-key="3262"><span data-slate-leaf="true" data-offset-key="3262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="3263"><span data-slate-leaf="true" data-offset-key="3263:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3264"><span data-slate-leaf="true" data-offset-key="3264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">i</span></span></span></span><span data-slate-object="text" data-key="3265"><span data-slate-leaf="true" data-offset-key="3265:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3266"><span data-slate-leaf="true" data-offset-key="3266:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">=</span></span></span></span><span data-slate-object="text" data-key="3267"><span data-slate-leaf="true" data-offset-key="3267:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3268"><span data-slate-leaf="true" data-offset-key="3268:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="3269"><span data-slate-leaf="true" data-offset-key="3269:0" data-first-offset="true"><span data-slate-string="true">; i &lt;</span></span></span><span data-slate-object="text" data-key="3270"><span data-slate-leaf="true" data-offset-key="3270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">100</span></span></span></span><span data-slate-object="text" data-key="3271"><span data-slate-leaf="true" data-offset-key="3271:0" data-first-offset="true"><span data-slate-string="true">; i++) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3272"><span data-slate-object="text" data-key="3273"><span data-slate-leaf="true" data-offset-key="3273:0" data-first-offset="true"><span data-slate-string="true">      integerList.add(i);</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3274"><span data-slate-object="text" data-key="3275"><span data-slate-leaf="true" data-offset-key="3275:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3276"></div><div data-slate-type="code-line" data-slate-object="block" data-key="3277"><span data-slate-object="text" data-key="3278"><span data-slate-leaf="true" data-offset-key="3278:0" data-first-offset="true"><span data-slate-string="true">List&lt;Integer&gt; parallelList = </span></span></span><span data-slate-object="text" data-key="3279"><span data-slate-leaf="true" data-offset-key="3279:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">new</span></span></span></span><span data-slate-object="text" data-key="3280"><span data-slate-leaf="true" data-offset-key="3280:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="3281"><span data-slate-leaf="true" data-offset-key="3281:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ArrayList</span></span></span></span><span data-slate-object="text" data-key="3282"><span data-slate-leaf="true" data-offset-key="3282:0" data-first-offset="true"><span data-slate-string="true">&lt;Integer&gt;() ;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3283"><span data-slate-object="text" data-key="3284"><span data-slate-leaf="true" data-offset-key="3284:0" data-first-offset="true"><span data-slate-string="true">integerList.stream()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3285"><span data-slate-object="text" data-key="3286"><span data-slate-leaf="true" data-offset-key="3286:0" data-first-offset="true"><span data-slate-string="true">           .parallel()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3287"><span data-slate-object="text" data-key="3288"><span data-slate-leaf="true" data-offset-key="3288:0" data-first-offset="true"><span data-slate-string="true">           .filter(i-&gt;i%</span></span></span><span data-slate-object="text" data-key="3289"><span data-slate-leaf="true" data-offset-key="3289:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="3290"><span data-slate-leaf="true" data-offset-key="3290:0" data-first-offset="true"><span data-slate-string="true">==</span></span></span><span data-slate-object="text" data-key="3291"><span data-slate-leaf="true" data-offset-key="3291:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="3292"><span data-slate-leaf="true" data-offset-key="3292:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3293"><span data-slate-object="text" data-key="3294"><span data-slate-leaf="true" data-offset-key="3294:0" data-first-offset="true"><span data-slate-string="true">           .forEach(i-&gt;parallelList.add(i));</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="3295"></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="3296"><span data-slate-object="text" data-key="3297"><span data-slate-leaf="true" data-offset-key="3297:0" data-first-offset="true"><span data-slate-string="true">期待在留言区看到你的答案。也欢迎你点击 “请朋友读”，把今天的内容分享给身边的朋友，邀请他一起学习。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>15</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png" style="width: auto;"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-10">精选留言 (65)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/18/74/21/6c64afa9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>奔跑的猪</span></div></div><div>实践中大量采用 stream 大概有 2 年了吧，先是在 Team 内推广，后来在 CodeReview 中强制要求。
个人以为，出发点并不是出于性能考虑，而是结合 lambda，在编程思维上的转变，将大家对代码的关注点放在 “行为传递” 上面，而不是参数传递，阅读时也能省去模板语法产生的 “噪音”。</div><div><div>2019-07-26</div><div><div><i></i><span>1</span></div><div><i></i><span>76</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/16/a4/9c/b32ed9e9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 陆离</span></div></div><div>思考题中这样的方式会造成 null 值和缺值
因为 arraylist 不是线程安全的，例如线程一在 size++ 后准备给 index 为 size+1 的位置赋值，这个时候第二个线程又给 size++，这个线程一赋值的 index 就变成了 size+2, 在线程一赋值后，线程二又在 size+2 的位置赋值。
这样的结果就是 size+1 的位置没有值 null,size+2 的位置为线程二赋的值，线程一赋的值被覆盖。
正确的方式应该是使用 collect ()</div><div><div>2019-06-01</div><div><div><i></i><span>2</span></div><div><i></i><span>38</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/12/03/c7/bd45f0c9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小白猪</span></div></div><div>思考题，由于流是并行处理，parallelList 会存在并发问题，应该使用 collect 方法聚合</div><div><div>2019-06-01</div><div><div><i></i><span>3</span></div><div><i></i><span>20</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/12/78/dc/0c9c9b0f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>(´ 田 ω 田 `)</span></div></div><div>感觉这一节课已经值回了整个课程的票价，给老师点赞！

思考题：Stream 并行执行，无法确认每个元素的处理顺序，最后 parallelList 中的数字是无序的</div><div><p>作者回复：思考题中的问题是在并行操作 arraylist 时，需要考虑线程安全问题</p></div><div><div>2019-06-01</div><div><div><i></i></div><div><i></i><span>12</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/0f/ee/5d/c1105c12.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 一路看风景</span></div></div><div>老师您好，在容器盛行的微服务环境下，以及大数据处理流行的潮流中，我觉得 stream 的应用空间多少有些尴尬呢，不知是不是我的理解有误。即：单核容器运行的环境下 stream 没了性能优势，大数据的处理又有大数据平台去完成使命，所以是不是意味着我们可以从 stream 得到的最大收益变成了流式编程和函数式编程带来的代码易读和易用性了呢？</div><div><p>作者回复：是的，但未必所有公司都有构建大数据的能力，而且一些公司有自己的中间件团队，例如文章开始说到的分表分库的查询操作，使用 stream 的并行操作就有优势了</p></div><div><div>2019-06-01</div><div><div><i></i><span>2</span></div><div><i></i><span>11</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/27/1d/1cb36854.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 小辉辉</span></div></div><div>ArrayList 是线程不安全的集合，而当前又用了并行流去处理，所以会出现有异常、少数据或者正常输出结果这三种情况。</div><div><div>2019-06-02</div><div><div><i></i><span></span></div><div><i></i><span>10</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Liam</span></div></div><div>parallel Stream 的并发机制是通过 ForkJoinPool 实现的，它的通用线程池是一个无界队列，想问下，数据量很大的时候，比如 1w 个元素，它分片的依据是什么，每个分片多大；子任务比较多的时候，会不会严重消耗内存以及频繁触发 GC 等</div><div><div>2019-06-01</div><div><div><i></i><span></span></div><div><i></i><span>9</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/6PbKL8YRE2wzqdoxcS5E88Wvot8Vv0Kuo92BUKPlWISPfGjSXCmK7vD12aBdibwY6q11gbkPxK4Weje2xCcCdEw/132"></div></div><div><div><div><span> 阿厚</span></div></div><div>老师，请教 2 个问题：
1. 有什么分表分库中间件推荐么？
2. 分表分库以后，查询分页怎么办呢？</div><div><p>作者回复：之前用过 sharing-jdbc 以及 mycat，一个明显的区别是 sharing-jdbc 是嵌入方式，而 mycat 是基于 proxy，所以理论上来说 proxy 方式会有性能损耗。现在我们在使用 sharing-jdbc，这里不打广告，两个中间件都有自己的优势。

分页查询是基于我这篇文章说的方式，将每个分表的数据结果集查询出来，通过归并排序计算出。
具体的实现方式有区别，本次专栏的后面课程也会具体讲到。</p></div><div><div>2019-06-06</div><div><div><i></i></div><div><i></i><span>8</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/17/38/c3/f18411f9.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 圣西罗</span></div></div><div>老师，现在网上有些说法做测试用 lambda 比普通 for 循环速度慢五倍，因此有人拒绝用。实际情况是什么样呢？如果我自己想测，应该怎么尽可能排除外因干扰，测一下他们的实际效率对比？</div><div><p>作者回复：当应用程序以前没有使用 lambda 表达式时，会动态生成 lambda 目标对象，这是导致慢的实际原因。我们可以在运行加载后，也就是初次测试之后，紧接着后面加几个 for 循环，再测试几次，对比下性能。

虽然单独使用 lambda 表达式在初次运行时要比传统方式慢很多，但结合 stream 的并行操作，在多核环境下还有有优势的。</p></div><div><div>2019-06-01</div><div><div><i></i><span>2</span></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIy5ULaodUwsLoPuk1wd22hqXsaBbibNEqXM0kgrCTYDGKYQkZICYEyH9wMj4hyUicuQwHdDuOKRj0g/132"></div></div><div><div><div><span> 辉煌码农</span></div></div><div>allMatch 为什么是短路呢，短路的如何定义的呢</div><div><p>作者回复：终结操作又可以分为短路（Short-circuiting）与非短路（Unshort-circuiting）操作，前者是指遇到某些符合条件的元素就可以得到最终结果，后者是指必须处理完所有元素才能得到最终结果。

allMatch 也是属于遇到某些条件的情况下可以终结的操作，即找到一个不合法条件的，短路返回 false ，无需等待其他的处理结果，所以也属于短路。
</p></div><div><div>2020-01-02</div><div><div><i></i></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>QQ 怪</span></div></div><div>是不是该把思考题中的 arraylist 换成线程安全的 copyOnwriteList 就可以解决线程不安全问题？</div><div><p>作者回复：对的，但 copyOnwriteList 更适合某一时间段统一新增，且新增时避免大量操作容器发生。比较适合在深夜更新黑名单类似的业务。</p></div><div><div>2019-06-03</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/e9/52/aa3be800.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Loubobooo</span></div></div><div>parallelList 集合里呈现的是无序的数字，是这样吗？</div><div><p>作者回复：对的，可能会出现少数字、无序以及异常情况</p></div><div><div>2019-06-01</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/17/1e/89/25b12054.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Andy</span></div></div><div>感觉 stream 这种中间操作和终结操作 跟 spark 中转换操作和处理操作 思想很像，懒加载</div><div><p>作者回复：是的，好的实现思想会被应用到各个地方</p></div><div><div>2019-10-21</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/11/4c/59/c75cb36d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>N</span></div></div><div>老师有个问题请教一下，公司业务代码中有大量 stream 对集合遍历，过滤，聚合的用法，但都是串行的，因为大部分数据量不是很大，请问数据量多大的时候才有必要使用并行提高效率呢？</div><div><p>作者回复：上万数量级使用并行可以提高效率。</p></div><div><div>2019-07-14</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/12/95/52/ad190682.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Mr wind</span></div></div><div>为什么聚合操作是线程安全的呢。</div><div><p>作者回复: Java8 Stream 的 collect 方法是线程安全的。</p></div><div><div>2019-12-08</div><div><div><i></i></div><div><i></i><span>3</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div></div><div><div><div><span> 开心小毛</span></div></div><div>使用 stream 是否有节省内存消耗的考虑，例如当需要遍历一个含上万条目的数据库查询结果。</div><div><div>2019-11-19</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Darren</span></div></div><div>最终的结果无序，且可能结果都是不正确的，因为 ArrayList 是线程不安全的</div><div><div>2019-06-04</div><div><div><i></i><span></span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/11/2a/54/c9990105.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>bro.</span></div></div><div>老师，这么早更新，读完感觉跟 rxjava 设计思想很接近，不订阅前面过滤条件都不会真正的运行！</div><div><div>2019-06-01</div><div><div><i></i><span>1</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 张三丰</span></div></div><div>老师，有个地方想不明白，串行化的 stream 执行 filter,map 的时候为何比直接使用 for 循环快？stream 是每迭代一次就执行一次 filter,map。而直接 for 也可以循环一次执行 filter,map。它们时间复杂度是一样的。</div><div><div>2020-04-17</div><div><div><i></i><span></span></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://static001.geekbang.org/account/avatar/00/0f/6d/56/65b05765.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Allen</span></div></div><div>对一个集合进行并行处理 我对比下来 使用显式的线程池进行多线程处理要快于使用 parallel stream  而且使用线程池应该能保证系统线程资源不被耗尽吧 </div><div><p>作者回复：是的，原理都差不多，parallel stream 写起来更简便</p></div><div><div>2020-04-13</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".m"><outline class="toc-level-h1" data-reactid=".m.0" style="width: 175px;"><active data-reactid=".m.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".m.0.1"><span data-reactid=".m.0.1.0">06 | Stream 如何提高遍历集合效率？</span></a></outline><outline class="toc-level-h2" data-reactid=".m.1" style="width: 165px;"><active data-reactid=".m.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".m.1.1"><span data-reactid=".m.1.1.0">什么是 Stream？</span></a></outline><outline class="toc-level-h2" data-reactid=".m.2" style="width: 165px;"><active data-reactid=".m.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".m.2.1"><span data-reactid=".m.2.1.0">Stream 如何优化遍历？</span></a></outline><outline class="toc-level-h3" data-reactid=".m.3" style="width: 155px;"><active data-reactid=".m.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".m.3.1"><span data-reactid=".m.3.1.0">1.Stream 操作分类</span></a></outline><outline class="toc-level-h3" data-reactid=".m.4" style="width: 155px;"><active data-reactid=".m.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".m.4.1"><span data-reactid=".m.4.1.0">2.Stream 源码实现</span></a></outline><outline class="toc-level-h3" data-reactid=".m.5" style="width: 155px;"><active data-reactid=".m.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".m.5.1"><span data-reactid=".m.5.1.0">3.Stream 操作叠加</span></a></outline><outline class="toc-level-h3" data-reactid=".m.6" style="width: 155px;"><active data-reactid=".m.6.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".m.6.1"><span data-reactid=".m.6.1.0">4.Stream 并行处理</span></a></outline><outline class="toc-level-h2" data-reactid=".m.7" style="width: 165px;"><active data-reactid=".m.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".m.7.1"><span data-reactid=".m.7.1.0">合理使用 Stream</span></a></outline><outline class="toc-level-h2" data-reactid=".m.8" style="width: 165px;"><active data-reactid=".m.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".m.8.1"><span data-reactid=".m.8.1.0">总结</span></a></outline><outline class="toc-level-h2" data-reactid=".m.9" style="width: 165px;"><active data-reactid=".m.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".m.9.1"><span data-reactid=".m.9.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".m.a" style="width: 165px;"><active data-reactid=".m.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".m.a.1"><span data-reactid=".m.a.1.0">精选留言 (65)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/98582" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>