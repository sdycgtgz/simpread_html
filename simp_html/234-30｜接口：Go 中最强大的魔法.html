
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 30｜接口：Go 中最强大的魔法</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>30｜接口：Go 中最强大的魔法</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">今天，我会讲解 Go 语言提供的另一种分支控制结构：switch 语句。和 if 分支语句相比，在一些执行分支较多的场景下，使用 switch 分支控制语</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0"> 30｜接口：Go 中最强大的魔法</h1><div><span>Tony Bai</span> <span>2021-12-31</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/5d/0f/5d4a543e8e871147e162ec9a17870b0f.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：Tony Bai</span><span> 大小：19.86M</span><span> 时长：21:44</span></div></div><audio title="30｜接口：Go中最强大的魔法" src="https://res001.geekbang.org/media/audio/2e/d6/2e037ff30ed6e8b556174a88a9a6b7d6/ld/ld.m3u8" __idm_id__="253964"></audio></div><div><div><div><div data-slate-editor="true" data-key="13780" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="13781"><span data-slate-object="text" data-key="13782"><span data-slate-leaf="true" data-offset-key="13782:0" data-first-offset="true"><span data-slate-string="true">你好，我是 Tony Bai。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13783"><span data-slate-object="text" data-key="13784"><span data-slate-leaf="true" data-offset-key="13784:0" data-first-offset="true"><span data-slate-string="true">在前面的两讲中，我们学习了接口的基础知识、接口类型定义的惯例以及接口在运行时的表示。掌握了这些内容后，可以说，在语法层面的有关接口的问题，对我们来说都不是什么阻碍了。在弄清楚接口是什么这个问题之后，摆在我们面前的就是</span></span></span><span data-slate-object="text" data-key="13785"><span data-slate-leaf="true" data-offset-key="13785:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">怎么用接口</span></span></span></span><span data-slate-object="text" data-key="13786"><span data-slate-leaf="true" data-offset-key="13786:0" data-first-offset="true"><span data-slate-string="true">的问题了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13787"><span data-slate-object="text" data-key="13788"><span data-slate-leaf="true" data-offset-key="13788:0" data-first-offset="true"><span data-slate-string="true">不过，这里的 “怎么用”，可不是要告诉你怎么使用 Go 标准库中的接口或第三方包中定义好的接口，而是让你学习如何利用接口进行应用的设计，以及改善已有应用的设计，</span></span><span data-slate-leaf="true" data-offset-key="13788:1"><span data-slate-object="annotation" data-annotation-key="gkann_2c0bb82f" data-attr-id="36034" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">换句话说就是 </span></span></span></span><span data-slate-object="text" data-key="13789"><span data-slate-leaf="true" data-offset-key="13789:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_2c0bb82f" data-attr-id="36034" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">Go 接口的应用模式或惯例</span></span></span></span></span><span data-slate-object="text" data-key="13790"><span data-slate-leaf="true" data-offset-key="13790:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_2c0bb82f" data-attr-id="36034" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13791"><span data-slate-object="text" data-key="13792"><span data-slate-leaf="true" data-offset-key="13792:0" data-first-offset="true"><span data-slate-string="true">不过在讲解接口应用模式之前，我们还先要了解一个前置原则，那就是</span></span></span><span data-slate-object="text" data-key="13793"><span data-slate-leaf="true" data-offset-key="13793:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在实际真正需要的时候才对程序进行抽象</span></span></span></span><span data-slate-object="text" data-key="13794"><span data-slate-leaf="true" data-offset-key="13794:0" data-first-offset="true"><span data-slate-string="true">。再通俗一些来讲，就是</span></span></span><span data-slate-object="text" data-key="13795"><span data-slate-leaf="true" data-offset-key="13795:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">不要为了抽象而抽象</span></span></span></span><span data-slate-object="text" data-key="13796"><span data-slate-leaf="true" data-offset-key="13796:0" data-first-offset="true"><span data-slate-string="true">。上一讲中我们说过，接口本质上是一种抽象，它的功能是解耦，所以这条原则也在告诉我们：</span></span></span><span data-slate-object="text" data-key="13797"><span data-slate-leaf="true" data-offset-key="13797:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">不要为了使用接口而使用接口</span></span></span></span><span data-slate-object="text" data-key="13798"><span data-slate-leaf="true" data-offset-key="13798:0" data-first-offset="true"><span data-slate-string="true">。举一个简单的例子，如果我们要给一个计算器添加一个整数加法的功能特性，本来一个函数就可以实现：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13799"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13800"><span data-slate-object="text" data-key="13801"><span data-slate-leaf="true" data-offset-key="13801:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="13802"><span data-slate-leaf="true" data-offset-key="13802:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13803"><span data-slate-leaf="true" data-offset-key="13803:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Add</span></span></span></span></span><span data-slate-object="text" data-key="13804"><span data-slate-leaf="true" data-offset-key="13804:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(a </span></span></span></span></span><span data-slate-object="text" data-key="13805"><span data-slate-leaf="true" data-offset-key="13805:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></span></span><span data-slate-object="text" data-key="13806"><span data-slate-leaf="true" data-offset-key="13806:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, b </span></span></span></span></span><span data-slate-object="text" data-key="13807"><span data-slate-leaf="true" data-offset-key="13807:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></span></span><span data-slate-object="text" data-key="13808"><span data-slate-leaf="true" data-offset-key="13808:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="13809"><span data-slate-leaf="true" data-offset-key="13809:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13810"><span data-slate-leaf="true" data-offset-key="13810:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="13811"><span data-slate-leaf="true" data-offset-key="13811:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13812"><span data-slate-object="text" data-key="13813"><span data-slate-leaf="true" data-offset-key="13813:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="13814"><span data-slate-leaf="true" data-offset-key="13814:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13815"><span data-slate-leaf="true" data-offset-key="13815:0" data-first-offset="true"><span data-slate-string="true"> a+b</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13816"><span data-slate-object="text" data-key="13817"><span data-slate-leaf="true" data-offset-key="13817:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13818"><span data-slate-object="text" data-key="13819"><span data-slate-leaf="true" data-offset-key="13819:0" data-first-offset="true"><span data-slate-string="true">但如果你非要引入一个接口，结果代码可能就变成了这样：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13820"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13821"><span data-slate-object="text" data-key="13822"><span data-slate-leaf="true" data-offset-key="13822:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="13823"><span data-slate-leaf="true" data-offset-key="13823:0" data-first-offset="true"><span data-slate-string="true"> Adder </span></span></span><span data-slate-object="text" data-key="13824"><span data-slate-leaf="true" data-offset-key="13824:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="13825"><span data-slate-leaf="true" data-offset-key="13825:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13826"><span data-slate-object="text" data-key="13827"><span data-slate-leaf="true" data-offset-key="13827:0" data-first-offset="true"><span data-slate-string="true">    Add(</span></span></span><span data-slate-object="text" data-key="13828"><span data-slate-leaf="true" data-offset-key="13828:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="13829"><span data-slate-leaf="true" data-offset-key="13829:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="13830"><span data-slate-leaf="true" data-offset-key="13830:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="13831"><span data-slate-leaf="true" data-offset-key="13831:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="13832"><span data-slate-leaf="true" data-offset-key="13832:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13833"><span data-slate-object="text" data-key="13834"><span data-slate-leaf="true" data-offset-key="13834:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13835"></div><div data-slate-type="code-line" data-slate-object="block" data-key="13836"><span data-slate-object="text" data-key="13837"><span data-slate-leaf="true" data-offset-key="13837:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="13838"><span data-slate-leaf="true" data-offset-key="13838:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13839"><span data-slate-leaf="true" data-offset-key="13839:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Add</span></span></span></span></span><span data-slate-object="text" data-key="13840"><span data-slate-leaf="true" data-offset-key="13840:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(adder Adder, a </span></span></span></span></span><span data-slate-object="text" data-key="13841"><span data-slate-leaf="true" data-offset-key="13841:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></span></span><span data-slate-object="text" data-key="13842"><span data-slate-leaf="true" data-offset-key="13842:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, b </span></span></span></span></span><span data-slate-object="text" data-key="13843"><span data-slate-leaf="true" data-offset-key="13843:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></span></span><span data-slate-object="text" data-key="13844"><span data-slate-leaf="true" data-offset-key="13844:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="13845"><span data-slate-leaf="true" data-offset-key="13845:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13846"><span data-slate-leaf="true" data-offset-key="13846:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="13847"><span data-slate-leaf="true" data-offset-key="13847:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13848"><span data-slate-object="text" data-key="13849"><span data-slate-leaf="true" data-offset-key="13849:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="13850"><span data-slate-leaf="true" data-offset-key="13850:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="13851"><span data-slate-leaf="true" data-offset-key="13851:0" data-first-offset="true"><span data-slate-string="true"> adder.Add(a, b)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13852"><span data-slate-object="text" data-key="13853"><span data-slate-leaf="true" data-offset-key="13853:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13854"><span data-slate-object="text" data-key="13855"><span data-slate-leaf="true" data-offset-key="13855:0" data-first-offset="true"><span data-slate-string="true">这就会产生一种 “过设计” 的味道了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13856"><span data-slate-object="text" data-key="13857"><span data-slate-leaf="true" data-offset-key="13857:0" data-first-offset="true"><span data-slate-string="true">要注意，接口的确可以实现</span></span></span><span data-slate-object="text" data-key="13858"><span data-slate-leaf="true" data-offset-key="13858:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">解耦</span></span></span></span><span data-slate-object="text" data-key="13859"><span data-slate-leaf="true" data-offset-key="13859:0" data-first-offset="true"><span data-slate-string="true">，但它也会引入 “抽象” 的副作用，或者说接口这种抽象也不是免费的，是有成本的，除了会造成运行效率的下降之外，也会影响代码的可读性。不过这里你就不要拿我之前讲解中的实战例子去对号入座了，那些例子更多是为了让你学习 Go 语法的便利而构建的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13860"><span data-slate-object="text" data-key="13861"><span data-slate-leaf="true" data-offset-key="13861:0" data-first-offset="true"><span data-slate-string="true">在多数情况下，在真实的生产项目中，接口都能给应用设计带来好处。那么如果要用接口，我们应该怎么用呢？怎么借助接口来改善程序的设计，让系统实现我们常说的高内聚和低耦合呢？这就要从 Go 语言的 “组合” 的设计哲学说起。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13862" id="sr-toc-1"><span data-slate-object="text" data-key="13863"><span data-slate-leaf="true" data-offset-key="13863:0" data-first-offset="true"><span data-slate-string="true">一切皆组合</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13864"><span data-slate-object="text" data-key="13865"><span data-slate-leaf="true" data-offset-key="13865:0" data-first-offset="true"><span data-slate-string="true">Go 语言之父 Rob Pike 曾说过：</span></span></span><span data-slate-object="text" data-key="13866"><span data-slate-leaf="true" data-offset-key="13866:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">如果 C++ 和 Java 是关于类型层次结构和类型分类的语言，那么 Go 则是关于组合的语言</span></span></span></span><span data-slate-object="text" data-key="13867"><span data-slate-leaf="true" data-offset-key="13867:0" data-first-offset="true"><span data-slate-string="true">。如果把 Go 应用程序比作是一台机器的话，那么</span></span></span><span data-slate-object="text" data-key="13868"><span data-slate-leaf="true" data-offset-key="13868:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">组合</span></span></span></span><span data-slate-object="text" data-key="13869"><span data-slate-leaf="true" data-offset-key="13869:0" data-first-offset="true"><span data-slate-string="true">关注的就是如何将散落在各个包中的 “零件” 关联并组装到一起。我们前面也说过，</span></span></span><span data-slate-object="text" data-key="13870"><span data-slate-leaf="true" data-offset-key="13870:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">组合</span></span></span></span><span data-slate-object="text" data-key="13871"><span data-slate-leaf="true" data-offset-key="13871:0" data-first-offset="true"><span data-slate-string="true">是 Go 语言的重要设计哲学之一，而正交性则为组合哲学的落地提供了更为方便的条件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13872"><span data-slate-object="text" data-key="13873"><span data-slate-leaf="true" data-offset-key="13873:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">正交（Orthogonality）</span></span></span></span><span data-slate-object="text" data-key="13874"><span data-slate-leaf="true" data-offset-key="13874:0" data-first-offset="true"><span data-slate-string="true">是从几何学中借用的术语，说的是如果两条线以直角相交，那么这两条线就是正交的，比如我们在代数课程中经常用到的坐标轴就是这样。用向量术语说，这两条直线互不依赖，沿着某一条直线移动，你投影到另一条直线上的位置不变。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13875"><span data-slate-object="text" data-key="13876"><span data-slate-leaf="true" data-offset-key="13876:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_e79f6104" data-attr-id="36328" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">在计算机技术中，正交性用于表示某种不相依赖性或是解耦性。</span></span></span><span data-slate-leaf="true" data-offset-key="13876:1"><span data-slate-string="true">如果两个或更多事物中的一个发生变化，不会影响其他事物，那么这些事物就是正交的。比如，在设计良好的系统中，数据库代码与用户界面是正交的：你可以改动界面，而不影响数据库；更换数据库，而不用改动界面。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13877"><span data-slate-object="text" data-key="13878"><span data-slate-leaf="true" data-offset-key="13878:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">编程语言的语法元素间和语言特性也存在着正交的情况，并且通过将这些正交的特性组合起来，我们可以实现更为高级的特性</span></span></span></span><span data-slate-object="text" data-key="13879"><span data-slate-leaf="true" data-offset-key="13879:0" data-first-offset="true"><span data-slate-string="true">。在语言设计层面，Go 语言就为广大 Gopher 提供了诸多正交的语法元素供后续组合使用，包括：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="13880"><div data-slate-type="list-line" data-slate-object="block" data-key="13881"><span data-slate-object="text" data-key="13882"><span data-slate-leaf="true" data-offset-key="13882:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_61f6b532" data-attr-id="36035" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Go 语言无类型体系（Type Hierarchy），没有父子类的概念，类型定义是正交独立的；</span></span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13883"><span data-slate-object="text" data-key="13884"><span data-slate-leaf="true" data-offset-key="13884:0" data-first-offset="true"><span data-slate-string="true">方法和类型是正交的，每种类型都可以拥有自己的方法集合，方法本质上只是一个将 receiver 参数作为第一个参数的函数而已；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="13885"><span data-slate-object="text" data-key="13886"><span data-slate-leaf="true" data-offset-key="13886:0" data-first-offset="true"><span data-slate-string="true">接口与它的实现者之间无 “显式关联”，也就说接口与 Go 语言其他部分也是正交的。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13887"><span data-slate-object="text" data-key="13888"><span data-slate-leaf="true" data-offset-key="13888:0" data-first-offset="true"><span data-slate-string="true">在这些正交语法元素当中，</span></span></span><span data-slate-object="text" data-key="13889"><span data-slate-leaf="true" data-offset-key="13889:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">接口作为 Go 语言提供的具有天然正交性的语法元素</span></span></span></span><span data-slate-object="text" data-key="13890"><span data-slate-leaf="true" data-offset-key="13890:0" data-first-offset="true"><span data-slate-string="true">，在 Go 程序的静态结构搭建与耦合设计中扮演着至关重要的角色。 而要想知道接口究竟扮演什么角色，我们就先要了解组合的方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13891"><span data-slate-object="text" data-key="13892"><span data-slate-leaf="true" data-offset-key="13892:0" data-first-offset="true"><span data-slate-string="true">构建 Go 应用程序的静态骨架结构有两种主要的组合方式，如下图所示：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="13893"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/2f/44/2f07b12yyea031bdc38fc3bbc316dc44.jpg?wh=1980x1080"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13894"><span data-slate-object="text" data-key="13895"><span data-slate-leaf="true" data-offset-key="13895:0" data-first-offset="true"><span data-slate-string="true">我们看到，这两种组合方式分别为垂直组合和水平组合，那这两种组合的各自含义与应用范围是什么呢？下面我们分别详细说说。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13896" id="sr-toc-2"><span data-slate-object="text" data-key="13897"><span data-slate-leaf="true" data-offset-key="13897:0" data-first-offset="true"><span data-slate-string="true">垂直组合</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13898"><span data-slate-object="text" data-key="13899"><span data-slate-leaf="true" data-offset-key="13899:0" data-first-offset="true"><span data-slate-string="true">垂直组合更多用在将多个类型（如上图中的 T1、I1 等）通过 “类型嵌入（Type Embedding）” 的方式实现新类型（如 NT1）的定义。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13900"><span data-slate-object="text" data-key="13901"><span data-slate-leaf="true" data-offset-key="13901:0" data-first-offset="true"><span data-slate-string="true">传统面向对象编程语言（比如：C++）大多是通过继承的方式建构出自己的类型体系的，但 Go 语言并没有类型体系的概念。Go 语言通过类型的组合而不是继承让单一类型</span></span></span><span data-slate-object="text" data-key="13902"><span data-slate-leaf="true" data-offset-key="13902:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">承载更多的功能</span></span></span></span><span data-slate-object="text" data-key="13903"><span data-slate-leaf="true" data-offset-key="13903:0" data-first-offset="true"><span data-slate-string="true">。由于这种方式与硬件配置升级的垂直扩展很类似，所以这里我们叫它</span></span></span><span data-slate-object="text" data-key="13904"><span data-slate-leaf="true" data-offset-key="13904:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">垂直组合</span></span></span></span><span data-slate-object="text" data-key="13905"><span data-slate-leaf="true" data-offset-key="13905:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13906"><span data-slate-object="text" data-key="13907"><span data-slate-leaf="true" data-offset-key="13907:0" data-first-offset="true"><span data-slate-string="true">又因为不是继承，那么通过垂直组合定义的新类型与被嵌入的类型之间就没有所谓 “父子关系” 的概念了，也没有向上、向下转型（Type Casting），被嵌入的类型也不知道将其嵌入的外部类型的存在。调用方法时，方法的匹配取决于方法名字，而不是类型。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13908"><span data-slate-object="text" data-key="13909"><span data-slate-leaf="true" data-offset-key="13909:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">这样的垂直组合更多应用在新类型的定义方面</span></span></span></span><span data-slate-object="text" data-key="13910"><span data-slate-leaf="true" data-offset-key="13910:0" data-first-offset="true"><span data-slate-string="true">。通过这种垂直组合，我们可以达到方法实现的复用、接口定义重用等目的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13911"><span data-slate-object="text" data-key="13912"><span data-slate-leaf="true" data-offset-key="13912:0" data-first-offset="true"><span data-slate-string="true">前面说了，在实现层面，Go 语言通过类型嵌入（Type Embedding）实现垂直组合，组合方式主要有以下这么几种。因为我们在 26 讲已经对类型嵌入进行了详细讲解，我这里只简单带你回顾一下。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="13913" id="sr-toc-3"><span data-slate-object="text" data-key="13914"><span data-slate-leaf="true" data-offset-key="13914:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第一种：通过嵌入接口构建接口</span></span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="13915"><span data-slate-object="text" data-key="13916"><span data-slate-leaf="true" data-offset-key="13916:0" data-first-offset="true"><span data-slate-string="true">通过在接口定义中嵌入其他接口类型，实现接口行为聚合，组成大接口。这种方式在标准库中非常常见，也是 Go 接口类型定义的惯例，我们在前面的讲解中也不止一次提及。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13917"><span data-slate-object="text" data-key="13918"><span data-slate-leaf="true" data-offset-key="13918:0" data-first-offset="true"><span data-slate-string="true">比如这个 ReadWriter 接口类型就采用了这种类型嵌入方式：</span></span></span></div><div data-code-language="typescript" data-slate-type="pre" data-slate-object="block" data-key="13919"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13920"><span data-slate-object="text" data-key="13921"><span data-slate-leaf="true" data-offset-key="13921:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/io/io.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13922"><span data-slate-object="text" data-key="13923"><span data-slate-leaf="true" data-offset-key="13923:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="13924"><span data-slate-leaf="true" data-offset-key="13924:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13925"><span data-slate-leaf="true" data-offset-key="13925:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ReadWriter</span></span></span></span><span data-slate-object="text" data-key="13926"><span data-slate-leaf="true" data-offset-key="13926:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13927"><span data-slate-leaf="true" data-offset-key="13927:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="13928"><span data-slate-leaf="true" data-offset-key="13928:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13929"><span data-slate-object="text" data-key="13930"><span data-slate-leaf="true" data-offset-key="13930:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13931"><span data-slate-leaf="true" data-offset-key="13931:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Reader</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13932"><span data-slate-object="text" data-key="13933"><span data-slate-leaf="true" data-offset-key="13933:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="13934"><span data-slate-leaf="true" data-offset-key="13934:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Writer</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13935"><span data-slate-object="text" data-key="13936"><span data-slate-leaf="true" data-offset-key="13936:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="13937" id="sr-toc-4"><span data-slate-object="text" data-key="13938"><span data-slate-leaf="true" data-offset-key="13938:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">第二种：通过嵌入接口构建结构体类型</span></span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="13939"><span data-slate-object="text" data-key="13940"><span data-slate-leaf="true" data-offset-key="13940:0" data-first-offset="true"><span data-slate-string="true">这里我们直接来看一个通过嵌入接口类型创建新结构体类型的例子：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13941"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13942"><span data-slate-object="text" data-key="13943"><span data-slate-leaf="true" data-offset-key="13943:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="13944"><span data-slate-leaf="true" data-offset-key="13944:0" data-first-offset="true"><span data-slate-string="true"> MyReader </span></span></span><span data-slate-object="text" data-key="13945"><span data-slate-leaf="true" data-offset-key="13945:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="13946"><span data-slate-leaf="true" data-offset-key="13946:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13947"><span data-slate-object="text" data-key="13948"><span data-slate-leaf="true" data-offset-key="13948:0" data-first-offset="true"><span data-slate-string="true">  io.Reader </span></span></span><span data-slate-object="text" data-key="13949"><span data-slate-leaf="true" data-offset-key="13949:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// underlying reader</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13950"><span data-slate-object="text" data-key="13951"><span data-slate-leaf="true" data-offset-key="13951:0" data-first-offset="true"><span data-slate-string="true">  N </span></span></span><span data-slate-object="text" data-key="13952"><span data-slate-leaf="true" data-offset-key="13952:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="13953"><span data-slate-leaf="true" data-offset-key="13953:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="13954"><span data-slate-leaf="true" data-offset-key="13954:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// max bytes remaining</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="13955"><span data-slate-object="text" data-key="13956"><span data-slate-leaf="true" data-offset-key="13956:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13957"><span data-slate-object="text" data-key="13958"><span data-slate-leaf="true" data-offset-key="13958:0" data-first-offset="true"><span data-slate-string="true">在前面的讲解中，我们也曾提到过，在结构体中嵌入接口，可以用于快速构建满足某一个接口的结构体类型，来满足某单元测试的需要，之后我们只需要实现少数需要的接口方法就可以了。尤其是将这样的结构体类型变量传递赋值给大接口的时候，就更能体现嵌入接口类型的优势了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="13959" id="sr-toc-5"><span data-slate-object="text" data-key="13960"><span data-slate-leaf="true" data-offset-key="13960:0" data-first-offset="true"><span data-slate-string="true">第三种：通过嵌入结构体类型构建新结构体类型</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="13961"><span data-slate-object="text" data-key="13962"><span data-slate-leaf="true" data-offset-key="13962:0" data-first-offset="true"><span data-slate-string="true">在结构体中嵌入接口类型名和在结构体中嵌入其他结构体，都是 “委派模式（delegate）” 的一种应用。对新结构体类型的方法调用，可能会被 “委派” 给该结构体内部嵌入的结构体的实例，通过这种方式构建的新结构体类型就 “继承” 了被嵌入的结构体的方法的实现。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13963"><span data-slate-object="text" data-key="13964"><span data-slate-leaf="true" data-offset-key="13964:0" data-first-offset="true"><span data-slate-string="true">现在我们可以知道，包括嵌入接口类型在内的各种垂直组合更多用于类型定义层面，本质上它是一种</span></span></span><span data-slate-object="text" data-key="13965"><span data-slate-leaf="true" data-offset-key="13965:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">类型组合</span></span></span></span><span data-slate-object="text" data-key="13966"><span data-slate-leaf="true" data-offset-key="13966:0" data-first-offset="true"><span data-slate-string="true">，也是一种类型之间的耦合方式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13967"><span data-slate-object="text" data-key="13968"><span data-slate-leaf="true" data-offset-key="13968:0" data-first-offset="true"><span data-slate-string="true">说完了垂直组合，我们再来看看水平组合。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="13969" id="sr-toc-6"><span data-slate-object="text" data-key="13970"><span data-slate-leaf="true" data-offset-key="13970:0" data-first-offset="true"><span data-slate-string="true">水平组合</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="13971"><span data-slate-object="text" data-key="13972"><span data-slate-leaf="true" data-offset-key="13972:0" data-first-offset="true"><span data-slate-string="true">当我们通过垂直组合将一个个类型建立完毕后，就好比我们已经建立了整个应用程序骨架中的 “器官”，比如手、手臂等，那么这些 “器官” 之间又是通过什么连接在一起的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13973"><span data-slate-object="text" data-key="13974"><span data-slate-leaf="true" data-offset-key="13974:0" data-first-offset="true"><span data-slate-string="true">关节！</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13975"><span data-slate-object="text" data-key="13976"><span data-slate-leaf="true" data-offset-key="13976:0" data-first-offset="true"><span data-slate-string="true">没错！那么在 Go 应用静态骨架中，什么元素经常扮演着 “关节” 的角色呢？我们通过一个例子来看一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13977"><span data-slate-object="text" data-key="13978"><span data-slate-leaf="true" data-offset-key="13978:0" data-first-offset="true"><span data-slate-string="true">假设现在我们有一个任务，要编写一个函数，实现将一段数据写入磁盘的功能。通常我们都可以很容易地写出下面的函数：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13979"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13980"><span data-slate-object="text" data-key="13981"><span data-slate-leaf="true" data-offset-key="13981:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="13982"><span data-slate-leaf="true" data-offset-key="13982:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="13983"><span data-slate-leaf="true" data-offset-key="13983:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Save</span></span></span></span></span><span data-slate-object="text" data-key="13984"><span data-slate-leaf="true" data-offset-key="13984:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *os.File, data []</span></span></span></span></span><span data-slate-object="text" data-key="13985"><span data-slate-leaf="true" data-offset-key="13985:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span></span></span><span data-slate-object="text" data-key="13986"><span data-slate-leaf="true" data-offset-key="13986:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="13987"><span data-slate-leaf="true" data-offset-key="13987:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="13988"><span data-slate-leaf="true" data-offset-key="13988:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13989"><span data-slate-object="text" data-key="13990"><span data-slate-leaf="true" data-offset-key="13990:0" data-first-offset="true"><span data-slate-string="true">我们看到，这个函数使用一个 *os.File 来表示数据写入的目的地，这个函数实现后可以工作得很好。但这里依旧存在一些问题，我们来看一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13991"><span data-slate-object="text" data-key="13992"><span data-slate-leaf="true" data-offset-key="13992:0" data-first-offset="true"><span data-slate-string="true">首先，这个函数很难测试。os.File 是一个封装了磁盘文件描述符（又称句柄）的结构体，只有通过打开或创建真实磁盘文件才能获得这个结构体的实例，这就意味着，如果我们要对 Save 这个函数进行单元测试，就必须使用真实的磁盘文件。测试过程中，通过 Save 函数写入文件后，我们还需要再次操作文件、读取刚刚写入的内容来判断写入内容是否正确，并且每次测试结束前都要对创建的临时文件进行清理，避免给后续的测试带去影响。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="13993"><span data-slate-object="text" data-key="13994"><span data-slate-leaf="true" data-offset-key="13994:0" data-first-offset="true"><span data-slate-string="true">其次，Save 函数违背了接口分离原则。根据业界广泛推崇的 Robert Martin（Bob 大叔）的</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="13995"><span data-slate-object="text" data-key="13996"><span data-slate-leaf="true" data-offset-key="13996:0" data-first-offset="true"><span data-slate-string="true">接口分离原则（ISP 原则，Interface Segregation Principle）</span></span></span></a><span data-slate-object="text" data-key="13997"><span data-slate-leaf="true" data-offset-key="13997:0" data-first-offset="true"><span data-slate-string="true">，也就是客户端不应该被迫依赖他们不使用的方法，我们会发现 os.File 不仅包含 Save 函数需要的与写数据相关的 Write 方法，还包含了其他与保存数据到文件操作不相关的方法。比如，你也可以看下 *os.File 包含的这些方法：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="13998"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="13999"><span data-slate-object="text" data-key="14000"><span data-slate-leaf="true" data-offset-key="14000:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14001"><span data-slate-leaf="true" data-offset-key="14001:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14002"><span data-slate-leaf="true" data-offset-key="14002:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *File)</span></span></span></span></span><span data-slate-object="text" data-key="14003"><span data-slate-leaf="true" data-offset-key="14003:0" data-first-offset="true"><span data-slate-string="true"> Chdir() </span></span></span><span data-slate-object="text" data-key="14004"><span data-slate-leaf="true" data-offset-key="14004:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14005"><span data-slate-object="text" data-key="14006"><span data-slate-leaf="true" data-offset-key="14006:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14007"><span data-slate-leaf="true" data-offset-key="14007:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14008"><span data-slate-leaf="true" data-offset-key="14008:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *File)</span></span></span></span></span><span data-slate-object="text" data-key="14009"><span data-slate-leaf="true" data-offset-key="14009:0" data-first-offset="true"><span data-slate-string="true"> Chmod(mode FileMode) </span></span></span><span data-slate-object="text" data-key="14010"><span data-slate-leaf="true" data-offset-key="14010:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14011"><span data-slate-object="text" data-key="14012"><span data-slate-leaf="true" data-offset-key="14012:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14013"><span data-slate-leaf="true" data-offset-key="14013:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14014"><span data-slate-leaf="true" data-offset-key="14014:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f *File)</span></span></span></span></span><span data-slate-object="text" data-key="14015"><span data-slate-leaf="true" data-offset-key="14015:0" data-first-offset="true"><span data-slate-string="true"> Chown(uid, gid </span></span></span><span data-slate-object="text" data-key="14016"><span data-slate-leaf="true" data-offset-key="14016:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="14017"><span data-slate-leaf="true" data-offset-key="14017:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="14018"><span data-slate-leaf="true" data-offset-key="14018:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14019"><span data-slate-object="text" data-key="14020"><span data-slate-leaf="true" data-offset-key="14020:0" data-first-offset="true"><span data-slate-string="true">... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14021"><span data-slate-object="text" data-key="14022"><span data-slate-leaf="true" data-offset-key="14022:0" data-first-offset="true"><span data-slate-string="true">这种让 Save 函数被迫依赖它所不使用的方法的设计违反了 ISP 原则。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14023"><span data-slate-object="text" data-key="14024"><span data-slate-leaf="true" data-offset-key="14024:0" data-first-offset="true"><span data-slate-string="true">最后，Save 函数对 os.File 的强依赖让它失去了扩展性。像 Save 这样的功能函数，它日后很大可能会增加向网络存储写入数据的功能需求。但如果到那时我们再来改变 Save 函数的函数签名（参数列表 + 返回值）的话，将影响到 Save 函数的所有调用者。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14025"><span data-slate-object="text" data-key="14026"><span data-slate-leaf="true" data-offset-key="14026:0" data-first-offset="true"><span data-slate-string="true">综合考虑这几种原因，我们发现 Save 函数所在的 “器官” 与 os.File 所在的 “器官” 之间采用了一种硬连接的方式，而以 os.File 这样的结构体作为 “关节” 让它连接的两个 “器官” 丧失了相互运动的自由度，让它与它连接的两个 “器官” 构成的联结体变得 “僵直”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14027"><span data-slate-object="text" data-key="14028"><span data-slate-leaf="true" data-offset-key="14028:0" data-first-offset="true"><span data-slate-string="true">那么，我们应该如何更换 “关节” 来改善 Save 的设计呢？我们来试试接口。新版的 Save 函数原型如下：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14029"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14030"><span data-slate-object="text" data-key="14031"><span data-slate-leaf="true" data-offset-key="14031:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14032"><span data-slate-leaf="true" data-offset-key="14032:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14033"><span data-slate-leaf="true" data-offset-key="14033:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Save</span></span></span></span></span><span data-slate-object="text" data-key="14034"><span data-slate-leaf="true" data-offset-key="14034:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(w io.Writer, data []</span></span></span></span></span><span data-slate-object="text" data-key="14035"><span data-slate-leaf="true" data-offset-key="14035:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span></span></span><span data-slate-object="text" data-key="14036"><span data-slate-leaf="true" data-offset-key="14036:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="14037"><span data-slate-leaf="true" data-offset-key="14037:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14038"><span data-slate-leaf="true" data-offset-key="14038:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14039"><span data-slate-object="text" data-key="14040"><span data-slate-leaf="true" data-offset-key="14040:0" data-first-offset="true"><span data-slate-string="true">你可以看到，我们用 io.Writer 接口类型替换掉了 *os.File。这样一来，新版 Save 的设计就符合了接口分离原则，因为 io.Writer 仅包含一个 Write 方法，而且这个方法恰恰是 Save 唯一需要的方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14041"><span data-slate-object="text" data-key="14042"><span data-slate-leaf="true" data-offset-key="14042:0" data-first-offset="true"><span data-slate-string="true">另外，这里我们以 io.Writer 接口类型表示数据写入的目的地，既可以支持向磁盘写入，也可以支持向网络存储写入，并支持任何实现了 Write 方法的写入行为，这让 Save 函数的扩展性得到了质的提升。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14043"><span data-slate-object="text" data-key="14044"><span data-slate-leaf="true" data-offset-key="14044:0" data-first-offset="true"><span data-slate-string="true">还有一点，也是之前我们一直强调的，接口本质是契约，具有天然的降低耦合的作用。基于这点，我们对 Save 函数的测试也将变得十分容易，比如下面示例代码：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14045"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14046"><span data-slate-object="text" data-key="14047"><span data-slate-leaf="true" data-offset-key="14047:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14048"><span data-slate-leaf="true" data-offset-key="14048:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14049"><span data-slate-leaf="true" data-offset-key="14049:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">TestSave</span></span></span></span></span><span data-slate-object="text" data-key="14050"><span data-slate-leaf="true" data-offset-key="14050:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(t *testing.T)</span></span></span></span></span><span data-slate-object="text" data-key="14051"><span data-slate-leaf="true" data-offset-key="14051:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14052"><span data-slate-object="text" data-key="14053"><span data-slate-leaf="true" data-offset-key="14053:0" data-first-offset="true"><span data-slate-string="true">    b := </span></span></span><span data-slate-object="text" data-key="14054"><span data-slate-leaf="true" data-offset-key="14054:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="14055"><span data-slate-leaf="true" data-offset-key="14055:0" data-first-offset="true"><span data-slate-string="true">([]</span></span></span><span data-slate-object="text" data-key="14056"><span data-slate-leaf="true" data-offset-key="14056:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14057"><span data-slate-leaf="true" data-offset-key="14057:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14058"><span data-slate-leaf="true" data-offset-key="14058:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14059"><span data-slate-leaf="true" data-offset-key="14059:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14060"><span data-slate-leaf="true" data-offset-key="14060:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">128</span></span></span></span><span data-slate-object="text" data-key="14061"><span data-slate-leaf="true" data-offset-key="14061:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14062"><span data-slate-object="text" data-key="14063"><span data-slate-leaf="true" data-offset-key="14063:0" data-first-offset="true"><span data-slate-string="true">    buf := bytes.NewBuffer(b)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14064"><span data-slate-object="text" data-key="14065"><span data-slate-leaf="true" data-offset-key="14065:0" data-first-offset="true"><span data-slate-string="true">    data := []</span></span></span><span data-slate-object="text" data-key="14066"><span data-slate-leaf="true" data-offset-key="14066:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14067"><span data-slate-leaf="true" data-offset-key="14067:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="14068"><span data-slate-leaf="true" data-offset-key="14068:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hello, golang"</span></span></span></span><span data-slate-object="text" data-key="14069"><span data-slate-leaf="true" data-offset-key="14069:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14070"><span data-slate-object="text" data-key="14071"><span data-slate-leaf="true" data-offset-key="14071:0" data-first-offset="true"><span data-slate-string="true">    err := Save(buf, data)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14072"><span data-slate-object="text" data-key="14073"><span data-slate-leaf="true" data-offset-key="14073:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14074"><span data-slate-leaf="true" data-offset-key="14074:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14075"><span data-slate-leaf="true" data-offset-key="14075:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="14076"><span data-slate-leaf="true" data-offset-key="14076:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14077"><span data-slate-leaf="true" data-offset-key="14077:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14078"><span data-slate-object="text" data-key="14079"><span data-slate-leaf="true" data-offset-key="14079:0" data-first-offset="true"><span data-slate-string="true">        t.Errorf(</span></span></span><span data-slate-object="text" data-key="14080"><span data-slate-leaf="true" data-offset-key="14080:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"want nil, actual %s"</span></span></span></span><span data-slate-object="text" data-key="14081"><span data-slate-leaf="true" data-offset-key="14081:0" data-first-offset="true"><span data-slate-string="true">, err.Error())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14082"><span data-slate-object="text" data-key="14083"><span data-slate-leaf="true" data-offset-key="14083:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14084"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14085"><span data-slate-object="text" data-key="14086"><span data-slate-leaf="true" data-offset-key="14086:0" data-first-offset="true"><span data-slate-string="true">    saved := buf.Bytes()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14087"><span data-slate-object="text" data-key="14088"><span data-slate-leaf="true" data-offset-key="14088:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14089"><span data-slate-leaf="true" data-offset-key="14089:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14090"><span data-slate-leaf="true" data-offset-key="14090:0" data-first-offset="true"><span data-slate-string="true"> !reflect.DeepEqual(saved, data) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14091"><span data-slate-object="text" data-key="14092"><span data-slate-leaf="true" data-offset-key="14092:0" data-first-offset="true"><span data-slate-string="true">        t.Errorf(</span></span></span><span data-slate-object="text" data-key="14093"><span data-slate-leaf="true" data-offset-key="14093:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"want %s, actual %s"</span></span></span></span><span data-slate-object="text" data-key="14094"><span data-slate-leaf="true" data-offset-key="14094:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14095"><span data-slate-leaf="true" data-offset-key="14095:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="14096"><span data-slate-leaf="true" data-offset-key="14096:0" data-first-offset="true"><span data-slate-string="true">(data), </span></span></span><span data-slate-object="text" data-key="14097"><span data-slate-leaf="true" data-offset-key="14097:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="14098"><span data-slate-leaf="true" data-offset-key="14098:0" data-first-offset="true"><span data-slate-string="true">(saved))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14099"><span data-slate-object="text" data-key="14100"><span data-slate-leaf="true" data-offset-key="14100:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14101"><span data-slate-object="text" data-key="14102"><span data-slate-leaf="true" data-offset-key="14102:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14103"><span data-slate-object="text" data-key="14104"><span data-slate-leaf="true" data-offset-key="14104:0" data-first-offset="true"><span data-slate-string="true">在这段代码中，我们通过 bytes.NewBuffer 创建了一个 *bytes.Buffer 类型变量 buf，由于 bytes.Buffer 实现了 Write 方法，进而实现了 io.Writer 接口，我们可以合法地将变量 buf 传递给 Save 函数。之后我们可以从 buf 中取出 Save 函数写入的数据内容与预期的数据做比对，就可以达到对 Save 函数进行单元测试的目的了。在整个测试过程中，我们不需要创建任何磁盘文件或建立任何网络连接。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14105"><span data-slate-object="text" data-key="14106"><span data-slate-leaf="true" data-offset-key="14106:0" data-first-offset="true"><span data-slate-string="true">看到这里，你应该感受到了，用接口作为 “关节（连接点）” 的好处很多！像上面图中展示的那样，接口可以将各个类型水平组合（连接）在一起。通过接口的编织，整个应用程序不再是一个个孤立的 “器官”，而是一幅完整的、有灵活性和扩展性的静态骨架结构。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14107"><span data-slate-object="text" data-key="14108"><span data-slate-leaf="true" data-offset-key="14108:0" data-first-offset="true"><span data-slate-string="true">现在，我们已经确定了</span></span></span><span data-slate-object="text" data-key="14109"><span data-slate-leaf="true" data-offset-key="14109:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">接口承担了应用骨架的 “关节” 角色</span></span></span></span><span data-slate-object="text" data-key="14110"><span data-slate-leaf="true" data-offset-key="14110:0" data-first-offset="true"><span data-slate-string="true">，那么接下来我们就来看看接口是如何演好这一角色的。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14111" id="sr-toc-7"><span data-slate-object="text" data-key="14112"><span data-slate-leaf="true" data-offset-key="14112:0" data-first-offset="true"><span data-slate-string="true">接口应用的几种模式</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14113"><span data-slate-object="text" data-key="14114"><span data-slate-leaf="true" data-offset-key="14114:0" data-first-offset="true"><span data-slate-string="true">前面已经说了，以接口为 “关节” 的水平组合方式，可以将各个垂直组合出的类型 “耦合” 在一起，从而编织出程序静态骨架。</span></span><span data-slate-leaf="true" data-offset-key="14114:1"><span data-slate-object="annotation" data-annotation-key="gkann_9ca17fc6" data-attr-id="41331" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">而通过接口进行水平组合的基本模式就是：</span></span></span></span><span data-slate-object="text" data-key="14115"><span data-slate-leaf="true" data-offset-key="14115:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_9ca17fc6" data-attr-id="41331" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">使用接受接口类型参数的函数或方法</span></span></span></span></span><span data-slate-object="text" data-key="14116"><span data-slate-leaf="true" data-offset-key="14116:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_9ca17fc6" data-attr-id="41331" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。</span></span></span><span data-slate-leaf="true" data-offset-key="14116:1"><span data-slate-string="true">在这个基本模式基础上，还有其他几种 “衍生品”。我们先从基本模式说起，再往外延伸。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14117" id="sr-toc-8"><span data-slate-object="text" data-key="14118"><span data-slate-leaf="true" data-offset-key="14118:0" data-first-offset="true"><span data-slate-string="true">基本模式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14119"><span data-slate-object="text" data-key="14120"><span data-slate-leaf="true" data-offset-key="14120:0" data-first-offset="true"><span data-slate-string="true">接受接口类型参数的函数或方法是水平组合的基本语法，形式是这样的：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14121"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14122"><span data-slate-object="text" data-key="14123"><span data-slate-leaf="true" data-offset-key="14123:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14124"><span data-slate-leaf="true" data-offset-key="14124:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14125"><span data-slate-leaf="true" data-offset-key="14125:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">YourFuncName</span></span></span></span></span><span data-slate-object="text" data-key="14126"><span data-slate-leaf="true" data-offset-key="14126:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(param YourInterfaceType)</span></span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14127"><span data-slate-object="text" data-key="14128"><span data-slate-leaf="true" data-offset-key="14128:0" data-first-offset="true"><span data-slate-string="true">我们套用骨架关节的概念，用这幅图来表示上面基本模式语法的运用方法：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14129"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/7b/d6/7be0727d1eda688dbyye480fd8d869d6.jpg?wh=1980x1080"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14130"><span data-slate-object="text" data-key="14131"><span data-slate-leaf="true" data-offset-key="14131:0" data-first-offset="true"><span data-slate-string="true">我们看到，函数 / 方法参数中的接口类型作为 “关节（连接点）”，支持将位于多个包中的多个类型与 YourFuncName 函数连接到一起，共同实现某一新特性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14132"><span data-slate-object="text" data-key="14133"><span data-slate-leaf="true" data-offset-key="14133:0" data-first-offset="true"><span data-slate-string="true">同时，</span></span><span data-slate-leaf="true" data-offset-key="14133:1"><span data-slate-object="annotation" data-annotation-key="gkann_90f87af4" data-attr-id="36337" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">接口类型和它的实现者之间隐式的关系却在不经意间满足了：依赖抽象（DIP）、里氏替换原则（LSP）、接口隔离（ISP）等代码设计原则，</span></span></span><span data-slate-leaf="true" data-offset-key="14133:2"><span data-slate-string="true">这在其他语言中是需要很 “刻意” 地设计谋划的，但对 Go 接口来看，这一切却是自然而然的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14134"><span data-slate-object="text" data-key="14135"><span data-slate-leaf="true" data-offset-key="14135:0" data-first-offset="true"><span data-slate-string="true">这一水平组合的基本模式在 Go 标准库、Go 社区第三方包中有着广泛应用，其他几种模式也是从这个模式衍生的。下面我们逐一看一下各个衍生模式。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14136" id="sr-toc-9"><span data-slate-object="text" data-key="14137"><span data-slate-leaf="true" data-offset-key="14137:0" data-first-offset="true"><span data-slate-string="true">创建模式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14138"><span data-slate-object="text" data-key="14139"><span data-slate-leaf="true" data-offset-key="14139:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_38252d70" data-attr-id="36338" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">Go 社区流传一个经验法则：“接受接口，返回结构体（Accept interfaces, return structs）”，</span></span></span><span data-slate-leaf="true" data-offset-key="14139:1"><span data-slate-string="true">这其实就是一种把接口作为 “关节” 的应用模式。我这里把它叫做创建模式，是因为这个经验法则多用于创建某一结构体类型的实例。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14140"><span data-slate-object="text" data-key="14141"><span data-slate-leaf="true" data-offset-key="14141:0" data-first-offset="true"><span data-slate-string="true">下面是 Go 标准库中，运用创建模式创建结构体实例的代码摘录：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14142"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div><div data-code-line-number="35"></div><div data-code-line-number="36"></div><div data-code-line-number="37"></div><div data-code-line-number="38"></div><div data-code-line-number="39"></div><div data-code-line-number="40"></div><div data-code-line-number="41"></div><div data-code-line-number="42"></div><div data-code-line-number="43"></div><div data-code-line-number="44"></div><div data-code-line-number="45"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14143"><span data-slate-object="text" data-key="14144"><span data-slate-leaf="true" data-offset-key="14144:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/sync/cond.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14145"><span data-slate-object="text" data-key="14146"><span data-slate-leaf="true" data-offset-key="14146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14147"><span data-slate-leaf="true" data-offset-key="14147:0" data-first-offset="true"><span data-slate-string="true"> Cond </span></span></span><span data-slate-object="text" data-key="14148"><span data-slate-leaf="true" data-offset-key="14148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14149"><span data-slate-leaf="true" data-offset-key="14149:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14150"><span data-slate-object="text" data-key="14151"><span data-slate-leaf="true" data-offset-key="14151:0" data-first-offset="true"><span data-slate-string="true">    ... ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14152"><span data-slate-object="text" data-key="14153"><span data-slate-leaf="true" data-offset-key="14153:0" data-first-offset="true"><span data-slate-string="true">    L Locker</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14154"><span data-slate-object="text" data-key="14155"><span data-slate-leaf="true" data-offset-key="14155:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14156"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14157"><span data-slate-object="text" data-key="14158"><span data-slate-leaf="true" data-offset-key="14158:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14159"><span data-slate-leaf="true" data-offset-key="14159:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14160"><span data-slate-leaf="true" data-offset-key="14160:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewCond</span></span></span></span></span><span data-slate-object="text" data-key="14161"><span data-slate-leaf="true" data-offset-key="14161:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(l Locker)</span></span></span></span></span><span data-slate-object="text" data-key="14162"><span data-slate-leaf="true" data-offset-key="14162:0" data-first-offset="true"><span data-slate-string="true"> *Cond {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14163"><span data-slate-object="text" data-key="14164"><span data-slate-leaf="true" data-offset-key="14164:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14165"><span data-slate-leaf="true" data-offset-key="14165:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14166"><span data-slate-leaf="true" data-offset-key="14166:0" data-first-offset="true"><span data-slate-string="true"> &amp;Cond{L: l}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14167"><span data-slate-object="text" data-key="14168"><span data-slate-leaf="true" data-offset-key="14168:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14169"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14170"><span data-slate-object="text" data-key="14171"><span data-slate-leaf="true" data-offset-key="14171:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/log/log.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14172"><span data-slate-object="text" data-key="14173"><span data-slate-leaf="true" data-offset-key="14173:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14174"><span data-slate-leaf="true" data-offset-key="14174:0" data-first-offset="true"><span data-slate-string="true"> Logger </span></span></span><span data-slate-object="text" data-key="14175"><span data-slate-leaf="true" data-offset-key="14175:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14176"><span data-slate-leaf="true" data-offset-key="14176:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14177"><span data-slate-object="text" data-key="14178"><span data-slate-leaf="true" data-offset-key="14178:0" data-first-offset="true"><span data-slate-string="true">    mu     sync.Mutex </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14179"><span data-slate-object="text" data-key="14180"><span data-slate-leaf="true" data-offset-key="14180:0" data-first-offset="true"><span data-slate-string="true">    prefix </span></span></span><span data-slate-object="text" data-key="14181"><span data-slate-leaf="true" data-offset-key="14181:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="14182"><span data-slate-leaf="true" data-offset-key="14182:0" data-first-offset="true"><span data-slate-string="true">     </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14183"><span data-slate-object="text" data-key="14184"><span data-slate-leaf="true" data-offset-key="14184:0" data-first-offset="true"><span data-slate-string="true">    flag   </span></span></span><span data-slate-object="text" data-key="14185"><span data-slate-leaf="true" data-offset-key="14185:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="14186"><span data-slate-leaf="true" data-offset-key="14186:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14187"><span data-slate-object="text" data-key="14188"><span data-slate-leaf="true" data-offset-key="14188:0" data-first-offset="true"><span data-slate-string="true">    out    io.Writer  </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14189"><span data-slate-object="text" data-key="14190"><span data-slate-leaf="true" data-offset-key="14190:0" data-first-offset="true"><span data-slate-string="true">    buf    []</span></span></span><span data-slate-object="text" data-key="14191"><span data-slate-leaf="true" data-offset-key="14191:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14192"><span data-slate-leaf="true" data-offset-key="14192:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14193"><span data-slate-object="text" data-key="14194"><span data-slate-leaf="true" data-offset-key="14194:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14195"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14196"><span data-slate-object="text" data-key="14197"><span data-slate-leaf="true" data-offset-key="14197:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14198"><span data-slate-leaf="true" data-offset-key="14198:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14199"><span data-slate-leaf="true" data-offset-key="14199:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">New</span></span></span></span></span><span data-slate-object="text" data-key="14200"><span data-slate-leaf="true" data-offset-key="14200:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(out io.Writer, prefix </span></span></span></span></span><span data-slate-object="text" data-key="14201"><span data-slate-leaf="true" data-offset-key="14201:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="14202"><span data-slate-leaf="true" data-offset-key="14202:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">, flag </span></span></span></span></span><span data-slate-object="text" data-key="14203"><span data-slate-leaf="true" data-offset-key="14203:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span></span><span data-slate-object="text" data-key="14204"><span data-slate-leaf="true" data-offset-key="14204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="14205"><span data-slate-leaf="true" data-offset-key="14205:0" data-first-offset="true"><span data-slate-string="true"> *Logger {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14206"><span data-slate-object="text" data-key="14207"><span data-slate-leaf="true" data-offset-key="14207:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14208"><span data-slate-leaf="true" data-offset-key="14208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14209"><span data-slate-leaf="true" data-offset-key="14209:0" data-first-offset="true"><span data-slate-string="true"> &amp;Logger{out: out, prefix: prefix, flag: flag}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14210"><span data-slate-object="text" data-key="14211"><span data-slate-leaf="true" data-offset-key="14211:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14212"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14213"><span data-slate-object="text" data-key="14214"><span data-slate-leaf="true" data-offset-key="14214:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/log/log.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14215"><span data-slate-object="text" data-key="14216"><span data-slate-leaf="true" data-offset-key="14216:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14217"><span data-slate-leaf="true" data-offset-key="14217:0" data-first-offset="true"><span data-slate-string="true"> Writer </span></span></span><span data-slate-object="text" data-key="14218"><span data-slate-leaf="true" data-offset-key="14218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14219"><span data-slate-leaf="true" data-offset-key="14219:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14220"><span data-slate-object="text" data-key="14221"><span data-slate-leaf="true" data-offset-key="14221:0" data-first-offset="true"><span data-slate-string="true">    err </span></span></span><span data-slate-object="text" data-key="14222"><span data-slate-leaf="true" data-offset-key="14222:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14223"><span data-slate-object="text" data-key="14224"><span data-slate-leaf="true" data-offset-key="14224:0" data-first-offset="true"><span data-slate-string="true">    buf []</span></span></span><span data-slate-object="text" data-key="14225"><span data-slate-leaf="true" data-offset-key="14225:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14226"><span data-slate-object="text" data-key="14227"><span data-slate-leaf="true" data-offset-key="14227:0" data-first-offset="true"><span data-slate-string="true">    n   </span></span></span><span data-slate-object="text" data-key="14228"><span data-slate-leaf="true" data-offset-key="14228:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14229"><span data-slate-object="text" data-key="14230"><span data-slate-leaf="true" data-offset-key="14230:0" data-first-offset="true"><span data-slate-string="true">    wr  io.Writer</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14231"><span data-slate-object="text" data-key="14232"><span data-slate-leaf="true" data-offset-key="14232:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14233"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14234"><span data-slate-object="text" data-key="14235"><span data-slate-leaf="true" data-offset-key="14235:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14236"><span data-slate-leaf="true" data-offset-key="14236:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14237"><span data-slate-leaf="true" data-offset-key="14237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">NewWriterSize</span></span></span></span></span><span data-slate-object="text" data-key="14238"><span data-slate-leaf="true" data-offset-key="14238:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(w io.Writer, size </span></span></span></span></span><span data-slate-object="text" data-key="14239"><span data-slate-leaf="true" data-offset-key="14239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></span></span><span data-slate-object="text" data-key="14240"><span data-slate-leaf="true" data-offset-key="14240:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="14241"><span data-slate-leaf="true" data-offset-key="14241:0" data-first-offset="true"><span data-slate-string="true"> *Writer {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14242"><span data-slate-object="text" data-key="14243"><span data-slate-leaf="true" data-offset-key="14243:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14244"><span data-slate-leaf="true" data-offset-key="14244:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Is it already a Writer?</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14245"><span data-slate-object="text" data-key="14246"><span data-slate-leaf="true" data-offset-key="14246:0" data-first-offset="true"><span data-slate-string="true">    b, ok := w.(*Writer)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14247"><span data-slate-object="text" data-key="14248"><span data-slate-leaf="true" data-offset-key="14248:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14249"><span data-slate-leaf="true" data-offset-key="14249:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14250"><span data-slate-leaf="true" data-offset-key="14250:0" data-first-offset="true"><span data-slate-string="true"> ok &amp;&amp; </span></span></span><span data-slate-object="text" data-key="14251"><span data-slate-leaf="true" data-offset-key="14251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="14252"><span data-slate-leaf="true" data-offset-key="14252:0" data-first-offset="true"><span data-slate-string="true">(b.buf) &gt;= size {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14253"><span data-slate-object="text" data-key="14254"><span data-slate-leaf="true" data-offset-key="14254:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14255"><span data-slate-leaf="true" data-offset-key="14255:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14256"><span data-slate-leaf="true" data-offset-key="14256:0" data-first-offset="true"><span data-slate-string="true"> b</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14257"><span data-slate-object="text" data-key="14258"><span data-slate-leaf="true" data-offset-key="14258:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14259"><span data-slate-object="text" data-key="14260"><span data-slate-leaf="true" data-offset-key="14260:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14261"><span data-slate-leaf="true" data-offset-key="14261:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14262"><span data-slate-leaf="true" data-offset-key="14262:0" data-first-offset="true"><span data-slate-string="true"> size &lt;= </span></span></span><span data-slate-object="text" data-key="14263"><span data-slate-leaf="true" data-offset-key="14263:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14264"><span data-slate-leaf="true" data-offset-key="14264:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14265"><span data-slate-object="text" data-key="14266"><span data-slate-leaf="true" data-offset-key="14266:0" data-first-offset="true"><span data-slate-string="true">        size = defaultBufSize</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14267"><span data-slate-object="text" data-key="14268"><span data-slate-leaf="true" data-offset-key="14268:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14269"><span data-slate-object="text" data-key="14270"><span data-slate-leaf="true" data-offset-key="14270:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14271"><span data-slate-leaf="true" data-offset-key="14271:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14272"><span data-slate-leaf="true" data-offset-key="14272:0" data-first-offset="true"><span data-slate-string="true"> &amp;Writer{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14273"><span data-slate-object="text" data-key="14274"><span data-slate-leaf="true" data-offset-key="14274:0" data-first-offset="true"><span data-slate-string="true">        buf: </span></span></span><span data-slate-object="text" data-key="14275"><span data-slate-leaf="true" data-offset-key="14275:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">make</span></span></span></span><span data-slate-object="text" data-key="14276"><span data-slate-leaf="true" data-offset-key="14276:0" data-first-offset="true"><span data-slate-string="true">([]</span></span></span><span data-slate-object="text" data-key="14277"><span data-slate-leaf="true" data-offset-key="14277:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14278"><span data-slate-leaf="true" data-offset-key="14278:0" data-first-offset="true"><span data-slate-string="true">, size),</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14279"><span data-slate-object="text" data-key="14280"><span data-slate-leaf="true" data-offset-key="14280:0" data-first-offset="true"><span data-slate-string="true">        wr:  w,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14281"><span data-slate-object="text" data-key="14282"><span data-slate-leaf="true" data-offset-key="14282:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14283"><span data-slate-object="text" data-key="14284"><span data-slate-leaf="true" data-offset-key="14284:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14285"><span data-slate-object="text" data-key="14286"><span data-slate-leaf="true" data-offset-key="14286:0" data-first-offset="true"><span data-slate-string="true">我们看到，创建模式在 sync、log、bufio 包中都有应用。以上面 log 包的 New 函数为例，这个函数用于实例化一个 log.Logger 实例，它接受一个 io.Writer 接口类型的参数，返回 *log.Logger。从 New 的实现上来看，传入的 out 参数被作为初值赋值给了 log.Logger 结构体字段 out。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14287"><span data-slate-object="text" data-key="14288"><span data-slate-leaf="true" data-offset-key="14288:0" data-first-offset="true"><span data-slate-string="true">创建模式通过接口，在 NewXXX 函数所在包与接口的实现者所在包之间建立了一个连接。大多数包含接口类型字段的结构体的实例化，都可以使用创建模式实现。这个模式比较容易理解，我们就不再深入了。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14289" id="sr-toc-10"><span data-slate-object="text" data-key="14290"><span data-slate-leaf="true" data-offset-key="14290:0" data-first-offset="true"><span data-slate-string="true">包装器模式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14291"><span data-slate-object="text" data-key="14292"><span data-slate-leaf="true" data-offset-key="14292:0" data-first-offset="true"><span data-slate-string="true">在基本模式的基础上，当返回值的类型与参数类型相同时，我们能得到下面形式的函数原型：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14293"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14294"><span data-slate-object="text" data-key="14295"><span data-slate-leaf="true" data-offset-key="14295:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14296"><span data-slate-leaf="true" data-offset-key="14296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14297"><span data-slate-leaf="true" data-offset-key="14297:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">YourWrapperFunc</span></span></span></span></span><span data-slate-object="text" data-key="14298"><span data-slate-leaf="true" data-offset-key="14298:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(param YourInterfaceType)</span></span></span></span></span><span data-slate-object="text" data-key="14299"><span data-slate-leaf="true" data-offset-key="14299:0" data-first-offset="true"><span data-slate-string="true"> YourInterfaceType</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14300"><span data-slate-object="text" data-key="14301"><span data-slate-leaf="true" data-offset-key="14301:0" data-first-offset="true"><span data-slate-string="true">通过这个函数，我们可以实现对输入参数的类型的包装，并在不改变被包装类型（输入参数类型）的定义的情况下，</span></span><span data-slate-leaf="true" data-offset-key="14301:1"><span data-slate-object="annotation" data-annotation-key="gkann_17f5cb42" data-attr-id="33291" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">返回具备新功能特性的、实现相同接口类型的新类型。这种接口应用模式我们叫它</span></span></span></span><span data-slate-object="text" data-key="14302"><span data-slate-leaf="true" data-offset-key="14302:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_17f5cb42" data-attr-id="33291" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">包装器模式</span></span></span></span></span><span data-slate-object="text" data-key="14303"><span data-slate-leaf="true" data-offset-key="14303:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_17f5cb42" data-attr-id="33291" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，</span></span></span><span data-slate-leaf="true" data-offset-key="14303:1"><span data-slate-string="true">也叫装饰器模式。包装器多用于对输入数据的过滤、变换等操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14304"><span data-slate-object="text" data-key="14305"><span data-slate-leaf="true" data-offset-key="14305:0" data-first-offset="true"><span data-slate-string="true">下面就是 Go 标准库中一个典型的</span></span></span><span data-slate-object="text" data-key="14306"><span data-slate-leaf="true" data-offset-key="14306:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">包装器模式</span></span></span></span><span data-slate-object="text" data-key="14307"><span data-slate-leaf="true" data-offset-key="14307:0" data-first-offset="true"><span data-slate-string="true">的应用：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14308"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14309"><span data-slate-object="text" data-key="14310"><span data-slate-leaf="true" data-offset-key="14310:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/io/io.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14311"><span data-slate-object="text" data-key="14312"><span data-slate-leaf="true" data-offset-key="14312:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14313"><span data-slate-leaf="true" data-offset-key="14313:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14314"><span data-slate-leaf="true" data-offset-key="14314:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">LimitReader</span></span></span></span></span><span data-slate-object="text" data-key="14315"><span data-slate-leaf="true" data-offset-key="14315:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(r Reader, n </span></span></span></span></span><span data-slate-object="text" data-key="14316"><span data-slate-leaf="true" data-offset-key="14316:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span></span></span><span data-slate-object="text" data-key="14317"><span data-slate-leaf="true" data-offset-key="14317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="14318"><span data-slate-leaf="true" data-offset-key="14318:0" data-first-offset="true"><span data-slate-string="true"> Reader { </span></span></span><span data-slate-object="text" data-key="14319"><span data-slate-leaf="true" data-offset-key="14319:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14320"><span data-slate-leaf="true" data-offset-key="14320:0" data-first-offset="true"><span data-slate-string="true"> &amp;LimitedReader{r, n} }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14321"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14322"><span data-slate-object="text" data-key="14323"><span data-slate-leaf="true" data-offset-key="14323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14324"><span data-slate-leaf="true" data-offset-key="14324:0" data-first-offset="true"><span data-slate-string="true"> LimitedReader </span></span></span><span data-slate-object="text" data-key="14325"><span data-slate-leaf="true" data-offset-key="14325:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14326"><span data-slate-leaf="true" data-offset-key="14326:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14327"><span data-slate-object="text" data-key="14328"><span data-slate-leaf="true" data-offset-key="14328:0" data-first-offset="true"><span data-slate-string="true">    R Reader </span></span></span><span data-slate-object="text" data-key="14329"><span data-slate-leaf="true" data-offset-key="14329:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// underlying reader</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14330"><span data-slate-object="text" data-key="14331"><span data-slate-leaf="true" data-offset-key="14331:0" data-first-offset="true"><span data-slate-string="true">    N </span></span></span><span data-slate-object="text" data-key="14332"><span data-slate-leaf="true" data-offset-key="14332:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int64</span></span></span></span><span data-slate-object="text" data-key="14333"><span data-slate-leaf="true" data-offset-key="14333:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="14334"><span data-slate-leaf="true" data-offset-key="14334:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// max bytes remaining</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14335"><span data-slate-object="text" data-key="14336"><span data-slate-leaf="true" data-offset-key="14336:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14337"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14338"><span data-slate-object="text" data-key="14339"><span data-slate-leaf="true" data-offset-key="14339:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14340"><span data-slate-leaf="true" data-offset-key="14340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14341"><span data-slate-leaf="true" data-offset-key="14341:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(l *LimitedReader)</span></span></span></span></span><span data-slate-object="text" data-key="14342"><span data-slate-leaf="true" data-offset-key="14342:0" data-first-offset="true"><span data-slate-string="true"> Read(p []</span></span></span><span data-slate-object="text" data-key="14343"><span data-slate-leaf="true" data-offset-key="14343:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14344"><span data-slate-leaf="true" data-offset-key="14344:0" data-first-offset="true"><span data-slate-string="true">) (n </span></span></span><span data-slate-object="text" data-key="14345"><span data-slate-leaf="true" data-offset-key="14345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="14346"><span data-slate-leaf="true" data-offset-key="14346:0" data-first-offset="true"><span data-slate-string="true">, err </span></span></span><span data-slate-object="text" data-key="14347"><span data-slate-leaf="true" data-offset-key="14347:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="14348"><span data-slate-leaf="true" data-offset-key="14348:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14349"><span data-slate-object="text" data-key="14350"><span data-slate-leaf="true" data-offset-key="14350:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14351"><span data-slate-leaf="true" data-offset-key="14351:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// ... ...</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14352"><span data-slate-object="text" data-key="14353"><span data-slate-leaf="true" data-offset-key="14353:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14354"><span data-slate-object="text" data-key="14355"><span data-slate-leaf="true" data-offset-key="14355:0" data-first-offset="true"><span data-slate-string="true">通过上面的代码，我们可以看到，通过 LimitReader 函数的包装后，我们得到了一个具有新功能特性的 io.Reader 接口的实现类型，也就是 LimitedReader。这个新类型在 Reader 的语义基础上实现了对读取字节个数的限制。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14356"><span data-slate-object="text" data-key="14357"><span data-slate-leaf="true" data-offset-key="14357:0" data-first-offset="true"><span data-slate-string="true">接下来我们再具体看 LimitReader 的一个使用示例：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14358"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14359"><span data-slate-object="text" data-key="14360"><span data-slate-leaf="true" data-offset-key="14360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14361"><span data-slate-leaf="true" data-offset-key="14361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14362"><span data-slate-leaf="true" data-offset-key="14362:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="14363"><span data-slate-leaf="true" data-offset-key="14363:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="14364"><span data-slate-leaf="true" data-offset-key="14364:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14365"><span data-slate-object="text" data-key="14366"><span data-slate-leaf="true" data-offset-key="14366:0" data-first-offset="true"><span data-slate-string="true">    r := strings.NewReader(</span></span></span><span data-slate-object="text" data-key="14367"><span data-slate-leaf="true" data-offset-key="14367:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hello, gopher!\n"</span></span></span></span><span data-slate-object="text" data-key="14368"><span data-slate-leaf="true" data-offset-key="14368:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14369"><span data-slate-object="text" data-key="14370"><span data-slate-leaf="true" data-offset-key="14370:0" data-first-offset="true"><span data-slate-string="true">    lr := io.LimitReader(r, </span></span></span><span data-slate-object="text" data-key="14371"><span data-slate-leaf="true" data-offset-key="14371:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="14372"><span data-slate-leaf="true" data-offset-key="14372:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14373"><span data-slate-object="text" data-key="14374"><span data-slate-leaf="true" data-offset-key="14374:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14375"><span data-slate-leaf="true" data-offset-key="14375:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14376"><span data-slate-leaf="true" data-offset-key="14376:0" data-first-offset="true"><span data-slate-string="true"> _, err := io.Copy(os.Stdout, lr); err != </span></span></span><span data-slate-object="text" data-key="14377"><span data-slate-leaf="true" data-offset-key="14377:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14378"><span data-slate-leaf="true" data-offset-key="14378:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14379"><span data-slate-object="text" data-key="14380"><span data-slate-leaf="true" data-offset-key="14380:0" data-first-offset="true"><span data-slate-string="true">        log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14381"><span data-slate-object="text" data-key="14382"><span data-slate-leaf="true" data-offset-key="14382:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14383"><span data-slate-object="text" data-key="14384"><span data-slate-leaf="true" data-offset-key="14384:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14385"><span data-slate-object="text" data-key="14386"><span data-slate-leaf="true" data-offset-key="14386:0" data-first-offset="true"><span data-slate-string="true">运行这个示例，我们得到了这个结果：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14387"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14388"><span data-slate-object="text" data-key="14389"><span data-slate-leaf="true" data-offset-key="14389:0" data-first-offset="true"><span data-slate-string="true">hell</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14390"><span data-slate-object="text" data-key="14391"><span data-slate-leaf="true" data-offset-key="14391:0" data-first-offset="true"><span data-slate-string="true">我们看到，当采用经过 LimitReader 包装后返回的 io.Reader 去读取内容时，读到的是经过 LimitedReader 约束后的内容，也就是只读到了原字符串前面的 4 个字节：</span></span></span><span data-slate-object="text" data-key="14392"><span data-slate-leaf="true" data-offset-key="14392:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">“hell”</span></span></span></span><span data-slate-object="text" data-key="14393"><span data-slate-leaf="true" data-offset-key="14393:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14394"><span data-slate-object="text" data-key="14395"><span data-slate-leaf="true" data-offset-key="14395:0" data-first-offset="true"><span data-slate-string="true">由于包装器模式下的包装函数（如上面的 LimitReader）的返回值类型与参数类型相同，因此我们可以将多个接受同一接口类型参数的包装函数组合成一条链来调用，形式是这样的：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14396"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14397"><span data-slate-object="text" data-key="14398"><span data-slate-leaf="true" data-offset-key="14398:0" data-first-offset="true"><span data-slate-string="true">YourWrapperFunc1(YourWrapperFunc2(YourWrapperFunc3(...)))</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14399"><span data-slate-object="text" data-key="14400"><span data-slate-leaf="true" data-offset-key="14400:0" data-first-offset="true"><span data-slate-string="true">我们在上面示例的基础上自定义一个包装函数：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14401"><span data-slate-object="text" data-key="14402"><span data-slate-leaf="true" data-offset-key="14402:0" data-first-offset="true"><span data-slate-string="true">CapReader</span></span></span></span><span data-slate-object="text" data-key="14403"><span data-slate-leaf="true" data-offset-key="14403:0" data-first-offset="true"><span data-slate-string="true">，通过这个函数的包装，我们能得到一个可以将输入的数据转换为大写的 Reader 接口实现：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14404"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14405"><span data-slate-object="text" data-key="14406"><span data-slate-leaf="true" data-offset-key="14406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14407"><span data-slate-leaf="true" data-offset-key="14407:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14408"><span data-slate-leaf="true" data-offset-key="14408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">CapReader</span></span></span></span></span><span data-slate-object="text" data-key="14409"><span data-slate-leaf="true" data-offset-key="14409:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(r io.Reader)</span></span></span></span></span><span data-slate-object="text" data-key="14410"><span data-slate-leaf="true" data-offset-key="14410:0" data-first-offset="true"><span data-slate-string="true"> io.Reader {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14411"><span data-slate-object="text" data-key="14412"><span data-slate-leaf="true" data-offset-key="14412:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14413"><span data-slate-leaf="true" data-offset-key="14413:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14414"><span data-slate-leaf="true" data-offset-key="14414:0" data-first-offset="true"><span data-slate-string="true"> &amp;capitalizedReader{r: r}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14415"><span data-slate-object="text" data-key="14416"><span data-slate-leaf="true" data-offset-key="14416:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14417"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14418"><span data-slate-object="text" data-key="14419"><span data-slate-leaf="true" data-offset-key="14419:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14420"><span data-slate-leaf="true" data-offset-key="14420:0" data-first-offset="true"><span data-slate-string="true"> capitalizedReader </span></span></span><span data-slate-object="text" data-key="14421"><span data-slate-leaf="true" data-offset-key="14421:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">struct</span></span></span></span><span data-slate-object="text" data-key="14422"><span data-slate-leaf="true" data-offset-key="14422:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14423"><span data-slate-object="text" data-key="14424"><span data-slate-leaf="true" data-offset-key="14424:0" data-first-offset="true"><span data-slate-string="true">    r io.Reader</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14425"><span data-slate-object="text" data-key="14426"><span data-slate-leaf="true" data-offset-key="14426:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14427"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14428"><span data-slate-object="text" data-key="14429"><span data-slate-leaf="true" data-offset-key="14429:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14430"><span data-slate-leaf="true" data-offset-key="14430:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14431"><span data-slate-leaf="true" data-offset-key="14431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(r *capitalizedReader)</span></span></span></span></span><span data-slate-object="text" data-key="14432"><span data-slate-leaf="true" data-offset-key="14432:0" data-first-offset="true"><span data-slate-string="true"> Read(p []</span></span></span><span data-slate-object="text" data-key="14433"><span data-slate-leaf="true" data-offset-key="14433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14434"><span data-slate-leaf="true" data-offset-key="14434:0" data-first-offset="true"><span data-slate-string="true">) (</span></span></span><span data-slate-object="text" data-key="14435"><span data-slate-leaf="true" data-offset-key="14435:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="14436"><span data-slate-leaf="true" data-offset-key="14436:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14437"><span data-slate-leaf="true" data-offset-key="14437:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="14438"><span data-slate-leaf="true" data-offset-key="14438:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14439"><span data-slate-object="text" data-key="14440"><span data-slate-leaf="true" data-offset-key="14440:0" data-first-offset="true"><span data-slate-string="true">    n, err := r.r.Read(p)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14441"><span data-slate-object="text" data-key="14442"><span data-slate-leaf="true" data-offset-key="14442:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14443"><span data-slate-leaf="true" data-offset-key="14443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14444"><span data-slate-leaf="true" data-offset-key="14444:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="14445"><span data-slate-leaf="true" data-offset-key="14445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14446"><span data-slate-leaf="true" data-offset-key="14446:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14447"><span data-slate-object="text" data-key="14448"><span data-slate-leaf="true" data-offset-key="14448:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14449"><span data-slate-leaf="true" data-offset-key="14449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14450"><span data-slate-leaf="true" data-offset-key="14450:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14451"><span data-slate-leaf="true" data-offset-key="14451:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="14452"><span data-slate-leaf="true" data-offset-key="14452:0" data-first-offset="true"><span data-slate-string="true">, err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14453"><span data-slate-object="text" data-key="14454"><span data-slate-leaf="true" data-offset-key="14454:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14455"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14456"><span data-slate-object="text" data-key="14457"><span data-slate-leaf="true" data-offset-key="14457:0" data-first-offset="true"><span data-slate-string="true">    q := bytes.ToUpper(p)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14458"><span data-slate-object="text" data-key="14459"><span data-slate-leaf="true" data-offset-key="14459:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14460"><span data-slate-leaf="true" data-offset-key="14460:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="14461"><span data-slate-leaf="true" data-offset-key="14461:0" data-first-offset="true"><span data-slate-string="true"> i, v := </span></span></span><span data-slate-object="text" data-key="14462"><span data-slate-leaf="true" data-offset-key="14462:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="14463"><span data-slate-leaf="true" data-offset-key="14463:0" data-first-offset="true"><span data-slate-string="true"> q {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14464"><span data-slate-object="text" data-key="14465"><span data-slate-leaf="true" data-offset-key="14465:0" data-first-offset="true"><span data-slate-string="true">        p[i] = v</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14466"><span data-slate-object="text" data-key="14467"><span data-slate-leaf="true" data-offset-key="14467:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14468"><span data-slate-object="text" data-key="14469"><span data-slate-leaf="true" data-offset-key="14469:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14470"><span data-slate-leaf="true" data-offset-key="14470:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14471"><span data-slate-leaf="true" data-offset-key="14471:0" data-first-offset="true"><span data-slate-string="true"> n, err</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14472"><span data-slate-object="text" data-key="14473"><span data-slate-leaf="true" data-offset-key="14473:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14474"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14475"><span data-slate-object="text" data-key="14476"><span data-slate-leaf="true" data-offset-key="14476:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14477"><span data-slate-leaf="true" data-offset-key="14477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14478"><span data-slate-leaf="true" data-offset-key="14478:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="14479"><span data-slate-leaf="true" data-offset-key="14479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="14480"><span data-slate-leaf="true" data-offset-key="14480:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14481"><span data-slate-object="text" data-key="14482"><span data-slate-leaf="true" data-offset-key="14482:0" data-first-offset="true"><span data-slate-string="true">    r := strings.NewReader(</span></span></span><span data-slate-object="text" data-key="14483"><span data-slate-leaf="true" data-offset-key="14483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hello, gopher!\n"</span></span></span></span><span data-slate-object="text" data-key="14484"><span data-slate-leaf="true" data-offset-key="14484:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14485"><span data-slate-object="text" data-key="14486"><span data-slate-leaf="true" data-offset-key="14486:0" data-first-offset="true"><span data-slate-string="true">    r1 := CapReader(io.LimitReader(r, </span></span></span><span data-slate-object="text" data-key="14487"><span data-slate-leaf="true" data-offset-key="14487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">4</span></span></span></span><span data-slate-object="text" data-key="14488"><span data-slate-leaf="true" data-offset-key="14488:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14489"><span data-slate-object="text" data-key="14490"><span data-slate-leaf="true" data-offset-key="14490:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14491"><span data-slate-leaf="true" data-offset-key="14491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14492"><span data-slate-leaf="true" data-offset-key="14492:0" data-first-offset="true"><span data-slate-string="true"> _, err := io.Copy(os.Stdout, r1); err != </span></span></span><span data-slate-object="text" data-key="14493"><span data-slate-leaf="true" data-offset-key="14493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14494"><span data-slate-leaf="true" data-offset-key="14494:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14495"><span data-slate-object="text" data-key="14496"><span data-slate-leaf="true" data-offset-key="14496:0" data-first-offset="true"><span data-slate-string="true">        log.Fatal(err)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14497"><span data-slate-object="text" data-key="14498"><span data-slate-leaf="true" data-offset-key="14498:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14499"><span data-slate-object="text" data-key="14500"><span data-slate-leaf="true" data-offset-key="14500:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14501"><span data-slate-object="text" data-key="14502"><span data-slate-leaf="true" data-offset-key="14502:0" data-first-offset="true"><span data-slate-string="true">这里，我们将 CapReader 和 io.LimitReader 串在了一起形成一条调用链，这条调用链的功能变为：截取输入数据的前四个字节并将其转换为大写字母。这个示例的运行结果与我们预期功能也是一致的：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14503"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14504"><span data-slate-object="text" data-key="14505"><span data-slate-leaf="true" data-offset-key="14505:0" data-first-offset="true"><span data-slate-string="true">HELL</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14506" id="sr-toc-11"><span data-slate-object="text" data-key="14507"><span data-slate-leaf="true" data-offset-key="14507:0" data-first-offset="true"><span data-slate-string="true">适配器模式</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14508"><span data-slate-object="text" data-key="14509"><span data-slate-leaf="true" data-offset-key="14509:0" data-first-offset="true"><span data-slate-string="true">适配器模式不是基本模式的直接衍生模式，但这种模式是后面我们讲解中间件模式的前提，所以我们需要简单介绍下这个模式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14510"><span data-slate-object="text" data-key="14511"><span data-slate-leaf="true" data-offset-key="14511:0" data-first-offset="true"><span data-slate-string="true">适配器模式的核心是适配器函数类型（Adapter Function Type）。适配器函数类型是一个辅助水平组合实现的 “工具” 类型。这里我要再强调一下，</span></span></span><span data-slate-object="text" data-key="14512"><span data-slate-leaf="true" data-offset-key="14512:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_08735914" data-attr-id="33710" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">它是一个类型</span></span></span></span></span><span data-slate-object="text" data-key="14513"><span data-slate-leaf="true" data-offset-key="14513:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_08735914" data-attr-id="33710" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">。它可以将一个满足特定函数签名的普通函数，显式转换成自身类型的实例，转换后的实例同时也是某个接口类型的实现者。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14514"><span data-slate-object="text" data-key="14515"><span data-slate-leaf="true" data-offset-key="14515:0" data-first-offset="true"><span data-slate-string="true">最典型的适配器函数类型莫过于我们在第 21 讲中提到过的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14516"><span data-slate-object="text" data-key="14517"><span data-slate-leaf="true" data-offset-key="14517:0" data-first-offset="true"><span data-slate-string="true"> http.HandlerFunc</span></span></span></span><span data-slate-object="text" data-key="14518"><span data-slate-leaf="true" data-offset-key="14518:0" data-first-offset="true"><span data-slate-string="true"> 了。这里，我们再来看一个应用 http.HandlerFunc 的例子：</span></span></span></div><div data-code-language="javascript" data-slate-type="pre" data-slate-object="block" data-key="14519"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14520"><span data-slate-object="text" data-key="14521"><span data-slate-leaf="true" data-offset-key="14521:0" data-first-offset="true"><span data-slate-string="true">func </span></span></span><span data-slate-object="text" data-key="14522"><span data-slate-leaf="true" data-offset-key="14522:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">greetings</span></span></span></span><span data-slate-object="text" data-key="14523"><span data-slate-leaf="true" data-offset-key="14523:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="14524"><span data-slate-leaf="true" data-offset-key="14524:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">w http.ResponseWriter, r *http.Request</span></span></span></span><span data-slate-object="text" data-key="14525"><span data-slate-leaf="true" data-offset-key="14525:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14526"><span data-slate-object="text" data-key="14527"><span data-slate-leaf="true" data-offset-key="14527:0" data-first-offset="true"><span data-slate-string="true">    fmt.</span></span></span><span data-slate-object="text" data-key="14528"><span data-slate-leaf="true" data-offset-key="14528:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">Fprintf</span></span></span></span><span data-slate-object="text" data-key="14529"><span data-slate-leaf="true" data-offset-key="14529:0" data-first-offset="true"><span data-slate-string="true">(w, </span></span></span><span data-slate-object="text" data-key="14530"><span data-slate-leaf="true" data-offset-key="14530:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Welcome!"</span></span></span></span><span data-slate-object="text" data-key="14531"><span data-slate-leaf="true" data-offset-key="14531:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14532"><span data-slate-object="text" data-key="14533"><span data-slate-leaf="true" data-offset-key="14533:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14534"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14535"><span data-slate-object="text" data-key="14536"><span data-slate-leaf="true" data-offset-key="14536:0" data-first-offset="true"><span data-slate-string="true">func </span></span></span><span data-slate-object="text" data-key="14537"><span data-slate-leaf="true" data-offset-key="14537:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span><span data-slate-object="text" data-key="14538"><span data-slate-leaf="true" data-offset-key="14538:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="14539"><span data-slate-leaf="true" data-offset-key="14539:0" data-first-offset="true"><span data-slate-string="true">) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14540"><span data-slate-object="text" data-key="14541"><span data-slate-leaf="true" data-offset-key="14541:0" data-first-offset="true"><span data-slate-string="true">    http.</span></span></span><span data-slate-object="text" data-key="14542"><span data-slate-leaf="true" data-offset-key="14542:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">ListenAndServe</span></span></span></span><span data-slate-object="text" data-key="14543"><span data-slate-leaf="true" data-offset-key="14543:0" data-first-offset="true"><span data-slate-string="true">(</span></span></span><span data-slate-object="text" data-key="14544"><span data-slate-leaf="true" data-offset-key="14544:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span><span data-slate-object="text" data-key="14545"><span data-slate-leaf="true" data-offset-key="14545:0" data-first-offset="true"><span data-slate-string="true">, http.</span></span></span><span data-slate-object="text" data-key="14546"><span data-slate-leaf="true" data-offset-key="14546:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">HandlerFunc</span></span></span></span><span data-slate-object="text" data-key="14547"><span data-slate-leaf="true" data-offset-key="14547:0" data-first-offset="true"><span data-slate-string="true">(greetings))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14548"><span data-slate-object="text" data-key="14549"><span data-slate-leaf="true" data-offset-key="14549:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14550"><span data-slate-object="text" data-key="14551"><span data-slate-leaf="true" data-offset-key="14551:0" data-first-offset="true"><span data-slate-string="true">我们可以看到，这个例子通过 http.HandlerFunc 这个适配器函数类型，将普通函数 greetings 快速转化为满足 http.Handler 接口的类型。而 http.HandleFunc 这个适配器函数类型的定义是这样的：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14552"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14553"><span data-slate-object="text" data-key="14554"><span data-slate-leaf="true" data-offset-key="14554:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/net/http/server.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14555"><span data-slate-object="text" data-key="14556"><span data-slate-leaf="true" data-offset-key="14556:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14557"><span data-slate-leaf="true" data-offset-key="14557:0" data-first-offset="true"><span data-slate-string="true"> Handler </span></span></span><span data-slate-object="text" data-key="14558"><span data-slate-leaf="true" data-offset-key="14558:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="14559"><span data-slate-leaf="true" data-offset-key="14559:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14560"><span data-slate-object="text" data-key="14561"><span data-slate-leaf="true" data-offset-key="14561:0" data-first-offset="true"><span data-slate-string="true">    ServeHTTP(ResponseWriter, *Request)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14562"><span data-slate-object="text" data-key="14563"><span data-slate-leaf="true" data-offset-key="14563:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14564"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14565"><span data-slate-object="text" data-key="14566"><span data-slate-leaf="true" data-offset-key="14566:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14567"><span data-slate-leaf="true" data-offset-key="14567:0" data-first-offset="true"><span data-slate-string="true"> HandlerFunc </span></span></span><span data-slate-object="text" data-key="14568"><span data-slate-leaf="true" data-offset-key="14568:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14569"><span data-slate-leaf="true" data-offset-key="14569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(ResponseWriter, *Request)</span></span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14570"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14571"><span data-slate-object="text" data-key="14572"><span data-slate-leaf="true" data-offset-key="14572:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14573"><span data-slate-leaf="true" data-offset-key="14573:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14574"><span data-slate-leaf="true" data-offset-key="14574:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(f HandlerFunc)</span></span></span></span></span><span data-slate-object="text" data-key="14575"><span data-slate-leaf="true" data-offset-key="14575:0" data-first-offset="true"><span data-slate-string="true"> ServeHTTP(w ResponseWriter, r *Request) {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14576"><span data-slate-object="text" data-key="14577"><span data-slate-leaf="true" data-offset-key="14577:0" data-first-offset="true"><span data-slate-string="true">    f(w, r)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14578"><span data-slate-object="text" data-key="14579"><span data-slate-leaf="true" data-offset-key="14579:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14580"><span data-slate-object="text" data-key="14581"><span data-slate-leaf="true" data-offset-key="14581:0" data-first-offset="true"><span data-slate-string="true">经过 HandlerFunc 的适配转化后，我们就可以将它的实例用作实参，传递给接收 http.Handler 接口的 http.ListenAndServe 函数，从而实现基于接口的组合。</span></span></span></div><h3 data-slate-type="heading" data-slate-object="block" data-key="14582" id="sr-toc-12"><span data-slate-object="text" data-key="14583"><span data-slate-leaf="true" data-offset-key="14583:0" data-first-offset="true"><span data-slate-string="true">中间件（Middleware）</span></span></span></h3><div data-slate-type="paragraph" data-slate-object="block" data-key="14584"><span data-slate-object="text" data-key="14585"><span data-slate-leaf="true" data-offset-key="14585:0" data-first-offset="true"><span data-slate-string="true">最后，我们来介绍下中间件这个应用模式。中间件（Middleware）这个词的含义可大可小。在 Go Web 编程中，</span></span><span data-slate-leaf="true" data-offset-key="14585:1"><span data-slate-object="annotation" data-annotation-key="gkann_5b39e5fe" data-attr-id="37838" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">“中间件” 常常指的是一个实现了 http.Handler 接口的 http.HandlerFunc 类型实例。</span></span></span><span data-slate-leaf="true" data-offset-key="14585:2"><span data-slate-string="true">实质上，这里的</span></span></span><span data-slate-object="text" data-key="14586"><span data-slate-leaf="true" data-offset-key="14586:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">中间件就是包装模式和适配器模式结合的产物</span></span></span></span><span data-slate-object="text" data-key="14587"><span data-slate-leaf="true" data-offset-key="14587:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14588"><span data-slate-object="text" data-key="14589"><span data-slate-leaf="true" data-offset-key="14589:0" data-first-offset="true"><span data-slate-string="true">我们来看一个例子：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14590"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div><div data-code-line-number="32"></div><div data-code-line-number="33"></div><div data-code-line-number="34"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14591"><span data-slate-object="text" data-key="14592"><span data-slate-leaf="true" data-offset-key="14592:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14593"><span data-slate-leaf="true" data-offset-key="14593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14594"><span data-slate-leaf="true" data-offset-key="14594:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">validateAuth</span></span></span></span></span><span data-slate-object="text" data-key="14595"><span data-slate-leaf="true" data-offset-key="14595:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(s </span></span></span></span></span><span data-slate-object="text" data-key="14596"><span data-slate-leaf="true" data-offset-key="14596:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="14597"><span data-slate-leaf="true" data-offset-key="14597:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="14598"><span data-slate-leaf="true" data-offset-key="14598:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14599"><span data-slate-leaf="true" data-offset-key="14599:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="14600"><span data-slate-leaf="true" data-offset-key="14600:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14601"><span data-slate-object="text" data-key="14602"><span data-slate-leaf="true" data-offset-key="14602:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14603"><span data-slate-leaf="true" data-offset-key="14603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14604"><span data-slate-leaf="true" data-offset-key="14604:0" data-first-offset="true"><span data-slate-string="true"> s != </span></span></span><span data-slate-object="text" data-key="14605"><span data-slate-leaf="true" data-offset-key="14605:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"123456"</span></span></span></span><span data-slate-object="text" data-key="14606"><span data-slate-leaf="true" data-offset-key="14606:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14607"><span data-slate-object="text" data-key="14608"><span data-slate-leaf="true" data-offset-key="14608:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14609"><span data-slate-leaf="true" data-offset-key="14609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14610"><span data-slate-leaf="true" data-offset-key="14610:0" data-first-offset="true"><span data-slate-string="true"> fmt.Errorf(</span></span></span><span data-slate-object="text" data-key="14611"><span data-slate-leaf="true" data-offset-key="14611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"%s"</span></span></span></span><span data-slate-object="text" data-key="14612"><span data-slate-leaf="true" data-offset-key="14612:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="14613"><span data-slate-leaf="true" data-offset-key="14613:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bad auth token"</span></span></span></span><span data-slate-object="text" data-key="14614"><span data-slate-leaf="true" data-offset-key="14614:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14615"><span data-slate-object="text" data-key="14616"><span data-slate-leaf="true" data-offset-key="14616:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14617"><span data-slate-object="text" data-key="14618"><span data-slate-leaf="true" data-offset-key="14618:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14619"><span data-slate-leaf="true" data-offset-key="14619:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14620"><span data-slate-leaf="true" data-offset-key="14620:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14621"><span data-slate-leaf="true" data-offset-key="14621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14622"><span data-slate-object="text" data-key="14623"><span data-slate-leaf="true" data-offset-key="14623:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14624"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14625"><span data-slate-object="text" data-key="14626"><span data-slate-leaf="true" data-offset-key="14626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14627"><span data-slate-leaf="true" data-offset-key="14627:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14628"><span data-slate-leaf="true" data-offset-key="14628:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">greetings</span></span></span></span></span><span data-slate-object="text" data-key="14629"><span data-slate-leaf="true" data-offset-key="14629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(w http.ResponseWriter, r *http.Request)</span></span></span></span></span><span data-slate-object="text" data-key="14630"><span data-slate-leaf="true" data-offset-key="14630:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14631"><span data-slate-object="text" data-key="14632"><span data-slate-leaf="true" data-offset-key="14632:0" data-first-offset="true"><span data-slate-string="true">    fmt.Fprintf(w, </span></span></span><span data-slate-object="text" data-key="14633"><span data-slate-leaf="true" data-offset-key="14633:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"Welcome!"</span></span></span></span><span data-slate-object="text" data-key="14634"><span data-slate-leaf="true" data-offset-key="14634:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14635"><span data-slate-object="text" data-key="14636"><span data-slate-leaf="true" data-offset-key="14636:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14637"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14638"><span data-slate-object="text" data-key="14639"><span data-slate-leaf="true" data-offset-key="14639:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14640"><span data-slate-leaf="true" data-offset-key="14640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14641"><span data-slate-leaf="true" data-offset-key="14641:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">logHandler</span></span></span></span></span><span data-slate-object="text" data-key="14642"><span data-slate-leaf="true" data-offset-key="14642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(h http.Handler)</span></span></span></span></span><span data-slate-object="text" data-key="14643"><span data-slate-leaf="true" data-offset-key="14643:0" data-first-offset="true"><span data-slate-string="true"> http.Handler {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14644"><span data-slate-object="text" data-key="14645"><span data-slate-leaf="true" data-offset-key="14645:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14646"><span data-slate-leaf="true" data-offset-key="14646:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14647"><span data-slate-leaf="true" data-offset-key="14647:0" data-first-offset="true"><span data-slate-string="true"> http.HandlerFunc(</span></span></span><span data-slate-object="text" data-key="14648"><span data-slate-leaf="true" data-offset-key="14648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14649"><span data-slate-leaf="true" data-offset-key="14649:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(w http.ResponseWriter, r *http.Request)</span></span></span></span></span><span data-slate-object="text" data-key="14650"><span data-slate-leaf="true" data-offset-key="14650:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14651"><span data-slate-object="text" data-key="14652"><span data-slate-leaf="true" data-offset-key="14652:0" data-first-offset="true"><span data-slate-string="true">        t := time.Now()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14653"><span data-slate-object="text" data-key="14654"><span data-slate-leaf="true" data-offset-key="14654:0" data-first-offset="true"><span data-slate-string="true">        log.Printf(</span></span></span><span data-slate-object="text" data-key="14655"><span data-slate-leaf="true" data-offset-key="14655:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"[%s] %q %v\n"</span></span></span></span><span data-slate-object="text" data-key="14656"><span data-slate-leaf="true" data-offset-key="14656:0" data-first-offset="true"><span data-slate-string="true">, r.Method, r.URL.String(), t)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14657"><span data-slate-object="text" data-key="14658"><span data-slate-leaf="true" data-offset-key="14658:0" data-first-offset="true"><span data-slate-string="true">        h.ServeHTTP(w, r)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14659"><span data-slate-object="text" data-key="14660"><span data-slate-leaf="true" data-offset-key="14660:0" data-first-offset="true"><span data-slate-string="true">    })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14661"><span data-slate-object="text" data-key="14662"><span data-slate-leaf="true" data-offset-key="14662:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14663"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14664"><span data-slate-object="text" data-key="14665"><span data-slate-leaf="true" data-offset-key="14665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14666"><span data-slate-leaf="true" data-offset-key="14666:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14667"><span data-slate-leaf="true" data-offset-key="14667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">authHandler</span></span></span></span></span><span data-slate-object="text" data-key="14668"><span data-slate-leaf="true" data-offset-key="14668:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(h http.Handler)</span></span></span></span></span><span data-slate-object="text" data-key="14669"><span data-slate-leaf="true" data-offset-key="14669:0" data-first-offset="true"><span data-slate-string="true"> http.Handler {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14670"><span data-slate-object="text" data-key="14671"><span data-slate-leaf="true" data-offset-key="14671:0" data-first-offset="true"><span data-slate-string="true">    </span></span></span><span data-slate-object="text" data-key="14672"><span data-slate-leaf="true" data-offset-key="14672:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14673"><span data-slate-leaf="true" data-offset-key="14673:0" data-first-offset="true"><span data-slate-string="true"> http.HandlerFunc(</span></span></span><span data-slate-object="text" data-key="14674"><span data-slate-leaf="true" data-offset-key="14674:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14675"><span data-slate-leaf="true" data-offset-key="14675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(w http.ResponseWriter, r *http.Request)</span></span></span></span></span><span data-slate-object="text" data-key="14676"><span data-slate-leaf="true" data-offset-key="14676:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14677"><span data-slate-object="text" data-key="14678"><span data-slate-leaf="true" data-offset-key="14678:0" data-first-offset="true"><span data-slate-string="true">        err := validateAuth(r.Header.Get(</span></span></span><span data-slate-object="text" data-key="14679"><span data-slate-leaf="true" data-offset-key="14679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"auth"</span></span></span></span><span data-slate-object="text" data-key="14680"><span data-slate-leaf="true" data-offset-key="14680:0" data-first-offset="true"><span data-slate-string="true">))</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14681"><span data-slate-object="text" data-key="14682"><span data-slate-leaf="true" data-offset-key="14682:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14683"><span data-slate-leaf="true" data-offset-key="14683:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="14684"><span data-slate-leaf="true" data-offset-key="14684:0" data-first-offset="true"><span data-slate-string="true"> err != </span></span></span><span data-slate-object="text" data-key="14685"><span data-slate-leaf="true" data-offset-key="14685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="14686"><span data-slate-leaf="true" data-offset-key="14686:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14687"><span data-slate-object="text" data-key="14688"><span data-slate-leaf="true" data-offset-key="14688:0" data-first-offset="true"><span data-slate-string="true">            http.Error(w, </span></span></span><span data-slate-object="text" data-key="14689"><span data-slate-leaf="true" data-offset-key="14689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"bad auth param"</span></span></span></span><span data-slate-object="text" data-key="14690"><span data-slate-leaf="true" data-offset-key="14690:0" data-first-offset="true"><span data-slate-string="true">, http.StatusUnauthorized)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14691"><span data-slate-object="text" data-key="14692"><span data-slate-leaf="true" data-offset-key="14692:0" data-first-offset="true"><span data-slate-string="true">            </span></span></span><span data-slate-object="text" data-key="14693"><span data-slate-leaf="true" data-offset-key="14693:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14694"><span data-slate-object="text" data-key="14695"><span data-slate-leaf="true" data-offset-key="14695:0" data-first-offset="true"><span data-slate-string="true">        }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14696"><span data-slate-object="text" data-key="14697"><span data-slate-leaf="true" data-offset-key="14697:0" data-first-offset="true"><span data-slate-string="true">        h.ServeHTTP(w, r)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14698"><span data-slate-object="text" data-key="14699"><span data-slate-leaf="true" data-offset-key="14699:0" data-first-offset="true"><span data-slate-string="true">    })</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14700"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14701"><span data-slate-object="text" data-key="14702"><span data-slate-leaf="true" data-offset-key="14702:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14703"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14704"><span data-slate-object="text" data-key="14705"><span data-slate-leaf="true" data-offset-key="14705:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="14706"><span data-slate-leaf="true" data-offset-key="14706:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="14707"><span data-slate-leaf="true" data-offset-key="14707:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">main</span></span></span></span></span><span data-slate-object="text" data-key="14708"><span data-slate-leaf="true" data-offset-key="14708:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">()</span></span></span></span></span><span data-slate-object="text" data-key="14709"><span data-slate-leaf="true" data-offset-key="14709:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14710"><span data-slate-object="text" data-key="14711"><span data-slate-leaf="true" data-offset-key="14711:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_3b7646fb" data-attr-id="33210" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">    http.ListenAndServe(</span></span></span></span><span data-slate-object="text" data-key="14712"><span data-slate-leaf="true" data-offset-key="14712:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_3b7646fb" data-attr-id="33210" data-attr-name="public" data-annotation-type="public"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">":8080"</span></span></span></span></span><span data-slate-object="text" data-key="14713"><span data-slate-leaf="true" data-offset-key="14713:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_3b7646fb" data-attr-id="33210" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">, logHandler(authHandler(http.HandlerFunc(greetings))))</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14714"><span data-slate-object="text" data-key="14715"><span data-slate-leaf="true" data-offset-key="14715:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14716"><span data-slate-object="text" data-key="14717"><span data-slate-leaf="true" data-offset-key="14717:0" data-first-offset="true"><span data-slate-string="true">我们看到，</span></span><span data-slate-leaf="true" data-offset-key="14717:1"><span data-slate-object="annotation" data-annotation-key="gkann_ac74dadf" data-attr-id="34193" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">所谓中间件（如：logHandler、authHandler）本质就是一个包装函数（支持链式调用），但它的内部利用了适配器函数类型（http.HandlerFunc），将一个普通函数（比如例子中的几个匿名函数）转型为实现了 http.Handler 的类型的实例。</span></span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14718"><span data-slate-object="text" data-key="14719"><span data-slate-leaf="true" data-offset-key="14719:0" data-first-offset="true"><span data-slate-string="true">运行这个示例，并用 curl 工具命令对其进行测试，我们可以得到下面结果：</span></span></span></div><div data-code-language="shell" data-slate-type="pre" data-slate-object="block" data-key="14720"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14721"><span data-slate-object="text" data-key="14722"><span data-slate-leaf="true" data-offset-key="14722:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$</span></span></span></span><span data-slate-object="text" data-key="14723"><span data-slate-leaf="true" data-offset-key="14723:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">curl http://localhost:8080</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14724"><span data-slate-object="text" data-key="14725"><span data-slate-leaf="true" data-offset-key="14725:0" data-first-offset="true"><span data-slate-string="true">bad auth param</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14726"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14727"><span data-slate-object="text" data-key="14728"><span data-slate-leaf="true" data-offset-key="14728:0" data-first-offset="true"><span data-slate-string="true">$</span></span></span><span data-slate-object="text" data-key="14729"><span data-slate-leaf="true" data-offset-key="14729:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">curl -H </span></span></span></span><span data-slate-object="text" data-key="14730"><span data-slate-leaf="true" data-offset-key="14730:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"auth:123456"</span></span></span></span></span><span data-slate-object="text" data-key="14731"><span data-slate-leaf="true" data-offset-key="14731:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> localhost:8080/</span></span></span></span><span data-slate-object="text" data-key="14732"><span data-slate-leaf="true" data-offset-key="14732:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14733"><span data-slate-object="text" data-key="14734"><span data-slate-leaf="true" data-offset-key="14734:0" data-first-offset="true"><span data-slate-string="true">Welcome!</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14735"><span data-slate-object="text" data-key="14736"><span data-slate-leaf="true" data-offset-key="14736:0" data-first-offset="true"><span data-slate-string="true">从测试结果上看，中间件 authHandler 起到了对 HTTP 请求进行鉴权的作用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14737"><span data-slate-object="text" data-key="14738"><span data-slate-leaf="true" data-offset-key="14738:0" data-first-offset="true"><span data-slate-string="true">好了，到这里我们完成了对接口的一个基本使用模式以及三个衍生模式的学习，深刻理解并灵活运用这些接口使用模式将给你的应用设计带来显著的提升。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14739" id="sr-toc-13"><span data-slate-object="text" data-key="14740"><span data-slate-leaf="true" data-offset-key="14740:0" data-first-offset="true"><span data-slate-string="true">尽量避免使用空接口作为函数参数类型</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14741"><span data-slate-object="text" data-key="14742"><span data-slate-leaf="true" data-offset-key="14742:0" data-first-offset="true"><span data-slate-string="true">最后，我再来说一下接口使用的注意事项，这个注意事项与空接口有关。Go 语言之父 Rob Pike 曾说过：</span></span></span><span data-slate-object="text" data-key="14743"><span data-slate-leaf="true" data-offset-key="14743:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">空接口不提供任何信息（The empty interface says nothing）</span></span></span></span><span data-slate-object="text" data-key="14744"><span data-slate-leaf="true" data-offset-key="14744:0" data-first-offset="true"><span data-slate-string="true">。我们应该怎么理解这句话的深层含义呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14745"><span data-slate-object="text" data-key="14746"><span data-slate-leaf="true" data-offset-key="14746:0" data-first-offset="true"><span data-slate-string="true">在 Go 语言中，一方面你不用像 Java 那样显式声明某个类型实现了某个接口，但另一方面，你又必须声明这个接口，这又与接口在 Java 等静态类型语言中的工作方式更加一致。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14747"><span data-slate-object="text" data-key="14748"><span data-slate-leaf="true" data-offset-key="14748:0" data-first-offset="true"><span data-slate-string="true">这种不需要类型显式声明实现了某个接口的方式，可以让种类繁多的类型与接口匹配，包括那些存量的、并非由你编写的代码以及你无法编辑的代码（比如：标准库）。Go 的这种处理方式兼顾安全性和灵活性，其中，这个安全性就是由 Go 编译器来保证的，而为编译器提供输入信息的恰恰是接口类型的定义。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14749"><span data-slate-object="text" data-key="14750"><span data-slate-leaf="true" data-offset-key="14750:0" data-first-offset="true"><span data-slate-string="true">比如我们看下面的接口：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="14751"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14752"><span data-slate-object="text" data-key="14753"><span data-slate-leaf="true" data-offset-key="14753:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// $GOROOT/src/io/io.go</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14754"><span data-slate-object="text" data-key="14755"><span data-slate-leaf="true" data-offset-key="14755:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="14756"><span data-slate-leaf="true" data-offset-key="14756:0" data-first-offset="true"><span data-slate-string="true"> Reader </span></span></span><span data-slate-object="text" data-key="14757"><span data-slate-leaf="true" data-offset-key="14757:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="14758"><span data-slate-leaf="true" data-offset-key="14758:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14759"><span data-slate-object="text" data-key="14760"><span data-slate-leaf="true" data-offset-key="14760:0" data-first-offset="true"><span data-slate-string="true">  Read(p []</span></span></span><span data-slate-object="text" data-key="14761"><span data-slate-leaf="true" data-offset-key="14761:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="14762"><span data-slate-leaf="true" data-offset-key="14762:0" data-first-offset="true"><span data-slate-string="true">) (n </span></span></span><span data-slate-object="text" data-key="14763"><span data-slate-leaf="true" data-offset-key="14763:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span><span data-slate-object="text" data-key="14764"><span data-slate-leaf="true" data-offset-key="14764:0" data-first-offset="true"><span data-slate-string="true">, err </span></span></span><span data-slate-object="text" data-key="14765"><span data-slate-leaf="true" data-offset-key="14765:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span><span data-slate-object="text" data-key="14766"><span data-slate-leaf="true" data-offset-key="14766:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14767"><span data-slate-object="text" data-key="14768"><span data-slate-leaf="true" data-offset-key="14768:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14769"><span data-slate-object="text" data-key="14770"><span data-slate-leaf="true" data-offset-key="14770:0" data-first-offset="true"><span data-slate-string="true">Go 编译器通过解析这个接口定义，得到接口的名字信息以及它的方法信息，在为这个接口类型参数赋值时，编译器就会根据这些信息对实参进行检查。这时你可以想一下，如果函数或方法的参数类型为空接口</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14771"><span data-slate-object="text" data-key="14772"><span data-slate-leaf="true" data-offset-key="14772:0" data-first-offset="true"><span data-slate-string="true"> interface{}</span></span></span></span><span data-slate-object="text" data-key="14773"><span data-slate-leaf="true" data-offset-key="14773:0" data-first-offset="true"><span data-slate-string="true">，会发生什么呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14774"><span data-slate-object="text" data-key="14775"><span data-slate-leaf="true" data-offset-key="14775:0" data-first-offset="true"><span data-slate-string="true">这恰好就应了 Rob Pike 的那句话：“空接口不提供任何信息”。这里 “提供” 一词的对象不是开发者，</span></span><span data-slate-leaf="true" data-offset-key="14775:1"><span data-slate-object="annotation" data-annotation-key="gkann_9a7360fd" data-attr-id="34667" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">而是编译器。在函数或方法参数中使用空接口类型，就意味着你没有为编译器提供关于传入实参数据的任何信息，</span></span></span><span data-slate-leaf="true" data-offset-key="14775:2"><span data-slate-string="true">所以，你就会失去静态类型语言类型安全检查的</span></span></span><span data-slate-object="text" data-key="14776"><span data-slate-leaf="true" data-offset-key="14776:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> “保护屏障”</span></span></span></span><span data-slate-object="text" data-key="14777"><span data-slate-leaf="true" data-offset-key="14777:0" data-first-offset="true"><span data-slate-string="true">，你需要自己检查类似的错误，并且直到运行时才能发现此类错误。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14778"><span data-slate-object="text" data-key="14779"><span data-slate-leaf="true" data-offset-key="14779:0" data-first-offset="true"><span data-slate-string="true">所以，我建议广大 Gopher 尽可能地抽象出带有一定行为契约的接口，并将它作为函数参数类型，</span></span></span><span data-slate-object="text" data-key="14780"><span data-slate-leaf="true" data-offset-key="14780:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">尽量不要使用可以 “逃过” 编译器类型安全检查的空接口类型（interface {}）</span></span></span></span><span data-slate-object="text" data-key="14781"><span data-slate-leaf="true" data-offset-key="14781:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14782"><span data-slate-object="text" data-key="14783"><span data-slate-leaf="true" data-offset-key="14783:0" data-first-offset="true"><span data-slate-string="true">在这方面，Go 标准库已经为我们作出了” 表率 “。全面搜索标准库后，你可以发现以</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14784"><span data-slate-object="text" data-key="14785"><span data-slate-leaf="true" data-offset-key="14785:0" data-first-offset="true"><span data-slate-string="true"> interface{}</span></span></span></span><span data-slate-object="text" data-key="14786"><span data-slate-leaf="true" data-offset-key="14786:0" data-first-offset="true"><span data-slate-string="true"> 为参数类型的方法和函数少之甚少。不过，也还有，使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14787"><span data-slate-object="text" data-key="14788"><span data-slate-leaf="true" data-offset-key="14788:0" data-first-offset="true"><span data-slate-string="true"> interface{}</span></span></span></span><span data-slate-object="text" data-key="14789"><span data-slate-leaf="true" data-offset-key="14789:0" data-first-offset="true"><span data-slate-string="true"> 作为参数类型的函数或方法主要有两类：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14790"><div data-slate-type="list-line" data-slate-object="block" data-key="14791"><span data-slate-object="text" data-key="14792"><span data-slate-leaf="true" data-offset-key="14792:0" data-first-offset="true"><span data-slate-string="true">容器算法类，比如：container 下的 heap、list 和 ring 包、sort 包、sync.Map 等；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14793"><span data-slate-object="text" data-key="14794"><span data-slate-leaf="true" data-offset-key="14794:0" data-first-offset="true"><span data-slate-string="true">格式化 / 日志类，比如：fmt 包、log 包等。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14795"><span data-slate-object="text" data-key="14796"><span data-slate-leaf="true" data-offset-key="14796:0" data-first-offset="true"><span data-slate-string="true">这些使用</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14797"><span data-slate-object="text" data-key="14798"><span data-slate-leaf="true" data-offset-key="14798:0" data-first-offset="true"><span data-slate-string="true"> interface{}</span></span></span></span><span data-slate-object="text" data-key="14799"><span data-slate-leaf="true" data-offset-key="14799:0" data-first-offset="true"><span data-slate-string="true"> 作为参数类型的函数或方法都有一个共同特点，就是它们面对的都是未知类型的数据，所以在这里使用具有 “泛型” 能力的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14800"><span data-slate-object="text" data-key="14801"><span data-slate-leaf="true" data-offset-key="14801:0" data-first-offset="true"><span data-slate-string="true"> interface {} 类型。</span></span></span></span><span data-slate-object="text" data-key="14802"><span data-slate-leaf="true" data-offset-key="14802:0" data-first-offset="true"><span data-slate-string="true">我们也可以理解为是在 Go 语言尚未支持泛型的这个阶段的权宜之计。等 Go 泛型落地后，很多场合下 interface {} 就可以被泛型替代了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14803" id="sr-toc-14"><span data-slate-object="text" data-key="14804"><span data-slate-leaf="true" data-offset-key="14804:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14805"><span data-slate-object="text" data-key="14806"><span data-slate-leaf="true" data-offset-key="14806:0" data-first-offset="true"><span data-slate-string="true">好了，今天的课讲到这里就结束了，现在我们一起来回顾一下吧。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14807"><span data-slate-object="text" data-key="14808"><span data-slate-leaf="true" data-offset-key="14808:0" data-first-offset="true"><span data-slate-string="true">在这一讲中，我们主要围绕接口的应用模式进行讲解。你在使用接口前一定要搞清楚自己使用接口的原因，千万不能为了使用接口而使用接口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14809"><span data-slate-object="text" data-key="14810"><span data-slate-leaf="true" data-offset-key="14810:0" data-first-offset="true"><span data-slate-string="true">接口与 Go 的 “组合” 的设计哲学息息相关。在 Go 语言中，组合是 Go 程序间各个部分的主要耦合方式。垂直组合可实现方法实现和接口定义的重用，更多用于在新类型的定义方面。而水平组合更多将接口作为 “关节”，将各个垂直组合出的类型 “耦合” 在一起，从而编制出程序的静态骨架。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14811"><span data-slate-object="text" data-key="14812"><span data-slate-leaf="true" data-offset-key="14812:0" data-first-offset="true"><span data-slate-string="true">通过接口进行水平组合的基本模式，是 “使用接受接口类型参数的函数或方法”，在这一基本模式的基础上，我们还学习了几个衍生模式：创建模式、包装器模式与中间件模式。此外，我们还学习了一个辅助水平组合实现的 “工具” 类型：适配器函数类型，它也是实现中间件模式的前提。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14813"><span data-slate-object="text" data-key="14814"><span data-slate-leaf="true" data-offset-key="14814:0" data-first-offset="true"><span data-slate-string="true">最后需要我们牢记的是：我们要</span></span></span><span data-slate-object="text" data-key="14815"><span data-slate-leaf="true" data-offset-key="14815:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">尽量避免使用空接口作为函数参数类型。</span></span></span></span><span data-slate-object="text" data-key="14816"><span data-slate-leaf="true" data-offset-key="14816:0" data-first-offset="true"><span data-slate-string="true">一旦使用空接口作为函数参数类型，你将失去编译器为你提供的类型安全保护屏障。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14817" id="sr-toc-15"><span data-slate-object="text" data-key="14818"><span data-slate-leaf="true" data-offset-key="14818:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14819"><span data-slate-object="text" data-key="14820"><span data-slate-leaf="true" data-offset-key="14820:0" data-first-offset="true"><span data-slate-string="true">除了这一讲中介绍的接口应用模式，你还见过或使用过哪些接口应用模式呢？期待在留言区看到你的分享。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14821"><span data-slate-object="text" data-key="14822"><span data-slate-leaf="true" data-offset-key="14822:0" data-first-offset="true"><span data-slate-string="true">欢迎把这节课分享给更多对 Go 语言的接口感兴趣的朋友。我是 Tony Bai，下节课见。</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><span>27</span> 人觉得很赞<a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1f/81/1f6c18433af717a740f1e49389f2f981.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-16">精选留言 (22)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>return</span></div></div><div>老师讲的太好了，虽然定位是入门， 
但个人认为， 基础才是最核心的， 老师把基础讲的太透彻了。这个专栏比某些进阶高阶专栏好多了。
这一篇 加深了 我对组合的理解，
感谢老师用心的输出。
好饭不怕晚， 耐心等等老师后续的 高质量知识， 大家别催，品质第一。</div><div><p>作者回复: 👍</p></div><div><div>2021-12-31</div><div><div><i></i></div><div><i></i><span>21</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>aoe</span></div></div><div>Go 中的接口实现的是真里氏替换原则 (LSP)，再也不用担心父类强转子类后使用子类特有方法的假里氏替换原则了</div><div><p>作者回复: 👍</p></div><div><div>2022-01-03</div><div><div><i></i><span>6</span></div><div><i></i><span>6</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep7c7UKsjRiclaAqD9vMHSUXayzrvRhvic3Lm6ibX82L3DibJnCCtDmB3OfxbuVjetpT6Qa8IuwqZCWlw/132"></div></div><div><div><div><span>Geek_2337af</span></div></div><div>在学习上遇到一个问题，请老师解答：
IntSet 类型的 String 方法的接收者是一个指针类型，所以我们不能在一个不能寻址的 IntSet 值上调用这个方法
type IntSet struct {/* ... */}
func (*IntSet) String () string
var _ = IntSet {}.String () //compile error: String requires *IntSet receiver
但是我们可以在一个 IntSet 值上调用这个方法：
var s IntSet
var _ = s.String () // OK: s is a variable and &amp;s has a String method
1. 怎么理解这个不能寻址的 IntSet 值
2. 调用方法的习惯是直接使用结构体变量（var i InSet），还是 j := InSet {}, 假设方法中不需要使用到这个实例</div><div><p>作者回复：好问题！👍

1. go 规范中说： 只有可寻址的 (addressable) 的变量在调用 * T 作为 receiver 参数类型的方法时，Go 才会施展 “语法糖”，取其地址再调用对应的方法。关于 addressable 这个概念比较复杂，在专栏里不便展开，就没有提。var _ = IntSet {}.String () 中的 IntSet () 是一个中间值，是不可获得其地址的，因此不能被自动转换，因此编译器报错。
2. 调用方法的习惯没有标准😁</p></div><div><div>2022-02-18</div><div><div><i></i></div><div><i></i><span>4</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/13/0c/46/dfe32cf4.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 多选参数</span></div></div><div>特别喜欢白老师讲 Go，这个专栏虽然说是 Go 第一课，但是感觉这内容已经不是基础的内容，而是作为深度入门 Go 的课了。另外，整篇专栏中，老师始终在不断给我讲 Go 的思想，这点真的超 nice。原本我觉得用一门要用它特有的东西，比如 Go 的并发，而白老师让我更深入去理解 Go 的思想，这才是活用一门语言的样子。</div><div><p>作者回复: 👍</p></div><div><div>2022-01-25</div><div><div><i></i></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ic8eLTo5rnqIMJicUfpkVBrOUJAW4fANicKIbHdC54O9SOdwSoeK6o8icibaUbh7ZUXAkGF9zwHqo0Q/132"></div></div><div><div><div><span>ivhong</span></div></div><div>包装器的概念是不是也有点 “中间件” 的意思 ：）
比如 capitalizedReader 中的，是后置中间件，处理输出的，如果改成下面的实现，就是前置中间件，在输入前处理的。
func (r *capitalizedReader) Read (p [] byte) (int, error) {
	//do some thing
	n, err := r.r.Read (p)
	return n, err
}</div><div><p>作者回复：包装器是实现 “middleware” 的基础。</p></div><div><div>2022-03-11</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5c/da/0a8bc27b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 文经</span></div></div><div>白老师，这段代码我有点疑问：
type HandlerFunc func (ResponseWriter, *Request) 
这里是定义了 HandlerFunc 类型
http.HandlerFunc (greetings)
在这里是不是对 greetings 做了类型转换？像是 int64 (123)。我把这个跟对象的初始化有点混淆，觉得要有个字段来存储 greetings 的值。</div><div><p>作者回复：你的理解没错！这个在专栏前面的课程中也讲过，这里就是一个类型转换。通过类型转换，HandlerFunc 可以让一个普通函数成为实现 ServeHTTP 方法的对象，从而满足 http.Handler 接口。</p></div><div><div>2022-01-16</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Calvin</span></div></div><div>Gopher 这里说的 “中间件” 和 PHPer 的 “中间件” 概念是不是有点像？
但是貌似跟 Javaer 的 “中间件” 概念不太一样：Javaer 的 “中间件” 是类似 kafka、zookeeper 等之类的软件项目，而 Gopher 的 “中间件” 感觉更像是 Javaer 中的 “过滤器”、“拦截器” 概念？</div><div><p>作者回复：你说的没错。中间件 (middleware) 这个词的具体含义要结合具体上下文来看。</p></div><div><div>2022-01-05</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>$ 侯</span></div></div><div>以前一些对接口不懂的知识点，经过老师的讲解后变得豁然开朗，实在是厉害！</div><div><p>作者回复: 👍</p></div><div><div>2021-12-31</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/4d/26/44095eba.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span> 贱贱的梦想</span></div></div><div>先生循循善诱，看的学生直呼过瘾</div><div><p>作者回复: 👍</p></div><div><div>2022-08-04</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/28/04/15/841ab52b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>kwai 华</span></div></div><div>“在整个测试过程中，我们不需要创建任何磁盘文件或建立任何网络连接。” 老师这一句没太明白，如果有传结构体的测试 case 对着看应该更清晰一点</div><div><p>作者回复：对 save 进行测试，通常需要保存到文件或网络存储中。但由于采用了 io.Writer 类型参数对写入目标进行了抽象，我们将 save 动作与实际目标子做了解耦合。因此在这个测试中我们无需真正创建任何磁盘文件或加了你任何网络连接 (连接网络存储)，仅需构造了一个满足 io.Writer 接口的实例即可完成对 save 逻辑的测试。</p></div><div><div>2022-07-24</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Demon.Lee</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>感觉空接口该用还得用，比如这里的参数 v：

func response (w http.ResponseWriter, v interface {}) {
	data, err := json.Marshal (v)
	if err != nil {
		http.Error (w, err.Error (), http.StatusInternalServerError)
		return
	}
	w.Header ().Set ("Content-Type", "application/json")
	w.Write (data)
}

现在 go1.18 有了范型，但这里好像还得这么传参数 v，因为它可能是各种结构体类型，老师有更好的方案吗，谢谢。</div><div><p>作者回复：这段代码如果非要传入 non-empty interface，就有些矫情了。

当然你这里使用 v interface {}，其实是得益于标准库 json 的 Marshal 的参数类型是 interface {}。

如果你非要限制 response 用户传入参数的类型，这里将其视为 strict 模式，那么

那么第二个参数是否可以改为 v json.Marshaler，这样对传入的参数做了 strict 约束。当然这种改法对使用者来说，体验不
  好。尤其是传入原生类型实例时，比如 int。
  
  当然泛型引入后，可以用泛型约束来修饰参数 v。将允许传入的类型放入约束中。</p></div><div><div>2022-07-09</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1b/76/a4/964330c6.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>男儿到死心如铁</span></div></div><div>感谢老师，很多东西都是看完之后豁然开朗</div><div><p>作者回复: 👍</p></div><div><div>2022-06-10</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Aeins</span></div></div><div>感觉别扭的地方

1. Go 中的接口有动态类型，动态值。不仅是一种行为抽象，还是具体的程序实体。能直接通过接口变量调用方法。比单纯用来类型注解更强大

2. ServeHTTP 里直接调用 f。这种包装 Go 独有的吧，功能上有装饰器，有委托的感觉
type HandlerFunc func (ResponseWriter, *Request)

func (f HandlerFunc) ServeHTTP (w ResponseWriter, r *Request) {    f (w, r)}
</div><div><div>2022-06-01</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132"></div></div><div><div><div><span>pyhhou</span></div></div><div>尝试着去理解 logHandler (authHandler (http.HandlerFunc (greetings)))() 的执行过程，像是 logHandler 以及 authHandler 这种中间件函数都会返回一个闭包函数，在闭包函数中它们通过 h.ServeHTTP (w, r) 与下一层的（传入的）函数进行链接

ServeHTTP 设计的挺巧妙的，仅仅看这个函数的定义并不太理解，看了例子后才明白其用意

不知道我理解的对不对，或者哪里有遗漏，还望老师指教 🙏</div><div><p>作者回复: ✅</p></div><div><div>2022-03-20</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/19/49/2c/5d3679dd.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>于建</span></div></div><div>
func validateAuth (s string) error {
    if s != "123456" {
        return fmt.Errorf ("% s", "bad auth token")
    }
    return nil
}

func greetings (w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf (w, "Welcome!")
}

func logHandler (h http.Handler) http.Handler {
    return http.HandlerFunc (func (w http.ResponseWriter, r *http.Request) {
        t := time.Now ()
        log.Printf ("[% s] % q % v\n", r.Method, r.URL.String (), t)
        h.ServeHTTP (w, r)
    })
}

func authHandler (h http.Handler) http.Handler {
    return http.HandlerFunc (func (w http.ResponseWriter, r *http.Request) {
        err := validateAuth (r.Header.Get ("auth"))
        if err != nil {
            http.Error (w, "bad auth param", http.StatusUnauthorized)
            return
        }
        h.ServeHTTP (w, r)
    })

}

func main () {
    http.ListenAndServe (":8080", logHandler (authHandler (http.HandlerFunc (greetings))))
}
白老师，这段代码，请求的信息不加 auth，返回信息也是 welcome!</div><div><p>作者回复：这是我运行的结果。不加 auth，会返回 bad auth param

$curl localhost:8080
bad auth param
$curl -H "auth:123456" localhost:8080/
Welcome!

                                                                                                 </p></div><div><div>2022-02-20</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5c/da/0a8bc27b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>文经</span></div></div><div>强烈请求白老师做一次加餐：讲一讲自己的 Go 语言学习之路，以及自己怎么做到写出来的文章即通俗易懂又足够深入的👍这种能力能学习不？</div><div><p>作者回复：我自己的学习之路，我还真没有 “认真” 总结过。手动允悲：)。</p></div><div><div>2022-01-16</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/5c/da/0a8bc27b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>文经</span></div></div><div> 文中的：这就会产生一种 “过设计” 的味道了。
说的是过度设计吧，少了一个字。</div><div><p>作者回复: “过设计” 与 “过度设计” 这两个词都有，含义一样的。</p></div><div><div>2022-01-14</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>lesserror</span></div></div><div>大白老师的文章真的做到了深入浅出。

文中有这么一句话：“沿着某一条直线移动，你投影到另一条直线上的位置不变。” 怎么理解这一句话呢？</div><div><p>作者回复：用初中数学来解释正交两个事物的关系。</p></div><div><div>2022-01-06</div><div><div><i></i><span>2</span></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/29/44/b5/7eba5a0e.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>木木</span></div></div><div>干货满满，越学越觉得 go 真的是对程序员很友好的语言。</div><div><p>作者回复：同感。</p></div><div><div>2022-01-02</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/20/1e/18/9d1f1439.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>liaomars</span></div></div><div>这应该是最接近面向对象编程的特性了吧</div><div><p>作者回复：组合，组合，组合：)</p></div><div><div>2021-12-31</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".y"><outline class="toc-level-h1" data-reactid=".y.0" style="width: 175px;"><active data-reactid=".y.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".y.0.1"><span data-reactid=".y.0.1.0"> 30｜接口：Go 中最强大的魔法</span></a></outline><outline class="toc-level-h2" data-reactid=".y.1" style="width: 165px;"><active data-reactid=".y.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".y.1.1"><span data-reactid=".y.1.1.0">一切皆组合</span></a></outline><outline class="toc-level-h2" data-reactid=".y.2" style="width: 165px;"><active data-reactid=".y.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".y.2.1"><span data-reactid=".y.2.1.0">垂直组合</span></a></outline><outline class="toc-level-h3" data-reactid=".y.3" style="width: 155px;"><active data-reactid=".y.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".y.3.1"><span data-reactid=".y.3.1.0">第一种：通过嵌入接口构建接口</span></a></outline><outline class="toc-level-h3" data-reactid=".y.4" style="width: 155px;"><active data-reactid=".y.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".y.4.1"><span data-reactid=".y.4.1.0">第二种：通过嵌入接口构建结构体类型</span></a></outline><outline class="toc-level-h3" data-reactid=".y.5" style="width: 155px;"><active data-reactid=".y.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".y.5.1"><span data-reactid=".y.5.1.0">第三种：通过嵌入结构体类型构建新结构体类型</span></a></outline><outline class="toc-level-h2" data-reactid=".y.6" style="width: 165px;"><active data-reactid=".y.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".y.6.1"><span data-reactid=".y.6.1.0">水平组合</span></a></outline><outline class="toc-level-h2" data-reactid=".y.7" style="width: 165px;"><active data-reactid=".y.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".y.7.1"><span data-reactid=".y.7.1.0">接口应用的几种模式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.8" style="width: 155px;"><active data-reactid=".y.8.0"></active><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".y.8.1"><span data-reactid=".y.8.1.0">基本模式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.9" style="width: 155px;"><active data-reactid=".y.9.0"></active><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".y.9.1"><span data-reactid=".y.9.1.0">创建模式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.a" style="width: 155px;"><active data-reactid=".y.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".y.a.1"><span data-reactid=".y.a.1.0">包装器模式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.b" style="width: 155px;"><active data-reactid=".y.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".y.b.1"><span data-reactid=".y.b.1.0">适配器模式</span></a></outline><outline class="toc-level-h3" data-reactid=".y.c" style="width: 155px;"><active data-reactid=".y.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".y.c.1"><span data-reactid=".y.c.1.0">中间件（Middleware）</span></a></outline><outline class="toc-level-h2" data-reactid=".y.d" style="width: 165px;"><active data-reactid=".y.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".y.d.1"><span data-reactid=".y.d.1.0">尽量避免使用空接口作为函数参数类型</span></a></outline><outline class="toc-level-h2" data-reactid=".y.e" style="width: 165px;"><active data-reactid=".y.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".y.e.1"><span data-reactid=".y.e.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".y.f" style="width: 165px;"><active data-reactid=".y.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".y.f.1"><span data-reactid=".y.f.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".y.g" style="width: 165px;"><active data-reactid=".y.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".y.g.1"><span data-reactid=".y.g.1.0">精选留言 (22)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/474260" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>