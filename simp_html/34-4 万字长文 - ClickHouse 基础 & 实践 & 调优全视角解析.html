
                <html lang="en" class="simpread-font simpread-theme-root" style='undefined'>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 4 万字长文 | ClickHouse 基础 & 实践 & 调优全视角解析</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>4 万字长文 | ClickHouse 基础 & 实践 & 调优全视角解析</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">《全面指南》</sr-rd-desc>
                    <sr-rd-content><section data-mpa-powered-by="yiban.io"><strong><span><span>👇点击 “</span><span>大数据技术团队</span><span>”，一键关注</span></span></strong></section><section>上一篇：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496396&amp;idx=1&amp;sn=f20648fc49c48f3eb6e046552a4bf1b4&amp;chksm=9ec1853aa9b60c2cfbfcb3a5067e9ee3bf2fd98e4c2b9bbacb6baa72aa84f1005cbf5844e9cb&amp;scene=21#wechat_redirect" textvalue="腾讯云实时数仓建设实践（PPT附下载）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" one-link-mark="yes">腾讯云实时数仓建设实践（PPT 附下载）</a><span><br></span></section><section><span>Clickhouse 是一个高性能且开源的数据库管理系统，主要用于在线分析处理 (OLAP) 业务。它采用列式存储结构，可使用 SQL 语句实时生成数据分析报告，另外它还支持索引，分布式查询以及近似计算等特性，凭其优异的表现，ClickHouse 在各大互联网公司均有广泛地应用。</span></section><section><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/pDnsbKziazM6a4vcgFDmOSssrrrgcOhKg58ybD7bV3RQw1fsmnUlucNPEnOSHF3AQMnmgWzzicUJsuGzZ43cAibBQ/640?wx_fmt=png"></div></p><h3 id="sr-toc-0">Why ClickHouse</h3><p><span>首先我们来看一下 OLAP 场景下的关键特征。</span></p><p><span>1. 大多数数据库访问都是读请求。<br>2. 数据总是以批量形式写入数据库（每次写入大于 1000 行）。<br>3. 已添加的数据一般无需修改。<br>4. 每次查询都从数据库中读取大量的行，但是同时又仅需少量的列。<br>5. 数据表多为宽表，即每个表均包含着大量的列。<br>6. 查询量一般较少（非高并发，通常每台服务器每秒约有数百个查询或更少）。<br>7. 对于简单查询，允许的延迟大约为 50 毫秒（响应时间要迅速）。<br>8. 列中的数据相对较小，一般为数字或短字符串。<br>9. 处理单个查询时需要高吞吐量（每个服务器每秒高达数十亿行）。<br>10. 事务不是必须的。<br>11. 对数据一致性要求低。<br>12. 查询结果明显小于源数据，换句话说，数据被过滤或聚合后能够被存放在单台服务器的内存中。</span></p><p><span>可以看到，<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247483697&amp;idx=1&amp;sn=bd959591f53df4178dc8f24041af0ca2&amp;chksm=9ec276c7a9b5ffd180c2ae75270781d8dc2a9e388552b46348ddbb07a2bcbb5e3c411aa7b170&amp;scene=21#wechat_redirect" textvalue="OLAP" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" one-link-mark="yes" hasload="1">OLAP</a> 业务场景与其它流行的业务场景如 OLTP 等有很大的不同，使用 OLTP 数据库或 Key-Value 数据库去处理分析查询业务将会获得非常差的性能，而且没有任何意义。</span></p><p><span>另外，相比于行式数据库，列式数据库则更适用于 OLAP 场景，因为对于大多数的查询而言，列式数据库的处理速度要至少比行式数据库快 100 倍。<span>二者的性能差别很大，列式数据库明显占优，可以从以下几方面来解释：</span></span></p><ul><li><p><span>对于分析类查询，通常只需要读取数据表中的一小部分列，使用列式数据库可以很轻松地实现，而使用行式数据库却必须要读取全部的列，这就带来了性能的损失。</span></p></li><li><p><span>列式数据库按列存储数据，使得数据更容易被压缩，可以降低 I/O 传输的体积，从而使查询速度加快。</span></p></li><li><p><span>由于 I/O 体积的降低，可以使得更多的查询数据被系统缓存，进一步加快了查询的速度。</span></p></li><li><p><span>另外，执行一个查询一般需要处理大量的行，在整个列向量上执行所有操作将比在每一行上执行所有操作更加高效，而且还可以更加充分地利用 CPU 资源，从而提升了查询的性能。</span></p></li></ul><h3 id="sr-toc-1">ClickHouse 特性</h3><p><span>相比于其它的列式数据库，ClickHouse 的以下特性决定了它更适用于 OLAP 业务场景。</span></p><p><span>1. 数据压缩：ClickHouse 会自动对插入的数据进行压缩，这对于性能的提升起到了至关重要的作用。<br>2. 磁盘存储：ClickHouse 被设计为工作在传统磁盘上，这意味着数据存储的成本较低。<br>3. 多核心并行处理：ClickHouse 会利用服务器的一切必要资源，从而以最自然的方式并行化处理大规模查询。<br>4. 分布式查询：在 ClickHouse 中，数据可以保存在不同的分片 (shard) 上，查询可以在所有分片上并行处理。<br>5. 支持 SQL：ClickHouse 的查询语言大部分情况下是与 SQL 标准兼容的，更容易上手。<br>6. 向量引擎：ClickHouse 采用了列向量引擎技术，可以更为高效地使用 CPU 资源。<br>7. 实时数据更新：ClickHouse 使用 MergeTree 引擎对数据进行增量排序，数据可以持续不断地写入到表中并进行合并，而且在整个过程中不会存在任何加锁行为。<br>8. 支持索引：ClickHouse 按照排序键对数据进行排序并支持主键索引，可以使其在几十毫秒内完成对特定值或特定范围的查找。<br>9. 支持近似计算：ClickHouse 提供了许多在允许牺牲数据精度的情况下对查询进行加速的方法。</span></p><p><span>下图显示了 ClickHouse 与其它主流列式数据库的性能对比。可以看到，对于大多数查询而言，ClickHouse 的响应速度更快，这也是选择 ClickHouse 作为 OLAP 数据处理的主要原因。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_png/pDnsbKziazM6a4vcgFDmOSssrrrgcOhKgqOdjmFSP6pz3CwibRtL2DKDctbBAeUbEmYbIG1jEiczbiajrCiaicbY7ibFg/640?wx_fmt=png"></div></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496158&amp;idx=1&amp;sn=29fba3e792ca34dae726d7f71c329adb&amp;chksm=9ec18628a9b60f3ee4e4bfa4443a0c0904f59a7c6ab6ebc4fb4e1d1710ed5c88cf1b2052ac42&amp;scene=21#wechat_redirect" textvalue="腾讯云 - ClickHouse性能调优及实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" one-link-mark="yes">附：腾讯云 - ClickHouse 性能调优及实践</a><br></p><h3 id="sr-toc-2">ClickHouse 配置文件</h3><p><span>在使用 ClickHouse 之前，我们需要修改 ClickHouse 配置文件中的一些默认配置，比如数据存储路径，集群信息以及用户信息等，这样可以更好地对 ClickHouse 进行管理控制，以满足我们的业务需求。</span></p><p><span><strong>01 配置说明</strong></span></p><p><span>1.ClickHouse 支持多配置文件管理，主配置文件为 config.xml，默认位于 /etc/clickhouse-server 目录下，其余的配置文件均需包含在 /etc/clickhouse-server/config.d 目录下。<br>2.ClickHouse 的所有配置文件均是 XML 格式的，而且在每个配置文件中都需要有相同的根元素，通常为</span><yandex><span>。<br>3. 主配置文件中的一些配置可以通过 replace 或 remove 属性被其子配置文件所覆盖，如子配置文件中的</span><zookeeper replace="true"><span>表示将使用该配置来替换主配置文件中的 zookeeper 选项。如果两个属性都未指定，则会递归组合各配置文件的内容并替换重复子项的值。<br>4. 另外，配置文件中还可以定义 substitution 替换，如果一个配置包含 incl 属性，则替换文件中相应的配置将被使用。默认情况下替换文件的路径为 /etc/metrika.xml，可以通过 include_from 配置项进行设置。如果待替换的配置不存在，ClickHouse 会记录错误日志，为了避免这种情况，可以指定配置项的 optional 属性来表示该替换是可选的，如</span><macros incl="macros" optional="true"><span>。<br>5. 在启动时，ClickHouse 会根据已有的配置文件生成相应的预处理文件，这些文件中包含了所有已完成替换和覆盖的配置项，它们被统一放置于 preprocessed 目录下，你可以从这些文件中查看最终的配置项是否正确。另外 ClickHouse 会跟踪配置文件的更改，对于某些配置如集群配置以及用户配置等，更改后会自动生效，无需重启 ClickHouse 服务，而对于其它配置项的更改可能需要重启服务才能生效。<br>6. 对于集群中的全部 ClickHouse 节点，除部分配置（如 macros）外，其它所有的配置最好都保持一致，以便于统一管理及使用。</span></macros></zookeeper></yandex></p><p><span><strong>02 数据路径配置</strong></span></p><p><span>1. 数据路径下既存储数据库和表的元数据信息（位于 metadata 目录）也存储表的真实数据（位于 data 目录）。元数据是指建库和建表的语句，亦即数据库和表的结构信息，每次 ClickHouse 启动时会根据元数据信息去加载相应的数据库和表。<br>2. 数据路径的配置如下所示，其对应的 XML 标签为</span><path><span>。</span></path><path></path></p><pre>&lt;path&gt;/path/to/clickhouse/&lt;/path&gt;</pre><p><span>3. 当单个物理盘无法存储全部的数据时，可以考虑将不同的数据库存储在不同的物理盘上，然后在 /path/to/clickhouse/data/ 目录下创建软连接指向其它物理盘上的数据库目录。</span></p><p><span><strong>03 日志配置</strong></span></p><p><span>1.ClickHouse 的日志文件中记录了各种类型的事件日志，包括数据的插入和查询的日志以及一些配置和数据合并相关的日志等。一般我们会通过日志文件找出 ClickHouse 报错的具体原因，以便解决问题。<br>2. 日志的配置如下所示，其对应的 XML 标签为</span><logger><span>。</span></logger><logger></logger></p><pre>&lt;logger&gt;
    &lt;level&gt;trace&lt;/level&gt;
    &lt;log&gt;/path/to/clickhouse-server/clickhouse-server.log&lt;/log&gt;
    &lt;errorlog&gt;/path/to/clickhouse-server/clickhouse-server.err.log&lt;/errorlog&gt;
    &lt;size&gt;1000M&lt;/size&gt;
    &lt;count&gt;10&lt;/count&gt;
&lt;/logger&gt;</pre><p><span>3.level 表示事件的日志级别，可以配置为 trace，debug，information，warning，error 等值。<br>4.log 表示主日志文件路径，该日志文件中包含所有 level 级别以上的事件日志。<br>5.errorlog 表示错误日志文件路径，该日志文件仅包含错误日志，便于问题排查。<br>6.size 表示日志大小，当日志文件达到指定 size 后，ClickHouse 会进行日志轮转。<br>7.count 表示日志轮转的最大数量。<br>8. 需要注意，因为事件日志是由多线程异步写入到日志文件中的，所以不同事件之间的日志会产生交错，不利于按顺序进行日志排查。但 ClickHouse 为每个事件都提供了唯一的 ID 来标识，我们可以根据此 ID 来跟踪事件状态的变化。</span></p><p><span><strong>04 集群配置</strong></span></p><p><span>1. 集群的配置主要用于分布式查询，在创建分布式表 (Distributed) 时会用到。2. 集群配置文件的示例如下所示，其对应的 XML 标签为</span><remote_servers><span>。</span></remote_servers><remote_servers></remote_servers></p><pre>&lt;yandex&gt;
    &lt;remote_servers&gt;
        &lt;cluster_name&gt;
            &lt;shard&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;internal_replication&gt;false&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;hostname1/ip1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;internal_replication&gt;false&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;hostname2/ip2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/cluster_name&gt;
    &lt;/remote_servers&gt;
&lt;/yandex&gt;</pre><p><span>3.cluster_name 表示集群名称，shard 表示集群的分片（即 ClickHouse 节点），集群会有多个 shard，每个 shard 上都存有全部数据的一部分。<br>4.weight 表示数据写入的权重，当有数据直接写入集群时会根据该权重来将数据分发给不同的 ClickHouse 节点，可以理解为权重轮询负载均衡。<br>5.replica 表示每个 shard 的副本，默认为 1 个，可以设置多个，表示该 shard 有多个副本。正常情况下，每个副本都会存有相同的数据。<br>6.internal_replication 表示副本间是否为内部复制，当通过集群向分片插入数据时会起作用，参数的默认值为 false，表示向该分片的所有副本中写入相同的数据（副本间数据一致性不强，无法保证完全同步），true 表示只向其中的一个副本写入数据（副本间通过复制表来完成同步，能保证数据的一致性）。<br>7. 在实际情况下，我们一般不会通过集群进行数据写入，而是将数据直接写入到各 ClickHouse 节点。一来通过集群进行分发数据会带来二次的网络延迟，降低了数据的写入速度，二来当数据量较多时，由于网络带宽限制，数据分发节点会成为数据传输的瓶颈，从而拉低了整体的数据写入效率。<br>8. 可以定义多个集群，以应对不同的查询需要。每次添加新的集群配置后，无需重启 ClickHouse 服务，该配置会即时生效。</span></p><p><span><strong>05 字典配置</strong></span></p><p><span>1. 字典就是一种键 -&gt; 值映射关系，一般在数据查询时使用。相比于多表 JOIN 的查询操作，使用字典查询会更加高效。<br>2. 字典文件的位置需要由 config.xml 文件中的 dictionaries_config 配置项设置。</span></p><pre>&lt;dictionaries_config&gt;dictionaries/*_dictionary.xml&lt;/dictionaries_config&gt;</pre><p><span>上述配置表示 ClickHouse 会从与 config.xml 文件同级的 dictionaries 目录下加载以 _dictionary.xml 为后缀的全部字典文件。</span></p><p><span>3. 字典配置文件的示例如下所示，其对应的 XML 标签为</span><dictionary><span>。</span></dictionary><dictionary></dictionary></p><pre>&lt;format&gt;TabSeparated&lt;/format&gt;
             &lt;/file&gt;
        &lt;/source&gt;
        &lt;layout&gt;
            &lt;!-- Memory layout configuration --&gt;
            &lt;complex_key_hashed /&gt;
        &lt;/layout&gt;
        &lt;structure&gt;
            &lt;!-- Complex key configuration --&gt;
            &lt;key&gt;
                &lt;attribute&gt;
                    &lt;name&gt;key&lt;/name&gt;
                    &lt;type&gt;String&lt;/type&gt;
                &lt;/attribute&gt;
            &lt;/key&gt;
            &lt;attribute&gt;
                &lt;name&gt;value&lt;/name&gt;
                &lt;type&gt;String&lt;/type&gt;
                &lt;null_value&gt;&lt;/null_value&gt;
                &lt;injective&gt;true&lt;/injective&gt;
            &lt;/attribute&gt;
        &lt;/structure&gt;
        &lt;lifetime&gt;300&lt;/lifetime&gt;
    &lt;/dictionary&gt;
&lt;/yandex&gt;</pre><p><span>4.name 表示字典名称。<br>5.source 表示字典的数据来源，数据来源有多种类型，可以是本地的文本文件，HTTP 接口或者其它各种数据库管理系统。<br>6.layout 表示字典在内存中的存储方式。一般推荐使用 flat，hashed 和 complex_key_hashed 存储方式，因为它们提供了最佳的查询处理速度。<br>7.structure 表示字典的结构，亦即键值对的信息。<br>key 表示字典的键值，它可以由多个属性组成。<br>attribute 表示字典的值，也可以有多个。8.lifetime 表示字典的更新频率，单位为秒。<br>9. 创建完字典后，我们就可以通过 SELECT dictGetTYPE) 语句来查询字典中指定 key 值对应的 value 了。其中 TYPE 表示具体的数据类型，比如获取字符串类型的值可以使用 dictGetString。<br>10. 除了使用配置文件来创建字典外，还可以使用 SQL 语句来生成字典。但相对而言，使用配置文件会更加直观便捷。</span></p><p><span><strong>06 用户配置</strong></span></p><p><span>1.config.xml 可以指定单独的文件来对用户信息进行配置，用户配置文件的路径通过 users_config 配置项指定，默认为 users.xml。</span></p><pre>&lt;users_config&gt;users.xml&lt;/users_config&gt;</pre><p><span>2. 与 config.xml 文件类似，用户配置也可以被切分为不同的文件以便于管理，这些文件需要保存到 users.d 目录下。<br>3.ClickHouse 的默认用户为 default，密码为空。<br>4. 用户配置的示例如下所示，其对应的 XML 标签为</span><users><span>。</span></users><users></users></p><pre>&lt;users&gt;
    &lt;!-- If user name was not specified, 'default' user is used. --&gt;
    &lt;user_name&gt;
        &lt;password&gt;&lt;/password&gt;
        &lt;!-- Or --&gt;
        &lt;password_sha256_hex&gt;&lt;/password_sha256_hex&gt;
        &lt;networks incl="networks" replace="replace"&gt;
            &lt;ip&gt;::/0&lt;/ip&gt;
        &lt;/networks&gt;
        &lt;profile&gt;profile_name&lt;/profile&gt;
        &lt;quota&gt;default&lt;/quota&gt;
    &lt;/user_name&gt;
    &lt;!-- Other users settings --&gt;
&lt;/users&gt;</pre><p><span>5.user_name 表示待添加的用户名。<br>6.password 表示明文密码，不推荐使用该方式设置密码。<br>7.password_sha256_hex 表示经过 sha256 hash 后的密码，推荐使用该方式设置密码，密码的生成方式如下所示。</span></p><pre>echo -n "$PASSWORD" | sha256sum | tr -d '-'</pre><p><span>8.networks 表示允许连接到 ClickHouse 节点的网络地址列表，可以为 IP 地址或 Hostname。::/0 表示该用户可以从任何网络地址连接到 ClickHouse 节点。<br>9.profile 表示对用户的一系列设置，用以控制用户的行为，如设置该用户具有只读权限等。它是以单独的 XML 标签存在于 users.xml 文件中的。配置的示例如下所示。</span></p><pre>&lt;!-- Settings profiles --&gt;
&lt;profiles&gt;
    &lt;!-- Default settings --&gt;
    &lt;default&gt;
        &lt;!-- The maximum number of threads when running a single query. --&gt;
        &lt;max_threads&gt;8&lt;/max_threads&gt;
    &lt;/default&gt;

    &lt;!-- Settings for quries from the user interface --&gt;
    &lt;profile_name&gt;
        &lt;!-- Maximum memory usage for processing single query, in bytes. --&gt;
        &lt;max_memory_usage&gt;30000000000&lt;/max_memory_usage&gt;
        &lt;!-- How to choose between replicas during distributed query processing. --&gt;
        &lt;load_balancing&gt;in_order&lt;/load_balancing&gt;
        &lt;readonly&gt;1&lt;/readonly&gt;
    &lt;/profile_name&gt;
&lt;/profiles&gt;</pre><p><span>profile 的名称可以任意，不同的用户可以配置相同的 profile。另外需要注意，default profile 必须存在，它会在 ClickHouse 启动时作为默认的设置使用。10.quota 表示用户配额设置，用来限制用户一段时间内的资源使用，如 1 小时内的查询数不超过 1024 等。它同样是以单独的 XML 标签存在于 users.xml 文件中的。配置的示例如下所示。</span></p><pre>&lt;!-- Quotas --&gt;
&lt;quotas&gt;
    &lt;!-- Quota name. --&gt;
    &lt;default&gt;
        &lt;!-- Restrictions for a time period. You can set many intervals with different restrictions. --&gt;
        &lt;interval&gt;
            &lt;!-- Length of the interval. --&gt;
            &lt;duration&gt;3600&lt;/duration&gt;

            &lt;!-- Unlimited. Just collect data for the specified time interval. --&gt;
            &lt;queries&gt;0&lt;/queries&gt;
            &lt;errors&gt;0&lt;/errors&gt;
            &lt;result_rows&gt;0&lt;/result_rows&gt;
            &lt;read_rows&gt;0&lt;/read_rows&gt;
            &lt;execution_time&gt;0&lt;/execution_time&gt;
        &lt;/interval&gt;
    &lt;/default&gt;
&lt;/quotas&gt;</pre><p><span>配额限制与 profile 中限制的主要区别在于，它可以对一段时间内运行的一组查询设置限制，而不是限制单个查询。11. 除了使用配置文件管理用户，还可以基于 SQL 语句来创建、修改或删除用户。但相对而言，使用配置文件会更加直观便捷。</span></p><p><span><strong>07ZooKeeper 配置</strong></span></p><p><span>1.zookeeper 配置允许 ClickHouse 与一个 ZooKeeper 集群进行交互。ClickHouse 主要使用 ZooKeeper 来存储复制表的元数据，当不使用复制表时，该配置可以忽略。<br>2.ZooKeeper 配置文件的示例如下所示，其对应的 XML 标签为</span><zookeeper><span>。</span></zookeeper><zookeeper></zookeeper></p><pre>&lt;yandex&gt;
    &lt;zookeeper replace="true"&gt;
        &lt;node index="1"&gt;
            &lt;host&gt;hostname1/ip1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="2"&gt;
            &lt;host&gt;hostname2/ip2&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="3"&gt;
            &lt;host&gt;hostname3/ip3&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper&gt;
&lt;/yandex&gt;</pre><p><span>3.node 表示一个 ZooKeeper 节点，可以设置多个。当尝试连接到 ZooKeeper 集群时，index 属性指定了各节点的连接顺序。</span></p><p><span><strong>08Macros 配置</strong></span></p><p><span>1.macros 配置主要用来替换复制表的参数，在创建复制表时需要用到，当不使用复制表时，该配置可以忽略。<br>2.Macros 配置文件的示例如下所示，其对应的 XML 标签为</span><macros><span>。</span></macros><macros></macros></p><pre>&lt;yandex&gt;
    &lt;macros replace="true"&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;hostname/ip&lt;/replica&gt;
    &lt;/macros&gt;
&lt;/yandex&gt;</pre><p><span><strong>09Prometheus 配置</strong></span></p><p><span>1. 该配置用来供 Prometheus 获取 ClickHouse 的指标信息。<br>2.Prometheus 配置的示例如下所示，其对应的 XML 标签为</span><prometheus><span>。</span></prometheus><prometheus></prometheus></p><pre>&lt;prometheus&gt;
    &lt;endpoint&gt;/metrics&lt;/endpoint&gt;
    &lt;port&gt;9363&lt;/port&gt;
    &lt;metrics&gt;true&lt;/metrics&gt;
    &lt;events&gt;true&lt;/events&gt;
    &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;
&lt;/prometheus&gt;</pre><p><span>3.endpoint 表示指标接口的 URI。<br>4.port 表示指标服务所使用的端口。<br>5.metrics，events 和 asynchronous_metrics 都是标志项，代表是否暴露相应的指标信息。<br>6. 配置完成后，即可访问 http://ip:port/metrics 来查看所有的 ClickHouse 指标信息了。</span></p><p><span><strong>10MergeTree 配置</strong></span></p><p><span>1. 该配置用来对使用 MergeTree 系列引擎的表进行微调。需要注意，除非你对该配置有充分的了解，否则不建议修改。<br>2.MergeTree 配置的示例如下所示，其对应的 XML 标签为</span><merge_tree><span>。</span></merge_tree><merge_tree></merge_tree></p><pre>&lt;merge_tree&gt;
    &lt;!-- If more than this number active parts in single partition, throw 'Too many parts ...' exception. --&gt;
    &lt;parts_to_throw_insert&gt;300&lt;/parts_to_throw_insert&gt;
&lt;/merge_tree&gt;</pre><p><span>3. 更多 MergeTree 相关配置可以参见源码中的 MergeTreeSettings.h 头文件。</span></p><p><span><strong>11 其他常用配置</strong></span></p><p><span>1. 时区配置。</span></p><pre>&lt;timezone&gt;Asia/Shanghai&lt;/timezone&gt;</pre><p>2. 最大连接数配置。</p><pre>&lt;max_connections&gt;4096&lt;/max_connections&gt;</pre><p>3. 并发查询数配置。</p><pre>&lt;max_concurrent_queries&gt;200&lt;/max_concurrent_queries&gt;</pre><p>4.ClickHouse 最大内存使用量配置。</p><pre>&lt;max_server_memory_usage&gt;0&lt;/max_server_memory_usage&gt;</pre><p>5. 可删除表的最大数据量配置。</p><pre>&lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt;</pre><p><span>单位为字节，默认值为 50 G，当表中数据大小超过该限制时，不能使用 DROP 语句去删除该表（防止误操作）。如果设置为 0，表示没有任何限制。如果你仍然想删除某个数据量超限的表而不想修改上述配置并重启 ClickHouse 时，可以在 ClickHouse 的数据目录下创建一个标志文件 /path/to/clickhouse/flags/force_drop_table 表示可以强制删除该表，然后执行 DROP 语句即可删表成功。</span></p><p><span>需要注意上述标志文件在执行完一次 DROP 语句后会被自动删除以防止再次执行意外的 DROP 操作，因此执行创建标志文件和执行 DROP 语句的系统用户（非 ClickHouse 用户）应该保持一致，以避免在执行完 DROP 语句后，用户没有权限删除标志文件，从而导致后续操作失误并造成数据损失。</span></p><p><span>6. 更多的配置可参见其官方文档，然后再按需调整。<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247495530&amp;idx=1&amp;sn=1d9977b741be4001ef301d221f07630b&amp;chksm=9ec1989ca9b6118a0ee34df35fe5a6e7c988c334ed6d8107892c1c6e8a976c3e3072234adbad&amp;scene=21#wechat_redirect" textvalue="Apache Doris和ClickHouse的深度分析！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" one-link-mark="yes">Apache Doris 和 ClickHouse 的深度分析！</a></span></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzA3MDAxNzY4OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/pDnsbKziazM71Wp5E3LrgBz5VRytf1tvicemrRrlaXXtyicVxEQoAib2OnvVOPrdexUqepsEicxNOu6SCCiczgQ3h0wg/0?wx_fmt=png&amp;wx_head=1" data-nickname="大数据技术团队" data-alias="DT_lovers" data-signature="专注大数据、数据分析、数据仓库、数据中台、数据科学、Flink，AI人工智能与面试经验，副业赚钱与职业规划。" data-from="0" has-insert-preloading="1" data-index="1" data-origin_num="13" data-is_biz_ban="0" data-isban="0"></mp-common-profile></section></section><section><h3 id="sr-toc-3">ClickHouse 表引擎</h3><p><span>ClickHouse 的表引擎是 ClickHouse 服务的核心，它们决定了 ClickHouse 的以下行为：</span></p><p><span>1. 数据的存储方式和位置。<br>2. 支持哪些查询操作以及如何支持。<br>3. 数据的并发访问。<br>4. 数据索引的使用。<br>5. 是否可以支持多线程请求。<br>6. 是否可以支持数据复制。</span></p><p><span>ClickHouse 包含以下几种常用的引擎类型：</span></p><ul><li><p><span>MergeTree 引擎：该系列引擎是执行高负载任务的最通用和最强大的表引擎，它们的特点是可以快速插入数据以及进行后续的数据处理。该系列引擎还同时支持数据复制（使用 Replicated 的引擎版本），分区 (partition) 以及一些其它引擎不支持的额外功能。</span></p></li><li><p><span>Log 引擎：该系列引擎是具有最小功能的轻量级引擎。当你需要快速写入许多小表（最多约有 100 万行）并在后续任务中整体读取它们时使用该系列引擎是最有效的。</span></p></li><li><p><span>集成引擎：该系列引擎是与其它数据存储以及处理系统集成的引擎，如 Kafka，MySQL 以及 HDFS 等，使用该系列引擎可以直接与其它系统进行交互，但也会有一定的限制，如确有需要，可以尝试一下。</span></p></li><li><p><span>特殊引擎：该系列引擎主要用于一些特定的功能，如 Distributed 用于分布式查询，MaterializedView 用来聚合数据，以及 Dictionary 用来查询字典数据等。</span></p></li></ul><h3 id="sr-toc-4">MergeTree 系列引擎</h3><p><span>在所有的表引擎中，最为核心的当属 MergeTree 系列表引擎，这些表引擎拥有最为强大的性能和最广泛的使用场合。对于非 MergeTree 系列的其他引擎而言，主要用于特殊用途，场景相对有限。而 MergeTree 系列表引擎是官方主推的存储引擎，支持几乎所有 ClickHouse 核心功能。</span></p><p><span><strong>MergeTree 表引擎</strong></span></p><p><span>MergeTree 在写入一批数据时，数据总会以数据片段的形式写入磁盘，且数据片段不可修改。为了避免片段过多，ClickHouse 会通过后台线程，定期合并这些数据片段，属于相同分区的数据片段会被合成一个新的片段。这种数据片段往复合并的特点，也正是合并树名称的由来。</span></p><p><span>MergeTree 作为家族系列最基础的表引擎，主要有以下特点：</span></p><ul><li><p><span>存储的数据按照主键排序：允许创建稀疏索引，从而加快数据查询速度</span></p></li><li><p><span>支持分区，可以通过 PRIMARY KEY 语句指定分区字段。</span></p></li><li><p><span>支持数据副本</span></p></li><li><p><span>支持数据采样</span></p></li></ul><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1] [TTL expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2] [TTL expr2],
    ...
    INDEX index_name1 expr1 TYPE type1(...) GRANULARITY value1,
    INDEX index_name2 expr2 TYPE type2(...) GRANULARITY value2
) ENGINE = MergeTree()
ORDER BY expr
[PARTITION BY expr]
[PRIMARY KEY expr]
[SAMPLE BY expr]
[TTL expr [DELETE|TO DISK 'xxx'|TO VOLUME 'xxx'], ...]
[SETTINGS name=value, ...]</pre><ul><li><p><span>ENGINE：ENGINE = MergeTree ()，MergeTree 引擎没有参数</span></p></li><li><p><span> ORDER BY：排序字段。比如 ORDER BY (Col1, Col2)，值得注意的是，如果没有指定主键，默认情况下 sorting key (排序字段) 即为主键。如果不需要排序，则可以使用 <strong>ORDER BY tuple()</strong> 语法，这样的话，创建的表也就不包含主键。这种情况下，ClickHouse 会按照插入的顺序存储数据。必选。</span></p></li><li><p><span>PARTITION BY：分区字段，可选。</span></p></li><li><p><span>PRIMARY KEY：指定主键，如果排序字段与主键不一致，可以单独指定主键字段。否则默认主键是排序字段。可选。</span></p></li><li><p><span>SAMPLE BY：采样字段，如果指定了该字段，那么主键中也必须包含该字段。比如 SAMPLE BY intHash32 (UserID) ORDER BY (CounterID, EventDate, intHash32 (UserID))。可选。</span></p></li><li><p><span>TTL：数据的存活时间。在 MergeTree 中，可以为某个列字段或整张表设置 TTL。当时间到达时，如果是列字段级别的 TTL，则会删除这一列的数据；如果是表级别的 TTL，则会删除整张表的数据。可选。</span></p></li><li><p><span>SETTINGS：额外的参数配置。可选。</span></p></li></ul><p><span>建表示例</span></p><pre>CREATE TABLE emp_mergetree (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=MergeTree()
  ORDER BY emp_id
  PARTITION BY work_place
  ;
 -- 插入数据 
INSERT INTO emp_mergetree 
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_mergetree 
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000); 

-- 查询数据
-- 按work_place进行分区
cdh04 :) select * from emp_mergetree;

SELECT *
FROM emp_mergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>查看一下数据存储格式，可以看出，存在三个分区文件夹，每一个分区文件夹内存储了对应分区的数据。</span></p><pre>[root@cdh04 emp_mergetree]# pwd
/var/lib/clickhouse/data/default/emp_mergetree
[root@cdh04 emp_mergetree]# ll
总用量 16
drwxr-x--- 2 clickhouse clickhouse 4096 9月  17 17:45 1c89a3ba9fe5fd53379716a776c5ac34_3_3_0
drwxr-x--- 2 clickhouse clickhouse 4096 9月  17 17:44 40d45822dbd7fa81583d715338929da9_1_1_0
drwxr-x--- 2 clickhouse clickhouse 4096 9月  17 17:45 a6155dcc1997eda1a348cd98b17a93e9_2_2_0
drwxr-x--- 2 clickhouse clickhouse    6 9月  17 17:43 detached
-rw-r----- 1 clickhouse clickhouse    1 9月  17 17:43 format_version.txt</pre><p><span>进入一个分区目录查看</span><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKia13OLznsuRzaib034q0lGudPtlj3WMGhYzHOWibRqFZjKcbfGo9Y6bLg/640?wx_fmt=png"></div></p><ul><li><p><span>checksums.txt：校验文件，使用二进制格式存储。它保存了余下各类文件 (primary. idx、count.txt 等) 的 size 大小及 size 的哈希值，用于快速校验文件的完整性和正确性。</span></p></li><li><p><span>columns.txt：列信息文件，使用明文格式存储。用于保存此数据分区下的列字段信息，例如</span></p><pre>[root@cdh04 1c89a3ba9fe5fd53379716a776c5ac34_3_3_0]# cat columns.txt
columns format version: 1
6 columns:
`emp_id` UInt16
`name` String
`work_place` String
`age` UInt8
`depart` String
`salary` Decimal(9, 2)</pre></li><li><p><span>count.txt：计数文件，使用明文格式存储。用于记录当前数据分区目录下数据的总行数</span></p></li><li><p><span> primary.idx：一级索引文件，使用二进制格式存储。用于存放稀疏索引，一张 MergeTree 表只能声明一次一级索引，即通过 ORDER BY 或者 PRIMARY KEY 指定字段。借助稀疏索引，在数据查询的时能够排除主键条件范围之外的数据文件，从而有效减少数据扫描范围，加速查询速度。</span></p></li><li><p><span>列. bin：数据文件，使用压缩格式存储，默认为 LZ4 压缩格式，用于存储某一列的数据。由于 MergeTree 采用列式存储，所以每一个列字段都拥有独立的. bin 数据文件，并以列字段名称命名。</span></p></li><li><p><span>列. mrk2：列字段标记文件，使用二进制格式存储。标记文件中保存了. bin 文件中数据的偏移量信息</span></p></li><li><p><span> partition.dat 与 minmax_[Column].idx：如果指定了分区键，则会额外生成 partition.dat 与 minmax 索引文件，它们均使用二进制格式存储。partition.dat 用于保存当前分区下分区表达式最终生成的值，即分区字段值；而 minmax 索引用于记录当前分区下分区字段对应原始数据的最小和最大值。比如当使用 EventTime 字段对应的原始数据为 2020-09-17、2020-09-30，分区表达式为 PARTITION BY toYYYYMM (EventTime)，即按月分区。partition.dat 中保存的值将会是 2019-09，而 minmax 索引中保存的值将会是 2020-09-17 2020-09-30。</span></p></li></ul><p><span>注意点</span></p><ul><li><p><span>多次插入数据，会生成多个分区文件 </span></p></li></ul><pre>-- 新插入两条数据
cdh04 :) INSERT INTO emp_mergetree
VALUES (5,'robin','北京',35,'财务部',50000),(6,'lilei','北京',38,'销售事部',50000);

-- 查询结果
cdh04 :) select * from emp_mergetree;
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name──┬─work_place─┬─age─┬─depart───┬───salary─┐
│      5 │ robin │ 北京       │  35 │ 财务部   │ 50000.00 │
│      6 │ lilei │ 北京       │  38 │ 销售事部 │ 50000.00 │
└────────┴───────┴────────────┴─────┴──────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p>可以看出，新插入的数据新生成了一个数据块，并没有与原来的分区数据在一起，我们可以执行 optimize 命令，执行合并操作</p><pre>-- 执行合并操作
cdh04 :) OPTIMIZE TABLE emp_mergetree PARTITION '北京';
-- 再次执行查询
cdh04 :) select * from emp_mergetree;                  
SELECT *
FROM emp_mergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name──┬─work_place─┬─age─┬─depart───┬───salary─┐
│      3 │ bob   │ 北京       │  33 │ 财务部   │ 50000.00 │
│      5 │ robin │ 北京       │  35 │ 财务部   │ 50000.00 │
│      6 │ lilei │ 北京       │  38 │ 销售事部 │ 50000.00 │
└────────┴───────┴────────────┴─────┴──────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>执行上面的合并操作之后，会新生成一个该分区的文件夹，原理的分区文件夹不变。</span></p><ul><li><p><span>在 MergeTree 中主键并不用于去重，而是用于索引，加快查询速度 </span></p></li></ul><pre>-- 插入一条相同主键的数据
 INSERT INTO emp_mergetree
VALUES (1,'sam','杭州',35,'财务部',50000);
-- 会发现该条数据可以插入，由此可知，并不会对主键进行去重</pre><p><span><strong>ReplacingMergeTree 表引擎</strong></span></p><p><span>上文提到 MergeTree 表引擎无法对相同主键的数据进行去重，ClickHouse 提供了 ReplacingMergeTree 引擎，可以针对相同主键的数据进行去重，它能够在合并分区时删除重复的数据。值得注意的是，ReplacingMergeTree 只是在一定程度上解决了数据重复问题，但是并不能完全保障数据不重复。</span></p><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = ReplacingMergeTree([ver])
[PARTITION BY expr]
[ORDER BY expr]
[PRIMARY KEY expr]
[SAMPLE BY expr]
[SETTINGS name=value, ...]</pre><ul><li><p><span>[ver]：可选参数，列的版本，可以是 UInt、Date 或者 DateTime 类型的字段作为版本号。该参数决定了数据去重的方式。</span></p></li><li><p><span>当没有指定 [ver] 参数时，保留最新的数据；如果指定了具体的值，保留最大的版本数据。</span></p></li></ul><p><span>建表示例</span></p><pre>CREATE TABLE emp_replacingmergetree (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=ReplacingMergeTree()
  ORDER BY emp_id
  PRIMARY KEY emp_id
  PARTITION BY work_place
  ;
 -- 插入数据 
INSERT INTO emp_replacingmergetree
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_replacingmergetree
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);</pre><p><span>注意点</span></p><p><span>当我们再次向该表插入具有相同主键的数据时，观察查询数据的变化</span></p><pre>INSERT INTO emp_replacingmergetree
VALUES (1,'tom','上海',25,'技术部',50000);
-- 查询数据，由于没有进行合并，所以存在主键重复的数据
cdh04 :) select * from emp_replacingmergetree;                                        

SELECT *
FROM emp_replacingmergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
-- 执行合并操作
optimize table emp_replacingmergetree final;
-- 再次查询，相同主键的数据，保留最近插入的数据，旧的数据被清除
cdh04 :) select * from emp_replacingmergetree;       

SELECT *
FROM emp_replacingmergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 50000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘</pre><p><span>从上面的示例中可以看出，ReplacingMergeTree 是支持对数据去重的，那么是根据什么进行去重呢？答案是：<strong>ReplacingMergeTree 在去除重复数据时，是以 ORDERBY 排序键为基准的，而不是 PRIMARY KEY</strong>。我们在看一个示例：</span></p><pre>CREATE TABLE emp_replacingmergetree1 (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=ReplacingMergeTree()
  ORDER BY (emp_id,name) -- 注意排序key是两个字段
  PRIMARY KEY emp_id     -- 主键是一个字段
  PARTITION BY work_place
  ;
 -- 插入数据 
INSERT INTO emp_replacingmergetree1
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_replacingmergetree1
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);</pre><p><span>再次向该表中插入相同 emp_id 和 name 的数据，并执行合并操作，再观察数据</span></p><pre>-- 插入数据
INSERT INTO emp_replacingmergetree1
VALUES (1,'tom','上海',25,'技术部',50000),(1,'sam','上海',25,'技术部',20000);
-- 执行合并操作
optimize table emp_replacingmergetree1 final;
-- 再次查询，可见相同的emp_id和name数据被去重，而形同的主键emp_id不会去重
-- ReplacingMergeTree在去除重复数据时，是以ORDERBY排序键为基准的，而不是PRIMARY KEY
cdh04 :) select * from emp_replacingmergetree1;                                                                           
SELECT *
FROM emp_replacingmergetree1

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ sam  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 50000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>至此，我们知道了 ReplacingMergeTree 是支持去重的，并且是按照 ORDERBY 排序键为基准进行去重的。细心的你会发现，上面的重复数据是在一个分区内的，那么如果重复的数据不在一个分区内，会发生什么现象呢？我们再次向上面的 emp_replacingmergetree1 表插入不同分区的重复数据</span></p><pre>-- 插入数据
INSERT INTO emp_replacingmergetree1
VALUES (1,'tom','北京',26,'技术部',10000);
-- 执行合并操作
optimize table emp_replacingmergetree1 final;
-- 再次查询
-- 发现  1 │ tom  │ 北京       │  26 │ 技术部 │ 10000.00
-- 与    1 │ tom  │ 上海       │  25 │ 技术部 │ 50000.00
-- 数据重复，因为这两行数据不在同一个分区内
-- 这是因为ReplacingMergeTree是以分区为单位删除重复数据的。
-- 只有在相同的数据分区内重复的数据才可以被删除，而不同数据分区之间的重复数据依然不能被剔除
cdh04 :) select * from emp_replacingmergetree1;       

SELECT *
FROM emp_replacingmergetree1

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 北京       │  26 │ 技术部 │ 10000.00 │
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ sam  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 50000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><strong>总结</strong></p><ul><li><p><span>如何判断数据重复</span></p></li></ul><p><span>ReplacingMergeTree 在去除重复数据时，是以 ORDERBY 排序键为基准的，而不是 PRIMARY KEY。</span></p><ul><li><p><span>何时删除重复数据</span></p></li></ul><p><span>在执行分区合并时，会触发删除重复数据。optimize 的合并操作是在后台执行的，无法预测具体执行时间点，除非是手动执行。</span></p><ul><li><p><span>不同分区的重复数据不会被去重</span></p></li></ul><p><span>ReplacingMergeTree 是以分区为单位删除重复数据的。只有在相同的数据分区内重复的数据才可以被删除，而不同数据分区之间的重复数据依然不能被剔除。</span></p><ul><li><p><span>数据去重的策略是什么</span></p></li></ul><p><span>如果没有设置 <strong>[ver] 版本号</strong>，则保留同一组重复数据中的最新插入的数据；如果设置了 <strong>[ver] 版本号</strong>，则保留同一组重复数据中 ver 字段取值最大的那一行。</span></p><ul><li><p><span>optimize 命令使用</span></p></li></ul><p><span>一般在数据量比较大的情况，尽量不要使用该命令。因为在海量数据场景下，执行 optimize 要消耗大量时间</span></p><p><span><strong>SummingMergeTree 表引擎</strong></span></p><p><span>该引擎继承了 MergeTree 引擎，当合并 SummingMergeTree 表的数据片段时，ClickHouse 会把所有具有相同主键的行合并为一行，该行包含了被合并的行中具有数值数据类型的列的汇总值，即如果存在重复的数据，会对对这些重复的数据进行合并成一条数据，类似于 group by 的效果。</span></p><p><span>推荐将该引擎和 MergeTree 一起使用。例如，将完整的数据存储在 MergeTree 表中，并且使用 SummingMergeTree 来存储聚合数据。这种方法可以避免因为使用不正确的主键组合方式而丢失数据。</span></p><p><span>如果用户只需要查询数据的汇总结果，不关心明细数据，并且数据的汇总条件是预先明确的，即 GROUP BY 的分组字段是确定的，可以使用该表引擎。</span></p><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = SummingMergeTree([columns]) -- 指定合并汇总字段
[PARTITION BY expr]
[ORDER BY expr]
[SAMPLE BY expr]
[SETTINGS name=value, ...]</pre><p>建表示例</p><pre>CREATE TABLE emp_summingmergetree (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=SummingMergeTree(salary)
  ORDER BY (emp_id,name) -- 注意排序key是两个字段
  PRIMARY KEY emp_id     -- 主键是一个字段
  PARTITION BY work_place
  ;
 -- 插入数据 
INSERT INTO emp_summingmergetree
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_summingmergetree
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);</pre><p><span>当我们再次插入具有相同 emp_id,name 的数据时，观察结果</span></p><pre>INSERT INTO emp_summingmergetree
VALUES (1,'tom','上海',25,'信息部',10000),(1,'tom','北京',26,'人事部',10000);
cdh04 :) select * from emp_summingmergetree;
-- 查询
SELECT *
FROM emp_summingmergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 北京       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 信息部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
-- 执行合并操作
optimize table emp_summingmergetree final;
cdh04 :) select * from emp_summingmergetree;       
-- 再次查询，新插入的数据 1 │ tom  │ 上海       │  25 │ 信息部 │ 10000.00 
-- 原来的数据 ：1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00
-- 这两行数据合并成：1 │ tom  │ 上海       │  25 │ 技术部 │ 30000.00
SELECT *
FROM emp_summingmergetree

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 北京       │  26 │ 人事部 │ 10000.00 │
│      3 │ bob  │ 北京       │  33 │ 财务部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 30000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>注意点</span></p><p><span>要保证 PRIMARY KEY expr 指定的主键是 ORDER BY expr 指定字段的前缀，比如</span></p><pre>-- 允许
ORDER BY (A,B,C) 
PRIMARY KEY A  
-- 会报错
--  DB::Exception: Primary key must be a prefix of the sorting key
ORDER BY (A,B,C) 
PRIMARY KEY B</pre><p><span>这种强制约束保障了即便在两者定义不同的情况下，主键仍然是排序键的前缀，不会出现索引与数据顺序混乱的问题。</span></p><p><span>总结</span></p><ul><li><p><span>SummingMergeTree 是根据什么对两条数据进行合并的<br>用 ORBER BY 排序键作为聚合数据的条件 Key。即如果排序 key 是相同的，则会合并成一条数据，并对指定的合并字段进行聚合。</span></p></li><li><p><span>仅对分区内的相同排序 key 的数据行进行合并<br>以数据分区为单位来聚合数据。当分区合并时，同一数据分区内聚合 Key 相同的数据会被合并汇总，而不同分区之间的数据则不会被汇总。</span></p></li><li><p><span>如果没有指定聚合字段，会怎么聚合<br>如果没有指定聚合字段，则会按照非主键的数值类型字段进行聚合</span></p></li><li><p><span>对于非汇总字段的数据，该保留哪一条<br>如果两行数据除了排序字段相同，其他的非聚合字段不相同，那么在聚合发生时，会保留最初的那条数据，新插入的数据对应的那个字段值会被舍弃 </span></p></li></ul><pre>-- 新插入的数据:        1 │ tom  │ 上海       │  25 │ 信息部 │ 10000.00 
-- 最初的数据 ：1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00

-- 聚合合并的结果：1 │ tom  │ 上海       │  25 │ 技术部 │ 30000.00</pre><p><span><strong>Aggregatingmergetree 表引擎</strong></span></p><p><span>该表引擎继承自 MergeTree，可以使用 AggregatingMergeTree 表来做增量数据统计聚合。如果要按一组规则来合并减少行数，则使用 AggregatingMergeTree 是合适的。</span></p><p><span>AggregatingMergeTree 是通过预先定义的聚合函数计算数据并通过二进制的格式存入表内。与 SummingMergeTree 的区别在于：SummingMergeTree 对非主键列进行 sum 聚合，而 AggregatingMergeTree 则可以指定各种聚合函数。</span></p><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = AggregatingMergeTree()
[PARTITION BY expr]
[ORDER BY expr]
[SAMPLE BY expr]
[SETTINGS name=value, ...]</pre><p><span><strong>CollapsingMergeTree 表引擎</strong></span></p><p><span>CollapsingMergeTree 就是一种通过以增代删的思路，支持行级数据修改和删除的表引擎。它通过定义一个 sign 标记位字段，记录数据行的状态。如果 sign 标记为 1，则表示这是一行有效的数据；如果 sign 标记为 - 1，则表示这行数据需要被删除。当 CollapsingMergeTree 分区合并时，同一数据分区内，sign 标记为 1 和 - 1 的一组数据会被抵消删除。</span></p><p><span>每次需要新增数据时，写入一行 sign 标记为 1 的数据；需要删除数据时，则写入一行 sign 标记为 - 1 的数据。</span></p><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = CollapsingMergeTree(sign)
[PARTITION BY expr]
[ORDER BY expr]
[SAMPLE BY expr]
[SETTINGS name=value, ...]</pre><p><span>注意点</span></p><ul><li><p><span>分区合并</span></p></li></ul><p><span>分数数据折叠不是实时的，需要后台进行 Compaction 操作，用户也可以使用手动合并命令，但是效率会很低，一般不推荐在生产环境中使用。<br>当进行汇总数据操作时，可以通过改变查询方式，来过滤掉被删除的数据<br>只有相同分区内的数据才有可能被折叠。其实，当我们修改或删除数据时，这些被修改的数据通常是在一个分区内的，所以不会产生影响。</span></p><ul><li><p><span>数据写入顺序</span></p></li></ul><p><span>值得注意的是：CollapsingMergeTree 对于写入数据的顺序有着严格要求，否则导致无法正常折叠。<br>如果数据的写入程序是单线程执行的，则能够较好地控制写入顺序；如果需要处理的数据量很大，数据的写入程序通常是多线程执行的，那么此时就不能保障数据的写入顺序了。在这种情况下，CollapsingMergeTree 的工作机制就会出现问题。但是可以通过 VersionedCollapsingMergeTree 的表引擎得到解决。</span></p><p><span><strong>VersionedCollapsingMergeTree 表引擎</strong></span></p><p><span>上面提到 CollapsingMergeTree 表引擎对于数据写入乱序的情况下，不能够实现数据折叠的效果。VersionedCollapsingMergeTree 表引擎的作用与 CollapsingMergeTree 完全相同，它们的不同之处在于，VersionedCollapsingMergeTree 对数据的写入顺序没有要求，在同一个分区内，任意顺序的数据都能够完成折叠操作。</span></p><p><span>VersionedCollapsingMergeTree 使用 version 列来实现乱序情况下的数据折叠。</span></p><p><span>建表语法</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = VersionedCollapsingMergeTree(sign, version)
[PARTITION BY expr]
[ORDER BY expr]
[SAMPLE BY expr]
[SETTINGS name=value, ...]</pre><p><span>可以看出：该引擎除了需要指定一个 sign 标识之外，还需要指定一个 UInt8 类型的 version 版本号。</span></p><p><span><strong>GraphiteMergeTree 表引擎</strong></span></p><p><span>该引擎用来对 Graphite 数据进行 '瘦身' 及汇总。对于想使用 CH 来存储 Graphite 数据的开发者来说可能有用。</span></p><p><span>如果不需要对 Graphite 数据做汇总，那么可以使用任意的 CH 表引擎；但若需要，那就采用 GraphiteMergeTree 引擎。它能减少存储空间，同时能提高 Graphite 数据的查询效率。</span></p><h3 id="sr-toc-5">Log 系列表引擎</h3><p><span><strong>应用场景</strong></span></p><p><span>Log 系列表引擎功能相对简单，主要用于快速写入小表 (1 百万行左右的表)，然后全部读出的场景。即一次写入多次查询。</span></p><p><span><strong>Log 系列表引擎的特点</strong></span></p><p><span><strong>共性特点</strong></span></p><ul><li><p><span>数据存储在磁盘上</span></p></li><li><p><span>当写数据时，将数据追加到文件的末尾</span></p></li><li><p><span>不支持并发读写，当向表中写入数据时，针对这张表的查询会被阻塞，直至写入动作结束</span></p></li><li><p><span>不支持索引</span></p></li><li><p><span>不支持原子写：如果某些操作 (异常的服务器关闭) 中断了写操作，则可能会获得带有损坏数据的表</span></p></li><li><p><span>不支持 ALTER 操作 (这些操作会修改表设置或数据，比如 delete、update 等等)</span></p></li></ul><p><span><strong>区别</strong></span></p><ul><li><p><span>TinyLog 是 Log 系列引擎中功能简单、性能较低的引擎。它的存储结构由数据文件和元数据两部分组成。其中，数据文件是按列独立存储的，也就是说每一个列字段都对应一个文件。除此之外，TinyLog 不支持并发数据读取。</span></p></li><li><p><span>StripLog 支持并发读取数据文件，当读取数据时，ClickHouse 会使用多线程进行读取，每个线程处理一个单独的数据块。另外，StripLog 将所有列数据存储在同一个文件中，减少了文件的使用数量。</span></p></li><li><p><span>Log 支持并发读取数据文件，当读取数据时，ClickHouse 会使用多线程进行读取，每个线程处理一个单独的数据块。Log 引擎会将每个列数据单独存储在一个独立文件中。</span></p></li></ul><p><span><strong>TinyLog 表引擎使用</strong></span></p><p><span>该引擎适用于一次写入，多次读取的场景。对于处理小批数据的中间表可以使用该引擎。值得注意的是，使用大量的小表存储数据，性能会很低。</span></p><pre>CREATE TABLE emp_tinylog (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=TinyLog();

INSERT INTO emp_tinylog 
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_tinylog
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);</pre><p><span>进入默认数据存储目录，查看底层数据存储形式，可以看出：TinyLog 引擎表每一列都对应的文件</span></p><pre>[root@cdh04 emp_tinylog]# pwd
/var/lib/clickhouse/data/default/emp_tinylog
[root@cdh04 emp_tinylog]# ll
总用量 28
-rw-r----- 1 clickhouse clickhouse  56 9月  17 14:33 age.bin
-rw-r----- 1 clickhouse clickhouse  97 9月  17 14:33 depart.bin
-rw-r----- 1 clickhouse clickhouse  60 9月  17 14:33 emp_id.bin
-rw-r----- 1 clickhouse clickhouse  70 9月  17 14:33 name.bin
-rw-r----- 1 clickhouse clickhouse  68 9月  17 14:33 salary.bin
-rw-r----- 1 clickhouse clickhouse 185 9月  17 14:33 sizes.json
-rw-r----- 1 clickhouse clickhouse  80 9月  17 14:33 work_place.bin
## 查看sizes.json数据
## 在sizes.json文件内使用JSON格式记录了每个．bin文件内对应的数据大小的信息
{
    "yandex":{
        "age%2Ebin":{
            "size":"56"
        },
        "depart%2Ebin":{
            "size":"97"
        },
        "emp_id%2Ebin":{
            "size":"60"
        },
        "name%2Ebin":{
            "size":"70"
        },
        "salary%2Ebin":{
            "size":"68"
        },
        "work_place%2Ebin":{
            "size":"80"
        }
    }
}</pre><p><span>当我们执行 ALTER 操作时会报错，说明该表引擎不支持 ALTER 操作</span></p><pre>-- 以下操作会报错：
-- DB::Exception: Mutations are not supported by storage TinyLog.
ALTER TABLE emp_tinylog DELETE WHERE emp_id = 5;
ALTER TABLE emp_tinylog UPDATE age = 30 WHERE emp_id = 4;</pre><p><strong>StripLog 表引擎使用</strong></p><p><span>相比 TinyLog 而言，StripeLog 拥有更高的查询性能（拥有. mrk 标记文件，支持并行查询），同时其使用了更少的文件描述符（所有数据使用同一个文件保存）。</span></p><pre>CREATE TABLE emp_stripelog (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=StripeLog;
-- 插入数据  
INSERT INTO emp_stripelog
VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_stripelog 
VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);
-- 查询数据
-- 由于是分两次插入数据，所以查询时会有两个数据块
cdh04 :) select * from emp_stripelog;

SELECT *
FROM emp_stripelog

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部   │ 50000.00 │
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>进入默认数据存储目录，查看底层数据存储形式</span></p><pre>[root@cdh04 emp_stripelog]# pwd
/var/lib/clickhouse/data/default/emp_stripelog
[root@cdh04 emp_stripelog]# ll
总用量 12
-rw-r----- 1 clickhouse clickhouse 673 9月  17 15:11 data.bin
-rw-r----- 1 clickhouse clickhouse 281 9月  17 15:11 index.mrk
-rw-r----- 1 clickhouse clickhouse  69 9月  17 15:11 sizes.json</pre><p><span>可以看出 StripeLog 表引擎对应的存储结构包括三个文件：</span></p><ul><li><p><span>data.bin：数据文件，所有的列字段使用同一个文件保存，它们的数据都会被写入 data.bin。</span></p></li><li><p><span>index.mrk：数据标记，保存了数据在 data.bin 文件中的位置信息 (每个插入数据块对应列的 offset)，利用数据标记能够使用多个线程，以并行的方式读取 data.bin 内的压缩数据块，从而提升数据查询的性能。</span></p></li><li><p><span>sizes.json：元数据文件，记录了 data.bin 和 index.mrk 大小的信息</span></p></li></ul><p><span>提示：<br>StripeLog 引擎将所有数据都存储在了一个文件中，对于每次的 INSERT 操作，ClickHouse 会将数据块追加到表文件的末尾<br>StripeLog 引擎同样不支持 ALTER UPDATE 和 ALTER DELETE 操作</span></p><p><span><strong>Log 表引擎使用</strong></span></p><p><span>Log 引擎表适用于临时数据，一次性写入、测试场景。Log 引擎结合了 TinyLog 表引擎和 StripeLog 表引擎的长处，是 Log 系列引擎中性能最高的表引擎。</span></p><pre>CREATE TABLE emp_log (
  emp_id UInt16 COMMENT '员工id',
  name String COMMENT '员工姓名',
  work_place String COMMENT '工作地点',
  age UInt8 COMMENT '员工年龄',
  depart String COMMENT '部门',
  salary Decimal32(2) COMMENT '工资'
  )ENGINE=Log;

INSERT INTO emp_log VALUES (1,'tom','上海',25,'技术部',20000),(2,'jack','上海',26,'人事部',10000);
INSERT INTO emp_log VALUES (3,'bob','北京',33,'财务部',50000),(4,'tony','杭州',28,'销售事部',50000);
-- 查询数据，
-- 由于是分两次插入数据，所以查询时会有两个数据块
cdh04 :) select * from emp_log;

SELECT *
FROM emp_log

┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart─┬───salary─┐
│      1 │ tom  │ 上海       │  25 │ 技术部 │ 20000.00 │
│      2 │ jack │ 上海       │  26 │ 人事部 │ 10000.00 │
└────────┴──────┴────────────┴─────┴────────┴──────────┘
┌─emp_id─┬─name─┬─work_place─┬─age─┬─depart───┬───salary─┐
│      3 │ bob  │ 北京       │  33 │ 财务部   │ 50000.00 │
│      4 │ tony │ 杭州       │  28 │ 销售事部 │ 50000.00 │
└────────┴──────┴────────────┴─────┴──────────┴──────────┘</pre><p><span>进入默认数据存储目录，查看底层数据存储形式</span></p><pre>[root@cdh04 emp_log]# pwd
/var/lib/clickhouse/data/default/emp_log
[root@cdh04 emp_log]# ll
总用量 32
-rw-r----- 1 clickhouse clickhouse  56 9月  17 15:55 age.bin
-rw-r----- 1 clickhouse clickhouse  97 9月  17 15:55 depart.bin
-rw-r----- 1 clickhouse clickhouse  60 9月  17 15:55 emp_id.bin
-rw-r----- 1 clickhouse clickhouse 192 9月  17 15:55 __marks.mrk
-rw-r----- 1 clickhouse clickhouse  70 9月  17 15:55 name.bin
-rw-r----- 1 clickhouse clickhouse  68 9月  17 15:55 salary.bin
-rw-r----- 1 clickhouse clickhouse 216 9月  17 15:55 sizes.json
-rw-r----- 1 clickhouse clickhouse  80 9月  17 15:55 work_place.bin</pre><p><span>Log 引擎的存储结构包含三部分：</span></p><ul><li><p><span>列. bin：数据文件，数据文件按列单独存储</span></p></li><li><p><span>__marks.mrk：数据标记，统一保存了数据在各个. bin 文件中的位置信息。利用数据标记能够使用多个线程，以并行的方式读取。.bin 内的压缩数据块，从而提升数据查询的性能。</span></p></li><li><p><span>sizes.json：记录了. bin 和__marks.mrk 大小的信息</span></p></li></ul><p><span>提示：<br>Log 表引擎会将每一列都存在一个文件中，对于每一次的 INSERT 操作，都会对应一个数据块</span></p><h3 id="sr-toc-6">外部集成表引擎</h3><p><span>ClickHouse 提供了许多与外部系统集成的方法，包括一些表引擎。这些表引擎与其他类型的表引擎类似，可以用于将外部数据导入到 ClickHouse 中，或者在 ClickHouse 中直接操作外部数据源。</span></p><p><span>例如直接读取 HDFS 的文件或者 MySQL 数据库的表。这些表引擎只负责元数据管理和数据查询，而它们自身通常并不负责数据的写入，数据文件直接由外部系统提供。目前 ClickHouse 提供了下面的外部集成表引擎：</span></p><ul><li><p><span>ODBC：通过指定 odbc 连接读取数据源</span></p></li><li><p><span> JDBC：通过指定 jdbc 连接读取数据源；</span></p></li><li><p><span>MySQL：将 MySQL 作为数据存储，直接查询其数据</span></p></li><li><p><span> HDFS：直接读取 HDFS 上的特定格式的数据文件；</span></p></li><li><p><span>Kafka：将 Kafka 数据导入 ClickHouse</span></p></li><li><p><span>RabbitMQ：与 Kafka 类似</span></p></li></ul><p>HDFS：使用方式</p><pre>ENGINE = HDFS(URI, format)</pre><ul><li><p><span>URI：HDFS 文件路径</span></p></li><li><p><span> format：文件格式，比如 CSV、JSON、TSV 等</span></p></li></ul><p><span>MySQL：使用方式</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1] [TTL expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2] [TTL expr2],
    ...
) ENGINE = MySQL('host:port', 'database', 'table', 'user', 'password'[, replace_query, 'on_duplicate_clause']);</pre><p><span>注意：对于 MySQL 表引擎，不支持 UPDATE 和 DELETE 操作，比如执行下面命令时，会报错：</span></p><pre>-- 执行更新
ALTER TABLE mysql_engine_table UPDATE name = 'hanmeimei' WHERE id = 1;
-- 执行删除
ALTER TABLE mysql_engine_table DELETE WHERE id = 1;

-- 报错
DB::Exception: Mutations are not supported by storage MySQL.</pre><p><span>JDBC：使用方式</span></p><p><span>JDBC 表引擎不仅可以对接 MySQL 数据库，还能够与 PostgreSQL 等数据库。为了实现 JDBC 连接，ClickHouse 使用了 clickhouse-jdbc-bridge 的查询代理服务。</span></p><p><span>首先我们需要下载 clickhouse-jdbc-bridge，然后按照 ClickHouse 的 github 中的步骤进行编译，编译完成之后会有一个 clickhouse-jdbc-bridge-1.0.jar 的 jar 文件，除了需要该文件之外，还需要 JDBC 的驱动文件，本文使用的是 MySQL，所以还需要下载 MySQL 驱动包。将 MySQL 的驱动包和 clickhouse-jdbc-bridge-1.0.jar 文件放在了 /opt/softwares 路径下，执行如下命令：</span></p><pre>[root@cdh04 softwares]# java -jar clickhouse-jdbc-bridge-1.0.jar  --driver-path .  --listen-host cdh04</pre><p><span>其中 --driver-path 是 MySQL 驱动的 jar 所在的路径，listen-host 是代理服务绑定的主机。默认情况下，绑定的端口是：9019。</span></p><p><span>然后我们再配置 /etc/clickhouse-server/config.xml，在文件中添加如下配置，然后重启服务。</span></p><pre>&lt;jdbc_bridge&gt;
    &lt;host&gt;cdh04&lt;/host&gt;
    &lt;port&gt;9019&lt;/port&gt;
&lt;/jdbc_bridge&gt;</pre><p><span>Kafka：使用方式</span></p><pre>CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = Kafka()
SETTINGS
    kafka_broker_list = 'host:port',
    kafka_topic_list = 'topic1,topic2,...',
    kafka_group_name = 'group_name',
    kafka_format = 'data_format'[,]
    [kafka_row_delimiter = 'delimiter_symbol',]
    [kafka_schema = '',]
    [kafka_num_consumers = N,]
    [kafka_max_block_size = 0,]
    [kafka_skip_broken_messages = N,]
    [kafka_commit_every_batch = 0,]
    [kafka_thread_per_consumer = 0]</pre><ul><li><p><span>kafka_broker_list ：逗号分隔的 brokers 地址 (localhost:9092).</span></p></li><li><p><span>kafka_topic_list ：Kafka 主题列表，多个主题用逗号分隔.</span></p></li><li><p><span>kafka_group_name ：消费者组.</span></p></li><li><p><span>kafka_format – Message format. 比如 JSONEachRow、JSON、CSV 等等</span></p></li></ul><p><span>注意点</span></p><p><span>当我们一旦查询完毕之后，ClickHouse 会删除表内的数据，其实 Kafka 表引擎只是一个数据管道，我们可以通过物化视图的方式访问 Kafka 中的数据。</span></p><ul><li><p><span>首先创建一张 Kafka 表引擎的表，用于从 Kafka 中读取数据</span></p></li><li><p><span>然后再创建一张普通表引擎的表，比如 MergeTree，面向终端用户使用</span></p></li><li><p><span>最后创建物化视图，用于将 Kafka 引擎表实时同步到终端用户所使用的表中</span></p></li></ul><h3 id="sr-toc-7">其他特殊的表引擎</h3><p><span><strong>Memory 表引擎</strong></span></p><p><span>Memory 表引擎直接将数据保存在内存中，数据既不会被压缩也不会被格式转换。当 ClickHouse 服务重启的时候，Memory 表内的数据会全部丢失。一般在测试时使用。</span></p><pre>CREATE TABLE table_memory (
    id UInt64,
    name String
  ) ENGINE = Memory();</pre><p><span><strong>Distributed 表引擎</strong></span></p><p><span>使用方式</span></p><p><span>Distributed 表引擎是分布式表的代名词，它自身不存储任何数据，数据都分散存储在某一个分片上，能够自动路由数据至集群中的各个节点，所以 Distributed 表引擎需要和其他数据表引擎一起协同工作。</span></p><p><span>所以，一张分布式表底层会对应多个本地分片数据表，由具体的分片表存储数据，分布式表与分片表是一对多的关系</span></p><p><span>Distributed 表引擎的定义形式如下所示</span></p><pre>Distributed(cluster_name, database_name, table_name[, sharding_key])</pre><p><span>各个参数的含义分别如下：</span></p><ul><li><p><span>cluster_name：集群名称，与集群配置中的自定义名称相对应。</span></p></li><li><p><span>database_name：数据库名称</span></p></li><li><p><span> table_name：表名称</span></p></li><li><p><span> sharding_key：可选的，用于分片的 key 值，在数据写入的过程中，分布式表会依据分片 key 的规则，将数据分布到各个节点的本地表。</span></p></li></ul><p><span>创建分布式表是读时检查的机制，也就是说对创建分布式表和本地表的顺序并没有强制要求。</span></p><p><span>同样值得注意的是，在上面的语句中使用了 ON CLUSTER 分布式 DDL，这意味着在集群的每个分片节点上，都会创建一张 Distributed 表，这样便可以从其中任意一端发起对所有分片的读、写请求。</span></p></section><section><h3 id="sr-toc-8">ClickHouse 常见问题</h3><p><span>1. 重启 ClickHouse 服务的时间会比较长：主要是由于该节点数据分片过多导致加载缓慢，耐心等待即可。</span></p><p><span>2. 数据插入报错 too many parts exception：主要是由于数据插入过于频繁，导致数据分片在后台 merge 缓慢，ClickHouse 启动自我保护机制，拒绝数据继续插入。此时可尝试增大插入数据的 batch_size (10 万) 并降低数据插入的频率（每秒 1 次）以缓解该问题。</span></p><p><span>3. 复制表变为只读：主要是由于 ClickHouse 无法连接 ZooKeeper 集群或 ZooKeeper 上该复制表的元数据丢失导致的，此时新数据无法插入该表。若要解决该问题，首先要检查 ZooKeeper 的连接状况，如果连接失败，则需进一步检查网络状态以及 ZooKeeper 的状态，连接恢复后，复制表就可以继续插入数据了。如果连接正常而元数据丢失，此时可以将复制表转为非复制表然后再进行数据插入操作。</span></p><p><span>4. 执行 JOIN 操作时内存超限：可能是由于 JOIN 前后的两个子查询中没有添加明确的过滤条件导致的，也有可能是由于 JOIN 的数据本身就很大，无法全部加载到内存。此时可以尝试增加过滤条件以减小数据量，或者适当修改配置文件中的内存限制，以装载更多的数据。</span></p><h3 id="sr-toc-9"><span>ClickHouse 问题排查方法</span></h3><p><span>1. 检查 ClickHouse 运行状态，确保服务正常运行。<br>2. 检查 ClickHouse 错误日志文件，寻找问题根源。<br>3. 检查系统日志文件 (/var/log/messages) 中与 ClickHouse 相关的记录，查看是否是系统操作导致 ClickHouse 异常。<br>4. 对于未知问题或 BUG，可以到官方 GitHub 仓库的 issue 下寻求帮助，需提供完整的问题描述和错误日志信息。</span></p><h3 id="sr-toc-10">直接写入的风险</h3><p><span>用户写入 ClickHouse 一般有两种选择：分布式表（i.e. Distributed），MergeTree 表：</span></p><p><span><strong>写入分布式表</strong>：</span></p><p><span>数据写入分布式表时，它会将数据先放入本地磁盘的缓冲区，再异步分发给所有节点上的 MergeTree 表。如果数据在同步给 MergeTree 里面之前这个节点宕机了，数据就可能会丢失；此时如果在失败后再重试，数据就可能会写重。因而，直接将数据写入用分布式表时，不太好保证数据准确性的和一致性。</span></p><p><span>当然这个分布式表还有其他问题，一般来说一个 ClickHouse 集群会配置多个 shard，每个 shard 都会建立 MergeTree 表和对应的分布式表。如果直接把数据写入分布式表，数据就可能会分发给每个 shard。假设有 N 个节点，每个节点每秒收到一个 INSERT Query，分发 N 次之后，一共就是每秒生成 NxN 个 part 目录。集群 shard 数越多，分发产生的小文件也会越多，最后会导致你写入到 MergeTree 的 Part 的数会特别多，最后会拖垮整个文件的系统。</span></p><p><span><strong>写入 MergeTree 表</strong>：</span></p><p><span>直接写入 MergeTree 表可以解决数据分发的问题，但是依然抗不住高频写入，如果业务方写入频次控制不好，仍然有可能导致 ClickHouse 后台合并的速度跟不上写入的速度，最后会使得文件系统压力过大。</span></p><p><span>所以一段时间内，我们禁止用户用 INSERT Query 把数据直接写入到 ClickHouse。</span></p><h3 id="sr-toc-11">典型案例 - 推荐系统</h3><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKicl3HxHQJ9UMZyzebib7zFc2rUZuAaOAflpgP2iczjcS9OSSG9NOHKaZw/640?wx_fmt=jpeg"></div></p><p><span><strong>业务需求</strong></span></p><p><span>随着 ClickHouse 支持的业务范围扩大，我们也决定支持一些实时的业务，第一个典型案例是推荐系统的实时数据指标：在字节跳动内部 AB 实验 应用非常广泛，特别用来验证推荐算法和功能优化的效果。</span></p><p><span>最初，公司内部专门的 AB 实验平台已经提供了 T+1 的离线实验指标，而推荐系统的算法工程师们希望能更快地观察算法模型、或者某个功能的上线效果，因此需要一份能够实时反馈的数据作为补充。他们大致有如下需求：</span></p><p><span>1. 研发同学有 debug 的需求，他们不仅需要看聚合指标，某些时间还需要查询明细数据。<br>2. 推荐系统产生的数据，维度和指标多达几百列，而且未来可能还会增加。<br>3. 每一条数据都命中了若干个实验，使用 Array 存储，需要高效地按实验 ID 过滤数据。<br>4. 需要支持一些机器学习和统计相关的指标计算（比如 AUC）。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKzyl73yRL2xW2gWUicmEqGBsZCpxVKibAClZ7Vx8RergK5nOSuUT6JpBA/640?wx_fmt=jpeg"></div></p><p><span>当时公司也有维护其他的分析型引擎，比如 Druid 和 ES。ES 不适合大批量数据的查询，Druid 则不满足明细数据查询的需求。而 ClickHouse 则刚好适合这个场景。</span></p><p><span>1. 对于明细数据这个需求：ClickHouse &gt; Druid。<br>2. 对于维度、指标多的问题，可能经常变动，我们可以用 Map 列的功能，很方便支持动态变更的维度和指标。<br>3. 按实验 ID 过滤的需求，则可以用 Bloom filter 索引。<br>4.AUC 之前则已经实现过。</span></p><p><span>这些需求我们当时刚好都能满足。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKtic5k0Rsh0E7HFNiadafeo3pIN7huWLVSp8Oz6aovdjjB8TCAH2icsX8w/640?wx_fmt=jpeg"></div></p><p><span><strong>方案设计和比较</strong></span></p><ul><li><p><span>常规方案：比较常规的思路，是用 Flink 消费 Kafka，然后通过 JDBC 写入 ClickHouse。</span></p></li><li><p><span>优点：各个组件职责划分清楚、潜在扩展性强</span></p></li><li><p><span>缺点：需要额外资源、写入频次不好控制、难以处理节点故障、维护成本较高</span></p></li><li><p><span>关键是后面两点：由于缺少事务的支持，实时导入数据时难以处理节点故障；ClickHouse 组技术栈以 C++ 为主，维护 Flink 潜在的成本比较高。</span></p></li></ul><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKPrkHWxCRfyMmTSEjLpBFUtbVlSjiaWLXaW87icYbH7BAYpKlkR4FtZxg/640?wx_fmt=jpeg"></div></p><p><span><strong>Kafka Engine 方案</strong></span></p><p><span>第二个方案，则是使用 ClickHouse 内置的 Kafka Engine。我们可以在 ClickHouse 服务内部建一张引擎类型为 Kafka 的表，该表会内置一个消费线程，它会直接请求 Kafka 服务，直接将 Kafka partition 的数据拉过来，然后解析并完成数据构建。对于一个 ClickHouse 集群而言，可以在每个节点上都建一张 Kafka 表，在每个节点内部启动一个消费者，这些消费者会分配到若干个 Kafka Partition，然后将数据直接消费到对应。</span></p><p><span>这样的架构相对于使用了 Flink 的方案来说更简单一些，由于少了一次数据传输，整体而言开销会相对小一些，对我们来说也算是补齐了 ClickHouse 的一部分功能（比如 Druid 也支持直接消费 Kafka topic）缺点就是未来可扩展性会更差一些，也略微增加了引擎维护负担。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKdtoeb5b2UQ67gk2n4U0dv7C17nLoAFct99FwLWOxic3X15mAMFju09g/640?wx_fmt=jpeg"></div></p><p><span><strong>Kafka engine 原理</strong></span></p><p><span>这里简单介绍一下如何使用 kafka 引擎，为了能让 ClickHouse 消费 Kafka 数据，我们需要三张表：首先需要一张存数据的表也就是 MergeTree；然后需要一张 Kafka 表，它负责描述 Topic、消费数据和解析数据；最后需要一个物化视图去把两张表关联起来，它也描述了数据的流向，某些时候我们可以里面内置一个 SELECT 语句去完成一些 ETL 的工作。只有当三张表凑齐的时候我们才会真正启动一个消费任务。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKUkkxz42Xw5RMQPpibq7XK1jZnzcibhiboZ5jVxiczLZuh5dh5LOEDmZoyg/640?wx_fmt=jpeg"></div></p><p><span>这是一个简单的例子：最后呈现的效果，就是通过表和 SQL 的形式，描述了一个 kafka -&gt; ClickHouse 的任务。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKHE3vARnemCbmDPPBaLTfibOX6ZLfKVbAz7VGlMTcf5iabIfb4G4OFSgg/640?wx_fmt=jpeg"></div></p><p><span><strong>最终效果</strong></span></p><p><span>由于外部写入并不可控、技术栈上的原因，我们最终采用了 Kafka Engine 的方案，也就是 ClickHouse 内置消费者去消费 Kafka。整体的架构如图：</span></p><p><span>1. 数据由推荐系统直接产生，写入 Kafka。这里推荐系统做了相应配合，修改 Kafka Topic 的消息格式适配 ClickHouse 表的 schema。<br>2. 敏捷 BI 平台也适配了一下实时的场景，可以支持交互式的查询分析。<br>3. 如果实时数据有问题，也可以从 Hive 把数据导入至 ClickHouse 中，不过这种情况不多。除此之外，业务方还会将 1% 抽样的离线数据导入过来做一些简单验证，1% 抽样的数据一般会保存更久的时间。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKznYo2zTCbbGVx2mpicgAtTW9wSQQMgHa9GyMs1Z0ibibZuqJD91z7jaXA/640?wx_fmt=jpeg"></div></p><p><span>我们在支持推荐系统的实时数据时遇到过不少问题，其中最大的问题随着推荐系统产生的数据量越来越大，单个节点的消费能力也要求越来越大：</span></p><h3 id="sr-toc-12"><span>改进一：异步构建索引</span></h3><p><span>第一做的改进是将辅助索引的构建异步化了：在社区实现中，构建一个 Part 分为三步：（1）解析输入数据生成内存中数据结构的 Block；（2）然后切分 Block，并按照表的 schema 构建 columns 数据文件；（3） 最后扫描根据 skip index schema 去构建 skip index 文件。三个步骤完成之后才会算 Part 文件构建完毕。</span></p><p><span>目前字节内部的 ClickHouse 并没有使用社区版本的 skip index，不过也有类似的辅助索引（e.g. Bloom Filter Index, Bitmap Index）。构建 part 的前两步和社区一致，我们构建完 columns 数据之后用户即可正常查询，不过此时的 part 不能启用索引。此时，再将刚构建好数据的 part 放入到一个异步索引构建队列中，由后台线程构建索引文件。这个改进虽然整体的性能开销没有变化，但是由于隐藏了索引构建的时间开销，整体的写入吞吐量大概能提升 20%</span><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKLkYu9UbPTyfNMUUwuXL9iaXicaicNibn22eWWsnttSWKCaHulDibadH9Kyw/640?wx_fmt=jpeg"></div></p><h3 id="sr-toc-13"><span>改进二：支持多线程消费</span></h3><p><span>第二个改进是在 Kafka 表内部支持了多线程的消费：</span></p><p><span>目前实现的 Kafka 表，内部默认只会有一个消费者，这样会比较浪费资源并且性能达不到性能要求。一开始我们可以通过增大消费者的个数来增大消费能力，但社区的实现一开始是由一个线程去管理多个的消费者，多个的消费者各自解析输入数据并生成的 Input Stream 之后，会由一个 Union Stream 将多个 Input Stream 组合起来。这里的 Union Stream 会有潜在的性能瓶颈，多个消费者消费到的数据最后仅能由一个输出线程完成数据构建，所以这里没能完全利用上多线程和磁盘的潜力。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKiaomSxYq6bBmNY27AYibQicdOJoaQlwktKHVPYM6QEGU04gJu3DLjdTJw/640?wx_fmt=jpeg"></div></p><p><span>一开始的解决方法，是建了多张 Kafka Table 和 Materialized View 写入同一张表，这样就有点近似于多个 INSERT Query 写入了同一个 MergeTree 表。当然这样运维起来会比较麻烦，最后我们决定通过改造 Kafka Engine 在其内部支持多个消费线程，简单来说就是每一个线程它持有一个消费者，然后每一个消费者负责各自的数据解析、数据写入，这样的话就相当于一张表内部同时执行多个的 INSERT Query，最后的性能也接近于线性的提升。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKYic0neDw3llFbajDzoRHZzjoGSlKayGibQkVlTlqUrO7fUA7mJrMgfBA/640?wx_fmt=jpeg"></div></p><h3 id="sr-toc-14"><span>改进三：增强容错处理</span></h3><p><span>对于一个配置了主备节点的集群，我们一般来说只会写入一个主备其中一个节点。</span></p><p><span>为什么呢？因为一旦节点故障，会带来一系列不好处理的问题。（1）首先当出现故障节点的时候，一般会替换一个新的节点上来，新替换的节点为了恢复数据，同步会占用非常大的网络和磁盘 IO，这种情况，如果原来主备有两个消费者就剩一个，此时消费性能会下降很大（超过一倍），这对于我们来说是不太能接受的。（2）早先 ClickHouse Kafka engine 对 Kafka partition 的动态分配支持不算好，很有可能触发重复消费，同时也无法支持数据分片。因此我们默认使用静态分配，而静态分配不太方便主备节点同时消费。（3）最重要的一点，ClickHouse 通过分布式表查询 ReplicatedMergeTree 时，会基于 log delay 来计算 Query 到底要路由到哪个节点。一旦在主备同时摄入数据的情况下替换了某个节点，往往会导致查询结果不准。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKN8e1G8JA3RGKkCLN99lyrTZibz8YXCS9OVcGgyrWLDcS9luUpnzJ5bg/640?wx_fmt=jpeg"></div></p><p><span>这里简单解释一下查询不准的场景。一开始我们有两副本，Replica #1 某时刻出现故障，于是替换了一个新的节点上来，新节点会开始同步数据，白框部分是已经同步过的，虚线黄框是正在恢复的数据，新写入的白色框部分就是新写入的数据。如果此时两个机器的数据同步压力比较大或查询压力比较大，就会出现 Replica #1 新写入的数据没有及时同步到 Replica #2 ，也就是这个绿框部分，大量历史数据也没有及时同步到对应的黄框部分，这个情况下两个副本都是缺少数据的。因此无论是查 Replica #1 还是 Replica #2 得到的数据都是不准的。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKEJBiaeThE37kf7VbUewfqEPtzEbicic5K2oRjaIsYwu6CialKMDhJ66l3A/640?wx_fmt=jpeg"></div></p><p><span>对于替换节点导致查询不准问题，我们先尝试解决只有一个节点消费的问题。为了避免两个节点消费这个数据，改进版的 Kafka engine 参考了 ReplicatedMergeTree 基于 ZooKeeper 的选主逻辑。对于每一对副本的一对消费者，（如上图 A1 A2)，它们会尝试在 ZooKeeper 上完成选主逻辑，只有选举称为主节点的消费者才能消费，另一个节点则会处于一个待机状态。一旦 Replica #1 宕机，（如上图 B1 B2 ），B1 已经宕机连不上 ZooKeeper 了，那 B2 会执行选主逻辑拿到 Leader 的角色，从而接替 B1 去消费数据。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKjwVbsCG2a4KiaLXmqRicBZnyGaKjWpoiaO6og7Lf7KEZlk5VzwAia9y9jg/640?wx_fmt=jpeg"></div></p><p><span>当有了前面的单节点消费机制，就可以解决查询的问题了。假设 Replica #1 是一个刚换上来的节点，它需要同步黄框部分的数据，这时候消费者会与 ReplicatedMergeTree 做一个联动，它会检测其对应的 ReplicatedMergeTree 表数据是否完整，如果数据不完整则代表不能正常服务，此时消费者会主动出让 Leader，让副本节点上的消费者也就是 Replica #2 上的 C2 去消费数据。</span></p><p><span>也就是说，我们新写入的数据并不会写入到缺少数据的节点，对于查询而言，由于查询路由机制的原因也不会把 Query 路由到缺少数据的节点上，所以一直能查询到最新的数据。这个机制设计其实和分布式表的查询写入是类似的，但由于分布表性能和稳定原因不好在线上使用，所以我们用这个方式解决了数据完整性的问题。</span></p><p><span>小结一下上面说的主备只有一个节点消费的问题</span></p><p><span>配置两副本情况下的 Kafka engine，主备仅有一个节点消费，另一个节点待机。</span></p><ul><li><p><span>如果有故障节点，则自动切换到正常节点消费；</span></p></li><li><p><span>如果有新替换的节点无法正常服务，也切换到另一个节点；</span></p></li><li><p><span>如果不同机房，则由离 Kafka 更近的节点消费，减少带宽消耗；</span></p></li><li><p><span>否则，由类似 ReplicatedMergeTree 的 ZooKeeper Leader 决定。</span></p></li></ul><h3 id="sr-toc-15"><span>典型案例 - 广告投放实时数据</span></h3><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKMzRDJM2oC2vapGVGicVY74gORH0qhfMTnvryh2L6jSWMmvYEFM2cgAw/640?wx_fmt=jpeg"></div></p><p><span><strong>业务背景</strong></span></p><p><span>第二个典型案例是关于广告的投放数据，一般是运营同学需要查看广告投放的实时效果。由于业务的特点，当天产生的数据往往会涉及到多天的数据。这套系统原来基于 Druid + Superset 实现的，Druid 在这个场景会有一些难点：</span></p><p><span>难点一：产生的实时数据由于涉及到较多的时间分区，对于 Druid 来说可能会产生很多 segment，如果写入今天之前的数据它需要执行一些 MR 的任务去把数据合并在一起，然后才能查历史的数据，这个情况下可能会导致今天之前的数据查询并不及时。</span></p><p><span>难点二：业务数据的维度也非常多，这种场景下使用 Druid 预聚合的效率并不高。</span></p><p><span>对比 Druid 和 ClickHouse 的特点和性能后，我们决定将该系统迁移到 ClickHouse + 自研敏捷 BI。最后由于维度比较多，并没有采用预聚合的方式，而是直接消费明细数据。</span></p><p><span>因为业务产生的数据由 (1) 大量的当天数据和 (2) 少量的历史数据 组成。历史数据一般涉及在 3 个月内，3 个月外的可以过滤掉，但是即便是 3 个月内的数据，在按天分区的情况下，也会因为单批次生成的 parts 太多导致写入性能有一定下降。所以我们一开始是把消费的 block_size 调的非常大，当然这样也有缺点，虽然整个数据吞吐量会变大，但是由于数据落盘之前是没法查到数据的，会导致整体延时更大。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKm6jPjdUCQibKgKfT5H8yibaXaZ0ehv5aOIGaKymWkEwQibbSKq25GhENw/640?wx_fmt=jpeg"></div></p><p><span><strong>改进一：Buffer Engine 增强</strong></span></p><p><span>单次写入生成过多 parts 的问题其实也有方案解决。社区提供了 Buffer Engine，可以在内存中缓存新写入的数据，从而缓解 parts 高频生成的问题。不过社区文档也介绍了，Buffer Engine 的缺点是不太能配合 ReplicatedMergeTree 一起工作。如果数据写入到了一对副本（如上图），那么 Buffer #1 和 Buffer #2 缓存的数据其实是不一样的，两个 Buffer 仅缓存了各自节点上新写入的数据。对于某个查询而言，如果查询路由到 Replica #1，那查询到的数据是 MergeTree 部分的数据加上 Buffer #1，这部分的数据其实是和 Replica #2 的 MergeTree 加上 Buffer2 的数据并不等价，即便 MergeTree 的数据是相同的。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UK2sAMvLTNfXzic3tIz9cLlWaTU9fmTGctJz2EBKRZmJS2QGToVIKgTEA/640?wx_fmt=jpeg"></div></p><p><span>针对社区版 Buffer Table 存在的问题，我们也做了相应改进。</span></p><p><span>(1) 我们选择将 Kafka/Buffer/MergeTree 三张表结合起来，提供的接口更加易用；<br>(2) 把 Buffer 内置到 Kafka engine 内部， 作为 Kafka engine 的选项可以开启 / 关闭；<br>(3) 最重要的是支持了 ReplicatedMergeTree 情况下的查询；<br>(4) Buffer table 内部类似 pipeline 模式处理多个 Block。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKjoVkgohIqju5yYbKQCfqqd4XKFLOqEFNU9pgib3vA6Anu2uP9bBSXjw/640?wx_fmt=jpeg"></div></p><p><span>这里解释一下我们如何解决查询一致性的问题。前面提到，目前一对副本仅有一个节点在消费，所以一对副本的两个 Buffer 表，只有一个节点有数据。比如 Consumer #1 在消费时，Buffer #1 就是有缓存数据，而 Buffer #2 则是空的。</span></p><p><span>对于任何发送到 Replica #1 的查询，数据肯定是完整的；而对于发送到 Replica #2 的查询则会额外构建一个特殊的查询逻辑，从另一个副本的 Buffer #1 读取数据。这样发送到 Replica #2 的查询，获取到数据就是绿框部分也就是 Replica #2 的 MergeTree 再加上 Replica #1 的 Buffer，它的执行效果是等价于发送到 Replica #1 的查询。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKZxwn3jQFibejfKIcCeXPiaoKicgALPnkFGkEvC3kXsWnPG0IiaOfCicN63A/640?wx_fmt=jpeg"></div></p><p><span><strong>改进二：消费稳定性增强</strong></span></p><p><span>由于业务数据的分区比较分散，某个批次的写入往往生成多个 parts。以上图为例，如果某个批次消费到 6 条数据，假设可以分为 3 个 part（比如涉及到昨天、今天、大前天三天数据），第一条和第四条写入到第一个 part，第二第五条数据写入到第二个 part，这时候服务宕机了，没有及时写入第三第六条数据。</span></p><p><span>由于 ClickHouse 没有事务的支持，所以重启服务后再消费时，要么会丢失数据 {3, 6}，要么会重复消费 {1, 4, 2, 5}。对于这个问题我们参考了 Druid 的 KIS 方案自己管理 Kafka Offset, 实现单批次消费 / 写入的原子语义：实现上选择将 Offset 和 Parts 数据绑定在一起，增强了消费的稳定性。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKnZdNv0aqFxGGvFiaVjMjrvbk6j62UaIZzDomfwKibseeS4PtOVvZ2ZRw/640?wx_fmt=jpeg"></div></p><p><span>每次消费时，会默认创建一个事务，由事务负责把 Part 数据和 Offset 一同写入磁盘中：如果消费的途中写入 part #1 part #2 失败了，事务回滚的时候会把 Offset 和 part #1 part #2 一并回滚，然后从 Part #1 的位置重新消费并重试提交 offset 1-3。</span></p></section><section><h4 id="sr-toc-16">性能奥秘</h4><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UK6OmucmxW7cIwTnQRaNafCFVWyQ3qtkw0bNC4UBwu73MVl28ibCibH4oQ/640?wx_fmt=jpeg"></div></p><p><span>如上述表格所示，传统的 MySQL 数据库的每一行数据都是物理的存储在一起的。如果我要取 id 等于 10000 这一条数据的 name 列，那我就必须要把这一行数据读取出来，然后取 name 列。</span></p><p><span>再比如，下面的 SQL：</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKCYBKR4DToGHEfxRR8FFdHIAfwc4ur1xMbBfwnFfXos9vNtgtlB6yqQ/640?wx_fmt=png"></div></p><p><span>在众多的数据中，我只取一列，但我需要把每条数据都读取出来。</span></p><p><span>基于上面传统数据库的一些特点，ClickHouse 另辟蹊径，推出了列式存储。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKQOQF9kyyBBiaEjbVPzTtldCoM6ch4eibdm81BPnYtv3vCRuvA4KaIiacQ/640?wx_fmt=png"></div></p><p><span>看上图的列式存储示例，完全和 MySQL 等数据库不同。当我执行下面的 SQL 时，查询效率非常的高！</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UK9LZsnYdEDUSMUVrO0HhQfkYFI857IQvQt3mC3d6DmJG8sh1A0zFMDg/640?wx_fmt=png"></div></p><p><span>由于 name 列的数据都存储在一起，因此效率大大的超过了传统的数据库。</span></p><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKc2y1mHvbz0YU5NL9jocq90icfa1tDkr7FjYgeztvmKUIKIfWKKDZ97A/640?wx_fmt=jpeg"></div></p><p><span>除了逻辑上的不同，磁盘上的组织结构也大不一样。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKG5CgajtQR7zHVECUlGjDxBrJekN7Be3uu9oSn6Nv5mCO9HJjJA0unA/640?wx_fmt=jpeg"></div></p><p><span>除了列式存储上的不同，ClickHouse 还有高效的数据压缩，默认使用 LZ4 算法，总体压缩比可达 8:1。ClickHouse 还采用了分布式多主架构提高并发性能，ClickHouse 使读请求可以随机打到任意节点，均衡读压力，写请求也无需转发到 master 节点，不会产生单点压力。</span></p><p><span>ClickHouse 还有向量引擎，利用 SIMD 指令实现并行计算。对多个数据块来说，一次 SIMD 指令会同时操作多个块，大大减少了命令执行次数，缩短了计算时间。向量引擎在结合多核后会将 ClickHouse 的性能淋漓尽致的发挥出来。</span></p><p><span>ClickHouse 在索引上也有不同，采用了稀疏索引及跳数索引。同时还有很多 MergeTree，提供海量业务场景支持。</span></p><p><span>基于以上特点，ClickHouse 在包含 count、sum、group by、order by 等情况的查询对比，同等条件下，ClickHouse 的查询性能异常强悍，官网上的数据显示，是同等条件下 MySQL 的 831 倍。</span></p><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2PfiaIzmcJ80ibHh8SiaQcn0UKM5qiadFoy1xurMOibafWEtVPp8SPxbkDc8S5nTmQdicKzUr594iadwvV6w/640?wx_fmt=jpeg"></div></p></section><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/pDnsbKziazM6a4vcgFDmOSssrrrgcOhKgrRSZeMU056xBA25Nq8xbMzPd68azJIoJ8AhKH7wY0AV4h5Eyb52Ybw/640?wx_fmt=jpeg"></div></p><section data-mpa-template="t" mpa-from-tpl="t"><section mpa-from-tpl="t"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-role="outer" label="Powered by 135editor.com"><section data-mpa-template="t" mpa-from-tpl="t"><section mpa-from-tpl="t"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-mpa-template="t" data-from="yb-recommend-list"><section data-role="outer"><section><br></section><p><div class="sr-rd-content-center"><img class="sr-rd-content-img-load" src="https://mmbiz.qpic.cn/mmbiz_jpg/pDnsbKziazM4NjE0BMTUTbzr3c71B2Hqm0R6JERgBqChAr9gWp6zib1TZlQHkqym6cnj1miaI2nHTFcUORkh9scfQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></div></p><p><span><strong>扩展学习</strong></span><strong>：</strong><span>公众号后台回复 “</span><span><strong>画像</strong></span><span>”，即可领取画像标签实践 PPT。</span><span>达摩盘</span><span>标签详情. xlsx，后台私信 + v：dataai24 领取。回复 “<strong>ck</strong>”，领取 clickhouse 学习资料。</span></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzA3MDAxNzY4OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/pDnsbKziazM71Wp5E3LrgBz5VRytf1tvicemrRrlaXXtyicVxEQoAib2OnvVOPrdexUqepsEicxNOu6SCCiczgQ3h0wg/0?wx_fmt=png&amp;wx_head=1" data-nickname="大数据技术团队" data-alias="DT_lovers" data-signature="专注大数据、数据分析、数据仓库、数据中台、数据科学、Flink，AI人工智能与面试经验，副业赚钱与职业规划。" data-from="2" has-insert-preloading="1" data-index="2" data-origin_num="13" data-isban="0" data-is_biz_ban="0"></mp-common-profile></section><section><section powered-by="xiumi.us"><section><section><p>往期精选</p></section><img data-ratio="2" data-type="png" data-w="50" data-src="https://mmbiz.qpic.cn/mmbiz_png/8AsYBicEePu5o0TDuxSakLZv5TSeXCMHeWbN0NVvJTsD69ZibgQFefxKZElZmPPhrv3916LFUsBUS0JTqu7ansHg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" _width="0.8em" crossorigin="anonymous" alt="图片" src="https://mmbiz.qpic.cn/mmbiz_png/8AsYBicEePu5o0TDuxSakLZv5TSeXCMHeWbN0NVvJTsD69ZibgQFefxKZElZmPPhrv3916LFUsBUS0JTqu7ansHg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" class="sr-rd-content-nobeautify"></section><section><section><section><svg viewBox="0 0 1 1"></svg></section></section></section></section></section><section data-recommend-type="list-title" data-recommend-tid="6" data-mpa-template="t" data-mid="" data-from="yb-recommend"><section data-mid=""><section data-mid=""><section data-mid=""><br></section></section></section></section><section data-recommend-type="list-title" data-recommend-tid="6" data-mpa-template="t" data-mid="" data-from="yb-recommend"><section data-mid=""><section data-mid=""><section data-mid="" style="margin: 0px 0px -14px;padding: 4px 22px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;height: 28px;font-size: 14px;font-weight: 500;color: rgb(19, 52, 86);line-height: 20px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/sUbvrqLicbpzB81mjeBxPuxnYdalGxNnJo30L2Hq3WwGficcq8w5YJkLeXnsNHocN53k55TfN5mBpCdicGRyfDg1g/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;z-index: 10;"><p data-mid="">往期推荐</p></section></section><section data-mid=""><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496195_1" data-recommend-article-time="1657845360" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM6Z1yRiaOnNQZOJftaSE1qFChmSotK4ziaXycolEYeVxd0SLp61icicC2azEELEMADFbZ3Q7ZGwftBa6g/0?wx_fmt=jpeg" data-recommend-article-title="大数据平台核心架构图鉴，建议收藏！" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496195&amp;idx=1&amp;sn=61a3dc5d856c8f312a07ebbf7fe141ef&amp;chksm=9ec185f5a9b60ce352ae8c21d95dd0ada35d9b84689e8c7c09e24cd8af41be554e0106c39061#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496195&amp;idx=1&amp;sn=61a3dc5d856c8f312a07ebbf7fe141ef&amp;chksm=9ec185f5a9b60ce352ae8c21d95dd0ada35d9b84689e8c7c09e24cd8af41be554e0106c39061&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">大数据平台核心架构图鉴</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496432_1" data-recommend-article-time="1659918960" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM5jw9ur1hW8Clqibc9gIweozCveiauiahriboBr7HV9hN4RFfoC49shiaTYibHKTWibeyENiaVcHIsE6Qtbfw/0?wx_fmt=jpeg" data-recommend-article-title="数仓两级：用户画像&amp;数据质量" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496432&amp;idx=1&amp;sn=63e09e3f32265d985711601ca0489db1&amp;chksm=9ec18506a9b60c10be2c220446b5862a866ecfce1538a8f098d38cfe4ef029fe9430c31451ae#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496432&amp;idx=1&amp;sn=63e09e3f32265d985711601ca0489db1&amp;chksm=9ec18506a9b60c10be2c220446b5862a866ecfce1538a8f098d38cfe4ef029fe9430c31451ae&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">数仓：用户画像 &amp; 数据质量</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496223_1" data-recommend-article-time="1658104560" data-recommend-article-cover="https://mmbiz.qpic.cn/mmbiz_jpg/pDnsbKziazM7Yf641XuiamT8aNuqZqud0vJZIvSia73iavk6eXUMarwPUfFrgSziaa9eia1VZe9DOdHv1STCtVVFZflg/0?wx_fmt=jpeg" data-recommend-article-title="大数据工程师：岗位方向与技术栈" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496223&amp;idx=1&amp;sn=3a756c72316b154084dac1ecd68de959&amp;chksm=9ec185e9a9b60cffe4cab7fae9a9c44e0dd7b6255d9c219eb559af293a00112544004ec2df8a#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496223&amp;idx=1&amp;sn=3a756c72316b154084dac1ecd68de959&amp;chksm=9ec185e9a9b60cffe4cab7fae9a9c44e0dd7b6255d9c219eb559af293a00112544004ec2df8a&amp;scene=21#wechat_redirect" data-linktype="2" localeditorid="jphabh7oleo0000000" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">大数据工程师方向 &amp; 技术栈</p></section></a><span></span></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496396_1" data-recommend-article-time="1659400560" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM4OEKoHAjIupchZklKSOBsw6IQQOOn53MDyUp5iam1rm8zNyR9dCpXfTHF43VWyTib6uvAG52GfA2AA/0?wx_fmt=jpeg" data-recommend-article-title="腾讯云实时数仓建设实践（PPT附下载）" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496396&amp;idx=1&amp;sn=f20648fc49c48f3eb6e046552a4bf1b4&amp;chksm=9ec1853aa9b60c2cfbfcb3a5067e9ee3bf2fd98e4c2b9bbacb6baa72aa84f1005cbf5844e9cb#rd"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid=""><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496396&amp;idx=1&amp;sn=f20648fc49c48f3eb6e046552a4bf1b4&amp;chksm=9ec1853aa9b60c2cfbfcb3a5067e9ee3bf2fd98e4c2b9bbacb6baa72aa84f1005cbf5844e9cb&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes">实时数仓建设与实践</a>.PPT </p></section></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496389_1" data-recommend-article-time="1659054960" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM5yIJjibOFPbpLnfZEOxHkMmibkD5c7AaVZyGhmabL5gDwfMpUdVAPSulyLof44XDWz3LKwSIJ1wZiaQ/0?wx_fmt=jpeg" data-recommend-article-title="数据分析7大常用方法和工具！" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496389&amp;idx=1&amp;sn=afb0f3a84cca0521f9ac23bcbc731538&amp;chksm=9ec18533a9b60c258d1a55c15c3899eab2232be89692ca2cf56e4a9f68665f50d04960dad331#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496389&amp;idx=1&amp;sn=afb0f3a84cca0521f9ac23bcbc731538&amp;chksm=9ec18533a9b60c258d1a55c15c3899eab2232be89692ca2cf56e4a9f68665f50d04960dad331&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">大数据分析 7 大工具</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496388_1" data-recommend-article-time="1658968560" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM5yIJjibOFPbpLnfZEOxHkMmibkD5c7AaVZyGhmabL5gDwfMpUdVAPSulyLof44XDWz3LKwSIJ1wZiaQ/0?wx_fmt=jpeg" data-recommend-article-title="大数据分析常用10大方法！" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496388&amp;idx=1&amp;sn=021c5994eacdb26dcf68b4d83538aa11&amp;chksm=9ec18532a9b60c2414a0304d54417abaf8612706d38c8375af72fca8fe0b0cd8a643be677973#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496388&amp;idx=1&amp;sn=021c5994eacdb26dcf68b4d83538aa11&amp;chksm=9ec18532a9b60c2414a0304d54417abaf8612706d38c8375af72fca8fe0b0cd8a643be677973&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">大数据分析 10 大方法</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496224_1" data-recommend-article-time="1658190960" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM6Z1yRiaOnNQZOJftaSE1qFCl8PTDHmrbG2hyRJGfftaFHmdFRibv5xXZickzNuVOJu4hNGh1lRj692w/0?wx_fmt=jpeg" data-recommend-article-title="学 SQL 必须了解的 10 个高级概念" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496224&amp;idx=1&amp;sn=ccd473522257fd8102eb3f31df10a405&amp;chksm=9ec185d6a9b60cc01bcb21fd93d898e99a2936eb11aa498f488d51ec9bf2b76c57563451ba58#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496224&amp;idx=1&amp;sn=ccd473522257fd8102eb3f31df10a405&amp;chksm=9ec185d6a9b60cc01bcb21fd93d898e99a2936eb11aa498f488d51ec9bf2b76c57563451ba58&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">学 SQL10 个高级概念</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496127_1" data-recommend-article-time="1657154160" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM4WFVVjUOTgibBKQL1YHI36dtlg5w9jBNeP3eBU5UXUhUqTiaFcup32gNscl8HXyLPABiblUm4TYqhow/0?wx_fmt=jpeg" data-recommend-article-title="HiveSQL高级进阶技巧案例（中）" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496127&amp;idx=1&amp;sn=30d0d0f1e029c98177b422eaaedb1056&amp;chksm=9ec18649a9b60f5fab570d0c77aaf30fc29860db5cfa38946fe83359c901736a483b58ca2b07#rd"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496127&amp;idx=1&amp;sn=30d0d0f1e029c98177b422eaaedb1056&amp;chksm=9ec18649a9b60f5fab570d0c77aaf30fc29860db5cfa38946fe83359c901736a483b58ca2b07&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid="">HiveSQL 高级进阶技巧案例</p></section></a></section><section data-mpa-template="t" data-recommend-article-type="list-title" data-recomment-template-id="6" data-recommend-article-id="2247496416_1" data-recommend-article-time="1659573314" data-recommend-article-cover="https://mmbiz.qlogo.cn/mmbiz_jpg/pDnsbKziazM52kP7pUL5C16nqCYgKH2xdPLRLaVVLCziae2F2u6Iib7yhhXemGRCATlgSP82I47UrEwKIuYpVsENA/0?wx_fmt=jpeg" data-recommend-article-title="大数据工程师：4大方向、薪酬对比与技术栈" data-recommend-article-content-url="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496416&amp;idx=1&amp;sn=e63b53266400bae11b5094c25fe09f58&amp;chksm=9ec18516a9b60c0007a080bad7c4b0cc27d08e07efa5d93461adef4ee181a4accb0ac3ceaa48#rd"><section data-recommend-title="t" data-recommend-content="t" data-mid=""><p data-mid=""><a href="https://mp.weixin.qq.com/s?__biz=MzA3MDAxNzY4OQ==&amp;mid=2247496416&amp;idx=1&amp;sn=e63b53266400bae11b5094c25fe09f58&amp;chksm=9ec18516a9b60c0007a080bad7c4b0cc27d08e07efa5d93461adef4ee181a4accb0ac3ceaa48&amp;scene=21#wechat_redirect" data-linktype="2" one-link-mark="yes">大数据工程师：4 大方向、薪酬对比与技术栈</a></p></section></section></section></section></section><p><div class="sr-rd-content-center"><img class="" src="https://mmbiz.qpic.cn/mmbiz_gif/1OYP1AZw0W0VDxHgxRKlOPe2QOFjWpAcoanxPrpOgbPLMMEIa8UA8hiaqAhBE680mF34HsctakePVPy41ovOplw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></div></p><pre>点个赞+在看，你最好看&nbsp;
👇
</pre></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".1"><outline class="toc-level-h3" data-reactid=".1.0" style="width: 155px;"><active data-reactid=".1.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".1.0.1"><span data-reactid=".1.0.1.0">Why ClickHouse</span></a></outline><outline class="toc-level-h3" data-reactid=".1.1" style="width: 155px;"><active data-reactid=".1.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".1.1.1"><span data-reactid=".1.1.1.0">ClickHouse 特性</span></a></outline><outline class="toc-level-h3" data-reactid=".1.2" style="width: 155px;"><active data-reactid=".1.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".1.2.1"><span data-reactid=".1.2.1.0">ClickHouse 配置文件</span></a></outline><outline class="toc-level-h3" data-reactid=".1.3" style="width: 155px;"><active data-reactid=".1.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".1.3.1"><span data-reactid=".1.3.1.0">ClickHouse 表引擎</span></a></outline><outline class="toc-level-h3" data-reactid=".1.4" style="width: 155px;"><active data-reactid=".1.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".1.4.1"><span data-reactid=".1.4.1.0">MergeTree 系列引擎</span></a></outline><outline class="toc-level-h3" data-reactid=".1.5" style="width: 155px;"><active data-reactid=".1.5.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".1.5.1"><span data-reactid=".1.5.1.0">Log 系列表引擎</span></a></outline><outline class="toc-level-h3" data-reactid=".1.6" style="width: 155px;"><active data-reactid=".1.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".1.6.1"><span data-reactid=".1.6.1.0">外部集成表引擎</span></a></outline><outline class="toc-level-h3" data-reactid=".1.7" style="width: 155px;"><active data-reactid=".1.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".1.7.1"><span data-reactid=".1.7.1.0">其他特殊的表引擎</span></a></outline><outline class="toc-level-h3" data-reactid=".1.8" style="width: 155px;"><active data-reactid=".1.8.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-8" data-reactid=".1.8.1"><span data-reactid=".1.8.1.0">ClickHouse 常见问题</span></a></outline><outline class="toc-level-h3" data-reactid=".1.9" style="width: 155px;"><active data-reactid=".1.9.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-9" data-reactid=".1.9.1"><span data-reactid=".1.9.1.0">ClickHouse 问题排查方法</span></a></outline><outline class="toc-level-h3" data-reactid=".1.a" style="width: 155px;"><active data-reactid=".1.a.0"></active><a class="toc-outline-theme-github" href="#sr-toc-10" data-reactid=".1.a.1"><span data-reactid=".1.a.1.0">直接写入的风险</span></a></outline><outline class="toc-level-h3" data-reactid=".1.b" style="width: 155px;"><active data-reactid=".1.b.0"></active><a class="toc-outline-theme-github" href="#sr-toc-11" data-reactid=".1.b.1"><span data-reactid=".1.b.1.0">典型案例 - 推荐系统</span></a></outline><outline class="toc-level-h3" data-reactid=".1.c" style="width: 155px;"><active data-reactid=".1.c.0"></active><a class="toc-outline-theme-github" href="#sr-toc-12" data-reactid=".1.c.1"><span data-reactid=".1.c.1.0">改进一：异步构建索引</span></a></outline><outline class="toc-level-h3" data-reactid=".1.d" style="width: 155px;"><active data-reactid=".1.d.0"></active><a class="toc-outline-theme-github" href="#sr-toc-13" data-reactid=".1.d.1"><span data-reactid=".1.d.1.0">改进二：支持多线程消费</span></a></outline><outline class="toc-level-h3" data-reactid=".1.e" style="width: 155px;"><active data-reactid=".1.e.0"></active><a class="toc-outline-theme-github" href="#sr-toc-14" data-reactid=".1.e.1"><span data-reactid=".1.e.1.0">改进三：增强容错处理</span></a></outline><outline class="toc-level-h3" data-reactid=".1.f" style="width: 155px;"><active data-reactid=".1.f.0"></active><a class="toc-outline-theme-github" href="#sr-toc-15" data-reactid=".1.f.1"><span data-reactid=".1.f.1.0">典型案例 - 广告投放实时数据</span></a></outline><outline class="toc-level-h4" data-reactid=".1.g" style="width: 145px;"><active data-reactid=".1.g.0"></active><a class="toc-outline-theme-github" href="#sr-toc-16" data-reactid=".1.g.1"><span data-reactid=".1.g.1.0">性能奥秘</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://mp.weixin.qq.com/s/9PIhLYH559X5F9CgXNDETQ" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>