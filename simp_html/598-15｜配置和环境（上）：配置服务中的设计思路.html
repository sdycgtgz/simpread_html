
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 15｜配置和环境（上）：配置服务中的设计思路</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>15｜配置和环境（上）：配置服务中的设计思路</sr-rd-title>
                    <sr-rd-desc style="margin: 0;padding-top: 0;padding-bottom: 0;font-style: normal;font-size: 18px;">细节和生态是 Gin 如此成功核心原因。</sr-rd-desc>
                    <sr-rd-content><h1 id="sr-toc-0">15｜配置和环境（上）：配置服务中的设计思路</h1><div><span>叶剑峰</span> <span> 2021-10-20</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/1d/b4/1da46d893a3417d5e009e4dfe04a57b4.jpg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：叶剑峰</span><span>大小：12.87M</span><span> 时长：14:05</span></div></div><audio title="15｜配置和环境（上）：配置服务中的设计思路" src="https://res001.geekbang.org/media/audio/92/b6/92313761b7364a84ba938199bc0289b6/ld/ld.m3u8" __idm_id__="704522"></audio></div><div><div><div><div data-slate-editor="true" data-key="7138" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="7139"><span data-slate-object="text" data-key="7140"><span data-slate-leaf="true" data-offset-key="7140:0" data-first-offset="true"><span data-slate-string="true">你好，我是轩脉刃。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7141"><span data-slate-object="text" data-key="7142"><span data-slate-leaf="true" data-offset-key="7142:0" data-first-offset="true"><span data-slate-string="true">经过前面几节课对框架的改造，我们能很方便在 hade 框架中创造一个定时任务，或者一个 Web 服务了。但是随着开始编写业务，你会发现，业务中有大量的配置项，比如数据库的用户名密码、缓存 Redis 的 IP 和端口、第三方调用的地址等。如何通过统一的方法快速获取到这些配置项，就是今天要讨论的内容。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7143"><span data-slate-object="text" data-key="7144"><span data-slate-leaf="true" data-offset-key="7144:0" data-first-offset="true"><span data-slate-string="true">当你看到获取配置项这个需求，第一个反应是不是要创建一个读取配置文件的服务。但是，一个程序获取配置项只有读取配置文件这个方法么？其实不是的，获取配置项的方法有很多，</span></span></span><span data-slate-object="text" data-key="7145"><span data-slate-leaf="true" data-offset-key="7145:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">读取本地配置文件、读取远端配置服务、获取环境变量</span></span></span></span><span data-slate-object="text" data-key="7146"><span data-slate-leaf="true" data-offset-key="7146:0" data-first-offset="true"><span data-slate-string="true">，都是获取配置项的方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7147"><span data-slate-object="text" data-key="7148"><span data-slate-leaf="true" data-offset-key="7148:0" data-first-offset="true"><span data-slate-string="true">获取远端配置服务是通过一个远程调用来获取配置信息的方法，它依赖于远端的服务提供。而读取本地配置文件和获取环境变量，是我们通过进程本身获取配置项最常用的方法，这节课就为框架增加这两种获取配置项的能力。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7149" id="sr-toc-1"><span data-slate-object="text" data-key="7150"><span data-slate-leaf="true" data-offset-key="7150:0" data-first-offset="true"><span data-slate-string="true">环境变量获取配置思路分析</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7151"><span data-slate-object="text" data-key="7152"><span data-slate-leaf="true" data-offset-key="7152:0" data-first-offset="true"><span data-slate-string="true">在现在服务越来越容器化的时代，环境变量越来越重要。因为一个服务一旦被封装为 Docker 镜像，镜像就会被部署在不同的环境中。如何区分不同的环境呢？在容器内部已经把程序、配置文件都进行了打包，唯一能在不同环境变化的就是环境变量了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7153"><span data-slate-object="text" data-key="7154"><span data-slate-leaf="true" data-offset-key="7154:0" data-first-offset="true"><span data-slate-string="true">所以顾名思义，环境变量也就是为不同环境准备的，不同环境有不同的设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7155"><span data-slate-object="text" data-key="7156"><span data-slate-leaf="true" data-offset-key="7156:0" data-first-offset="true"><span data-slate-string="true">为一个程序设置环境变量的方式是多种多样的。如果是容器化的进程，可以在创建镜像的时候设置，也可以在容器启动的时候设置，在 Linux 系统中，我们也可以通过在启动进程的时候，</span></span><span data-slate-leaf="true" data-offset-key="7156:1"><span data-slate-object="annotation" data-annotation-key="gkann_51ad7f37" data-attr-id="33043" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">通过前面加上 “KEY=VALUE” 的方式，为单个进程设置环境变量，</span></span></span><span data-slate-leaf="true" data-offset-key="7156:2"><span data-slate-string="true">比如：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7157"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7158"><span data-slate-object="text" data-key="7159"><span data-slate-leaf="true" data-offset-key="7159:0" data-first-offset="true"><span data-slate-string="true">FOO_ENV=bar ./hade foo</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7160"><span data-slate-object="text" data-key="7161"><span data-slate-leaf="true" data-offset-key="7161:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">就为当前这个进程设置了一个 key 为 FOO_ENV，值为 bar 的环境变量</span></span></span></span><span data-slate-object="text" data-key="7162"><span data-slate-leaf="true" data-offset-key="7162:0" data-first-offset="true"><span data-slate-string="true">。要记住这种方式，我们后续测试的时候，会用这种方式测试环境变量是否设置成功。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7163"><span data-slate-object="text" data-key="7164"><span data-slate-leaf="true" data-offset-key="7164:0" data-first-offset="true"><span data-slate-string="true">但是不管是哪种设置环境变量的方式，在 Golang 中，都能通过 os 标准库的</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7165"><span data-slate-object="text" data-key="7166"><span data-slate-leaf="true" data-offset-key="7166:0" data-first-offset="true"><span data-slate-string="true"> os.Environ()</span></span></span></span><span data-slate-object="text" data-key="7167"><span data-slate-leaf="true" data-offset-key="7167:0" data-first-offset="true"><span data-slate-string="true"> 获取。Environ 方法，会将进程中设置的所有环境变量，都以字符串数组形式返回，每个字符串为 “KEY=VALUE” 的环境变量设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7168"><span data-slate-object="text" data-key="7169"><span data-slate-leaf="true" data-offset-key="7169:0" data-first-offset="true"><span data-slate-string="true">读取环境变量获取配置的大思路有了，但是考虑到配置的设置还有一个问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7170"><span data-slate-object="text" data-key="7171"><span data-slate-leaf="true" data-offset-key="7171:0" data-first-offset="true"><span data-slate-string="true">环境变量可能会有很多。但是我们每次部署一个环境的时候，设置的环境变量可能就只有一两个，那其他的环境变量就需要有一个 “默认值”。这个默认值我们一般使用一个以 dot 点号开头的文件. env 来进行设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7172"><span data-slate-object="text" data-key="7173"><span data-slate-leaf="true" data-offset-key="7173:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_676301d1" data-attr-id="43053" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">其实</span></span></span></span><span data-slate-object="text" data-key="7174"><span data-slate-leaf="true" data-offset-key="7174:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_676301d1" data-attr-id="43053" data-attr-name="public" data-annotation-type="public"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">使用. env 文件来设置默认环境变量，在运行的时候再使用真实的环境变量替换部分默认值</span></span></span></span></span><span data-slate-object="text" data-key="7175"><span data-slate-leaf="true" data-offset-key="7175:0" data-first-offset="true"><span data-slate-object="annotation" data-annotation-key="gkann_676301d1" data-attr-id="43053" data-attr-name="public" data-annotation-type="public"><span data-slate-string="true">，</span></span></span><span data-slate-leaf="true" data-offset-key="7175:1"><span data-slate-string="true">这种做法，在业界已经是一种非常普遍的加载环境变量的方式了。比如，在 Docker 中有个 env-file 配置项，会在启动的时候读取默认环境变量文件；又比如 Vue 中，Webpack 打包各种不同环境的时候，会根据根目录下. env 文件读取环境配置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7176"><span data-slate-object="text" data-key="7177"><span data-slate-leaf="true" data-offset-key="7177:0" data-first-offset="true"><span data-slate-string="true">而我们的 hade 框架，也可以借鉴这个思路设计成相同的方式：在 baseFolder 目录下存放一个. env 文件保存默认值，这个. env 文件中的每一行，为一个环境变量 Key=Value 的形式，等运行的时候，进程运行的环境变量设置会覆盖. env 文件的设置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7178"><span data-slate-object="text" data-key="7179"><span data-slate-leaf="true" data-offset-key="7179:0" data-first-offset="true"><span data-slate-string="true">有了上面对环境变量的设置、读取环境变量获取配置的分析之后，我们就可以开始着手设计了。分成两步来写：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7180"><div data-slate-type="list-line" data-slate-object="block" data-key="7181"><span data-slate-object="text" data-key="7182"><span data-slate-leaf="true" data-offset-key="7182:0" data-first-offset="true"><span data-slate-string="true">环境变量服务的接口及具体实现</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7183"><span data-slate-object="text" data-key="7184"><span data-slate-leaf="true" data-offset-key="7184:0" data-first-offset="true"><span data-slate-string="true">读取配置文件服务的接口及具体实现</span></span></span></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7185" id="sr-toc-2"><span data-slate-object="text" data-key="7186"><span data-slate-leaf="true" data-offset-key="7186:0" data-first-offset="true"><span data-slate-string="true">环境变量服务的接口和实现</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7187"><span data-slate-object="text" data-key="7188"><span data-slate-leaf="true" data-offset-key="7188:0" data-first-offset="true"><span data-slate-string="true">首先按照一切皆服务的思想，通过环境变量获取配置项，这本身可以设计成一个服务，存放在服务容器中。所以我们先设计配置项服务 Env 的接口。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7189"><span data-slate-object="text" data-key="7190"><span data-slate-leaf="true" data-offset-key="7190:0" data-first-offset="true"><span data-slate-string="true">环境变量服务设计了四个方法：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7191"><div data-slate-type="list-line" data-slate-object="block" data-key="7192"><span data-slate-object="text" data-key="7193"><span data-slate-leaf="true" data-offset-key="7193:0" data-first-offset="true"><span data-slate-string="true">AppEnv，获取 APP_ENV 这个环境变量，这个环境变量代表当前应用所在的环境；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7194"><span data-slate-object="text" data-key="7195"><span data-slate-leaf="true" data-offset-key="7195:0" data-first-offset="true"><span data-slate-string="true">IsExist，判断某个环境变量是否存在；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7196"><span data-slate-object="text" data-key="7197"><span data-slate-leaf="true" data-offset-key="7197:0" data-first-offset="true"><span data-slate-string="true">Get，获取某个环境变量，如果没有设置，则返回空字符串；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="7198"><span data-slate-object="text" data-key="7199"><span data-slate-leaf="true" data-offset-key="7199:0" data-first-offset="true"><span data-slate-string="true">All，获取所有的环境变量。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7200"><span data-slate-object="text" data-key="7201"><span data-slate-leaf="true" data-offset-key="7201:0" data-first-offset="true"><span data-slate-string="true">在 framework/contract/env.go 文件中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7202"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7203"><span data-slate-object="text" data-key="7204"><span data-slate-leaf="true" data-offset-key="7204:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">package</span></span></span></span><span data-slate-object="text" data-key="7205"><span data-slate-leaf="true" data-offset-key="7205:0" data-first-offset="true"><span data-slate-string="true"> contract</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7206"></div><div data-slate-type="code-line" data-slate-object="block" data-key="7207"><span data-slate-object="text" data-key="7208"><span data-slate-leaf="true" data-offset-key="7208:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">const</span></span></span></span><span data-slate-object="text" data-key="7209"><span data-slate-leaf="true" data-offset-key="7209:0" data-first-offset="true"><span data-slate-string="true"> (</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7210"><span data-slate-object="text" data-key="7211"><span data-slate-leaf="true" data-offset-key="7211:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7212"><span data-slate-leaf="true" data-offset-key="7212:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// EnvProduction 代表生产环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7213"><span data-slate-object="text" data-key="7214"><span data-slate-leaf="true" data-offset-key="7214:0" data-first-offset="true"><span data-slate-string="true">   EnvProduction = </span></span></span><span data-slate-object="text" data-key="7215"><span data-slate-leaf="true" data-offset-key="7215:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"production"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7216"><span data-slate-object="text" data-key="7217"><span data-slate-leaf="true" data-offset-key="7217:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7218"><span data-slate-leaf="true" data-offset-key="7218:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// EnvTesting 代表测试环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7219"><span data-slate-object="text" data-key="7220"><span data-slate-leaf="true" data-offset-key="7220:0" data-first-offset="true"><span data-slate-string="true">   EnvTesting = </span></span></span><span data-slate-object="text" data-key="7221"><span data-slate-leaf="true" data-offset-key="7221:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"testing"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7222"><span data-slate-object="text" data-key="7223"><span data-slate-leaf="true" data-offset-key="7223:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7224"><span data-slate-leaf="true" data-offset-key="7224:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// EnvDevelopment 代表开发环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7225"><span data-slate-object="text" data-key="7226"><span data-slate-leaf="true" data-offset-key="7226:0" data-first-offset="true"><span data-slate-string="true">   EnvDevelopment = </span></span></span><span data-slate-object="text" data-key="7227"><span data-slate-leaf="true" data-offset-key="7227:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"development"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7228"><span data-slate-object="text" data-key="7229"><span data-slate-leaf="true" data-offset-key="7229:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7230"><span data-slate-leaf="true" data-offset-key="7230:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// EnvKey 是环境变量服务字符串凭证</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7231"><span data-slate-object="text" data-key="7232"><span data-slate-leaf="true" data-offset-key="7232:0" data-first-offset="true"><span data-slate-string="true">   EnvKey = </span></span></span><span data-slate-object="text" data-key="7233"><span data-slate-leaf="true" data-offset-key="7233:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"hade:env"</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7234"><span data-slate-object="text" data-key="7235"><span data-slate-leaf="true" data-offset-key="7235:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7236"><span data-slate-object="text" data-key="7237"><span data-slate-leaf="true" data-offset-key="7237:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Env 定义环境变量服务</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7238"><span data-slate-object="text" data-key="7239"><span data-slate-leaf="true" data-offset-key="7239:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="7240"><span data-slate-leaf="true" data-offset-key="7240:0" data-first-offset="true"><span data-slate-string="true"> Env </span></span></span><span data-slate-object="text" data-key="7241"><span data-slate-leaf="true" data-offset-key="7241:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="7242"><span data-slate-leaf="true" data-offset-key="7242:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7243"><span data-slate-object="text" data-key="7244"><span data-slate-leaf="true" data-offset-key="7244:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7245"><span data-slate-leaf="true" data-offset-key="7245:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// AppEnv 获取当前的环境，建议分为 development/testing/production</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7246"><span data-slate-object="text" data-key="7247"><span data-slate-leaf="true" data-offset-key="7247:0" data-first-offset="true"><span data-slate-string="true">   AppEnv() </span></span></span><span data-slate-object="text" data-key="7248"><span data-slate-leaf="true" data-offset-key="7248:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7249"><span data-slate-object="text" data-key="7250"><span data-slate-leaf="true" data-offset-key="7250:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7251"><span data-slate-leaf="true" data-offset-key="7251:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// IsExist 判断一个环境变量是否有被设置</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7252"><span data-slate-object="text" data-key="7253"><span data-slate-leaf="true" data-offset-key="7253:0" data-first-offset="true"><span data-slate-string="true">   IsExist(</span></span></span><span data-slate-object="text" data-key="7254"><span data-slate-leaf="true" data-offset-key="7254:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7255"><span data-slate-leaf="true" data-offset-key="7255:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7256"><span data-slate-leaf="true" data-offset-key="7256:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7257"><span data-slate-object="text" data-key="7258"><span data-slate-leaf="true" data-offset-key="7258:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7259"><span data-slate-leaf="true" data-offset-key="7259:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get 获取某个环境变量，如果没有设置，返回 ""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7260"><span data-slate-object="text" data-key="7261"><span data-slate-leaf="true" data-offset-key="7261:0" data-first-offset="true"><span data-slate-string="true">   Get(</span></span></span><span data-slate-object="text" data-key="7262"><span data-slate-leaf="true" data-offset-key="7262:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7263"><span data-slate-leaf="true" data-offset-key="7263:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7264"><span data-slate-leaf="true" data-offset-key="7264:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7265"><span data-slate-object="text" data-key="7266"><span data-slate-leaf="true" data-offset-key="7266:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7267"><span data-slate-leaf="true" data-offset-key="7267:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// All 获取所有的环境变量，.env 和运行环境变量融合后结果</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7268"><span data-slate-object="text" data-key="7269"><span data-slate-leaf="true" data-offset-key="7269:0" data-first-offset="true"><span data-slate-string="true">   All() </span></span></span><span data-slate-object="text" data-key="7270"><span data-slate-leaf="true" data-offset-key="7270:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="7271"><span data-slate-leaf="true" data-offset-key="7271:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="7272"><span data-slate-leaf="true" data-offset-key="7272:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7273"><span data-slate-leaf="true" data-offset-key="7273:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="7274"><span data-slate-leaf="true" data-offset-key="7274:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7275"><span data-slate-object="text" data-key="7276"><span data-slate-leaf="true" data-offset-key="7276:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7277"><span data-slate-object="text" data-key="7278"><span data-slate-leaf="true" data-offset-key="7278:0" data-first-offset="true"><span data-slate-string="true">这里有两点你可能觉得有点奇怪。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7279"><div data-slate-type="list-line" data-slate-object="block" data-key="7280"><span data-slate-object="text" data-key="7281"><span data-slate-leaf="true" data-offset-key="7281:0" data-first-offset="true"><span data-slate-string="true">为什么有 Get 方法为什么没有 Set 方法？</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7282"><span data-slate-object="text" data-key="7283"><span data-slate-leaf="true" data-offset-key="7283:0" data-first-offset="true"><span data-slate-string="true">这点我是这么考虑的，环境变量本质代表的是当前程序运行的环境，是一个程序运行时就固定的，它不应该允许程序运行中进行设置，这是一个不安全的行为。所以这里故意没有设计 Set 方法，让环境变量在运行时被修改。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="7284"><div data-slate-type="list-line" data-slate-object="block" data-key="7285"><span data-slate-object="text" data-key="7286"><span data-slate-leaf="true" data-offset-key="7286:0" data-first-offset="true"><span data-slate-string="true">AppEnv 是什么，为什么要单独设置一个 APP_ENV 这个环境变量？</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7287"><span data-slate-object="text" data-key="7288"><span data-slate-leaf="true" data-offset-key="7288:0" data-first-offset="true"><span data-slate-string="true">这是参考 Laravel 和 Vue 这两个项目，它们都会为当前的应用，设置一个固定的环境变量 APP_ENV，这样在代码中，可以根据这个环境变量加载不同的配置文件、运行不同的业务逻辑。所以我单独为 APP_ENV 设置了环境变量，同时为这个 APP_ENV 预设了三个模式：开发模式 development、测试模式 testing、生产模式 production，默认为开发模式。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7289"><span data-slate-object="text" data-key="7290"><span data-slate-leaf="true" data-offset-key="7290:0" data-first-offset="true"><span data-slate-string="true">下面就来说接口的具体实现，在框架文件 framework/provider/env/service.go 中，大致就是按照先读取本地默认. env 文件，再读取运行环境变量。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7291"><span data-slate-object="text" data-key="7292"><span data-slate-leaf="true" data-offset-key="7292:0" data-first-offset="true"><span data-slate-string="true">我们使用一个 map [string] string 来保存最终的环境变量值，设置这个 map 初始有一个 APP_ENV 的 key，并将它设置为开发环境。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7293"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7294"><span data-slate-object="text" data-key="7295"><span data-slate-leaf="true" data-offset-key="7295:0" data-first-offset="true"><span data-slate-string="true">hadeEnv := &amp;HadeEnv{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7296"><span data-slate-object="text" data-key="7297"><span data-slate-leaf="true" data-offset-key="7297:0" data-first-offset="true"><span data-slate-string="true">   folder: folder,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7298"><span data-slate-object="text" data-key="7299"><span data-slate-leaf="true" data-offset-key="7299:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7300"><span data-slate-leaf="true" data-offset-key="7300:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 实例化环境变量，APP_ENV 默认设置为开发环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7301"><span data-slate-object="text" data-key="7302"><span data-slate-leaf="true" data-offset-key="7302:0" data-first-offset="true"><span data-slate-string="true">   maps: </span></span></span><span data-slate-object="text" data-key="7303"><span data-slate-leaf="true" data-offset-key="7303:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="7304"><span data-slate-leaf="true" data-offset-key="7304:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="7305"><span data-slate-leaf="true" data-offset-key="7305:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7306"><span data-slate-leaf="true" data-offset-key="7306:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="7307"><span data-slate-leaf="true" data-offset-key="7307:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7308"><span data-slate-leaf="true" data-offset-key="7308:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="7309"><span data-slate-leaf="true" data-offset-key="7309:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"APP_ENV"</span></span></span></span><span data-slate-object="text" data-key="7310"><span data-slate-leaf="true" data-offset-key="7310:0" data-first-offset="true"><span data-slate-string="true">: contract.EnvDevelopment},</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7311"><span data-slate-object="text" data-key="7312"><span data-slate-leaf="true" data-offset-key="7312:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7313"><span data-slate-object="text" data-key="7314"><span data-slate-leaf="true" data-offset-key="7314:0" data-first-offset="true"><span data-slate-string="true">接下来先读取. env 文件中保存的默认环境变量，这里读取就使用 Golang 里面的文件读取方式：先用 os.Open 打开文件，使用 bufio.NewReader 创建一个读取器，然后使用 ReadLine 逐行读取，读取之后将结果保存到 map 中。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7315"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7316"><span data-slate-object="text" data-key="7317"><span data-slate-leaf="true" data-offset-key="7317:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 打开文件. env</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7318"><span data-slate-object="text" data-key="7319"><span data-slate-leaf="true" data-offset-key="7319:0" data-first-offset="true"><span data-slate-string="true">fi, err := os.Open(file)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7320"><span data-slate-object="text" data-key="7321"><span data-slate-leaf="true" data-offset-key="7321:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7322"><span data-slate-leaf="true" data-offset-key="7322:0" data-first-offset="true"><span data-slate-string="true"> err == </span></span></span><span data-slate-object="text" data-key="7323"><span data-slate-leaf="true" data-offset-key="7323:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">nil</span></span></span></span><span data-slate-object="text" data-key="7324"><span data-slate-leaf="true" data-offset-key="7324:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7325"><span data-slate-object="text" data-key="7326"><span data-slate-leaf="true" data-offset-key="7326:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7327"><span data-slate-leaf="true" data-offset-key="7327:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">defer</span></span></span></span><span data-slate-object="text" data-key="7328"><span data-slate-leaf="true" data-offset-key="7328:0" data-first-offset="true"><span data-slate-string="true"> fi.Close()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7329"><span data-slate-object="text" data-key="7330"><span data-slate-leaf="true" data-offset-key="7330:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7331"><span data-slate-leaf="true" data-offset-key="7331:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 读取文件</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7332"><span data-slate-object="text" data-key="7333"><span data-slate-leaf="true" data-offset-key="7333:0" data-first-offset="true"><span data-slate-string="true">   br := bufio.NewReader(fi)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7334"><span data-slate-object="text" data-key="7335"><span data-slate-leaf="true" data-offset-key="7335:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7336"><span data-slate-leaf="true" data-offset-key="7336:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="7337"><span data-slate-leaf="true" data-offset-key="7337:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7338"><span data-slate-object="text" data-key="7339"><span data-slate-leaf="true" data-offset-key="7339:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7340"><span data-slate-leaf="true" data-offset-key="7340:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 按照行进行读取</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7341"><span data-slate-object="text" data-key="7342"><span data-slate-leaf="true" data-offset-key="7342:0" data-first-offset="true"><span data-slate-string="true">      line, _, c := br.ReadLine()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7343"><span data-slate-object="text" data-key="7344"><span data-slate-leaf="true" data-offset-key="7344:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7345"><span data-slate-leaf="true" data-offset-key="7345:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7346"><span data-slate-leaf="true" data-offset-key="7346:0" data-first-offset="true"><span data-slate-string="true"> c == io.EOF {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7347"><span data-slate-object="text" data-key="7348"><span data-slate-leaf="true" data-offset-key="7348:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="7349"><span data-slate-leaf="true" data-offset-key="7349:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">break</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7350"><span data-slate-object="text" data-key="7351"><span data-slate-leaf="true" data-offset-key="7351:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7352"><span data-slate-object="text" data-key="7353"><span data-slate-leaf="true" data-offset-key="7353:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7354"><span data-slate-leaf="true" data-offset-key="7354:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 按照等号解析</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7355"><span data-slate-object="text" data-key="7356"><span data-slate-leaf="true" data-offset-key="7356:0" data-first-offset="true"><span data-slate-string="true">      s := bytes.SplitN(line, []</span></span></span><span data-slate-object="text" data-key="7357"><span data-slate-leaf="true" data-offset-key="7357:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">byte</span></span></span></span><span data-slate-object="text" data-key="7358"><span data-slate-leaf="true" data-offset-key="7358:0" data-first-offset="true"><span data-slate-string="true">{</span></span></span><span data-slate-object="text" data-key="7359"><span data-slate-leaf="true" data-offset-key="7359:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'='</span></span></span></span><span data-slate-object="text" data-key="7360"><span data-slate-leaf="true" data-offset-key="7360:0" data-first-offset="true"><span data-slate-string="true">}, </span></span></span><span data-slate-object="text" data-key="7361"><span data-slate-leaf="true" data-offset-key="7361:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7362"><span data-slate-leaf="true" data-offset-key="7362:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7363"><span data-slate-object="text" data-key="7364"><span data-slate-leaf="true" data-offset-key="7364:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7365"><span data-slate-leaf="true" data-offset-key="7365:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 如果不符合规范，则过滤</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7366"><span data-slate-object="text" data-key="7367"><span data-slate-leaf="true" data-offset-key="7367:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7368"><span data-slate-leaf="true" data-offset-key="7368:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7369"><span data-slate-leaf="true" data-offset-key="7369:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7370"><span data-slate-leaf="true" data-offset-key="7370:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="7371"><span data-slate-leaf="true" data-offset-key="7371:0" data-first-offset="true"><span data-slate-string="true">(s) &lt; </span></span></span><span data-slate-object="text" data-key="7372"><span data-slate-leaf="true" data-offset-key="7372:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7373"><span data-slate-leaf="true" data-offset-key="7373:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7374"><span data-slate-object="text" data-key="7375"><span data-slate-leaf="true" data-offset-key="7375:0" data-first-offset="true"><span data-slate-string="true">         </span></span></span><span data-slate-object="text" data-key="7376"><span data-slate-leaf="true" data-offset-key="7376:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continue</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7377"><span data-slate-object="text" data-key="7378"><span data-slate-leaf="true" data-offset-key="7378:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7379"><span data-slate-object="text" data-key="7380"><span data-slate-leaf="true" data-offset-key="7380:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7381"><span data-slate-leaf="true" data-offset-key="7381:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 保存 map</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7382"><span data-slate-object="text" data-key="7383"><span data-slate-leaf="true" data-offset-key="7383:0" data-first-offset="true"><span data-slate-string="true">      key := </span></span></span><span data-slate-object="text" data-key="7384"><span data-slate-leaf="true" data-offset-key="7384:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7385"><span data-slate-leaf="true" data-offset-key="7385:0" data-first-offset="true"><span data-slate-string="true">(s[</span></span></span><span data-slate-object="text" data-key="7386"><span data-slate-leaf="true" data-offset-key="7386:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7387"><span data-slate-leaf="true" data-offset-key="7387:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7388"><span data-slate-object="text" data-key="7389"><span data-slate-leaf="true" data-offset-key="7389:0" data-first-offset="true"><span data-slate-string="true">      val := </span></span></span><span data-slate-object="text" data-key="7390"><span data-slate-leaf="true" data-offset-key="7390:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7391"><span data-slate-leaf="true" data-offset-key="7391:0" data-first-offset="true"><span data-slate-string="true">(s[</span></span></span><span data-slate-object="text" data-key="7392"><span data-slate-leaf="true" data-offset-key="7392:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7393"><span data-slate-leaf="true" data-offset-key="7393:0" data-first-offset="true"><span data-slate-string="true">])</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7394"><span data-slate-object="text" data-key="7395"><span data-slate-leaf="true" data-offset-key="7395:0" data-first-offset="true"><span data-slate-string="true">      hadeEnv.maps[key] = val</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7396"><span data-slate-object="text" data-key="7397"><span data-slate-leaf="true" data-offset-key="7397:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7398"><span data-slate-object="text" data-key="7399"><span data-slate-leaf="true" data-offset-key="7399:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7400"><span data-slate-object="text" data-key="7401"><span data-slate-leaf="true" data-offset-key="7401:0" data-first-offset="true"><span data-slate-string="true">最后再使用开头说的 os.Environ 来读取程序的所有环境变量，并且直接覆盖 map 变量。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7402"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7403"><span data-slate-object="text" data-key="7404"><span data-slate-leaf="true" data-offset-key="7404:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取当前程序的环境变量，并且覆盖. env 文件下的变量</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7405"><span data-slate-object="text" data-key="7406"><span data-slate-leaf="true" data-offset-key="7406:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">for</span></span></span></span><span data-slate-object="text" data-key="7407"><span data-slate-leaf="true" data-offset-key="7407:0" data-first-offset="true"><span data-slate-string="true"> _, e := </span></span></span><span data-slate-object="text" data-key="7408"><span data-slate-leaf="true" data-offset-key="7408:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">range</span></span></span></span><span data-slate-object="text" data-key="7409"><span data-slate-leaf="true" data-offset-key="7409:0" data-first-offset="true"><span data-slate-string="true"> os.Environ() {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7410"><span data-slate-object="text" data-key="7411"><span data-slate-leaf="true" data-offset-key="7411:0" data-first-offset="true"><span data-slate-string="true">   pair := strings.SplitN(e, </span></span></span><span data-slate-object="text" data-key="7412"><span data-slate-leaf="true" data-offset-key="7412:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"="</span></span></span></span><span data-slate-object="text" data-key="7413"><span data-slate-leaf="true" data-offset-key="7413:0" data-first-offset="true"><span data-slate-string="true">, </span></span></span><span data-slate-object="text" data-key="7414"><span data-slate-leaf="true" data-offset-key="7414:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7415"><span data-slate-leaf="true" data-offset-key="7415:0" data-first-offset="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7416"><span data-slate-object="text" data-key="7417"><span data-slate-leaf="true" data-offset-key="7417:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7418"><span data-slate-leaf="true" data-offset-key="7418:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7419"><span data-slate-leaf="true" data-offset-key="7419:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7420"><span data-slate-leaf="true" data-offset-key="7420:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">len</span></span></span></span><span data-slate-object="text" data-key="7421"><span data-slate-leaf="true" data-offset-key="7421:0" data-first-offset="true"><span data-slate-string="true">(pair) &lt; </span></span></span><span data-slate-object="text" data-key="7422"><span data-slate-leaf="true" data-offset-key="7422:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">2</span></span></span></span><span data-slate-object="text" data-key="7423"><span data-slate-leaf="true" data-offset-key="7423:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7424"><span data-slate-object="text" data-key="7425"><span data-slate-leaf="true" data-offset-key="7425:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7426"><span data-slate-leaf="true" data-offset-key="7426:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">continue</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7427"><span data-slate-object="text" data-key="7428"><span data-slate-leaf="true" data-offset-key="7428:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7429"><span data-slate-object="text" data-key="7430"><span data-slate-leaf="true" data-offset-key="7430:0" data-first-offset="true"><span data-slate-string="true">   hadeEnv.maps[pair[</span></span></span><span data-slate-object="text" data-key="7431"><span data-slate-leaf="true" data-offset-key="7431:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">0</span></span></span></span><span data-slate-object="text" data-key="7432"><span data-slate-leaf="true" data-offset-key="7432:0" data-first-offset="true"><span data-slate-string="true">]] = pair[</span></span></span><span data-slate-object="text" data-key="7433"><span data-slate-leaf="true" data-offset-key="7433:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">1</span></span></span></span><span data-slate-object="text" data-key="7434"><span data-slate-leaf="true" data-offset-key="7434:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7435"><span data-slate-object="text" data-key="7436"><span data-slate-leaf="true" data-offset-key="7436:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7437"><span data-slate-object="text" data-key="7438"><span data-slate-leaf="true" data-offset-key="7438:0" data-first-offset="true"><span data-slate-string="true">而环境变量服务最终提供的 Get 接口，也就非常简单了，直接从 map 中获取某个 key 的环境变量即可。并且由于在运行过程中没有 Set 等修改环境变量的方法，所以也不需要加锁。</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7439"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7440"><span data-slate-object="text" data-key="7441"><span data-slate-leaf="true" data-offset-key="7441:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get 获取某个环境变量，如果没有设置，返回 ""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7442"><span data-slate-object="text" data-key="7443"><span data-slate-leaf="true" data-offset-key="7443:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="7444"><span data-slate-leaf="true" data-offset-key="7444:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"> </span></span></span></span><span data-slate-object="text" data-key="7445"><span data-slate-leaf="true" data-offset-key="7445:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(en *HadeEnv)</span></span></span></span></span><span data-slate-object="text" data-key="7446"><span data-slate-leaf="true" data-offset-key="7446:0" data-first-offset="true"><span data-slate-string="true"> Get(key </span></span></span><span data-slate-object="text" data-key="7447"><span data-slate-leaf="true" data-offset-key="7447:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7448"><span data-slate-leaf="true" data-offset-key="7448:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7449"><span data-slate-leaf="true" data-offset-key="7449:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7450"><span data-slate-leaf="true" data-offset-key="7450:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7451"><span data-slate-object="text" data-key="7452"><span data-slate-leaf="true" data-offset-key="7452:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7453"><span data-slate-leaf="true" data-offset-key="7453:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">if</span></span></span></span><span data-slate-object="text" data-key="7454"><span data-slate-leaf="true" data-offset-key="7454:0" data-first-offset="true"><span data-slate-string="true"> val, ok := en.maps[key]; ok {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7455"><span data-slate-object="text" data-key="7456"><span data-slate-leaf="true" data-offset-key="7456:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7457"><span data-slate-leaf="true" data-offset-key="7457:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7458"><span data-slate-leaf="true" data-offset-key="7458:0" data-first-offset="true"><span data-slate-string="true"> val</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7459"><span data-slate-object="text" data-key="7460"><span data-slate-leaf="true" data-offset-key="7460:0" data-first-offset="true"><span data-slate-string="true">   }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7461"><span data-slate-object="text" data-key="7462"><span data-slate-leaf="true" data-offset-key="7462:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7463"><span data-slate-leaf="true" data-offset-key="7463:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="7464"><span data-slate-leaf="true" data-offset-key="7464:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="7465"><span data-slate-leaf="true" data-offset-key="7465:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">""</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7466"><span data-slate-object="text" data-key="7467"><span data-slate-leaf="true" data-offset-key="7467:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7468"><span data-slate-object="text" data-key="7469"><span data-slate-leaf="true" data-offset-key="7469:0" data-first-offset="true"><span data-slate-string="true">到这里接口和实现就基本完成了，简单写段代码测试一下。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7470"><span data-slate-object="text" data-key="7471"><span data-slate-leaf="true" data-offset-key="7471:0" data-first-offset="true"><span data-slate-string="true">我们可以创建一个一级命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="7472"><span data-slate-object="text" data-key="7473"><span data-slate-leaf="true" data-offset-key="7473:0" data-first-offset="true"><span data-slate-string="true">./hade env</span></span></span></span><span data-slate-object="text" data-key="7474"><span data-slate-leaf="true" data-offset-key="7474:0" data-first-offset="true"><span data-slate-string="true"> 来获取当前 app 的环境，并且验证刚才写的环境变量服务，在这个命令中，我们直接将 AppEnv 打印到控制台。在文件 framework/command/contract.go 中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7475"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7476"><span data-slate-object="text" data-key="7477"><span data-slate-leaf="true" data-offset-key="7477:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">//envCommand 获取当前的 App 环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7478"><span data-slate-object="text" data-key="7479"><span data-slate-leaf="true" data-offset-key="7479:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">var</span></span></span></span><span data-slate-object="text" data-key="7480"><span data-slate-leaf="true" data-offset-key="7480:0" data-first-offset="true"><span data-slate-string="true"> envCommand = &amp;cobra.Command{</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7481"><span data-slate-object="text" data-key="7482"><span data-slate-leaf="true" data-offset-key="7482:0" data-first-offset="true"><span data-slate-string="true">   Use:   </span></span></span><span data-slate-object="text" data-key="7483"><span data-slate-leaf="true" data-offset-key="7483:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"env"</span></span></span></span><span data-slate-object="text" data-key="7484"><span data-slate-leaf="true" data-offset-key="7484:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7485"><span data-slate-object="text" data-key="7486"><span data-slate-leaf="true" data-offset-key="7486:0" data-first-offset="true"><span data-slate-string="true">   Short: </span></span></span><span data-slate-object="text" data-key="7487"><span data-slate-leaf="true" data-offset-key="7487:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"获取当前的 App 环境"</span></span></span></span><span data-slate-object="text" data-key="7488"><span data-slate-leaf="true" data-offset-key="7488:0" data-first-offset="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7489"><span data-slate-object="text" data-key="7490"><span data-slate-leaf="true" data-offset-key="7490:0" data-first-offset="true"><span data-slate-string="true">   Run: </span></span></span><span data-slate-object="text" data-key="7491"><span data-slate-leaf="true" data-offset-key="7491:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">func</span></span></span></span></span><span data-slate-object="text" data-key="7492"><span data-slate-leaf="true" data-offset-key="7492:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">(c *cobra.Command, args []</span></span></span></span></span><span data-slate-object="text" data-key="7493"><span data-slate-leaf="true" data-offset-key="7493:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></span></span><span data-slate-object="text" data-key="7494"><span data-slate-leaf="true" data-offset-key="7494:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">)</span></span></span></span></span><span data-slate-object="text" data-key="7495"><span data-slate-leaf="true" data-offset-key="7495:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7496"><span data-slate-object="text" data-key="7497"><span data-slate-leaf="true" data-offset-key="7497:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7498"><span data-slate-leaf="true" data-offset-key="7498:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 获取 env 环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7499"><span data-slate-object="text" data-key="7500"><span data-slate-leaf="true" data-offset-key="7500:0" data-first-offset="true"><span data-slate-string="true">      container := c.GetContainer()</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7501"><span data-slate-object="text" data-key="7502"><span data-slate-leaf="true" data-offset-key="7502:0" data-first-offset="true"><span data-slate-string="true">      envService := container.MustMake(contract.EnvKey).(contract.Env)</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7503"><span data-slate-object="text" data-key="7504"><span data-slate-leaf="true" data-offset-key="7504:0" data-first-offset="true"><span data-slate-string="true">      </span></span></span><span data-slate-object="text" data-key="7505"><span data-slate-leaf="true" data-offset-key="7505:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 打印环境</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7506"><span data-slate-object="text" data-key="7507"><span data-slate-leaf="true" data-offset-key="7507:0" data-first-offset="true"><span data-slate-string="true">      fmt.Println(</span></span></span><span data-slate-object="text" data-key="7508"><span data-slate-leaf="true" data-offset-key="7508:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">"environment:"</span></span></span></span><span data-slate-object="text" data-key="7509"><span data-slate-leaf="true" data-offset-key="7509:0" data-first-offset="true"><span data-slate-string="true">, envService.AppEnv())</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7510"><span data-slate-object="text" data-key="7511"><span data-slate-leaf="true" data-offset-key="7511:0" data-first-offset="true"><span data-slate-string="true">   },</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7512"><span data-slate-object="text" data-key="7513"><span data-slate-leaf="true" data-offset-key="7513:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="7514"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/ac/4c/ac302d459988707346429c7da6a4304c.png?wh=409x48"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7515"><span data-slate-object="text" data-key="7516"><span data-slate-leaf="true" data-offset-key="7516:0" data-first-offset="true"><span data-slate-string="true">再尝试在进程启动的时候注入 APP_ENV 环境变量为 testing。控制台会将 APP_ENV 替换为 testing，而不是默认的 development 了。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7517"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/9c/f6/9cfc2f36ff663fc13c63dc3bbdfd88f6.png?wh=1052x98"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7518" id="sr-toc-3"><span data-slate-object="text" data-key="7519"><span data-slate-leaf="true" data-offset-key="7519:0" data-first-offset="true"><span data-slate-string="true">读取配置服务的接口</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7520"><span data-slate-object="text" data-key="7521"><span data-slate-leaf="true" data-offset-key="7521:0" data-first-offset="true"><span data-slate-string="true">下面我们就来思考配置文件的设计。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7522"><span data-slate-object="text" data-key="7523"><span data-slate-leaf="true" data-offset-key="7523:0" data-first-offset="true"><span data-slate-string="true">基于一切皆服务的思想，我们也可以将配置文件的读取作为服务容器中的一个服务，照旧先定义它的接口。配置文件服务的接口是我们经常使用的，需要充分考虑其易用性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7524"><span data-slate-object="text" data-key="7525"><span data-slate-leaf="true" data-offset-key="7525:0" data-first-offset="true"><span data-slate-string="true">在项目中会使用一个配置文件还是多个配置文件？这个是需要先思考清楚的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7526"><span data-slate-object="text" data-key="7527"><span data-slate-leaf="true" data-offset-key="7527:0" data-first-offset="true"><span data-slate-string="true">比如我们可以强制要求所有配置放在一个文件中，这样读取会非常方便。但是在实际工作中，这种实践的感受是非常糟糕的，不仅仅这个配置文件会非常冗长，而且更严重的是，</span></span></span><span data-slate-object="text" data-key="7528"><span data-slate-leaf="true" data-offset-key="7528:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">导致配置文件失去了语义化，因为每个配置文件是为了某个模块功能而设计的</span></span></span></span><span data-slate-object="text" data-key="7529"><span data-slate-leaf="true" data-offset-key="7529:0" data-first-offset="true"><span data-slate-string="true">，比如我们看到 log.yaml，就能知道这个配置文件是存放日志相关的配置，而 database.yaml 是存放数据库相关的配置。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7530"><span data-slate-object="text" data-key="7531"><span data-slate-leaf="true" data-offset-key="7531:0" data-first-offset="true"><span data-slate-string="true">所以配置文件一定是多个存在比较好。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7532"><span data-slate-object="text" data-key="7533"><span data-slate-leaf="true" data-offset-key="7533:0" data-first-offset="true"><span data-slate-string="true">明确了多配置文件之后，要思考下这个配置文件的存放目录。在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7534"><span data-slate-object="text" data-key="7535"><span data-slate-leaf="true" data-offset-key="7535:0" data-first-offset="true"><span data-slate-string="true">第 12 节课</span></span></span></a><span data-slate-object="text" data-key="7536"><span data-slate-leaf="true" data-offset-key="7536:0" data-first-offset="true"><span data-slate-string="true">中，我们已经确定了整体 App 的目录结构，其中存放配置文件的目录是，应用结构服务 appService 的 ConfigFolder 这个目录。但是再结合环境配置问题考虑。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7537"><span data-slate-object="text" data-key="7538"><span data-slate-leaf="true" data-offset-key="7538:0" data-first-offset="true"><span data-slate-string="true">之前在环境变量中设置了 APP_ENV，表示这个应用在不同环境会有不同配置，所以如果将每个环境的配置文件存放在 ConfigFolder 下的不同文件夹下，这样配置文件结构是不是显得更为清晰呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7539"><span data-slate-object="text" data-key="7540"><span data-slate-leaf="true" data-offset-key="7540:0" data-first-offset="true"><span data-slate-string="true">我们读取文件的时候，</span></span></span><span data-slate-object="text" data-key="7541"><span data-slate-leaf="true" data-offset-key="7541:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">直接根据 APP_ENV 的环境变量，去不同的配置文件的文件夹下获取对应的配置文件即可</span></span></span></span><span data-slate-object="text" data-key="7542"><span data-slate-leaf="true" data-offset-key="7542:0" data-first-offset="true"><span data-slate-string="true">，很方便。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="7543"><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/cc/f7/cc0eb964df002d95a37a5cb0cf9303f7.png?wh=716x1020" style="width: auto;"></div><div>多个配置文件 + 不同配置文件夹</div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7544"><span data-slate-object="text" data-key="7545"><span data-slate-leaf="true" data-offset-key="7545:0" data-first-offset="true"><span data-slate-string="true">接下来就是要从某个配置文件读取某个目标配置项了。我们可以设计成先读取文件、再读取某个字段的方式，但这样有点复杂，更简单的是，</span></span></span><span data-slate-object="text" data-key="7546"><span data-slate-leaf="true" data-offset-key="7546:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">使用点号分割的路径读取方式</span></span></span></span><span data-slate-object="text" data-key="7547"><span data-slate-leaf="true" data-offset-key="7547:0" data-first-offset="true"><span data-slate-string="true">来增加读取的易用性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7548"><span data-slate-object="text" data-key="7549"><span data-slate-leaf="true" data-offset-key="7549:0" data-first-offset="true"><span data-slate-string="true">比如我们要读取 app.yaml 配置文件下的 data 配置项，可以直接通过 app.data 来获取这个配置项。如果 data 配置项中还有下级属性，比如 name，那可以通过 app.data.name 来获取这个 name 属性。这种根据点来区分配置路径层级的方式，能很大加速我们的读取效率。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7550"><span data-slate-object="text" data-key="7551"><span data-slate-leaf="true" data-offset-key="7551:0" data-first-offset="true"><span data-slate-string="true">最后，我们考虑配置文件服务的具体方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7552"><span data-slate-object="text" data-key="7553"><span data-slate-leaf="true" data-offset-key="7553:0" data-first-offset="true"><span data-slate-string="true">你应该还记得在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7554"><span data-slate-object="text" data-key="7555"><span data-slate-leaf="true" data-offset-key="7555:0" data-first-offset="true"><span data-slate-string="true">第五节课</span></span></span></a><span data-slate-object="text" data-key="7556"><span data-slate-leaf="true" data-offset-key="7556:0" data-first-offset="true"><span data-slate-string="true">的时候，我们为 Request 封装了一系列查询的方法，同样的，在这里也可以为配置文件服务设计 Get 系列的方法，根据带有点的查询路径，来获取不同类型返回值的配置项。另外再增加一个判断路径是否存在的 IsExist 方法、一个能将某个配置项解析到一个对象的 Load 方法。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7557"><span data-slate-object="text" data-key="7558"><span data-slate-leaf="true" data-offset-key="7558:0" data-first-offset="true"><span data-slate-string="true">我们在框架文件 framework/contract/config.go 中：</span></span></span></div><div data-code-language="go" data-slate-type="pre" data-slate-object="block" data-key="7559"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div><div data-code-line-number="16"></div><div data-code-line-number="17"></div><div data-code-line-number="18"></div><div data-code-line-number="19"></div><div data-code-line-number="20"></div><div data-code-line-number="21"></div><div data-code-line-number="22"></div><div data-code-line-number="23"></div><div data-code-line-number="24"></div><div data-code-line-number="25"></div><div data-code-line-number="26"></div><div data-code-line-number="27"></div><div data-code-line-number="28"></div><div data-code-line-number="29"></div><div data-code-line-number="30"></div><div data-code-line-number="31"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="7560"><span data-slate-object="text" data-key="7561"><span data-slate-leaf="true" data-offset-key="7561:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Config 定义了配置文件服务，读取配置文件，支持点分割的路径读取</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7562"><span data-slate-object="text" data-key="7563"><span data-slate-leaf="true" data-offset-key="7563:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 例如: .Get ("app.name") 表示从 app 文件中读取 name 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7564"><span data-slate-object="text" data-key="7565"><span data-slate-leaf="true" data-offset-key="7565:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// 建议使用 yaml 属性，https://yaml.org/spec/1.2/spec.html</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7566"><span data-slate-object="text" data-key="7567"><span data-slate-leaf="true" data-offset-key="7567:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">type</span></span></span></span><span data-slate-object="text" data-key="7568"><span data-slate-leaf="true" data-offset-key="7568:0" data-first-offset="true"><span data-slate-string="true"> Config </span></span></span><span data-slate-object="text" data-key="7569"><span data-slate-leaf="true" data-offset-key="7569:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="7570"><span data-slate-leaf="true" data-offset-key="7570:0" data-first-offset="true"><span data-slate-string="true"> {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7571"><span data-slate-object="text" data-key="7572"><span data-slate-leaf="true" data-offset-key="7572:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7573"><span data-slate-leaf="true" data-offset-key="7573:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// IsExist 检查一个属性是否存在</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7574"><span data-slate-object="text" data-key="7575"><span data-slate-leaf="true" data-offset-key="7575:0" data-first-offset="true"><span data-slate-string="true">   IsExist(key </span></span></span><span data-slate-object="text" data-key="7576"><span data-slate-leaf="true" data-offset-key="7576:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7577"><span data-slate-leaf="true" data-offset-key="7577:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7578"><span data-slate-leaf="true" data-offset-key="7578:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7579"><span data-slate-object="text" data-key="7580"><span data-slate-leaf="true" data-offset-key="7580:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7581"><span data-slate-leaf="true" data-offset-key="7581:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Get 获取一个属性值</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7582"><span data-slate-object="text" data-key="7583"><span data-slate-leaf="true" data-offset-key="7583:0" data-first-offset="true"><span data-slate-string="true">   Get(key </span></span></span><span data-slate-object="text" data-key="7584"><span data-slate-leaf="true" data-offset-key="7584:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7585"><span data-slate-leaf="true" data-offset-key="7585:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7586"><span data-slate-leaf="true" data-offset-key="7586:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="7587"><span data-slate-leaf="true" data-offset-key="7587:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7588"><span data-slate-object="text" data-key="7589"><span data-slate-leaf="true" data-offset-key="7589:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7590"><span data-slate-leaf="true" data-offset-key="7590:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetBool 获取一个 bool 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7591"><span data-slate-object="text" data-key="7592"><span data-slate-leaf="true" data-offset-key="7592:0" data-first-offset="true"><span data-slate-string="true">   GetBool(key </span></span></span><span data-slate-object="text" data-key="7593"><span data-slate-leaf="true" data-offset-key="7593:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7594"><span data-slate-leaf="true" data-offset-key="7594:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7595"><span data-slate-leaf="true" data-offset-key="7595:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">bool</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7596"><span data-slate-object="text" data-key="7597"><span data-slate-leaf="true" data-offset-key="7597:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7598"><span data-slate-leaf="true" data-offset-key="7598:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetInt 获取一个 int 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7599"><span data-slate-object="text" data-key="7600"><span data-slate-leaf="true" data-offset-key="7600:0" data-first-offset="true"><span data-slate-string="true">   GetInt(key </span></span></span><span data-slate-object="text" data-key="7601"><span data-slate-leaf="true" data-offset-key="7601:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7602"><span data-slate-leaf="true" data-offset-key="7602:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7603"><span data-slate-leaf="true" data-offset-key="7603:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7604"><span data-slate-object="text" data-key="7605"><span data-slate-leaf="true" data-offset-key="7605:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7606"><span data-slate-leaf="true" data-offset-key="7606:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetFloat64 获取一个 float64 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7607"><span data-slate-object="text" data-key="7608"><span data-slate-leaf="true" data-offset-key="7608:0" data-first-offset="true"><span data-slate-string="true">   GetFloat64(key </span></span></span><span data-slate-object="text" data-key="7609"><span data-slate-leaf="true" data-offset-key="7609:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7610"><span data-slate-leaf="true" data-offset-key="7610:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7611"><span data-slate-leaf="true" data-offset-key="7611:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">float64</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7612"><span data-slate-object="text" data-key="7613"><span data-slate-leaf="true" data-offset-key="7613:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7614"><span data-slate-leaf="true" data-offset-key="7614:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetTime 获取一个 time 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7615"><span data-slate-object="text" data-key="7616"><span data-slate-leaf="true" data-offset-key="7616:0" data-first-offset="true"><span data-slate-string="true">   GetTime(key </span></span></span><span data-slate-object="text" data-key="7617"><span data-slate-leaf="true" data-offset-key="7617:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7618"><span data-slate-leaf="true" data-offset-key="7618:0" data-first-offset="true"><span data-slate-string="true">) time.Time</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7619"><span data-slate-object="text" data-key="7620"><span data-slate-leaf="true" data-offset-key="7620:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7621"><span data-slate-leaf="true" data-offset-key="7621:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetString 获取一个 string 属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7622"><span data-slate-object="text" data-key="7623"><span data-slate-leaf="true" data-offset-key="7623:0" data-first-offset="true"><span data-slate-string="true">   GetString(key </span></span></span><span data-slate-object="text" data-key="7624"><span data-slate-leaf="true" data-offset-key="7624:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7625"><span data-slate-leaf="true" data-offset-key="7625:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7626"><span data-slate-leaf="true" data-offset-key="7626:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7627"><span data-slate-object="text" data-key="7628"><span data-slate-leaf="true" data-offset-key="7628:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7629"><span data-slate-leaf="true" data-offset-key="7629:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetIntSlice 获取一个 int 数组属性</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7630"><span data-slate-object="text" data-key="7631"><span data-slate-leaf="true" data-offset-key="7631:0" data-first-offset="true"><span data-slate-string="true">   GetIntSlice(key </span></span></span><span data-slate-object="text" data-key="7632"><span data-slate-leaf="true" data-offset-key="7632:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7633"><span data-slate-leaf="true" data-offset-key="7633:0" data-first-offset="true"><span data-slate-string="true">) []</span></span></span><span data-slate-object="text" data-key="7634"><span data-slate-leaf="true" data-offset-key="7634:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">int</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7635"><span data-slate-object="text" data-key="7636"><span data-slate-leaf="true" data-offset-key="7636:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7637"><span data-slate-leaf="true" data-offset-key="7637:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetStringSlice 获取一个 string 数组</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7638"><span data-slate-object="text" data-key="7639"><span data-slate-leaf="true" data-offset-key="7639:0" data-first-offset="true"><span data-slate-string="true">   GetStringSlice(key </span></span></span><span data-slate-object="text" data-key="7640"><span data-slate-leaf="true" data-offset-key="7640:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7641"><span data-slate-leaf="true" data-offset-key="7641:0" data-first-offset="true"><span data-slate-string="true">) []</span></span></span><span data-slate-object="text" data-key="7642"><span data-slate-leaf="true" data-offset-key="7642:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7643"><span data-slate-object="text" data-key="7644"><span data-slate-leaf="true" data-offset-key="7644:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7645"><span data-slate-leaf="true" data-offset-key="7645:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetStringMap 获取一个 string 为 key，interface 为 val 的 map</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7646"><span data-slate-object="text" data-key="7647"><span data-slate-leaf="true" data-offset-key="7647:0" data-first-offset="true"><span data-slate-string="true">   GetStringMap(key </span></span></span><span data-slate-object="text" data-key="7648"><span data-slate-leaf="true" data-offset-key="7648:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7649"><span data-slate-leaf="true" data-offset-key="7649:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7650"><span data-slate-leaf="true" data-offset-key="7650:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="7651"><span data-slate-leaf="true" data-offset-key="7651:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="7652"><span data-slate-leaf="true" data-offset-key="7652:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7653"><span data-slate-leaf="true" data-offset-key="7653:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="7654"><span data-slate-leaf="true" data-offset-key="7654:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="7655"><span data-slate-leaf="true" data-offset-key="7655:0" data-first-offset="true"><span data-slate-string="true">{}</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7656"><span data-slate-object="text" data-key="7657"><span data-slate-leaf="true" data-offset-key="7657:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7658"><span data-slate-leaf="true" data-offset-key="7658:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetStringMapString 获取一个 string 为 key，string 为 val 的 map</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7659"><span data-slate-object="text" data-key="7660"><span data-slate-leaf="true" data-offset-key="7660:0" data-first-offset="true"><span data-slate-string="true">   GetStringMapString(key </span></span></span><span data-slate-object="text" data-key="7661"><span data-slate-leaf="true" data-offset-key="7661:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7662"><span data-slate-leaf="true" data-offset-key="7662:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7663"><span data-slate-leaf="true" data-offset-key="7663:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="7664"><span data-slate-leaf="true" data-offset-key="7664:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="7665"><span data-slate-leaf="true" data-offset-key="7665:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7666"><span data-slate-leaf="true" data-offset-key="7666:0" data-first-offset="true"><span data-slate-string="true">]</span></span></span><span data-slate-object="text" data-key="7667"><span data-slate-leaf="true" data-offset-key="7667:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7668"><span data-slate-object="text" data-key="7669"><span data-slate-leaf="true" data-offset-key="7669:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7670"><span data-slate-leaf="true" data-offset-key="7670:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// GetStringMapStringSlice 获取一个 string 为 key，数组 string 为 val 的 map</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7671"><span data-slate-object="text" data-key="7672"><span data-slate-leaf="true" data-offset-key="7672:0" data-first-offset="true"><span data-slate-string="true">   GetStringMapStringSlice(key </span></span></span><span data-slate-object="text" data-key="7673"><span data-slate-leaf="true" data-offset-key="7673:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7674"><span data-slate-leaf="true" data-offset-key="7674:0" data-first-offset="true"><span data-slate-string="true">) </span></span></span><span data-slate-object="text" data-key="7675"><span data-slate-leaf="true" data-offset-key="7675:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">map</span></span></span></span><span data-slate-object="text" data-key="7676"><span data-slate-leaf="true" data-offset-key="7676:0" data-first-offset="true"><span data-slate-string="true">[</span></span></span><span data-slate-object="text" data-key="7677"><span data-slate-leaf="true" data-offset-key="7677:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7678"><span data-slate-leaf="true" data-offset-key="7678:0" data-first-offset="true"><span data-slate-string="true">][]</span></span></span><span data-slate-object="text" data-key="7679"><span data-slate-leaf="true" data-offset-key="7679:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7680"><span data-slate-object="text" data-key="7681"><span data-slate-leaf="true" data-offset-key="7681:0" data-first-offset="true"><span data-slate-string="true">   </span></span></span><span data-slate-object="text" data-key="7682"><span data-slate-leaf="true" data-offset-key="7682:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">// Load 加载配置到某个对象</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7683"><span data-slate-object="text" data-key="7684"><span data-slate-leaf="true" data-offset-key="7684:0" data-first-offset="true"><span data-slate-string="true">   Load(key </span></span></span><span data-slate-object="text" data-key="7685"><span data-slate-leaf="true" data-offset-key="7685:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">string</span></span></span></span><span data-slate-object="text" data-key="7686"><span data-slate-leaf="true" data-offset-key="7686:0" data-first-offset="true"><span data-slate-string="true">, val </span></span></span><span data-slate-object="text" data-key="7687"><span data-slate-leaf="true" data-offset-key="7687:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">interface</span></span></span></span><span data-slate-object="text" data-key="7688"><span data-slate-leaf="true" data-offset-key="7688:0" data-first-offset="true"><span data-slate-string="true">{}) </span></span></span><span data-slate-object="text" data-key="7689"><span data-slate-leaf="true" data-offset-key="7689:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">error</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="7690"><span data-slate-object="text" data-key="7691"><span data-slate-leaf="true" data-offset-key="7691:0" data-first-offset="true"><span data-slate-string="true">}</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7692"><span data-slate-object="text" data-key="7693"><span data-slate-leaf="true" data-offset-key="7693:0" data-first-offset="true"><span data-slate-string="true">到这里，配置文件服务的接口就设计完成了，下一节课我们接着讨论整个服务的具体实现。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7694" id="sr-toc-4"><span data-slate-object="text" data-key="7695"><span data-slate-leaf="true" data-offset-key="7695:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7696"><span data-slate-object="text" data-key="7697"><span data-slate-leaf="true" data-offset-key="7697:0" data-first-offset="true"><span data-slate-string="true">今天我们围绕获取配置这一个功能点，设计了环境变量服务和配置文件服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7698"><span data-slate-object="text" data-key="7699"><span data-slate-leaf="true" data-offset-key="7699:0" data-first-offset="true"><span data-slate-string="true">环境变量服务按照先读取本地默认. env 文件，再读取运行环境变量的方式来实现，并且为其设置了最关键的环境变量 APP_ENV 来表示这个应用当前运行的环境。后续我们根据这个 APP_ENV 来获取具体环境的本地配置文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7700"><span data-slate-object="text" data-key="7701"><span data-slate-leaf="true" data-offset-key="7701:0" data-first-offset="true"><span data-slate-string="true">有的人可能会觉得要获取一个变量，直接使用配置文件就行啊，为什么要绕这么一圈？但是，环境变量是一个应用运行环境的一些参数，在现在的容器化流行的架构设计中，一般都会选择使用环境变量来区别不同的环境和配置。所以我们为框架提供获取环境变量的方式，在实际架构，特别是微服务相关的架构中，是非常有用的。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="7702" id="sr-toc-5"><span data-slate-object="text" data-key="7703"><span data-slate-leaf="true" data-offset-key="7703:0" data-first-offset="true"><span data-slate-string="true">思考题</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="7704"><span data-slate-object="text" data-key="7705"><span data-slate-leaf="true" data-offset-key="7705:0" data-first-offset="true"><span data-slate-string="true">关于使用环境变量作为配置项，其实有一个比较出名的服务设计经验建议了 </span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="7706"><span data-slate-object="text" data-key="7707"><span data-slate-leaf="true" data-offset-key="7707:0" data-first-offset="true"><span data-slate-string="true">The Twelve-Factor App</span></span></span></a><span data-slate-object="text" data-key="7708"><span data-slate-leaf="true" data-offset-key="7708:0" data-first-offset="true"><span data-slate-string="true">，这 12 条的实践标准，出自一个做 Paas 服务的 Herku 公司，是他们工程师的经验之谈。在配置文件这块，它建议所有环境的配置统一成一份，只通过环境变量进行区分。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7709"><span data-slate-object="text" data-key="7710"><span data-slate-leaf="true" data-offset-key="7710:0" data-first-offset="true"><span data-slate-string="true">实际上今天我们并没有完全按照实践标准来做，还是提供了将不同环境的配置分目录的方式。你不妨阅读这 12 条的实践标准，说说你的观点。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="7711"><span data-slate-object="text" data-key="7712"><span data-slate-leaf="true" data-offset-key="7712:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区分享你的思考。感谢你的收听，如果觉得有收获，也欢迎把今天的内容分享给你身边的朋友，邀他一起学习。我们下节课见～</span></span></span></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/60/8b/601539e39d1f599f26bffa89653fca8b.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-6">精选留言 (3)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/0f/98/b1/f89a84d0.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>Casper</span><span><div class="sr-rd-content-center"><img class="" src="https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png"></div></span></div></div><div>在根据文章进行编码后，运行程序的时候发现程序会一直卡在获取锁的地方。
调试了很久才发现是因为 EnvProvider 的 Boot () 中调用了 MustMake, 会再一次获取锁，会导致死锁。
死锁的原因是: main.go 中的 Bind () 会先获取锁，使用的是 defer 释放锁，在 Bind () 中由于会调用 Boot (),
EnvProvider 的 Boot () 中也会去获取锁，导致再次获取锁时会失败，因此会卡住.
解决方法是：将 Bind () 中的锁释放改为 hade.lock.Unlock () 直接释放，尽量让锁的占用时间最小。</div><div><div>2022-02-17</div><div><div><i></i><span>3</span></div><div><i></i><span>5</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>qinsi</span></div></div><div>12 factor 的建议是配置存储在环境变量中，甚至都不建议使用配置文件。这里似乎是需要一个配置中心：启动容器的时候从配置中心拉取配置注入到容器的环境变量中，而容器中的应用只需要读取环境变量就好了。</div><div><div>2021-10-21</div><div><div><i></i><span>5</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/12/cb/07/482b7155.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span> 牛玉富</span></div></div><div>看来，还是用 yaml 的多</div><div><div>2022-01-13</div><div><div><i></i><span></span></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".s"><outline class="toc-level-h1" data-reactid=".s.0" style="width: 175px;"><active data-reactid=".s.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".s.0.1"><span data-reactid=".s.0.1.0">15｜配置和环境（上）：配置服务中的设计思路</span></a></outline><outline class="toc-level-h2" data-reactid=".s.1" style="width: 165px;"><active data-reactid=".s.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".s.1.1"><span data-reactid=".s.1.1.0">环境变量获取配置思路分析</span></a></outline><outline class="toc-level-h2" data-reactid=".s.2" style="width: 165px;"><active data-reactid=".s.2.0"></active><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".s.2.1"><span data-reactid=".s.2.1.0">环境变量服务的接口和实现</span></a></outline><outline class="toc-level-h2" data-reactid=".s.3" style="width: 165px;"><active data-reactid=".s.3.0"></active><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".s.3.1"><span data-reactid=".s.3.1.0">读取配置服务的接口</span></a></outline><outline class="toc-level-h2" data-reactid=".s.4" style="width: 165px;"><active data-reactid=".s.4.0"></active><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".s.4.1"><span data-reactid=".s.4.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".s.5" style="width: 165px;"><active data-reactid=".s.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".s.5.1"><span data-reactid=".s.5.1.0">思考题</span></a></outline><outline class="toc-level-h2" data-reactid=".s.6" style="width: 165px;"><active data-reactid=".s.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".s.6.1"><span data-reactid=".s.6.1.0">精选留言 (3)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/428012" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>