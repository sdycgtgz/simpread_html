
                <html lang="en" class="simpread-font simpread-theme-root" style=''>
                    <head>
                        <meta charset="utf-8">
                        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
                        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
                        <meta name="author" content="Kenshin"/>
                        <meta name="description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展" />
                        <meta name="keywords" content="Chrome extension, Chrome 扩展, 阅读模式, 沉浸式阅读, 简悦, 简阅, read mode, reading mode, reader view, firefox, firefox addon, userscript, safari, opera, tampermonkey"/>
                        <meta name="thumbnail" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:title" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <meta property="og:type" content="website">
                        <meta property="og:local" content="zh_CN"/>
                        <meta property="og:url" content="http://ksria.com/simpread"/>
                        <meta property="og:image" content="https://simpread-1254315611.cos.ap-shanghai.myqcloud.com/static/introduce-2.png"/>
                        <meta property="og:image:type" content="image/png"/>
                        <meta property="og:image:width" content="960"/>
                        <meta property="og:image:height" content="355"/>
                        <meta property="og:site_name" content="http://ksria.com/simpread"/>
                        <meta property="og:description" content="简悦 SimpRead - 如杂志般沉浸式阅读体验的扩展"/>
                        <style type="text/css">.simpread-font{font:300 16px/1.8 -apple-system,PingFang SC,Microsoft Yahei,Lantinghei SC,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#333;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased}.simpread-hidden{display:none}.simpread-read-root{display:-webkit-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;margin:0;top:-1000px;left:0;width:100%;z-index:2147483646;overflow-x:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}.simpread-read-root-show{top:0}.simpread-read-root-hide{top:1000px}sr-read{display:-webkit-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column;margin:20px 20%;min-width:400px;min-height:400px;text-align:center}read-process{position:fixed;top:0;left:0;height:3px;width:100%;background-color:#64b5f6;-webkit-transition:width 2s;transition:width 2s;z-index:20000}sr-rd-content-error{display:block;position:relative;margin:0;margin-bottom:30px;padding:25px;background-color:rgba(0,0,0,.05)}sr-rd-footer{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;font-size:14px}sr-rd-footer,sr-rd-footer-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}sr-rd-footer-group{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-rd-footer-line{width:100%;border-top:1px solid #e0e0e0}sr-rd-footer-text{min-width:150px}sr-rd-footer-copywrite{margin:10px 0 0;color:inherit}sr-rd-footer-copywrite abbr{-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-decoration:none}sr-rd-footer-copywrite .second{margin:10px 0}sr-rd-footer-copywrite .third a:hover{border:none!important}sr-rd-footer-copywrite .third a:first-child{margin-right:50px}sr-rd-footer-copywrite .sr-icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:33px;height:33px;opacity:.8;-webkit-transition:opacity .5s ease;transition:opacity .5s ease;cursor:pointer}sr-rd-footer-copywrite .sr-icon:hover{opacity:1}sr-rd-footer-copywrite a,sr-rd-footer-copywrite a:link,sr-rd-footer-copywrite a:visited{margin:0;padding:0;color:inherit;background-color:transparent;font-size:inherit!important;line-height:normal;text-decoration:none;vertical-align:baseline;vertical-align:initial;border:none!important;box-sizing:border-box}sr-rd-footer-copywrite a:focus,sr-rd-footer-copywrite a:hover,sr-rd-footer a:active{color:inherit;text-decoration:none;border-bottom:1px dotted!important}.simpread-blocks{text-decoration:none!important}.simpread-blocks *{margin:0}.simpread-blocks a{padding:0;text-decoration:none!important}.simpread-blocks img{margin:0;padding:0;border:0;background:transparent;box-shadow:none}.simpread-focus-root{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,92%,.9);z-index:2147483645;opacity:0;-webkit-transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms;transition:opacity 1s cubic-bezier(.23,1,.32,1) 0ms}.simpread-focus-highlight{position:relative;box-shadow:0 0 0 20px #fff;background-color:#fff;overflow:visible;z-index:2147483646}.sr-controlbar-bg sr-rd-crlbar,.sr-controlbar-bg sr-rd-crlbar fab{z-index:2147483647}sr-rd-crlbar.controlbar{position:fixed;right:0;bottom:0;width:100px;height:100%;opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}sr-rd-crlbar.controlbar:hover{opacity:1}sr-rd-crlbar fap *{box-sizing:border-box}@media (max-height:620px){fab{zoom:.8}}@media (max-height:783px){dialog-gp dialog-content{max-height:580px}dialog-gp dialog-footer{border-top:1px solid #e0e0e0}}.simpread-highlight-selector{outline:3px dashed #1976d2!important;cursor:pointer!important}.simpread-highlight-controlbar,.simpread-highlight-selector{background-color:#fafafa!important;opacity:.8!important;-webkit-transition:opacity .5s ease!important;transition:opacity .5s ease!important}.simpread-highlight-controlbar{position:relative!important;border:3px dashed #1976d2!important}simpread-highlight,sr-snapshot-ctlbar{position:fixed;top:0;left:0;right:0;padding:15px;height:50px;background-color:rgba(50,50,50,.9);box-shadow:0 2px 5px rgba(0,0,0,.26);box-sizing:border-box;z-index:2147483640}simpread-highlight,sr-highlight-ctl,sr-snapshot-ctlbar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sr-highlight-ctl{margin:0 5px;width:50px;height:20px;color:#fff;background-color:#1976d2;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}toc-bg{position:fixed;left:0;top:0;width:50px;height:200px;font-size:medium}toc-bg:hover{z-index:3}.toc-bg-hidden{opacity:0;-webkit-transition:opacity .5s ease;transition:opacity .5s ease}.toc-bg-hidden:hover{opacity:1;z-index:3}.toc-bg-hidden:hover toc{width:180px}toc *{all:unset}toc{position:fixed;left:0;top:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;padding:10px;width:0;max-width:200px;max-height:500px;overflow-x:hidden;overflow-y:hidden;cursor:pointer;border:1px solid hsla(0,0%,62%,.22);-webkit-transition:width .5s;transition:width .5s}toc:hover{overflow-y:auto}toc.mini:hover{width:200px!important}toc::-webkit-scrollbar{width:3px}toc::-webkit-scrollbar-thumb{border-radius:10px;background-color:hsla(36,2%,54%,.5)}toc outline{position:relative;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;padding:2px 0;min-height:21px;line-height:21px;text-align:left}toc outline a,toc outline a:active,toc outline a:focus,toc outline a:visited{display:block;width:100%;color:inherit;font-size:11px;text-decoration:none!important;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}toc outline a:hover{font-weight:700!important}toc outline a.toc-outline-theme-dark,toc outline a.toc-outline-theme-night{color:#fff!important}.toc-level-h1{padding-left:5px}.toc-level-h2{padding-left:15px}.toc-level-h3{padding-left:25px}.toc-level-h4{padding-left:35px}.toc-outline-active{border-left:2px solid #f44336}toc outline active{position:absolute;left:0;top:0;bottom:0;padding:0 0 0 3px;border-left:2px solid #e8e8e8}sr-kbd{background:-webkit-gradient(linear,0 0,0 100%,from(#fff785),to(#ffc542));border:1px solid #e3be23;-o-border-image:none;border-image:none;-o-border-image:initial;border-image:initial;position:absolute;left:0;padding:1px 3px 0;font-size:11px!important;font-weight:700;box-shadow:0 3px 7px 0 rgba(0,0,0,.3);overflow:hidden;border-radius:3px}.sr-kbd-a{position:relative}kbd-mapping{position:fixed;left:5px;bottom:5px;-ms-flex-flow:row;flex-flow:row;width:250px;height:500px;background-color:#fff;border:1px solid hsla(0,0%,62%,.22);box-shadow:0 2px 5px rgba(0,0,0,.26);border-radius:3px}kbd-mapping,kbd-maps{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}kbd-maps{margin:40px 0 20px;width:100%;overflow-x:auto}kbd-maps::-webkit-scrollbar-thumb{background-clip:padding-box;border-radius:10px;border:2px solid transparent;background-color:rgba(85,85,85,.55)}kbd-maps::-webkit-scrollbar{width:10px;-webkit-transition:width .7s cubic-bezier(.4,0,.2,1);transition:width .7s cubic-bezier(.4,0,.2,1)}kbd-mapping kbd-map-title{position:absolute;margin:5px 0;width:100%;font-size:14px;font-weight:700}kbd-maps-group{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}kbd-maps-title{margin:5px 0;padding-left:53px;font-size:12px;font-weight:700}kbd-map kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}kbd-map kbd-name{display:inline-block;text-align:right;width:50px}kbd-map kbd-desc{padding-left:3px}sharecard-bg{position:fixed;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(0,0,0,.4);z-index:2147483647}sharecard{max-width:450px;background-color:#64b5f6}sharecard,sharecard-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-head{margin:25px;color:#fff;border-radius:10px;box-shadow:0 2px 6px 0 rgba(0,0,0,.2),0 25px 50px 0 rgba(0,0,0,.15)}sharecard-card{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sharecard-card,sharecard-top{display:-webkit-box;display:-ms-flexbox;display:flex}sharecard-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:65px;background-color:#fff;color:#878787;font-size:25px;font-weight:500;border-top-left-radius:10px;border-top-right-radius:10px}sharecard-top span.logos{display:block;width:48px;height:48px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABU1BMVEUAAAAnNJMnNZI3Q5onNJInNJMnNJInNJMnNJI8SJ0tOZY/S55EUKAoNJI6RpwoNJNIU6InNJInNJImNJI7SJwmNJJ2fLUiMJFKVaNCTJ9faK1HUaJOWKVSXaUnNJNYY6pye7cmM5JXYKhwebMjMI8mL4719fW9vb0oNZP/UlLz8/QqN5TAwMAnNJPv7+/Pz8/q6+/p6enNzc3Kysry8vMsOJXc3env7/LU1uXo29vR0dHOzs7ExMTwjo73bW37XV3Aj1TCYELl5u3n5+fW2Obn6O7f4OrZ2+g0QJkxPpgvO5bh4uvS1OTP0ePCwsJQW6ZLVqTs7fHd3d3V1dXqv79VX6lET6A1TIxXUIBSgHxWQnpelHf+WVnopkXqbC7j5Ozi4uLDw8NGUaFATJ9SgH3r6+vGyd7BxNva2trX19ejqM2gpczHx8dze7Zha67Z2dlTgH1aXQeSAAAAJnRSTlMA6ff+497Y8NL+/fv49P379sqab/BeOiX06tzVy8m/tKqpalA7G6oKj0EAAAJlSURBVEjHndNXWxpBFIDhcS2ICRLAkt4Dx4WhLk0E6R0MYoIISrWX5P9f5cwSIRC2+T1czMV5n2FnZwn2eWONUqCAv3H2Uf5Ra1hx4+0WEXtDQW0fCPYJ1EffEfIV4CSROAE4jsePoTFsNmTJF/IeIHF2lgCIn57GodlqDWXBK7IwBYatVlMWFAildPKX7I3m74Z9fsCiQChoimoFQAz04Ad2gH1n9fv9n9hgMNDr9euLWD6fLxQKxaLfb7dTSlahbFVdEPwIQtrAihZQgyKCtCagbQe3xh0QFMgy5MR11+ewYY5/qlZ7vT2xu93ULKjbFLpiUxnIIwjgKmVTLDUFXMrAi2NJWCRLIthTBo4xyOLKpwyqU6CuDCI41hFBCVdOhyLw4FgJ1skCAiyl9BSHbCorgo6VJXTru5hrVCQS8Yr5xLzX59YJSFpVFwD9U0BGC3hGdFpATgRupTGe9R9I1b1ePBvXKDyvq/O/44LT4/E4BUbSCAwj8Evq6HlnOBprx6JhJz8Gktc7xeaP9ndY+0coQvCccFBD4JW60UIY50ciLOAODAQRVOeCHm4Q3Xks6uRDY+CQ+AR4T2wMYh6+jMCIQOp78CFoj0H7EQgIuhI3dGaHCrwgADwCPjJvA372GRigCJg49FUdk3D87pq3zp4SA5zc1Zh9DxfwkpjgUg5Mv+lbeE3McC8Lpu7SA3wk2xzcqL2tN5DfIsQC8HB7UamUy6FQOpTO5QKBQDZbKnWSyUzGjdWCwaDA8+7Le4BNgm3qQGWchYh9s5hNq6wVbBlbwhZYOp3OYOA4zmgEypnM2zj8ByIdedKrH8vDAAAAAElFTkSuQmCC");zoom:.8}sharecard-content{padding:15px;max-height:500px;font-size:20px;text-align:justify;background-color:#2196f3;overflow-x:hidden;overflow-y:auto}sharecard-via{padding:10px;font-size:10px;background-color:#2196f3}sharecard-footer{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding-right:5px;height:100px;background-color:#fff;color:#878787;font-size:15px;font-weight:500;border-bottom-left-radius:10px;border-bottom-right-radius:10px}sharecard-footer,sharecard-footer div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}sharecard-footer span.qrcode{display:block;width:100px;height:100px;margin:5px;background-repeat:no-repeat;background-position:50%;background-image:url("data:image/png;base64,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")}sharecard-control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 19px;height:80px;background-color:#fff}simpread-snapshot{width:100%;height:100%;cursor:move;z-index:2147483645}simpread-snapshot,sr-mask{position:fixed;left:0;top:0}sr-mask{background-color:rgba(0,0,0,.1)}.simpread-feedback,.simpread-urlscheme{position:fixed;right:20px;bottom:20px;z-index:2147483646}simpread-feedback,simpread-urlscheme{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:20px 20px 0;width:500px;color:rgba(51,51,51,.87);background-color:#fff;border-radius:3px;box-shadow:0 0 2px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.26);overflow:hidden;-webkit-transform-origin:bottom;transform-origin:bottom;-webkit-transition:all .6s ease;transition:all .6s ease}simpread-feedback *,simpread-urlscheme *{font-size:12px!important;box-sizing:border-box}simpread-feedback.active,simpread-urlscheme.active{-webkit-animation-name:srFadeInUp;animation-name:srFadeInUp;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback.hide,simpread-urlscheme.hide{-webkit-animation-name:srFadeInDown;animation-name:srFadeInDown;-webkit-animation-duration:.45s;animation-duration:.45s;-webkit-animation-fill-mode:both;animation-fill-mode:both}simpread-feedback sr-fb-label,simpread-urlscheme sr-urls-label{width:100%}simpread-feedback sr-fb-head,simpread-urlscheme sr-urls-head{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:5px;width:100%}simpread-feedback sr-fb-content,simpread-urlscheme sr-urls-content{margin-bottom:5px;width:100%}simpread-feedback sr-urls-footer,simpread-urlscheme sr-urls-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-fb-a,simpread-urlscheme sr-urls-a{color:#2163f7;cursor:pointer}simpread-feedback text-field-state,simpread-urlscheme text-field-state{border-top:none rgba(34,101,247,.8)!important;border-left:none rgba(34,101,247,.8)!important;border-right:none rgba(34,101,247,.8)!important;border-bottom:2px solid rgba(34,101,247,.8)!important}simpread-feedback switch,simpread-urlscheme switch{margin-top:0!important}@-webkit-keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes srFadeInUp{0%{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}@keyframes srFadeInDown{0%{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}to{opacity:0;-webkit-transform:translateY(100px);transform:translateY(100px)}}simpread-feedback sr-fb-head{font-weight:700}simpread-feedback sr-fb-content{-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column}simpread-feedback sr-fb-content,simpread-feedback sr-fb-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-direction:normal}simpread-feedback sr-fb-footer{-webkit-box-orient:horizontal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;width:100%}simpread-feedback sr-close{position:absolute;right:20px;cursor:pointer;-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s;z-index:200}simpread-feedback sr-close:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:10px}simpread-feedback sr-stars i{margin-right:10px;cursor:pointer}simpread-feedback sr-stars i svg{-webkit-transition:all 1s cubic-bezier(.23,1,.32,1) .1s;transition:all 1s cubic-bezier(.23,1,.32,1) .1s}simpread-feedback sr-stars i svg:hover{-webkit-transform:rotate(-15deg) scale(1.3);transform:rotate(-15deg) scale(1.3)}simpread-feedback sr-stars i.active svg{-webkit-transform:rotate(0) scale(1);transform:rotate(0) scale(1)}simpread-feedback sr-emojis{display:block;height:100px;overflow:hidden}simpread-feedback sr-emoji{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:.3s;transition:.3s}simpread-feedback sr-emoji>svg{margin:15px 0;width:70px;height:70px;-ms-flex-negative:0;flex-shrink:0}simpread-feedback sr-stars-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:10px 0 20px}</style>
                        <style type="text/css">.simpread-theme-root{font-size:62.5%!important}sr-rd-content,sr-rd-desc,sr-rd-title{width:100%}sr-rd-title{display:-webkit-box;margin:1em 0 .5em;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizelegibility;-webkit-line-clamp:3;-webkit-box-orient:vertical}sr-rd-content{text-align:left;word-break:break-word}sr-rd-desc{text-align:justify;line-height:2.4;margin:0 0 1.2em;box-sizing:border-box}sr-rd-content{font-size:25.6px;font-size:1.6rem;line-height:1.6}sr-rd-content h1,sr-rd-content h1 *,sr-rd-content h2,sr-rd-content h2 *,sr-rd-content h3,sr-rd-content h3 *,sr-rd-content h4,sr-rd-content h4 *,sr-rd-content h5,sr-rd-content h5 *,sr-rd-content h6,sr-rd-content h6 *{word-break:break-all}sr-rd-content div,sr-rd-content p{display:block;float:inherit;line-height:1.6;font-size:25.6px;font-size:1.6rem}sr-rd-content div,sr-rd-content p,sr-rd-content pre,sr-rd-content sr-blockquote{margin:0 0 1.2em;word-break:break-word}sr-rd-content a{padding:0 5px;vertical-align:baseline;vertical-align:initial}sr-rd-content a,sr-rd-content a:link{color:inherit;font-size:inherit;font-weight:inherit;border:none}sr-rd-content a:hover{background:transparent}sr-rd-content img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}sr-rd-content figcaption{text-align:center;font-size:14px}sr-rd-content sr-blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}sr-rd-content sr-blockquote:before{position:absolute}sr-rd-content sr-blockquote *{margin:0;font-size:inherit}sr-rd-content table{width:100%;margin:0 0 1.2em;word-break:keep-all;word-break:normal;overflow:auto;border:none}sr-rd-content table td,sr-rd-content table th{border:none}sr-rd-content ul{margin:0 0 1.2em;margin-left:1.3em;padding:0;list-style:disc}sr-rd-content ol{list-style:decimal;margin:0;padding:0}sr-rd-content ol li,sr-rd-content ul li{font-size:inherit;list-style:disc;margin:0 0 1.2em}sr-rd-content ol li{list-style:decimal;margin-left:1.3em}sr-rd-content ol li *,sr-rd-content ul li *{margin:0;text-align:left;text-align:initial}sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em}sr-rd-content li ul{list-style:circle}sr-rd-content pre{font-family:Consolas,Monaco,Andale Mono,Source Code Pro,Liberation Mono,Courier,monospace;display:block;padding:15px;line-height:1.5;word-break:break-all;word-wrap:break-word;white-space:pre;overflow:auto}sr-rd-content pre,sr-rd-content pre *,sr-rd-content pre div{font-size:17.6px;font-size:1.1rem}sr-rd-content li pre code,sr-rd-content p pre code,sr-rd-content pre{background-color:transparent;border:none}sr-rd-content pre code{margin:0;padding:0}sr-rd-content pre code,sr-rd-content pre code *{font-size:17.6px;font-size:1.1rem}sr-rd-content pre p{margin:0;padding:0;color:inherit;font-size:inherit;line-height:inherit}sr-rd-content li code,sr-rd-content p code{margin:0 4px;padding:2px 4px;font-size:17.6px;font-size:1.1rem}sr-rd-content mark{margin:0 5px;padding:2px;background:#fffdd1;border-bottom:1px solid #ffedce}.sr-rd-content-img{width:90%;height:auto}.sr-rd-content-img-load{width:48px;height:48px;margin:0;padding:0;border-style:none;border-width:0;background-repeat:no-repeat;background-image:url(data:image/gif;base64,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)}.sr-rd-content-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.sr-rd-content-center-small{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.sr-rd-content-center-small img{margin:0;padding:0;border:0;box-shadow:none}img.simpread-img-broken{cursor:pointer}.sr-rd-content-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}sr-rd-mult{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin:0 0 16px;padding:16px 0 24px;width:100%;background-color:#fff;border-radius:4px;box-shadow:0 1px 2px 0 rgba(60,64,67,.3),0 2px 6px 2px rgba(60,64,67,.15)}sr-rd-mult:hover{-webkit-transition:all .45s 0ms;transition:all .45s 0ms;box-shadow:1px 1px 8px rgba(0,0,0,.16)}sr-rd-mult sr-rd-mult-content{padding:0 16px;overflow:auto}sr-rd-mult sr-rd-mult-avatar,sr-rd-mult sr-rd-mult-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}sr-rd-mult sr-rd-mult-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 15px}sr-rd-mult sr-rd-mult-avatar span{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-width:75px;overflow:hidden;text-overflow:ellipsis;text-align:left;font-size:16px;font-size:1rem}sr-rd-mult sr-rd-mult-avatar img{margin-bottom:0;max-width:50px;max-height:50px;width:50px;height:50px;border-radius:50%}sr-rd-mult sr-rd-mult-content img{max-width:80%}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center{margin:0}sr-page{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%}</style>
                        <style type="text/css">sr-rd-theme-github{display:none}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#363636}sr-rd-content h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}sr-rd-content h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}sr-rd-content h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}sr-rd-content h4{font-size:32px;font-size:2rem}sr-rd-content h5,sr-rd-content h6{font-size:25.6px;font-size:1.6rem}sr-rd-content h6{color:#777}sr-rd-content ol,sr-rd-content ul{list-style-type:disc;padding:0;padding-left:2em}sr-rd-content ol ol,sr-rd-content ul ol{list-style-type:lower-roman}sr-rd-content ol ol ol,sr-rd-content ol ul ol,sr-rd-content ul ol ol,sr-rd-content ul ul ol{list-style-type:lower-alpha}sr-rd-content table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}sr-rd-content table th{font-weight:700}sr-rd-content table td,sr-rd-content table th{padding:6px 13px;border:1px solid #ddd}sr-rd-content table tr{background-color:#fff;border-top:1px solid #ccc}sr-rd-content table tr:nth-child(2n){background-color:#f8f8f8}sr-rd-content sr-blockquote{border-left:4px solid #ddd}.simpread-theme-root{background-color:#fff;color:#333}sr-rd-title{font-family:PT Sans,SF UI Display,\.PingFang SC,PingFang SC,Neue Haas Grotesk Text Pro,Arial Nova,Segoe UI,Microsoft YaHei,Microsoft JhengHei,Helvetica Neue,Source Han Sans SC,Noto Sans CJK SC,Source Han Sans CN,Noto Sans SC,Source Han Sans TC,Noto Sans CJK TC,Hiragino Sans GB,sans-serif;font-size:54.4px;font-size:3.4rem;font-weight:700;line-height:1.3}sr-rd-desc{position:relative;margin:0;margin-bottom:30px;padding:25px;padding-left:56px;font-size:28.8px;font-size:1.8rem;color:#777;background-color:rgba(0,0,0,.05);box-sizing:border-box}sr-rd-desc:before{content:"\201C";position:absolute;top:-28px;left:16px;font-size:80px;font-family:Arial;color:rgba(0,0,0,.15)}sr-rd-content,sr-rd-content *,sr-rd-content div,sr-rd-content p{color:#363636;font-weight:400;line-height:1.8}sr-rd-content b *,sr-rd-content strong,sr-rd-content strong * sr-rd-content b{-webkit-animation:none 0s ease 0s 1 normal none running;animation:none 0s ease 0s 1 normal none running;-webkit-backface-visibility:visible;backface-visibility:visible;background:transparent none repeat 0 0/auto auto padding-box border-box scroll;border:medium none currentColor;border-collapse:separate;-o-border-image:none;border-image:none;border-radius:0;border-spacing:0;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:#000;-webkit-columns:auto;-moz-columns:auto;columns:auto;-webkit-column-count:auto;-moz-column-count:auto;column-count:auto;-webkit-column-fill:balance;-moz-column-fill:balance;column-fill:balance;-webkit-column-gap:normal;-moz-column-gap:normal;column-gap:normal;-webkit-column-rule:medium none currentColor;-moz-column-rule:medium none currentColor;column-rule:medium none currentColor;-webkit-column-span:1;-moz-column-span:1;column-span:1;-webkit-column-width:auto;-moz-column-width:auto;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font-family:serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;line-height:normal;height:auto;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;left:auto;letter-spacing:normal;list-style:disc outside none;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:2;outline:medium none invert;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;-webkit-perspective:none;perspective:none;-webkit-perspective-origin:50% 50%;perspective-origin:50% 50%;position:static;right:auto;-moz-tab-size:8;-o-tab-size:8;tab-size:8;table-layout:auto;text-align:left;text-align-last:auto;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;top:auto;-webkit-transform:none;transform:none;-webkit-transform-origin:50% 50% 0;transform-origin:50% 50% 0;-webkit-transform-style:flat;transform-style:flat;-webkit-transition:none 0s ease 0s;transition:none 0s ease 0s;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:2;width:auto;word-spacing:normal;z-index:auto;all:initial}sr-rd-content a,sr-rd-content a:link{color:#4183c4;text-decoration:none}sr-rd-content a:active,sr-rd-content a:focus,sr-rd-content a:hover{color:#4183c4;text-decoration:underline}sr-rd-content pre{background-color:#f7f7f7;border-radius:3px}sr-rd-content li code,sr-rd-content p code{background-color:rgba(0,0,0,.04);border-radius:3px}.simpread-multi-root{background:#f8f9fa}</style>
                        <style type="text/css"></style>
                        <style type="text/css">@media (pointer:coarse){sr-read{margin:20px 5%!important;min-width:0!important;max-width:90%!important}sr-rd-title{margin-top:0;font-size:2.7rem}sr-rd-content sr-blockquote,sr-rd-desc{margin:10 0!important;padding:0 0 0 10px!important;width:90%;font-size:1.8rem;font-style:normal;line-height:1.7;text-align:justify}sr-rd-content{font-size:1.75rem;font-weight:300}sr-rd-content figure{margin:0;padding:0;text-align:center}sr-rd-content a,sr-rd-content a:link,sr-rd-content li code,sr-rd-content p code{font-size:inherit}sr-rd-footer{margin-top:20px}sr-blockquote,sr-blockquote *{margin:5px!important;padding:5px!important}sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6,sr-rd-title{font-family:PingFang SC,Verdana,Helvetica Neue,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;font-weight:100;line-height:1.35}sr-rd-content-h1,sr-rd-content-h2,sr-rd-content-h3,sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h1,sr-rd-content h2,sr-rd-content h3,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}sr-rd-content-h1,sr-rd-content h1{font-size:1.8em}sr-rd-content-h2,sr-rd-content h2{font-size:1.6em}sr-rd-content-h3,sr-rd-content h3{font-size:1.4em}sr-rd-content-h4,sr-rd-content-h5,sr-rd-content-h6,sr-rd-content h4,sr-rd-content h5,sr-rd-content h6{font-size:1.2em}sr-rd-content-ul,sr-rd-content ul{margin-left:1.3em!important;list-style:disc}sr-rd-content-ol,sr-rd-content ol{list-style:decimal;margin-left:1.9em!important}sr-rd-content-ol ol,sr-rd-content-ol ul,sr-rd-content-ul ol,sr-rd-content-ul ul,sr-rd-content li ol,sr-rd-content li ul{margin-bottom:.8em;margin-left:2em!important}sr-rd-content img{margin:0;padding:0;border:0;max-width:100%!important;height:auto;box-shadow:0 20px 20px -10px rgba(0,0,0,.1)}sr-rd-mult{min-width:0;background-color:#fff;box-shadow:0 1px 6px rgba(32,33,36,.28);border-radius:8px}sr-rd-mult sr-rd-mult-avatar div{margin:0}sr-rd-mult sr-rd-mult-avatar .sr-rd-content-center-small{margin:7px 0!important}sr-rd-mult sr-rd-mult-avatar span{display:block}sr-rd-mult sr-rd-mult-content{padding-left:0}@media only screen and (max-device-width:1024px){.simpread-theme-root,html.simpread-theme-root{font-size:80%!important}sr-rd-mult sr-rd-mult-avatar img{width:50px;height:50px;min-width:50px;min-height:50px}toc-bg toc{width:10px!important}toc-bg:hover toc{width:auto!important}}@media only screen and (max-device-width:414px){.simpread-theme-root,html.simpread-theme-root{font-size:70%!important}sr-rd-mult sr-rd-mult-avatar img{width:30px;height:30px;min-width:30px;min-height:30px}}@media only screen and (max-device-width:320px){.simpread-theme-root,html.simpread-theme-root{font-size:90%!important}sr-rd-content p{margin-bottom:.5em}}}</style>
                        <style type="text/css">undefinedsr-rd-content *, sr-rd-content p, sr-rd-content div {}sr-rd-content pre code, sr-rd-content pre code * {}sr-rd-desc {}sr-rd-content pre {}sr-rd-title {}</style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css"></style>
                        <style type="text/css">sr-rd-content *, sr-rd-content p, sr-rd-content div {
        font-size: 15px;
    }

    .annote-perview, .annote-perview * {
        color: rgb(85, 85, 85);
        font-weight: 400;
        line-height: 1.8;
    }</style>
                        
                        
                        <script>setTimeout(()=>{const e=location.hash.replace("#id=","");let t,a=!1;const n=t=>{for(let n of t){let t;if((t=e.length>6?n.getAttribute("data-id"):n.getAttribute("data-idx"))==e){n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),a=!0;break}}};e&&(0==(t=document.getElementsByClassName("sr-unread-card")).length&&(t=document.getElementsByTagName("sr-annote")),n(t),a||n(t=document.getElementsByClassName("sr-annote")))},500);</script>
                        <script>document.addEventListener("DOMContentLoaded",function(){if("localhost"==location.hostname){const t=document.getElementsByTagName("img");for(let o of t){const t=o.src;t.startsWith("http")&&(o.src=location.origin+"/proxy?url="+t)}}},!1);</script>
                        <style>toc a {font-size: inherit!important;font-weight: 300!important;}</style><script>setTimeout(()=>{const max=document.getElementsByTagName('sr-annote-note-tip').length;for(let i=0;i<max;i++){const target=document.getElementsByTagName('sr-annote-note-tip')[i],value=target.dataset.value;value&&(target.innerText=value)}},1000);</script><title>简悦 | 27｜滚动更新：如何做到平滑的应用升级降级？</title>
                    </head>
                    <body>
                        <sr-read style='font-family: "LXGW WenKai Screen";'>
                            <sr-rd-title>27｜滚动更新：如何做到平滑的应用升级降级？</sr-rd-title>
                    
                    <sr-rd-content><h1 id="sr-toc-0">27｜滚动更新：如何做到平滑的应用升级降级？</h1><div><span>Chrono</span> <span>2022-08-24</span></div><div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/21/ya/2136f7bf4d2fa2d091855f189be4fyya.jpeg"></div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAABCAYAAAB35kaxAAAAAXNSR0IArs4c6QAAAChJREFUGFdjfPfu3X8GKBAUFASz3r9/DxNiQBbDxcamn1yzSLEDZi8A2agny86FR+IAAAAASUVORK5CYII="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAABCAYAAAA8TpVcAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFCYtjkAcT9D8ti7hUOAAAAAElFTkSuQmCC"></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAABCAYAAABt2qY/AAAAAXNSR0IArs4c6QAAACdJREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULy2PQQK0YLewiZCQDhUS3LBhDf1QAAAABJRU5ErkJggg=="></div><div class="sr-rd-content-center-small"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAAXNSR0IArs4c6QAAAB1JREFUGFdjfPfu3X9BQUEGEHj//j2YBgFkMULyAF6lD8tbqYWOAAAAAElFTkSuQmCC"></div></div></div><div><div><div></div></div><div><div><div><div><div><div>00:00</div></div><div></div></div></div><a href="javascript:;"> 1.0x <i><span></span></i></a></div><div><span>讲述：Chrono</span><span> 大小：12.88M</span><span> 时长：14:06</span></div></div><audio title="27｜滚动更新：如何做到平滑的应用升级降级？" src="https://res001.geekbang.org/media/audio/22/a4/22948123eyy23c20d43cc61624bc6ba4/ld/ld.m3u8" __idm_id__="884765"></audio></div><div><div><div><div data-slate-editor="true" data-key="14010" autocorrect="off" spellcheck="false" data-gramm="false"><div data-slate-type="paragraph" data-slate-object="block" data-key="14011"><span data-slate-object="text" data-key="14012"><span data-slate-leaf="true" data-offset-key="14012:0" data-first-offset="true"><span data-slate-string="true">你好，我是 Chrono。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14013"><span data-slate-object="text" data-key="14014"><span data-slate-leaf="true" data-offset-key="14014:0" data-first-offset="true"><span data-slate-string="true">上次课里我们学习了管理有状态应用的对象 StatefulSet，再加上管理无状态应用的 Deployment 和 DaemonSet，我们就能在 Kubernetes 里部署任意形式的应用了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14015"><span data-slate-object="text" data-key="14016"><span data-slate-leaf="true" data-offset-key="14016:0" data-first-offset="true"><span data-slate-string="true">不过，只是把应用发布到集群里是远远不够的，要让应用稳定可靠地运行，还需要有持续的运维工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14017"><span data-slate-object="text" data-key="14018"><span data-slate-leaf="true" data-offset-key="14018:0" data-first-offset="true"><span data-slate-string="true">如果你还记得在</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14019"><span data-slate-object="text" data-key="14020"><span data-slate-leaf="true" data-offset-key="14020:0" data-first-offset="true"><span data-slate-string="true">第 18 节课</span></span></span></a><span data-slate-object="text" data-key="14021"><span data-slate-leaf="true" data-offset-key="14021:0" data-first-offset="true"><span data-slate-string="true">里，我们学过 Deployment 的 “应用伸缩” 功能就是一种常见的运维操作，在 Kubernetes 里，使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14022"><span data-slate-object="text" data-key="14023"><span data-slate-leaf="true" data-offset-key="14023:0" data-first-offset="true"><span data-slate-string="true">kubectl scale</span></span></span></span><span data-slate-object="text" data-key="14024"><span data-slate-leaf="true" data-offset-key="14024:0" data-first-offset="true"><span data-slate-string="true">，我们就可以轻松调整 Deployment 下属的 Pod 数量，因为 StatefulSet 是 Deployment 的一种特例，所以它也可以使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14025"><span data-slate-object="text" data-key="14026"><span data-slate-leaf="true" data-offset-key="14026:0" data-first-offset="true"><span data-slate-string="true">kubectl scale</span></span></span></span><span data-slate-object="text" data-key="14027"><span data-slate-leaf="true" data-offset-key="14027:0" data-first-offset="true"><span data-slate-string="true"> 来实现 “应用伸缩”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14028"><span data-slate-object="text" data-key="14029"><span data-slate-leaf="true" data-offset-key="14029:0" data-first-offset="true"><span data-slate-string="true">除了 “应用伸缩”，其他的运维操作比如应用更新、版本回退等工作，该怎么做呢？这些也是我们日常运维中经常会遇到的问题。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14030"><span data-slate-object="text" data-key="14031"><span data-slate-leaf="true" data-offset-key="14031:0" data-first-offset="true"><span data-slate-string="true">今天我就以 Deployment 为例，来讲讲 Kubernetes 在应用管理方面的高级操作：滚动更新，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14032"><span data-slate-object="text" data-key="14033"><span data-slate-leaf="true" data-offset-key="14033:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout</span></span></span></span><span data-slate-object="text" data-key="14034"><span data-slate-leaf="true" data-offset-key="14034:0" data-first-offset="true"><span data-slate-string="true"> 实现用户无感知的应用升级和降级。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14035" id="sr-toc-1"><span data-slate-object="text" data-key="14036"><span data-slate-leaf="true" data-offset-key="14036:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 如何定义应用版本</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14037"><span data-slate-object="text" data-key="14038"><span data-slate-leaf="true" data-offset-key="14038:0" data-first-offset="true"><span data-slate-string="true">应用的版本更新，大家都知道是怎么回事，比如我们发布了 V1 版，过了几天加了新功能，要发布 V2 版。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14039"><span data-slate-object="text" data-key="14040"><span data-slate-leaf="true" data-offset-key="14040:0" data-first-offset="true"><span data-slate-string="true">不过说起来简单，版本更新实际做起来是一个相当棘手的事。因为系统已经上线运行，必须要保证不间断地对外提供服务，通俗地说就是 “给空中的飞机换引擎”。尤其在以前，需要开发、测试、运维、监控、网络等各个部门的一大堆人来协同工作，费时又费力。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14041"><span data-slate-object="text" data-key="14042"><span data-slate-leaf="true" data-offset-key="14042:0" data-first-offset="true"><span data-slate-string="true">但是，应用的版本更新其实是有章可循的，现在我们有了 Kubernetes 这个强大的自动化运维管理系统，就可以把它的过程抽象出来，让计算机去完成那些复杂繁琐的人工操作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14043"><span data-slate-object="text" data-key="14044"><span data-slate-leaf="true" data-offset-key="14044:0" data-first-offset="true"><span data-slate-string="true">在 Kubernetes 里，版本更新使用的不是 API 对象，而是两个命令：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14045"><span data-slate-object="text" data-key="14046"><span data-slate-leaf="true" data-offset-key="14046:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14047"><span data-slate-leaf="true" data-offset-key="14047:0" data-first-offset="true"><span data-slate-string="true"> 和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14048"><span data-slate-object="text" data-key="14049"><span data-slate-leaf="true" data-offset-key="14049:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout</span></span></span></span><span data-slate-object="text" data-key="14050"><span data-slate-leaf="true" data-offset-key="14050:0" data-first-offset="true"><span data-slate-string="true">，当然它们也要搭配部署应用所需要的 Deployment、DaemonSet 等 YAML 文件。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14051"><span data-slate-object="text" data-key="14052"><span data-slate-leaf="true" data-offset-key="14052:0" data-first-offset="true"><span data-slate-string="true">不过在我们信心满满开始操作之前，首先要理解在 Kubernetes 里，所谓的 “版本” 到底是什么？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14053"><span data-slate-object="text" data-key="14054"><span data-slate-leaf="true" data-offset-key="14054:0" data-first-offset="true"><span data-slate-string="true">我们常常会简单地认为 “版本” 就是应用程序的 “版本号”，或者是容器镜像的 “标签”，但不要忘了，在 Kubernetes 里应用都是以 Pod 的形式运行的，而 Pod 通常又会被 Deployment 等对象来管理，</span></span></span><span data-slate-object="text" data-key="14055"><span data-slate-leaf="true" data-offset-key="14055:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">所以应用的 “版本更新” 实际上更新的是整个 Pod</span></span></span></span><span data-slate-object="text" data-key="14056"><span data-slate-leaf="true" data-offset-key="14056:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14057"><span data-slate-object="text" data-key="14058"><span data-slate-leaf="true" data-offset-key="14058:0" data-first-offset="true"><span data-slate-string="true">那 Pod 又是由什么来决定的呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14059"><span data-slate-object="text" data-key="14060"><span data-slate-leaf="true" data-offset-key="14060:0" data-first-offset="true"><span data-slate-string="true">仔细回忆一下之前我们创建的那么多个对象，你就会发现，Pod 是由 YAML 描述文件来确定的，更准确地说，是 Deployment 等对象里的字段 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14061"><span data-slate-object="text" data-key="14062"><span data-slate-leaf="true" data-offset-key="14062:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="14063"><span data-slate-leaf="true" data-offset-key="14063:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14064"><span data-slate-object="text" data-key="14065"><span data-slate-leaf="true" data-offset-key="14065:0" data-first-offset="true"><span data-slate-string="true">所以，</span></span></span><span data-slate-object="text" data-key="14066"><span data-slate-leaf="true" data-offset-key="14066:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在 Kubernetes 里应用的版本变化就是 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14067"><span data-slate-object="text" data-key="14068"><span data-slate-leaf="true" data-offset-key="14068:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">template</span></span></span></span></span><span data-slate-object="text" data-key="14069"><span data-slate-leaf="true" data-offset-key="14069:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 里 Pod 的变化</span></span></span></span><span data-slate-object="text" data-key="14070"><span data-slate-leaf="true" data-offset-key="14070:0" data-first-offset="true"><span data-slate-string="true">，哪怕 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14071"><span data-slate-object="text" data-key="14072"><span data-slate-leaf="true" data-offset-key="14072:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="14073"><span data-slate-leaf="true" data-offset-key="14073:0" data-first-offset="true"><span data-slate-string="true"> 里只变动了一个字段，那也会形成一个新的版本，也算是版本变化。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14074"><span data-slate-object="text" data-key="14075"><span data-slate-leaf="true" data-offset-key="14075:0" data-first-offset="true"><span data-slate-string="true">但 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14076"><span data-slate-object="text" data-key="14077"><span data-slate-leaf="true" data-offset-key="14077:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="14078"><span data-slate-leaf="true" data-offset-key="14078:0" data-first-offset="true"><span data-slate-string="true"> 里的内容太多了，拿这么长的字符串来当做 “版本号” 不太现实，所以 Kubernetes 就使用了 “摘要” 功能，用摘要算法计算 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14079"><span data-slate-object="text" data-key="14080"><span data-slate-leaf="true" data-offset-key="14080:0" data-first-offset="true"><span data-slate-string="true">template</span></span></span></span><span data-slate-object="text" data-key="14081"><span data-slate-leaf="true" data-offset-key="14081:0" data-first-offset="true"><span data-slate-string="true"> 的 Hash 值作为 “版本号”，虽然不太方便识别，但是很实用。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14082"><span data-slate-object="text" data-key="14083"><span data-slate-leaf="true" data-offset-key="14083:0" data-first-offset="true"><span data-slate-string="true">我们就拿</span></span></span><a data-slate-type="link" data-slate-object="inline" data-key="14084"><span data-slate-object="text" data-key="14085"><span data-slate-leaf="true" data-offset-key="14085:0" data-first-offset="true"><span data-slate-string="true">第 18 讲</span></span></span></a><span data-slate-object="text" data-key="14086"><span data-slate-leaf="true" data-offset-key="14086:0" data-first-offset="true"><span data-slate-string="true">里的 Nginx Deployment 作为例子吧，创建对象之后，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14087"><span data-slate-object="text" data-key="14088"><span data-slate-leaf="true" data-offset-key="14088:0" data-first-offset="true"><span data-slate-string="true">kubectl get</span></span></span></span><span data-slate-object="text" data-key="14089"><span data-slate-leaf="true" data-offset-key="14089:0" data-first-offset="true"><span data-slate-string="true"> 来查看 Pod 的状态：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14090"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/67/7b/67bc5178acde882a57265d6413158a7b.png?wh=1550x234"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14091"><span data-slate-object="text" data-key="14092"><span data-slate-leaf="true" data-offset-key="14092:0" data-first-offset="true"><span data-slate-string="true">Pod 名字里的那串随机数 “6796……” 就是 Pod 模板的 Hash 值，也就是 Pod 的 “版本号”。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14093"><span data-slate-object="text" data-key="14094"><span data-slate-leaf="true" data-offset-key="14094:0" data-first-offset="true"><span data-slate-string="true">如果你变动了 Pod YAML 描述，比如把镜像改成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14095"><span data-slate-object="text" data-key="14096"><span data-slate-leaf="true" data-offset-key="14096:0" data-first-offset="true"><span data-slate-string="true">nginx:stable-alpine</span></span></span></span><span data-slate-object="text" data-key="14097"><span data-slate-leaf="true" data-offset-key="14097:0" data-first-offset="true"><span data-slate-string="true">，或者把容器名字改成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14098"><span data-slate-object="text" data-key="14099"><span data-slate-leaf="true" data-offset-key="14099:0" data-first-offset="true"><span data-slate-string="true">nginx-test</span></span></span></span><span data-slate-object="text" data-key="14100"><span data-slate-leaf="true" data-offset-key="14100:0" data-first-offset="true"><span data-slate-string="true">，都会生成一个新的应用版本，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14101"><span data-slate-object="text" data-key="14102"><span data-slate-leaf="true" data-offset-key="14102:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14103"><span data-slate-leaf="true" data-offset-key="14103:0" data-first-offset="true"><span data-slate-string="true"> 后就会重新创建 Pod：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14104"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/15/1e/15e17760079a03f046aa67f6e34b511e.png?wh=1560x236"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14105"><span data-slate-object="text" data-key="14106"><span data-slate-leaf="true" data-offset-key="14106:0" data-first-offset="true"><span data-slate-string="true">你可以看到，Pod 名字里的 Hash 值变成了 “7c6c……”，这就表示 Pod 的版本更新了。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14107" id="sr-toc-2"><span data-slate-object="text" data-key="14108"><span data-slate-leaf="true" data-offset-key="14108:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 如何实现应用更新</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14109"><span data-slate-object="text" data-key="14110"><span data-slate-leaf="true" data-offset-key="14110:0" data-first-offset="true"><span data-slate-string="true">为了更仔细地研究 Kubernetes 的应用更新过程，让我们来略微改造一下 Nginx Deployment 对象，看看 Kubernetes 到底是怎么实现版本更新的。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14111"><span data-slate-object="text" data-key="14112"><span data-slate-leaf="true" data-offset-key="14112:0" data-first-offset="true"><span data-slate-string="true">首先修改 ConfigMap，让它输出 Nginx 的版本号，方便我们用 curl 查看版本：</span></span></span></div><div data-code-language="dart" data-slate-type="pre" data-slate-object="block" data-key="14113"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div><div data-code-line-number="13"></div><div data-code-line-number="14"></div><div data-code-line-number="15"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14114"><span data-slate-object="text" data-key="14115"><span data-slate-leaf="true" data-offset-key="14115:0" data-first-offset="true"><span data-slate-string="true">apiVersion: v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14116"><span data-slate-object="text" data-key="14117"><span data-slate-leaf="true" data-offset-key="14117:0" data-first-offset="true"><span data-slate-string="true">kind: ConfigMap</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14118"><span data-slate-object="text" data-key="14119"><span data-slate-leaf="true" data-offset-key="14119:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14120"><span data-slate-object="text" data-key="14121"><span data-slate-leaf="true" data-offset-key="14121:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-conf</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14122"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14123"><span data-slate-object="text" data-key="14124"><span data-slate-leaf="true" data-offset-key="14124:0" data-first-offset="true"><span data-slate-string="true">data:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14125"><span data-slate-object="text" data-key="14126"><span data-slate-leaf="true" data-offset-key="14126:0" data-first-offset="true"><span data-slate-string="true">  </span></span></span><span data-slate-object="text" data-key="14127"><span data-slate-leaf="true" data-offset-key="14127:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">default</span></span></span></span><span data-slate-object="text" data-key="14128"><span data-slate-leaf="true" data-offset-key="14128:0" data-first-offset="true"><span data-slate-string="true">.conf: |</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14129"><span data-slate-object="text" data-key="14130"><span data-slate-leaf="true" data-offset-key="14130:0" data-first-offset="true"><span data-slate-string="true">    server {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14131"><span data-slate-object="text" data-key="14132"><span data-slate-leaf="true" data-offset-key="14132:0" data-first-offset="true"><span data-slate-string="true">      listen </span></span></span><span data-slate-object="text" data-key="14133"><span data-slate-leaf="true" data-offset-key="14133:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">80</span></span></span></span><span data-slate-object="text" data-key="14134"><span data-slate-leaf="true" data-offset-key="14134:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14135"><span data-slate-object="text" data-key="14136"><span data-slate-leaf="true" data-offset-key="14136:0" data-first-offset="true"><span data-slate-string="true">      location / {</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14137"><span data-slate-object="text" data-key="14138"><span data-slate-leaf="true" data-offset-key="14138:0" data-first-offset="true"><span data-slate-string="true">        default_type text/plain;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14139"><span data-slate-object="text" data-key="14140"><span data-slate-leaf="true" data-offset-key="14140:0" data-first-offset="true"><span data-slate-string="true">        </span></span></span><span data-slate-object="text" data-key="14141"><span data-slate-leaf="true" data-offset-key="14141:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">return</span></span></span></span><span data-slate-object="text" data-key="14142"><span data-slate-leaf="true" data-offset-key="14142:0" data-first-offset="true"><span data-slate-string="true"> </span></span></span><span data-slate-object="text" data-key="14143"><span data-slate-leaf="true" data-offset-key="14143:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">200</span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14144"><span data-slate-object="text" data-key="14145"><span data-slate-leaf="true" data-offset-key="14145:0" data-first-offset="true"><span data-slate-string="true">          </span></span></span><span data-slate-object="text" data-key="14146"><span data-slate-leaf="true" data-offset-key="14146:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">'ver : </span></span></span></span><span data-slate-object="text" data-key="14147"><span data-slate-leaf="true" data-offset-key="14147:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$nginx_version</span></span></span></span></span><span data-slate-object="text" data-key="14148"><span data-slate-leaf="true" data-offset-key="14148:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\nsrv : </span></span></span></span><span data-slate-object="text" data-key="14149"><span data-slate-leaf="true" data-offset-key="14149:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$server_addr</span></span></span></span></span><span data-slate-object="text" data-key="14150"><span data-slate-leaf="true" data-offset-key="14150:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">:</span></span></span></span><span data-slate-object="text" data-key="14151"><span data-slate-leaf="true" data-offset-key="14151:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$server_port</span></span></span></span></span><span data-slate-object="text" data-key="14152"><span data-slate-leaf="true" data-offset-key="14152:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\nhost: </span></span></span></span><span data-slate-object="text" data-key="14153"><span data-slate-leaf="true" data-offset-key="14153:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">$hostname</span></span></span></span></span><span data-slate-object="text" data-key="14154"><span data-slate-leaf="true" data-offset-key="14154:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">\n'</span></span></span></span><span data-slate-object="text" data-key="14155"><span data-slate-leaf="true" data-offset-key="14155:0" data-first-offset="true"><span data-slate-string="true">;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14156"><span data-slate-object="text" data-key="14157"><span data-slate-leaf="true" data-offset-key="14157:0" data-first-offset="true"><span data-slate-string="true">      }</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14158"><span data-slate-object="text" data-key="14159"><span data-slate-leaf="true" data-offset-key="14159:0" data-first-offset="true"><span data-slate-string="true">    }</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14160"><span data-slate-object="text" data-key="14161"><span data-slate-leaf="true" data-offset-key="14161:0" data-first-offset="true"><span data-slate-string="true">然后我们修改 Pod 镜像，明确地指定版本号是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14162"><span data-slate-object="text" data-key="14163"><span data-slate-leaf="true" data-offset-key="14163:0" data-first-offset="true"><span data-slate-string="true">1.21-alpine</span></span></span></span><span data-slate-object="text" data-key="14164"><span data-slate-leaf="true" data-offset-key="14164:0" data-first-offset="true"><span data-slate-string="true">，实例数设置为 4 个：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14165"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14166"><span data-slate-object="text" data-key="14167"><span data-slate-leaf="true" data-offset-key="14167:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14168"><span data-slate-object="text" data-key="14169"><span data-slate-leaf="true" data-offset-key="14169:0" data-first-offset="true"><span data-slate-string="true">kind: Deployment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14170"><span data-slate-object="text" data-key="14171"><span data-slate-leaf="true" data-offset-key="14171:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14172"><span data-slate-object="text" data-key="14173"><span data-slate-leaf="true" data-offset-key="14173:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14174"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14175"><span data-slate-object="text" data-key="14176"><span data-slate-leaf="true" data-offset-key="14176:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14177"><span data-slate-object="text" data-key="14178"><span data-slate-leaf="true" data-offset-key="14178:0" data-first-offset="true"><span data-slate-string="true">  replicas: 4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14179"><span data-slate-object="text" data-key="14180"><span data-slate-leaf="true" data-offset-key="14180:0" data-first-offset="true"><span data-slate-string="true">  ... ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14181"><span data-slate-object="text" data-key="14182"><span data-slate-leaf="true" data-offset-key="14182:0" data-first-offset="true"><span data-slate-string="true">      containers:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14183"><span data-slate-object="text" data-key="14184"><span data-slate-leaf="true" data-offset-key="14184:0" data-first-offset="true"><span data-slate-string="true">      - image: nginx:1.21-alpine</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14185"><span data-slate-object="text" data-key="14186"><span data-slate-leaf="true" data-offset-key="14186:0" data-first-offset="true"><span data-slate-string="true">  ... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14187"><span data-slate-object="text" data-key="14188"><span data-slate-leaf="true" data-offset-key="14188:0" data-first-offset="true"><span data-slate-string="true">把它命名为 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14189"><span data-slate-object="text" data-key="14190"><span data-slate-leaf="true" data-offset-key="14190:0" data-first-offset="true"><span data-slate-string="true">ngx-v1.yml</span></span></span></span><span data-slate-object="text" data-key="14191"><span data-slate-leaf="true" data-offset-key="14191:0" data-first-offset="true"><span data-slate-string="true">，然后执行命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14192"><span data-slate-object="text" data-key="14193"><span data-slate-leaf="true" data-offset-key="14193:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14194"><span data-slate-leaf="true" data-offset-key="14194:0" data-first-offset="true"><span data-slate-string="true"> 部署这个应用：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14195"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14196"><span data-slate-object="text" data-key="14197"><span data-slate-leaf="true" data-offset-key="14197:0" data-first-offset="true"><span data-slate-string="true">kubectl apply -f ngx-v1.yml</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14198"><span data-slate-object="text" data-key="14199"><span data-slate-leaf="true" data-offset-key="14199:0" data-first-offset="true"><span data-slate-string="true">我们还可以为它创建 Service 对象，再用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14200"><span data-slate-object="text" data-key="14201"><span data-slate-leaf="true" data-offset-key="14201:0" data-first-offset="true"><span data-slate-string="true">kubectl port-forward</span></span></span></span><span data-slate-object="text" data-key="14202"><span data-slate-leaf="true" data-offset-key="14202:0" data-first-offset="true"><span data-slate-string="true"> 转发请求来查看状态：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14203"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14204"><span data-slate-object="text" data-key="14205"><span data-slate-leaf="true" data-offset-key="14205:0" data-first-offset="true"><span data-slate-string="true">kubectl port-forward svc/ngx-svc 8080:80 &amp;</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14206"><span data-slate-object="text" data-key="14207"><span data-slate-leaf="true" data-offset-key="14207:0" data-first-offset="true"><span data-slate-string="true">curl 127.1:8080</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14208"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/20/52/20d23af1305e2d2b4f66b951c09dac52.png?wh=1532x928"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14209"><span data-slate-object="text" data-key="14210"><span data-slate-leaf="true" data-offset-key="14210:0" data-first-offset="true"><span data-slate-string="true">从 curl 命令的输出中可以看到，现在应用的版本是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14211"><span data-slate-object="text" data-key="14212"><span data-slate-leaf="true" data-offset-key="14212:0" data-first-offset="true"><span data-slate-string="true">1.21.6</span></span></span></span><span data-slate-object="text" data-key="14213"><span data-slate-leaf="true" data-offset-key="14213:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14214"><span data-slate-object="text" data-key="14215"><span data-slate-leaf="true" data-offset-key="14215:0" data-first-offset="true"><span data-slate-string="true">现在，让我们编写一个新版本对象 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14216"><span data-slate-object="text" data-key="14217"><span data-slate-leaf="true" data-offset-key="14217:0" data-first-offset="true"><span data-slate-string="true">ngx-v2.yml</span></span></span></span><span data-slate-object="text" data-key="14218"><span data-slate-leaf="true" data-offset-key="14218:0" data-first-offset="true"><span data-slate-string="true">，把镜像升级到 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14219"><span data-slate-object="text" data-key="14220"><span data-slate-leaf="true" data-offset-key="14220:0" data-first-offset="true"><span data-slate-string="true">nginx:1.22-alpine</span></span></span></span><span data-slate-object="text" data-key="14221"><span data-slate-leaf="true" data-offset-key="14221:0" data-first-offset="true"><span data-slate-string="true">，其他的都不变。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14222"><span data-slate-object="text" data-key="14223"><span data-slate-leaf="true" data-offset-key="14223:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">因为 Kubernetes 的动作太快了，为了能够观察到应用更新的过程，我们还需要添加一个字段 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14224"><span data-slate-object="text" data-key="14225"><span data-slate-leaf="true" data-offset-key="14225:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">minReadySeconds</span></span></span></span></span><span data-slate-object="text" data-key="14226"><span data-slate-leaf="true" data-offset-key="14226:0" data-first-offset="true"><span data-slate-string="true">，让 Kubernetes 在更新过程中等待一点时间，确认 Pod 没问题才继续其余 Pod 的创建工作。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14227"><span data-slate-object="text" data-key="14228"><span data-slate-leaf="true" data-offset-key="14228:0" data-first-offset="true"><span data-slate-string="true">要提醒你注意的是，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14229"><span data-slate-object="text" data-key="14230"><span data-slate-leaf="true" data-offset-key="14230:0" data-first-offset="true"><span data-slate-string="true">minReadySeconds</span></span></span></span><span data-slate-object="text" data-key="14231"><span data-slate-leaf="true" data-offset-key="14231:0" data-first-offset="true"><span data-slate-string="true"> 这个字段不属于 Pod 模板，所以它不会影响 Pod 版本：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14232"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div><div data-code-line-number="8"></div><div data-code-line-number="9"></div><div data-code-line-number="10"></div><div data-code-line-number="11"></div><div data-code-line-number="12"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14233"><span data-slate-object="text" data-key="14234"><span data-slate-leaf="true" data-offset-key="14234:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14235"><span data-slate-object="text" data-key="14236"><span data-slate-leaf="true" data-offset-key="14236:0" data-first-offset="true"><span data-slate-string="true">kind: Deployment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14237"><span data-slate-object="text" data-key="14238"><span data-slate-leaf="true" data-offset-key="14238:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14239"><span data-slate-object="text" data-key="14240"><span data-slate-leaf="true" data-offset-key="14240:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14241"></div><div data-slate-type="code-line" data-slate-object="block" data-key="14242"><span data-slate-object="text" data-key="14243"><span data-slate-leaf="true" data-offset-key="14243:0" data-first-offset="true"><span data-slate-string="true">spec:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14244"><span data-slate-object="text" data-key="14245"><span data-slate-leaf="true" data-offset-key="14245:0" data-first-offset="true"><span data-slate-string="true">  minReadySeconds: 15      </span></span></span><span data-slate-object="text" data-key="14246"><span data-slate-leaf="true" data-offset-key="14246:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true"># 确认 Pod 就绪的等待时间 </span></span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14247"><span data-slate-object="text" data-key="14248"><span data-slate-leaf="true" data-offset-key="14248:0" data-first-offset="true"><span data-slate-string="true">  replicas: 4</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14249"><span data-slate-object="text" data-key="14250"><span data-slate-leaf="true" data-offset-key="14250:0" data-first-offset="true"><span data-slate-string="true">  ... ...</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14251"><span data-slate-object="text" data-key="14252"><span data-slate-leaf="true" data-offset-key="14252:0" data-first-offset="true"><span data-slate-string="true">      containers:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14253"><span data-slate-object="text" data-key="14254"><span data-slate-leaf="true" data-offset-key="14254:0" data-first-offset="true"><span data-slate-string="true">      - image: nginx:1.22-alpine</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14255"><span data-slate-object="text" data-key="14256"><span data-slate-leaf="true" data-offset-key="14256:0" data-first-offset="true"><span data-slate-string="true">  ... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14257"><span data-slate-object="text" data-key="14258"><span data-slate-leaf="true" data-offset-key="14258:0" data-first-offset="true"><span data-slate-string="true">现在我们执行命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14259"><span data-slate-object="text" data-key="14260"><span data-slate-leaf="true" data-offset-key="14260:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14261"><span data-slate-leaf="true" data-offset-key="14261:0" data-first-offset="true"><span data-slate-string="true"> 来更新应用，因为改动了镜像名，Pod 模板变了，就会触发 “版本更新”，然后用一个新命令：</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14262"><span data-slate-object="text" data-key="14263"><span data-slate-leaf="true" data-offset-key="14263:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout status</span></span></span></span><span data-slate-object="text" data-key="14264"><span data-slate-leaf="true" data-offset-key="14264:0" data-first-offset="true"><span data-slate-string="true">，来查看应用更新的状态：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14265"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14266"><span data-slate-object="text" data-key="14267"><span data-slate-leaf="true" data-offset-key="14267:0" data-first-offset="true"><span data-slate-string="true">kubectl apply -f ngx-v2.yml</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14268"><span data-slate-object="text" data-key="14269"><span data-slate-leaf="true" data-offset-key="14269:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout status deployment ngx-dep</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14270"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/6d/7f/6d4023181fe180d50eb4cca7755a207f.png?wh=1920x486"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14271"><span data-slate-object="text" data-key="14272"><span data-slate-leaf="true" data-offset-key="14272:0" data-first-offset="true"><span data-slate-string="true">更新完成后，你再执行 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14273"><span data-slate-object="text" data-key="14274"><span data-slate-leaf="true" data-offset-key="14274:0" data-first-offset="true"><span data-slate-string="true">kubectl get pod</span></span></span></span><span data-slate-object="text" data-key="14275"><span data-slate-leaf="true" data-offset-key="14275:0" data-first-offset="true"><span data-slate-string="true">，就会看到 Pod 已经全部替换成了新版本 “d575……”，用 curl 访问 Nginx，输出信息也变成了 “1.22.0”：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14276"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/6a/64/6a1776c3yy1ec374510af9e560401064.png?wh=1594x646"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14277"><span data-slate-object="text" data-key="14278"><span data-slate-leaf="true" data-offset-key="14278:0" data-first-offset="true"><span data-slate-string="true">仔细查看 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14279"><span data-slate-object="text" data-key="14280"><span data-slate-leaf="true" data-offset-key="14280:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout status</span></span></span></span><span data-slate-object="text" data-key="14281"><span data-slate-leaf="true" data-offset-key="14281:0" data-first-offset="true"><span data-slate-string="true"> 的输出信息，你可以发现，Kubernetes 不是把旧 Pod 全部销毁再一次性创建出新 Pod，而是在逐个地创建新 Pod，同时也在销毁旧 Pod，保证系统里始终有足够数量的 Pod 在运行，不会有 “空窗期” 中断服务。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14282"><span data-slate-object="text" data-key="14283"><span data-slate-leaf="true" data-offset-key="14283:0" data-first-offset="true"><span data-slate-string="true">新 Pod 数量增加的过程有点像是 “滚雪球”，从零开始，越滚越大，所以这就是所谓的 “</span></span></span><span data-slate-object="text" data-key="14284"><span data-slate-leaf="true" data-offset-key="14284:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">滚动更新</span></span></span></span><span data-slate-object="text" data-key="14285"><span data-slate-leaf="true" data-offset-key="14285:0" data-first-offset="true"><span data-slate-string="true">”（rolling update）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14286"><span data-slate-object="text" data-key="14287"><span data-slate-leaf="true" data-offset-key="14287:0" data-first-offset="true"><span data-slate-string="true">使用命令 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14288"><span data-slate-object="text" data-key="14289"><span data-slate-leaf="true" data-offset-key="14289:0" data-first-offset="true"><span data-slate-string="true">kubectl describe</span></span></span></span><span data-slate-object="text" data-key="14290"><span data-slate-leaf="true" data-offset-key="14290:0" data-first-offset="true"><span data-slate-string="true"> 可以更清楚地看到 Pod 的变化情况：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="14291"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14292"><span data-slate-object="text" data-key="14293"><span data-slate-leaf="true" data-offset-key="14293:0" data-first-offset="true"><span data-slate-string="true">kubectl </span></span></span><span data-slate-object="text" data-key="14294"><span data-slate-leaf="true" data-offset-key="14294:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">describe</span></span></span></span><span data-slate-object="text" data-key="14295"><span data-slate-leaf="true" data-offset-key="14295:0" data-first-offset="true"><span data-slate-string="true"> deploy ngx</span></span></span><span data-slate-object="text" data-key="14296"><span data-slate-leaf="true" data-offset-key="14296:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">-</span></span></span></span><span data-slate-object="text" data-key="14297"><span data-slate-leaf="true" data-offset-key="14297:0" data-first-offset="true"><span data-slate-string="true">dep</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14298"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/3b/fa/3b88d6b0d609e3b99f33b4f8e997c3fa.png?wh=1232x550"></div></div><div data-slate-type="list" data-slate-object="block" data-key="14299"><div data-slate-type="list-line" data-slate-object="block" data-key="14300"><span data-slate-object="text" data-key="14301"><span data-slate-leaf="true" data-offset-key="14301:0" data-first-offset="true"><span data-slate-string="true">一开始的时候 V1 Pod（即 ngx-dep-54b865d75）的数量是 4；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14302"><span data-slate-object="text" data-key="14303"><span data-slate-leaf="true" data-offset-key="14303:0" data-first-offset="true"><span data-slate-string="true">当 “滚动更新” 开始的时候，Kubernetes 创建 1 个 V2 Pod（即 ngx-dep-d575d5776），并且把 V1 Pod 数量减少到 3；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14304"><span data-slate-object="text" data-key="14305"><span data-slate-leaf="true" data-offset-key="14305:0" data-first-offset="true"><span data-slate-string="true">接着再增加 V2 Pod 的数量到 2，同时 V1 Pod 的数量变成了 1；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14306"><span data-slate-object="text" data-key="14307"><span data-slate-leaf="true" data-offset-key="14307:0" data-first-offset="true"><span data-slate-string="true">最后 V2 Pod 的数量达到预期值 4，V1 Pod 的数量变成了 0，整个更新过程就结束了。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14308"><span data-slate-object="text" data-key="14309"><span data-slate-leaf="true" data-offset-key="14309:0" data-first-offset="true"><span data-slate-string="true">看到这里你是不是有点明白了呢，其实 “滚动更新” 就是由 Deployment 控制的两个同步进行的 “应用伸缩” 操作，老版本缩容到 0，同时新版本扩容到指定值，是一个 “此消彼长” 的过程。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14310"><span data-slate-object="text" data-key="14311"><span data-slate-leaf="true" data-offset-key="14311:0" data-first-offset="true"><span data-slate-string="true">这个滚动更新的过程我画了一张图，你可以参考它来进一步体会：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14312"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/b3/31/b3abe70db73a9da71a1793722e743731.jpg?wh=1920x729"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14313" id="sr-toc-3"><span data-slate-object="text" data-key="14314"><span data-slate-leaf="true" data-offset-key="14314:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 如何管理应用更新</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14315"><span data-slate-object="text" data-key="14316"><span data-slate-leaf="true" data-offset-key="14316:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 的 “滚动更新” 功能确实非常方便，不需要任何人工干预就能简单地把应用升级到新版本，也不会中断服务，不过如果更新过程中发生了错误或者更新后发现有 Bug 该怎么办呢？</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14317"><span data-slate-object="text" data-key="14318"><span data-slate-leaf="true" data-offset-key="14318:0" data-first-offset="true"><span data-slate-string="true">要解决这两个问题，我们还是要用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14319"><span data-slate-object="text" data-key="14320"><span data-slate-leaf="true" data-offset-key="14320:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout</span></span></span></span><span data-slate-object="text" data-key="14321"><span data-slate-leaf="true" data-offset-key="14321:0" data-first-offset="true"><span data-slate-string="true"> 命令。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14322"><span data-slate-object="text" data-key="14323"><span data-slate-leaf="true" data-offset-key="14323:0" data-first-offset="true"><span data-slate-string="true">在应用更新的过程中，你可以随时使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14324"><span data-slate-object="text" data-key="14325"><span data-slate-leaf="true" data-offset-key="14325:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout pause</span></span></span></span><span data-slate-object="text" data-key="14326"><span data-slate-leaf="true" data-offset-key="14326:0" data-first-offset="true"><span data-slate-string="true"> 来暂停更新，检查、修改 Pod，或者测试验证，如果确认没问题，再用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14327"><span data-slate-object="text" data-key="14328"><span data-slate-leaf="true" data-offset-key="14328:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout resume</span></span></span></span><span data-slate-object="text" data-key="14329"><span data-slate-leaf="true" data-offset-key="14329:0" data-first-offset="true"><span data-slate-string="true"> 来继续更新。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14330"><span data-slate-object="text" data-key="14331"><span data-slate-leaf="true" data-offset-key="14331:0" data-first-offset="true"><span data-slate-string="true">这两个命令比较简单，我就不多做介绍了，要注意的是它们只支持 Deployment，不能用在 DaemonSet、StatefulSet 上（最新的 1.24 支持了 StatefulSet 的滚动更新）。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14332"><span data-slate-object="text" data-key="14333"><span data-slate-leaf="true" data-offset-key="14333:0" data-first-offset="true"><span data-slate-string="true">对于更新后出现的问题，Kubernetes 为我们提供了 “后悔药”，也就是更新历史，你可以查看之前的每次更新记录，并且回退到任何位置，和我们开发常用的 Git 等版本控制软件非常类似。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14334"><span data-slate-object="text" data-key="14335"><span data-slate-leaf="true" data-offset-key="14335:0" data-first-offset="true"><span data-slate-string="true">查看更新历史使用的命令是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14336"><span data-slate-object="text" data-key="14337"><span data-slate-leaf="true" data-offset-key="14337:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history</span></span></span></span><span data-slate-object="text" data-key="14338"><span data-slate-leaf="true" data-offset-key="14338:0" data-first-offset="true"><span data-slate-string="true">：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14339"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14340"><span data-slate-object="text" data-key="14341"><span data-slate-leaf="true" data-offset-key="14341:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout </span></span></span><span data-slate-object="text" data-key="14342"><span data-slate-leaf="true" data-offset-key="14342:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">history</span></span></span></span><span data-slate-object="text" data-key="14343"><span data-slate-leaf="true" data-offset-key="14343:0" data-first-offset="true"><span data-slate-string="true"> deploy ngx-dep</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14344"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/7c/09/7cc86862b28829c58c00eeb0fcdfbd09.png?wh=1398x306"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14345"><span data-slate-object="text" data-key="14346"><span data-slate-leaf="true" data-offset-key="14346:0" data-first-offset="true"><span data-slate-string="true">它会输出一个版本列表，因为我们创建 Nginx Deployment 是一个版本，更新又是一个版本，所以这里就会有两条历史记录。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14347"><span data-slate-object="text" data-key="14348"><span data-slate-leaf="true" data-offset-key="14348:0" data-first-offset="true"><span data-slate-string="true">但 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14349"><span data-slate-object="text" data-key="14350"><span data-slate-leaf="true" data-offset-key="14350:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history</span></span></span></span><span data-slate-object="text" data-key="14351"><span data-slate-leaf="true" data-offset-key="14351:0" data-first-offset="true"><span data-slate-string="true"> 的列表输出的有用信息太少，你可以</span></span></span><span data-slate-object="text" data-key="14352"><span data-slate-leaf="true" data-offset-key="14352:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">在命令后加上参数 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14353"><span data-slate-object="text" data-key="14354"><span data-slate-leaf="true" data-offset-key="14354:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">--revision</span></span></span></span></span><span data-slate-object="text" data-key="14355"><span data-slate-leaf="true" data-offset-key="14355:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 来查看每个版本的详细信息</span></span></span></span><span data-slate-object="text" data-key="14356"><span data-slate-leaf="true" data-offset-key="14356:0" data-first-offset="true"><span data-slate-string="true">，包括标签、镜像名、环境变量、存储卷等等，通过这些就可以大致了解每次都变动了哪些关键字段：</span></span></span></div><div data-code-language="sql" data-slate-type="pre" data-slate-object="block" data-key="14357"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14358"><span data-slate-object="text" data-key="14359"><span data-slate-leaf="true" data-offset-key="14359:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history deploy </span></span></span><span data-slate-object="text" data-key="14360"><span data-slate-leaf="true" data-offset-key="14360:0" data-first-offset="true"><span data-slate-type="mark-class" data-slate-object="mark"><span data-slate-string="true">--revision=2</span></span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14361"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/0f/7c/0f8c4d0a230b97bb1a74d745c220677c.png?wh=1608x1054"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14362"><span data-slate-object="text" data-key="14363"><span data-slate-leaf="true" data-offset-key="14363:0" data-first-offset="true"><span data-slate-string="true">假设我们认为刚刚更新的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14364"><span data-slate-object="text" data-key="14365"><span data-slate-leaf="true" data-offset-key="14365:0" data-first-offset="true"><span data-slate-string="true">nginx:1.22-alpine</span></span></span></span><span data-slate-object="text" data-key="14366"><span data-slate-leaf="true" data-offset-key="14366:0" data-first-offset="true"><span data-slate-string="true"> 不好，</span></span></span><span data-slate-object="text" data-key="14367"><span data-slate-leaf="true" data-offset-key="14367:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">想要回退到上一个版本，就可以使用命令 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14368"><span data-slate-object="text" data-key="14369"><span data-slate-leaf="true" data-offset-key="14369:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">kubectl rollout undo</span></span></span></span></span><span data-slate-object="text" data-key="14370"><span data-slate-leaf="true" data-offset-key="14370:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">，也可以加上参数 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14371"><span data-slate-object="text" data-key="14372"><span data-slate-leaf="true" data-offset-key="14372:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">--to-revision</span></span></span></span></span><span data-slate-object="text" data-key="14373"><span data-slate-leaf="true" data-offset-key="14373:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 回退到任意一个历史版本</span></span></span></span><span data-slate-object="text" data-key="14374"><span data-slate-leaf="true" data-offset-key="14374:0" data-first-offset="true"><span data-slate-string="true">：</span></span></span></div><div data-slate-type="pre" data-slate-object="block" data-key="14375"><div><span></span></div><div><div data-code-line-number="1"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14376"><span data-slate-object="text" data-key="14377"><span data-slate-leaf="true" data-offset-key="14377:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout undo deploy ngx-dep</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="image" data-slate-object="block" data-key="14378"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/14/c7/149345b7df104ac70c23a6c877a9b1c7.png?wh=1408x406"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14379"><span data-slate-type="code" data-slate-object="inline" data-key="14380"><span data-slate-object="text" data-key="14381"><span data-slate-leaf="true" data-offset-key="14381:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout undo</span></span></span></span><span data-slate-object="text" data-key="14382"><span data-slate-leaf="true" data-offset-key="14382:0" data-first-offset="true"><span data-slate-string="true"> 的操作过程其实和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14383"><span data-slate-object="text" data-key="14384"><span data-slate-leaf="true" data-offset-key="14384:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14385"><span data-slate-leaf="true" data-offset-key="14385:0" data-first-offset="true"><span data-slate-string="true"> 是一样的，执行的仍然是 “滚动更新”，只不过使用的是旧版本 Pod 模板，把新版本 Pod 数量收缩到 0，同时把老版本 Pod 扩展到指定值。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14386"><span data-slate-object="text" data-key="14387"><span data-slate-leaf="true" data-offset-key="14387:0" data-first-offset="true"><span data-slate-string="true">这个 V2 到 V1 的 “版本降级” 的过程我同样画了一张图，它和从 V1 到 V2 的 “版本升级” 过程是完全一样的，不同的只是版本号的变化方向：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14388"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/0c/29/0cbb6eec008546c4f5106de5ece20329.jpg?wh=1920x695"></div></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14389" id="sr-toc-4"><span data-slate-object="text" data-key="14390"><span data-slate-leaf="true" data-offset-key="14390:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 如何添加更新描述</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14391"><span data-slate-object="text" data-key="14392"><span data-slate-leaf="true" data-offset-key="14392:0" data-first-offset="true"><span data-slate-string="true">讲到这里，Kubernetes 里应用更新的功能就学得差不多了。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14393"><span data-slate-object="text" data-key="14394"><span data-slate-leaf="true" data-offset-key="14394:0" data-first-offset="true"><span data-slate-string="true">不过，你有没有觉得 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14395"><span data-slate-object="text" data-key="14396"><span data-slate-leaf="true" data-offset-key="14396:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history</span></span></span></span><span data-slate-object="text" data-key="14397"><span data-slate-leaf="true" data-offset-key="14397:0" data-first-offset="true"><span data-slate-string="true"> 的版本列表好像有点太简单了呢？只有一个版本更新序号，而另一列 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14398"><span data-slate-object="text" data-key="14399"><span data-slate-leaf="true" data-offset-key="14399:0" data-first-offset="true"><span data-slate-string="true">CHANGE-CAUSE</span></span></span></span><span data-slate-object="text" data-key="14400"><span data-slate-leaf="true" data-offset-key="14400:0" data-first-offset="true"><span data-slate-string="true"> 为什么总是显示成 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14401"><span data-slate-object="text" data-key="14402"><span data-slate-leaf="true" data-offset-key="14402:0" data-first-offset="true"><span data-slate-string="true">&lt;none&gt;</span></span></span></span><span data-slate-object="text" data-key="14403"><span data-slate-leaf="true" data-offset-key="14403:0" data-first-offset="true"><span data-slate-string="true"> 呢？能不能像 Git 一样，每次更新也加上说明信息呢？</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14404"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/7c/09/7cc86862b28829c58c00eeb0fcdfbd09.png?wh=1398x306"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14405"><span data-slate-object="text" data-key="14406"><span data-slate-leaf="true" data-offset-key="14406:0" data-first-offset="true"><span data-slate-string="true">这当然是可以的，做法也很简单，我们</span></span></span><span data-slate-object="text" data-key="14407"><span data-slate-leaf="true" data-offset-key="14407:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">只需要在 Deployment 的 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14408"><span data-slate-object="text" data-key="14409"><span data-slate-leaf="true" data-offset-key="14409:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">metadata</span></span></span></span></span><span data-slate-object="text" data-key="14410"><span data-slate-leaf="true" data-offset-key="14410:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 里加上一个新的字段 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14411"><span data-slate-object="text" data-key="14412"><span data-slate-leaf="true" data-offset-key="14412:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">annotations</span></span></span></span></span><span data-slate-object="text" data-key="14413"><span data-slate-leaf="true" data-offset-key="14413:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14414"><span data-slate-type="code" data-slate-object="inline" data-key="14415"><span data-slate-object="text" data-key="14416"><span data-slate-leaf="true" data-offset-key="14416:0" data-first-offset="true"><span data-slate-string="true">annotations</span></span></span></span><span data-slate-object="text" data-key="14417"><span data-slate-leaf="true" data-offset-key="14417:0" data-first-offset="true"><span data-slate-string="true"> 字段的含义是 “注解”“注释”，形式上和 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14418"><span data-slate-object="text" data-key="14419"><span data-slate-leaf="true" data-offset-key="14419:0" data-first-offset="true"><span data-slate-string="true">labels</span></span></span></span><span data-slate-object="text" data-key="14420"><span data-slate-leaf="true" data-offset-key="14420:0" data-first-offset="true"><span data-slate-string="true"> 一样，都是 Key-Value，也都是给 API 对象附加一些额外的信息，但是用途上区别很大。</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14421"><div data-slate-type="list-line" data-slate-object="block" data-key="14422"><span data-slate-type="code" data-slate-object="inline" data-key="14423"><span data-slate-object="text" data-key="14424"><span data-slate-leaf="true" data-offset-key="14424:0" data-first-offset="true"><span data-slate-string="true">annotations</span></span></span></span><span data-slate-object="text" data-key="14425"><span data-slate-leaf="true" data-offset-key="14425:0" data-first-offset="true"><span data-slate-string="true"> 添加的信息一般是给 Kubernetes 内部的各种对象使用的，有点像是 “扩展属性”；</span></span></span></div><div data-slate-type="list-line" data-slate-object="block" data-key="14426"><span data-slate-type="code" data-slate-object="inline" data-key="14427"><span data-slate-object="text" data-key="14428"><span data-slate-leaf="true" data-offset-key="14428:0" data-first-offset="true"><span data-slate-string="true">labels</span></span></span></span><span data-slate-object="text" data-key="14429"><span data-slate-leaf="true" data-offset-key="14429:0" data-first-offset="true"><span data-slate-string="true"> 主要面对的是 Kubernetes 外部的用户，用来筛选、过滤对象的。</span></span></span></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14430"><span data-slate-object="text" data-key="14431"><span data-slate-leaf="true" data-offset-key="14431:0" data-first-offset="true"><span data-slate-string="true">如果用一个简单的比喻来说呢，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14432"><span data-slate-object="text" data-key="14433"><span data-slate-leaf="true" data-offset-key="14433:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">annotations</span></span></span></span></span><span data-slate-object="text" data-key="14434"><span data-slate-leaf="true" data-offset-key="14434:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 就是包装盒里的产品说明书，而 </span></span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14435"><span data-slate-object="text" data-key="14436"><span data-slate-leaf="true" data-offset-key="14436:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true">labels</span></span></span></span></span><span data-slate-object="text" data-key="14437"><span data-slate-leaf="true" data-offset-key="14437:0" data-first-offset="true"><span data-slate-type="bold" data-slate-object="mark"><span data-slate-string="true"> 是包装盒外的标签贴纸</span></span></span></span><span data-slate-object="text" data-key="14438"><span data-slate-leaf="true" data-offset-key="14438:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14439"><span data-slate-object="text" data-key="14440"><span data-slate-leaf="true" data-offset-key="14440:0" data-first-offset="true"><span data-slate-string="true">借助 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14441"><span data-slate-object="text" data-key="14442"><span data-slate-leaf="true" data-offset-key="14442:0" data-first-offset="true"><span data-slate-string="true">annotations</span></span></span></span><span data-slate-object="text" data-key="14443"><span data-slate-leaf="true" data-offset-key="14443:0" data-first-offset="true"><span data-slate-string="true">，Kubernetes 既不破坏对象的结构，也不用新增字段，就能够给 API 对象添加任意的附加信息，这就是面向对象设计中典型的 OCP “开闭原则”，让对象更具扩展性和灵活性。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14444"><span data-slate-type="code" data-slate-object="inline" data-key="14445"><span data-slate-object="text" data-key="14446"><span data-slate-leaf="true" data-offset-key="14446:0" data-first-offset="true"><span data-slate-string="true">annotations</span></span></span></span><span data-slate-object="text" data-key="14447"><span data-slate-leaf="true" data-offset-key="14447:0" data-first-offset="true"><span data-slate-string="true"> 里的值可以任意写，Kubernetes 会自动忽略不理解的 Key-Value，但要编写更新说明就需要使用特定的字段 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14448"><span data-slate-object="text" data-key="14449"><span data-slate-leaf="true" data-offset-key="14449:0" data-first-offset="true"><span data-slate-string="true">kubernetes.io/change-cause</span></span></span></span><span data-slate-object="text" data-key="14450"><span data-slate-leaf="true" data-offset-key="14450:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14451"><span data-slate-object="text" data-key="14452"><span data-slate-leaf="true" data-offset-key="14452:0" data-first-offset="true"><span data-slate-string="true">下面来操作一下，我们创建 3 个版本的 Nginx 应用，同时添加更新说明：</span></span></span></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14453"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14454"><span data-slate-object="text" data-key="14455"><span data-slate-leaf="true" data-offset-key="14455:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14456"><span data-slate-object="text" data-key="14457"><span data-slate-leaf="true" data-offset-key="14457:0" data-first-offset="true"><span data-slate-string="true">kind: Deployment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14458"><span data-slate-object="text" data-key="14459"><span data-slate-leaf="true" data-offset-key="14459:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14460"><span data-slate-object="text" data-key="14461"><span data-slate-leaf="true" data-offset-key="14461:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14462"><span data-slate-object="text" data-key="14463"><span data-slate-leaf="true" data-offset-key="14463:0" data-first-offset="true"><span data-slate-string="true">  annotations:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14464"><span data-slate-object="text" data-key="14465"><span data-slate-leaf="true" data-offset-key="14465:0" data-first-offset="true"><span data-slate-string="true">    kubernetes.io/change-cause: v1, ngx=1.21</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14466"><span data-slate-object="text" data-key="14467"><span data-slate-leaf="true" data-offset-key="14467:0" data-first-offset="true"><span data-slate-string="true">... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14468"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14469"><span data-slate-object="text" data-key="14470"><span data-slate-leaf="true" data-offset-key="14470:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14471"><span data-slate-object="text" data-key="14472"><span data-slate-leaf="true" data-offset-key="14472:0" data-first-offset="true"><span data-slate-string="true">kind: Deployment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14473"><span data-slate-object="text" data-key="14474"><span data-slate-leaf="true" data-offset-key="14474:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14475"><span data-slate-object="text" data-key="14476"><span data-slate-leaf="true" data-offset-key="14476:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14477"><span data-slate-object="text" data-key="14478"><span data-slate-leaf="true" data-offset-key="14478:0" data-first-offset="true"><span data-slate-string="true">  annotations:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14479"><span data-slate-object="text" data-key="14480"><span data-slate-leaf="true" data-offset-key="14480:0" data-first-offset="true"><span data-slate-string="true">    kubernetes.io/change-cause: update to v2, ngx=1.22</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14481"><span data-slate-object="text" data-key="14482"><span data-slate-leaf="true" data-offset-key="14482:0" data-first-offset="true"><span data-slate-string="true">... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-code-language="bash" data-slate-type="pre" data-slate-object="block" data-key="14483"><div><span></span></div><div><div data-code-line-number="1"></div><div data-code-line-number="2"></div><div data-code-line-number="3"></div><div data-code-line-number="4"></div><div data-code-line-number="5"></div><div data-code-line-number="6"></div><div data-code-line-number="7"></div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><div data-origin="pm_code_preview"><div data-slate-type="code-line" data-slate-object="block" data-key="14484"><span data-slate-object="text" data-key="14485"><span data-slate-leaf="true" data-offset-key="14485:0" data-first-offset="true"><span data-slate-string="true">apiVersion: apps/v1</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14486"><span data-slate-object="text" data-key="14487"><span data-slate-leaf="true" data-offset-key="14487:0" data-first-offset="true"><span data-slate-string="true">kind: Deployment</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14488"><span data-slate-object="text" data-key="14489"><span data-slate-leaf="true" data-offset-key="14489:0" data-first-offset="true"><span data-slate-string="true">metadata:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14490"><span data-slate-object="text" data-key="14491"><span data-slate-leaf="true" data-offset-key="14491:0" data-first-offset="true"><span data-slate-string="true">  name: ngx-dep</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14492"><span data-slate-object="text" data-key="14493"><span data-slate-leaf="true" data-offset-key="14493:0" data-first-offset="true"><span data-slate-string="true">  annotations:</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14494"><span data-slate-object="text" data-key="14495"><span data-slate-leaf="true" data-offset-key="14495:0" data-first-offset="true"><span data-slate-string="true">    kubernetes.io/change-cause: update to v3, change name</span></span></span></div><div data-slate-type="code-line" data-slate-object="block" data-key="14496"><span data-slate-object="text" data-key="14497"><span data-slate-leaf="true" data-offset-key="14497:0" data-first-offset="true"><span data-slate-string="true">... ...</span></span></span></div></div></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14498"><span data-slate-object="text" data-key="14499"><span data-slate-leaf="true" data-offset-key="14499:0" data-first-offset="true"><span data-slate-string="true">你需要注意 YAML 里的 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14500"><span data-slate-object="text" data-key="14501"><span data-slate-leaf="true" data-offset-key="14501:0" data-first-offset="true"><span data-slate-string="true">metadata</span></span></span></span><span data-slate-object="text" data-key="14502"><span data-slate-leaf="true" data-offset-key="14502:0" data-first-offset="true"><span data-slate-string="true"> 部分，使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14503"><span data-slate-object="text" data-key="14504"><span data-slate-leaf="true" data-offset-key="14504:0" data-first-offset="true"><span data-slate-string="true">annotations.kubernetes.io/change-cause</span></span></span></span><span data-slate-object="text" data-key="14505"><span data-slate-leaf="true" data-offset-key="14505:0" data-first-offset="true"><span data-slate-string="true"> 描述了版本更新的情况，相比 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14506"><span data-slate-object="text" data-key="14507"><span data-slate-leaf="true" data-offset-key="14507:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history --revision</span></span></span></span><span data-slate-object="text" data-key="14508"><span data-slate-leaf="true" data-offset-key="14508:0" data-first-offset="true"><span data-slate-string="true"> 的罗列大量信息更容易理解。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14509"><span data-slate-object="text" data-key="14510"><span data-slate-leaf="true" data-offset-key="14510:0" data-first-offset="true"><span data-slate-string="true">依次使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14511"><span data-slate-object="text" data-key="14512"><span data-slate-leaf="true" data-offset-key="14512:0" data-first-offset="true"><span data-slate-string="true">kubectl apply</span></span></span></span><span data-slate-object="text" data-key="14513"><span data-slate-leaf="true" data-offset-key="14513:0" data-first-offset="true"><span data-slate-string="true"> 创建并更新对象之后，我们再用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14514"><span data-slate-object="text" data-key="14515"><span data-slate-leaf="true" data-offset-key="14515:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout history</span></span></span></span><span data-slate-object="text" data-key="14516"><span data-slate-leaf="true" data-offset-key="14516:0" data-first-offset="true"><span data-slate-string="true"> 来看一下更新历史：</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14517"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/74/69/74bcc2020yy6b121634b3cbf972fe669.png?wh=1398x356"></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14518"><span data-slate-object="text" data-key="14519"><span data-slate-leaf="true" data-offset-key="14519:0" data-first-offset="true"><span data-slate-string="true">这次显示的列表信息就好看多了，每个版本的主要变动情况列得非常清楚，和 Git 版本管理的感觉很像。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14520" id="sr-toc-5"><span data-slate-object="text" data-key="14521"><span data-slate-leaf="true" data-offset-key="14521:0" data-first-offset="true"><span data-slate-string="true">小结</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14522"><span data-slate-object="text" data-key="14523"><span data-slate-leaf="true" data-offset-key="14523:0" data-first-offset="true"><span data-slate-string="true">好，今天我们一起学习了 Kubernetes 里的高级应用管理功能：滚动更新，它会自动缩放新旧版本的 Pod 数量，能够在用户无感知的情况下实现服务升级或降级，让原本复杂棘手的运维工作变得简单又轻松。</span></span></span></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14524"><span data-slate-object="text" data-key="14525"><span data-slate-leaf="true" data-offset-key="14525:0" data-first-offset="true"><span data-slate-string="true">再小结一下今天的要点：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14526"><div data-slate-type="list-line" data-slate-object="block" data-key="14527"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14528"><span data-slate-leaf="true" data-offset-key="14528:0" data-first-offset="true"><span data-slate-string="true">在 Kubernetes 里应用的版本不仅仅是容器镜像，而是整个 Pod 模板，为了便于处理使用了摘要算法，计算模板的 Hash 值作为版本号。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="14529"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14530"><span data-slate-leaf="true" data-offset-key="14530:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 更新应用采用的是滚动更新策略，减少旧版本 Pod 的同时增加新版本 Pod，保证在更新过程中服务始终可用。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="14531"><div data-code-line-number="3"></div><div><span data-slate-object="text" data-key="14532"><span data-slate-leaf="true" data-offset-key="14532:0" data-first-offset="true"><span data-slate-string="true">管理应用更新使用的命令是 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14533"><span data-slate-object="text" data-key="14534"><span data-slate-leaf="true" data-offset-key="14534:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout</span></span></span></span><span data-slate-object="text" data-key="14535"><span data-slate-leaf="true" data-offset-key="14535:0" data-first-offset="true"><span data-slate-string="true">，子命令有 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14536"><span data-slate-object="text" data-key="14537"><span data-slate-leaf="true" data-offset-key="14537:0" data-first-offset="true"><span data-slate-string="true">status</span></span></span></span><span data-slate-object="text" data-key="14538"><span data-slate-leaf="true" data-offset-key="14538:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14539"><span data-slate-object="text" data-key="14540"><span data-slate-leaf="true" data-offset-key="14540:0" data-first-offset="true"><span data-slate-string="true">history</span></span></span></span><span data-slate-object="text" data-key="14541"><span data-slate-leaf="true" data-offset-key="14541:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14542"><span data-slate-object="text" data-key="14543"><span data-slate-leaf="true" data-offset-key="14543:0" data-first-offset="true"><span data-slate-string="true">undo</span></span></span></span><span data-slate-object="text" data-key="14544"><span data-slate-leaf="true" data-offset-key="14544:0" data-first-offset="true"><span data-slate-string="true"> 等。</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="14545"><div data-code-line-number="4"></div><div><span data-slate-object="text" data-key="14546"><span data-slate-leaf="true" data-offset-key="14546:0" data-first-offset="true"><span data-slate-string="true">Kubernetes 会记录应用的更新历史，可以使用 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14547"><span data-slate-object="text" data-key="14548"><span data-slate-leaf="true" data-offset-key="14548:0" data-first-offset="true"><span data-slate-string="true">history --revision</span></span></span></span><span data-slate-object="text" data-key="14549"><span data-slate-leaf="true" data-offset-key="14549:0" data-first-offset="true"><span data-slate-string="true"> 查看每个版本的详细信息，也可以在每次更新时添加注解 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14550"><span data-slate-object="text" data-key="14551"><span data-slate-leaf="true" data-offset-key="14551:0" data-first-offset="true"><span data-slate-string="true">kubernetes.io/change-cause</span></span></span></span><span data-slate-object="text" data-key="14552"><span data-slate-leaf="true" data-offset-key="14552:0" data-first-offset="true"><span data-slate-string="true">。</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14553"><span data-slate-object="text" data-key="14554"><span data-slate-leaf="true" data-offset-key="14554:0" data-first-offset="true"><span data-slate-string="true">另外，在 Deployment 里还有其他一些字段可以对滚动更新的过程做更细致的控制，它们都在 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14555"><span data-slate-object="text" data-key="14556"><span data-slate-leaf="true" data-offset-key="14556:0" data-first-offset="true"><span data-slate-string="true">spec.strategy.rollingUpdate</span></span></span></span><span data-slate-object="text" data-key="14557"><span data-slate-leaf="true" data-offset-key="14557:0" data-first-offset="true"><span data-slate-string="true"> 里，比如 </span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14558"><span data-slate-object="text" data-key="14559"><span data-slate-leaf="true" data-offset-key="14559:0" data-first-offset="true"><span data-slate-string="true">maxSurge</span></span></span></span><span data-slate-object="text" data-key="14560"><span data-slate-leaf="true" data-offset-key="14560:0" data-first-offset="true"><span data-slate-string="true">、</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14561"><span data-slate-object="text" data-key="14562"><span data-slate-leaf="true" data-offset-key="14562:0" data-first-offset="true"><span data-slate-string="true">maxUnavailable</span></span></span></span><span data-slate-object="text" data-key="14563"><span data-slate-leaf="true" data-offset-key="14563:0" data-first-offset="true"><span data-slate-string="true"> 等字段，分别控制最多新增 Pod 数和最多不可用 Pod 数，一般用默认值就足够了，你如果感兴趣也可以查看 Kubernetes 文档进一步研究。</span></span></span></div><h2 data-slate-type="heading" data-slate-object="block" data-key="14564" id="sr-toc-6"><span data-slate-object="text" data-key="14565"><span data-slate-leaf="true" data-offset-key="14565:0" data-first-offset="true"><span data-slate-string="true">课下作业</span></span></span></h2><div data-slate-type="paragraph" data-slate-object="block" data-key="14566"><span data-slate-object="text" data-key="14567"><span data-slate-leaf="true" data-offset-key="14567:0" data-first-offset="true"><span data-slate-string="true">最后是课下作业时间，给你留两个思考题：</span></span></span></div><div data-slate-type="list" data-slate-object="block" data-key="14568"><div data-slate-type="list-line" data-slate-object="block" data-key="14569"><div data-code-line-number="1"></div><div><span data-slate-object="text" data-key="14570"><span data-slate-leaf="true" data-offset-key="14570:0" data-first-offset="true"><span data-slate-string="true">今天学的 Kubernetes 的 “滚动更新”，与我们常说的 “灰度发布” 有什么相同点和不同点？</span></span></span></div></div><div data-slate-type="list-line" data-slate-object="block" data-key="14571"><div data-code-line-number="2"></div><div><span data-slate-object="text" data-key="14572"><span data-slate-leaf="true" data-offset-key="14572:0" data-first-offset="true"><span data-slate-string="true">直接部署旧版本的 YAML 也可以实现版本回退，</span></span></span><span data-slate-type="code" data-slate-object="inline" data-key="14573"><span data-slate-object="text" data-key="14574"><span data-slate-leaf="true" data-offset-key="14574:0" data-first-offset="true"><span data-slate-string="true">kubectl rollout undo</span></span></span></span><span data-slate-object="text" data-key="14575"><span data-slate-leaf="true" data-offset-key="14575:0" data-first-offset="true"><span data-slate-string="true"> 命令的好处是什么？</span></span></span></div></div></div><div data-slate-type="paragraph" data-slate-object="block" data-key="14576"><span data-slate-object="text" data-key="14577"><span data-slate-leaf="true" data-offset-key="14577:0" data-first-offset="true"><span data-slate-string="true">欢迎在留言区积极参与讨论。如果觉得今天的内容对你有帮助，也欢迎转发给身边的朋友一起讨论，我们下节课再见。</span></span></span></div><div data-slate-type="image" data-slate-object="block" data-key="14578"><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/55/f8/55154596ba524615a36601c7fdeb9af8.jpg?wh=1920x2635"></div></div></div></div></div><div><div></div><div></div><div><div data-simplebar="init"><div><div><div></div></div><div><div><div><div><textarea placeholder="将学到的知识总结成笔记，方便日后快速查找及复习"></textarea></div></div></div></div><div></div></div><div><div></div></div><div><div></div></div></div><div><div>确认放弃笔记？</div><div>放弃后所记笔记将不保留。</div></div><div><div>新功能上线，你的历史笔记已初始化为私密笔记，是否一键批量公开？</div><div>批量公开的笔记不会为你同步至部落</div></div><div></div></div><div><div><div>公开</div><div>同步至部落</div></div><div>取消</div><div>完成</div></div><div><span>0/2000</span></div></div><div><div><span>划线</span></div><div></div><div></div><div></div><div><span>笔记</span></div><div></div><div><span>复制</span></div></div></div><div><div><div><span></span></div><p><a href="javascript:void(0);">给文章提建议</a></p></div></div><div><div class="sr-rd-content-center"><img class="sr-rd-content-img" src="https://static001.geekbang.org/resource/image/94/c1/9415076c60e63fc6303d9a3bc900b5c1.png"></div></div><div><span>©</span> 版权归极客邦科技所有，未经许可不得传播售卖。 页面已增加防盗追踪，如有侵权极客邦将依法追究其法律责任。 </div></div><div><div><div class="sr-rd-content-center-small"><img class="" src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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"></div><div>Geek__653581f21177</div></div><div><textarea placeholder="由作者筛选后的优质留言将会公开显示，欢迎踊跃留言。" rows="16"></textarea></div><div><div>Ctrl + Enter 发表</div><div>0/2000 字符</div><div>提交留言</div></div></div><div><h2 id="sr-toc-7">精选留言 (5)</h2><ul><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKQuaDVYz2jWN9vrmgbB785SNkmYmxf1xzEG8m8ku3ZvzYSkiaanTjqt7O47ficOQUpGmEy7eImplDw/132"></div></div><div><div><div><span>椰子</span></div></div><div>滚动更新时，新版本和旧版本共存的那一小段时间是共同对外提供服务的吗？如果这样的话是不是线上就存在不同版本的问题了</div><div><p>作者回复：是这样的，但好处是可以不间断对外提供服务。</p></div><div><div>2022-08-24</div><div><div><i></i><span>3</span></div><div><i></i><span>2</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_28"></div></div><div><div><div><span>peter</span></div></div><div>请教老师几个问题：
Q1：第 26 讲是关于 sts 的，如果要清理该讲所创建的环境，需要执行多个命令删除吗？
是否可以通过执行一个删除命令就可以全部删除？ 第 26 讲涉及到 3 个对象：sts、svc、pod，要清理所有创建的实例，
是否存在一个命令就可以全部删除？ 比如: kubectl delete sts。 但执行该命令后发现不能删除全部实例。好像只能逐个删除。
Q2：Replica Set 是个单独的对象吗？还是说它等价于 yaml 文件中的： spec: replicas: 2
Q3： 第 27 讲，创建 ngx-v1 部分，创建四个 POD 都成功了，在一个终端执行 “kubectl port-forward svc/ngx-svc 8080:80 &amp;”，执行后此终端上显示 “Forwarding from [::1]:8080 -&gt; 80”。新开一个终端，在此新终端上执行 “curl 127.1:8080”，结果是：新终端上显示 nginx 的欢迎页，在老终端上显示 “Handling connection for 8080”，但没有显示”ver、srv” 等信息。 为什么？ （confiMap 是拷贝文中的内容，service 用以前的，tpye=NodePort）</div><div><p>作者回复: 
1. 在命令里写多个对象就可以，如果要清除多个可以用 - f yaml 的方式比较好。

2.ReplicaSet 是一种单独的对象，但很少直接用，我们现在用的都是 Deployment，由 Deployment 来控制 ReplicaSet，感兴趣可以去研究一下它。

3. 老终端显示的信息是 port-forward 转发的信息，与 Nginx 无关，只有在另一个终端发 curl 请求才会出 Nginx 信息。可以参考一下后续的视频。</p></div><div><div>2022-08-25</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>密码 123456</span></div></div><div>有个问题，我看公司的项目，直接 jenkens 打包，k8s 就能感知到。那 k8s，是如何做到的呢？</div><div><p>作者回复：这个就属于 CI/CD 的范围了，其实并不是 Kubernetes 直接的能力，而是它们与 Kubernetes 的集成，我对这方面没有了解过，sorry。</p></div><div><div>2022-08-25</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>马以</span></div></div><div>思考题：
1: “滚动发布” 是能力，“灰度发布” 是功能，k8s 基于 “滚动发布” 的能力，可以实现 pod 的‘水平扩展 / 收缩’，从而能够提供类似于 “灰度发布”、“金丝雀发布” 这种功能。
2: 其实讨论这个问题前，我们要先了解下 k8s 的控制器模型，另外还要引入一个概念就是 “ReplicaSet”，什么意思呢，其实 Deployment 并不是直接控制 Pod，Pod 的归属对象是 “ReplicaSet”，也就是说 Deployment 控制的是 “ReplicaSet”(版本这个概念其实我们可以等同于是 ReplicaSet)，然后 “ReplicaSet” 控制 Pod 的数量。我们可以通过 kubectl get rs 来看下具体内容：

$ kubectl get rs

NAME                    DESIRED   CURRENT   READY   AGE
ngx-deploy-699b5dbd6b   4         4         4       7h42m
ngx-deploy-6dfbbccf84   0         0         0       9d
ngx-deploy-76c65bc7db   0         0         0       9d
ngx-deploy-ffd96c4fc    0         0         0       7h46m

所以这个时候，我们再来理解 “版本回退” 和 “直接部署旧版本的 YAML” 的区别就容易了，这里的版本就像是我们平时开发代码库打的 tag 一样，是类似于我们的快照文件一样，这个快照信息可以正确的帮我们记录当时场景的最原始信息，所以我们通过版本回退的方式能够最大限度的保证正确性（这点是 k8s 已经为我们保证了这一点），反之如果我们通过旧的 yaml 部署，就不一定能保证当前这个 yaml 文件有没有被改动过，这里的变数还是挺大的，所以直接通过 yaml 部署，极大的增加了我们部署的风险性。
</div><div><p>作者回复: great</p></div><div><div>2022-08-24</div><div><div><i></i></div><div><i></i><span>1</span></div></div></div></div></div></li><li><div><div data-v-3d2acdda=""><div class="sr-rd-content-center-small"><img class="" src="https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg?x-oss-process=image/resize,m_fill,h_68,w_68"></div></div><div><div><div><span>Christopher</span></div></div><div>第一个问题：灰度发布应该是多个应用版本共存，按一定比例分配；
第二个问题：使用 rollout 版本回退，保持 pod 固定数量滚动更新，减轻资源压力，尽量地避免版本冲突。
目前只想到这些，希望老师再补充😁</div><div><p>作者回复：说的很好。

如果不用 rollout undo，虽然效果是相同的，都是滚动更新，但就没有体现 “版本回退” 的意思了，仅仅是更新了一个版本，不利于运维管理。</p></div><div><div>2022-08-24</div><div><div><i></i></div><div><i></i><span></span></div></div></div></div></div></li></ul><div> 收起评论<span></span></div></div></sr-rd-content>
                            <toc-bg><toc style="width: initial;overflow: auto!important;"class="simpread-font simpread-theme-root" data-reactid=".2j"><outline class="toc-level-h1" data-reactid=".2j.0" style="width: 175px;"><active data-reactid=".2j.0.0" ></active><a class="toc-outline-theme-github" href="#sr-toc-0" data-reactid=".2j.0.1"><span data-reactid=".2j.0.1.0">27｜滚动更新：如何做到平滑的应用升级降级？</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.1" style="width: 165px;"><active data-reactid=".2j.1.0"></active><a class="toc-outline-theme-github" href="#sr-toc-1" data-reactid=".2j.1.1"><span data-reactid=".2j.1.1.0">Kubernetes 如何定义应用版本</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.2" style="width: 165px;"><active data-reactid=".2j.2.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-2" data-reactid=".2j.2.1"><span data-reactid=".2j.2.1.0">Kubernetes 如何实现应用更新</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.3" style="width: 165px;"><active data-reactid=".2j.3.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-3" data-reactid=".2j.3.1"><span data-reactid=".2j.3.1.0">Kubernetes 如何管理应用更新</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.4" style="width: 165px;"><active data-reactid=".2j.4.0"></active><pangu> </pangu><a class="toc-outline-theme-github" href="#sr-toc-4" data-reactid=".2j.4.1"><span data-reactid=".2j.4.1.0">Kubernetes 如何添加更新描述</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.5" style="width: 165px;"><active data-reactid=".2j.5.0"></active><a class="toc-outline-theme-github" href="#sr-toc-5" data-reactid=".2j.5.1"><span data-reactid=".2j.5.1.0">小结</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.6" style="width: 165px;"><active data-reactid=".2j.6.0"></active><a class="toc-outline-theme-github" href="#sr-toc-6" data-reactid=".2j.6.1"><span data-reactid=".2j.6.1.0">课下作业</span></a></outline><outline class="toc-level-h2" data-reactid=".2j.7" style="width: 165px;"><active data-reactid=".2j.7.0"></active><a class="toc-outline-theme-github" href="#sr-toc-7" data-reactid=".2j.7.1"><span data-reactid=".2j.7.1.0">精选留言 (5)</span></a></outline></toc></toc-bg>
                            <sr-rd-footer>
                                <sr-rd-footer-group>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                    <sr-rd-footer-text>全文完</sr-rd-footer-text>
                                    <sr-rd-footer-line></sr-rd-footer-line>
                                </sr-rd-footer-group>
                                <sr-rd-footer-copywrite>
                                    <div>本文由 <a href="http://ksria.com/simpread" target="_blank">简悦 SimpRead</a> 转码，用以提升阅读体验，<a href="https://time.geekbang.org/column/article/547301" target="_blank">原文地址 </a></div>
                                </sr-rd-footer-copywrite>
                            </sr-rd-footer>
                        </sr-read>
                    </body>
                </html>